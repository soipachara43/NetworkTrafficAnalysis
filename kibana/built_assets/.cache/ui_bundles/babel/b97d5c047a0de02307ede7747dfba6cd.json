{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/visualizations/public/persisted_state/persisted_state.js","dependencies":[{"path":"src/plugins/visualizations/public/persisted_state/persisted_state.js","mtime":1589249551171},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUGVyc2lzdGVkU3RhdGUgPSB2b2lkIDA7Cgp2YXIgX2V2ZW50cyA9IHJlcXVpcmUoImV2ZW50cyIpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfdG9QYXRoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2gvaW50ZXJuYWwvdG9QYXRoIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCmZ1bmN0aW9uIHByZXBTZXRQYXJhbXMoa2V5LCB2YWx1ZSwgcGF0aCkgewogIC8vIGtleSBtdXN0IGJlIHRoZSB2YWx1ZSwgc2V0IHRoZSBlbnRpcmUgc3RhdGUgdXNpbmcgaXQKICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiAoKDAsIF9sb2Rhc2guaXNQbGFpbk9iamVjdCkoa2V5KSB8fCBwYXRoLmxlbmd0aCA+IDApKSB7CiAgICAvLyBzZXR0aW5nIGVudGlyZSB0cmVlLCBzd2FwIHRoZSBrZXkgYW5kIHZhbHVlIHRvIHdyaXRlIHRvIHRoZSBzdGF0ZQogICAgdmFsdWUgPSBrZXk7CiAgICBrZXkgPSB1bmRlZmluZWQ7CiAgfSAvLyBlbnN1cmUgdGhlIHZhbHVlIGJlaW5nIHBhc3NlZCBpbiBpcyBuZXZlciBtdXRhdGVkCgoKICByZXR1cm4gewogICAgdmFsdWU6ICgwLCBfbG9kYXNoLmNsb25lRGVlcCkodmFsdWUpLAogICAga2V5OiBrZXkKICB9Owp9Cgp2YXIgUGVyc2lzdGVkU3RhdGUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfRXZlbnRFbWl0dGVyKSB7CiAgX2luaGVyaXRzKFBlcnNpc3RlZFN0YXRlLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gUGVyc2lzdGVkU3RhdGUodmFsdWUsIHBhdGgpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGVyc2lzdGVkU3RhdGUpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFBlcnNpc3RlZFN0YXRlKS5jYWxsKHRoaXMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfcGF0aCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX2luaXRpYWxpemVkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfY2hhbmdlZFN0YXRlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfZGVmYXVsdFN0YXRlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfbWVyZ2VkU3RhdGUiLCB2b2lkIDApOwoKICAgIF90aGlzLl9wYXRoID0gX3RoaXMuc2V0UGF0aChwYXRoKTsgLy8gU29tZSB2YWxpZGF0aW9ucwoKICAgIGlmICghX3RoaXMuX3BhdGgubGVuZ3RoICYmIHZhbHVlICYmICEoMCwgX2xvZGFzaC5pc1BsYWluT2JqZWN0KSh2YWx1ZSkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdTdGF0ZSB2YWx1ZSBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0Jyk7CiAgICB9CgogICAgdmFsdWUgPSB2YWx1ZSB8fCBfdGhpcy5nZXREZWZhdWx0KCk7IC8vIGNvcHkgcGFzc2VkIHN0YXRlIHZhbHVlcyBhbmQgY3JlYXRlIGludGVybmFsIHRyYWNrZXJzCgogICAgX3RoaXMuc2V0KHZhbHVlKTsKCiAgICBfdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlOyAvLyB1c2VkIHRvIHRyYWNrIHN0YXRlIGNoYW5nZXMKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGVyc2lzdGVkU3RhdGUsIFt7CiAgICBrZXk6ICJnZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldChrZXksIGRlZmF1bHRWYWx1ZSkgewogICAgICAvLyBubyBwYXRoIGFuZCBubyBrZXksIGdldCB0aGUgd2hvbGUgc3RhdGUKICAgICAgaWYgKCF0aGlzLmhhc1BhdGgoKSAmJiBrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLl9tZXJnZWRTdGF0ZTsKICAgICAgfQoKICAgICAgcmV0dXJuICgwLCBfbG9kYXNoLmNsb25lRGVlcCkoKDAsIF9sb2Rhc2guZ2V0KSh0aGlzLl9tZXJnZWRTdGF0ZSwgdGhpcy5nZXRJbmRleChrZXkgfHwgJycpLCBkZWZhdWx0VmFsdWUpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7CiAgICAgIHZhciBwYXJhbXMgPSBwcmVwU2V0UGFyYW1zKGtleSwgdmFsdWUsIHRoaXMuX3BhdGgpOwogICAgICB2YXIgdmFsID0gdGhpcy5zZXRWYWx1ZShwYXJhbXMua2V5LCBwYXJhbXMudmFsdWUpOwogICAgICB0aGlzLmVtaXQoJ3NldCcpOwogICAgICByZXR1cm4gdmFsOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFNpbGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2lsZW50KGtleSwgdmFsdWUpIHsKICAgICAgdmFyIHBhcmFtcyA9IHByZXBTZXRQYXJhbXMoa2V5LCB2YWx1ZSwgdGhpcy5fcGF0aCk7CgogICAgICBpZiAocGFyYW1zLmtleSB8fCBwYXJhbXMudmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZXRWYWx1ZShwYXJhbXMua2V5LCBwYXJhbXMudmFsdWUsIHRydWUpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xlYXJBbGxLZXlzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhckFsbEtleXMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcy5fY2hhbmdlZFN0YXRlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfdGhpczIuc2V0KGtleSwgbnVsbCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlc2V0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZXNldChwYXRoKSB7CiAgICAgIHZhciBrZXlQYXRoID0gdGhpcy5nZXRJbmRleChwYXRoKTsKICAgICAgdmFyIG9yaWdWYWx1ZSA9ICgwLCBfbG9kYXNoLmdldCkodGhpcy5fZGVmYXVsdFN0YXRlLCBrZXlQYXRoKTsKICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICgwLCBfbG9kYXNoLmdldCkodGhpcy5fbWVyZ2VkU3RhdGUsIGtleVBhdGgpOwoKICAgICAgaWYgKG9yaWdWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5jbGVhblBhdGgocGF0aCwgdGhpcy5fbWVyZ2VkU3RhdGUpOwogICAgICB9IGVsc2UgewogICAgICAgICgwLCBfbG9kYXNoLnNldCkodGhpcy5fbWVyZ2VkU3RhdGUsIGtleVBhdGgsIG9yaWdWYWx1ZSk7CiAgICAgIH0gLy8gY2xlYW4gdXAgdGhlIGNoYW5nZWRTdGF0ZSB0cmVlCgoKICAgICAgdGhpcy5jbGVhblBhdGgocGF0aCwgdGhpcy5fY2hhbmdlZFN0YXRlKTsKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKShjdXJyZW50VmFsdWUsIG9yaWdWYWx1ZSkpIHRoaXMuZW1pdCgnY2hhbmdlJyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2hhbmdlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2hhbmdlcygpIHsKICAgICAgcmV0dXJuICgwLCBfbG9kYXNoLmNsb25lRGVlcCkodGhpcy5fY2hhbmdlZFN0YXRlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0b0pTT04iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAidG9TdHJpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy50b0pTT04oKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZnJvbVN0cmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZnJvbVN0cmluZyhpbnB1dCkgewogICAgICByZXR1cm4gdGhpcy5zZXQoSlNPTi5wYXJzZShpbnB1dCkpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZGV4IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleChrZXkpIHsKICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpcy5fcGF0aDsKICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5fcGF0aCB8fCBbXSksIF90b0NvbnN1bWFibGVBcnJheSgoMCwgX3RvUGF0aC5kZWZhdWx0KShrZXkpKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0UGFydGlhbEluZGV4IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRQYXJ0aWFsSW5kZXgoa2V5KSB7CiAgICAgIHZhciBrZXlQYXRoID0gdGhpcy5nZXRJbmRleChrZXkpOwogICAgICByZXR1cm4ga2V5UGF0aC5zbGljZSh0aGlzLl9wYXRoLmxlbmd0aCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2xlYW5QYXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjbGVhblBhdGgocGF0aCwgc3RhdGVUcmVlKSB7CiAgICAgIHZhciBwYXJ0aWFsUGF0aCA9IHRoaXMuZ2V0UGFydGlhbEluZGV4KHBhdGgpOwogICAgICB2YXIgcmVtb3ZlID0gdHJ1ZTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnRpYWxQYXRoKSkgewogICAgICAgIC8vIHJlY3Vyc2l2ZWx5IGRlbGV0ZSB2YWx1ZSB0cmVlLCB3aGVuIG5vIG90aGVyIGtleXMgZXhpc3QKICAgICAgICB3aGlsZSAocGFydGlhbFBhdGgubGVuZ3RoID4gMCkgewogICAgICAgICAgdmFyIGxhc3RLZXkgPSBwYXJ0aWFsUGF0aC5zcGxpY2UocGFydGlhbFBhdGgubGVuZ3RoIC0gMSwgMSlbMF07CiAgICAgICAgICB2YXIgc3RhdGVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLl9wYXRoKSwgW3BhcnRpYWxQYXRoXSk7CiAgICAgICAgICB2YXIgc3RhdGVWYWwgPSBzdGF0ZVBhdGgubGVuZ3RoID4gMCA/ICgwLCBfbG9kYXNoLmdldCkoc3RhdGVUcmVlLCBzdGF0ZVBhdGgpIDogc3RhdGVUcmVlOyAvLyBpZiBzdGF0ZVZhbCBpc24ndCBhbiBvYmplY3QsIGRvIG5vdGhpbmcKCiAgICAgICAgICBpZiAoISgwLCBfbG9kYXNoLmlzUGxhaW5PYmplY3QpKHN0YXRlVmFsKSkgcmV0dXJuOwogICAgICAgICAgaWYgKHJlbW92ZSkgZGVsZXRlIHN0YXRlVmFsW2xhc3RLZXldOwogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHN0YXRlVmFsKS5sZW5ndGggPiAwKSByZW1vdmUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXREZWZhdWx0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREZWZhdWx0KCkgewogICAgICByZXR1cm4gdGhpcy5oYXNQYXRoKCkgPyB1bmRlZmluZWQgOiB7fTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRQYXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRQYXRoKHBhdGgpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF0aCkpIHsKICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgfQoKICAgICAgaWYgKCgwLCBfbG9kYXNoLmlzU3RyaW5nKShwYXRoKSkgewogICAgICAgIHJldHVybiBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5nZXRJbmRleChwYXRoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBbXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYXNQYXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNQYXRoKCkgewogICAgICByZXR1cm4gdGhpcy5fcGF0aC5sZW5ndGggPiAwOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShrZXksIHZhbHVlKSB7CiAgICAgIHZhciBzaWxlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBzdGF0ZUNoYW5nZWQgPSBmYWxzZTsKICAgICAgdmFyIGluaXRpYWxTdGF0ZSA9ICF0aGlzLl9pbml0aWFsaXplZDsKICAgICAgdmFyIGtleVBhdGggPSB0aGlzLmdldEluZGV4KGtleSk7CiAgICAgIHZhciBoYXNLZXlQYXRoID0ga2V5UGF0aC5sZW5ndGggPiAwOyAvLyBpZiB0aGlzIGlzIHRoZSBpbml0aWFsIHN0YXRlIHZhbHVlLCBzYXZlIHZhbHVlIGFzIHRoZSBkZWZhdWx0CgogICAgICBpZiAoaW5pdGlhbFN0YXRlKSB7CiAgICAgICAgdGhpcy5fY2hhbmdlZFN0YXRlID0ge307CiAgICAgICAgaWYgKCF0aGlzLmhhc1BhdGgoKSAmJiBrZXkgPT09IHVuZGVmaW5lZCkgdGhpcy5fZGVmYXVsdFN0YXRlID0gdmFsdWU7ZWxzZSB0aGlzLl9kZWZhdWx0U3RhdGUgPSAoMCwgX2xvZGFzaC5zZXQpKHt9LCBrZXlQYXRoLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGlmICghaW5pdGlhbFN0YXRlKSB7CiAgICAgICAgLy8gbm8gcGF0aCBhbmQgbm8ga2V5LCBzZXQgdGhlIHdob2xlIHN0YXRlCiAgICAgICAgaWYgKCF0aGlzLmhhc1BhdGgoKSAmJiBrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLy8gY29tcGFyZSBjaGFuZ2VkU3RhdGUgYW5kIG5ldyBzdGF0ZSwgZW1pdCBhbiBldmVudCB3aGVuIGRpZmZlcmVudAogICAgICAgICAgc3RhdGVDaGFuZ2VkID0gISgwLCBfbG9kYXNoLmlzRXF1YWwpKHRoaXMuX2NoYW5nZWRTdGF0ZSwgdmFsdWUpOwogICAgICAgICAgdGhpcy5fY2hhbmdlZFN0YXRlID0gdmFsdWU7CiAgICAgICAgICB0aGlzLl9tZXJnZWRTdGF0ZSA9ICgwLCBfbG9kYXNoLmNsb25lRGVlcCkodmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBjaGVjayBmb3IgY2hhbmdlcyBhdCBwYXRoLCBlbWl0IGFuIGV2ZW50IHdoZW4gZGlmZmVyZW50CiAgICAgICAgICB2YXIgY3VyVmFsID0gaGFzS2V5UGF0aCA/IHRoaXMuZ2V0KGtleVBhdGgpIDogdGhpcy5fbWVyZ2VkU3RhdGU7CiAgICAgICAgICBzdGF0ZUNoYW5nZWQgPSAhKDAsIF9sb2Rhc2guaXNFcXVhbCkoY3VyVmFsLCB2YWx1ZSk7IC8vIGFycmF5cyBhcmUgbWVyZ2UgYnkgaW5kZXgsIG5vdCBkZXNpcmVkIC0gZW5zdXJlIHRoZXkgYXJlIHJlcGxhY2VkCgogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoKDAsIF9sb2Rhc2guZ2V0KSh0aGlzLl9tZXJnZWRTdGF0ZSwga2V5UGF0aCkpKSB7CiAgICAgICAgICAgIGlmIChoYXNLZXlQYXRoKSB7CiAgICAgICAgICAgICAgKDAsIF9sb2Rhc2guc2V0KSh0aGlzLl9tZXJnZWRTdGF0ZSwga2V5UGF0aCwgdW5kZWZpbmVkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLl9tZXJnZWRTdGF0ZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoYXNLZXlQYXRoKSB7CiAgICAgICAgICAgICgwLCBfbG9kYXNoLnNldCkodGhpcy5fY2hhbmdlZFN0YXRlLCBrZXlQYXRoLCB2YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLl9jaGFuZ2VkU3RhdGUgPSAoMCwgX2xvZGFzaC5pc1BsYWluT2JqZWN0KSh2YWx1ZSkgPyB2YWx1ZSA6IHt9OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyB1cGRhdGUgdGhlIG1lcmdlZCBzdGF0ZSB2YWx1ZQoKCiAgICAgIHZhciB0YXJnZXRPYmogPSB0aGlzLl9tZXJnZWRTdGF0ZSB8fCAoMCwgX2xvZGFzaC5jbG9uZURlZXApKHRoaXMuX2RlZmF1bHRTdGF0ZSk7CiAgICAgIHZhciBzb3VyY2VPYmogPSAoMCwgX2xvZGFzaC5tZXJnZSkoe30sIHRoaXMuX2NoYW5nZWRTdGF0ZSk7IC8vIGhhbmRsZXIgYXJndW1lbnRzIGFyZSAodGFyZ2V0VmFsdWUsIHNvdXJjZVZhbHVlLCBrZXksIHRhcmdldCwgc291cmNlKQoKICAgICAgdmFyIG1lcmdlTWV0aG9kID0gZnVuY3Rpb24gbWVyZ2VNZXRob2QodGFyZ2V0VmFsdWUsIHNvdXJjZVZhbHVlLCBtZXJnZUtleSkgewogICAgICAgIC8vIGlmIG5vdCBpbml0aWFsIHN0YXRlLCBza2lwIGRlZmF1bHQgbWVyZ2UgbWV0aG9kIChpZS4gcmV0dXJuIHZhbHVlLCBzZWUgbm90ZSBiZWxvdykKICAgICAgICBpZiAoIWluaXRpYWxTdGF0ZSAmJiAoMCwgX2xvZGFzaC5pc0VxdWFsKShrZXlQYXRoLCBzZWxmLmdldEluZGV4KG1lcmdlS2V5KSkpIHsKICAgICAgICAgIC8vIHVzZSB0aGUgc291cmNlVmFsdWUgb3IgZmFsbCBiYWNrIHRvIHRhcmdldFZhbHVlCiAgICAgICAgICByZXR1cm4gc291cmNlVmFsdWUgPT09IHVuZGVmaW5lZCA/IHRhcmdldFZhbHVlIDogc291cmNlVmFsdWU7CiAgICAgICAgfQogICAgICB9OyAvLyBJZiBgbWVyZ2VNZXRob2RgIGlzIHByb3ZpZGVkIGl0IGlzIGludm9rZWQgdG8gcHJvZHVjZSB0aGUgbWVyZ2VkIHZhbHVlcyBvZiB0aGUKICAgICAgLy8gZGVzdGluYXRpb24gYW5kIHNvdXJjZSBwcm9wZXJ0aWVzLgogICAgICAvLyBJZiBgbWVyZ2VNZXRob2RgIHJldHVybnMgYHVuZGVmaW5lZGAgdGhlIGRlZmF1bHQgbWVyZ2luZyBtZXRob2QgaXMgdXNlZAoKCiAgICAgIHRoaXMuX21lcmdlZFN0YXRlID0gKDAsIF9sb2Rhc2gubWVyZ2UpKHRhcmdldE9iaiwgc291cmNlT2JqLCBtZXJnZU1ldGhvZCk7IC8vIHNhbml0eSBjaGVjazsgdmVyaWZ5IHRoYXQgdGhlcmUgYXJlIGFjdHVhbGx5IGNoYW5nZXMKCiAgICAgIGlmICgoMCwgX2xvZGFzaC5pc0VxdWFsKSh0aGlzLl9tZXJnZWRTdGF0ZSwgdGhpcy5fZGVmYXVsdFN0YXRlKSkgdGhpcy5fY2hhbmdlZFN0YXRlID0ge307CiAgICAgIGlmICghc2lsZW50ICYmIHN0YXRlQ2hhbmdlZCkgdGhpcy5lbWl0KCdjaGFuZ2UnLCBrZXkpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICB9XSk7CgogIHJldHVybiBQZXJzaXN0ZWRTdGF0ZTsKfShfZXZlbnRzLkV2ZW50RW1pdHRlcik7CgpleHBvcnRzLlBlcnNpc3RlZFN0YXRlID0gUGVyc2lzdGVkU3RhdGU7"},null]}