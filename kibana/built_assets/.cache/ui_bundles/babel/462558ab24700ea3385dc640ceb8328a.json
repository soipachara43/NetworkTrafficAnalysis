{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/visualizations/public/np_ready/public/embeddable/visualize_embeddable.js","dependencies":[{"path":"src/legacy/core_plugins/visualizations/public/np_ready/public/embeddable/visualize_embeddable.js","mtime":1589249550166},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuVmlzdWFsaXplRW1iZWRkYWJsZSA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIFJ4ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicnhqcyIpKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi9jb25zdGFudHMiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9kYXRhL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9lbWJlZGRhYmxlL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9raWJhbmFfdXRpbHMvcHVibGljIik7Cgp2YXIgX2J1aWxkX3BpcGVsaW5lID0gcmVxdWlyZSgiLi4vbGVnYWN5L2J1aWxkX3BpcGVsaW5lIik7Cgp2YXIgX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vc2VydmljZXMiKTsKCnZhciBfZXZlbnRzID0gcmVxdWlyZSgiLi9ldmVudHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICB9IGVsc2UgewogICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICAgIGlmICghYmFzZSkgcmV0dXJuOwogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKICAgICAgaWYgKGRlc2MuZ2V0KSB7CiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOwogICAgICB9CgogICAgICByZXR1cm4gZGVzYy52YWx1ZTsKICAgIH07CiAgfQoKICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwp9CgpmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7CiAgfQoKICByZXR1cm4gb2JqZWN0Owp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBnZXRLZXlzID0gZnVuY3Rpb24gZ2V0S2V5cyhvKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG8pOwp9OwoKdmFyIFZpc3VhbGl6ZUVtYmVkZGFibGUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfRW1iZWRkYWJsZSkgewogIF9pbmhlcml0cyhWaXN1YWxpemVFbWJlZGRhYmxlLCBfRW1iZWRkYWJsZSk7CgogIGZ1bmN0aW9uIFZpc3VhbGl6ZUVtYmVkZGFibGUodGltZWZpbHRlciwgX3JlZiwgaW5pdGlhbElucHV0LCBwYXJlbnQpIHsKICAgIHZhciBfdGhpczsKCiAgICB2YXIgdmlzID0gX3JlZi52aXMsCiAgICAgICAgZWRpdFVybCA9IF9yZWYuZWRpdFVybCwKICAgICAgICBpbmRleFBhdHRlcm5zID0gX3JlZi5pbmRleFBhdHRlcm5zLAogICAgICAgIGVkaXRhYmxlID0gX3JlZi5lZGl0YWJsZTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgVmlzdWFsaXplRW1iZWRkYWJsZSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoVmlzdWFsaXplRW1iZWRkYWJsZSkuY2FsbCh0aGlzLCBpbml0aWFsSW5wdXQsIHsKICAgICAgZGVmYXVsdFRpdGxlOiB2aXMudGl0bGUsCiAgICAgIGVkaXRVcmw6IGVkaXRVcmwsCiAgICAgIGluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybnMsCiAgICAgIGVkaXRhYmxlOiBlZGl0YWJsZSwKICAgICAgdmlzVHlwZU5hbWU6IHZpcy50eXBlLm5hbWUKICAgIH0sIHBhcmVudCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZXIiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRpbWVmaWx0ZXIiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRpbWVSYW5nZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicXVlcnkiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRpdGxlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmaWx0ZXJzIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ2aXNDdXN0b21pemF0aW9ucyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic3Vic2NyaXB0aW9ucyIsIFtdKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJleHByZXNzaW9uIiwgJycpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInZpcyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZG9tTm9kZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidHlwZSIsIF9jb25zdGFudHMuVklTVUFMSVpFX0VNQkVEREFCTEVfVFlQRSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbiIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiYWJvcnRDb250cm9sbGVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRJbnNwZWN0b3JBZGFwdGVycyIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFfdGhpcy5oYW5kbGVyKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQoKICAgICAgcmV0dXJuIF90aGlzLmhhbmRsZXIuaW5zcGVjdCgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib3Blbkluc3BlY3RvciIsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKF90aGlzLmhhbmRsZXIpIHsKICAgICAgICByZXR1cm4gX3RoaXMuaGFuZGxlci5vcGVuSW5zcGVjdG9yKF90aGlzLmdldFRpdGxlKCkgfHwgJycpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJoYXNJbnNwZWN0b3IiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2aXNUeXBlc1dpdGhvdXRJbnNwZWN0b3IgPSBbJ21hcmtkb3duJywgJ2lucHV0X2NvbnRyb2xfdmlzJywgJ21ldHJpY3MnLCAndmVnYScsICd0aW1lbGlvbiddOwoKICAgICAgaWYgKHZpc1R5cGVzV2l0aG91dEluc3BlY3Rvci5pbmNsdWRlcyhfdGhpcy52aXMudHlwZS5uYW1lKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIF90aGlzLmdldEluc3BlY3RvckFkYXB0ZXJzKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZWxvYWQiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmhhbmRsZVZpc1VwZGF0ZSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGFuZGxlVmlzVXBkYXRlIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF90aGlzLnVwZGF0ZUhhbmRsZXIoKTsKCiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInVpU3RhdGVDaGFuZ2VIYW5kbGVyIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy51cGRhdGVJbnB1dChfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy52aXMudWlTdGF0ZS50b0pTT04oKSkpOwogICAgfSk7CgogICAgX3RoaXMudGltZWZpbHRlciA9IHRpbWVmaWx0ZXI7CiAgICBfdGhpcy52aXMgPSB2aXM7CgogICAgX3RoaXMudmlzLnVpU3RhdGUub24oJ2NoYW5nZScsIF90aGlzLnVpU3RhdGVDaGFuZ2VIYW5kbGVyKTsKCiAgICBfdGhpcy5hdXRvUmVmcmVzaEZldGNoU3Vic2NyaXB0aW9uID0gdGltZWZpbHRlci5nZXRBdXRvUmVmcmVzaEZldGNoJCgpLnN1YnNjcmliZShfdGhpcy51cGRhdGVIYW5kbGVyLmJpbmQoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcykpKTsKCiAgICBfdGhpcy5zdWJzY3JpcHRpb25zLnB1c2goUngubWVyZ2UoX3RoaXMuZ2V0T3V0cHV0JCgpLCBfdGhpcy5nZXRJbnB1dCQoKSkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuaGFuZGxlQ2hhbmdlcygpOwogICAgfSkpOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhWaXN1YWxpemVFbWJlZGRhYmxlLCBbewogICAga2V5OiAiZ2V0VmlzdWFsaXphdGlvbkRlc2NyaXB0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRWaXN1YWxpemF0aW9uRGVzY3JpcHRpb24oKSB7CiAgICAgIHJldHVybiB0aGlzLnZpcy5kZXNjcmlwdGlvbjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJ0cmFuc2ZlckN1c3RvbWl6YXRpb25zVG9VaVN0YXRlIiwKCiAgICAvKioKICAgICAqIFRyYW5zZmVycyBhbGwgY2hhbmdlcyBpbiB0aGUgY29udGFpbmVyU3RhdGUuY3VzdG9taXphdGlvbiBpbnRvCiAgICAgKiB0aGUgdWlTdGF0ZSBvZiB0aGlzIHZpc3VhbGl6YXRpb24uCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiB0cmFuc2ZlckN1c3RvbWl6YXRpb25zVG9VaVN0YXRlKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgdGhhdCBuZWVkIHRvIGJlIGZvcndhcmRlZCB0byB0aGUgdWlTdGF0ZQogICAgICAvLyBTaW5jZSB0aGUgdmlzIGhhcyBhbiBvd24gbGlzdGVuZXIgb24gdGhlIHVpU3RhdGUgd2UgZG9uJ3QgbmVlZCB0bwogICAgICAvLyBwYXNzIGFueXRoaW5nIGZyb20gaGVyZSB0byB0aGUgaGFuZGxlci51cGRhdGUgbWV0aG9kCgoKICAgICAgdmFyIHZpc0N1c3RvbWl6YXRpb25zID0gdGhpcy5pbnB1dC52aXM7CgogICAgICBpZiAodmlzQ3VzdG9taXphdGlvbnMpIHsKICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHZpc0N1c3RvbWl6YXRpb25zLCB0aGlzLnZpc0N1c3RvbWl6YXRpb25zKSkgewogICAgICAgICAgdGhpcy52aXNDdXN0b21pemF0aW9ucyA9IHZpc0N1c3RvbWl6YXRpb25zOyAvLyBUdXJuIHRoaXMgb2ZmIG9yIHRoZSB1aVN0YXRlQ2hhbmdlSGFuZGxlciB3aWxsIGZpcmUgZm9yIGV2ZXJ5IG1vZGlmaWNhdGlvbi4KCiAgICAgICAgICB0aGlzLnZpcy51aVN0YXRlLm9mZignY2hhbmdlJywgdGhpcy51aVN0YXRlQ2hhbmdlSGFuZGxlcik7CiAgICAgICAgICB0aGlzLnZpcy51aVN0YXRlLmNsZWFyQWxsS2V5cygpOwogICAgICAgICAgdGhpcy52aXMudWlTdGF0ZS5zZXQoJ3ZpcycsIHZpc0N1c3RvbWl6YXRpb25zKTsKICAgICAgICAgIGdldEtleXModmlzQ3VzdG9taXphdGlvbnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICBfdGhpczIudmlzLnVpU3RhdGUuc2V0KGtleSwgdmlzQ3VzdG9taXphdGlvbnNba2V5XSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMudmlzLnVpU3RhdGUub24oJ2NoYW5nZScsIHRoaXMudWlTdGF0ZUNoYW5nZUhhbmRsZXIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLnBhcmVudCkgewogICAgICAgIHRoaXMudmlzLnVpU3RhdGUuY2xlYXJBbGxLZXlzKCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJoYW5kbGVDaGFuZ2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaGFuZGxlQ2hhbmdlcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBkaXJ0eTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy50cmFuc2ZlckN1c3RvbWl6YXRpb25zVG9VaVN0YXRlKCk7CiAgICAgICAgICAgICAgICBkaXJ0eSA9IGZhbHNlOyAvLyBDaGVjayBpZiB0aW1lcmFuZ2UgaGFzIGNoYW5nZWQKCiAgICAgICAgICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMuaW5wdXQudGltZVJhbmdlLCB0aGlzLnRpbWVSYW5nZSkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy50aW1lUmFuZ2UgPSBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKHRoaXMuaW5wdXQudGltZVJhbmdlKTsKICAgICAgICAgICAgICAgICAgZGlydHkgPSB0cnVlOwogICAgICAgICAgICAgICAgfSAvLyBDaGVjayBpZiBmaWx0ZXJzIGhhcyBjaGFuZ2VkCgoKICAgICAgICAgICAgICAgIGlmICghX3B1YmxpYy5lc0ZpbHRlcnMub25seURpc2FibGVkRmlsdGVyc0NoYW5nZWQodGhpcy5pbnB1dC5maWx0ZXJzLCB0aGlzLmZpbHRlcnMpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZmlsdGVycyA9IHRoaXMuaW5wdXQuZmlsdGVyczsKICAgICAgICAgICAgICAgICAgZGlydHkgPSB0cnVlOwogICAgICAgICAgICAgICAgfSAvLyBDaGVjayBpZiBxdWVyeSBoYXMgY2hhbmdlZAoKCiAgICAgICAgICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMuaW5wdXQucXVlcnksIHRoaXMucXVlcnkpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucXVlcnkgPSB0aGlzLmlucHV0LnF1ZXJ5OwogICAgICAgICAgICAgICAgICBkaXJ0eSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMub3V0cHV0LnRpdGxlICE9PSB0aGlzLnRpdGxlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLm91dHB1dC50aXRsZTsKCiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbU5vZGUpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmRvbU5vZGUuc2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJywgdGhpcy50aXRsZSB8fCAnJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy52aXMuZGVzY3JpcHRpb24gJiYgdGhpcy5kb21Ob2RlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZG9tTm9kZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZGVzY3JpcHRpb24nLCB0aGlzLnZpcy5kZXNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFuZGxlciAmJiBkaXJ0eSkgewogICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhhbmRsZXIoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gaGFuZGxlQ2hhbmdlcygpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZUNoYW5nZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhbmRsZUNoYW5nZXM7CiAgICB9KCkgLy8gdGhpcyBpcyBhIGhhY2sgdG8gbWFrZSBlZGl0b3Igc3RpbGwgd29yaywgd2lsbCBiZSByZW1vdmVkIG9uY2Ugd2UgY2xlYW4gdXAgZWRpdG9yCiAgICAvLyBAdHMtaWdub3JlCgogIH0sIHsKICAgIGtleTogInJlbmRlciIsCgogICAgLyoqCiAgICAgKgogICAgICogQHBhcmFtIHtFbGVtZW50fSBkb21Ob2RlCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVuZGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoZG9tTm9kZSkgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgZGl2LCBleHByZXNzaW9uczsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy50aW1lUmFuZ2UgPSBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKHRoaXMuaW5wdXQudGltZVJhbmdlKTsKICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmZXJDdXN0b21pemF0aW9uc1RvVWlTdGF0ZSgpOwogICAgICAgICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBkaXYuY2xhc3NOYW1lID0gInZpc3VhbGl6ZSBwYW5lbC1jb250ZW50IHBhbmVsLWNvbnRlbnQtLWZ1bGxXaWR0aCI7CiAgICAgICAgICAgICAgICBkb21Ob2RlLmFwcGVuZENoaWxkKGRpdik7CiAgICAgICAgICAgICAgICB0aGlzLmRvbU5vZGUgPSBkaXY7CiAgICAgICAgICAgICAgICBleHByZXNzaW9ucyA9ICgwLCBfc2VydmljZXMuZ2V0RXhwcmVzc2lvbnMpKCk7CiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXIgPSBuZXcgZXhwcmVzc2lvbnMuRXhwcmVzc2lvbkxvYWRlcih0aGlzLmRvbU5vZGUpOwogICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5oYW5kbGVyLmV2ZW50cyQuc3Vic2NyaWJlKAogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhldmVudCkgewogICAgICAgICAgICAgICAgICAgIHZhciBhZ2csIHRyaWdnZXJJZCwgY29udGV4dDsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZXZlbnQubmFtZSA9PT0gJ2JvdW5kcycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWdnID0gX3RoaXMzLnZpcy5kYXRhLmFnZ3MuYWdncy5maW5kKGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2xvZGFzaC5nZXQpKGEsICd0eXBlLmRzbE5hbWUnKSA9PT0gJ2dlb2hhc2hfZ3JpZCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWdnICYmIGFnZy5wYXJhbXMucHJlY2lzaW9uICE9PSBldmVudC5kYXRhLnByZWNpc2lvbiB8fCBhZ2cgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGFnZy5wYXJhbXMuYm91bmRpbmdCb3gsIGV2ZW50LmRhdGEuYm91bmRpbmdCb3gpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFnZy5wYXJhbXMuYm91bmRpbmdCb3ggPSBldmVudC5kYXRhLmJvdW5kaW5nQm94OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZ2cucGFyYW1zLnByZWNpc2lvbiA9IGV2ZW50LmRhdGEucHJlY2lzaW9uOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfdGhpczMuaW5wdXQuZGlzYWJsZVRyaWdnZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJJZCA9IGV2ZW50Lm5hbWUgPT09ICdicnVzaCcgPyBfZXZlbnRzLlZJU19FVkVOVF9UT19UUklHR0VSLmJydXNoIDogX2V2ZW50cy5WSVNfRVZFTlRfVE9fVFJJR0dFUi5maWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1iZWRkYWJsZTogX3RoaXMzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVGaWVsZE5hbWU6IF90aGlzMy52aXMuZGF0YS5pbmRleFBhdHRlcm4udGltZUZpZWxkTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBldmVudC5kYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgwLCBfc2VydmljZXMuZ2V0VWlBY3Rpb25zKSgpLmdldFRyaWdnZXIodHJpZ2dlcklkKS5leGVjKGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKSk7CiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJywgdGhpcy5vdXRwdXQudGl0bGUgfHwgJycpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpcy5kZXNjcmlwdGlvbikgewogICAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLWRlc2NyaXB0aW9uJywgdGhpcy52aXMuZGVzY3JpcHRpb24pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGVzdC1zdWJqJywgJ3Zpc3VhbGl6YXRpb25Mb2FkZXInKTsKICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtc2hhcmVkLWl0ZW0nLCAnJyk7CiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXJlbmRlcmluZy1jb3VudCcsICcwJyk7CiAgICAgICAgICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdkYXRhLXJlbmRlci1jb21wbGV0ZScsICdmYWxzZScpOwogICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zLnB1c2godGhpcy5oYW5kbGVyLmxvYWRpbmckLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcmVuZGVyLWNvbXBsZXRlJywgJ2ZhbHNlJyk7CiAgICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtbG9hZGluZycsICcnKTsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKHRoaXMuaGFuZGxlci5yZW5kZXIkLnN1YnNjcmliZShmdW5jdGlvbiAoY291bnQpIHsKICAgICAgICAgICAgICAgICAgZGl2LnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS1sb2FkaW5nJyk7CiAgICAgICAgICAgICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcmVuZGVyLWNvbXBsZXRlJywgJ3RydWUnKTsKICAgICAgICAgICAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1yZW5kZXJpbmctY291bnQnLCBjb3VudC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgKDAsIF9wdWJsaWMzLmRpc3BhdGNoUmVuZGVyQ29tcGxldGUpKGRpdik7CiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUhhbmRsZXIoKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHJlbmRlcihfeCkgewogICAgICAgIHJldHVybiBfcmVuZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW5kZXI7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihWaXN1YWxpemVFbWJlZGRhYmxlLnByb3RvdHlwZSksICJkZXN0cm95IiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIHMudW5zdWJzY3JpYmUoKTsKICAgICAgfSk7CiAgICAgIHRoaXMudmlzLnVpU3RhdGUub2ZmKCdjaGFuZ2UnLCB0aGlzLnVpU3RhdGVDaGFuZ2VIYW5kbGVyKTsKCiAgICAgIGlmICh0aGlzLmhhbmRsZXIpIHsKICAgICAgICB0aGlzLmhhbmRsZXIuZGVzdHJveSgpOwogICAgICAgIHRoaXMuaGFuZGxlci5nZXRFbGVtZW50KCkucmVtb3ZlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZUhhbmRsZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF91cGRhdGVIYW5kbGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgICAgdmFyIGV4cHJlc3Npb25QYXJhbXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGV4cHJlc3Npb25QYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgIHNlYXJjaENvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgICB0aW1lUmFuZ2U6IHRoaXMudGltZVJhbmdlLAogICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLmlucHV0LnF1ZXJ5LAogICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHRoaXMuaW5wdXQuZmlsdGVycwogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICB1aVN0YXRlOiB0aGlzLnZpcy51aVN0YXRlCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFib3J0Q29udHJvbGxlcikgewogICAgICAgICAgICAgICAgICB0aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYnVpbGRfcGlwZWxpbmUuYnVpbGRQaXBlbGluZSkodGhpcy52aXMsIHsKICAgICAgICAgICAgICAgICAgdGltZWZpbHRlcjogdGhpcy50aW1lZmlsdGVyLAogICAgICAgICAgICAgICAgICB0aW1lUmFuZ2U6IHRoaXMudGltZVJhbmdlLAogICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogdGhpcy5hYm9ydENvbnRyb2xsZXIuc2lnbmFsCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgdGhpcy5leHByZXNzaW9uID0gX2NvbnRleHQ1LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaGFuZGxlcikgewogICAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZXIudXBkYXRlKHRoaXMuZXhwcmVzc2lvbiwgZXhwcmVzc2lvblBhcmFtcyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHVwZGF0ZUhhbmRsZXIoKSB7CiAgICAgICAgcmV0dXJuIF91cGRhdGVIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGRhdGVIYW5kbGVyOwogICAgfSgpCiAgfSwgewogICAga2V5OiAic3VwcG9ydGVkVHJpZ2dlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN1cHBvcnRlZFRyaWdnZXJzKCkgewogICAgICAvLyBUT0RPOiBSZXBvcnQgYSBjb3JyZWN0IGxpc3Qgb2YgdHJpZ2dlcnMgZm9yIGVhY2ggdmlzX3R5cGUuCiAgICAgIHN3aXRjaCAodGhpcy52aXMudHlwZS5uYW1lKSB7CiAgICAgICAgY2FzZSAnYXJlYSc6CiAgICAgICAgY2FzZSAnaGVhdG1hcCc6CiAgICAgICAgY2FzZSAnaGlzdG9ncmFtJzoKICAgICAgICBjYXNlICdob3Jpem9udGFsX2Jhcic6CiAgICAgICAgY2FzZSAnbGluZSc6CiAgICAgICAgY2FzZSAncGllJzoKICAgICAgICBjYXNlICd0YWJsZSc6CiAgICAgICAgY2FzZSAndGFnY2xvdWQnOgogICAgICAgICAgcmV0dXJuIFtfZXZlbnRzLlZJU19FVkVOVF9UT19UUklHR0VSLmZpbHRlcl07CgogICAgICAgIGNhc2UgJ2dhdWdlJzoKICAgICAgICBjYXNlICdnb2FsJzoKICAgICAgICBjYXNlICdpbnB1dF9jb250cm9sX3Zpcyc6CiAgICAgICAgY2FzZSAnbWFya2Rvd24nOgogICAgICAgIGNhc2UgJ21ldHJpYyc6CiAgICAgICAgY2FzZSAnbWV0cmljcyc6CiAgICAgICAgY2FzZSAncmVnaW9uX21hcCc6CiAgICAgICAgY2FzZSAndGlsZV9tYXAnOgogICAgICAgIGNhc2UgJ3RpbWVsaW9uJzoKICAgICAgICBjYXNlICd2ZWdhJzoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gVmlzdWFsaXplRW1iZWRkYWJsZTsKfShfcHVibGljMi5FbWJlZGRhYmxlKTsKCmV4cG9ydHMuVmlzdWFsaXplRW1iZWRkYWJsZSA9IFZpc3VhbGl6ZUVtYmVkZGFibGU7"},null]}