{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/discover/np_ready/angular/directives/histogram.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/discover/np_ready/angular/directives/histogram.js","mtime":1589249549690},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuZmluZE1pbkludGVydmFsID0gZmluZE1pbkludGVydmFsOwpleHBvcnRzLkRpc2NvdmVySGlzdG9ncmFtID0gdm9pZCAwOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfbW9tZW50VGltZXpvbmUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm1vbWVudC10aW1lem9uZSIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9ldWlfdGhlbWVfbGlnaHQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkBlbGFzdGljL2V1aS9kaXN0L2V1aV90aGVtZV9saWdodC5qc29uIikpOwoKdmFyIF9ldWlfdGhlbWVfZGFyayA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQGVsYXN0aWMvZXVpL2Rpc3QvZXVpX3RoZW1lX2RhcmsuanNvbiIpKTsKCnZhciBfY2hhcnRzID0gcmVxdWlyZSgiQGVsYXN0aWMvY2hhcnRzIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfa2liYW5hX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vLi4vLi4va2liYW5hX3NlcnZpY2VzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgIGRlZmF1bHQ6IG9iagogIH07Cn0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgX3R5cGVvZjIoU3ltYm9sLml0ZXJhdG9yKSA9PT0gInN5bWJvbCIpIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfSBlbHNlIHsKICAgIF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogICAgICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9CgogIHJldHVybiBfdHlwZW9mKG9iaik7Cn0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgewogIHJldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7CiAgdmFyIF9hcnIgPSBbXTsKICB2YXIgX24gPSB0cnVlOwogIHZhciBfZCA9IGZhbHNlOwogIHZhciBfZSA9IHVuZGVmaW5lZDsKCiAgdHJ5IHsKICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKICAgICAgX2Fyci5wdXNoKF9zLnZhbHVlKTsKCiAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKICAgIH0KICB9IGNhdGNoIChlcnIpIHsKICAgIF9kID0gdHJ1ZTsKICAgIF9lID0gZXJyOwogIH0gZmluYWxseSB7CiAgICB0cnkgewogICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChfZCkgdGhyb3cgX2U7CiAgICB9CiAgfQoKICByZXR1cm4gX2FycjsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gZmluZEludGVydmFsRnJvbUR1cmF0aW9uKGRhdGVWYWx1ZSwgZXNWYWx1ZSwgZXNVbml0LCB0aW1lWm9uZSkgewogIHZhciBkYXRlID0gX21vbWVudFRpbWV6b25lLmRlZmF1bHQudHooZGF0ZVZhbHVlLCB0aW1lWm9uZSk7CgogIHZhciBzdGFydE9mRGF0ZSA9IF9tb21lbnRUaW1lem9uZS5kZWZhdWx0LnR6KGRhdGUsIHRpbWVab25lKS5zdGFydE9mKGVzVW5pdCk7CgogIHZhciBlbmRPZkRhdGUgPSBfbW9tZW50VGltZXpvbmUuZGVmYXVsdC50eihkYXRlLCB0aW1lWm9uZSkuc3RhcnRPZihlc1VuaXQpLmFkZChlc1ZhbHVlLCBlc1VuaXQpOwoKICByZXR1cm4gZW5kT2ZEYXRlLnZhbHVlT2YoKSAtIHN0YXJ0T2ZEYXRlLnZhbHVlT2YoKTsKfQoKZnVuY3Rpb24gZ2V0SW50ZXJ2YWxJbk1zKHZhbHVlLCBlc1ZhbHVlLCBlc1VuaXQsIHRpbWVab25lKSB7CiAgc3dpdGNoIChlc1VuaXQpIHsKICAgIGNhc2UgJ3MnOgogICAgICByZXR1cm4gMTAwMCAqIGVzVmFsdWU7CgogICAgY2FzZSAnbXMnOgogICAgICByZXR1cm4gMSAqIGVzVmFsdWU7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGZpbmRJbnRlcnZhbEZyb21EdXJhdGlvbih2YWx1ZSwgZXNWYWx1ZSwgZXNVbml0LCB0aW1lWm9uZSk7CiAgfQp9CgpmdW5jdGlvbiBnZXRUaW1lem9uZSh1aVNldHRpbmdzKSB7CiAgaWYgKHVpU2V0dGluZ3MuaXNEZWZhdWx0KCdkYXRlRm9ybWF0OnR6JykpIHsKICAgIHZhciBkZXRlY3RlZFRpbWV6b25lID0gX21vbWVudFRpbWV6b25lLmRlZmF1bHQudHouZ3Vlc3MoKTsKCiAgICBpZiAoZGV0ZWN0ZWRUaW1lem9uZSkgcmV0dXJuIGRldGVjdGVkVGltZXpvbmU7ZWxzZSByZXR1cm4gKDAsIF9tb21lbnRUaW1lem9uZS5kZWZhdWx0KSgpLmZvcm1hdCgnWicpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdWlTZXR0aW5ncy5nZXQoJ2RhdGVGb3JtYXQ6dHonLCAnQnJvd3NlcicpOwogIH0KfQoKZnVuY3Rpb24gZmluZE1pbkludGVydmFsKHhWYWx1ZXMsIGVzVmFsdWUsIGVzVW5pdCwgdGltZVpvbmUpIHsKICByZXR1cm4geFZhbHVlcy5yZWR1Y2UoZnVuY3Rpb24gKG1pbkludGVydmFsLCBjdXJyZW50WHZhbHVlLCBpbmRleCkgewogICAgdmFyIGN1cnJlbnREaWZmID0gbWluSW50ZXJ2YWw7CgogICAgaWYgKGluZGV4ID4gMCkgewogICAgICBjdXJyZW50RGlmZiA9IE1hdGguYWJzKHhWYWx1ZXNbaW5kZXggLSAxXSAtIGN1cnJlbnRYdmFsdWUpOwogICAgfQoKICAgIHZhciBzaW5nbGVVbml0SW50ZXJ2YWwgPSBnZXRJbnRlcnZhbEluTXMoY3VycmVudFh2YWx1ZSwgZXNWYWx1ZSwgZXNVbml0LCB0aW1lWm9uZSk7CiAgICByZXR1cm4gTWF0aC5taW4obWluSW50ZXJ2YWwsIHNpbmdsZVVuaXRJbnRlcnZhbCwgY3VycmVudERpZmYpOwogIH0sIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKTsKfQoKdmFyIERpc2NvdmVySGlzdG9ncmFtID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhEaXNjb3Zlckhpc3RvZ3JhbSwgX0NvbXBvbmVudCk7CgogIGZ1bmN0aW9uIERpc2NvdmVySGlzdG9ncmFtKCkgewogICAgdmFyIF9nZXRQcm90b3R5cGVPZjI7CgogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEaXNjb3Zlckhpc3RvZ3JhbSk7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihEaXNjb3Zlckhpc3RvZ3JhbSkpLmNhbGwuYXBwbHkoX2dldFByb3RvdHlwZU9mMiwgW3RoaXNdLmNvbmNhdChhcmdzKSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInN1YnNjcmlwdGlvbiIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic3RhdGUiLCB7CiAgICAgIGNoYXJ0c1RoZW1lOiAoMCwgX2tpYmFuYV9zZXJ2aWNlcy5nZXRTZXJ2aWNlcykoKS50aGVtZS5jaGFydHNEZWZhdWx0VGhlbWUKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQnJ1c2hFbmQiLCBmdW5jdGlvbiAobWluLCBtYXgpIHsKICAgICAgdmFyIHJhbmdlID0gewogICAgICAgIGZyb206IG1pbiwKICAgICAgICB0bzogbWF4CiAgICAgIH07CgogICAgICBfdGhpcy5wcm9wcy50aW1lZmlsdGVyVXBkYXRlSGFuZGxlcihyYW5nZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkVsZW1lbnRDbGljayIsIGZ1bmN0aW9uICh4SW50ZXJ2YWwpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMSksCiAgICAgICAgICAgIGVsZW1lbnREYXRhID0gX3JlZjJbMF07CgogICAgICAgIHZhciBzdGFydFJhbmdlID0gZWxlbWVudERhdGFbMF0ueDsKICAgICAgICB2YXIgcmFuZ2UgPSB7CiAgICAgICAgICBmcm9tOiBzdGFydFJhbmdlLAogICAgICAgICAgdG86IHN0YXJ0UmFuZ2UgKyB4SW50ZXJ2YWwKICAgICAgICB9OwoKICAgICAgICBfdGhpcy5wcm9wcy50aW1lZmlsdGVyVXBkYXRlSGFuZGxlcihyYW5nZSk7CiAgICAgIH07CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmb3JtYXRYVmFsdWUiLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHZhciB4QXhpc0Zvcm1hdCA9IF90aGlzLnByb3BzLmNoYXJ0RGF0YS54QXhpc0Zvcm1hdC5wYXJhbXMucGF0dGVybjsKICAgICAgcmV0dXJuICgwLCBfbW9tZW50VGltZXpvbmUuZGVmYXVsdCkodmFsKS5mb3JtYXQoeEF4aXNGb3JtYXQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyQmFyVG9vbHRpcCIsIGZ1bmN0aW9uICh4SW50ZXJ2YWwsIGRvbWFpblN0YXJ0LCBkb21haW5FbmQpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChoZWFkZXJEYXRhKSB7CiAgICAgICAgdmFyIGhlYWRlckRhdGFWYWx1ZSA9IGhlYWRlckRhdGEudmFsdWU7CgogICAgICAgIHZhciBmb3JtYXR0ZWRWYWx1ZSA9IF90aGlzLmZvcm1hdFhWYWx1ZShoZWFkZXJEYXRhVmFsdWUpOwoKICAgICAgICB2YXIgcGFydGlhbERhdGFUZXh0ID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kaXNjb3Zlci5oaXN0b2dyYW0ucGFydGlhbERhdGEuYnVja2V0VG9vbHRpcFRleHQnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RoZSBzZWxlY3RlZCB0aW1lIHJhbmdlIGRvZXMgbm90IGluY2x1ZGUgdGhpcyBlbnRpcmUgYnVja2V0LCBpdCBtYXkgY29udGFpbiBwYXJ0aWFsIGRhdGEuJwogICAgICAgIH0pOwoKICAgICAgICBpZiAoaGVhZGVyRGF0YVZhbHVlIDwgZG9tYWluU3RhcnQgfHwgaGVhZGVyRGF0YVZhbHVlICsgeEludGVydmFsID4gZG9tYWluRW5kKSB7CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAgICBhbGlnbkl0ZW1zOiAiY2VudGVyIiwKICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHNjSGlzdG9ncmFtX19oZWFkZXItLXBhcnRpYWwiLAogICAgICAgICAgICByZXNwb25zaXZlOiBmYWxzZSwKICAgICAgICAgICAgZ3V0dGVyU2l6ZTogInhzIgogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgICAgICB0eXBlOiAiaUluQ2lyY2xlIgogICAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIG51bGwsIHBhcnRpYWxEYXRhVGV4dCkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICAgIHNpemU6ICJ4cyIKICAgICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgZm9ybWF0dGVkVmFsdWUpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmb3JtYXR0ZWRWYWx1ZTsKICAgICAgfTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhEaXNjb3Zlckhpc3RvZ3JhbSwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLnN1YnNjcmlwdGlvbiA9ICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldFNlcnZpY2VzKSgpLnRoZW1lLmNoYXJ0c1RoZW1lJC5zdWJzY3JpYmUoZnVuY3Rpb24gKGNoYXJ0c1RoZW1lKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5zZXRTdGF0ZSh7CiAgICAgICAgICBjaGFydHNUaGVtZTogY2hhcnRzVGhlbWUKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50V2lsbFVubW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudFdpbGxVbm1vdW50KCkgewogICAgICBpZiAodGhpcy5zdWJzY3JpcHRpb24pIHsKICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gdW5kZWZpbmVkOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciB1aVNldHRpbmdzID0gKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0U2VydmljZXMpKCkudWlTZXR0aW5nczsKICAgICAgdmFyIHRpbWVab25lID0gZ2V0VGltZXpvbmUodWlTZXR0aW5ncyk7CiAgICAgIHZhciBjaGFydERhdGEgPSB0aGlzLnByb3BzLmNoYXJ0RGF0YTsKICAgICAgdmFyIGNoYXJ0c1RoZW1lID0gdGhpcy5zdGF0ZS5jaGFydHNUaGVtZTsKCiAgICAgIGlmICghY2hhcnREYXRhIHx8ICFjaGFydERhdGEuc2VyaWVzWzBdKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gY2hhcnREYXRhLnNlcmllc1swXS52YWx1ZXM7CiAgICAgIC8qKgogICAgICAgKiBEZXByZWNhdGlvbjogW2ludGVydmFsXSBvbiBbZGF0ZV9oaXN0b2dyYW1dIGlzIGRlcHJlY2F0ZWQsIHVzZSBbZml4ZWRfaW50ZXJ2YWxdIG9yIFtjYWxlbmRhcl9pbnRlcnZhbF0uCiAgICAgICAqIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvaXNzdWVzLzI3NDEwCiAgICAgICAqIFRPRE86IE9uY2UgdGhlIERpc2NvdmVyIHF1ZXJ5IGhhcyBiZWVuIHVwZGF0ZSwgd2Ugc2hvdWxkIGNoYW5nZSB0aGUgYmVsb3cgdG8gdXNlIHRoZSBuZXcgZmllbGQKICAgICAgICovCgogICAgICB2YXIgX2NoYXJ0RGF0YSRvcmRlcmVkID0gY2hhcnREYXRhLm9yZGVyZWQsCiAgICAgICAgICBpbnRlcnZhbEVTVmFsdWUgPSBfY2hhcnREYXRhJG9yZGVyZWQuaW50ZXJ2YWxFU1ZhbHVlLAogICAgICAgICAgaW50ZXJ2YWxFU1VuaXQgPSBfY2hhcnREYXRhJG9yZGVyZWQuaW50ZXJ2YWxFU1VuaXQsCiAgICAgICAgICB4SW50ZXJ2YWwgPSBfY2hhcnREYXRhJG9yZGVyZWQuaW50ZXJ2YWw7CiAgICAgIHZhciB4VmFsdWVzID0gY2hhcnREYXRhLnhBeGlzT3JkZXJlZFZhbHVlczsKICAgICAgdmFyIGxhc3RYVmFsdWUgPSB4VmFsdWVzW3hWYWx1ZXMubGVuZ3RoIC0gMV07CiAgICAgIHZhciBkb21haW4gPSBjaGFydERhdGEub3JkZXJlZDsKICAgICAgdmFyIGRvbWFpblN0YXJ0ID0gZG9tYWluLm1pbi52YWx1ZU9mKCk7CiAgICAgIHZhciBkb21haW5FbmQgPSBkb21haW4ubWF4LnZhbHVlT2YoKTsKICAgICAgdmFyIGRvbWFpbk1pbiA9IGRhdGFbMF0ueCA+IGRvbWFpblN0YXJ0ID8gZG9tYWluU3RhcnQgOiBkYXRhWzBdLng7CiAgICAgIHZhciBkb21haW5NYXggPSBkb21haW5FbmQgLSB4SW50ZXJ2YWwgPiBsYXN0WFZhbHVlID8gZG9tYWluRW5kIC0geEludGVydmFsIDogbGFzdFhWYWx1ZTsKICAgICAgdmFyIHhEb21haW4gPSB7CiAgICAgICAgbWluOiBkb21haW5NaW4sCiAgICAgICAgbWF4OiBkb21haW5NYXgsCiAgICAgICAgbWluSW50ZXJ2YWw6IGZpbmRNaW5JbnRlcnZhbCh4VmFsdWVzLCBpbnRlcnZhbEVTVmFsdWUsIGludGVydmFsRVNVbml0LCB0aW1lWm9uZSkKICAgICAgfTsgLy8gRG9tYWluIGVuZCBvZiAnbm93JyB3aWxsIGJlIG1pbGxpc2Vjb25kcyBiZWhpbmQgY3VycmVudCB0aW1lLCBzbyB3ZSBleHRlbmQgdGltZSBieSAxIG1pbnV0ZSBhbmQgY2hlY2sgaWYKICAgICAgLy8gdGhlIGFubm90YXRpb24gaXMgd2l0aGluIHRoaXMgcmFuZ2U7IGlmIHNvLCB0aGUgbGluZSBhbm5vdGF0aW9uIHVzZXMgdGhlIGRvbWFpbkVuZCBhcyBpdHMgdmFsdWUKCiAgICAgIHZhciBub3cgPSAoMCwgX21vbWVudFRpbWV6b25lLmRlZmF1bHQpKCk7CiAgICAgIHZhciBpc0Fubm90YXRpb25BdEVkZ2UgPSAoMCwgX21vbWVudFRpbWV6b25lLmRlZmF1bHQpKGRvbWFpbkVuZCkuYWRkKDYwMDAwKS5pc0FmdGVyKG5vdykgJiYgbm93LmlzQWZ0ZXIoZG9tYWluRW5kKTsKICAgICAgdmFyIGxpbmVBbm5vdGF0aW9uVmFsdWUgPSBpc0Fubm90YXRpb25BdEVkZ2UgPyBkb21haW5FbmQgOiBub3c7CiAgICAgIHZhciBsaW5lQW5ub3RhdGlvbkRhdGEgPSBbewogICAgICAgIGRhdGFWYWx1ZTogbGluZUFubm90YXRpb25WYWx1ZQogICAgICB9XTsKICAgICAgdmFyIGlzRGFya01vZGUgPSB1aVNldHRpbmdzLmdldCgndGhlbWU6ZGFya01vZGUnKTsKICAgICAgdmFyIGxpbmVBbm5vdGF0aW9uU3R5bGUgPSB7CiAgICAgICAgbGluZTogewogICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsCiAgICAgICAgICBzdHJva2U6IGlzRGFya01vZGUgPyBfZXVpX3RoZW1lX2RhcmsuZGVmYXVsdC5ldWlDb2xvckRhbmdlciA6IF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvckRhbmdlciwKICAgICAgICAgIG9wYWNpdHk6IDAuNwogICAgICAgIH0KICAgICAgfTsKICAgICAgdmFyIHJlY3RBbm5vdGF0aW9ucyA9IFtdOwoKICAgICAgaWYgKGRvbWFpblN0YXJ0ICE9PSBkb21haW5NaW4pIHsKICAgICAgICByZWN0QW5ub3RhdGlvbnMucHVzaCh7CiAgICAgICAgICBjb29yZGluYXRlczogewogICAgICAgICAgICB4MTogZG9tYWluU3RhcnQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKGRvbWFpbkVuZCAhPT0gZG9tYWluTWF4KSB7CiAgICAgICAgcmVjdEFubm90YXRpb25zLnB1c2goewogICAgICAgICAgY29vcmRpbmF0ZXM6IHsKICAgICAgICAgICAgeDA6IGRvbWFpbkVuZAogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgcmVjdEFubm90YXRpb25TdHlsZSA9IHsKICAgICAgICBzdHJva2U6IGlzRGFya01vZGUgPyBfZXVpX3RoZW1lX2RhcmsuZGVmYXVsdC5ldWlDb2xvckxpZ2h0U2hhZGUgOiBfZXVpX3RoZW1lX2xpZ2h0LmRlZmF1bHQuZXVpQ29sb3JEYXJrU2hhZGUsCiAgICAgICAgc3Ryb2tlV2lkdGg6IDAsCiAgICAgICAgb3BhY2l0eTogaXNEYXJrTW9kZSA/IDAuNiA6IDAuMiwKICAgICAgICBmaWxsOiBpc0RhcmtNb2RlID8gX2V1aV90aGVtZV9kYXJrLmRlZmF1bHQuZXVpQ29sb3JMaWdodFNoYWRlIDogX2V1aV90aGVtZV9saWdodC5kZWZhdWx0LmV1aUNvbG9yRGFya1NoYWRlCiAgICAgIH07CiAgICAgIHZhciB0b29sdGlwUHJvcHMgPSB7CiAgICAgICAgaGVhZGVyRm9ybWF0dGVyOiB0aGlzLnJlbmRlckJhclRvb2x0aXAoeEludGVydmFsLCBkb21haW5TdGFydCwgZG9tYWluRW5kKSwKICAgICAgICB0eXBlOiBfY2hhcnRzLlRvb2x0aXBUeXBlLlZlcnRpY2FsQ3Vyc29yCiAgICAgIH07CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQ2hhcnQsIHsKICAgICAgICBzaXplOiAiMTAwJSIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY2hhcnRzLlNldHRpbmdzLCB7CiAgICAgICAgeERvbWFpbjogeERvbWFpbiwKICAgICAgICBvbkJydXNoRW5kOiB0aGlzLm9uQnJ1c2hFbmQsCiAgICAgICAgb25FbGVtZW50Q2xpY2s6IHRoaXMub25FbGVtZW50Q2xpY2soeEludGVydmFsKSwKICAgICAgICB0b29sdGlwOiB0b29sdGlwUHJvcHMsCiAgICAgICAgdGhlbWU6IGNoYXJ0c1RoZW1lCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQXhpcywgewogICAgICAgIGlkOiAiZGlzY292ZXItaGlzdG9ncmFtLWxlZnQtYXhpcyIsCiAgICAgICAgcG9zaXRpb246IF9jaGFydHMuUG9zaXRpb24uTGVmdCwKICAgICAgICB0aWNrczogNSwKICAgICAgICB0aXRsZTogY2hhcnREYXRhLnlBeGlzTGFiZWwKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NoYXJ0cy5BeGlzLCB7CiAgICAgICAgaWQ6ICJkaXNjb3Zlci1oaXN0b2dyYW0tYm90dG9tLWF4aXMiLAogICAgICAgIHBvc2l0aW9uOiBfY2hhcnRzLlBvc2l0aW9uLkJvdHRvbSwKICAgICAgICB0aXRsZTogY2hhcnREYXRhLnhBeGlzTGFiZWwsCiAgICAgICAgdGlja0Zvcm1hdDogdGhpcy5mb3JtYXRYVmFsdWUsCiAgICAgICAgdGlja3M6IDEwCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuTGluZUFubm90YXRpb24sIHsKICAgICAgICBpZDogImxpbmUtYW5ub3RhdGlvbiIsCiAgICAgICAgZG9tYWluVHlwZTogX2NoYXJ0cy5Bbm5vdGF0aW9uRG9tYWluVHlwZXMuWERvbWFpbiwKICAgICAgICBkYXRhVmFsdWVzOiBsaW5lQW5ub3RhdGlvbkRhdGEsCiAgICAgICAgaGlkZVRvb2x0aXBzOiB0cnVlLAogICAgICAgIHN0eWxlOiBsaW5lQW5ub3RhdGlvblN0eWxlCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuUmVjdEFubm90YXRpb24sIHsKICAgICAgICBkYXRhVmFsdWVzOiByZWN0QW5ub3RhdGlvbnMsCiAgICAgICAgaWQ6ICJyZWN0LWFubm90YXRpb24iLAogICAgICAgIHpJbmRleDogMiwKICAgICAgICBzdHlsZTogcmVjdEFubm90YXRpb25TdHlsZSwKICAgICAgICBoaWRlVG9vbHRpcHM6IHRydWUKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NoYXJ0cy5IaXN0b2dyYW1CYXJTZXJpZXMsIHsKICAgICAgICBpZDogImRpc2NvdmVyLWhpc3RvZ3JhbSIsCiAgICAgICAgeFNjYWxlVHlwZTogX2NoYXJ0cy5TY2FsZVR5cGUuVGltZSwKICAgICAgICB5U2NhbGVUeXBlOiBfY2hhcnRzLlNjYWxlVHlwZS5MaW5lYXIsCiAgICAgICAgeEFjY2Vzc29yOiAieCIsCiAgICAgICAgeUFjY2Vzc29yczogWyd5J10sCiAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICB0aW1lWm9uZTogdGltZVpvbmUsCiAgICAgICAgbmFtZTogY2hhcnREYXRhLnlBeGlzTGFiZWwKICAgICAgfSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIERpc2NvdmVySGlzdG9ncmFtOwp9KF9yZWFjdC5Db21wb25lbnQpOwoKZXhwb3J0cy5EaXNjb3Zlckhpc3RvZ3JhbSA9IERpc2NvdmVySGlzdG9ncmFtOwoKX2RlZmluZVByb3BlcnR5KERpc2NvdmVySGlzdG9ncmFtLCAicHJvcFR5cGVzIiwgewogIGNoYXJ0RGF0YTogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdCwKICB0aW1lZmlsdGVyVXBkYXRlSGFuZGxlcjogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMKfSk7"},null]}