{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/edit/index.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/edit/index.js","mtime":1589249553324},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkVkaXRSdWxlUGFnZSA9IHZvaWQgMDsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX3JlYWN0ID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX3JlYWN0MiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9yZWFjdFJvdXRlckRvbSA9IHJlcXVpcmUoInJlYWN0LXJvdXRlci1kb20iKTsKCnZhciBfcnVsZXMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb250YWluZXJzL2RldGVjdGlvbl9lbmdpbmUvcnVsZXMiKTsKCnZhciBfd3JhcHBlcl9wYWdlID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tcG9uZW50cy93cmFwcGVyX3BhZ2UiKTsKCnZhciBfcmVkaXJlY3RfdG9fZGV0ZWN0aW9uX2VuZ2luZSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbXBvbmVudHMvbGlua190by9yZWRpcmVjdF90b19kZXRlY3Rpb25fZW5naW5lIik7Cgp2YXIgX3RvYXN0ZXJzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tcG9uZW50cy90b2FzdGVycyIpOwoKdmFyIF9zcHlfcm91dGVzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vdXRpbHMvcm91dGUvc3B5X3JvdXRlcyIpOwoKdmFyIF91c2VyX2luZm8gPSByZXF1aXJlKCIuLi8uLi9jb21wb25lbnRzL3VzZXJfaW5mbyIpOwoKdmFyIF9kZXRlY3Rpb25fZW5naW5lX2hlYWRlcl9wYWdlID0gcmVxdWlyZSgiLi4vLi4vY29tcG9uZW50cy9kZXRlY3Rpb25fZW5naW5lX2hlYWRlcl9wYWdlIik7Cgp2YXIgX3N0ZXBfcGFuZWwgPSByZXF1aXJlKCIuLi9jb21wb25lbnRzL3N0ZXBfcGFuZWwiKTsKCnZhciBfc3RlcF9hYm91dF9ydWxlID0gcmVxdWlyZSgiLi4vY29tcG9uZW50cy9zdGVwX2Fib3V0X3J1bGUiKTsKCnZhciBfc3RlcF9kZWZpbmVfcnVsZSA9IHJlcXVpcmUoIi4uL2NvbXBvbmVudHMvc3RlcF9kZWZpbmVfcnVsZSIpOwoKdmFyIF9zdGVwX3NjaGVkdWxlX3J1bGUgPSByZXF1aXJlKCIuLi9jb21wb25lbnRzL3N0ZXBfc2NoZWR1bGVfcnVsZSIpOwoKdmFyIF9zdGVwX3J1bGVfYWN0aW9ucyA9IHJlcXVpcmUoIi4uL2NvbXBvbmVudHMvc3RlcF9ydWxlX2FjdGlvbnMiKTsKCnZhciBfaGVscGVycyA9IHJlcXVpcmUoIi4uL2NyZWF0ZS9oZWxwZXJzIik7Cgp2YXIgX2hlbHBlcnMyID0gcmVxdWlyZSgiLi4vaGVscGVycyIpOwoKdmFyIHJ1bGVJMThuID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi4vdHJhbnNsYXRpb25zIikpOwoKdmFyIF90eXBlcyA9IHJlcXVpcmUoIi4uL3R5cGVzIik7Cgp2YXIgaTE4biA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIi4vdHJhbnNsYXRpb25zIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICB0cnkgewogICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVqZWN0KGVycm9yKTsKICAgIHJldHVybjsKICB9CgogIGlmIChpbmZvLmRvbmUpIHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0gZWxzZSB7CiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgfQp9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgfQoKICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9Cgp2YXIgRWRpdFJ1bGVQYWdlQ29tcG9uZW50ID0gZnVuY3Rpb24gRWRpdFJ1bGVQYWdlQ29tcG9uZW50KCkgewogIHZhciBfdXNlUmVmLCBfcmVmNDsKCiAgdmFyIF91c2VTdGF0ZVRvYXN0ZXIgPSAoMCwgX3RvYXN0ZXJzLnVzZVN0YXRlVG9hc3RlcikoKSwKICAgICAgX3VzZVN0YXRlVG9hc3RlcjIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGVUb2FzdGVyLCAyKSwKICAgICAgZGlzcGF0Y2hUb2FzdGVyID0gX3VzZVN0YXRlVG9hc3RlcjJbMV07CgogIHZhciBfdXNlVXNlckluZm8gPSAoMCwgX3VzZXJfaW5mby51c2VVc2VySW5mbykoKSwKICAgICAgaW5pdExvYWRpbmcgPSBfdXNlVXNlckluZm8ubG9hZGluZywKICAgICAgaXNTaWduYWxJbmRleEV4aXN0cyA9IF91c2VVc2VySW5mby5pc1NpZ25hbEluZGV4RXhpc3RzLAogICAgICBpc0F1dGhlbnRpY2F0ZWQgPSBfdXNlVXNlckluZm8uaXNBdXRoZW50aWNhdGVkLAogICAgICBoYXNFbmNyeXB0aW9uS2V5ID0gX3VzZVVzZXJJbmZvLmhhc0VuY3J5cHRpb25LZXksCiAgICAgIGNhblVzZXJDUlVEID0gX3VzZVVzZXJJbmZvLmNhblVzZXJDUlVEOwoKICB2YXIgX3VzZVBhcmFtcyA9ICgwLCBfcmVhY3RSb3V0ZXJEb20udXNlUGFyYW1zKSgpLAogICAgICBydWxlSWQgPSBfdXNlUGFyYW1zLmRldGFpbE5hbWU7CgogIHZhciBfdXNlUnVsZSA9ICgwLCBfcnVsZXMudXNlUnVsZSkocnVsZUlkKSwKICAgICAgX3VzZVJ1bGUyID0gX3NsaWNlZFRvQXJyYXkoX3VzZVJ1bGUsIDIpLAogICAgICBsb2FkaW5nID0gX3VzZVJ1bGUyWzBdLAogICAgICBydWxlID0gX3VzZVJ1bGUyWzFdOwoKICB2YXIgX3VzZVN0YXRlID0gKDAsIF9yZWFjdDIudXNlU3RhdGUpKGZhbHNlKSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIGluaXRGb3JtID0gX3VzZVN0YXRlMlswXSwKICAgICAgc2V0SW5pdEZvcm0gPSBfdXNlU3RhdGUyWzFdOwoKICB2YXIgX3VzZVN0YXRlMyA9ICgwLCBfcmVhY3QyLnVzZVN0YXRlKSh7CiAgICBkYXRhOiBudWxsLAogICAgaXNWYWxpZDogZmFsc2UKICB9KSwKICAgICAgX3VzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTMsIDIpLAogICAgICBteUFib3V0UnVsZUZvcm0gPSBfdXNlU3RhdGU0WzBdLAogICAgICBzZXRNeUFib3V0UnVsZUZvcm0gPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgX3VzZVN0YXRlNSA9ICgwLCBfcmVhY3QyLnVzZVN0YXRlKSh7CiAgICBkYXRhOiBudWxsLAogICAgaXNWYWxpZDogZmFsc2UKICB9KSwKICAgICAgX3VzZVN0YXRlNiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTUsIDIpLAogICAgICBteURlZmluZVJ1bGVGb3JtID0gX3VzZVN0YXRlNlswXSwKICAgICAgc2V0TXlEZWZpbmVSdWxlRm9ybSA9IF91c2VTdGF0ZTZbMV07CgogIHZhciBfdXNlU3RhdGU3ID0gKDAsIF9yZWFjdDIudXNlU3RhdGUpKHsKICAgIGRhdGE6IG51bGwsCiAgICBpc1ZhbGlkOiBmYWxzZQogIH0pLAogICAgICBfdXNlU3RhdGU4ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNywgMiksCiAgICAgIG15U2NoZWR1bGVSdWxlRm9ybSA9IF91c2VTdGF0ZThbMF0sCiAgICAgIHNldE15U2NoZWR1bGVSdWxlRm9ybSA9IF91c2VTdGF0ZThbMV07CgogIHZhciBfdXNlU3RhdGU5ID0gKDAsIF9yZWFjdDIudXNlU3RhdGUpKHsKICAgIGRhdGE6IG51bGwsCiAgICBpc1ZhbGlkOiBmYWxzZQogIH0pLAogICAgICBfdXNlU3RhdGUxMCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTksIDIpLAogICAgICBteUFjdGlvbnNSdWxlRm9ybSA9IF91c2VTdGF0ZTEwWzBdLAogICAgICBzZXRNeUFjdGlvbnNSdWxlRm9ybSA9IF91c2VTdGF0ZTEwWzFdOwoKICB2YXIgX3VzZVN0YXRlMTEgPSAoMCwgX3JlYWN0Mi51c2VTdGF0ZSkoKSwKICAgICAgX3VzZVN0YXRlMTIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxMSwgMiksCiAgICAgIHNlbGVjdGVkVGFiID0gX3VzZVN0YXRlMTJbMF0sCiAgICAgIHNldFNlbGVjdGVkVGFiID0gX3VzZVN0YXRlMTJbMV07CgogIHZhciBzdGVwc0Zvcm0gPSAoMCwgX3JlYWN0Mi51c2VSZWYpKChfdXNlUmVmID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfdXNlUmVmLCBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwgbnVsbCksIF9kZWZpbmVQcm9wZXJ0eShfdXNlUmVmLCBfdHlwZXMuUnVsZVN0ZXAuYWJvdXRSdWxlLCBudWxsKSwgX2RlZmluZVByb3BlcnR5KF91c2VSZWYsIF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUsIG51bGwpLCBfZGVmaW5lUHJvcGVydHkoX3VzZVJlZiwgX3R5cGVzLlJ1bGVTdGVwLnJ1bGVBY3Rpb25zLCBudWxsKSwgX3VzZVJlZikpOwoKICB2YXIgX3VzZVBlcnNpc3RSdWxlID0gKDAsIF9ydWxlcy51c2VQZXJzaXN0UnVsZSkoKSwKICAgICAgX3VzZVBlcnNpc3RSdWxlMiA9IF9zbGljZWRUb0FycmF5KF91c2VQZXJzaXN0UnVsZSwgMiksCiAgICAgIF91c2VQZXJzaXN0UnVsZTIkID0gX3VzZVBlcnNpc3RSdWxlMlswXSwKICAgICAgaXNMb2FkaW5nID0gX3VzZVBlcnNpc3RSdWxlMiQuaXNMb2FkaW5nLAogICAgICBpc1NhdmVkID0gX3VzZVBlcnNpc3RSdWxlMiQuaXNTYXZlZCwKICAgICAgc2V0UnVsZSA9IF91c2VQZXJzaXN0UnVsZTJbMV07CgogIHZhciBfdXNlU3RhdGUxMyA9ICgwLCBfcmVhY3QyLnVzZVN0YXRlKShbXSksCiAgICAgIF91c2VTdGF0ZTE0ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMTMsIDIpLAogICAgICB0YWJIYXNFcnJvciA9IF91c2VTdGF0ZTE0WzBdLAogICAgICBzZXRUYWJIYXNFcnJvciA9IF91c2VTdGF0ZTE0WzFdOwoKICB2YXIgYWN0aW9uTWVzc2FnZVBhcmFtcyA9ICgwLCBfcmVhY3QyLnVzZU1lbW8pKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAoMCwgX2hlbHBlcnMyLmdldEFjdGlvbk1lc3NhZ2VQYXJhbXMpKHJ1bGUgPT09IG51bGwgfHwgcnVsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcnVsZS50eXBlKTsKICB9LCBbcnVsZV0pOwogIHZhciBzZXRTdGVwc0Zvcm0gPSAoMCwgX3JlYWN0Mi51c2VDYWxsYmFjaykoZnVuY3Rpb24gKHN0ZXAsIGZvcm0pIHsKICAgIHN0ZXBzRm9ybS5jdXJyZW50W3N0ZXBdID0gZm9ybTsKCiAgICBpZiAoaW5pdEZvcm0gJiYgc3RlcCA9PT0gKHNlbGVjdGVkVGFiID09PSBudWxsIHx8IHNlbGVjdGVkVGFiID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZFRhYi5pZCkgJiYgZm9ybS5pc1N1Ym1pdHRlZCA9PT0gZmFsc2UpIHsKICAgICAgc2V0SW5pdEZvcm0oZmFsc2UpOwogICAgICBmb3JtLnN1Ym1pdCgpOwogICAgfQogIH0sIFtpbml0Rm9ybSwgc2VsZWN0ZWRUYWJdKTsKICB2YXIgdGFicyA9ICgwLCBfcmVhY3QyLnVzZU1lbW8pKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBbewogICAgICBpZDogX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUsCiAgICAgIG5hbWU6IHJ1bGVJMThuLkRFRklOSVRJT04sCiAgICAgIGRpc2FibGVkOiBydWxlID09PSBudWxsIHx8IHJ1bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ1bGUuaW1tdXRhYmxlLAogICAgICBjb250ZW50OiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfcGFuZWwuU3RlcFBhbmVsLCB7CiAgICAgICAgbG9hZGluZzogbG9hZGluZyB8fCBpbml0TG9hZGluZywKICAgICAgICB0aXRsZTogcnVsZUkxOG4uREVGSU5JVElPTgogICAgICB9LCBteURlZmluZVJ1bGVGb3JtLmRhdGEgIT0gbnVsbCAmJiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc3RlcF9kZWZpbmVfcnVsZS5TdGVwRGVmaW5lUnVsZSwgewogICAgICAgIGlzUmVhZE9ubHlWaWV3OiBmYWxzZSwKICAgICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZywKICAgICAgICBpc1VwZGF0ZVZpZXc6IHRydWUsCiAgICAgICAgZGVmYXVsdFZhbHVlczogbXlEZWZpbmVSdWxlRm9ybS5kYXRhLAogICAgICAgIHNldEZvcm06IHNldFN0ZXBzRm9ybQogICAgICB9KSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpKSkKICAgIH0sIHsKICAgICAgaWQ6IF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUsCiAgICAgIG5hbWU6IHJ1bGVJMThuLkFCT1VULAogICAgICBkaXNhYmxlZDogcnVsZSA9PT0gbnVsbCB8fCBydWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBydWxlLmltbXV0YWJsZSwKICAgICAgY29udGVudDogX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgbnVsbCksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zdGVwX3BhbmVsLlN0ZXBQYW5lbCwgewogICAgICAgIGxvYWRpbmc6IGxvYWRpbmcgfHwgaW5pdExvYWRpbmcsCiAgICAgICAgdGl0bGU6IHJ1bGVJMThuLkFCT1VUCiAgICAgIH0sIG15QWJvdXRSdWxlRm9ybS5kYXRhICE9IG51bGwgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfYWJvdXRfcnVsZS5TdGVwQWJvdXRSdWxlLCB7CiAgICAgICAgaXNSZWFkT25seVZpZXc6IGZhbHNlLAogICAgICAgIGlzTG9hZGluZzogaXNMb2FkaW5nLAogICAgICAgIGlzVXBkYXRlVmlldzogdHJ1ZSwKICAgICAgICBkZWZhdWx0VmFsdWVzOiBteUFib3V0UnVsZUZvcm0uZGF0YSwKICAgICAgICBzZXRGb3JtOiBzZXRTdGVwc0Zvcm0KICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSkpCiAgICB9LCB7CiAgICAgIGlkOiBfdHlwZXMuUnVsZVN0ZXAuc2NoZWR1bGVSdWxlLAogICAgICBuYW1lOiBydWxlSTE4bi5TQ0hFRFVMRSwKICAgICAgZGlzYWJsZWQ6IHJ1bGUgPT09IG51bGwgfHwgcnVsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcnVsZS5pbW11dGFibGUsCiAgICAgIGNvbnRlbnQ6IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc3RlcF9wYW5lbC5TdGVwUGFuZWwsIHsKICAgICAgICBsb2FkaW5nOiBsb2FkaW5nIHx8IGluaXRMb2FkaW5nLAogICAgICAgIHRpdGxlOiBydWxlSTE4bi5TQ0hFRFVMRQogICAgICB9LCBteVNjaGVkdWxlUnVsZUZvcm0uZGF0YSAhPSBudWxsICYmIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zdGVwX3NjaGVkdWxlX3J1bGUuU3RlcFNjaGVkdWxlUnVsZSwgewogICAgICAgIGlzUmVhZE9ubHlWaWV3OiBmYWxzZSwKICAgICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZywKICAgICAgICBpc1VwZGF0ZVZpZXc6IHRydWUsCiAgICAgICAgZGVmYXVsdFZhbHVlczogbXlTY2hlZHVsZVJ1bGVGb3JtLmRhdGEsCiAgICAgICAgc2V0Rm9ybTogc2V0U3RlcHNGb3JtCiAgICAgIH0pLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgbnVsbCkpKQogICAgfSwgewogICAgICBpZDogX3R5cGVzLlJ1bGVTdGVwLnJ1bGVBY3Rpb25zLAogICAgICBuYW1lOiBydWxlSTE4bi5BQ1RJT05TLAogICAgICBjb250ZW50OiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfcGFuZWwuU3RlcFBhbmVsLCB7CiAgICAgICAgbG9hZGluZzogbG9hZGluZyB8fCBpbml0TG9hZGluZywKICAgICAgICB0aXRsZTogcnVsZUkxOG4uQUNUSU9OUwogICAgICB9LCBteUFjdGlvbnNSdWxlRm9ybS5kYXRhICE9IG51bGwgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBfcnVsZV9hY3Rpb25zLlN0ZXBSdWxlQWN0aW9ucywgewogICAgICAgIGlzUmVhZE9ubHlWaWV3OiBmYWxzZSwKICAgICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZywKICAgICAgICBpc1VwZGF0ZVZpZXc6IHRydWUsCiAgICAgICAgZGVmYXVsdFZhbHVlczogbXlBY3Rpb25zUnVsZUZvcm0uZGF0YSwKICAgICAgICBzZXRGb3JtOiBzZXRTdGVwc0Zvcm0sCiAgICAgICAgYWN0aW9uTWVzc2FnZVBhcmFtczogYWN0aW9uTWVzc2FnZVBhcmFtcwogICAgICB9KSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpKSkKICAgIH1dOwogIH0sIFtydWxlLCBsb2FkaW5nLCBpbml0TG9hZGluZywgaXNMb2FkaW5nLCBteUFib3V0UnVsZUZvcm0sIG15RGVmaW5lUnVsZUZvcm0sIG15U2NoZWR1bGVSdWxlRm9ybSwgbXlBY3Rpb25zUnVsZUZvcm0sIHNldFN0ZXBzRm9ybSwgc3RlcHNGb3JtLCBhY3Rpb25NZXNzYWdlUGFyYW1zXSk7CiAgdmFyIG9uU3VibWl0ID0gKDAsIF9yZWFjdDIudXNlQ2FsbGJhY2spKAogIC8qI19fUFVSRV9fKi8KICBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgIHZhciBfc3RlcHNGb3JtJGN1cnJlbnQkYWM7CgogICAgdmFyIGFjdGl2ZUZvcm1JZCwgYWN0aXZlRm9ybSwgaW52YWxpZEZvcm1zOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBhY3RpdmVGb3JtSWQgPSBzZWxlY3RlZFRhYiA9PT0gbnVsbCB8fCBzZWxlY3RlZFRhYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRUYWIuaWQ7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gKF9zdGVwc0Zvcm0kY3VycmVudCRhYyA9IHN0ZXBzRm9ybS5jdXJyZW50W2FjdGl2ZUZvcm1JZF0pID09PSBudWxsIHx8IF9zdGVwc0Zvcm0kY3VycmVudCRhYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0ZXBzRm9ybSRjdXJyZW50JGFjLnN1Ym1pdCgpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgYWN0aXZlRm9ybSA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIGludmFsaWRGb3JtcyA9IFtfdHlwZXMuUnVsZVN0ZXAuYWJvdXRSdWxlLCBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwgX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZSwgX3R5cGVzLlJ1bGVTdGVwLnJ1bGVBY3Rpb25zXS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgc3RlcCkgewogICAgICAgICAgICAgIGlmIChzdGVwID09PSBhY3RpdmVGb3JtSWQgJiYgYWN0aXZlRm9ybSAhPSBudWxsICYmICEoYWN0aXZlRm9ybSA9PT0gbnVsbCB8fCBhY3RpdmVGb3JtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3RpdmVGb3JtLmlzVmFsaWQpIHx8IHN0ZXAgPT09IF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUgJiYgIW15QWJvdXRSdWxlRm9ybS5pc1ZhbGlkIHx8IHN0ZXAgPT09IF90eXBlcy5SdWxlU3RlcC5kZWZpbmVSdWxlICYmICFteURlZmluZVJ1bGVGb3JtLmlzVmFsaWQgfHwgc3RlcCA9PT0gX3R5cGVzLlJ1bGVTdGVwLnNjaGVkdWxlUnVsZSAmJiAhbXlTY2hlZHVsZVJ1bGVGb3JtLmlzVmFsaWQgfHwgc3RlcCA9PT0gX3R5cGVzLlJ1bGVTdGVwLnJ1bGVBY3Rpb25zICYmICFteUFjdGlvbnNSdWxlRm9ybS5pc1ZhbGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShhY2MpLCBbc3RlcF0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICAgICAgfSwgW10pOwoKICAgICAgICAgICAgaWYgKGludmFsaWRGb3Jtcy5sZW5ndGggPT09IDAgJiYgYWN0aXZlRm9ybSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgc2V0VGFiSGFzRXJyb3IoW10pOwogICAgICAgICAgICAgIHNldFJ1bGUoX29iamVjdFNwcmVhZCh7fSwgKDAsIF9oZWxwZXJzLmZvcm1hdFJ1bGUpKGFjdGl2ZUZvcm1JZCA9PT0gX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUgPyBhY3RpdmVGb3JtLmRhdGEgOiBteURlZmluZVJ1bGVGb3JtLmRhdGEsIGFjdGl2ZUZvcm1JZCA9PT0gX3R5cGVzLlJ1bGVTdGVwLmFib3V0UnVsZSA/IGFjdGl2ZUZvcm0uZGF0YSA6IG15QWJvdXRSdWxlRm9ybS5kYXRhLCBhY3RpdmVGb3JtSWQgPT09IF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUgPyBhY3RpdmVGb3JtLmRhdGEgOiBteVNjaGVkdWxlUnVsZUZvcm0uZGF0YSwgYWN0aXZlRm9ybUlkID09PSBfdHlwZXMuUnVsZVN0ZXAucnVsZUFjdGlvbnMgPyBhY3RpdmVGb3JtLmRhdGEgOiBteUFjdGlvbnNSdWxlRm9ybS5kYXRhKSwge30sIHJ1bGVJZCA/IHsKICAgICAgICAgICAgICAgIGlkOiBydWxlSWQKICAgICAgICAgICAgICB9IDoge30pKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBzZXRUYWJIYXNFcnJvcihpbnZhbGlkRm9ybXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKSwgW3N0ZXBzRm9ybSwgbXlBYm91dFJ1bGVGb3JtLCBteURlZmluZVJ1bGVGb3JtLCBteVNjaGVkdWxlUnVsZUZvcm0sIG15QWN0aW9uc1J1bGVGb3JtLCBzZWxlY3RlZFRhYiwgcnVsZUlkXSk7CiAgKDAsIF9yZWFjdDIudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICBpZiAocnVsZSAhPSBudWxsKSB7CiAgICAgIHZhciBfZ2V0U3RlcHNEYXRhID0gKDAsIF9oZWxwZXJzMi5nZXRTdGVwc0RhdGEpKHsKICAgICAgICBydWxlOiBydWxlCiAgICAgIH0pLAogICAgICAgICAgYWJvdXRSdWxlRGF0YSA9IF9nZXRTdGVwc0RhdGEuYWJvdXRSdWxlRGF0YSwKICAgICAgICAgIGRlZmluZVJ1bGVEYXRhID0gX2dldFN0ZXBzRGF0YS5kZWZpbmVSdWxlRGF0YSwKICAgICAgICAgIHNjaGVkdWxlUnVsZURhdGEgPSBfZ2V0U3RlcHNEYXRhLnNjaGVkdWxlUnVsZURhdGEsCiAgICAgICAgICBydWxlQWN0aW9uc0RhdGEgPSBfZ2V0U3RlcHNEYXRhLnJ1bGVBY3Rpb25zRGF0YTsKCiAgICAgIHNldE15QWJvdXRSdWxlRm9ybSh7CiAgICAgICAgZGF0YTogYWJvdXRSdWxlRGF0YSwKICAgICAgICBpc1ZhbGlkOiB0cnVlCiAgICAgIH0pOwogICAgICBzZXRNeURlZmluZVJ1bGVGb3JtKHsKICAgICAgICBkYXRhOiBkZWZpbmVSdWxlRGF0YSwKICAgICAgICBpc1ZhbGlkOiB0cnVlCiAgICAgIH0pOwogICAgICBzZXRNeVNjaGVkdWxlUnVsZUZvcm0oewogICAgICAgIGRhdGE6IHNjaGVkdWxlUnVsZURhdGEsCiAgICAgICAgaXNWYWxpZDogdHJ1ZQogICAgICB9KTsKICAgICAgc2V0TXlBY3Rpb25zUnVsZUZvcm0oewogICAgICAgIGRhdGE6IHJ1bGVBY3Rpb25zRGF0YSwKICAgICAgICBpc1ZhbGlkOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0sIFtydWxlXSk7CiAgdmFyIG9uVGFiQ2xpY2sgPSAoMCwgX3JlYWN0Mi51c2VDYWxsYmFjaykoCiAgLyojX19QVVJFX18qLwogIGZ1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIodGFiKSB7CiAgICAgIHZhciBfc3RlcHNGb3JtJGN1cnJlbnQkcnUsIHJ1bGVTdGVwLCByZXNwRm9ybTsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaWYgKCEoc2VsZWN0ZWRUYWIgIT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcnVsZVN0ZXAgPSBzZWxlY3RlZFRhYi5pZDsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuIChfc3RlcHNGb3JtJGN1cnJlbnQkcnUgPSBzdGVwc0Zvcm0uY3VycmVudFtydWxlU3RlcF0pID09PSBudWxsIHx8IF9zdGVwc0Zvcm0kY3VycmVudCRydSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0ZXBzRm9ybSRjdXJyZW50JHJ1LnN1Ym1pdCgpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHJlc3BGb3JtID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgIGlmIChyZXNwRm9ybSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAocnVsZVN0ZXAgPT09IF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUpIHsKICAgICAgICAgICAgICAgICAgc2V0TXlBYm91dFJ1bGVGb3JtKHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNwRm9ybS5kYXRhLAogICAgICAgICAgICAgICAgICAgIGlzVmFsaWQ6IHJlc3BGb3JtLmlzVmFsaWQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJ1bGVTdGVwID09PSBfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSkgewogICAgICAgICAgICAgICAgICBzZXRNeURlZmluZVJ1bGVGb3JtKHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNwRm9ybS5kYXRhLAogICAgICAgICAgICAgICAgICAgIGlzVmFsaWQ6IHJlc3BGb3JtLmlzVmFsaWQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJ1bGVTdGVwID09PSBfdHlwZXMuUnVsZVN0ZXAuc2NoZWR1bGVSdWxlKSB7CiAgICAgICAgICAgICAgICAgIHNldE15U2NoZWR1bGVSdWxlRm9ybSh7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzcEZvcm0uZGF0YSwKICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkOiByZXNwRm9ybS5pc1ZhbGlkCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChydWxlU3RlcCA9PT0gX3R5cGVzLlJ1bGVTdGVwLnJ1bGVBY3Rpb25zKSB7CiAgICAgICAgICAgICAgICAgIHNldE15QWN0aW9uc1J1bGVGb3JtKHsKICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNwRm9ybS5kYXRhLAogICAgICAgICAgICAgICAgICAgIGlzVmFsaWQ6IHJlc3BGb3JtLmlzVmFsaWQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHNldEluaXRGb3JtKHRydWUpOwogICAgICAgICAgICAgIHNldFNlbGVjdGVkVGFiKHRhYik7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMik7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpLCBbc2VsZWN0ZWRUYWIsIHN0ZXBzRm9ybS5jdXJyZW50XSk7CiAgKDAsIF9yZWFjdDIudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICBpZiAocnVsZSAhPSBudWxsKSB7CiAgICAgIHZhciBfZ2V0U3RlcHNEYXRhMiA9ICgwLCBfaGVscGVyczIuZ2V0U3RlcHNEYXRhKSh7CiAgICAgICAgcnVsZTogcnVsZQogICAgICB9KSwKICAgICAgICAgIGFib3V0UnVsZURhdGEgPSBfZ2V0U3RlcHNEYXRhMi5hYm91dFJ1bGVEYXRhLAogICAgICAgICAgZGVmaW5lUnVsZURhdGEgPSBfZ2V0U3RlcHNEYXRhMi5kZWZpbmVSdWxlRGF0YSwKICAgICAgICAgIHNjaGVkdWxlUnVsZURhdGEgPSBfZ2V0U3RlcHNEYXRhMi5zY2hlZHVsZVJ1bGVEYXRhLAogICAgICAgICAgcnVsZUFjdGlvbnNEYXRhID0gX2dldFN0ZXBzRGF0YTIucnVsZUFjdGlvbnNEYXRhOwoKICAgICAgc2V0TXlBYm91dFJ1bGVGb3JtKHsKICAgICAgICBkYXRhOiBhYm91dFJ1bGVEYXRhLAogICAgICAgIGlzVmFsaWQ6IHRydWUKICAgICAgfSk7CiAgICAgIHNldE15RGVmaW5lUnVsZUZvcm0oewogICAgICAgIGRhdGE6IGRlZmluZVJ1bGVEYXRhLAogICAgICAgIGlzVmFsaWQ6IHRydWUKICAgICAgfSk7CiAgICAgIHNldE15U2NoZWR1bGVSdWxlRm9ybSh7CiAgICAgICAgZGF0YTogc2NoZWR1bGVSdWxlRGF0YSwKICAgICAgICBpc1ZhbGlkOiB0cnVlCiAgICAgIH0pOwogICAgICBzZXRNeUFjdGlvbnNSdWxlRm9ybSh7CiAgICAgICAgZGF0YTogcnVsZUFjdGlvbnNEYXRhLAogICAgICAgIGlzVmFsaWQ6IHRydWUKICAgICAgfSk7CiAgICB9CiAgfSwgW3J1bGVdKTsKICAoMCwgX3JlYWN0Mi51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgIHZhciB0YWJJbmRleCA9IChydWxlID09PSBudWxsIHx8IHJ1bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ1bGUuaW1tdXRhYmxlKSA/IDMgOiAwOwogICAgc2V0U2VsZWN0ZWRUYWIodGFic1t0YWJJbmRleF0pOwogIH0sIFtydWxlXSk7CgogIGlmIChpc1NhdmVkKSB7CiAgICB2YXIgX3JlZjM7CgogICAgKDAsIF90b2FzdGVycy5kaXNwbGF5U3VjY2Vzc1RvYXN0KShpMThuLlNVQ0NFU1NGVUxMWV9TQVZFRF9SVUxFKChfcmVmMyA9IHJ1bGUgPT09IG51bGwgfHwgcnVsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcnVsZS5uYW1lKSAhPT0gbnVsbCAmJiBfcmVmMyAhPT0gdm9pZCAwID8gX3JlZjMgOiAnJyksIGRpc3BhdGNoVG9hc3Rlcik7CiAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Um91dGVyRG9tLlJlZGlyZWN0LCB7CiAgICAgIHRvOiAiLyIuY29uY2F0KF9yZWRpcmVjdF90b19kZXRlY3Rpb25fZW5naW5lLkRFVEVDVElPTl9FTkdJTkVfUEFHRV9OQU1FLCAiL3J1bGVzL2lkLyIpLmNvbmNhdChydWxlSWQpCiAgICB9KTsKICB9CgogIGlmICgoMCwgX2hlbHBlcnMyLnJlZGlyZWN0VG9EZXRlY3Rpb25zKShpc1NpZ25hbEluZGV4RXhpc3RzLCBpc0F1dGhlbnRpY2F0ZWQsIGhhc0VuY3J5cHRpb25LZXkpKSB7CiAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Um91dGVyRG9tLlJlZGlyZWN0LCB7CiAgICAgIHRvOiAiLyIuY29uY2F0KF9yZWRpcmVjdF90b19kZXRlY3Rpb25fZW5naW5lLkRFVEVDVElPTl9FTkdJTkVfUEFHRV9OQU1FKQogICAgfSk7CiAgfSBlbHNlIGlmICgoMCwgX2hlbHBlcnMyLnVzZXJIYXNOb1Blcm1pc3Npb25zKShjYW5Vc2VyQ1JVRCkpIHsKICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3RSb3V0ZXJEb20uUmVkaXJlY3QsIHsKICAgICAgdG86ICIvIi5jb25jYXQoX3JlZGlyZWN0X3RvX2RldGVjdGlvbl9lbmdpbmUuREVURUNUSU9OX0VOR0lORV9QQUdFX05BTUUsICIvcnVsZXMvaWQvIikuY29uY2F0KHJ1bGVJZCkKICAgIH0pOwogIH0KCiAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3dyYXBwZXJfcGFnZS5XcmFwcGVyUGFnZSwgewogICAgcmVzdHJpY3RXaWR0aDogdHJ1ZQogIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kZXRlY3Rpb25fZW5naW5lX2hlYWRlcl9wYWdlLkRldGVjdGlvbkVuZ2luZUhlYWRlclBhZ2UsIHsKICAgIGJhY2tPcHRpb25zOiB7CiAgICAgIGhyZWY6ICIjLyIuY29uY2F0KF9yZWRpcmVjdF90b19kZXRlY3Rpb25fZW5naW5lLkRFVEVDVElPTl9FTkdJTkVfUEFHRV9OQU1FLCAiL3J1bGVzL2lkLyIpLmNvbmNhdChydWxlSWQpLAogICAgICB0ZXh0OiAiIi5jb25jYXQoaTE4bi5CQUNLX1RPLCAiICIpLmNvbmNhdCgoX3JlZjQgPSBydWxlID09PSBudWxsIHx8IHJ1bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ1bGUubmFtZSkgIT09IG51bGwgJiYgX3JlZjQgIT09IHZvaWQgMCA/IF9yZWY0IDogJycpCiAgICB9LAogICAgaXNMb2FkaW5nOiBpc0xvYWRpbmcsCiAgICB0aXRsZTogaTE4bi5QQUdFX1RJVExFCiAgfSksIHRhYkhhc0Vycm9yLmxlbmd0aCA+IDAgJiYgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICB0aXRsZTogaTE4bi5TT1JSWV9FUlJPUlMsCiAgICBjb2xvcjogImRhbmdlciIsCiAgICBpY29uVHlwZTogImFsZXJ0IgogIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICBpZDogInhwYWNrLnNpZW0uZGV0ZWN0aW9uRW5naW5lLnJ1bGUuZWRpdFJ1bGUuZXJyb3JNc2dEZXNjcmlwdGlvbiIsCiAgICBkZWZhdWx0TWVzc2FnZTogIllvdSBoYXZlIGFuIGludmFsaWQgaW5wdXQgaW4ge2NvdW50RXJyb3IsIHBsdXJhbCwgb25lIHt0aGlzIHRhYn0gb3RoZXIge3RoZXNlIHRhYnN9fToge3RhYkhhc0Vycm9yfSIsCiAgICB2YWx1ZXM6IHsKICAgICAgY291bnRFcnJvcjogdGFiSGFzRXJyb3IubGVuZ3RoLAogICAgICB0YWJIYXNFcnJvcjogdGFiSGFzRXJyb3IubWFwKGZ1bmN0aW9uICh0KSB7CiAgICAgICAgaWYgKHQgPT09IF90eXBlcy5SdWxlU3RlcC5hYm91dFJ1bGUpIHsKICAgICAgICAgIHJldHVybiBydWxlSTE4bi5BQk9VVDsKICAgICAgICB9IGVsc2UgaWYgKHQgPT09IF90eXBlcy5SdWxlU3RlcC5kZWZpbmVSdWxlKSB7CiAgICAgICAgICByZXR1cm4gcnVsZUkxOG4uREVGSU5JVElPTjsKICAgICAgICB9IGVsc2UgaWYgKHQgPT09IF90eXBlcy5SdWxlU3RlcC5zY2hlZHVsZVJ1bGUpIHsKICAgICAgICAgIHJldHVybiBydWxlSTE4bi5TQ0hFRFVMRTsKICAgICAgICB9IGVsc2UgaWYgKHQgPT09IF90eXBlcy5SdWxlU3RlcC5ydWxlQWN0aW9ucykgewogICAgICAgICAgcmV0dXJuIHJ1bGVJMThuLlJVTEVfQUNUSU9OUzsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0OwogICAgICB9KS5qb2luKCcsICcpCiAgICB9CiAgfSkpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRhYmJlZENvbnRlbnQsIHsKICAgIGluaXRpYWxTZWxlY3RlZFRhYjogdGFic1swXSwKICAgIHNlbGVjdGVkVGFiOiB0YWJzLmZpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgcmV0dXJuIHQuaWQgPT09IChzZWxlY3RlZFRhYiA9PT0gbnVsbCB8fCBzZWxlY3RlZFRhYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VsZWN0ZWRUYWIuaWQpOwogICAgfSksCiAgICBvblRhYkNsaWNrOiBvblRhYkNsaWNrLAogICAgdGFiczogdGFicwogIH0pLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgbnVsbCksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICBhbGlnbkl0ZW1zOiAiY2VudGVyIiwKICAgIGd1dHRlclNpemU6ICJzIiwKICAgIGp1c3RpZnlDb250ZW50OiAiZmxleEVuZCIsCiAgICByZXNwb25zaXZlOiBmYWxzZQogIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgIGdyb3c6IGZhbHNlCiAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgIGljb25UeXBlOiAiY3Jvc3MiLAogICAgaHJlZjogIiMvIi5jb25jYXQoX3JlZGlyZWN0X3RvX2RldGVjdGlvbl9lbmdpbmUuREVURUNUSU9OX0VOR0lORV9QQUdFX05BTUUsICIvcnVsZXMvaWQvIikuY29uY2F0KHJ1bGVJZCkKICB9LCBpMThuLkNBTkNFTCkpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICBncm93OiBmYWxzZQogIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICBmaWxsOiB0cnVlLAogICAgb25DbGljazogb25TdWJtaXQsCiAgICBpY29uVHlwZTogInNhdmUiLAogICAgaXNMb2FkaW5nOiBpc0xvYWRpbmcsCiAgICBpc0Rpc2FibGVkOiBpbml0TG9hZGluZwogIH0sIGkxOG4uU0FWRV9DSEFOR0VTKSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NweV9yb3V0ZXMuU3B5Um91dGUsIHsKICAgIHN0YXRlOiB7CiAgICAgIHJ1bGVOYW1lOiBydWxlID09PSBudWxsIHx8IHJ1bGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ1bGUubmFtZQogICAgfQogIH0pKTsKfTsKCnZhciBFZGl0UnVsZVBhZ2UgPSAoMCwgX3JlYWN0Mi5tZW1vKShFZGl0UnVsZVBhZ2VDb21wb25lbnQpOwpleHBvcnRzLkVkaXRSdWxlUGFnZSA9IEVkaXRSdWxlUGFnZTs="},null]}