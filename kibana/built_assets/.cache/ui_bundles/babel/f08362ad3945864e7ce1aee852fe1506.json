{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/core/public/application/application_service.js","dependencies":[{"path":"src/core/public/application/application_service.js","mtime":1589249549274},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkFwcGxpY2F0aW9uU2VydmljZSA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9yeGpzID0gcmVxdWlyZSgicnhqcyIpOwoKdmFyIF9vcGVyYXRvcnMgPSByZXF1aXJlKCJyeGpzL29wZXJhdG9ycyIpOwoKdmFyIF9oaXN0b3J5ID0gcmVxdWlyZSgiaGlzdG9yeSIpOwoKdmFyIF91aSA9IHJlcXVpcmUoIi4vdWkiKTsKCnZhciBfY2FwYWJpbGl0aWVzID0gcmVxdWlyZSgiLi9jYXBhYmlsaXRpZXMiKTsKCnZhciBfdHlwZXMgPSByZXF1aXJlKCIuL3R5cGVzIik7Cgp2YXIgX2FwcGxpY2F0aW9uX2xlYXZlID0gcmVxdWlyZSgiLi9hcHBsaWNhdGlvbl9sZWF2ZSIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKCiAgdmFyIHRhcmdldCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpOwoKICB2YXIga2V5LCBpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7CgogICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZVN5bWJvbEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0gc291cmNlU3ltYm9sS2V5c1tpXTsKICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoc291cmNlLCBrZXkpKSBjb250aW51ZTsKICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICB2YXIgdGFyZ2V0ID0ge307CiAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwogIHZhciBrZXksIGk7CgogIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9IC8vIE1vdW50IGZ1bmN0aW9ucyB3aXRoIHR3byBhcmd1bWVudHMgYXJlIGFzc3VtZWQgdG8gZXhwZWN0IGRlcHJlY2F0ZWQgYGNvbnRleHRgIG9iamVjdC4KCgp2YXIgaXNBcHBNb3VudERlcHJlY2F0ZWQgPSBmdW5jdGlvbiBpc0FwcE1vdW50RGVwcmVjYXRlZChtb3VudCkgewogIHJldHVybiBtb3VudC5sZW5ndGggPT09IDI7Cn07CgpmdW5jdGlvbiBmaWx0ZXJBdmFpbGFibGUobSwgY2FwYWJpbGl0aWVzKSB7CiAgcmV0dXJuIG5ldyBNYXAoX3RvQ29uc3VtYWJsZUFycmF5KG0pLmZpbHRlcihmdW5jdGlvbiAoX3JlZikgewogICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMSksCiAgICAgICAgaWQgPSBfcmVmMlswXTsKCiAgICByZXR1cm4gY2FwYWJpbGl0aWVzLm5hdkxpbmtzW2lkXSA9PT0gdW5kZWZpbmVkIHx8IGNhcGFiaWxpdGllcy5uYXZMaW5rc1tpZF0gPT09IHRydWU7CiAgfSkpOwp9Cgp2YXIgZmluZE1vdW50ZXIgPSBmdW5jdGlvbiBmaW5kTW91bnRlcihtb3VudGVycywgYXBwUm91dGUpIHsKICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KG1vdW50ZXJzKS5maW5kKGZ1bmN0aW9uIChfcmVmMykgewogICAgdmFyIF9yZWY0ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjMsIDIpLAogICAgICAgIG1vdW50ZXIgPSBfcmVmNFsxXTsKCiAgICByZXR1cm4gbW91bnRlci5hcHBSb3V0ZSA9PT0gYXBwUm91dGU7CiAgfSk7Cn07Cgp2YXIgZ2V0QXBwVXJsID0gZnVuY3Rpb24gZ2V0QXBwVXJsKG1vdW50ZXJzLCBhcHBJZCkgewogIHZhciBfbW91bnRlcnMkZ2V0OwoKICB2YXIgcGF0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJyc7CiAgdmFyIGFwcEJhc2VQYXRoID0gKChfbW91bnRlcnMkZ2V0ID0gbW91bnRlcnMuZ2V0KGFwcElkKSkgPT09IG51bGwgfHwgX21vdW50ZXJzJGdldCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21vdW50ZXJzJGdldC5hcHBSb3V0ZSkgPyAiLyIuY29uY2F0KG1vdW50ZXJzLmdldChhcHBJZCkuYXBwUm91dGUpIDogIi9hcHAvIi5jb25jYXQoYXBwSWQpOyAvLyBPbmx5IHByZXBwZW5kIHNsYXNoIGlmIG5vdCBhIGhhc2ggb3IgcXVlcnkgcGF0aAoKICBwYXRoID0gcGF0aC5zdGFydHNXaXRoKCcjJykgfHwgcGF0aC5zdGFydHNXaXRoKCc/JykgPyBwYXRoIDogIi8iLmNvbmNhdChwYXRoKTsKICByZXR1cm4gIiIuY29uY2F0KGFwcEJhc2VQYXRoKS5jb25jYXQocGF0aCkucmVwbGFjZSgvXC97Mix9L2csICcvJykgLy8gUmVtb3ZlIGR1cGxpY2F0ZSBzbGFzaGVzCiAgLnJlcGxhY2UoL1wvJC8sICcnKTsgLy8gUmVtb3ZlIHRyYWlsaW5nIHNsYXNoCn07Cgp2YXIgYWxsQXBwbGljYXRpb25zRmlsdGVyID0gJ19fQUxMX18nOwovKioKICogU2VydmljZSB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciByZWdpc3RlcmluZyBuZXcgYXBwbGljYXRpb25zLgogKiBAaW50ZXJuYWwKICovCgp2YXIgQXBwbGljYXRpb25TZXJ2aWNlID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gQXBwbGljYXRpb25TZXJ2aWNlKCkgewogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQXBwbGljYXRpb25TZXJ2aWNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcHMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAibW91bnRlcnMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY2FwYWJpbGl0aWVzIiwgbmV3IF9jYXBhYmlsaXRpZXMuQ2FwYWJpbGl0aWVzU2VydmljZSgpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImFwcExlYXZlSGFuZGxlcnMiLCBuZXcgTWFwKCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY3VycmVudEFwcElkJCIsIG5ldyBfcnhqcy5CZWhhdmlvclN1YmplY3QodW5kZWZpbmVkKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzdGF0dXNVcGRhdGVycyQiLCBuZXcgX3J4anMuQmVoYXZpb3JTdWJqZWN0KG5ldyBNYXAoKSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic3Vic2NyaXB0aW9ucyIsIFtdKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInN0b3AkIiwgbmV3IF9yeGpzLlN1YmplY3QoKSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJyZWdpc3RyYXRpb25DbG9zZWQiLCBmYWxzZSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoaXN0b3J5Iiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIm1vdW50Q29udGV4dCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJuYXZpZ2F0ZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzZXRBcHBMZWF2ZUhhbmRsZXIiLCBmdW5jdGlvbiAoYXBwSWQsIGhhbmRsZXIpIHsKICAgICAgX3RoaXMuYXBwTGVhdmVIYW5kbGVycy5zZXQoYXBwSWQsIGhhbmRsZXIpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJvbkJlZm9yZVVubG9hZCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgY3VycmVudEFwcElkID0gX3RoaXMuY3VycmVudEFwcElkJC52YWx1ZTsKCiAgICAgIGlmIChjdXJyZW50QXBwSWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGFjdGlvbiA9ICgwLCBfYXBwbGljYXRpb25fbGVhdmUuZ2V0TGVhdmVBY3Rpb24pKF90aGlzLmFwcExlYXZlSGFuZGxlcnMuZ2V0KGN1cnJlbnRBcHBJZCkpOwoKICAgICAgaWYgKCgwLCBfYXBwbGljYXRpb25fbGVhdmUuaXNDb25maXJtQWN0aW9uKShhY3Rpb24pKSB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gc29tZSBicm93c2VycyBhY2NlcHQgYSBzdHJpbmcgcmV0dXJuIHZhbHVlIGJlaW5nIHRoZSBtZXNzYWdlIGRpc3BsYXllZAoKICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9IGFjdGlvbi50ZXh0OwogICAgICB9CiAgICB9KTsKICB9CgogIF9jcmVhdGVDbGFzcyhBcHBsaWNhdGlvblNlcnZpY2UsIFt7CiAgICBrZXk6ICJzZXR1cCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0dXAoX3JlZjUpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29udGV4dCA9IF9yZWY1LmNvbnRleHQsCiAgICAgICAgICBiYXNlUGF0aCA9IF9yZWY1Lmh0dHAuYmFzZVBhdGgsCiAgICAgICAgICBpbmplY3RlZE1ldGFkYXRhID0gX3JlZjUuaW5qZWN0ZWRNZXRhZGF0YSwKICAgICAgICAgIF9yZWY1JHJlZGlyZWN0VG8gPSBfcmVmNS5yZWRpcmVjdFRvLAogICAgICAgICAgcmVkaXJlY3RUbyA9IF9yZWY1JHJlZGlyZWN0VG8gPT09IHZvaWQgMCA/IGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcGF0aDsKICAgICAgfSA6IF9yZWY1JHJlZGlyZWN0VG8sCiAgICAgICAgICBoaXN0b3J5ID0gX3JlZjUuaGlzdG9yeTsKICAgICAgdmFyIGJhc2VuYW1lID0gYmFzZVBhdGguZ2V0KCk7CgogICAgICBpZiAoaW5qZWN0ZWRNZXRhZGF0YS5nZXRMZWdhY3lNb2RlKCkpIHsKICAgICAgICB0aGlzLmN1cnJlbnRBcHBJZCQubmV4dChpbmplY3RlZE1ldGFkYXRhLmdldExlZ2FjeU1ldGFkYXRhKCkuYXBwLmlkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBPbmx5IHNldHVwIGhpc3RvcnkgaWYgd2UncmUgbm90IGluIGxlZ2FjeSBtb2RlCiAgICAgICAgdGhpcy5oaXN0b3J5ID0gaGlzdG9yeSB8fCAoMCwgX2hpc3RvcnkuY3JlYXRlQnJvd3Nlckhpc3RvcnkpKHsKICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZQogICAgICAgIH0pOwogICAgICB9IC8vIElmIHdlIGRvIG5vdCBoYXZlIGhpc3RvcnkgYXZhaWxhYmxlLCB1c2UgcmVkaXJlY3RUbyB0byBkbyBhIGZ1bGwgcGFnZSByZWZyZXNoLgoKCiAgICAgIHRoaXMubmF2aWdhdGUgPSBmdW5jdGlvbiAodXJsLCBzdGF0ZSkgewogICAgICAgIHJldHVybiAoLy8gYmFzZVBhdGggbm90IG5lZWRlZCBoZXJlIGJlY2F1c2UgYGhpc3RvcnlgIGlzIGNvbmZpZ3VyZWQgd2l0aCBiYXNlbmFtZQogICAgICAgICAgX3RoaXMyLmhpc3RvcnkgPyBfdGhpczIuaGlzdG9yeS5wdXNoKHVybCwgc3RhdGUpIDogcmVkaXJlY3RUbyhiYXNlUGF0aC5wcmVwZW5kKHVybCkpCiAgICAgICAgKTsKICAgICAgfTsKCiAgICAgIHRoaXMubW91bnRDb250ZXh0ID0gY29udGV4dC5jcmVhdGVDb250ZXh0Q29udGFpbmVyKCk7CgogICAgICB2YXIgcmVnaXN0ZXJTdGF0dXNVcGRhdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXJTdGF0dXNVcGRhdGVyKGFwcGxpY2F0aW9uLCB1cGRhdGVyJCkgewogICAgICAgIHZhciB1cGRhdGVySWQgPSBTeW1ib2woKTsKICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gdXBkYXRlciQuc3Vic2NyaWJlKGZ1bmN0aW9uICh1cGRhdGVyKSB7CiAgICAgICAgICB2YXIgbmV4dFZhbHVlID0gbmV3IE1hcChfdGhpczIuc3RhdHVzVXBkYXRlcnMkLmdldFZhbHVlKCkpOwogICAgICAgICAgbmV4dFZhbHVlLnNldCh1cGRhdGVySWQsIHsKICAgICAgICAgICAgYXBwbGljYXRpb246IGFwcGxpY2F0aW9uLAogICAgICAgICAgICB1cGRhdGVyOiB1cGRhdGVyCiAgICAgICAgICB9KTsKCiAgICAgICAgICBfdGhpczIuc3RhdHVzVXBkYXRlcnMkLm5leHQobmV4dFZhbHVlKTsKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMyLnN1YnNjcmlwdGlvbnMucHVzaChzdWJzY3JpcHRpb24pOwogICAgICB9OwoKICAgICAgcmV0dXJuIHsKICAgICAgICByZWdpc3Rlck1vdW50Q29udGV4dDogdGhpcy5tb3VudENvbnRleHQucmVnaXN0ZXJDb250ZXh0LAogICAgICAgIHJlZ2lzdGVyOiBmdW5jdGlvbiByZWdpc3RlcihwbHVnaW4sIGFwcCkgewogICAgICAgICAgdmFyIF9hcHAkc3RhdHVzLCBfYXBwJG5hdkxpbmtTdGF0dXM7CgogICAgICAgICAgYXBwID0gX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgIGFwcFJvdXRlOiAiL2FwcC8iLmNvbmNhdChhcHAuaWQpCiAgICAgICAgICB9LCBhcHApOwoKICAgICAgICAgIGlmIChfdGhpczIucmVnaXN0cmF0aW9uQ2xvc2VkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQXBwbGljYXRpb25zIGNhbm5vdCBiZSByZWdpc3RlcmVkIGFmdGVyIFwic2V0dXBcIiIpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYXBwcy5oYXMoYXBwLmlkKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFuIGFwcGxpY2F0aW9uIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHRoZSBpZCBcIiIuY29uY2F0KGFwcC5pZCwgIlwiIikpOwogICAgICAgICAgfSBlbHNlIGlmIChmaW5kTW91bnRlcihfdGhpczIubW91bnRlcnMsIGFwcC5hcHBSb3V0ZSkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBbiBhcHBsaWNhdGlvbiBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQgd2l0aCB0aGUgYXBwUm91dGUgXCIiLmNvbmNhdChhcHAuYXBwUm91dGUsICJcIiIpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmFzZW5hbWUgJiYgYXBwLmFwcFJvdXRlLnN0YXJ0c1dpdGgoYmFzZW5hbWUpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlZ2lzdGVyIGFuIGFwcGxpY2F0aW9uIHJvdXRlIHRoYXQgaW5jbHVkZXMgSFRUUCBiYXNlIHBhdGgnKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaGFuZGxlcjsKCiAgICAgICAgICBpZiAoaXNBcHBNb3VudERlcHJlY2F0ZWQoYXBwLm1vdW50KSkgewogICAgICAgICAgICBoYW5kbGVyID0gX3RoaXMyLm1vdW50Q29udGV4dC5jcmVhdGVIYW5kbGVyKHBsdWdpbiwgYXBwLm1vdW50KTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKCiAgICAgICAgICAgIGNvbnNvbGUud2FybigiQXBwIFsiLmNvbmNhdChhcHAuaWQsICJdIGlzIHVzaW5nIGRlcHJlY2F0ZWQgbW91bnQgY29udGV4dC4gVXNlIGNvcmUuZ2V0U3RhcnRTZXJ2aWNlcygpIGluc3RlYWQuIikpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaGFuZGxlciA9IGFwcC5tb3VudDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbW91bnQgPQogICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX3JlZjYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHBhcmFtcykgewogICAgICAgICAgICAgIHZhciB1bm1vdW50OwogICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIocGFyYW1zKTsKCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgdW5tb3VudCA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLmN1cnJlbnRBcHBJZCQubmV4dChhcHAuaWQpOwoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHVubW91bnQpOwoKICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG1vdW50KF94KSB7CiAgICAgICAgICAgICAgcmV0dXJuIF9yZWY2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KCk7CgogICAgICAgICAgdmFyIF9hcHAgPSBhcHAsCiAgICAgICAgICAgICAgdXBkYXRlciQgPSBfYXBwLnVwZGF0ZXIkLAogICAgICAgICAgICAgIGFwcFByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9hcHAsIFsidXBkYXRlciQiXSk7CgogICAgICAgICAgX3RoaXMyLmFwcHMuc2V0KGFwcC5pZCwgX29iamVjdFNwcmVhZCh7fSwgYXBwUHJvcHMsIHsKICAgICAgICAgICAgc3RhdHVzOiAoX2FwcCRzdGF0dXMgPSBhcHAuc3RhdHVzKSAhPT0gbnVsbCAmJiBfYXBwJHN0YXR1cyAhPT0gdm9pZCAwID8gX2FwcCRzdGF0dXMgOiBfdHlwZXMuQXBwU3RhdHVzLmFjY2Vzc2libGUsCiAgICAgICAgICAgIG5hdkxpbmtTdGF0dXM6IChfYXBwJG5hdkxpbmtTdGF0dXMgPSBhcHAubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2FwcCRuYXZMaW5rU3RhdHVzICE9PSB2b2lkIDAgPyBfYXBwJG5hdkxpbmtTdGF0dXMgOiBfdHlwZXMuQXBwTmF2TGlua1N0YXR1cy5kZWZhdWx0LAogICAgICAgICAgICBsZWdhY3k6IGZhbHNlCiAgICAgICAgICB9KSk7CgogICAgICAgICAgaWYgKHVwZGF0ZXIkKSB7CiAgICAgICAgICAgIHJlZ2lzdGVyU3RhdHVzVXBkYXRlcihhcHAuaWQsIHVwZGF0ZXIkKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpczIubW91bnRlcnMuc2V0KGFwcC5pZCwgewogICAgICAgICAgICBhcHBSb3V0ZTogYXBwLmFwcFJvdXRlLAogICAgICAgICAgICBhcHBCYXNlUGF0aDogYmFzZVBhdGgucHJlcGVuZChhcHAuYXBwUm91dGUpLAogICAgICAgICAgICBtb3VudDogbW91bnQsCiAgICAgICAgICAgIHVubW91bnRCZWZvcmVNb3VudGluZzogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVnaXN0ZXJMZWdhY3lBcHA6IGZ1bmN0aW9uIHJlZ2lzdGVyTGVnYWN5QXBwKGFwcCkgewogICAgICAgICAgdmFyIF9hcHAkc3RhdHVzMiwgX2FwcCRuYXZMaW5rU3RhdHVzMjsKCiAgICAgICAgICB2YXIgYXBwUm91dGUgPSAiL2FwcC8iLmNvbmNhdChhcHAuaWQuc3BsaXQoJzonKVswXSk7CgogICAgICAgICAgaWYgKF90aGlzMi5yZWdpc3RyYXRpb25DbG9zZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBcHBsaWNhdGlvbnMgY2Fubm90IGJlIHJlZ2lzdGVyZWQgYWZ0ZXIgInNldHVwIicpOwogICAgICAgICAgfSBlbHNlIGlmIChfdGhpczIuYXBwcy5oYXMoYXBwLmlkKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFuIGFwcGxpY2F0aW9uIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCB3aXRoIHRoZSBpZCBcIiIuY29uY2F0KGFwcC5pZCwgIlwiIikpOwogICAgICAgICAgfSBlbHNlIGlmIChiYXNlbmFtZSAmJiBhcHBSb3V0ZS5zdGFydHNXaXRoKGJhc2VuYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWdpc3RlciBhbiBhcHBsaWNhdGlvbiByb3V0ZSB0aGF0IGluY2x1ZGVzIEhUVFAgYmFzZSBwYXRoJyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGFwcEJhc2VQYXRoID0gYmFzZVBhdGgucHJlcGVuZChhcHBSb3V0ZSk7CgogICAgICAgICAgdmFyIG1vdW50ID0gZnVuY3Rpb24gbW91bnQoKSB7CiAgICAgICAgICAgIHJldHVybiByZWRpcmVjdFRvKGFwcEJhc2VQYXRoKTsKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIHVwZGF0ZXIkID0gYXBwLnVwZGF0ZXIkLAogICAgICAgICAgICAgIGFwcFByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKGFwcCwgWyJ1cGRhdGVyJCJdKTsKCiAgICAgICAgICBfdGhpczIuYXBwcy5zZXQoYXBwLmlkLCBfb2JqZWN0U3ByZWFkKHt9LCBhcHBQcm9wcywgewogICAgICAgICAgICBzdGF0dXM6IChfYXBwJHN0YXR1czIgPSBhcHAuc3RhdHVzKSAhPT0gbnVsbCAmJiBfYXBwJHN0YXR1czIgIT09IHZvaWQgMCA/IF9hcHAkc3RhdHVzMiA6IF90eXBlcy5BcHBTdGF0dXMuYWNjZXNzaWJsZSwKICAgICAgICAgICAgbmF2TGlua1N0YXR1czogKF9hcHAkbmF2TGlua1N0YXR1czIgPSBhcHAubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2FwcCRuYXZMaW5rU3RhdHVzMiAhPT0gdm9pZCAwID8gX2FwcCRuYXZMaW5rU3RhdHVzMiA6IF90eXBlcy5BcHBOYXZMaW5rU3RhdHVzLmRlZmF1bHQsCiAgICAgICAgICAgIGxlZ2FjeTogdHJ1ZQogICAgICAgICAgfSkpOwoKICAgICAgICAgIGlmICh1cGRhdGVyJCkgewogICAgICAgICAgICByZWdpc3RlclN0YXR1c1VwZGF0ZXIoYXBwLmlkLCB1cGRhdGVyJCk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMyLm1vdW50ZXJzLnNldChhcHAuaWQsIHsKICAgICAgICAgICAgYXBwUm91dGU6IGFwcFJvdXRlLAogICAgICAgICAgICBhcHBCYXNlUGF0aDogYXBwQmFzZVBhdGgsCiAgICAgICAgICAgIG1vdW50OiBtb3VudCwKICAgICAgICAgICAgdW5tb3VudEJlZm9yZU1vdW50aW5nOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlZ2lzdGVyQXBwVXBkYXRlcjogZnVuY3Rpb24gcmVnaXN0ZXJBcHBVcGRhdGVyKGFwcFVwZGF0ZXIkKSB7CiAgICAgICAgICByZXR1cm4gcmVnaXN0ZXJTdGF0dXNVcGRhdGVyKGFsbEFwcGxpY2F0aW9uc0ZpbHRlciwgYXBwVXBkYXRlciQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3N0YXJ0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX3JlZjcpIHsKICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgdmFyIGh0dHAsIG92ZXJsYXlzLCBfcmVmOCwgY2FwYWJpbGl0aWVzLCBhdmFpbGFibGVNb3VudGVycywgYXZhaWxhYmxlQXBwcywgYXBwbGljYXRpb25zJCwgYXBwbGljYXRpb25TdGF0dXNlcyQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBodHRwID0gX3JlZjcuaHR0cCwgb3ZlcmxheXMgPSBfcmVmNy5vdmVybGF5czsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb3VudENvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FwcGxpY2F0aW9uU2VydmljZSNzZXR1cCgpIG11c3QgYmUgaW52b2tlZCBiZWZvcmUgc3RhcnQuJyk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHRoaXMucmVnaXN0cmF0aW9uQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLm9uQmVmb3JlVW5sb2FkKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNhcGFiaWxpdGllcy5zdGFydCh7CiAgICAgICAgICAgICAgICAgIGFwcElkczogX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMubW91bnRlcnMua2V5cygpKSwKICAgICAgICAgICAgICAgICAgaHR0cDogaHR0cAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF9yZWY4ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXMgPSBfcmVmOC5jYXBhYmlsaXRpZXM7CiAgICAgICAgICAgICAgICBhdmFpbGFibGVNb3VudGVycyA9IGZpbHRlckF2YWlsYWJsZSh0aGlzLm1vdW50ZXJzLCBjYXBhYmlsaXRpZXMpOwogICAgICAgICAgICAgICAgYXZhaWxhYmxlQXBwcyA9IGZpbHRlckF2YWlsYWJsZSh0aGlzLmFwcHMsIGNhcGFiaWxpdGllcyk7CiAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbnMkID0gbmV3IF9yeGpzLkJlaGF2aW9yU3ViamVjdChhdmFpbGFibGVBcHBzKTsKICAgICAgICAgICAgICAgIHRoaXMuc3RhdHVzVXBkYXRlcnMkLnBpcGUoKDAsIF9vcGVyYXRvcnMubWFwKShmdW5jdGlvbiAoc3RhdHVzVXBkYXRlcnMpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXAoX3RvQ29uc3VtYWJsZUFycmF5KGF2YWlsYWJsZUFwcHMpLm1hcChmdW5jdGlvbiAoX3JlZjkpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjEwID0gX3NsaWNlZFRvQXJyYXkoX3JlZjksIDIpLAogICAgICAgICAgICAgICAgICAgICAgICBpZCA9IF9yZWYxMFswXSwKICAgICAgICAgICAgICAgICAgICAgICAgYXBwID0gX3JlZjEwWzFdOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gW2lkLCB1cGRhdGVTdGF0dXMoYXBwLCBfdG9Db25zdW1hYmxlQXJyYXkoc3RhdHVzVXBkYXRlcnMudmFsdWVzKCkpKV07CiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0pKS5zdWJzY3JpYmUoZnVuY3Rpb24gKGFwcHMpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGFwcGxpY2F0aW9ucyQubmV4dChhcHBzKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXBwbGljYXRpb25TdGF0dXNlcyQgPSBhcHBsaWNhdGlvbnMkLnBpcGUoKDAsIF9vcGVyYXRvcnMubWFwKShmdW5jdGlvbiAoYXBwcykgewogICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1hcChfdG9Db25zdW1hYmxlQXJyYXkoYXBwcy5lbnRyaWVzKCkpLm1hcChmdW5jdGlvbiAoX3JlZjExKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMiA9IF9zbGljZWRUb0FycmF5KF9yZWYxMSwgMiksCiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gX3JlZjEyWzBdLAogICAgICAgICAgICAgICAgICAgICAgICBhcHAgPSBfcmVmMTJbMV07CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBbaWQsIGFwcC5zdGF0dXNdOwogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9KSwgKDAsIF9vcGVyYXRvcnMuc2hhcmVSZXBsYXkpKDEpKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9ucyQ6IGFwcGxpY2F0aW9ucyQsCiAgICAgICAgICAgICAgICAgIGNhcGFiaWxpdGllczogY2FwYWJpbGl0aWVzLAogICAgICAgICAgICAgICAgICBjdXJyZW50QXBwSWQkOiB0aGlzLmN1cnJlbnRBcHBJZCQucGlwZSgoMCwgX29wZXJhdG9ycy5maWx0ZXIpKGZ1bmN0aW9uIChhcHBJZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcHBJZCAhPT0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICB9KSwgKDAsIF9vcGVyYXRvcnMuZGlzdGluY3RVbnRpbENoYW5nZWQpKCksICgwLCBfb3BlcmF0b3JzLnRha2VVbnRpbCkodGhpcy5zdG9wJCkpLAogICAgICAgICAgICAgICAgICByZWdpc3Rlck1vdW50Q29udGV4dDogdGhpcy5tb3VudENvbnRleHQucmVnaXN0ZXJDb250ZXh0LAogICAgICAgICAgICAgICAgICBnZXRVcmxGb3JBcHA6IGZ1bmN0aW9uIGdldFVybEZvckFwcChhcHBJZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gX3JlZjEzLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIF9yZWYxMyRhYnNvbHV0ZSA9IF9yZWYxMy5hYnNvbHV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYWJzb2x1dGUgPSBfcmVmMTMkYWJzb2x1dGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjEzJGFic29sdXRlOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcmVsVXJsID0gaHR0cC5iYXNlUGF0aC5wcmVwZW5kKGdldEFwcFVybChhdmFpbGFibGVNb3VudGVycywgYXBwSWQsIHBhdGgpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWJzb2x1dGUgPyByZWxhdGl2ZVRvQWJzb2x1dGUocmVsVXJsKSA6IHJlbFVybDsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgbmF2aWdhdGVUb0FwcDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBfbmF2aWdhdGVUb0FwcCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihhcHBJZCkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNCwKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoLAogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVmMTQgPSBfYXJnczIubGVuZ3RoID4gMSAmJiBfYXJnczJbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMlsxXSA6IHt9LCBwYXRoID0gX3JlZjE0LnBhdGgsIHN0YXRlID0gX3JlZjE0LnN0YXRlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczMuc2hvdWxkTmF2aWdhdGUob3ZlcmxheXMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dDIuc2VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLmFwcExlYXZlSGFuZGxlcnMuZGVsZXRlKF90aGlzMy5jdXJyZW50QXBwSWQkLnZhbHVlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzMy5uYXZpZ2F0ZShnZXRBcHBVcmwoYXZhaWxhYmxlTW91bnRlcnMsIGFwcElkLCBwYXRoKSwgc3RhdGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLmN1cnJlbnRBcHBJZCQubmV4dChhcHBJZCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZVRvQXBwKF94MykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9uYXZpZ2F0ZVRvQXBwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdGVUb0FwcDsKICAgICAgICAgICAgICAgICAgfSgpLAogICAgICAgICAgICAgICAgICBnZXRDb21wb25lbnQ6IGZ1bmN0aW9uIGdldENvbXBvbmVudCgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIV90aGlzMy5oaXN0b3J5KSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF91aS5BcHBSb3V0ZXIsIHsKICAgICAgICAgICAgICAgICAgICAgIGhpc3Rvcnk6IF90aGlzMy5oaXN0b3J5LAogICAgICAgICAgICAgICAgICAgICAgbW91bnRlcnM6IGF2YWlsYWJsZU1vdW50ZXJzLAogICAgICAgICAgICAgICAgICAgICAgYXBwU3RhdHVzZXMkOiBhcHBsaWNhdGlvblN0YXR1c2VzJCwKICAgICAgICAgICAgICAgICAgICAgIHNldEFwcExlYXZlSGFuZGxlcjogX3RoaXMzLnNldEFwcExlYXZlSGFuZGxlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHN0YXJ0KF94MikgewogICAgICAgIHJldHVybiBfc3RhcnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHN0YXJ0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAic2hvdWxkTmF2aWdhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9zaG91bGROYXZpZ2F0ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KG92ZXJsYXlzKSB7CiAgICAgICAgdmFyIGN1cnJlbnRBcHBJZCwgYWN0aW9uLCBjb25maXJtZWQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGN1cnJlbnRBcHBJZCA9IHRoaXMuY3VycmVudEFwcElkJC52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoIShjdXJyZW50QXBwSWQgPT09IHVuZGVmaW5lZCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGFjdGlvbiA9ICgwLCBfYXBwbGljYXRpb25fbGVhdmUuZ2V0TGVhdmVBY3Rpb24pKHRoaXMuYXBwTGVhdmVIYW5kbGVycy5nZXQoY3VycmVudEFwcElkKSk7CgogICAgICAgICAgICAgICAgaWYgKCEoMCwgX2FwcGxpY2F0aW9uX2xlYXZlLmlzQ29uZmlybUFjdGlvbikoYWN0aW9uKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gb3ZlcmxheXMub3BlbkNvbmZpcm0oYWN0aW9uLnRleHQsIHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IGFjdGlvbi50aXRsZSwKICAgICAgICAgICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ2FwcExlYXZlQ29uZmlybU1vZGFsJwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIGNvbmZpcm1lZCA9IF9jb250ZXh0NC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHNob3VsZE5hdmlnYXRlKF94NCkgewogICAgICAgIHJldHVybiBfc2hvdWxkTmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHNob3VsZE5hdmlnYXRlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAic3RvcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3RvcCgpIHsKICAgICAgdGhpcy5zdG9wJC5uZXh0KCk7CiAgICAgIHRoaXMuY3VycmVudEFwcElkJC5jb21wbGV0ZSgpOwogICAgICB0aGlzLnN0YXR1c1VwZGF0ZXJzJC5jb21wbGV0ZSgpOwogICAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoc3ViKSB7CiAgICAgICAgcmV0dXJuIHN1Yi51bnN1YnNjcmliZSgpOwogICAgICB9KTsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMub25CZWZvcmVVbmxvYWQpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFwcGxpY2F0aW9uU2VydmljZTsKfSgpOwoKZXhwb3J0cy5BcHBsaWNhdGlvblNlcnZpY2UgPSBBcHBsaWNhdGlvblNlcnZpY2U7Cgp2YXIgdXBkYXRlU3RhdHVzID0gZnVuY3Rpb24gdXBkYXRlU3RhdHVzKGFwcCwgc3RhdHVzVXBkYXRlcnMpIHsKICB2YXIgY2hhbmdlcyA9IHt9OwogIHN0YXR1c1VwZGF0ZXJzLmZvckVhY2goZnVuY3Rpb24gKHdyYXBwZXIpIHsKICAgIGlmICh3cmFwcGVyLmFwcGxpY2F0aW9uICE9PSBhbGxBcHBsaWNhdGlvbnNGaWx0ZXIgJiYgd3JhcHBlci5hcHBsaWNhdGlvbiAhPT0gYXBwLmlkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgZmllbGRzID0gd3JhcHBlci51cGRhdGVyKGFwcCk7CgogICAgaWYgKGZpZWxkcykgewogICAgICB2YXIgX2NoYW5nZXMkc3RhdHVzLCBfZmllbGRzJHN0YXR1cywgX2NoYW5nZXMkbmF2TGlua1N0YXR1LCBfZmllbGRzJG5hdkxpbmtTdGF0dXM7CgogICAgICBjaGFuZ2VzID0gX29iamVjdFNwcmVhZCh7fSwgY2hhbmdlcywge30sIGZpZWxkcywgewogICAgICAgIC8vIHN0YXR1cyBhbmQgbmF2TGlua1N0YXR1cyBlbnVtcyBhcmUgb3JkZXJlZCBieSByZXZlcnNlZCBwcmlvcml0eQogICAgICAgIC8vIGlmIG11bHRpcGxlIHVwZGF0ZXJzIHdhbnRzIHRvIGNoYW5nZSB0aGVzZSBmaWVsZHMsIHdlIHdpbGwgYWx3YXlzIGZvbGxvdyB0aGUgcHJpb3JpdHkgb3JkZXIuCiAgICAgICAgc3RhdHVzOiBNYXRoLm1heCgoX2NoYW5nZXMkc3RhdHVzID0gY2hhbmdlcy5zdGF0dXMpICE9PSBudWxsICYmIF9jaGFuZ2VzJHN0YXR1cyAhPT0gdm9pZCAwID8gX2NoYW5nZXMkc3RhdHVzIDogMCwgKF9maWVsZHMkc3RhdHVzID0gZmllbGRzLnN0YXR1cykgIT09IG51bGwgJiYgX2ZpZWxkcyRzdGF0dXMgIT09IHZvaWQgMCA/IF9maWVsZHMkc3RhdHVzIDogMCksCiAgICAgICAgbmF2TGlua1N0YXR1czogTWF0aC5tYXgoKF9jaGFuZ2VzJG5hdkxpbmtTdGF0dSA9IGNoYW5nZXMubmF2TGlua1N0YXR1cykgIT09IG51bGwgJiYgX2NoYW5nZXMkbmF2TGlua1N0YXR1ICE9PSB2b2lkIDAgPyBfY2hhbmdlcyRuYXZMaW5rU3RhdHUgOiAwLCAoX2ZpZWxkcyRuYXZMaW5rU3RhdHVzID0gZmllbGRzLm5hdkxpbmtTdGF0dXMpICE9PSBudWxsICYmIF9maWVsZHMkbmF2TGlua1N0YXR1cyAhPT0gdm9pZCAwID8gX2ZpZWxkcyRuYXZMaW5rU3RhdHVzIDogMCkKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGFwcCwge30sIGNoYW5nZXMpOwp9OwoKZnVuY3Rpb24gcmVsYXRpdmVUb0Fic29sdXRlKHVybCkgewogIC8vIGNvbnZlcnQgYWxsIGxpbmsgdXJscyB0byBhYnNvbHV0ZSB1cmxzCiAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgYS5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB1cmwpOwogIHJldHVybiBhLmhyZWY7Cn0="},null]}