{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/lens/public/indexpattern_datasource/datapanel.js","dependencies":[{"path":"x-pack/legacy/plugins/lens/public/indexpattern_datasource/datapanel.js","mtime":1589249552304},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkluZGV4UGF0dGVybkRhdGFQYW5lbCA9IEluZGV4UGF0dGVybkRhdGFQYW5lbDsKZXhwb3J0cy5NZW1vaXplZERhdGFQYW5lbCA9IGV4cG9ydHMuSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfZHJhZ19kcm9wID0gcmVxdWlyZSgiLi4vZHJhZ19kcm9wIik7Cgp2YXIgX2ZpZWxkX2l0ZW0gPSByZXF1aXJlKCIuL2ZpZWxkX2l0ZW0iKTsKCnZhciBfbGVuc191aV90ZWxlbWV0cnkgPSByZXF1aXJlKCIuLi9sZW5zX3VpX3RlbGVtZXRyeSIpOwoKdmFyIF9sb2FkZXIgPSByZXF1aXJlKCIuL2xvYWRlciIpOwoKdmFyIF9wdXJlX2hlbHBlcnMgPSByZXF1aXJlKCIuL3B1cmVfaGVscGVycyIpOwoKdmFyIF9sb2FkZXIyID0gcmVxdWlyZSgiLi4vbG9hZGVyIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2RhdGEvcHVibGljIik7Cgp2YXIgX2xlbnNfZmllbGRfaWNvbiA9IHJlcXVpcmUoIi4vbGVuc19maWVsZF9pY29uIik7Cgp2YXIgX2NoYW5nZV9pbmRleHBhdHRlcm4gPSByZXF1aXJlKCIuL2NoYW5nZV9pbmRleHBhdHRlcm4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfSAvLyBUT0RPIHRoZSB0eXBpbmdzIGZvciBFdWlDb250ZXh0TWVudVBhbmVsIGFyZSBpbmNvcnJlY3QgLSB3YXRjaGVkSXRlbVByb3BzIGlzIG1pc3NpbmcuIFRoaXMgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGUgdHlwZXMgYXJlIGFkanVzdGVkCgoKdmFyIEZpeGVkRXVpQ29udGV4dE1lbnVQYW5lbCA9IF9ldWkuRXVpQ29udGV4dE1lbnVQYW5lbDsKCmZ1bmN0aW9uIHNvcnRGaWVsZHMoZmllbGRBLCBmaWVsZEIpIHsKICByZXR1cm4gZmllbGRBLm5hbWUubG9jYWxlQ29tcGFyZShmaWVsZEIubmFtZSwgdW5kZWZpbmVkLCB7CiAgICBzZW5zaXRpdml0eTogJ2Jhc2UnCiAgfSk7Cn0KCnZhciBzdXBwb3J0ZWRGaWVsZFR5cGVzID0gbmV3IFNldChbJ3N0cmluZycsICdudW1iZXInLCAnYm9vbGVhbicsICdkYXRlJywgJ2lwJywgJ2RvY3VtZW50J10pOwp2YXIgUEFHSU5BVElPTl9TSVpFID0gNTA7CnZhciBmaWVsZFR5cGVOYW1lcyA9IHsKICBkb2N1bWVudDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLnJlY29yZCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAncmVjb3JkJwogIH0pLAogIHN0cmluZzogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLnN0cmluZycsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnc3RyaW5nJwogIH0pLAogIG51bWJlcjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuZGF0YXR5cGVzLm51bWJlcicsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnbnVtYmVyJwogIH0pLAogIGJvb2xlYW46IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmRhdGF0eXBlcy5ib29sZWFuJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdib29sZWFuJwogIH0pLAogIGRhdGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmRhdGF0eXBlcy5kYXRlJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdkYXRlJwogIH0pLAogIGlwOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5kYXRhdHlwZXMuaXBBZGRyZXNzJywgewogICAgZGVmYXVsdE1lc3NhZ2U6ICdJUCcKICB9KQp9OwoKZnVuY3Rpb24gSW5kZXhQYXR0ZXJuRGF0YVBhbmVsKF9yZWYpIHsKICB2YXIgc2V0U3RhdGUgPSBfcmVmLnNldFN0YXRlLAogICAgICBzdGF0ZSA9IF9yZWYuc3RhdGUsCiAgICAgIGRyYWdEcm9wQ29udGV4dCA9IF9yZWYuZHJhZ0Ryb3BDb250ZXh0LAogICAgICBjb3JlID0gX3JlZi5jb3JlLAogICAgICBxdWVyeSA9IF9yZWYucXVlcnksCiAgICAgIGZpbHRlcnMgPSBfcmVmLmZpbHRlcnMsCiAgICAgIGRhdGVSYW5nZSA9IF9yZWYuZGF0ZVJhbmdlLAogICAgICBjaGFuZ2VJbmRleFBhdHRlcm4gPSBfcmVmLmNoYW5nZUluZGV4UGF0dGVybjsKICB2YXIgaW5kZXhQYXR0ZXJuUmVmcyA9IHN0YXRlLmluZGV4UGF0dGVyblJlZnMsCiAgICAgIGluZGV4UGF0dGVybnMgPSBzdGF0ZS5pbmRleFBhdHRlcm5zLAogICAgICBjdXJyZW50SW5kZXhQYXR0ZXJuSWQgPSBzdGF0ZS5jdXJyZW50SW5kZXhQYXR0ZXJuSWQ7CiAgdmFyIG9uQ2hhbmdlSW5kZXhQYXR0ZXJuID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKGlkKSB7CiAgICByZXR1cm4gY2hhbmdlSW5kZXhQYXR0ZXJuKGlkLCBzdGF0ZSwgc2V0U3RhdGUpOwogIH0sIFtzdGF0ZSwgc2V0U3RhdGVdKTsKICB2YXIgb25Ub2dnbGVFbXB0eUZpZWxkcyA9ICgwLCBfcmVhY3QudXNlQ2FsbGJhY2spKGZ1bmN0aW9uIChzaG93RW1wdHlGaWVsZHMpIHsKICAgIHNldFN0YXRlKGZ1bmN0aW9uIChwcmV2U3RhdGUpIHsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZSwgewogICAgICAgIHNob3dFbXB0eUZpZWxkczogc2hvd0VtcHR5RmllbGRzID09PSB1bmRlZmluZWQgPyAhcHJldlN0YXRlLnNob3dFbXB0eUZpZWxkcyA6IHNob3dFbXB0eUZpZWxkcwogICAgICB9KTsKICAgIH0pOwogIH0sIFtzZXRTdGF0ZV0pOwogIHZhciBpbmRleFBhdHRlcm5MaXN0ID0gKDAsIF9sb2Rhc2gudW5pcSkoT2JqZWN0LnZhbHVlcyhzdGF0ZS5sYXllcnMpLm1hcChmdW5jdGlvbiAobCkgewogICAgcmV0dXJuIGwuaW5kZXhQYXR0ZXJuSWQ7CiAgfSkuY29uY2F0KGN1cnJlbnRJbmRleFBhdHRlcm5JZCkpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7CiAgfSkuZmlsdGVyKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuICEhaW5kZXhQYXR0ZXJuc1tpZF07CiAgfSkubWFwKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuIHsKICAgICAgaWQ6IGlkLAogICAgICB0aXRsZTogaW5kZXhQYXR0ZXJuc1tpZF0udGl0bGUsCiAgICAgIHRpbWVGaWVsZE5hbWU6IGluZGV4UGF0dGVybnNbaWRdLnRpbWVGaWVsZE5hbWUKICAgIH07CiAgfSk7CgogIHZhciBkc2xRdWVyeSA9IF9wdWJsaWMuZXNRdWVyeS5idWlsZEVzUXVlcnkoaW5kZXhQYXR0ZXJuc1tjdXJyZW50SW5kZXhQYXR0ZXJuSWRdLCBxdWVyeSwgZmlsdGVycywgX3B1YmxpYy5lc1F1ZXJ5LmdldEVzUXVlcnlDb25maWcoY29yZS51aVNldHRpbmdzKSk7CgogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9sb2FkZXIyLkxvYWRlciwgewogICAgbG9hZDogZnVuY3Rpb24gbG9hZCgpIHsKICAgICAgcmV0dXJuICgwLCBfbG9hZGVyLnN5bmNFeGlzdGluZ0ZpZWxkcykoewogICAgICAgIGRhdGVSYW5nZTogZGF0ZVJhbmdlLAogICAgICAgIHNldFN0YXRlOiBzZXRTdGF0ZSwKICAgICAgICBpbmRleFBhdHRlcm5zOiBpbmRleFBhdHRlcm5MaXN0LAogICAgICAgIGZldGNoSnNvbjogY29yZS5odHRwLnBvc3QsCiAgICAgICAgZHNsUXVlcnk6IGRzbFF1ZXJ5CiAgICAgIH0pOwogICAgfSwKICAgIGxvYWREZXBzOiBbcXVlcnksIGZpbHRlcnMsIGRhdGVSYW5nZS5mcm9tRGF0ZSwgZGF0ZVJhbmdlLnRvRGF0ZSwgaW5kZXhQYXR0ZXJuTGlzdC5tYXAoZnVuY3Rpb24gKHgpIHsKICAgICAgcmV0dXJuICIiLmNvbmNhdCh4LnRpdGxlLCAiOiIpLmNvbmNhdCh4LnRpbWVGaWVsZE5hbWUpOwogICAgfSkuam9pbignLCcpXQogIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KE1lbW9pemVkRGF0YVBhbmVsLCB7CiAgICBjdXJyZW50SW5kZXhQYXR0ZXJuSWQ6IGN1cnJlbnRJbmRleFBhdHRlcm5JZCwKICAgIGluZGV4UGF0dGVyblJlZnM6IGluZGV4UGF0dGVyblJlZnMsCiAgICBpbmRleFBhdHRlcm5zOiBpbmRleFBhdHRlcm5zLAogICAgcXVlcnk6IHF1ZXJ5LAogICAgZGF0ZVJhbmdlOiBkYXRlUmFuZ2UsCiAgICBmaWx0ZXJzOiBmaWx0ZXJzLAogICAgZHJhZ0Ryb3BDb250ZXh0OiBkcmFnRHJvcENvbnRleHQsCiAgICBzaG93RW1wdHlGaWVsZHM6IHN0YXRlLnNob3dFbXB0eUZpZWxkcywKICAgIG9uVG9nZ2xlRW1wdHlGaWVsZHM6IG9uVG9nZ2xlRW1wdHlGaWVsZHMsCiAgICBjb3JlOiBjb3JlLAogICAgb25DaGFuZ2VJbmRleFBhdHRlcm46IG9uQ2hhbmdlSW5kZXhQYXR0ZXJuLAogICAgZXhpc3RpbmdGaWVsZHM6IHN0YXRlLmV4aXN0aW5nRmllbGRzCiAgfSkpOwp9Cgp2YXIgSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwgPSBmdW5jdGlvbiBJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbChfcmVmMikgewogIHZhciBjdXJyZW50SW5kZXhQYXR0ZXJuSWQgPSBfcmVmMi5jdXJyZW50SW5kZXhQYXR0ZXJuSWQsCiAgICAgIGluZGV4UGF0dGVyblJlZnMgPSBfcmVmMi5pbmRleFBhdHRlcm5SZWZzLAogICAgICBpbmRleFBhdHRlcm5zID0gX3JlZjIuaW5kZXhQYXR0ZXJucywKICAgICAgcXVlcnkgPSBfcmVmMi5xdWVyeSwKICAgICAgZGF0ZVJhbmdlID0gX3JlZjIuZGF0ZVJhbmdlLAogICAgICBmaWx0ZXJzID0gX3JlZjIuZmlsdGVycywKICAgICAgZHJhZ0Ryb3BDb250ZXh0ID0gX3JlZjIuZHJhZ0Ryb3BDb250ZXh0LAogICAgICBfb25DaGFuZ2VJbmRleFBhdHRlcm4gPSBfcmVmMi5vbkNoYW5nZUluZGV4UGF0dGVybiwKICAgICAgc2hvd0VtcHR5RmllbGRzID0gX3JlZjIuc2hvd0VtcHR5RmllbGRzLAogICAgICBvblRvZ2dsZUVtcHR5RmllbGRzID0gX3JlZjIub25Ub2dnbGVFbXB0eUZpZWxkcywKICAgICAgY29yZSA9IF9yZWYyLmNvcmUsCiAgICAgIGV4aXN0aW5nRmllbGRzID0gX3JlZjIuZXhpc3RpbmdGaWVsZHM7CgogIGlmIChPYmplY3Qua2V5cyhpbmRleFBhdHRlcm5zKS5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgIGd1dHRlclNpemU6ICJtIiwKICAgICAgY2xhc3NOYW1lOiAibG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwiLAogICAgICBkaXJlY3Rpb246ICJjb2x1bW4iLAogICAgICByZXNwb25zaXZlOiBmYWxzZQogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgIGdyb3c6IG51bGwKICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbmRleFBhdHRlcm4tbm8taW5kZXhwYXR0ZXJucyIsCiAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm4ubm9QYXR0ZXJuc0xhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTm8gaW5kZXggcGF0dGVybnMnCiAgICAgIH0pLAogICAgICBjb2xvcjogIndhcm5pbmciLAogICAgICBpY29uVHlwZTogImFsZXJ0IgogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgIGlkOiAieHBhY2subGVucy5pbmRleFBhdHRlcm4ubm9QYXR0ZXJuc0Rlc2NyaXB0aW9uIiwKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQbGVhc2UgY3JlYXRlIGFuIGluZGV4IHBhdHRlcm4gb3Igc3dpdGNoIHRvIGFub3RoZXIgZGF0YSBzb3VyY2UiCiAgICB9KSkpKSk7CiAgfQoKICB2YXIgX3VzZVN0YXRlID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoewogICAgbmFtZUZpbHRlcjogJycsCiAgICB0eXBlRmlsdGVyOiBbXSwKICAgIGlzVHlwZUZpbHRlck9wZW46IGZhbHNlCiAgfSksCiAgICAgIF91c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLAogICAgICBsb2NhbFN0YXRlID0gX3VzZVN0YXRlMlswXSwKICAgICAgc2V0TG9jYWxTdGF0ZSA9IF91c2VTdGF0ZTJbMV07CgogIHZhciBfdXNlU3RhdGUzID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoUEFHSU5BVElPTl9TSVpFKSwKICAgICAgX3VzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTMsIDIpLAogICAgICBwYWdlU2l6ZSA9IF91c2VTdGF0ZTRbMF0sCiAgICAgIHNldFBhZ2VTaXplID0gX3VzZVN0YXRlNFsxXTsKCiAgdmFyIF91c2VTdGF0ZTUgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKSh1bmRlZmluZWQpLAogICAgICBfdXNlU3RhdGU2ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNSwgMiksCiAgICAgIHNjcm9sbENvbnRhaW5lciA9IF91c2VTdGF0ZTZbMF0sCiAgICAgIHNldFNjcm9sbENvbnRhaW5lciA9IF91c2VTdGF0ZTZbMV07CgogIHZhciBjdXJyZW50SW5kZXhQYXR0ZXJuID0gaW5kZXhQYXR0ZXJuc1tjdXJyZW50SW5kZXhQYXR0ZXJuSWRdOwogIHZhciBhbGxGaWVsZHMgPSBjdXJyZW50SW5kZXhQYXR0ZXJuLmZpZWxkczsKICB2YXIgZmllbGRCeU5hbWUgPSAoMCwgX2xvZGFzaC5pbmRleEJ5KShhbGxGaWVsZHMsICduYW1lJyk7CgogIHZhciBjbGVhckxvY2FsU3RhdGUgPSBmdW5jdGlvbiBjbGVhckxvY2FsU3RhdGUoKSB7CiAgICByZXR1cm4gc2V0TG9jYWxTdGF0ZShmdW5jdGlvbiAocykgewogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgIG5hbWVGaWx0ZXI6ICcnLAogICAgICAgIHR5cGVGaWx0ZXI6IFtdCiAgICAgIH0pOwogICAgfSk7CiAgfTsKCiAgdmFyIGxhenlTY3JvbGwgPSBmdW5jdGlvbiBsYXp5U2Nyb2xsKCkgewogICAgaWYgKHNjcm9sbENvbnRhaW5lcikgewogICAgICB2YXIgbmVhckJvdHRvbSA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AgKyBzY3JvbGxDb250YWluZXIuY2xpZW50SGVpZ2h0ID4gc2Nyb2xsQ29udGFpbmVyLnNjcm9sbEhlaWdodCAqIDAuOTsKCiAgICAgIGlmIChuZWFyQm90dG9tKSB7CiAgICAgICAgc2V0UGFnZVNpemUoTWF0aC5tYXgoUEFHSU5BVElPTl9TSVpFLCBNYXRoLm1pbihwYWdlU2l6ZSAqIDEuNSwgYWxsRmllbGRzLmxlbmd0aCkpKTsKICAgICAgfQogICAgfQogIH07CgogICgwLCBfcmVhY3QudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICAvLyBSZXNldCB0aGUgc2Nyb2xsIGlmIHdlIGhhdmUgbWFkZSBtYXRlcmlhbCBjaGFuZ2VzIHRvIHRoZSBmaWVsZCBsaXN0CiAgICBpZiAoc2Nyb2xsQ29udGFpbmVyKSB7CiAgICAgIHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AgPSAwOwogICAgICBzZXRQYWdlU2l6ZShQQUdJTkFUSU9OX1NJWkUpOwogICAgICBsYXp5U2Nyb2xsKCk7CiAgICB9CiAgfSwgW2xvY2FsU3RhdGUubmFtZUZpbHRlciwgbG9jYWxTdGF0ZS50eXBlRmlsdGVyLCBjdXJyZW50SW5kZXhQYXR0ZXJuSWQsIHNob3dFbXB0eUZpZWxkc10pOwogIHZhciBhdmFpbGFibGVGaWVsZFR5cGVzID0gKDAsIF9sb2Rhc2gudW5pcSkoYWxsRmllbGRzLm1hcChmdW5jdGlvbiAoX3JlZjMpIHsKICAgIHZhciB0eXBlID0gX3JlZjMudHlwZTsKICAgIHJldHVybiB0eXBlOwogIH0pKS5maWx0ZXIoZnVuY3Rpb24gKHR5cGUpIHsKICAgIHJldHVybiB0eXBlIGluIGZpZWxkVHlwZU5hbWVzOwogIH0pOwogIHZhciBkaXNwbGF5ZWRGaWVsZHMgPSBhbGxGaWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChmaWVsZCkgewogICAgaWYgKCFzdXBwb3J0ZWRGaWVsZFR5cGVzLmhhcyhmaWVsZC50eXBlKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgaWYgKGxvY2FsU3RhdGUubmFtZUZpbHRlci5sZW5ndGggJiYgIWZpZWxkLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb2NhbFN0YXRlLm5hbWVGaWx0ZXIudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghc2hvd0VtcHR5RmllbGRzKSB7CiAgICAgIHZhciBpbmRleEZpZWxkID0gY3VycmVudEluZGV4UGF0dGVybiAmJiBmaWVsZEJ5TmFtZVtmaWVsZC5uYW1lXTsKICAgICAgdmFyIGV4aXN0cyA9IGZpZWxkLnR5cGUgPT09ICdkb2N1bWVudCcgfHwgaW5kZXhGaWVsZCAmJiAoMCwgX3B1cmVfaGVscGVycy5maWVsZEV4aXN0cykoZXhpc3RpbmdGaWVsZHMsIGN1cnJlbnRJbmRleFBhdHRlcm4udGl0bGUsIGluZGV4RmllbGQubmFtZSk7CgogICAgICBpZiAobG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gZXhpc3RzICYmIGxvY2FsU3RhdGUudHlwZUZpbHRlci5pbmNsdWRlcyhmaWVsZC50eXBlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGV4aXN0czsKICAgIH0KCiAgICBpZiAobG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIGxvY2FsU3RhdGUudHlwZUZpbHRlci5pbmNsdWRlcyhmaWVsZC50eXBlKTsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9KTsKICB2YXIgc3BlY2lhbEZpZWxkcyA9IGRpc3BsYXllZEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHsKICAgIHJldHVybiBmLnR5cGUgPT09ICdkb2N1bWVudCc7CiAgfSk7CiAgdmFyIHBhZ2luYXRlZEZpZWxkcyA9IGRpc3BsYXllZEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGYpIHsKICAgIHJldHVybiBmLnR5cGUgIT09ICdkb2N1bWVudCc7CiAgfSkuc29ydChzb3J0RmllbGRzKS5zbGljZSgwLCBwYWdlU2l6ZSk7CiAgdmFyIGhpbGlnaHQgPSBsb2NhbFN0YXRlLm5hbWVGaWx0ZXIudG9Mb3dlckNhc2UoKTsKCiAgdmFyIGZpbHRlckJ5VHlwZUxhYmVsID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5maWx0ZXJCeVR5cGVMYWJlbCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnRmlsdGVyIGJ5IHR5cGUnCiAgfSk7CgogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kcmFnX2Ryb3AuQ2hpbGREcmFnRHJvcFByb3ZpZGVyLCBkcmFnRHJvcENvbnRleHQsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgIGd1dHRlclNpemU6ICJub25lIiwKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsIiwKICAgIGRpcmVjdGlvbjogImNvbHVtbiIsCiAgICByZXNwb25zaXZlOiBmYWxzZQogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgZ3JvdzogbnVsbAogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19oZWFkZXIiCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY2hhbmdlX2luZGV4cGF0dGVybi5DaGFuZ2VJbmRleFBhdHRlcm4sIHsKICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbmRleFBhdHRlcm4tc3dpdGNoZXIiLAogICAgdHJpZ2dlcjogewogICAgICBsYWJlbDogY3VycmVudEluZGV4UGF0dGVybi50aXRsZSwKICAgICAgdGl0bGU6IGN1cnJlbnRJbmRleFBhdHRlcm4udGl0bGUsCiAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdpbmRleFBhdHRlcm4tc3dpdGNoLWxpbmsnLAogICAgICBjbGFzc05hbWU6ICdsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbF9fdHJpZ2dlckJ1dHRvbicKICAgIH0sCiAgICBpbmRleFBhdHRlcm5JZDogY3VycmVudEluZGV4UGF0dGVybklkLAogICAgaW5kZXhQYXR0ZXJuUmVmczogaW5kZXhQYXR0ZXJuUmVmcywKICAgIG9uQ2hhbmdlSW5kZXhQYXR0ZXJuOiBmdW5jdGlvbiBvbkNoYW5nZUluZGV4UGF0dGVybihuZXdJZCkgewogICAgICBfb25DaGFuZ2VJbmRleFBhdHRlcm4obmV3SWQpOwoKICAgICAgY2xlYXJMb2NhbFN0YXRlKCk7CiAgICB9CiAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICBjbGFzc05hbWU6ICJsbnNJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbF9fZmlsdGVyV3JhcHBlciIKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybUNvbnRyb2xMYXlvdXQsIHsKICAgIGljb246ICJzZWFyY2giLAogICAgZnVsbFdpZHRoOiB0cnVlLAogICAgY2xlYXI6IHsKICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuY2xlYXJGaWx0ZXJzTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDbGVhciBuYW1lIGFuZCB0eXBlIGZpbHRlcnMnCiAgICAgIH0pLAogICAgICAnYXJpYS1sYWJlbCc6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuY2xlYXJGaWx0ZXJzTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDbGVhciBuYW1lIGFuZCB0eXBlIGZpbHRlcnMnCiAgICAgIH0pLAogICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICgwLCBfbGVuc191aV90ZWxlbWV0cnkudHJhY2tVaUV2ZW50KSgnaW5kZXhwYXR0ZXJuX2ZpbHRlcnNfY2xlYXJlZCcpOwogICAgICAgIGNsZWFyTG9jYWxTdGF0ZSgpOwogICAgICB9CiAgICB9CiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICBjbGFzc05hbWU6ICJldWlGaWVsZFRleHQgZXVpRmllbGRUZXh0LS1mdWxsV2lkdGggbG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWxfX3RleHRGaWVsZCIsCiAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuRmllbGRTZWFyY2giLAogICAgcGxhY2Vob2xkZXI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuZmlsdGVyQnlOYW1lTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VhcmNoIGZpZWxkIG5hbWVzJywKICAgICAgZGVzY3JpcHRpb246ICdTZWFyY2ggdGhlIGxpc3Qgb2YgZmllbGRzIGluIHRoZSBpbmRleCBwYXR0ZXJuIGZvciB0aGUgcHJvdmlkZWQgdGV4dCcKICAgIH0pLAogICAgdmFsdWU6IGxvY2FsU3RhdGUubmFtZUZpbHRlciwKICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgIHNldExvY2FsU3RhdGUoX29iamVjdFNwcmVhZCh7fSwgbG9jYWxTdGF0ZSwgewogICAgICAgIG5hbWVGaWx0ZXI6IGUudGFyZ2V0LnZhbHVlCiAgICAgIH0pKTsKICAgIH0sCiAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMuZmlsdGVyQnlOYW1lQXJpYUxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ1NlYXJjaCBmaWVsZHMnCiAgICB9KQogIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19maWx0ZXJzV3JhcHBlciIKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUG9wb3ZlciwgewogICAgaWQ6ICJkYXRhUGFuZWxUeXBlRmlsdGVyIiwKICAgIHBhbmVsQ2xhc3NOYW1lOiAiZXVpRmlsdGVyR3JvdXBfX3BvcG92ZXJQYW5lbCIsCiAgICBwYW5lbFBhZGRpbmdTaXplOiAibm9uZSIsCiAgICBhbmNob3JQb3NpdGlvbjogInJpZ2h0RG93biIsCiAgICBkaXNwbGF5OiAiYmxvY2siLAogICAgaXNPcGVuOiBsb2NhbFN0YXRlLmlzVHlwZUZpbHRlck9wZW4sCiAgICBjbG9zZVBvcG92ZXI6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigpIHsKICAgICAgcmV0dXJuIHNldExvY2FsU3RhdGUoZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBsb2NhbFN0YXRlLCB7CiAgICAgICAgICBpc1R5cGVGaWx0ZXJPcGVuOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBidXR0b246IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGYWNldEJ1dHRvbiwgewogICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuRmlsdGVyc1RvZ2dsZSIsCiAgICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19maWx0ZXJCdXR0b24iLAogICAgICBxdWFudGl0eTogbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCwKICAgICAgaWNvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUljb24sIHsKICAgICAgICB0eXBlOiAiZmlsdGVyIgogICAgICB9KSwKICAgICAgaXNTZWxlY3RlZDogbG9jYWxTdGF0ZS50eXBlRmlsdGVyLmxlbmd0aCA/IHRydWUgOiBmYWxzZSwKICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICBzZXRMb2NhbFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgICBpc1R5cGVGaWx0ZXJPcGVuOiAhbG9jYWxTdGF0ZS5pc1R5cGVGaWx0ZXJPcGVuCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwgZmlsdGVyQnlUeXBlTGFiZWwpCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBvcG92ZXJUaXRsZSwgbnVsbCwgZmlsdGVyQnlUeXBlTGFiZWwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KEZpeGVkRXVpQ29udGV4dE1lbnVQYW5lbCwgewogICAgd2F0Y2hlZEl0ZW1Qcm9wczogWydpY29uJywgJ2Rpc2FibGVkJ10sCiAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zSW5kZXhQYXR0ZXJuVHlwZUZpbHRlck9wdGlvbnMiLAogICAgaXRlbXM6IGF2YWlsYWJsZUZpZWxkVHlwZXMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29udGV4dE1lbnVJdGVtLCB7CiAgICAgICAgY2xhc3NOYW1lOiAibG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWxfX2ZpbHRlclR5cGUiLAogICAgICAgIGtleTogdHlwZSwKICAgICAgICBpY29uOiBsb2NhbFN0YXRlLnR5cGVGaWx0ZXIuaW5jbHVkZXModHlwZSkgPyAnY2hlY2snIDogJ2VtcHR5JywKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAidHlwZUZpbHRlci0iLmNvbmNhdCh0eXBlKSwKICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgKDAsIF9sZW5zX3VpX3RlbGVtZXRyeS50cmFja1VpRXZlbnQpKCdpbmRleHBhdHRlcm5fdHlwZV9maWx0ZXJfdG9nZ2xlZCcpOwogICAgICAgICAgc2V0TG9jYWxTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgICAgIHR5cGVGaWx0ZXI6IGxvY2FsU3RhdGUudHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlKSA/IGxvY2FsU3RhdGUudHlwZUZpbHRlci5maWx0ZXIoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0ICE9PSB0eXBlOwogICAgICAgICAgICAgIH0pIDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsb2NhbFN0YXRlLnR5cGVGaWx0ZXIpLCBbdHlwZV0pCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgewogICAgICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19maWx0ZXJUeXBlSW5uZXIiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xlbnNfZmllbGRfaWNvbi5MZW5zRmllbGRJY29uLCB7CiAgICAgICAgdHlwZTogdHlwZQogICAgICB9KSwgIiAiLCBmaWVsZFR5cGVOYW1lc1t0eXBlXSkpOwogICAgfSkKICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBvcG92ZXJGb290ZXIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgIGNvbXByZXNzZWQ6IHRydWUsCiAgICBjaGVja2VkOiAhc2hvd0VtcHR5RmllbGRzLAogICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKCkgewogICAgICAoMCwgX2xlbnNfdWlfdGVsZW1ldHJ5LnRyYWNrVWlFdmVudCkoJ2luZGV4cGF0dGVybl9leGlzdGVuY2VfdG9nZ2xlZCcpOwogICAgICBvblRvZ2dsZUVtcHR5RmllbGRzKCk7CiAgICB9LAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMudG9nZ2xlRW1wdHlGaWVsZHNTd2l0Y2gnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnT25seSBzaG93IGZpZWxkcyB3aXRoIGRhdGEnCiAgICB9KSwKICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJsbnNFbXB0eUZpbHRlciIKICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgY2xhc3NOYW1lOiAibG5zSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWxfX2xpc3RXcmFwcGVyIiwKICAgIHJlZjogZnVuY3Rpb24gcmVmKGVsKSB7CiAgICAgIGlmIChlbCAmJiAhZWwuZGF0YXNldC5keW5hbWljU2Nyb2xsKSB7CiAgICAgICAgZWwuZGF0YXNldC5keW5hbWljU2Nyb2xsID0gJ3RydWUnOwogICAgICAgIHNldFNjcm9sbENvbnRhaW5lcihlbCk7CiAgICAgIH0KICAgIH0sCiAgICBvblNjcm9sbDogbGF6eVNjcm9sbAogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgIGNsYXNzTmFtZTogImxuc0lubmVySW5kZXhQYXR0ZXJuRGF0YVBhbmVsX19saXN0IgogIH0sIHNwZWNpYWxGaWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ZpZWxkX2l0ZW0uRmllbGRJdGVtLCB7CiAgICAgIGNvcmU6IGNvcmUsCiAgICAgIGtleTogZmllbGQubmFtZSwKICAgICAgaW5kZXhQYXR0ZXJuOiBjdXJyZW50SW5kZXhQYXR0ZXJuLAogICAgICBmaWVsZDogZmllbGQsCiAgICAgIGhpZ2hsaWdodDogaGlsaWdodCwKICAgICAgZXhpc3RzOiBwYWdpbmF0ZWRGaWVsZHMubGVuZ3RoID4gMCwKICAgICAgZGF0ZVJhbmdlOiBkYXRlUmFuZ2UsCiAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgZmlsdGVyczogZmlsdGVycywKICAgICAgaGlkZURldGFpbHM6IHRydWUKICAgIH0pOwogIH0pLCBzcGVjaWFsRmllbGRzLmxlbmd0aCA+IDAgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgc2l6ZTogInMiCiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtTGFiZWwsIG51bGwsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5pbmRpdmlkdWFsRmllbGRzTGFiZWwnLCB7CiAgICBkZWZhdWx0TWVzc2FnZTogJ0luZGl2aWR1YWwgZmllbGRzJwogIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgc2l6ZTogInMiCiAgfSkpLCBwYWdpbmF0ZWRGaWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZCkgewogICAgdmFyIG92ZXJhbGxGaWVsZCA9IGZpZWxkQnlOYW1lW2ZpZWxkLm5hbWVdOwogICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ZpZWxkX2l0ZW0uRmllbGRJdGVtLCB7CiAgICAgIGNvcmU6IGNvcmUsCiAgICAgIGluZGV4UGF0dGVybjogY3VycmVudEluZGV4UGF0dGVybiwKICAgICAga2V5OiBmaWVsZC5uYW1lLAogICAgICBmaWVsZDogZmllbGQsCiAgICAgIGhpZ2hsaWdodDogaGlsaWdodCwKICAgICAgZXhpc3RzOiBvdmVyYWxsRmllbGQgJiYgKDAsIF9wdXJlX2hlbHBlcnMuZmllbGRFeGlzdHMpKGV4aXN0aW5nRmllbGRzLCBjdXJyZW50SW5kZXhQYXR0ZXJuLnRpdGxlLCBvdmVyYWxsRmllbGQubmFtZSksCiAgICAgIGRhdGVSYW5nZTogZGF0ZVJhbmdlLAogICAgICBxdWVyeTogcXVlcnksCiAgICAgIGZpbHRlcnM6IGZpbHRlcnMKICAgIH0pOwogIH0pLCBwYWdpbmF0ZWRGaWVsZHMubGVuZ3RoID09PSAwICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlDYWxsT3V0LCB7CiAgICBzaXplOiAicyIsCiAgICBjb2xvcjogIndhcm5pbmciLAogICAgdGl0bGU6IGxvY2FsU3RhdGUudHlwZUZpbHRlci5sZW5ndGggfHwgbG9jYWxTdGF0ZS5uYW1lRmlsdGVyLmxlbmd0aCA/IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMubm9GaWx0ZXJlZEZpZWxkc0xhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ05vIGZpZWxkcyBtYXRjaCB0aGUgY3VycmVudCBmaWx0ZXJzLicKICAgIH0pIDogc2hvd0VtcHR5RmllbGRzID8gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5ub0ZpZWxkc0xhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ05vIGZpZWxkcyBleGlzdCBpbiB0aGlzIGluZGV4IHBhdHRlcm4uJwogICAgfSkgOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm5zLmVtcHR5RmllbGRzV2l0aERhdGFMYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMb29rcyBsaWtlIHlvdSBkb27igJl0IGhhdmUgYW55IGRhdGEuJwogICAgfSkKICB9LCAoIXNob3dFbXB0eUZpZWxkcyB8fCBsb2NhbFN0YXRlLnR5cGVGaWx0ZXIubGVuZ3RoIHx8IGxvY2FsU3RhdGUubmFtZUZpbHRlci5sZW5ndGgpICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybnMubm9GaWVsZHMudHJ5VGV4dCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnVHJ5OicKICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInVsIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgibGkiLCBudWxsLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm5zLm5vRmllbGRzLmV4dGVuZFRpbWVCdWxsZXQnLCB7CiAgICBkZWZhdWx0TWVzc2FnZTogJ0V4dGVuZGluZyB0aGUgdGltZSByYW5nZScKICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImxpIiwgbnVsbCwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJucy5ub0ZpZWxkcy5maWVsZEZpbHRlckJ1bGxldCcsIHsKICAgIGRlZmF1bHRNZXNzYWdlOiAnVXNpbmcge2ZpbHRlckJ5VHlwZUxhYmVsfSB7YXJyb3d9IHRvIHNob3cgZmllbGRzIHdpdGhvdXQgZGF0YScsCiAgICB2YWx1ZXM6IHsKICAgICAgZmlsdGVyQnlUeXBlTGFiZWw6IGZpbHRlckJ5VHlwZUxhYmVsLAogICAgICBhcnJvdzogJ+KGkScKICAgIH0KICB9KSkpKSkpKSkpKTsKfTsKCmV4cG9ydHMuSW5uZXJJbmRleFBhdHRlcm5EYXRhUGFuZWwgPSBJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbDsKdmFyIE1lbW9pemVkRGF0YVBhbmVsID0gKDAsIF9yZWFjdC5tZW1vKShJbm5lckluZGV4UGF0dGVybkRhdGFQYW5lbCk7CmV4cG9ydHMuTWVtb2l6ZWREYXRhUGFuZWwgPSBNZW1vaXplZERhdGFQYW5lbDs="},null]}