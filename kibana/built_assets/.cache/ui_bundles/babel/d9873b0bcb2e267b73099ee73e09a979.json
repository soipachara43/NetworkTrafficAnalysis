{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/sources/es_source.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/sources/es_source.js","mtime":1589249552440},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkFic3RyYWN0RVNTb3VyY2UgPSB2b2lkIDA7Cgp2YXIgX3ZlY3Rvcl9zb3VyY2UgPSByZXF1aXJlKCIuL3ZlY3Rvcl9zb3VyY2UiKTsKCnZhciBfa2liYW5hX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vLi4va2liYW5hX3NlcnZpY2VzIik7Cgp2YXIgX2VsYXN0aWNzZWFyY2hfZ2VvX3V0aWxzID0gcmVxdWlyZSgiLi4vLi4vZWxhc3RpY3NlYXJjaF9nZW9fdXRpbHMiKTsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfdiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidXVpZC92NCIpKTsKCnZhciBfdXRpbCA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvbWFwcy9wdWJsaWMvcmVkdWNlcnMvdXRpbCIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi8uLi9jb21tb24vY29uc3RhbnRzIik7Cgp2YXIgX2RhdGFfcmVxdWVzdCA9IHJlcXVpcmUoIi4uL3V0aWwvZGF0YV9yZXF1ZXN0Iik7Cgp2YXIgX2dlb190aWxlX3V0aWxzID0gcmVxdWlyZSgiLi9lc19nZW9fZ3JpZF9zb3VyY2UvZ2VvX3RpbGVfdXRpbHMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsgfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOyB9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IH0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsgdHJ5IHsgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOyB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOyB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyByZXR1cm47IH0gaWYgKGluZm8uZG9uZSkgeyByZXNvbHZlKHZhbHVlKTsgfSBlbHNlIHsgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOyB9IH0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOyB9IGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOyB9IF9uZXh0KHVuZGVmaW5lZCk7IH0pOyB9OyB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIEFic3RyYWN0RVNTb3VyY2UgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQWJzdHJhY3RWZWN0b3JTb3VyY2UpIHsKICBfaW5oZXJpdHMoQWJzdHJhY3RFU1NvdXJjZSwgX0Fic3RyYWN0VmVjdG9yU291cmNlKTsKCiAgZnVuY3Rpb24gQWJzdHJhY3RFU1NvdXJjZShkZXNjcmlwdG9yLCBpbnNwZWN0b3JBZGFwdGVycykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBYnN0cmFjdEVTU291cmNlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihBYnN0cmFjdEVTU291cmNlKS5jYWxsKHRoaXMsIF9vYmplY3RTcHJlYWQoe30sIGRlc2NyaXB0b3IsIHsKICAgICAgYXBwbHlHbG9iYWxRdWVyeTogX2xvZGFzaC5kZWZhdWx0LmdldChkZXNjcmlwdG9yLCAnYXBwbHlHbG9iYWxRdWVyeScsIHRydWUpCiAgICB9KSwgaW5zcGVjdG9yQWRhcHRlcnMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRWYWx1ZVN1Z2dlc3Rpb25zIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGZpZWxkLCBxdWVyeSkgewogICAgICAgIHZhciBpbmRleFBhdHRlcm47CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldEF1dG9jb21wbGV0ZVNlcnZpY2UpKCkuZ2V0VmFsdWVTdWdnZXN0aW9ucyh7CiAgICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuLAogICAgICAgICAgICAgICAgICBmaWVsZDogaW5kZXhQYXR0ZXJuLmZpZWxkcy5nZXRCeU5hbWUoZmllbGQuZ2V0Um9vdE5hbWUoKSksCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gOTsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIlVuYWJsZSB0byBmZXRjaCBzdWdnZXN0aW9ucyBmb3IgZmllbGQ6ICIuY29uY2F0KGZpZWxkLmdldFJvb3ROYW1lKCksICIsIHF1ZXJ5OiAiKS5jb25jYXQocXVlcnksICIsIGVycm9yOiAiKS5jb25jYXQoX2NvbnRleHQudDAubWVzc2FnZSkpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgW10pOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1swLCA5XV0pOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94LCBfeDIpIHsKICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpKTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQWJzdHJhY3RFU1NvdXJjZSwgW3sKICAgIGtleTogImdldElkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3IuaWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNGaWVsZEF3YXJlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0ZpZWxkQXdhcmUoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImlzUmVmcmVzaFRpbWVyQXdhcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzUmVmcmVzaFRpbWVyQXdhcmUoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImlzUXVlcnlBd2FyZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNRdWVyeUF3YXJlKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbmRleFBhdHRlcm5JZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluZGV4UGF0dGVybklkcygpIHsKICAgICAgcmV0dXJuIFt0aGlzLmdldEluZGV4UGF0dGVybklkKCldOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFF1ZXJ5YWJsZUluZGV4UGF0dGVybklkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UXVlcnlhYmxlSW5kZXhQYXR0ZXJuSWRzKCkgewogICAgICBpZiAodGhpcy5nZXRBcHBseUdsb2JhbFF1ZXJ5KCkpIHsKICAgICAgICByZXR1cm4gW3RoaXMuZ2V0SW5kZXhQYXR0ZXJuSWQoKV07CiAgICAgIH0KCiAgICAgIHJldHVybiBbXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0VTU291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0VTU291cmNlKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICB0aGlzLl9pbnNwZWN0b3JBZGFwdGVycy5yZXF1ZXN0cy5yZXNldFJlcXVlc3QodGhpcy5nZXRJZCgpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjbG9uZURlc2NyaXB0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNsb25lRGVzY3JpcHRvcigpIHsKICAgICAgdmFyIGNsb25lZERlc2NyaXB0b3IgPSAoMCwgX3V0aWwuY29weVBlcnNpc3RlbnRTdGF0ZSkodGhpcy5fZGVzY3JpcHRvcik7IC8vIGlkIHVzZWQgYXMgdXVpZCB0byB0cmFjayByZXF1ZXN0cyBpbiBpbnNwZWN0b3IKCiAgICAgIGNsb25lZERlc2NyaXB0b3IuaWQgPSAoMCwgX3YuZGVmYXVsdCkoKTsKICAgICAgcmV0dXJuIGNsb25lZERlc2NyaXB0b3I7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3J1bkVzUXVlcnkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9ydW5Fc1F1ZXJ5MiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKF9yZWYyKSB7CiAgICAgICAgdmFyIHJlcXVlc3RJZCwgcmVxdWVzdE5hbWUsIHJlcXVlc3REZXNjcmlwdGlvbiwgc2VhcmNoU291cmNlLCByZWdpc3RlckNhbmNlbENhbGxiYWNrLCBhYm9ydENvbnRyb2xsZXI7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJlcXVlc3RJZCA9IF9yZWYyLnJlcXVlc3RJZCwgcmVxdWVzdE5hbWUgPSBfcmVmMi5yZXF1ZXN0TmFtZSwgcmVxdWVzdERlc2NyaXB0aW9uID0gX3JlZjIucmVxdWVzdERlc2NyaXB0aW9uLCBzZWFyY2hTb3VyY2UgPSBfcmVmMi5zZWFyY2hTb3VyY2UsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2sgPSBfcmVmMi5yZWdpc3RlckNhbmNlbENhbGxiYWNrOwogICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwogICAgICAgICAgICAgICAgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBhYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAzOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfa2liYW5hX3NlcnZpY2VzLmZldGNoU2VhcmNoU291cmNlQW5kUmVjb3JkV2l0aEluc3BlY3RvcikoewogICAgICAgICAgICAgICAgICBpbnNwZWN0b3JBZGFwdGVyczogdGhpcy5faW5zcGVjdG9yQWRhcHRlcnMsCiAgICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICAgICAgICAgICAgICByZXF1ZXN0TmFtZTogcmVxdWVzdE5hbWUsCiAgICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogcmVxdWVzdElkLAogICAgICAgICAgICAgICAgICByZXF1ZXN0RGVzYzogcmVxdWVzdERlc2NyaXB0aW9uLAogICAgICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogYWJvcnRDb250cm9sbGVyLnNpZ25hbAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDIuc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gOTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgzKTsKCiAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDIudDAubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX2RhdGFfcmVxdWVzdC5EYXRhUmVxdWVzdEFib3J0RXJyb3IoKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTb3VyY2UucmVxdWVzdEZhaWxlZEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFbGFzdGljc2VhcmNoIHNlYXJjaCByZXF1ZXN0IGZhaWxlZCwgZXJyb3I6IHttZXNzYWdlfSIsCiAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IF9jb250ZXh0Mi50MC5tZXNzYWdlCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcywgW1szLCA5XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfcnVuRXNRdWVyeShfeDMpIHsKICAgICAgICByZXR1cm4gX3J1bkVzUXVlcnkyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcnVuRXNRdWVyeTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogIm1ha2VTZWFyY2hTb3VyY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9tYWtlU2VhcmNoU291cmNlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoc2VhcmNoRmlsdGVycywgbGltaXQsIGluaXRpYWxTZWFyY2hDb250ZXh0KSB7CiAgICAgICAgdmFyIGluZGV4UGF0dGVybiwgaXNUaW1lQXdhcmUsIGFwcGx5R2xvYmFsUXVlcnksIGdsb2JhbEZpbHRlcnMsIGFsbEZpbHRlcnMsIGdlb0ZpZWxkLCBidWZmZXIsIHNlYXJjaFNvdXJjZSwgbGF5ZXJTZWFyY2hTb3VyY2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVGltZUF3YXJlKCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIGlzVGltZUF3YXJlID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBhcHBseUdsb2JhbFF1ZXJ5ID0gX2xvZGFzaC5kZWZhdWx0LmdldChzZWFyY2hGaWx0ZXJzLCAnYXBwbHlHbG9iYWxRdWVyeScsIHRydWUpOwogICAgICAgICAgICAgICAgZ2xvYmFsRmlsdGVycyA9IGFwcGx5R2xvYmFsUXVlcnkgPyBzZWFyY2hGaWx0ZXJzLmZpbHRlcnMgOiBbXTsKICAgICAgICAgICAgICAgIGFsbEZpbHRlcnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoZ2xvYmFsRmlsdGVycyk7CgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5pc0ZpbHRlckJ5TWFwQm91bmRzKCkgJiYgc2VhcmNoRmlsdGVycy5idWZmZXIpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0R2VvRmllbGQoKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGdlb0ZpZWxkID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBidWZmZXIgPSB0aGlzLmlzR2VvR3JpZFByZWNpc2lvbkF3YXJlKCkgPyAoMCwgX2dlb190aWxlX3V0aWxzLmV4cGFuZFRvVGlsZUJvdW5kYXJpZXMpKHNlYXJjaEZpbHRlcnMuYnVmZmVyLCBzZWFyY2hGaWx0ZXJzLmdlb2dyaWRQcmVjaXNpb24pIDogc2VhcmNoRmlsdGVycy5idWZmZXI7CiAgICAgICAgICAgICAgICBhbGxGaWx0ZXJzLnB1c2goKDAsIF9lbGFzdGljc2VhcmNoX2dlb191dGlscy5jcmVhdGVFeHRlbnRGaWx0ZXIpKGJ1ZmZlciwgZ2VvRmllbGQubmFtZSwgZ2VvRmllbGQudHlwZSkpOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgaWYgKGlzVGltZUF3YXJlKSB7CiAgICAgICAgICAgICAgICAgIGFsbEZpbHRlcnMucHVzaCgoMCwgX2tpYmFuYV9zZXJ2aWNlcy5nZXRUaW1lRmlsdGVyKSgpLmNyZWF0ZUZpbHRlcihpbmRleFBhdHRlcm4sIHNlYXJjaEZpbHRlcnMudGltZUZpbHRlcnMpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBuZXcgX2tpYmFuYV9zZXJ2aWNlcy5TZWFyY2hTb3VyY2UoaW5pdGlhbFNlYXJjaENvbnRleHQpOwogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIGluZGV4UGF0dGVybik7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3NpemUnLCBsaW1pdCk7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2ZpbHRlcicsIGFsbEZpbHRlcnMpOwoKICAgICAgICAgICAgICAgIGlmIChhcHBseUdsb2JhbFF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgncXVlcnknLCBzZWFyY2hGaWx0ZXJzLnF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc2VhcmNoRmlsdGVycy5zb3VyY2VRdWVyeSkgewogICAgICAgICAgICAgICAgICBsYXllclNlYXJjaFNvdXJjZSA9IG5ldyBfa2liYW5hX3NlcnZpY2VzLlNlYXJjaFNvdXJjZSgpOwogICAgICAgICAgICAgICAgICBsYXllclNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnaW5kZXgnLCBpbmRleFBhdHRlcm4pOwogICAgICAgICAgICAgICAgICBsYXllclNlYXJjaFNvdXJjZS5zZXRGaWVsZCgncXVlcnknLCBzZWFyY2hGaWx0ZXJzLnNvdXJjZVF1ZXJ5KTsKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldFBhcmVudChsYXllclNlYXJjaFNvdXJjZSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHNlYXJjaFNvdXJjZSk7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBtYWtlU2VhcmNoU291cmNlKF94NCwgX3g1LCBfeDYpIHsKICAgICAgICByZXR1cm4gX21ha2VTZWFyY2hTb3VyY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1ha2VTZWFyY2hTb3VyY2U7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJnZXRCb3VuZHNGb3JGaWx0ZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Qm91bmRzRm9yRmlsdGVycyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWYzKSB7CiAgICAgICAgdmFyIHNvdXJjZVF1ZXJ5LCBxdWVyeSwgdGltZUZpbHRlcnMsIGZpbHRlcnMsIGFwcGx5R2xvYmFsUXVlcnksIHNlYXJjaFNvdXJjZSwgZXNCb3VuZHMsIGVzUmVzcDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgc291cmNlUXVlcnkgPSBfcmVmMy5zb3VyY2VRdWVyeSwgcXVlcnkgPSBfcmVmMy5xdWVyeSwgdGltZUZpbHRlcnMgPSBfcmVmMy50aW1lRmlsdGVycywgZmlsdGVycyA9IF9yZWYzLmZpbHRlcnMsIGFwcGx5R2xvYmFsUXVlcnkgPSBfcmVmMy5hcHBseUdsb2JhbFF1ZXJ5OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZVNlYXJjaFNvdXJjZSh7CiAgICAgICAgICAgICAgICAgIHNvdXJjZVF1ZXJ5OiBzb3VyY2VRdWVyeSwKICAgICAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgICAgICB0aW1lRmlsdGVyczogdGltZUZpbHRlcnMsCiAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMsCiAgICAgICAgICAgICAgICAgIGFwcGx5R2xvYmFsUXVlcnk6IGFwcGx5R2xvYmFsUXVlcnkKICAgICAgICAgICAgICAgIH0sIDApOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnYWdncycsIHsKICAgICAgICAgICAgICAgICAgZml0VG9Cb3VuZHM6IHsKICAgICAgICAgICAgICAgICAgICBnZW9fYm91bmRzOiB7CiAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogdGhpcy5fZGVzY3JpcHRvci5nZW9GaWVsZAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDU7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VhcmNoU291cmNlLmZldGNoKCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGVzUmVzcCA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgZXNCb3VuZHMgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KGVzUmVzcCwgJ2FnZ3JlZ2F0aW9ucy5maXRUb0JvdW5kcy5ib3VuZHMnKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oNSk7CiAgICAgICAgICAgICAgICBlc0JvdW5kcyA9IHsKICAgICAgICAgICAgICAgICAgdG9wX2xlZnQ6IHsKICAgICAgICAgICAgICAgICAgICBsYXQ6IDkwLAogICAgICAgICAgICAgICAgICAgIGxvbjogLTE4MAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBib3R0b21fcmlnaHQ6IHsKICAgICAgICAgICAgICAgICAgICBsYXQ6IC05MCwKICAgICAgICAgICAgICAgICAgICBsb246IDE4MAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgbWluX2xvbjogZXNCb3VuZHMudG9wX2xlZnQubG9uLAogICAgICAgICAgICAgICAgICBtYXhfbG9uOiBlc0JvdW5kcy5ib3R0b21fcmlnaHQubG9uLAogICAgICAgICAgICAgICAgICBtaW5fbGF0OiBlc0JvdW5kcy5ib3R0b21fcmlnaHQubGF0LAogICAgICAgICAgICAgICAgICBtYXhfbGF0OiBlc0JvdW5kcy50b3BfbGVmdC5sYXQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzLCBbWzUsIDEyXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRCb3VuZHNGb3JGaWx0ZXJzKF94NykgewogICAgICAgIHJldHVybiBfZ2V0Qm91bmRzRm9yRmlsdGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Qm91bmRzRm9yRmlsdGVyczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImlzVGltZUF3YXJlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaXNUaW1lQXdhcmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuLCB0aW1lRmllbGQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIHRpbWVGaWVsZCA9IGluZGV4UGF0dGVybi50aW1lRmllbGROYW1lOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsICEhdGltZUZpZWxkKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgX2NvbnRleHQ1LnByZXYgPSA4OwogICAgICAgICAgICAgICAgX2NvbnRleHQ1LnQwID0gX2NvbnRleHQ1WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIGZhbHNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1swLCA4XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBpc1RpbWVBd2FyZSgpIHsKICAgICAgICByZXR1cm4gX2lzVGltZUF3YXJlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpc1RpbWVBd2FyZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEluZGV4UGF0dGVybklkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleFBhdHRlcm5JZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3IuaW5kZXhQYXR0ZXJuSWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0R2VvRmllbGROYW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRHZW9GaWVsZE5hbWUoKSB7CiAgICAgIHJldHVybiB0aGlzLl9kZXNjcmlwdG9yLmdlb0ZpZWxkOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZGV4UGF0dGVybiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEluZGV4UGF0dGVybiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHRoaXMuaW5kZXhQYXR0ZXJuKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAyOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldEluZGV4UGF0dGVyblNlcnZpY2UpKCkuZ2V0KHRoaXMuZ2V0SW5kZXhQYXR0ZXJuSWQoKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHRoaXMuaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgdGhpcy5pbmRleFBhdHRlcm4pOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMik7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzU291cmNlLm5vSW5kZXhQYXR0ZXJuRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlVuYWJsZSB0byBmaW5kIEluZGV4IHBhdHRlcm4gZm9yIGlkOiB7aW5kZXhQYXR0ZXJuSWR9IiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuSWQ6IHRoaXMuZ2V0SW5kZXhQYXR0ZXJuSWQoKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMsIFtbMiwgOV1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0SW5kZXhQYXR0ZXJuKCkgewogICAgICAgIHJldHVybiBfZ2V0SW5kZXhQYXR0ZXJuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRJbmRleFBhdHRlcm47CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJzdXBwb3J0c0ZpdFRvQm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfc3VwcG9ydHNGaXRUb0JvdW5kcyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBnZW9GaWVsZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ3LnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEdlb0ZpZWxkKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGdlb0ZpZWxkID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgZ2VvRmllbGQudHlwZSAhPT0gX2NvbnN0YW50cy5FU19HRU9fRklFTERfVFlQRS5HRU9fU0hBUEUpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dDcudDAgPSBfY29udGV4dDdbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzLCBbWzAsIDddXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHN1cHBvcnRzRml0VG9Cb3VuZHMoKSB7CiAgICAgICAgcmV0dXJuIF9zdXBwb3J0c0ZpdFRvQm91bmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdXBwb3J0c0ZpdFRvQm91bmRzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2dldEdlb0ZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0R2VvRmllbGQyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoKSB7CiAgICAgICAgdmFyIGluZGV4UGF0dGVybiwgZ2VvRmllbGQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgIGdlb0ZpZWxkID0gaW5kZXhQYXR0ZXJuLmZpZWxkcy5nZXRCeU5hbWUodGhpcy5fZGVzY3JpcHRvci5nZW9GaWVsZCk7CgogICAgICAgICAgICAgICAgaWYgKGdlb0ZpZWxkKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NvdXJjZS5ub0dlb0ZpZWxkRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IHBhdHRlcm4ge2luZGV4UGF0dGVyblRpdGxlfSBubyBsb25nZXIgY29udGFpbnMgdGhlIGdlbyBmaWVsZCB7Z2VvRmllbGR9IiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGU6IGluZGV4UGF0dGVybi50aXRsZSwKICAgICAgICAgICAgICAgICAgICBnZW9GaWVsZDogdGhpcy5fZGVzY3JpcHRvci5nZW9GaWVsZAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBnZW9GaWVsZCk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9nZXRHZW9GaWVsZCgpIHsKICAgICAgICByZXR1cm4gX2dldEdlb0ZpZWxkMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX2dldEdlb0ZpZWxkOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0RGlzcGxheU5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXREaXNwbGF5TmFtZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBpbmRleFBhdHRlcm47CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBpbmRleFBhdHRlcm4udGl0bGUpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDkucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dDkudDAgPSBfY29udGV4dDlbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgdGhpcy5nZXRJbmRleFBhdHRlcm5JZCgpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcywgW1swLCA3XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXREaXNwbGF5TmFtZSgpIHsKICAgICAgICByZXR1cm4gX2dldERpc3BsYXlOYW1lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXREaXNwbGF5TmFtZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImlzQm91bmRzQXdhcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzQm91bmRzQXdhcmUoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImdldElkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3IuaWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiY3JlYXRlRmllbGRGb3JtYXR0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9jcmVhdGVGaWVsZEZvcm1hdHRlciA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChmaWVsZCkgewogICAgICAgIHZhciBpbmRleFBhdHRlcm4sIGZpZWxkRnJvbUluZGV4UGF0dGVybjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAucHJldiA9IDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5wcmV2ID0gNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAudDAgPSBfY29udGV4dDEwWyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgZmllbGRGcm9tSW5kZXhQYXR0ZXJuID0gaW5kZXhQYXR0ZXJuLmZpZWxkcy5nZXRCeU5hbWUoZmllbGQuZ2V0Um9vdE5hbWUoKSk7CgogICAgICAgICAgICAgICAgaWYgKGZpZWxkRnJvbUluZGV4UGF0dGVybikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgZmllbGRGcm9tSW5kZXhQYXR0ZXJuLmZvcm1hdC5nZXRDb252ZXJ0ZXJGb3IoJ3RleHQnKSk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcywgW1swLCA2XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVGaWVsZEZvcm1hdHRlcihfeDgpIHsKICAgICAgICByZXR1cm4gX2NyZWF0ZUZpZWxkRm9ybWF0dGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjcmVhdGVGaWVsZEZvcm1hdHRlcjsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImxvYWRTdHlsZVByb3BzTWV0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2xvYWRTdHlsZVByb3BzTWV0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShsYXllck5hbWUsIHN0eWxlLCBkeW5hbWljU3R5bGVQcm9wcywgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaywgc2VhcmNoRmlsdGVycykgewogICAgICAgIHZhciBwcm9taXNlcywgZmllbGRBZ2dSZXF1ZXN0cywgYWdncywgaW5kZXhQYXR0ZXJuLCBzZWFyY2hTb3VyY2UsIHJlc3A7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBwcm9taXNlcyA9IGR5bmFtaWNTdHlsZVByb3BzLm1hcChmdW5jdGlvbiAoZHluYW1pY1N0eWxlUHJvcCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gZHluYW1pY1N0eWxlUHJvcC5nZXRGaWVsZE1ldGFSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBmaWVsZEFnZ1JlcXVlc3RzID0gX2NvbnRleHQxMS5zZW50OwogICAgICAgICAgICAgICAgYWdncyA9IGZpZWxkQWdnUmVxdWVzdHMucmVkdWNlKGZ1bmN0aW9uIChhZ2dzLCBmaWVsZEFnZ1JlcXVlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkQWdnUmVxdWVzdCA/IF9vYmplY3RTcHJlYWQoe30sIGFnZ3MsIHt9LCBmaWVsZEFnZ1JlcXVlc3QpIDogYWdnczsKICAgICAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQxMS5zZW50OwogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlID0gbmV3IF9raWJhbmFfc2VydmljZXMuU2VhcmNoU291cmNlKCk7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2luZGV4JywgaW5kZXhQYXR0ZXJuKTsKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnc2l6ZScsIDApOwogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdhZ2dzJywgYWdncyk7CgogICAgICAgICAgICAgICAgaWYgKHNlYXJjaEZpbHRlcnMuc291cmNlUXVlcnkpIHsKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdxdWVyeScsIHNlYXJjaEZpbHRlcnMuc291cmNlUXVlcnkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEudDAgPSBzdHlsZS5pc1RpbWVBd2FyZSgpOwoKICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQxMS50MCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1RpbWVBd2FyZSgpOwoKICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS50MCA9IF9jb250ZXh0MTEuc2VudDsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIGlmICghX2NvbnRleHQxMS50MCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAyMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCBbKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0VGltZUZpbHRlcikoKS5jcmVhdGVGaWx0ZXIoaW5kZXhQYXR0ZXJuLCBzZWFyY2hGaWx0ZXJzLnRpbWVGaWx0ZXJzKV0pOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVuRXNRdWVyeSh7CiAgICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogIiIuY29uY2F0KHRoaXMuZ2V0SWQoKSwgIl9zdHlsZU1ldGEiKSwKICAgICAgICAgICAgICAgICAgcmVxdWVzdE5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NvdXJjZS5zdHlsZVByb3BzTWV0YVJlcXVlc3ROYW1lJywgewogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne2xheWVyTmFtZX0gLSBtZXRhZGF0YScsCiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgICBsYXllck5hbWU6IGxheWVyTmFtZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICAgICAgICAgICAgICByZWdpc3RlckNhbmNlbENhbGxiYWNrOiByZWdpc3RlckNhbmNlbENhbGxiYWNrLAogICAgICAgICAgICAgICAgICByZXF1ZXN0RGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NvdXJjZS5zdHlsZVByb3BzTWV0YVJlcXVlc3REZXNjcmlwdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0VsYXN0aWNzZWFyY2ggcmVxdWVzdCByZXRyaWV2aW5nIGZpZWxkIG1ldGFkYXRhIHVzZWQgZm9yIGNhbGN1bGF0aW5nIHN5bWJvbGl6YXRpb24gYmFuZHMuJwogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQxMS5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCByZXNwLmFnZ3JlZ2F0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGxvYWRTdHlsZVByb3BzTWV0YShfeDksIF94MTAsIF94MTEsIF94MTIsIF94MTMpIHsKICAgICAgICByZXR1cm4gX2xvYWRTdHlsZVByb3BzTWV0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gbG9hZFN0eWxlUHJvcHNNZXRhOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gQWJzdHJhY3RFU1NvdXJjZTsKfShfdmVjdG9yX3NvdXJjZS5BYnN0cmFjdFZlY3RvclNvdXJjZSk7CgpleHBvcnRzLkFic3RyYWN0RVNTb3VyY2UgPSBBYnN0cmFjdEVTU291cmNlOwoKX2RlZmluZVByb3BlcnR5KEFic3RyYWN0RVNTb3VyY2UsICJpY29uIiwgJ2xvZ29FbGFzdGljc2VhcmNoJyk7"},null]}