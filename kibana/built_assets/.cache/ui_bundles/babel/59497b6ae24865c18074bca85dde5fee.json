{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/plugins/index_management/public/application/components/mappings_editor/lib/utils.js","dependencies":[{"path":"x-pack/plugins/index_management/public/application/components/mappings_editor/lib/utils.js","mtime":1589249554124},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmlzU3RhdGVWYWxpZCA9IGV4cG9ydHMuY2FuVXNlTWFwcGluZ3NFZGl0b3IgPSBleHBvcnRzLnNob3VsZERlbGV0ZUNoaWxkRmllbGRzQWZ0ZXJUeXBlQ2hhbmdlID0gZXhwb3J0cy5idWlsZEZpZWxkVHJlZUZyb21JZHMgPSBleHBvcnRzLmdldE1heE5lc3RlZERlcHRoID0gZXhwb3J0cy5maWx0ZXJUeXBlc0Zvck5vblJvb3RGaWVsZHMgPSBleHBvcnRzLmZpbHRlclR5cGVzRm9yTXVsdGlGaWVsZCA9IGV4cG9ydHMuZ2V0RmllbGRBbmNlc3RvcnMgPSBleHBvcnRzLmdldEFsbERlc2NlbmRhbnRBbGlhc2VzID0gZXhwb3J0cy5nZXRBbGxDaGlsZEZpZWxkcyA9IGV4cG9ydHMudXBkYXRlRmllbGRzUGF0aEFmdGVyRmllbGROYW1lQ2hhbmdlID0gZXhwb3J0cy5kZU5vcm1hbGl6ZSA9IGV4cG9ydHMubm9ybWFsaXplID0gZXhwb3J0cy5nZXRNYWluVHlwZUZyb21TdWJUeXBlID0gZXhwb3J0cy5nZXRGaWVsZENvbmZpZyA9IGV4cG9ydHMuZ2V0VHlwZUxhYmVsRnJvbVR5cGUgPSBleHBvcnRzLmdldEZpZWxkTWV0YSA9IGV4cG9ydHMuZ2V0VW5pcXVlSWQgPSB2b2lkIDA7Cgp2YXIgX3V1aWQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInV1aWQiKSk7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4uL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKCiAgdmFyIHRhcmdldCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpOwoKICB2YXIga2V5LCBpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7CgogICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZVN5bWJvbEtleXMubGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0gc291cmNlU3ltYm9sS2V5c1tpXTsKICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoc291cmNlLCBrZXkpKSBjb250aW51ZTsKICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICB2YXIgdGFyZ2V0ID0ge307CiAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwogIHZhciBrZXksIGk7CgogIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9Cgp2YXIgZ2V0VW5pcXVlSWQgPSBmdW5jdGlvbiBnZXRVbmlxdWVJZCgpIHsKICByZXR1cm4gX3V1aWQuZGVmYXVsdC52NCgpOwp9OwoKZXhwb3J0cy5nZXRVbmlxdWVJZCA9IGdldFVuaXF1ZUlkOwoKdmFyIGdldENoaWxkRmllbGRzTmFtZSA9IGZ1bmN0aW9uIGdldENoaWxkRmllbGRzTmFtZShkYXRhVHlwZSkgewogIGlmIChkYXRhVHlwZSA9PT0gJ3RleHQnIHx8IGRhdGFUeXBlID09PSAna2V5d29yZCcpIHsKICAgIHJldHVybiAnZmllbGRzJzsKICB9IGVsc2UgaWYgKGRhdGFUeXBlID09PSAnb2JqZWN0JyB8fCBkYXRhVHlwZSA9PT0gJ25lc3RlZCcpIHsKICAgIHJldHVybiAncHJvcGVydGllcyc7CiAgfQoKICByZXR1cm4gdW5kZWZpbmVkOwp9OwoKdmFyIGdldEZpZWxkTWV0YSA9IGZ1bmN0aW9uIGdldEZpZWxkTWV0YShmaWVsZCwgaXNNdWx0aUZpZWxkKSB7CiAgdmFyIGNoaWxkRmllbGRzTmFtZSA9IGdldENoaWxkRmllbGRzTmFtZShmaWVsZC50eXBlKTsKICB2YXIgY2FuSGF2ZUNoaWxkRmllbGRzID0gaXNNdWx0aUZpZWxkID8gZmFsc2UgOiBjaGlsZEZpZWxkc05hbWUgPT09ICdwcm9wZXJ0aWVzJzsKICB2YXIgaGFzQ2hpbGRGaWVsZHMgPSBpc011bHRpRmllbGQgPyBmYWxzZSA6IGNhbkhhdmVDaGlsZEZpZWxkcyAmJiBCb29sZWFuKGZpZWxkW2NoaWxkRmllbGRzTmFtZV0pICYmIE9iamVjdC5rZXlzKGZpZWxkW2NoaWxkRmllbGRzTmFtZV0pLmxlbmd0aCA+IDA7CiAgdmFyIGNhbkhhdmVNdWx0aUZpZWxkcyA9IGNoaWxkRmllbGRzTmFtZSA9PT0gJ2ZpZWxkcyc7CiAgdmFyIGhhc011bHRpRmllbGRzID0gY2FuSGF2ZU11bHRpRmllbGRzICYmIEJvb2xlYW4oZmllbGRbY2hpbGRGaWVsZHNOYW1lXSkgJiYgT2JqZWN0LmtleXMoZmllbGRbY2hpbGRGaWVsZHNOYW1lXSkubGVuZ3RoID4gMDsKICByZXR1cm4gewogICAgY2hpbGRGaWVsZHNOYW1lOiBjaGlsZEZpZWxkc05hbWUsCiAgICBjYW5IYXZlQ2hpbGRGaWVsZHM6IGNhbkhhdmVDaGlsZEZpZWxkcywKICAgIGhhc0NoaWxkRmllbGRzOiBoYXNDaGlsZEZpZWxkcywKICAgIGNhbkhhdmVNdWx0aUZpZWxkczogY2FuSGF2ZU11bHRpRmllbGRzLAogICAgaGFzTXVsdGlGaWVsZHM6IGhhc011bHRpRmllbGRzLAogICAgaXNFeHBhbmRlZDogZmFsc2UKICB9Owp9OwoKZXhwb3J0cy5nZXRGaWVsZE1ldGEgPSBnZXRGaWVsZE1ldGE7Cgp2YXIgZ2V0VHlwZUxhYmVsRnJvbVR5cGUgPSBmdW5jdGlvbiBnZXRUeXBlTGFiZWxGcm9tVHlwZSh0eXBlKSB7CiAgcmV0dXJuIF9jb25zdGFudHMuVFlQRV9ERUZJTklUSU9OW3R5cGVdID8gX2NvbnN0YW50cy5UWVBFX0RFRklOSVRJT05bdHlwZV0ubGFiZWwgOiAiIi5jb25jYXQoX2NvbnN0YW50cy5UWVBFX0RFRklOSVRJT04ub3RoZXIubGFiZWwsICI6ICIpLmNvbmNhdCh0eXBlKTsKfTsKCmV4cG9ydHMuZ2V0VHlwZUxhYmVsRnJvbVR5cGUgPSBnZXRUeXBlTGFiZWxGcm9tVHlwZTsKCnZhciBnZXRGaWVsZENvbmZpZyA9IGZ1bmN0aW9uIGdldEZpZWxkQ29uZmlnKHBhcmFtLCBwcm9wKSB7CiAgdmFyIF9yZWY7CgogIGlmIChwcm9wICE9PSB1bmRlZmluZWQpIHsKICAgIHZhciBfcHJvcHMkcHJvcDsKCiAgICBpZiAoIV9jb25zdGFudHMuUEFSQU1FVEVSU19ERUZJTklUSU9OW3BhcmFtXS5wcm9wcyB8fCAhX2NvbnN0YW50cy5QQVJBTUVURVJTX0RFRklOSVRJT05bcGFyYW1dLnByb3BzW3Byb3BdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gZmllbGQgY29uZmlnIGZvdW5kIGZvciBwcm9wIFwiIi5jb25jYXQocHJvcCwgIlwiIG9uIHBhcmFtIFwiIikuY29uY2F0KHBhcmFtLCAiXCIgIikpOwogICAgfQoKICAgIHJldHVybiAoKF9wcm9wcyRwcm9wID0gX2NvbnN0YW50cy5QQVJBTUVURVJTX0RFRklOSVRJT05bcGFyYW1dLnByb3BzW3Byb3BdKSA9PT0gbnVsbCB8fCBfcHJvcHMkcHJvcCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3Byb3BzJHByb3AuZmllbGRDb25maWcpIHx8IHt9OwogIH0KCiAgcmV0dXJuICgoX3JlZiA9IF9jb25zdGFudHMuUEFSQU1FVEVSU19ERUZJTklUSU9OW3BhcmFtXSkgPT09IG51bGwgfHwgX3JlZiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3JlZi5maWVsZENvbmZpZykgfHwge307Cn07Ci8qKgogKiBGb3IgImFsaWFzIiBmaWVsZCB0eXBlcywgd2Ugd29yayBpbnRlcm5hbHkgYnkgImlkIiByZWZlcmVuY2VzLiBXaGVuIHdlIG5vcm1hbGl6ZSB0aGUgZmllbGRzLCB3ZSBuZWVkIHRvCiAqIHJlcGxhY2UgdGhlIGFjdHVhbCAicGF0aCIgcGFyYW1ldGVyIHdpdGggdGhlIGZpZWxkIChpbnRlcm5hbCkgYGlkYCB0aGUgYWxpYXMgcG9pbnRzIHRvLgogKiBUaGlzIG1ldGhvZCB0YWtlcyBjYXJlIG9mIGRvaW5nIGp1c3QgdGhhdC4KICoKICogQHBhcmFtIGJ5SWQgVGhlIGZpZWxkcyBtYXAgYnkgaWQKICovCgoKZXhwb3J0cy5nZXRGaWVsZENvbmZpZyA9IGdldEZpZWxkQ29uZmlnOwoKdmFyIHJlcGxhY2VBbGlhc1BhdGhCeUFsaWFzSWQgPSBmdW5jdGlvbiByZXBsYWNlQWxpYXNQYXRoQnlBbGlhc0lkKGJ5SWQpIHsKICB2YXIgYWxpYXNlcyA9IHt9OwogIE9iamVjdC5lbnRyaWVzKGJ5SWQpLmZvckVhY2goZnVuY3Rpb24gKF9yZWYyKSB7CiAgICB2YXIgX3JlZjMgPSBfc2xpY2VkVG9BcnJheShfcmVmMiwgMiksCiAgICAgICAgaWQgPSBfcmVmM1swXSwKICAgICAgICBmaWVsZCA9IF9yZWYzWzFdOwoKICAgIGlmIChmaWVsZC5zb3VyY2UudHlwZSA9PT0gJ2FsaWFzJykgewogICAgICB2YXIgYWxpYXNUYXJnZXRGaWVsZCA9IE9iamVjdC52YWx1ZXMoYnlJZCkuZmluZChmdW5jdGlvbiAoX2ZpZWxkKSB7CiAgICAgICAgcmV0dXJuIF9maWVsZC5wYXRoLmpvaW4oJy4nKSA9PT0gZmllbGQuc291cmNlLnBhdGg7CiAgICAgIH0pOwoKICAgICAgaWYgKGFsaWFzVGFyZ2V0RmllbGQpIHsKICAgICAgICAvLyB3ZSBzZXQgdGhlIHBhdGggdG8gdGhlIGFsaWFzVGFyZ2V0RmllbGQgImlkIgogICAgICAgIGZpZWxkLnNvdXJjZS5wYXRoID0gYWxpYXNUYXJnZXRGaWVsZC5pZDsgLy8gV2UgYWRkIHRoZSBhbGlhcyBmaWVsZCB0byBvdXIgImFsaWFzZXMiIG1hcAoKICAgICAgICBhbGlhc2VzW2FsaWFzVGFyZ2V0RmllbGQuaWRdID0gYWxpYXNlc1thbGlhc1RhcmdldEZpZWxkLmlkXSB8fCBbXTsKICAgICAgICBhbGlhc2VzW2FsaWFzVGFyZ2V0RmllbGQuaWRdLnB1c2goaWQpOwogICAgICB9CiAgICB9CiAgfSk7CiAgcmV0dXJuIHsKICAgIGFsaWFzZXM6IGFsaWFzZXMsCiAgICBieUlkOiBieUlkCiAgfTsKfTsKCnZhciBnZXRNYWluVHlwZUZyb21TdWJUeXBlID0gZnVuY3Rpb24gZ2V0TWFpblR5cGVGcm9tU3ViVHlwZShzdWJUeXBlKSB7CiAgdmFyIF9TVUJfVFlQRV9NQVBfVE9fTUFJTjsKCiAgcmV0dXJuIChfU1VCX1RZUEVfTUFQX1RPX01BSU4gPSBfY29uc3RhbnRzLlNVQl9UWVBFX01BUF9UT19NQUlOW3N1YlR5cGVdKSAhPT0gbnVsbCAmJiBfU1VCX1RZUEVfTUFQX1RPX01BSU4gIT09IHZvaWQgMCA/IF9TVUJfVFlQRV9NQVBfVE9fTUFJTiA6ICdvdGhlcic7Cn07Ci8qKgogKiBJbiBvcmRlciB0byBiZXR0ZXIgd29yayB3aXRoIHRoZSByZWN1cnNpdmUgcGF0dGVybiBvZiB0aGUgbWFwcGluZ3MgYHByb3BlcnRpZXNgLCB0aGlzIG1ldGhvZCBmbGF0dGVuIHRoZSBmaWVsZHMKICogdG8gYSBgYnlJZGAgb2JqZWN0IHdoZXJlIHRoZSBrZXkgaXMgdGhlICoqcGF0aCoqIHRvIHRoZSBmaWVsZCBhbmQgdGhlIHZhbHVlIGlzIGEgYE5vcm1hbGl6ZWRGaWVsZGAuCiAqIFRoZSBgTm9ybWFsaXplZEZpZWxkYCBjb250YWlucyB0aGUgZmllbGQgZGF0YSB1bmRlciBgc291cmNlYCBhbmQgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgY2FwYWJpbGl0eSBvZiB0aGUgZmllbGQuCiAqCiAqIEBleGFtcGxlCgovLyBvcmlnaW5hbAp7CiAgbXlPYmplY3Q6IHsKICAgIHR5cGU6ICdvYmplY3QnLAogICAgcHJvcGVydGllczogewogICAgICBuYW1lOiB7CiAgICAgICAgdHlwZTogJ3RleHQnCiAgICAgIH0KICAgIH0KICB9Cn0KCi8vIG5vcm1hbGl6ZWQKewogIHJvb3RMZXZlbEZpZWxkczogWydfdW5pcXVlSWQxMjMnXSwKICBieUlkOiB7CiAgICAnX3VuaXF1ZUlkMTIzJzogewogICAgICBzb3VyY2U6IHsgdHlwZTogJ29iamVjdCcgfSwKICAgICAgaWQ6ICdfdW5pcXVlSWQxMjMnLAogICAgICBwYXJlbnRJZDogdW5kZWZpbmVkLAogICAgICBoYXNDaGlsZEZpZWxkczogdHJ1ZSwKICAgICAgY2hpbGRGaWVsZHNOYW1lOiAncHJvcGVydGllcycsIC8vICJvYmplY3QiIHR5cGUgaGF2ZSB0aGVpciBjaGlsZCBmaWVsZHMgdW5kZXIgInByb3BlcnRpZXMiCiAgICAgIGNhbkhhdmVDaGlsZEZpZWxkczogdHJ1ZSwKICAgICAgY2hpbGRGaWVsZHM6IFsnX3VuaXF1ZUlkNDU2J10sCiAgICB9LAogICAgJ191bmlxdWVJZDQ1Nic6IHsKICAgICAgc291cmNlOiB7IHR5cGU6ICd0ZXh0JyB9LAogICAgICBpZDogJ191bmlxdWVJZDQ1NicsCiAgICAgIHBhcmVudElkOiAnX3VuaXF1ZUlkMTIzJywKICAgICAgaGFzQ2hpbGRGaWVsZHM6IGZhbHNlLAogICAgICBjaGlsZEZpZWxkc05hbWU6ICdmaWVsZHMnLCAvLyAidGV4dCIgdHlwZSBoYXZlIHRoZWlyIGNoaWxkIGZpZWxkcyB1bmRlciAiZmllbGRzIgogICAgICBjYW5IYXZlQ2hpbGRGaWVsZHM6IHRydWUsCiAgICAgIGNoaWxkRmllbGRzOiB1bmRlZmluZWQsCiAgICB9LAogIH0sCn0KICoKICogQHBhcmFtIGZpZWxkc1RvTm9ybWFsaXplIFRoZSAicHJvcGVydGllcyIgb2JqZWN0IGZyb20gdGhlIG1hcHBpbmdzIChvciAiZmllbGRzIiBvYmplY3QgZm9yIGB0ZXh0YCBhbmQgYGtleXdvcmRgIHR5cGVzKQogKi8KCgpleHBvcnRzLmdldE1haW5UeXBlRnJvbVN1YlR5cGUgPSBnZXRNYWluVHlwZUZyb21TdWJUeXBlOwoKdmFyIG5vcm1hbGl6ZSA9IGZ1bmN0aW9uIG5vcm1hbGl6ZShmaWVsZHNUb05vcm1hbGl6ZSkgewogIHZhciBtYXhOZXN0ZWREZXB0aCA9IDA7CgogIHZhciBub3JtYWxpemVGaWVsZHMgPSBmdW5jdGlvbiBub3JtYWxpemVGaWVsZHMocHJvcHMsIHRvLCBwYXRocywgYXJyYXlUb0tlZXBSZWYsIG5lc3RlZERlcHRoKSB7CiAgICB2YXIgaXNNdWx0aUZpZWxkID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgJiYgYXJndW1lbnRzWzVdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNV0gOiBmYWxzZTsKICAgIHZhciBwYXJlbnRJZCA9IGFyZ3VtZW50cy5sZW5ndGggPiA2ID8gYXJndW1lbnRzWzZdIDogdW5kZWZpbmVkOwogICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHByb3BzKS5zb3J0KGZ1bmN0aW9uIChfcmVmNCwgX3JlZjUpIHsKICAgICAgdmFyIF9yZWY2ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjQsIDEpLAogICAgICAgICAgYSA9IF9yZWY2WzBdOwoKICAgICAgdmFyIF9yZWY3ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjUsIDEpLAogICAgICAgICAgYiA9IF9yZWY3WzBdOwoKICAgICAgcmV0dXJuIGEgPiBiID8gMSA6IGEgPCBiID8gLTEgOiAwOwogICAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIF9yZWY4KSB7CiAgICAgIHZhciBfcmVmOSA9IF9zbGljZWRUb0FycmF5KF9yZWY4LCAyKSwKICAgICAgICAgIHByb3BOYW1lID0gX3JlZjlbMF0sCiAgICAgICAgICB2YWx1ZSA9IF9yZWY5WzFdOwoKICAgICAgdmFyIGlkID0gZ2V0VW5pcXVlSWQoKTsKICAgICAgYXJyYXlUb0tlZXBSZWYucHVzaChpZCk7CgogICAgICB2YXIgZmllbGQgPSBfb2JqZWN0U3ByZWFkKHsKICAgICAgICBuYW1lOiBwcm9wTmFtZQogICAgICB9LCB2YWx1ZSk7IC8vIEluIHNvbWUgY2FzZXMgZm9yIG9iamVjdCwgdGhlICJ0eXBlIiBpcyBub3QgZGVmaW5lZCBidXQgdGhlIGZpZWxkCiAgICAgIC8vIGhhcyBwcm9wZXJ0aWVzIGRlZmluZWQuIFRoZSBtYXBwaW5ncyBlZGl0b3IgcmVxdWlyZXMgYSAidHlwZSIgdG8gYmUgZGVmaW5lZAogICAgICAvLyBzbyB3ZSBhZGQgaXQgaGVyZS4KCgogICAgICBpZiAoZmllbGQudHlwZSA9PT0gdW5kZWZpbmVkICYmIGZpZWxkLnByb3BlcnRpZXMgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZpZWxkLnR5cGUgPSAnb2JqZWN0JzsKICAgICAgfQoKICAgICAgdmFyIG1ldGEgPSBnZXRGaWVsZE1ldGEoZmllbGQsIGlzTXVsdGlGaWVsZCk7CiAgICAgIHZhciBjaGlsZEZpZWxkc05hbWUgPSBtZXRhLmNoaWxkRmllbGRzTmFtZSwKICAgICAgICAgIGhhc0NoaWxkRmllbGRzID0gbWV0YS5oYXNDaGlsZEZpZWxkcywKICAgICAgICAgIGhhc011bHRpRmllbGRzID0gbWV0YS5oYXNNdWx0aUZpZWxkczsKCiAgICAgIGlmIChoYXNDaGlsZEZpZWxkcyB8fCBoYXNNdWx0aUZpZWxkcykgewogICAgICAgIHZhciBuZXh0RGVwdGggPSBtZXRhLmNhbkhhdmVDaGlsZEZpZWxkcyB8fCBtZXRhLmNhbkhhdmVNdWx0aUZpZWxkcyA/IG5lc3RlZERlcHRoICsgMSA6IG5lc3RlZERlcHRoOwogICAgICAgIG1ldGEuY2hpbGRGaWVsZHMgPSBbXTsKICAgICAgICBtYXhOZXN0ZWREZXB0aCA9IE1hdGgubWF4KG1heE5lc3RlZERlcHRoLCBuZXh0RGVwdGgpOwogICAgICAgIG5vcm1hbGl6ZUZpZWxkcyhmaWVsZFtjaGlsZEZpZWxkc05hbWVdLCB0bywgW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShwYXRocyksIFtwcm9wTmFtZV0pLCBtZXRhLmNoaWxkRmllbGRzLCBuZXh0RGVwdGgsIG1ldGEuY2FuSGF2ZU11bHRpRmllbGRzLCBpZCk7CiAgICAgIH0KCiAgICAgIHZhciBwcm9wZXJ0aWVzID0gZmllbGQucHJvcGVydGllcywKICAgICAgICAgIGZpZWxkcyA9IGZpZWxkLmZpZWxkcywKICAgICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoZmllbGQsIFsicHJvcGVydGllcyIsICJmaWVsZHMiXSk7CgogICAgICB2YXIgbm9ybWFsaXplZEZpZWxkID0gX29iamVjdFNwcmVhZCh7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIHBhcmVudElkOiBwYXJlbnRJZCwKICAgICAgICBuZXN0ZWREZXB0aDogbmVzdGVkRGVwdGgsCiAgICAgICAgaXNNdWx0aUZpZWxkOiBpc011bHRpRmllbGQsCiAgICAgICAgcGF0aDogcGF0aHMubGVuZ3RoID8gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShwYXRocyksIFtwcm9wTmFtZV0pIDogW3Byb3BOYW1lXSwKICAgICAgICBzb3VyY2U6IHJlc3QKICAgICAgfSwgbWV0YSk7CgogICAgICBhY2NbaWRdID0gbm9ybWFsaXplZEZpZWxkOwogICAgICByZXR1cm4gYWNjOwogICAgfSwgdG8pOwogIH07CgogIHZhciByb290TGV2ZWxGaWVsZHMgPSBbXTsKCiAgdmFyIF9yZXBsYWNlQWxpYXNQYXRoQnlBbCA9IHJlcGxhY2VBbGlhc1BhdGhCeUFsaWFzSWQobm9ybWFsaXplRmllbGRzKGZpZWxkc1RvTm9ybWFsaXplLCB7fSwgW10sIHJvb3RMZXZlbEZpZWxkcywgMCkpLAogICAgICBieUlkID0gX3JlcGxhY2VBbGlhc1BhdGhCeUFsLmJ5SWQsCiAgICAgIGFsaWFzZXMgPSBfcmVwbGFjZUFsaWFzUGF0aEJ5QWwuYWxpYXNlczsKCiAgcmV0dXJuIHsKICAgIGJ5SWQ6IGJ5SWQsCiAgICBhbGlhc2VzOiBhbGlhc2VzLAogICAgcm9vdExldmVsRmllbGRzOiByb290TGV2ZWxGaWVsZHMsCiAgICBtYXhOZXN0ZWREZXB0aDogbWF4TmVzdGVkRGVwdGgKICB9Owp9OwovKioKICogVGhlIGFsaWFzICJwYXRoIiB2YWx1ZSBpbnRlcm5hbGx5IHBvaW50IHRvIGEgZmllbGQgImlkIiAobm90IGl0cyBwYXRoKS4gV2hlbiB3ZSBkZU5vcm1hbGl6ZSB0aGUgZmllbGRzLAogKiB3ZSBuZWVkIHRvIHJlcGxhY2UgdGhlIHRhcmdldCBmaWVsZCAiaWQiIGJ5IGl0cyBhY3R1YWwgInBhdGgiLCBtYWtpbmcgc3VyZSB0byBub3QgbXV0YXRlIG91ciBzdGF0ZSAiZmllbGRzIiBvYmplY3QuCiAqCiAqIEBwYXJhbSBhbGlhc2VzIFRoZSBhbGlhc2VzIG1hcAogKiBAcGFyYW0gYnlJZCBUaGUgZmllbGRzIG1hcCBieSBpZAogKi8KCgpleHBvcnRzLm5vcm1hbGl6ZSA9IG5vcm1hbGl6ZTsKCnZhciByZXBsYWNlQWxpYXNJZEJ5QWxpYXNQYXRoID0gZnVuY3Rpb24gcmVwbGFjZUFsaWFzSWRCeUFsaWFzUGF0aChhbGlhc2VzLCBieUlkKSB7CiAgdmFyIHVwZGF0ZWRCeUlkID0gX29iamVjdFNwcmVhZCh7fSwgYnlJZCk7CgogIE9iamVjdC5lbnRyaWVzKGFsaWFzZXMpLmZvckVhY2goZnVuY3Rpb24gKF9yZWYxMCkgewogICAgdmFyIF9yZWYxMSA9IF9zbGljZWRUb0FycmF5KF9yZWYxMCwgMiksCiAgICAgICAgdGFyZ2V0SWQgPSBfcmVmMTFbMF0sCiAgICAgICAgYWxpYXNlc0lkcyA9IF9yZWYxMVsxXTsKCiAgICB2YXIgcGF0aCA9IHVwZGF0ZWRCeUlkW3RhcmdldElkXSA/IHVwZGF0ZWRCeUlkW3RhcmdldElkXS5wYXRoLmpvaW4oJy4nKSA6ICcnOwogICAgYWxpYXNlc0lkcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICB2YXIgYWxpYXNGaWVsZCA9IHVwZGF0ZWRCeUlkW2lkXTsKCiAgICAgIGlmICghYWxpYXNGaWVsZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZpZWxkV2l0aFVwZGF0ZWRQYXRoID0gX29iamVjdFNwcmVhZCh7fSwgYWxpYXNGaWVsZCwgewogICAgICAgIHNvdXJjZTogX29iamVjdFNwcmVhZCh7fSwgYWxpYXNGaWVsZC5zb3VyY2UsIHsKICAgICAgICAgIHBhdGg6IHBhdGgKICAgICAgICB9KQogICAgICB9KTsKCiAgICAgIHVwZGF0ZWRCeUlkW2lkXSA9IGZpZWxkV2l0aFVwZGF0ZWRQYXRoOwogICAgfSk7CiAgfSk7CiAgcmV0dXJuIHVwZGF0ZWRCeUlkOwp9OwoKdmFyIGRlTm9ybWFsaXplID0gZnVuY3Rpb24gZGVOb3JtYWxpemUoX3JlZjEyKSB7CiAgdmFyIHJvb3RMZXZlbEZpZWxkcyA9IF9yZWYxMi5yb290TGV2ZWxGaWVsZHMsCiAgICAgIGJ5SWQgPSBfcmVmMTIuYnlJZCwKICAgICAgYWxpYXNlcyA9IF9yZWYxMi5hbGlhc2VzOwogIHZhciBzZXJpYWxpemVkRmllbGRzQnlJZCA9IHJlcGxhY2VBbGlhc0lkQnlBbGlhc1BhdGgoYWxpYXNlcywgYnlJZCk7CgogIHZhciBkZU5vcm1hbGl6ZVBhdGhzID0gZnVuY3Rpb24gZGVOb3JtYWxpemVQYXRocyhpZHMpIHsKICAgIHZhciB0byA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICBpZHMuZm9yRWFjaChmdW5jdGlvbiAoaWQpIHsKICAgICAgdmFyIF9zZXJpYWxpemVkRmllbGRzQnlJZCA9IHNlcmlhbGl6ZWRGaWVsZHNCeUlkW2lkXSwKICAgICAgICAgIHNvdXJjZSA9IF9zZXJpYWxpemVkRmllbGRzQnlJZC5zb3VyY2UsCiAgICAgICAgICBjaGlsZEZpZWxkcyA9IF9zZXJpYWxpemVkRmllbGRzQnlJZC5jaGlsZEZpZWxkcywKICAgICAgICAgIGNoaWxkRmllbGRzTmFtZSA9IF9zZXJpYWxpemVkRmllbGRzQnlJZC5jaGlsZEZpZWxkc05hbWU7CgogICAgICB2YXIgbmFtZSA9IHNvdXJjZS5uYW1lLAogICAgICAgICAgbm9ybWFsaXplZEZpZWxkID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgWyJuYW1lIl0pOwoKICAgICAgdmFyIGZpZWxkID0gbm9ybWFsaXplZEZpZWxkOwogICAgICB0b1tuYW1lXSA9IGZpZWxkOwoKICAgICAgaWYgKGNoaWxkRmllbGRzKSB7CiAgICAgICAgZmllbGRbY2hpbGRGaWVsZHNOYW1lXSA9IHt9OwogICAgICAgIHJldHVybiBkZU5vcm1hbGl6ZVBhdGhzKGNoaWxkRmllbGRzLCBmaWVsZFtjaGlsZEZpZWxkc05hbWVdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdG87CiAgfTsKCiAgcmV0dXJuIGRlTm9ybWFsaXplUGF0aHMocm9vdExldmVsRmllbGRzKTsKfTsKLyoqCiAqIElmIHdlIGNoYW5nZSB0aGUgIm5hbWUiIG9mIGEgZmllbGQsIHdlIG5lZWQgdG8gdXBkYXRlIGl0cyBgcGF0aGAgYW5kIHRoZQogKiBvbmUgb2YgKiphbGwqKiBvZiBpdHMgY2hpbGQgcHJvcGVydGllcyBvciBtdWx0aS1maWVsZHMuCiAqCiAqIEBwYXJhbSBmaWVsZCBUaGUgZmllbGQgd2hvJ3MgbmFtZSBoYXMgY2hhbmdlZAogKiBAcGFyYW0gYnlJZCBUaGUgbWFwIG9mIGFsbCB0aGUgZG9jdW1lbnQgZmllbGRzCiAqLwoKCmV4cG9ydHMuZGVOb3JtYWxpemUgPSBkZU5vcm1hbGl6ZTsKCnZhciB1cGRhdGVGaWVsZHNQYXRoQWZ0ZXJGaWVsZE5hbWVDaGFuZ2UgPSBmdW5jdGlvbiB1cGRhdGVGaWVsZHNQYXRoQWZ0ZXJGaWVsZE5hbWVDaGFuZ2UoZmllbGQsIGJ5SWQpIHsKICB2YXIgdXBkYXRlZEJ5SWQgPSBfb2JqZWN0U3ByZWFkKHt9LCBieUlkKTsKCiAgdmFyIHBhdGhzID0gZmllbGQucGFyZW50SWQgPyBieUlkW2ZpZWxkLnBhcmVudElkXS5wYXRoIDogW107CgogIHZhciB1cGRhdGVGaWVsZFBhdGggPSBmdW5jdGlvbiB1cGRhdGVGaWVsZFBhdGgoX2ZpZWxkLCBfcGF0aHMpIHsKICAgIHZhciBuYW1lID0gX2ZpZWxkLnNvdXJjZS5uYW1lOwogICAgdmFyIHBhdGggPSBfcGF0aHMubGVuZ3RoID09PSAwID8gW25hbWVdIDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfcGF0aHMpLCBbbmFtZV0pOwogICAgdXBkYXRlZEJ5SWRbX2ZpZWxkLmlkXSA9IF9vYmplY3RTcHJlYWQoe30sIF9maWVsZCwgewogICAgICBwYXRoOiBwYXRoCiAgICB9KTsKCiAgICBpZiAoX2ZpZWxkLmhhc0NoaWxkRmllbGRzIHx8IF9maWVsZC5oYXNNdWx0aUZpZWxkcykgewogICAgICBfZmllbGQuY2hpbGRGaWVsZHMubWFwKGZ1bmN0aW9uIChmaWVsZElkKSB7CiAgICAgICAgcmV0dXJuIGJ5SWRbZmllbGRJZF07CiAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkRmllbGQpIHsKICAgICAgICB1cGRhdGVGaWVsZFBhdGgoY2hpbGRGaWVsZCwgW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfcGF0aHMpLCBbbmFtZV0pKTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdXBkYXRlRmllbGRQYXRoKGZpZWxkLCBwYXRocyk7CiAgcmV0dXJuIHsKICAgIHVwZGF0ZWRGaWVsZFBhdGg6IHVwZGF0ZWRCeUlkW2ZpZWxkLmlkXS5wYXRoLAogICAgdXBkYXRlZEJ5SWQ6IHVwZGF0ZWRCeUlkCiAgfTsKfTsKLyoqCiAqIFJldHJpZXZlIHJlY3Vyc2l2ZWx5IGFsbCB0aGUgY2hpbGRyZW4gZmllbGRzIG9mIGEgZmllbGQKICoKICogQHBhcmFtIGZpZWxkIFRoZSBmaWVsZCB0byByZXR1cm4gdGhlIGNoaWxkcmVuIGZyb20KICogQHBhcmFtIGJ5SWQgTWFwIG9mIGFsbCB0aGUgZG9jdW1lbnQgZmllbGRzCiAqLwoKCmV4cG9ydHMudXBkYXRlRmllbGRzUGF0aEFmdGVyRmllbGROYW1lQ2hhbmdlID0gdXBkYXRlRmllbGRzUGF0aEFmdGVyRmllbGROYW1lQ2hhbmdlOwoKdmFyIGdldEFsbENoaWxkRmllbGRzID0gZnVuY3Rpb24gZ2V0QWxsQ2hpbGRGaWVsZHMoZmllbGQsIGJ5SWQpIHsKICB2YXIgZ2V0Q2hpbGRGaWVsZHMgPSBmdW5jdGlvbiBnZXRDaGlsZEZpZWxkcyhfZmllbGQpIHsKICAgIHZhciB0byA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogW107CgogICAgaWYgKF9maWVsZC5oYXNDaGlsZEZpZWxkcyB8fCBfZmllbGQuaGFzTXVsdGlGaWVsZHMpIHsKICAgICAgX2ZpZWxkLmNoaWxkRmllbGRzLm1hcChmdW5jdGlvbiAoZmllbGRJZCkgewogICAgICAgIHJldHVybiBieUlkW2ZpZWxkSWRdOwogICAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZEZpZWxkKSB7CiAgICAgICAgdG8ucHVzaChjaGlsZEZpZWxkKTsKICAgICAgICBnZXRDaGlsZEZpZWxkcyhjaGlsZEZpZWxkLCB0byk7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiB0bzsKICB9OwoKICByZXR1cm4gZ2V0Q2hpbGRGaWVsZHMoZmllbGQpOwp9OwovKioKICogSWYgd2UgZGVsZXRlIGFuIG9iamVjdCB3aXRoIGNoaWxkIGZpZWxkcyBvciBhIHRleHQva2V5d29yZCB3aXRoIG11bHRpLWZpZWxkLAogKiB3ZSBuZWVkIHRvIGtub3cgaWYgYW55IG9mIGl0cyAiY2hpbGQiIGZpZWxkcyBoYXMgYW4gYGFsaWFzYCB0aGF0IHBvaW50cyB0byBpdC4KICogVGhpcyBtZXRob2QgdHJhdmVyc2UgdGhlIGZpZWxkIGRlc2NlbmRhbnQgdHJlZSBhbmQgcmV0dXJucyBhbGwgdGhlIGFsaWFzZXMgZm91bmQKICogb24gdGhlIGZpZWxkIGFuZCBpdHMgcG9zc2libGUgY2hpbGRyZW4uCiAqLwoKCmV4cG9ydHMuZ2V0QWxsQ2hpbGRGaWVsZHMgPSBnZXRBbGxDaGlsZEZpZWxkczsKCnZhciBnZXRBbGxEZXNjZW5kYW50QWxpYXNlcyA9IGZ1bmN0aW9uIGdldEFsbERlc2NlbmRhbnRBbGlhc2VzKGZpZWxkLCBmaWVsZHMpIHsKICB2YXIgYWxpYXNlc0lkcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogW107CiAgdmFyIGhhc0FsaWFzZXMgPSBmaWVsZHMuYWxpYXNlc1tmaWVsZC5pZF0gJiYgQm9vbGVhbihmaWVsZHMuYWxpYXNlc1tmaWVsZC5pZF0ubGVuZ3RoKTsKCiAgaWYgKCFoYXNBbGlhc2VzICYmICFmaWVsZC5oYXNDaGlsZEZpZWxkcyAmJiAhZmllbGQuaGFzTXVsdGlGaWVsZHMpIHsKICAgIHJldHVybiBhbGlhc2VzSWRzOwogIH0KCiAgaWYgKGhhc0FsaWFzZXMpIHsKICAgIGZpZWxkcy5hbGlhc2VzW2ZpZWxkLmlkXS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICBhbGlhc2VzSWRzLnB1c2goaWQpOwogICAgfSk7CiAgfQoKICBpZiAoZmllbGQuY2hpbGRGaWVsZHMpIHsKICAgIGZpZWxkLmNoaWxkRmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgIGlmICghZmllbGRzLmJ5SWRbaWRdKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBnZXRBbGxEZXNjZW5kYW50QWxpYXNlcyhmaWVsZHMuYnlJZFtpZF0sIGZpZWxkcywgYWxpYXNlc0lkcyk7CiAgICB9KTsKICB9CgogIHJldHVybiBhbGlhc2VzSWRzOwp9OwovKioKICogSGVscGVyIHRvIHJldHJpZXZlIGEgbWFwIG9mIGFsbCB0aGUgYW5jZXN0b3JzIG9mIGEgZmllbGQKICoKICogQHBhcmFtIGZpZWxkSWQgVGhlIGZpZWxkIGlkCiAqIEBwYXJhbSBieUlkIEEgbWFwIG9mIGFsbCB0aGUgZmllbGRzIGJ5IElkCiAqLwoKCmV4cG9ydHMuZ2V0QWxsRGVzY2VuZGFudEFsaWFzZXMgPSBnZXRBbGxEZXNjZW5kYW50QWxpYXNlczsKCnZhciBnZXRGaWVsZEFuY2VzdG9ycyA9IGZ1bmN0aW9uIGdldEZpZWxkQW5jZXN0b3JzKGZpZWxkSWQsIGJ5SWQpIHsKICB2YXIgYW5jZXN0b3JzID0ge307CiAgdmFyIGN1cnJlbnRGaWVsZCA9IGJ5SWRbZmllbGRJZF07CiAgdmFyIHBhcmVudCA9IGN1cnJlbnRGaWVsZC5wYXJlbnRJZCA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogYnlJZFtjdXJyZW50RmllbGQucGFyZW50SWRdOwoKICB3aGlsZSAocGFyZW50KSB7CiAgICBhbmNlc3RvcnNbcGFyZW50LmlkXSA9IHRydWU7CiAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50SWQgPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IGJ5SWRbcGFyZW50LnBhcmVudElkXTsKICB9CgogIHJldHVybiBhbmNlc3RvcnM7Cn07CgpleHBvcnRzLmdldEZpZWxkQW5jZXN0b3JzID0gZ2V0RmllbGRBbmNlc3RvcnM7Cgp2YXIgZmlsdGVyVHlwZXNGb3JNdWx0aUZpZWxkID0gZnVuY3Rpb24gZmlsdGVyVHlwZXNGb3JNdWx0aUZpZWxkKG9wdGlvbnMpIHsKICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKG9wdGlvbikgewogICAgcmV0dXJuIF9jb25zdGFudHMuVFlQRV9OT1RfQUxMT1dFRF9NVUxUSUZJRUxELmluY2x1ZGVzKG9wdGlvbi52YWx1ZSkgPT09IGZhbHNlOwogIH0pOwp9OwoKZXhwb3J0cy5maWx0ZXJUeXBlc0Zvck11bHRpRmllbGQgPSBmaWx0ZXJUeXBlc0Zvck11bHRpRmllbGQ7Cgp2YXIgZmlsdGVyVHlwZXNGb3JOb25Sb290RmllbGRzID0gZnVuY3Rpb24gZmlsdGVyVHlwZXNGb3JOb25Sb290RmllbGRzKG9wdGlvbnMpIHsKICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoZnVuY3Rpb24gKG9wdGlvbikgewogICAgcmV0dXJuIF9jb25zdGFudHMuVFlQRV9PTkxZX0FMTE9XRURfQVRfUk9PVF9MRVZFTC5pbmNsdWRlcyhvcHRpb24udmFsdWUpID09PSBmYWxzZTsKICB9KTsKfTsKLyoqCiAqIFJldHVybiB0aGUgbWF4IG5lc3RlZCBkZXB0aCBvZiB0aGUgZG9jdW1lbnQgZmllbGRzCiAqCiAqIEBwYXJhbSBieUlkIE1hcCBvZiBhbGwgdGhlIGRvY3VtZW50IGZpZWxkcwogKi8KCgpleHBvcnRzLmZpbHRlclR5cGVzRm9yTm9uUm9vdEZpZWxkcyA9IGZpbHRlclR5cGVzRm9yTm9uUm9vdEZpZWxkczsKCnZhciBnZXRNYXhOZXN0ZWREZXB0aCA9IGZ1bmN0aW9uIGdldE1heE5lc3RlZERlcHRoKGJ5SWQpIHsKICByZXR1cm4gT2JqZWN0LnZhbHVlcyhieUlkKS5yZWR1Y2UoZnVuY3Rpb24gKG1heERlcHRoLCBmaWVsZCkgewogICAgcmV0dXJuIE1hdGgubWF4KG1heERlcHRoLCBmaWVsZC5uZXN0ZWREZXB0aCk7CiAgfSwgMCk7Cn07Ci8qKgogKiBDcmVhdGUgYSBuZXN0ZWQgYXJyYXkgb2YgZmllbGRzIGFuZCBpdHMgcG9zc2libGUgY2hpbGRyZW4KICogdG8gcmVuZGVyIGEgVHJlZSB2aWV3IG9mIHRoZW0uCiAqLwoKCmV4cG9ydHMuZ2V0TWF4TmVzdGVkRGVwdGggPSBnZXRNYXhOZXN0ZWREZXB0aDsKCnZhciBidWlsZEZpZWxkVHJlZUZyb21JZHMgPSBmdW5jdGlvbiBidWlsZEZpZWxkVHJlZUZyb21JZHMoZmllbGRzSWRzLCBieUlkLCByZW5kZXIpIHsKICByZXR1cm4gZmllbGRzSWRzLm1hcChmdW5jdGlvbiAoaWQpIHsKICAgIHZhciBmaWVsZCA9IGJ5SWRbaWRdOwogICAgdmFyIGNoaWxkcmVuID0gZmllbGQuY2hpbGRGaWVsZHMgPyBidWlsZEZpZWxkVHJlZUZyb21JZHMoZmllbGQuY2hpbGRGaWVsZHMsIGJ5SWQsIHJlbmRlcikgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gewogICAgICBsYWJlbDogcmVuZGVyKGZpZWxkKSwKICAgICAgY2hpbGRyZW46IGNoaWxkcmVuCiAgICB9OwogIH0pOwp9OwovKioKICogV2hlbiBjaGFuZ2luZyB0aGUgdHlwZSBvZiBhIGZpZWxkLCBpbiBtb3N0IGNhc2VzIHdlIHdhbnQgdG8gZGVsZXRlIGFsbCBpdHMgY2hpbGQgZmllbGRzLgogKiBUaGVyZSBhcmUgc29tZSBleGNlcHRpb25zLCB3aGVuIGNoYW5naW5nIGZyb20gInRleHQiIHRvICJrZXl3b3JkIiBhcyBib3RoIGhhdmUgdGhlIHNhbWUgImZpZWxkcyIgcHJvcGVydHkuCiAqLwoKCmV4cG9ydHMuYnVpbGRGaWVsZFRyZWVGcm9tSWRzID0gYnVpbGRGaWVsZFRyZWVGcm9tSWRzOwoKdmFyIHNob3VsZERlbGV0ZUNoaWxkRmllbGRzQWZ0ZXJUeXBlQ2hhbmdlID0gZnVuY3Rpb24gc2hvdWxkRGVsZXRlQ2hpbGRGaWVsZHNBZnRlclR5cGVDaGFuZ2Uob2xkVHlwZSwgbmV3VHlwZSkgewogIGlmIChvbGRUeXBlID09PSAndGV4dCcgJiYgbmV3VHlwZSAhPT0gJ2tleXdvcmQnKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9IGVsc2UgaWYgKG9sZFR5cGUgPT09ICdrZXl3b3JkJyAmJiBuZXdUeXBlICE9PSAndGV4dCcpIHsKICAgIHJldHVybiB0cnVlOwogIH0gZWxzZSBpZiAob2xkVHlwZSA9PT0gJ29iamVjdCcgJiYgbmV3VHlwZSAhPT0gJ25lc3RlZCcpIHsKICAgIHJldHVybiB0cnVlOwogIH0gZWxzZSBpZiAob2xkVHlwZSA9PT0gJ25lc3RlZCcgJiYgbmV3VHlwZSAhPT0gJ29iamVjdCcpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgcmV0dXJuIGZhbHNlOwp9OwoKZXhwb3J0cy5zaG91bGREZWxldGVDaGlsZEZpZWxkc0FmdGVyVHlwZUNoYW5nZSA9IHNob3VsZERlbGV0ZUNoaWxkRmllbGRzQWZ0ZXJUeXBlQ2hhbmdlOwoKdmFyIGNhblVzZU1hcHBpbmdzRWRpdG9yID0gZnVuY3Rpb24gY2FuVXNlTWFwcGluZ3NFZGl0b3IobWF4TmVzdGVkRGVwdGgpIHsKICByZXR1cm4gbWF4TmVzdGVkRGVwdGggPCBfY29uc3RhbnRzLk1BWF9ERVBUSF9ERUZBVUxUX0VESVRPUjsKfTsKCmV4cG9ydHMuY2FuVXNlTWFwcGluZ3NFZGl0b3IgPSBjYW5Vc2VNYXBwaW5nc0VkaXRvcjsKdmFyIHN0YXRlV2l0aFZhbGlkaXR5ID0gWydjb25maWd1cmF0aW9uJywgJ2ZpZWxkc0pzb25FZGl0b3InLCAnZmllbGRGb3JtJ107Cgp2YXIgaXNTdGF0ZVZhbGlkID0gZnVuY3Rpb24gaXNTdGF0ZVZhbGlkKHN0YXRlKSB7CiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHN0YXRlKS5maWx0ZXIoZnVuY3Rpb24gKF9yZWYxMykgewogICAgdmFyIF9yZWYxNCA9IF9zbGljZWRUb0FycmF5KF9yZWYxMywgMSksCiAgICAgICAga2V5ID0gX3JlZjE0WzBdOwoKICAgIHJldHVybiBzdGF0ZVdpdGhWYWxpZGl0eS5pbmNsdWRlcyhrZXkpOwogIH0pLnJlZHVjZShmdW5jdGlvbiAoaXNWYWxpZCwgX3JlZjE1KSB7CiAgICB2YXIgdmFsdWUgPSBfcmVmMTVbMV07CgogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIGlzVmFsaWQ7CiAgICB9IC8vIElmIG9uZSBzZWN0aW9uIHZhbGlkaXR5IG9mIHRoZSBzdGF0ZSBpcyAidW5kZWZpbmVkIiwgdGhlIG1hcHBpbmdzIHZhbGlkaXR5IGlzIGFsc28gInVuZGVmaW5lZCIKCgogICAgaWYgKGlzVmFsaWQgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZS5pc1ZhbGlkID09PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KCiAgICByZXR1cm4gaXNWYWxpZCAmJiB2YWx1ZS5pc1ZhbGlkOwogIH0sIHRydWUpOwp9OwoKZXhwb3J0cy5pc1N0YXRlVmFsaWQgPSBpc1N0YXRlVmFsaWQ7"},null]}