{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/visualizations/public/np_ready/public/legacy/build_pipeline.js","dependencies":[{"path":"src/legacy/core_plugins/visualizations/public/np_ready/public/legacy/build_pipeline.js","mtime":1589249550166},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuYnVpbGRQaXBlbGluZSA9IGV4cG9ydHMuYnVpbGRWaXNsaWJEaW1lbnNpb25zID0gZXhwb3J0cy5idWlsZFBpcGVsaW5lVmlzRnVuY3Rpb24gPSBleHBvcnRzLnByZXBhcmVEaW1lbnNpb24gPSBleHBvcnRzLnByZXBhcmVWYWx1ZSA9IGV4cG9ydHMucHJlcGFyZVN0cmluZyA9IGV4cG9ydHMuZXNjYXBlU3RyaW5nID0gZXhwb3J0cy5wcmVwYXJlSnNvbiA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gcmVxdWlyZSgibG9kYXNoIik7Cgp2YXIgX21vbWVudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibW9tZW50IikpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wbHVnaW5zL2RhdGEvcHVibGljIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKdmFyIGlzRGF0ZUhpc3RvZ3JhbUJ1Y2tldEFnZ0NvbmZpZyA9IF9wdWJsaWMuc2VhcmNoLmFnZ3MuaXNEYXRlSGlzdG9ncmFtQnVja2V0QWdnQ29uZmlnOwp2YXIgdmlzbGliQ2hhcnRzID0gWydhcmVhJywgJ2dhdWdlJywgJ2dvYWwnLCAnaGVhdG1hcCcsICdoaXN0b2dyYW0nLCAnaG9yaXpvbnRhbF9iYXInLCAnbGluZSddOwoKdmFyIGdldFNjaGVtYXMgPSBmdW5jdGlvbiBnZXRTY2hlbWFzKHZpcywgb3B0cykgewogIHZhciB0aW1lUmFuZ2UgPSBvcHRzLnRpbWVSYW5nZSwKICAgICAgdGltZWZpbHRlciA9IG9wdHMudGltZWZpbHRlcjsKCiAgdmFyIGNyZWF0ZVNjaGVtYUNvbmZpZyA9IGZ1bmN0aW9uIGNyZWF0ZVNjaGVtYUNvbmZpZyhhY2Nlc3NvciwgYWdnKSB7CiAgICBpZiAoaXNEYXRlSGlzdG9ncmFtQnVja2V0QWdnQ29uZmlnKGFnZykpIHsKICAgICAgYWdnLnBhcmFtcy50aW1lUmFuZ2UgPSB0aW1lUmFuZ2U7CiAgICAgIHZhciBib3VuZHMgPSBhZ2cucGFyYW1zLnRpbWVSYW5nZSA/IHRpbWVmaWx0ZXIuY2FsY3VsYXRlQm91bmRzKGFnZy5wYXJhbXMudGltZVJhbmdlKSA6IG51bGw7CiAgICAgIGFnZy5idWNrZXRzLnNldEJvdW5kcyhhZ2cuZmllbGRJc1RpbWVGaWVsZCgpICYmIGJvdW5kcyk7CiAgICAgIGFnZy5idWNrZXRzLnNldEludGVydmFsKGFnZy5wYXJhbXMuaW50ZXJ2YWwpOwogICAgfQoKICAgIHZhciBoYXNTdWJBZ2cgPSBbJ2Rlcml2YXRpdmUnLCAnbW92aW5nX2F2ZycsICdzZXJpYWxfZGlmZicsICdjdW11bGF0aXZlX3N1bScsICdzdW1fYnVja2V0JywgJ2F2Z19idWNrZXQnLCAnbWluX2J1Y2tldCcsICdtYXhfYnVja2V0J10uaW5jbHVkZXMoYWdnLnR5cGUubmFtZSk7CgogICAgdmFyIGZvcm1hdCA9IF9wdWJsaWMuZmllbGRGb3JtYXRzLnNlcmlhbGl6ZShoYXNTdWJBZ2cgPyBhZ2cucGFyYW1zLmN1c3RvbU1ldHJpYyB8fCBhZ2cuYWdnQ29uZmlncy5nZXRSZXF1ZXN0QWdnQnlJZChhZ2cucGFyYW1zLm1ldHJpY0FnZykgOiBhZ2cpOwoKICAgIHZhciBwYXJhbXMgPSB7fTsKCiAgICBpZiAoYWdnLnR5cGUubmFtZSA9PT0gJ2dlb2hhc2hfZ3JpZCcpIHsKICAgICAgcGFyYW1zLnByZWNpc2lvbiA9IGFnZy5wYXJhbXMucHJlY2lzaW9uOwogICAgICBwYXJhbXMudXNlR2VvY2VudHJvaWQgPSBhZ2cucGFyYW1zLnVzZUdlb2NlbnRyb2lkOwogICAgfQoKICAgIHZhciBsYWJlbCA9IGFnZy5tYWtlTGFiZWwgJiYgYWdnLm1ha2VMYWJlbCgpOwogICAgcmV0dXJuIHsKICAgICAgYWNjZXNzb3I6IGFjY2Vzc29yLAogICAgICBmb3JtYXQ6IGZvcm1hdCwKICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgIGxhYmVsOiBsYWJlbCwKICAgICAgYWdnVHlwZTogYWdnLnR5cGUubmFtZQogICAgfTsKICB9OwoKICB2YXIgY250ID0gMDsKICB2YXIgc2NoZW1hcyA9IHsKICAgIG1ldHJpYzogW10KICB9OwoKICBpZiAoIXZpcy5kYXRhLmFnZ3MpIHsKICAgIHJldHVybiBzY2hlbWFzOwogIH0KCiAgdmFyIHJlc3BvbnNlQWdncyA9IHZpcy5kYXRhLmFnZ3MuZ2V0UmVzcG9uc2VBZ2dzKCkuZmlsdGVyKGZ1bmN0aW9uIChhZ2cpIHsKICAgIHJldHVybiBhZ2cuZW5hYmxlZDsKICB9KTsKICB2YXIgaXNIaWVyYXJjaGljYWwgPSB2aXMuaXNIaWVyYXJjaGljYWwoKTsKICB2YXIgbWV0cmljcyA9IHJlc3BvbnNlQWdncy5maWx0ZXIoZnVuY3Rpb24gKGFnZykgewogICAgcmV0dXJuIGFnZy50eXBlLnR5cGUgPT09ICdtZXRyaWNzJzsKICB9KTsKICByZXNwb25zZUFnZ3MuZm9yRWFjaChmdW5jdGlvbiAoYWdnKSB7CiAgICB2YXIgc2tpcE1ldHJpY3MgPSBmYWxzZTsKICAgIHZhciBzY2hlbWFOYW1lID0gYWdnLnNjaGVtYTsKCiAgICBpZiAoIXNjaGVtYU5hbWUpIHsKICAgICAgaWYgKGFnZy50eXBlLm5hbWUgPT09ICdnZW9fY2VudHJvaWQnKSB7CiAgICAgICAgc2NoZW1hTmFtZSA9ICdnZW9fY2VudHJvaWQnOwogICAgICB9IGVsc2UgewogICAgICAgIGNudCsrOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIGlmIChzY2hlbWFOYW1lID09PSAnc3BsaXQnKSB7CiAgICAgIHNjaGVtYU5hbWUgPSAic3BsaXRfIi5jb25jYXQodmlzLnBhcmFtcy5yb3cgPyAncm93JyA6ICdjb2x1bW4nKTsKICAgICAgc2tpcE1ldHJpY3MgPSByZXNwb25zZUFnZ3MubGVuZ3RoIC0gbWV0cmljcy5sZW5ndGggPiAxOwogICAgfQoKICAgIGlmICghc2NoZW1hc1tzY2hlbWFOYW1lXSkgewogICAgICBzY2hlbWFzW3NjaGVtYU5hbWVdID0gW107CiAgICB9CgogICAgaWYgKCFpc0hpZXJhcmNoaWNhbCB8fCBhZ2cudHlwZS50eXBlICE9PSAnbWV0cmljcycpIHsKICAgICAgc2NoZW1hc1tzY2hlbWFOYW1lXS5wdXNoKGNyZWF0ZVNjaGVtYUNvbmZpZyhjbnQrKywgYWdnKSk7CiAgICB9CgogICAgaWYgKGlzSGllcmFyY2hpY2FsICYmIChhZ2cudHlwZS50eXBlICE9PSAnbWV0cmljcycgfHwgbWV0cmljcy5sZW5ndGggPT09IHJlc3BvbnNlQWdncy5sZW5ndGgpKSB7CiAgICAgIG1ldHJpY3MuZm9yRWFjaChmdW5jdGlvbiAobWV0cmljKSB7CiAgICAgICAgdmFyIHNjaGVtYUNvbmZpZyA9IGNyZWF0ZVNjaGVtYUNvbmZpZyhjbnQrKywgbWV0cmljKTsKCiAgICAgICAgaWYgKCFza2lwTWV0cmljcykgewogICAgICAgICAgc2NoZW1hcy5tZXRyaWMucHVzaChzY2hlbWFDb25maWcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHNjaGVtYXM7Cn07Cgp2YXIgcHJlcGFyZUpzb24gPSBmdW5jdGlvbiBwcmVwYXJlSnNvbih2YXJpYWJsZSwgZGF0YSkgewogIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiAnJzsKICB9CgogIHJldHVybiAiIi5jb25jYXQodmFyaWFibGUsICI9JyIpLmNvbmNhdChKU09OLnN0cmluZ2lmeShkYXRhKS5yZXBsYWNlKC9cXC9nLCAiXFxcXCIpLnJlcGxhY2UoLycvZywgIlxcJyIpLCAiJyAiKTsKfTsKCmV4cG9ydHMucHJlcGFyZUpzb24gPSBwcmVwYXJlSnNvbjsKCnZhciBlc2NhcGVTdHJpbmcgPSBmdW5jdGlvbiBlc2NhcGVTdHJpbmcoZGF0YSkgewogIHJldHVybiBkYXRhLnJlcGxhY2UoL1xcL2csICJcXFxcIikucmVwbGFjZSgvJy9nLCAiXFwnIik7Cn07CgpleHBvcnRzLmVzY2FwZVN0cmluZyA9IGVzY2FwZVN0cmluZzsKCnZhciBwcmVwYXJlU3RyaW5nID0gZnVuY3Rpb24gcHJlcGFyZVN0cmluZyh2YXJpYWJsZSwgZGF0YSkgewogIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiAnJzsKICB9CgogIHJldHVybiAiIi5jb25jYXQodmFyaWFibGUsICI9JyIpLmNvbmNhdChlc2NhcGVTdHJpbmcoZGF0YSksICInICIpOwp9OwoKZXhwb3J0cy5wcmVwYXJlU3RyaW5nID0gcHJlcGFyZVN0cmluZzsKCnZhciBwcmVwYXJlVmFsdWUgPSBmdW5jdGlvbiBwcmVwYXJlVmFsdWUodmFyaWFibGUsIGRhdGEpIHsKICB2YXIgcmF3ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKCiAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKHJhdykgewogICAgcmV0dXJuICIiLmNvbmNhdCh2YXJpYWJsZSwgIj0iKS5jb25jYXQoZGF0YSwgIiAiKTsKICB9CgogIHN3aXRjaCAoX3R5cGVvZihkYXRhKSkgewogICAgY2FzZSAnc3RyaW5nJzoKICAgICAgcmV0dXJuIHByZXBhcmVTdHJpbmcodmFyaWFibGUsIGRhdGEpOwoKICAgIGNhc2UgJ29iamVjdCc6CiAgICAgIHJldHVybiBwcmVwYXJlSnNvbih2YXJpYWJsZSwgZGF0YSk7CgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuICIiLmNvbmNhdCh2YXJpYWJsZSwgIj0iKS5jb25jYXQoZGF0YSwgIiAiKTsKICB9Cn07CgpleHBvcnRzLnByZXBhcmVWYWx1ZSA9IHByZXBhcmVWYWx1ZTsKCnZhciBwcmVwYXJlRGltZW5zaW9uID0gZnVuY3Rpb24gcHJlcGFyZURpbWVuc2lvbih2YXJpYWJsZSwgZGF0YSkgewogIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiAnJzsKICB9CgogIHZhciBleHByID0gIiIuY29uY2F0KHZhcmlhYmxlLCAiPXt2aXNkaW1lbnNpb24gIikuY29uY2F0KGRhdGEuYWNjZXNzb3IsICIgIik7CgogIGlmIChkYXRhLmZvcm1hdCkgewogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ2Zvcm1hdCcsIGRhdGEuZm9ybWF0LmlkKTsKICAgIGV4cHIgKz0gcHJlcGFyZUpzb24oJ2Zvcm1hdFBhcmFtcycsIGRhdGEuZm9ybWF0LnBhcmFtcyk7CiAgfQoKICBleHByICs9ICd9ICc7CiAgcmV0dXJuIGV4cHI7Cn07CgpleHBvcnRzLnByZXBhcmVEaW1lbnNpb24gPSBwcmVwYXJlRGltZW5zaW9uOwoKdmFyIGFkanVzdFZpc2xpYkRpbWVuc2lvbkZvcm1tYXRlcnMgPSBmdW5jdGlvbiBhZGp1c3RWaXNsaWJEaW1lbnNpb25Gb3JtbWF0ZXJzKHZpcywgZGltZW5zaW9ucykgewogIHZhciB2aXNDb25maWcgPSB2aXMucGFyYW1zOwogIHZhciByZXNwb25zZUFnZ3MgPSB2aXMuZGF0YS5hZ2dzLmdldFJlc3BvbnNlQWdncygpLmZpbHRlcihmdW5jdGlvbiAoYWdnKSB7CiAgICByZXR1cm4gYWdnLmVuYWJsZWQ7CiAgfSk7CiAgKGRpbWVuc2lvbnMueSB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAoeURpbWVuc2lvbikgewogICAgdmFyIHlBZ2cgPSByZXNwb25zZUFnZ3NbeURpbWVuc2lvbi5hY2Nlc3Nvcl07CiAgICB2YXIgc2VyaWVzUGFyYW0gPSAodmlzQ29uZmlnLnNlcmllc1BhcmFtcyB8fCBbXSkuZmluZChmdW5jdGlvbiAocGFyYW0pIHsKICAgICAgcmV0dXJuIHBhcmFtLmRhdGEuaWQgPT09IHlBZ2cuaWQ7CiAgICB9KTsKCiAgICBpZiAoc2VyaWVzUGFyYW0pIHsKICAgICAgdmFyIHVzZWRWYWx1ZUF4aXMgPSAodmlzQ29uZmlnLnZhbHVlQXhlcyB8fCBbXSkuZmluZChmdW5jdGlvbiAodmFsdWVBeGlzKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlQXhpcy5pZCA9PT0gc2VyaWVzUGFyYW0udmFsdWVBeGlzOwogICAgICB9KTsKCiAgICAgIGlmICgoMCwgX2xvZGFzaC5nZXQpKHVzZWRWYWx1ZUF4aXMsICdzY2FsZS5tb2RlJykgPT09ICdwZXJjZW50YWdlJykgewogICAgICAgIHlEaW1lbnNpb24uZm9ybWF0ID0gewogICAgICAgICAgaWQ6ICdwZXJjZW50JwogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICBpZiAoKDAsIF9sb2Rhc2guZ2V0KSh2aXNDb25maWcsICdnYXVnZS5wZXJjZW50YWdlTW9kZScpID09PSB0cnVlKSB7CiAgICAgIHlEaW1lbnNpb24uZm9ybWF0ID0gewogICAgICAgIGlkOiAncGVyY2VudCcKICAgICAgfTsKICAgIH0KICB9KTsKfTsKCnZhciBidWlsZFBpcGVsaW5lVmlzRnVuY3Rpb24gPSB7CiAgdmVnYTogZnVuY3Rpb24gdmVnYShwYXJhbXMpIHsKICAgIHJldHVybiAidmVnYSAiLmNvbmNhdChwcmVwYXJlU3RyaW5nKCdzcGVjJywgcGFyYW1zLnNwZWMpKTsKICB9LAogIGlucHV0X2NvbnRyb2xfdmlzOiBmdW5jdGlvbiBpbnB1dF9jb250cm9sX3ZpcyhwYXJhbXMpIHsKICAgIHJldHVybiAiaW5wdXRfY29udHJvbF92aXMgIi5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHBhcmFtcykpOwogIH0sCiAgbWV0cmljczogZnVuY3Rpb24gbWV0cmljcyhwYXJhbXMsIHNjaGVtYXMpIHsKICAgIHZhciB1aVN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAgIHZhciBwYXJhbXNKc29uID0gcHJlcGFyZUpzb24oJ3BhcmFtcycsIHBhcmFtcyk7CiAgICB2YXIgdWlTdGF0ZUpzb24gPSBwcmVwYXJlSnNvbigndWlTdGF0ZScsIHVpU3RhdGUpOwogICAgdmFyIHBhcmFtc0FycmF5ID0gW3BhcmFtc0pzb24sIHVpU3RhdGVKc29uXS5maWx0ZXIoZnVuY3Rpb24gKHBhcmFtKSB7CiAgICAgIHJldHVybiBCb29sZWFuKHBhcmFtKTsKICAgIH0pOwogICAgcmV0dXJuICJ0c3ZiICIuY29uY2F0KHBhcmFtc0FycmF5LmpvaW4oJyAnKSk7CiAgfSwKICB0aW1lbGlvbjogZnVuY3Rpb24gdGltZWxpb24ocGFyYW1zKSB7CiAgICB2YXIgZXhwcmVzc2lvbiA9IHByZXBhcmVTdHJpbmcoJ2V4cHJlc3Npb24nLCBwYXJhbXMuZXhwcmVzc2lvbik7CiAgICB2YXIgaW50ZXJ2YWwgPSBwcmVwYXJlU3RyaW5nKCdpbnRlcnZhbCcsIHBhcmFtcy5pbnRlcnZhbCk7CiAgICByZXR1cm4gInRpbWVsaW9uX3ZpcyAiLmNvbmNhdChleHByZXNzaW9uKS5jb25jYXQoaW50ZXJ2YWwpOwogIH0sCiAgbWFya2Rvd246IGZ1bmN0aW9uIG1hcmtkb3duKHBhcmFtcykgewogICAgdmFyIG1hcmtkb3duID0gcGFyYW1zLm1hcmtkb3duLAogICAgICAgIGZvbnRTaXplID0gcGFyYW1zLmZvbnRTaXplLAogICAgICAgIG9wZW5MaW5rc0luTmV3VGFiID0gcGFyYW1zLm9wZW5MaW5rc0luTmV3VGFiOwogICAgdmFyIGVzY2FwZWRNYXJrZG93biA9ICcnOwoKICAgIGlmICh0eXBlb2YgbWFya2Rvd24gPT09ICdzdHJpbmcnIHx8IG1hcmtkb3duIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgIGVzY2FwZWRNYXJrZG93biA9IGVzY2FwZVN0cmluZyhtYXJrZG93bi50b1N0cmluZygpKTsKICAgIH0KCiAgICB2YXIgZXhwciA9ICJtYXJrZG93bnZpcyAnIi5jb25jYXQoZXNjYXBlZE1hcmtkb3duLCAiJyAiKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdmb250JywgIntmb250IHNpemU9Ii5jb25jYXQoZm9udFNpemUsICJ9IiksIHRydWUpOwogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ29wZW5MaW5rc0luTmV3VGFiJywgb3BlbkxpbmtzSW5OZXdUYWIpOwogICAgcmV0dXJuIGV4cHI7CiAgfSwKICB0YWJsZTogZnVuY3Rpb24gdGFibGUocGFyYW1zLCBzY2hlbWFzKSB7CiAgICB2YXIgdmlzQ29uZmlnID0gX29iamVjdFNwcmVhZCh7fSwgcGFyYW1zLCB7fSwgYnVpbGRWaXNDb25maWcudGFibGUoc2NoZW1hcywgcGFyYW1zKSk7CgogICAgcmV0dXJuICJraWJhbmFfdGFibGUgIi5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHZpc0NvbmZpZykpOwogIH0sCiAgbWV0cmljOiBmdW5jdGlvbiBtZXRyaWMocGFyYW1zLCBzY2hlbWFzKSB7CiAgICB2YXIgX3BhcmFtcyRtZXRyaWMgPSBwYXJhbXMubWV0cmljLAogICAgICAgIHBlcmNlbnRhZ2VNb2RlID0gX3BhcmFtcyRtZXRyaWMucGVyY2VudGFnZU1vZGUsCiAgICAgICAgdXNlUmFuZ2VzID0gX3BhcmFtcyRtZXRyaWMudXNlUmFuZ2VzLAogICAgICAgIGNvbG9yU2NoZW1hID0gX3BhcmFtcyRtZXRyaWMuY29sb3JTY2hlbWEsCiAgICAgICAgbWV0cmljQ29sb3JNb2RlID0gX3BhcmFtcyRtZXRyaWMubWV0cmljQ29sb3JNb2RlLAogICAgICAgIGNvbG9yc1JhbmdlID0gX3BhcmFtcyRtZXRyaWMuY29sb3JzUmFuZ2UsCiAgICAgICAgbGFiZWxzID0gX3BhcmFtcyRtZXRyaWMubGFiZWxzLAogICAgICAgIGludmVydENvbG9ycyA9IF9wYXJhbXMkbWV0cmljLmludmVydENvbG9ycywKICAgICAgICBzdHlsZSA9IF9wYXJhbXMkbWV0cmljLnN0eWxlOwogICAgdmFyIF9idWlsZFZpc0NvbmZpZyRtZXRyaSA9IGJ1aWxkVmlzQ29uZmlnLm1ldHJpYyhzY2hlbWFzKS5kaW1lbnNpb25zLAogICAgICAgIG1ldHJpY3MgPSBfYnVpbGRWaXNDb25maWckbWV0cmkubWV0cmljcywKICAgICAgICBidWNrZXQgPSBfYnVpbGRWaXNDb25maWckbWV0cmkuYnVja2V0OyAvLyBmaXggZm9ybWF0dGVyIGZvciBwZXJjZW50YWdlIG1vZGUKCiAgICBpZiAoKDAsIF9sb2Rhc2guZ2V0KShwYXJhbXMsICdtZXRyaWMucGVyY2VudGFnZU1vZGUnKSA9PT0gdHJ1ZSkgewogICAgICBtZXRyaWNzLmZvckVhY2goZnVuY3Rpb24gKG1ldHJpYykgewogICAgICAgIG1ldHJpYy5mb3JtYXQgPSB7CiAgICAgICAgICBpZDogJ3BlcmNlbnQnCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9CgogICAgdmFyIGV4cHIgPSAibWV0cmljdmlzICI7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgncGVyY2VudGFnZU1vZGUnLCBwZXJjZW50YWdlTW9kZSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnY29sb3JTY2hlbWEnLCBjb2xvclNjaGVtYSk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnY29sb3JNb2RlJywgbWV0cmljQ29sb3JNb2RlKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCd1c2VSYW5nZXMnLCB1c2VSYW5nZXMpOwogICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ2ludmVydENvbG9ycycsIGludmVydENvbG9ycyk7CiAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnc2hvd0xhYmVscycsIGxhYmVscyAmJiBsYWJlbHMuc2hvdyk7CgogICAgaWYgKHN0eWxlKSB7CiAgICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdiZ0ZpbGwnLCBzdHlsZS5iZ0ZpbGwpOwogICAgICBleHByICs9IHByZXBhcmVWYWx1ZSgnZm9udCcsICJ7Zm9udCBzaXplPSIuY29uY2F0KHN0eWxlLmZvbnRTaXplLCAifSIpLCB0cnVlKTsKICAgICAgZXhwciArPSBwcmVwYXJlVmFsdWUoJ3N1YlRleHQnLCBzdHlsZS5zdWJUZXh0KTsKICAgICAgZXhwciArPSBwcmVwYXJlRGltZW5zaW9uKCdidWNrZXQnLCBidWNrZXQpOwogICAgfQoKICAgIGlmIChjb2xvcnNSYW5nZSkgewogICAgICBjb2xvcnNSYW5nZS5mb3JFYWNoKGZ1bmN0aW9uIChyYW5nZSkgewogICAgICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdjb2xvclJhbmdlJywgIntyYW5nZSBmcm9tPSIuY29uY2F0KHJhbmdlLmZyb20sICIgdG89IikuY29uY2F0KHJhbmdlLnRvLCAifSIpLCB0cnVlKTsKICAgICAgfSk7CiAgICB9CgogICAgbWV0cmljcy5mb3JFYWNoKGZ1bmN0aW9uIChtZXRyaWMpIHsKICAgICAgZXhwciArPSBwcmVwYXJlRGltZW5zaW9uKCdtZXRyaWMnLCBtZXRyaWMpOwogICAgfSk7CiAgICByZXR1cm4gZXhwcjsKICB9LAogIHRhZ2Nsb3VkOiBmdW5jdGlvbiB0YWdjbG91ZChwYXJhbXMsIHNjaGVtYXMpIHsKICAgIHZhciBzY2FsZSA9IHBhcmFtcy5zY2FsZSwKICAgICAgICBvcmllbnRhdGlvbiA9IHBhcmFtcy5vcmllbnRhdGlvbiwKICAgICAgICBtaW5Gb250U2l6ZSA9IHBhcmFtcy5taW5Gb250U2l6ZSwKICAgICAgICBtYXhGb250U2l6ZSA9IHBhcmFtcy5tYXhGb250U2l6ZSwKICAgICAgICBzaG93TGFiZWwgPSBwYXJhbXMuc2hvd0xhYmVsOwoKICAgIHZhciBfYnVpbGRWaXNDb25maWckdGFnY2wgPSBidWlsZFZpc0NvbmZpZy50YWdjbG91ZChzY2hlbWFzKSwKICAgICAgICBtZXRyaWMgPSBfYnVpbGRWaXNDb25maWckdGFnY2wubWV0cmljLAogICAgICAgIGJ1Y2tldCA9IF9idWlsZFZpc0NvbmZpZyR0YWdjbC5idWNrZXQ7CgogICAgdmFyIGV4cHIgPSAidGFnY2xvdWQgbWV0cmljPXt2aXNkaW1lbnNpb24gIi5jb25jYXQobWV0cmljLmFjY2Vzc29yLCAifSAiKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdzY2FsZScsIHNjYWxlKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdvcmllbnRhdGlvbicsIG9yaWVudGF0aW9uKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdtaW5Gb250U2l6ZScsIG1pbkZvbnRTaXplKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdtYXhGb250U2l6ZScsIG1heEZvbnRTaXplKTsKICAgIGV4cHIgKz0gcHJlcGFyZVZhbHVlKCdzaG93TGFiZWwnLCBzaG93TGFiZWwpOwogICAgZXhwciArPSBwcmVwYXJlRGltZW5zaW9uKCdidWNrZXQnLCBidWNrZXQpOwogICAgcmV0dXJuIGV4cHI7CiAgfSwKICByZWdpb25fbWFwOiBmdW5jdGlvbiByZWdpb25fbWFwKHBhcmFtcywgc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmFtcywge30sIGJ1aWxkVmlzQ29uZmlnLnJlZ2lvbl9tYXAoc2NoZW1hcykpOwoKICAgIHJldHVybiAicmVnaW9ubWFwICIuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCB2aXNDb25maWcpKTsKICB9LAogIHRpbGVfbWFwOiBmdW5jdGlvbiB0aWxlX21hcChwYXJhbXMsIHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSBfb2JqZWN0U3ByZWFkKHt9LCBwYXJhbXMsIHt9LCBidWlsZFZpc0NvbmZpZy50aWxlX21hcChzY2hlbWFzKSk7CgogICAgcmV0dXJuICJ0aWxlbWFwICIuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCB2aXNDb25maWcpKTsKICB9LAogIHBpZTogZnVuY3Rpb24gcGllKHBhcmFtcywgc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmFtcywge30sIGJ1aWxkVmlzQ29uZmlnLnBpZShzY2hlbWFzKSk7CgogICAgcmV0dXJuICJraWJhbmFfcGllICIuY29uY2F0KHByZXBhcmVKc29uKCd2aXNDb25maWcnLCB2aXNDb25maWcpKTsKICB9Cn07CmV4cG9ydHMuYnVpbGRQaXBlbGluZVZpc0Z1bmN0aW9uID0gYnVpbGRQaXBlbGluZVZpc0Z1bmN0aW9uOwp2YXIgYnVpbGRWaXNDb25maWcgPSB7CiAgdGFibGU6IGZ1bmN0aW9uIHRhYmxlKHNjaGVtYXMpIHsKICAgIHZhciB2aXNQYXJhbXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgdmFyIHZpc0NvbmZpZyA9IHt9OwogICAgdmFyIG1ldHJpY3MgPSBzY2hlbWFzLm1ldHJpYzsKICAgIHZhciBidWNrZXRzID0gc2NoZW1hcy5idWNrZXQgfHwgW107CiAgICB2aXNDb25maWcuZGltZW5zaW9ucyA9IHsKICAgICAgbWV0cmljczogbWV0cmljcywKICAgICAgYnVja2V0czogYnVja2V0cywKICAgICAgc3BsaXRSb3c6IHNjaGVtYXMuc3BsaXRfcm93LAogICAgICBzcGxpdENvbHVtbjogc2NoZW1hcy5zcGxpdF9jb2x1bW4KICAgIH07CgogICAgaWYgKHZpc1BhcmFtcy5zaG93TWV0cmljc0F0QWxsTGV2ZWxzID09PSBmYWxzZSAmJiB2aXNQYXJhbXMuc2hvd1BhcnRpYWxSb3dzID09PSB0cnVlKSB7CiAgICAgIC8vIEhhbmRsZSBjYXNlIHdoZXJlIHVzZXIgd2FudHMgdG8gc2VlIHBhcnRpYWwgcm93cyBidXQgbm90IG1ldHJpY3MgYXQgYWxsIGxldmVscy4KICAgICAgLy8gVGhpcyByZXF1aXJlcyBjYWxjdWxhdGluZyBob3cgbWFueSBtZXRyaWNzIHdpbGwgY29tZSBiYWNrIGluIHRoZSB0YWJpZmllZCByZXNwb25zZSwKICAgICAgLy8gYW5kIHJlbW92aW5nIGFsbCBtZXRyaWNzIGZyb20gdGhlIGRpbWVuc2lvbnMgZXhjZXB0IHRoZSBsYXN0IHNldC4KICAgICAgdmFyIG1ldHJpY3NQZXJCdWNrZXQgPSBtZXRyaWNzLmxlbmd0aCAvIGJ1Y2tldHMubGVuZ3RoOwogICAgICB2aXNDb25maWcuZGltZW5zaW9ucy5tZXRyaWNzLnNwbGljZSgwLCBtZXRyaWNzUGVyQnVja2V0ICogYnVja2V0cy5sZW5ndGggLSBtZXRyaWNzUGVyQnVja2V0KTsKICAgIH0KCiAgICByZXR1cm4gdmlzQ29uZmlnOwogIH0sCiAgbWV0cmljOiBmdW5jdGlvbiBtZXRyaWMoc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IHsKICAgICAgZGltZW5zaW9uczoge30KICAgIH07CiAgICB2aXNDb25maWcuZGltZW5zaW9ucy5tZXRyaWNzID0gc2NoZW1hcy5tZXRyaWM7CgogICAgaWYgKHNjaGVtYXMuZ3JvdXApIHsKICAgICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMuYnVja2V0ID0gc2NoZW1hcy5ncm91cFswXTsKICAgIH0KCiAgICByZXR1cm4gdmlzQ29uZmlnOwogIH0sCiAgdGFnY2xvdWQ6IGZ1bmN0aW9uIHRhZ2Nsb3VkKHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSB7fTsKICAgIHZpc0NvbmZpZy5tZXRyaWMgPSBzY2hlbWFzLm1ldHJpY1swXTsKCiAgICBpZiAoc2NoZW1hcy5zZWdtZW50KSB7CiAgICAgIHZpc0NvbmZpZy5idWNrZXQgPSBzY2hlbWFzLnNlZ21lbnRbMF07CiAgICB9CgogICAgcmV0dXJuIHZpc0NvbmZpZzsKICB9LAogIHJlZ2lvbl9tYXA6IGZ1bmN0aW9uIHJlZ2lvbl9tYXAoc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IHt9OwogICAgdmlzQ29uZmlnLm1ldHJpYyA9IHNjaGVtYXMubWV0cmljWzBdOwoKICAgIGlmIChzY2hlbWFzLnNlZ21lbnQpIHsKICAgICAgdmlzQ29uZmlnLmJ1Y2tldCA9IHNjaGVtYXMuc2VnbWVudFswXTsKICAgIH0KCiAgICByZXR1cm4gdmlzQ29uZmlnOwogIH0sCiAgdGlsZV9tYXA6IGZ1bmN0aW9uIHRpbGVfbWFwKHNjaGVtYXMpIHsKICAgIHZhciB2aXNDb25maWcgPSB7fTsKICAgIHZpc0NvbmZpZy5kaW1lbnNpb25zID0gewogICAgICBtZXRyaWM6IHNjaGVtYXMubWV0cmljWzBdLAogICAgICBnZW9oYXNoOiBzY2hlbWFzLnNlZ21lbnQgPyBzY2hlbWFzLnNlZ21lbnRbMF0gOiBudWxsLAogICAgICBnZW9jZW50cm9pZDogc2NoZW1hcy5nZW9fY2VudHJvaWQgPyBzY2hlbWFzLmdlb19jZW50cm9pZFswXSA6IG51bGwKICAgIH07CiAgICByZXR1cm4gdmlzQ29uZmlnOwogIH0sCiAgcGllOiBmdW5jdGlvbiBwaWUoc2NoZW1hcykgewogICAgdmFyIHZpc0NvbmZpZyA9IHt9OwogICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMgPSB7CiAgICAgIG1ldHJpYzogc2NoZW1hcy5tZXRyaWNbMF0sCiAgICAgIGJ1Y2tldHM6IHNjaGVtYXMuc2VnbWVudCwKICAgICAgc3BsaXRSb3c6IHNjaGVtYXMuc3BsaXRfcm93LAogICAgICBzcGxpdENvbHVtbjogc2NoZW1hcy5zcGxpdF9jb2x1bW4KICAgIH07CiAgICByZXR1cm4gdmlzQ29uZmlnOwogIH0KfTsKCnZhciBidWlsZFZpc2xpYkRpbWVuc2lvbnMgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHZpcywgcGFyYW1zKSB7CiAgICB2YXIgc2NoZW1hcywgZGltZW5zaW9ucywgeEFnZywgX3hBZ2ckYnVja2V0cyRnZXRJbnRlLCBlc1VuaXQsIGVzVmFsdWUsIGludGVydmFsUGFyYW0sIG91dHB1dDsKCiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHNjaGVtYXMgPSBnZXRTY2hlbWFzKHZpcywgewogICAgICAgICAgICAgIHRpbWVSYW5nZTogcGFyYW1zLnRpbWVSYW5nZSwKICAgICAgICAgICAgICB0aW1lZmlsdGVyOiBwYXJhbXMudGltZWZpbHRlcgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZGltZW5zaW9ucyA9IHsKICAgICAgICAgICAgICB4OiBzY2hlbWFzLnNlZ21lbnQgPyBzY2hlbWFzLnNlZ21lbnRbMF0gOiBudWxsLAogICAgICAgICAgICAgIHk6IHNjaGVtYXMubWV0cmljLAogICAgICAgICAgICAgIHo6IHNjaGVtYXMucmFkaXVzLAogICAgICAgICAgICAgIHdpZHRoOiBzY2hlbWFzLndpZHRoLAogICAgICAgICAgICAgIHNlcmllczogc2NoZW1hcy5ncm91cCwKICAgICAgICAgICAgICBzcGxpdFJvdzogc2NoZW1hcy5zcGxpdF9yb3csCiAgICAgICAgICAgICAgc3BsaXRDb2x1bW46IHNjaGVtYXMuc3BsaXRfY29sdW1uCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoIXNjaGVtYXMuc2VnbWVudCkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeEFnZyA9IHZpcy5kYXRhLmFnZ3MuZ2V0UmVzcG9uc2VBZ2dzKClbZGltZW5zaW9ucy54LmFjY2Vzc29yXTsKCiAgICAgICAgICAgIGlmICghKHhBZ2cudHlwZS5uYW1lID09PSAnZGF0ZV9oaXN0b2dyYW0nKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5kYXRlID0gdHJ1ZTsKICAgICAgICAgICAgX3hBZ2ckYnVja2V0cyRnZXRJbnRlID0geEFnZy5idWNrZXRzLmdldEludGVydmFsKCksIGVzVW5pdCA9IF94QWdnJGJ1Y2tldHMkZ2V0SW50ZS5lc1VuaXQsIGVzVmFsdWUgPSBfeEFnZyRidWNrZXRzJGdldEludGUuZXNWYWx1ZTsKICAgICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5pbnRlcnZhbCA9IF9tb21lbnQuZGVmYXVsdC5kdXJhdGlvbihlc1ZhbHVlLCBlc1VuaXQpOwogICAgICAgICAgICBkaW1lbnNpb25zLngucGFyYW1zLmludGVydmFsRVNWYWx1ZSA9IGVzVmFsdWU7CiAgICAgICAgICAgIGRpbWVuc2lvbnMueC5wYXJhbXMuaW50ZXJ2YWxFU1VuaXQgPSBlc1VuaXQ7CiAgICAgICAgICAgIGRpbWVuc2lvbnMueC5wYXJhbXMuZm9ybWF0ID0geEFnZy5idWNrZXRzLmdldFNjYWxlZERhdGVGb3JtYXQoKTsKICAgICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5ib3VuZHMgPSB4QWdnLmJ1Y2tldHMuZ2V0Qm91bmRzKCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgaWYgKCEoeEFnZy50eXBlLm5hbWUgPT09ICdoaXN0b2dyYW0nKSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50ZXJ2YWxQYXJhbSA9IHhBZ2cudHlwZS5wYXJhbUJ5TmFtZSgnaW50ZXJ2YWwnKTsKICAgICAgICAgICAgb3V0cHV0ID0gewogICAgICAgICAgICAgIHBhcmFtczoge30KICAgICAgICAgICAgfTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE5OwogICAgICAgICAgICByZXR1cm4gaW50ZXJ2YWxQYXJhbS5tb2RpZnlBZ2dDb25maWdPblNlYXJjaFJlcXVlc3RTdGFydCh4QWdnLCB2aXMuZGF0YS5zZWFyY2hTb3VyY2UsIHsKICAgICAgICAgICAgICBhYm9ydFNpZ25hbDogcGFyYW1zLmFib3J0U2lnbmFsCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgIGludGVydmFsUGFyYW0ud3JpdGUoeEFnZywgb3V0cHV0KTsKICAgICAgICAgICAgZGltZW5zaW9ucy54LnBhcmFtcy5pbnRlcnZhbCA9IG91dHB1dC5wYXJhbXMuaW50ZXJ2YWw7CgogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgYWRqdXN0VmlzbGliRGltZW5zaW9uRm9ybW1hdGVycyh2aXMsIGRpbWVuc2lvbnMpOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBkaW1lbnNpb25zKTsKCiAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGJ1aWxkVmlzbGliRGltZW5zaW9ucyhfeCwgX3gyKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKCmV4cG9ydHMuYnVpbGRWaXNsaWJEaW1lbnNpb25zID0gYnVpbGRWaXNsaWJEaW1lbnNpb25zOwoKdmFyIGJ1aWxkUGlwZWxpbmUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIodmlzLCBwYXJhbXMpIHsKICAgIHZhciBfdmlzJGRhdGEsIGluZGV4UGF0dGVybiwgc2VhcmNoU291cmNlLCBxdWVyeSwgZmlsdGVycywgdWlTdGF0ZSwgcGlwZWxpbmUsIHNjaGVtYXMsIHZpc0NvbmZpZywgX3Zpc0NvbmZpZzsKCiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICBfdmlzJGRhdGEgPSB2aXMuZGF0YSwgaW5kZXhQYXR0ZXJuID0gX3ZpcyRkYXRhLmluZGV4UGF0dGVybiwgc2VhcmNoU291cmNlID0gX3ZpcyRkYXRhLnNlYXJjaFNvdXJjZTsKICAgICAgICAgICAgcXVlcnkgPSBzZWFyY2hTb3VyY2UuZ2V0RmllbGQoJ3F1ZXJ5Jyk7CiAgICAgICAgICAgIGZpbHRlcnMgPSBzZWFyY2hTb3VyY2UuZ2V0RmllbGQoJ2ZpbHRlcicpOwogICAgICAgICAgICB1aVN0YXRlID0gdmlzLnVpU3RhdGU7IC8vIGNvbnRleHQKCiAgICAgICAgICAgIHBpcGVsaW5lID0gImtpYmFuYSB8IGtpYmFuYV9jb250ZXh0ICI7CgogICAgICAgICAgICBpZiAocXVlcnkpIHsKICAgICAgICAgICAgICBwaXBlbGluZSArPSBwcmVwYXJlSnNvbigncXVlcnknLCBxdWVyeSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaWx0ZXJzKSB7CiAgICAgICAgICAgICAgcGlwZWxpbmUgKz0gcHJlcGFyZUpzb24oJ2ZpbHRlcnMnLCBmaWx0ZXJzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHZpcy5kYXRhLnNhdmVkU2VhcmNoSWQpIHsKICAgICAgICAgICAgICBwaXBlbGluZSArPSBwcmVwYXJlU3RyaW5nKCdzYXZlZFNlYXJjaElkJywgdmlzLmRhdGEuc2F2ZWRTZWFyY2hJZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBpcGVsaW5lICs9ICd8ICc7IC8vIHJlcXVlc3QgaGFuZGxlcgoKICAgICAgICAgICAgaWYgKHZpcy50eXBlLnJlcXVlc3RIYW5kbGVyID09PSAnY291cmllcicpIHsKICAgICAgICAgICAgICBwaXBlbGluZSArPSAiZXNhZ2dzXG4gICAgIi5jb25jYXQocHJlcGFyZVN0cmluZygnaW5kZXgnLCBpbmRleFBhdHRlcm4uaWQpLCAiXG4gICAgbWV0cmljc0F0QWxsTGV2ZWxzPSIpLmNvbmNhdCh2aXMuaXNIaWVyYXJjaGljYWwoKSwgIlxuICAgIHBhcnRpYWxSb3dzPSIpLmNvbmNhdCh2aXMudHlwZS5yZXF1aXJlc1BhcnRpYWxSb3dzIHx8IHZpcy5wYXJhbXMuc2hvd1BhcnRpYWxSb3dzIHx8IGZhbHNlLCAiXG4gICAgIikuY29uY2F0KHByZXBhcmVKc29uKCdhZ2dDb25maWdzJywgdmlzLmRhdGEuYWdncy5hZ2dzKSwgIiB8ICIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzY2hlbWFzID0gZ2V0U2NoZW1hcyh2aXMsIHsKICAgICAgICAgICAgICB0aW1lUmFuZ2U6IHBhcmFtcy50aW1lUmFuZ2UsCiAgICAgICAgICAgICAgdGltZWZpbHRlcjogcGFyYW1zLnRpbWVmaWx0ZXIKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoIWJ1aWxkUGlwZWxpbmVWaXNGdW5jdGlvblt2aXMudHlwZS5uYW1lXSkgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBpcGVsaW5lICs9IGJ1aWxkUGlwZWxpbmVWaXNGdW5jdGlvblt2aXMudHlwZS5uYW1lXSh2aXMucGFyYW1zLCBzY2hlbWFzLCB1aVN0YXRlKTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzNDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgaWYgKCF2aXNsaWJDaGFydHMuaW5jbHVkZXModmlzLnR5cGUubmFtZSkpIHsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIzOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2aXNDb25maWcgPSBfb2JqZWN0U3ByZWFkKHt9LCB2aXMucGFyYW1zKTsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxOTsKICAgICAgICAgICAgcmV0dXJuIGJ1aWxkVmlzbGliRGltZW5zaW9ucyh2aXMsIHBhcmFtcyk7CgogICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgdmlzQ29uZmlnLmRpbWVuc2lvbnMgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgcGlwZWxpbmUgKz0gInZpc2xpYiB0eXBlPSciLmNvbmNhdCh2aXMudHlwZS5uYW1lLCAiJyAiKS5jb25jYXQocHJlcGFyZUpzb24oJ3Zpc0NvbmZpZycsIHZpc0NvbmZpZykpOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM0OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICBpZiAoIXZpcy50eXBlLnRvRXhwcmVzc2lvbikgewogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IHBpcGVsaW5lOwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI3OwogICAgICAgICAgICByZXR1cm4gdmlzLnR5cGUudG9FeHByZXNzaW9uKHZpcywgcGFyYW1zKTsKCiAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICBwaXBlbGluZSA9IF9jb250ZXh0Mi50MCArPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzNDsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzMDoKICAgICAgICAgICAgX3Zpc0NvbmZpZyA9IF9vYmplY3RTcHJlYWQoe30sIHZpcy5wYXJhbXMpOwogICAgICAgICAgICBfdmlzQ29uZmlnLmRpbWVuc2lvbnMgPSBzY2hlbWFzOwogICAgICAgICAgICBwaXBlbGluZSArPSAidmlzdWFsaXphdGlvbiB0eXBlPSciLmNvbmNhdCh2aXMudHlwZS5uYW1lLCAiJ1xuICAgICIpLmNvbmNhdChwcmVwYXJlSnNvbigndmlzQ29uZmlnJywgX3Zpc0NvbmZpZyksICJcbiAgICBtZXRyaWNzQXRBbGxMZXZlbHM9IikuY29uY2F0KHZpcy5pc0hpZXJhcmNoaWNhbCgpLCAiXG4gICAgcGFydGlhbFJvd3M9IikuY29uY2F0KHZpcy50eXBlLnJlcXVpcmVzUGFydGlhbFJvd3MgfHwgdmlzLnBhcmFtcy5zaG93UGFydGlhbFJvd3MgfHwgZmFsc2UsICIgIik7CgogICAgICAgICAgICBpZiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgcGlwZWxpbmUgKz0gIiIuY29uY2F0KHByZXBhcmVTdHJpbmcoJ2luZGV4JywgaW5kZXhQYXR0ZXJuLmlkKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDM0OgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcGlwZWxpbmUpOwoKICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBidWlsZFBpcGVsaW5lKF94MywgX3g0KSB7CiAgICByZXR1cm4gX3JlZjIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7CgpleHBvcnRzLmJ1aWxkUGlwZWxpbmUgPSBidWlsZFBpcGVsaW5lOw=="},null]}