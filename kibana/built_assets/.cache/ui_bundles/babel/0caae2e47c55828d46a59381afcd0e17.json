{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/store/timeline/helpers.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/store/timeline/helpers.js","mtime":1589249553348},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLnVwZGF0ZUZpbHRlcnMgPSBleHBvcnRzLnVwZGF0ZVNhdmVkUXVlcnkgPSBleHBvcnRzLnVwZGF0ZUhpZ2hsaWdodGVkRHJvcEFuZFByb3ZpZGVyID0gZXhwb3J0cy51blBpblRpbWVsaW5lRXZlbnQgPSBleHBvcnRzLnNldFNlbGVjdGVkVGltZWxpbmVFdmVudHMgPSBleHBvcnRzLnNldExvYWRpbmdUaW1lbGluZUV2ZW50cyA9IGV4cG9ydHMuc2V0RGVsZXRlZFRpbWVsaW5lRXZlbnRzID0gZXhwb3J0cy5yZW1vdmVUaW1lbGluZVByb3ZpZGVyID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZVBlclBhZ2VPcHRpb25zID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZVBhZ2VJbmRleCA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVJdGVtc1BlclBhZ2UgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJLcWxRdWVyeSA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVQcm92aWRlclByb3BlcnRpZXMgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJFeGNsdWRlZCA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVQcm92aWRlckVuYWJsZWQgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lU29ydCA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVSYW5nZSA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVQcm92aWRlcnMgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lSXNMaXZlID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZUlzRmF2b3JpdGUgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lRXZlbnRUeXBlID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZVRpdGxlID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZURlc2NyaXB0aW9uID0gZXhwb3J0cy51cGRhdGVUaW1lbGluZUNvbHVtbnMgPSBleHBvcnRzLnVwZGF0ZUtxbEZpbHRlclF1ZXJ5RHJhZnQgPSBleHBvcnRzLnVwZGF0ZVRpbWVsaW5lS3FsTW9kZSA9IGV4cG9ydHMuYXBwbHlLcWxGaWx0ZXJRdWVyeURyYWZ0ID0gZXhwb3J0cy5hZGRUaW1lbGluZVByb3ZpZGVyID0gZXhwb3J0cy5hcHBseURlbHRhVG9UaW1lbGluZUNvbHVtbldpZHRoID0gZXhwb3J0cy5yZW1vdmVUaW1lbGluZUNvbHVtbiA9IGV4cG9ydHMudXBzZXJ0VGltZWxpbmVDb2x1bW4gPSBleHBvcnRzLmFwcGx5RGVsdGFUb0N1cnJlbnRXaWR0aCA9IGV4cG9ydHMudXBkYXRlVGltZWxpbmVTaG93VGltZWxpbmUgPSBleHBvcnRzLnBpblRpbWVsaW5lRXZlbnQgPSBleHBvcnRzLmFkZE5ld1RpbWVsaW5lID0gZXhwb3J0cy5hZGRUaW1lbGluZVRvU3RvcmUgPSBleHBvcnRzLmFkZFRpbWVsaW5lTm90ZVRvRXZlbnQgPSBleHBvcnRzLmFkZFRpbWVsaW5lTm90ZSA9IGV4cG9ydHMuYWRkVGltZWxpbmVIaXN0b3J5ID0gZXhwb3J0cy5pbml0aWFsVGltZWxpbmVTdGF0ZSA9IGV4cG9ydHMuaXNOb3ROdWxsID0gdm9pZCAwOwoKdmFyIF9mcCA9IHJlcXVpcmUoImxvZGFzaC9mcCIpOwoKdmFyIF9oZWxwZXJzID0gcmVxdWlyZSgiLi4vLi4vY29tcG9uZW50cy90aW1lbGluZS9ib2R5L2NvbHVtbl9oZWFkZXJzL2hlbHBlcnMiKTsKCnZhciBfZGVmYXVsdHMgPSByZXF1aXJlKCIuL2RlZmF1bHRzIik7CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoc291cmNlLCBleGNsdWRlZCkgewogIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwoKICB2YXIgdGFyZ2V0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCk7CgogIHZhciBrZXksIGk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc291cmNlU3ltYm9sS2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKTsKCiAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlU3ltYm9sS2V5cy5sZW5ndGg7IGkrKykgewogICAgICBrZXkgPSBzb3VyY2VTeW1ib2xLZXlzW2ldOwogICAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzb3VyY2UsIGtleSkpIGNvbnRpbnVlOwogICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgewogIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwogIHZhciB0YXJnZXQgPSB7fTsKICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7CiAgdmFyIGtleSwgaTsKCiAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgIGtleSA9IHNvdXJjZUtleXNbaV07CiAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBFTVBUWV9USU1FTElORV9CWV9JRCA9IHt9OyAvLyBzdGFibGUgcmVmZXJlbmNlCgp2YXIgaXNOb3ROdWxsID0gZnVuY3Rpb24gaXNOb3ROdWxsKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlICE9PSBudWxsOwp9OwoKZXhwb3J0cy5pc05vdE51bGwgPSBpc05vdE51bGw7CnZhciBpbml0aWFsVGltZWxpbmVTdGF0ZSA9IHsKICB0aW1lbGluZUJ5SWQ6IEVNUFRZX1RJTUVMSU5FX0JZX0lELAogIGF1dG9TYXZlZFdhcm5pbmdNc2c6IHsKICAgIHRpbWVsaW5lSWQ6IG51bGwsCiAgICBuZXdUaW1lbGluZU1vZGVsOiBudWxsCiAgfSwKICBzaG93Q2FsbE91dFVuYXV0aG9yaXplZE1zZzogZmFsc2UKfTsKZXhwb3J0cy5pbml0aWFsVGltZWxpbmVTdGF0ZSA9IGluaXRpYWxUaW1lbGluZVN0YXRlOwoKdmFyIGFkZFRpbWVsaW5lSGlzdG9yeSA9IGZ1bmN0aW9uIGFkZFRpbWVsaW5lSGlzdG9yeShfcmVmKSB7CiAgdmFyIGlkID0gX3JlZi5pZCwKICAgICAgaGlzdG9yeUlkID0gX3JlZi5oaXN0b3J5SWQsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGhpc3RvcnlJZHM6ICgwLCBfZnAudW5pcSkoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5oaXN0b3J5SWRzKSwgW2hpc3RvcnlJZF0pKQogIH0pKSk7Cn07CgpleHBvcnRzLmFkZFRpbWVsaW5lSGlzdG9yeSA9IGFkZFRpbWVsaW5lSGlzdG9yeTsKCnZhciBhZGRUaW1lbGluZU5vdGUgPSBmdW5jdGlvbiBhZGRUaW1lbGluZU5vdGUoX3JlZjIpIHsKICB2YXIgaWQgPSBfcmVmMi5pZCwKICAgICAgbm90ZUlkID0gX3JlZjIubm90ZUlkLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMi50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgbm90ZUlkczogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5ub3RlSWRzKSwgW25vdGVJZF0pCiAgfSkpKTsKfTsKCmV4cG9ydHMuYWRkVGltZWxpbmVOb3RlID0gYWRkVGltZWxpbmVOb3RlOwoKdmFyIGFkZFRpbWVsaW5lTm90ZVRvRXZlbnQgPSBmdW5jdGlvbiBhZGRUaW1lbGluZU5vdGVUb0V2ZW50KF9yZWYzKSB7CiAgdmFyIGlkID0gX3JlZjMuaWQsCiAgICAgIG5vdGVJZCA9IF9yZWYzLm5vdGVJZCwKICAgICAgZXZlbnRJZCA9IF9yZWYzLmV2ZW50SWQsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYzLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHZhciBleGlzdGluZ05vdGVJZHMgPSAoMCwgX2ZwLmdldE9yKShbXSwgImV2ZW50SWRUb05vdGVJZHMuIi5jb25jYXQoZXZlbnRJZCksIHRpbWVsaW5lKTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZXZlbnRJZFRvTm90ZUlkczogX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUuZXZlbnRJZFRvTm90ZUlkcywge30sIF9kZWZpbmVQcm9wZXJ0eSh7fSwgZXZlbnRJZCwgKDAsIF9mcC51bmlxKShbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGV4aXN0aW5nTm90ZUlkcyksIFtub3RlSWRdKSkpKQogIH0pKSk7Cn07CgpleHBvcnRzLmFkZFRpbWVsaW5lTm90ZVRvRXZlbnQgPSBhZGRUaW1lbGluZU5vdGVUb0V2ZW50OwovKioKICogQWRkIGEgc2F2ZWQgb2JqZWN0IHRpbWVsaW5lIHRvIHRoZSBzdG9yZQogKiBhbmQgZGVmYXVsdCB0aGUgdmFsdWUgdG8gd2hhdCBuZWVkIHRvIGJlIGlmIHZhbHVlcyBhcmUgbnVsbAogKi8KCnZhciBhZGRUaW1lbGluZVRvU3RvcmUgPSBmdW5jdGlvbiBhZGRUaW1lbGluZVRvU3RvcmUoX3JlZjQpIHsKICB2YXIgaWQgPSBfcmVmNC5pZCwKICAgICAgdGltZWxpbmUgPSBfcmVmNC50aW1lbGluZSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjQudGltZWxpbmVCeUlkOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBpc0xvYWRpbmc6IHRpbWVsaW5lQnlJZFtpZF0uaXNMb2FkaW5nCiAgfSkpKTsKfTsKCmV4cG9ydHMuYWRkVGltZWxpbmVUb1N0b3JlID0gYWRkVGltZWxpbmVUb1N0b3JlOwovKiogQWRkcyBhIG5ldyBgVGltZWxpbmVgIHRvIHRoZSBwcm92aWRlZCBjb2xsZWN0aW9uIG9mIGBUaW1lbGluZUJ5SWRgICovCgp2YXIgYWRkTmV3VGltZWxpbmUgPSBmdW5jdGlvbiBhZGROZXdUaW1lbGluZShfcmVmNSkgewogIHZhciBjb2x1bW5zID0gX3JlZjUuY29sdW1ucywKICAgICAgX3JlZjUkZGF0YVByb3ZpZGVycyA9IF9yZWY1LmRhdGFQcm92aWRlcnMsCiAgICAgIGRhdGFQcm92aWRlcnMgPSBfcmVmNSRkYXRhUHJvdmlkZXJzID09PSB2b2lkIDAgPyBbXSA6IF9yZWY1JGRhdGFQcm92aWRlcnMsCiAgICAgIF9yZWY1JGRhdGVSYW5nZSA9IF9yZWY1LmRhdGVSYW5nZSwKICAgICAgZGF0ZVJhbmdlID0gX3JlZjUkZGF0ZVJhbmdlID09PSB2b2lkIDAgPyB7CiAgICBzdGFydDogMCwKICAgIGVuZDogMAogIH0gOiBfcmVmNSRkYXRlUmFuZ2UsCiAgICAgIF9yZWY1JGZpbHRlcnMgPSBfcmVmNS5maWx0ZXJzLAogICAgICBmaWx0ZXJzID0gX3JlZjUkZmlsdGVycyA9PT0gdm9pZCAwID8gX2RlZmF1bHRzLnRpbWVsaW5lRGVmYXVsdHMuZmlsdGVycyA6IF9yZWY1JGZpbHRlcnMsCiAgICAgIGlkID0gX3JlZjUuaWQsCiAgICAgIF9yZWY1JGl0ZW1zUGVyUGFnZSA9IF9yZWY1Lml0ZW1zUGVyUGFnZSwKICAgICAgaXRlbXNQZXJQYWdlID0gX3JlZjUkaXRlbXNQZXJQYWdlID09PSB2b2lkIDAgPyBfZGVmYXVsdHMudGltZWxpbmVEZWZhdWx0cy5pdGVtc1BlclBhZ2UgOiBfcmVmNSRpdGVtc1BlclBhZ2UsCiAgICAgIF9yZWY1JGtxbFF1ZXJ5ID0gX3JlZjUua3FsUXVlcnksCiAgICAgIGtxbFF1ZXJ5ID0gX3JlZjUka3FsUXVlcnkgPT09IHZvaWQgMCA/IHsKICAgIGZpbHRlclF1ZXJ5OiBudWxsLAogICAgZmlsdGVyUXVlcnlEcmFmdDogbnVsbAogIH0gOiBfcmVmNSRrcWxRdWVyeSwKICAgICAgX3JlZjUkc29ydCA9IF9yZWY1LnNvcnQsCiAgICAgIHNvcnQgPSBfcmVmNSRzb3J0ID09PSB2b2lkIDAgPyBfZGVmYXVsdHMudGltZWxpbmVEZWZhdWx0cy5zb3J0IDogX3JlZjUkc29ydCwKICAgICAgX3JlZjUkc2hvdyA9IF9yZWY1LnNob3csCiAgICAgIHNob3cgPSBfcmVmNSRzaG93ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JHNob3csCiAgICAgIF9yZWY1JHNob3dDaGVja2JveGVzID0gX3JlZjUuc2hvd0NoZWNrYm94ZXMsCiAgICAgIHNob3dDaGVja2JveGVzID0gX3JlZjUkc2hvd0NoZWNrYm94ZXMgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkc2hvd0NoZWNrYm94ZXMsCiAgICAgIF9yZWY1JHNob3dSb3dSZW5kZXJlciA9IF9yZWY1LnNob3dSb3dSZW5kZXJlcnMsCiAgICAgIHNob3dSb3dSZW5kZXJlcnMgPSBfcmVmNSRzaG93Um93UmVuZGVyZXIgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmNSRzaG93Um93UmVuZGVyZXIsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWY1LnRpbWVsaW5lQnlJZDsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHsKICAgIGlkOiBpZAogIH0sIF9kZWZhdWx0cy50aW1lbGluZURlZmF1bHRzLCB7CiAgICBjb2x1bW5zOiBjb2x1bW5zLAogICAgZGF0YVByb3ZpZGVyczogZGF0YVByb3ZpZGVycywKICAgIGRhdGVSYW5nZTogZGF0ZVJhbmdlLAogICAgZmlsdGVyczogZmlsdGVycywKICAgIGl0ZW1zUGVyUGFnZTogaXRlbXNQZXJQYWdlLAogICAga3FsUXVlcnk6IGtxbFF1ZXJ5LAogICAgc29ydDogc29ydCwKICAgIHNob3c6IHNob3csCiAgICBzYXZlZE9iamVjdElkOiBudWxsLAogICAgdmVyc2lvbjogbnVsbCwKICAgIGlzU2F2aW5nOiBmYWxzZSwKICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICBzaG93Q2hlY2tib3hlczogc2hvd0NoZWNrYm94ZXMsCiAgICBzaG93Um93UmVuZGVyZXJzOiBzaG93Um93UmVuZGVyZXJzCiAgfSkpKTsKfTsKCmV4cG9ydHMuYWRkTmV3VGltZWxpbmUgPSBhZGROZXdUaW1lbGluZTsKCnZhciBwaW5UaW1lbGluZUV2ZW50ID0gZnVuY3Rpb24gcGluVGltZWxpbmVFdmVudChfcmVmNikgewogIHZhciBpZCA9IF9yZWY2LmlkLAogICAgICBldmVudElkID0gX3JlZjYuZXZlbnRJZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjYudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIHBpbm5lZEV2ZW50SWRzOiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZS5waW5uZWRFdmVudElkcywge30sIF9kZWZpbmVQcm9wZXJ0eSh7fSwgZXZlbnRJZCwgdHJ1ZSkpCiAgfSkpKTsKfTsKCmV4cG9ydHMucGluVGltZWxpbmVFdmVudCA9IHBpblRpbWVsaW5lRXZlbnQ7Cgp2YXIgdXBkYXRlVGltZWxpbmVTaG93VGltZWxpbmUgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZVNob3dUaW1lbGluZShfcmVmNykgewogIHZhciBpZCA9IF9yZWY3LmlkLAogICAgICBzaG93ID0gX3JlZjcuc2hvdywKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjcudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIHNob3c6IHNob3cKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVUaW1lbGluZVNob3dUaW1lbGluZSA9IHVwZGF0ZVRpbWVsaW5lU2hvd1RpbWVsaW5lOwoKdmFyIGFwcGx5RGVsdGFUb0N1cnJlbnRXaWR0aCA9IGZ1bmN0aW9uIGFwcGx5RGVsdGFUb0N1cnJlbnRXaWR0aChfcmVmOCkgewogIHZhciBpZCA9IF9yZWY4LmlkLAogICAgICBkZWx0YSA9IF9yZWY4LmRlbHRhLAogICAgICBib2R5Q2xpZW50V2lkdGhQaXhlbHMgPSBfcmVmOC5ib2R5Q2xpZW50V2lkdGhQaXhlbHMsCiAgICAgIG1pbldpZHRoUGl4ZWxzID0gX3JlZjgubWluV2lkdGhQaXhlbHMsCiAgICAgIG1heFdpZHRoUGVyY2VudCA9IF9yZWY4Lm1heFdpZHRoUGVyY2VudCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjgudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgdmFyIHJlcXVlc3RlZFdpZHRoID0gdGltZWxpbmUud2lkdGggKyBkZWx0YSAqIC0xOyAvLyByYXcgY2hhbmdlIGluIHdpZHRoCgogIHZhciBtYXhXaWR0aFBpeGVscyA9IG1heFdpZHRoUGVyY2VudCAvIDEwMCAqIGJvZHlDbGllbnRXaWR0aFBpeGVsczsKICB2YXIgY2xhbXBlZFdpZHRoID0gTWF0aC5taW4ocmVxdWVzdGVkV2lkdGgsIG1heFdpZHRoUGl4ZWxzKTsKICB2YXIgd2lkdGggPSBNYXRoLm1heChtaW5XaWR0aFBpeGVscywgY2xhbXBlZFdpZHRoKTsgLy8gaWYgdGhlIGNsYW1wZWQgd2lkdGggaXMgc21hbGxlciB0aGFuIHRoZSBtaW4sIHVzZSB0aGUgbWluCgogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICB3aWR0aDogd2lkdGgKICB9KSkpOwp9OwoKZXhwb3J0cy5hcHBseURlbHRhVG9DdXJyZW50V2lkdGggPSBhcHBseURlbHRhVG9DdXJyZW50V2lkdGg7Cgp2YXIgcXVlcnlNYXRjaEN1c3RvbWl6ZXIgPSBmdW5jdGlvbiBxdWVyeU1hdGNoQ3VzdG9taXplcihkcDEsIGRwMikgewogIGlmIChkcDEuZmllbGQgPT09IGRwMi5maWVsZCAmJiBkcDEudmFsdWUgPT09IGRwMi52YWx1ZSAmJiBkcDEub3BlcmF0b3IgPT09IGRwMi5vcGVyYXRvcikgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICByZXR1cm4gZmFsc2U7Cn07Cgp2YXIgYWRkQW5kVG9Qcm92aWRlckluVGltZWxpbmUgPSBmdW5jdGlvbiBhZGRBbmRUb1Byb3ZpZGVySW5UaW1lbGluZShpZCwgcHJvdmlkZXIsIHRpbWVsaW5lLCB0aW1lbGluZUJ5SWQpIHsKICB2YXIgYWxyZWFkeUV4aXN0c1Byb3ZpZGVySW5kZXggPSB0aW1lbGluZS5kYXRhUHJvdmlkZXJzLmZpbmRJbmRleChmdW5jdGlvbiAocCkgewogICAgcmV0dXJuIHAuaWQgPT09IHRpbWVsaW5lLmhpZ2hsaWdodGVkRHJvcEFuZFByb3ZpZGVySWQ7CiAgfSk7CiAgdmFyIG5ld1Byb3ZpZGVyID0gdGltZWxpbmUuZGF0YVByb3ZpZGVyc1thbHJlYWR5RXhpc3RzUHJvdmlkZXJJbmRleF07CiAgdmFyIGFscmVhZHlFeGlzdHNBbmRQcm92aWRlckluZGV4ID0gbmV3UHJvdmlkZXIuYW5kLmZpbmRJbmRleChmdW5jdGlvbiAocCkgewogICAgcmV0dXJuIHAuaWQgPT09IHByb3ZpZGVyLmlkOwogIH0pOwoKICB2YXIgYW5kID0gcHJvdmlkZXIuYW5kLAogICAgICBhbmRQcm92aWRlciA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhwcm92aWRlciwgWyJhbmQiXSk7CgogIGlmICgoMCwgX2ZwLmlzRXF1YWxXaXRoKShxdWVyeU1hdGNoQ3VzdG9taXplciwgbmV3UHJvdmlkZXIucXVlcnlNYXRjaCwgYW5kUHJvdmlkZXIucXVlcnlNYXRjaCkgfHwgYWxyZWFkeUV4aXN0c0FuZFByb3ZpZGVySW5kZXggPT09IC0xICYmIG5ld1Byb3ZpZGVyLmFuZC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW1BbmRQcm92aWRlcikgewogICAgcmV0dXJuICgwLCBfZnAuaXNFcXVhbFdpdGgpKHF1ZXJ5TWF0Y2hDdXN0b21pemVyLCBpdGVtQW5kUHJvdmlkZXIucXVlcnlNYXRjaCwgYW5kUHJvdmlkZXIucXVlcnlNYXRjaCk7CiAgfSkubGVuZ3RoID4gMCkgewogICAgcmV0dXJuIHRpbWVsaW5lQnlJZDsKICB9CgogIHZhciBkYXRhUHJvdmlkZXJzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzLnNsaWNlKDAsIGFscmVhZHlFeGlzdHNQcm92aWRlckluZGV4KSksIFtfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZS5kYXRhUHJvdmlkZXJzW2FscmVhZHlFeGlzdHNQcm92aWRlckluZGV4XSwgewogICAgYW5kOiBhbHJlYWR5RXhpc3RzQW5kUHJvdmlkZXJJbmRleCA+IC0xID8gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShuZXdQcm92aWRlci5hbmQuc2xpY2UoMCwgYWxyZWFkeUV4aXN0c0FuZFByb3ZpZGVySW5kZXgpKSwgW2FuZFByb3ZpZGVyXSwgX3RvQ29uc3VtYWJsZUFycmF5KG5ld1Byb3ZpZGVyLmFuZC5zbGljZShhbHJlYWR5RXhpc3RzQW5kUHJvdmlkZXJJbmRleCArIDEpKSkgOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG5ld1Byb3ZpZGVyLmFuZCksIFthbmRQcm92aWRlcl0pCiAgfSldLCBfdG9Db25zdW1hYmxlQXJyYXkodGltZWxpbmUuZGF0YVByb3ZpZGVycy5zbGljZShhbHJlYWR5RXhpc3RzUHJvdmlkZXJJbmRleCArIDEpKSk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGRhdGFQcm92aWRlcnM6IGRhdGFQcm92aWRlcnMKICB9KSkpOwp9OwoKdmFyIGFkZFByb3ZpZGVyVG9UaW1lbGluZSA9IGZ1bmN0aW9uIGFkZFByb3ZpZGVyVG9UaW1lbGluZShpZCwgcHJvdmlkZXIsIHRpbWVsaW5lLCB0aW1lbGluZUJ5SWQpIHsKICB2YXIgYWxyZWFkeUV4aXN0c0F0SW5kZXggPSB0aW1lbGluZS5kYXRhUHJvdmlkZXJzLmZpbmRJbmRleChmdW5jdGlvbiAocCkgewogICAgcmV0dXJuIHAuaWQgPT09IHByb3ZpZGVyLmlkOwogIH0pOwoKICBpZiAoYWxyZWFkeUV4aXN0c0F0SW5kZXggPiAtMSAmJiAhKDAsIF9mcC5pc0VtcHR5KSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzW2FscmVhZHlFeGlzdHNBdEluZGV4XS5hbmQpKSB7CiAgICBwcm92aWRlci5pZCA9ICIiLmNvbmNhdChwcm92aWRlci5pZCwgIi0iKS5jb25jYXQodGltZWxpbmUuZGF0YVByb3ZpZGVycy5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgcmV0dXJuIHAuaWQgPT09IHByb3ZpZGVyLmlkOwogICAgfSkubGVuZ3RoKTsKICB9CgogIHZhciBkYXRhUHJvdmlkZXJzID0gYWxyZWFkeUV4aXN0c0F0SW5kZXggPiAtMSAmJiAoMCwgX2ZwLmlzRW1wdHkpKHRpbWVsaW5lLmRhdGFQcm92aWRlcnNbYWxyZWFkeUV4aXN0c0F0SW5kZXhdLmFuZCkgPyBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRpbWVsaW5lLmRhdGFQcm92aWRlcnMuc2xpY2UoMCwgYWxyZWFkeUV4aXN0c0F0SW5kZXgpKSwgW3Byb3ZpZGVyXSwgX3RvQ29uc3VtYWJsZUFycmF5KHRpbWVsaW5lLmRhdGFQcm92aWRlcnMuc2xpY2UoYWxyZWFkeUV4aXN0c0F0SW5kZXggKyAxKSkpIDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzKSwgW3Byb3ZpZGVyXSk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGRhdGFQcm92aWRlcnM6IGRhdGFQcm92aWRlcnMKICB9KSkpOwp9OwovKioKICogQWRkcyBvciB1cGRhdGVzIGEgY29sdW1uLiBXaGVuIHVwZGF0aW5nIGEgY29sdW1uLCBpdCB3aWxsIGJlIG1vdmVkIHRvIHRoZQogKiBuZXcgaW5kZXgKICovCgoKdmFyIHVwc2VydFRpbWVsaW5lQ29sdW1uID0gZnVuY3Rpb24gdXBzZXJ0VGltZWxpbmVDb2x1bW4oX3JlZjkpIHsKICB2YXIgY29sdW1uID0gX3JlZjkuY29sdW1uLAogICAgICBpZCA9IF9yZWY5LmlkLAogICAgICBpbmRleCA9IF9yZWY5LmluZGV4LAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmOS50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICB2YXIgYWxyZWFkeUV4aXN0c0F0SW5kZXggPSB0aW1lbGluZS5jb2x1bW5zLmZpbmRJbmRleChmdW5jdGlvbiAoYykgewogICAgcmV0dXJuIGMuaWQgPT09IGNvbHVtbi5pZDsKICB9KTsKCiAgaWYgKGFscmVhZHlFeGlzdHNBdEluZGV4ICE9PSAtMSkgewogICAgLy8gcmVtb3ZlIHRoZSBleGlzdGluZyBlbnRyeSBhbmQgYWRkIHRoZSBuZXcgb25lIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXgKICAgIHZhciByZW9yZGVyZWQgPSB0aW1lbGluZS5jb2x1bW5zLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICByZXR1cm4gYy5pZCAhPT0gY29sdW1uLmlkOwogICAgfSk7CiAgICByZW9yZGVyZWQuc3BsaWNlKGluZGV4LCAwLCBjb2x1bW4pOyAvLyDimqDvuI8gbXV0YXRpb24KCiAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgICBjb2x1bW5zOiByZW9yZGVyZWQKICAgIH0pKSk7CiAgfSAvLyBhZGQgdGhlIG5ldyBlbnRyeSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4CgoKICB2YXIgY29sdW1ucyA9IF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5jb2x1bW5zKTsKCiAgY29sdW1ucy5zcGxpY2UoaW5kZXgsIDAsIGNvbHVtbik7IC8vIOKaoO+4jyBtdXRhdGlvbgoKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgY29sdW1uczogY29sdW1ucwogIH0pKSk7Cn07CgpleHBvcnRzLnVwc2VydFRpbWVsaW5lQ29sdW1uID0gdXBzZXJ0VGltZWxpbmVDb2x1bW47Cgp2YXIgcmVtb3ZlVGltZWxpbmVDb2x1bW4gPSBmdW5jdGlvbiByZW1vdmVUaW1lbGluZUNvbHVtbihfcmVmMTApIHsKICB2YXIgaWQgPSBfcmVmMTAuaWQsCiAgICAgIGNvbHVtbklkID0gX3JlZjEwLmNvbHVtbklkLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMTAudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgdmFyIGNvbHVtbnMgPSB0aW1lbGluZS5jb2x1bW5zLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgcmV0dXJuIGMuaWQgIT09IGNvbHVtbklkOwogIH0pOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBjb2x1bW5zOiBjb2x1bW5zCiAgfSkpKTsKfTsKCmV4cG9ydHMucmVtb3ZlVGltZWxpbmVDb2x1bW4gPSByZW1vdmVUaW1lbGluZUNvbHVtbjsKCnZhciBhcHBseURlbHRhVG9UaW1lbGluZUNvbHVtbldpZHRoID0gZnVuY3Rpb24gYXBwbHlEZWx0YVRvVGltZWxpbmVDb2x1bW5XaWR0aChfcmVmMTEpIHsKICB2YXIgaWQgPSBfcmVmMTEuaWQsCiAgICAgIGNvbHVtbklkID0gX3JlZjExLmNvbHVtbklkLAogICAgICBkZWx0YSA9IF9yZWYxMS5kZWx0YSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjExLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHZhciBjb2x1bW5JbmRleCA9IHRpbWVsaW5lLmNvbHVtbnMuZmluZEluZGV4KGZ1bmN0aW9uIChjKSB7CiAgICByZXR1cm4gYy5pZCA9PT0gY29sdW1uSWQ7CiAgfSk7CgogIGlmIChjb2x1bW5JbmRleCA9PT0gLTEpIHsKICAgIC8vIHRoZSBjb2x1bW4gd2FzIG5vdCBmb3VuZAogICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUpKSk7CiAgfQoKICB2YXIgbWluV2lkdGhQaXhlbHMgPSAoMCwgX2hlbHBlcnMuZ2V0Q29sdW1uV2lkdGhGcm9tVHlwZSkodGltZWxpbmUuY29sdW1uc1tjb2x1bW5JbmRleF0udHlwZSk7CiAgdmFyIHJlcXVlc3RlZFdpZHRoID0gdGltZWxpbmUuY29sdW1uc1tjb2x1bW5JbmRleF0ud2lkdGggKyBkZWx0YTsgLy8gcmF3IGNoYW5nZSBpbiB3aWR0aAoKICB2YXIgd2lkdGggPSBNYXRoLm1heChtaW5XaWR0aFBpeGVscywgcmVxdWVzdGVkV2lkdGgpOyAvLyBpZiB0aGUgcmVxdWVzdGVkIHdpZHRoIGlzIHNtYWxsZXIgdGhhbiB0aGUgbWluLCB1c2UgdGhlIG1pbgoKICB2YXIgY29sdW1uV2l0aE5ld1dpZHRoID0gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUuY29sdW1uc1tjb2x1bW5JbmRleF0sIHsKICAgIHdpZHRoOiB3aWR0aAogIH0pOwoKICB2YXIgY29sdW1ucyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGltZWxpbmUuY29sdW1ucy5zbGljZSgwLCBjb2x1bW5JbmRleCkpLCBbY29sdW1uV2l0aE5ld1dpZHRoXSwgX3RvQ29uc3VtYWJsZUFycmF5KHRpbWVsaW5lLmNvbHVtbnMuc2xpY2UoY29sdW1uSW5kZXggKyAxKSkpOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBjb2x1bW5zOiBjb2x1bW5zCiAgfSkpKTsKfTsKCmV4cG9ydHMuYXBwbHlEZWx0YVRvVGltZWxpbmVDb2x1bW5XaWR0aCA9IGFwcGx5RGVsdGFUb1RpbWVsaW5lQ29sdW1uV2lkdGg7Cgp2YXIgYWRkVGltZWxpbmVQcm92aWRlciA9IGZ1bmN0aW9uIGFkZFRpbWVsaW5lUHJvdmlkZXIoX3JlZjEyKSB7CiAgdmFyIGlkID0gX3JlZjEyLmlkLAogICAgICBwcm92aWRlciA9IF9yZWYxMi5wcm92aWRlciwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjEyLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwoKICBpZiAodGltZWxpbmUuaGlnaGxpZ2h0ZWREcm9wQW5kUHJvdmlkZXJJZCAhPT0gJycpIHsKICAgIHJldHVybiBhZGRBbmRUb1Byb3ZpZGVySW5UaW1lbGluZShpZCwgcHJvdmlkZXIsIHRpbWVsaW5lLCB0aW1lbGluZUJ5SWQpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gYWRkUHJvdmlkZXJUb1RpbWVsaW5lKGlkLCBwcm92aWRlciwgdGltZWxpbmUsIHRpbWVsaW5lQnlJZCk7CiAgfQp9OwoKZXhwb3J0cy5hZGRUaW1lbGluZVByb3ZpZGVyID0gYWRkVGltZWxpbmVQcm92aWRlcjsKCnZhciBhcHBseUtxbEZpbHRlclF1ZXJ5RHJhZnQgPSBmdW5jdGlvbiBhcHBseUtxbEZpbHRlclF1ZXJ5RHJhZnQoX3JlZjEzKSB7CiAgdmFyIGlkID0gX3JlZjEzLmlkLAogICAgICBmaWx0ZXJRdWVyeSA9IF9yZWYxMy5maWx0ZXJRdWVyeSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjEzLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBrcWxRdWVyeTogX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUua3FsUXVlcnksIHsKICAgICAgZmlsdGVyUXVlcnk6IGZpbHRlclF1ZXJ5CiAgICB9KQogIH0pKSk7Cn07CgpleHBvcnRzLmFwcGx5S3FsRmlsdGVyUXVlcnlEcmFmdCA9IGFwcGx5S3FsRmlsdGVyUXVlcnlEcmFmdDsKCnZhciB1cGRhdGVUaW1lbGluZUtxbE1vZGUgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZUtxbE1vZGUoX3JlZjE0KSB7CiAgdmFyIGlkID0gX3JlZjE0LmlkLAogICAgICBrcWxNb2RlID0gX3JlZjE0LmtxbE1vZGUsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYxNC50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAga3FsTW9kZToga3FsTW9kZQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lS3FsTW9kZSA9IHVwZGF0ZVRpbWVsaW5lS3FsTW9kZTsKCnZhciB1cGRhdGVLcWxGaWx0ZXJRdWVyeURyYWZ0ID0gZnVuY3Rpb24gdXBkYXRlS3FsRmlsdGVyUXVlcnlEcmFmdChfcmVmMTUpIHsKICB2YXIgaWQgPSBfcmVmMTUuaWQsCiAgICAgIGZpbHRlclF1ZXJ5RHJhZnQgPSBfcmVmMTUuZmlsdGVyUXVlcnlEcmFmdCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjE1LnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBrcWxRdWVyeTogX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUua3FsUXVlcnksIHsKICAgICAgZmlsdGVyUXVlcnlEcmFmdDogZmlsdGVyUXVlcnlEcmFmdAogICAgfSkKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVLcWxGaWx0ZXJRdWVyeURyYWZ0ID0gdXBkYXRlS3FsRmlsdGVyUXVlcnlEcmFmdDsKCnZhciB1cGRhdGVUaW1lbGluZUNvbHVtbnMgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZUNvbHVtbnMoX3JlZjE2KSB7CiAgdmFyIGlkID0gX3JlZjE2LmlkLAogICAgICBjb2x1bW5zID0gX3JlZjE2LmNvbHVtbnMsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYxNi50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgY29sdW1uczogY29sdW1ucwogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lQ29sdW1ucyA9IHVwZGF0ZVRpbWVsaW5lQ29sdW1uczsKCnZhciB1cGRhdGVUaW1lbGluZURlc2NyaXB0aW9uID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVEZXNjcmlwdGlvbihfcmVmMTcpIHsKICB2YXIgaWQgPSBfcmVmMTcuaWQsCiAgICAgIGRlc2NyaXB0aW9uID0gX3JlZjE3LmRlc2NyaXB0aW9uLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMTcudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbi5lbmRzV2l0aCgnICcpID8gIiIuY29uY2F0KGRlc2NyaXB0aW9uLnRyaW0oKSwgIiAiKSA6IGRlc2NyaXB0aW9uLnRyaW0oKQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lRGVzY3JpcHRpb24gPSB1cGRhdGVUaW1lbGluZURlc2NyaXB0aW9uOwoKdmFyIHVwZGF0ZVRpbWVsaW5lVGl0bGUgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZVRpdGxlKF9yZWYxOCkgewogIHZhciBpZCA9IF9yZWYxOC5pZCwKICAgICAgdGl0bGUgPSBfcmVmMTgudGl0bGUsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYxOC50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgdGl0bGU6IHRpdGxlLmVuZHNXaXRoKCcgJykgPyAiIi5jb25jYXQodGl0bGUudHJpbSgpLCAiICIpIDogdGl0bGUudHJpbSgpCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlVGltZWxpbmVUaXRsZSA9IHVwZGF0ZVRpbWVsaW5lVGl0bGU7Cgp2YXIgdXBkYXRlVGltZWxpbmVFdmVudFR5cGUgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZUV2ZW50VHlwZShfcmVmMTkpIHsKICB2YXIgaWQgPSBfcmVmMTkuaWQsCiAgICAgIGV2ZW50VHlwZSA9IF9yZWYxOS5ldmVudFR5cGUsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYxOS50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZXZlbnRUeXBlOiBldmVudFR5cGUKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVUaW1lbGluZUV2ZW50VHlwZSA9IHVwZGF0ZVRpbWVsaW5lRXZlbnRUeXBlOwoKdmFyIHVwZGF0ZVRpbWVsaW5lSXNGYXZvcml0ZSA9IGZ1bmN0aW9uIHVwZGF0ZVRpbWVsaW5lSXNGYXZvcml0ZShfcmVmMjApIHsKICB2YXIgaWQgPSBfcmVmMjAuaWQsCiAgICAgIGlzRmF2b3JpdGUgPSBfcmVmMjAuaXNGYXZvcml0ZSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjIwLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBpc0Zhdm9yaXRlOiBpc0Zhdm9yaXRlCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlVGltZWxpbmVJc0Zhdm9yaXRlID0gdXBkYXRlVGltZWxpbmVJc0Zhdm9yaXRlOwoKdmFyIHVwZGF0ZVRpbWVsaW5lSXNMaXZlID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVJc0xpdmUoX3JlZjIxKSB7CiAgdmFyIGlkID0gX3JlZjIxLmlkLAogICAgICBpc0xpdmUgPSBfcmVmMjEuaXNMaXZlLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMjEudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGlzTGl2ZTogaXNMaXZlCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlVGltZWxpbmVJc0xpdmUgPSB1cGRhdGVUaW1lbGluZUlzTGl2ZTsKCnZhciB1cGRhdGVUaW1lbGluZVByb3ZpZGVycyA9IGZ1bmN0aW9uIHVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJzKF9yZWYyMikgewogIHZhciBpZCA9IF9yZWYyMi5pZCwKICAgICAgcHJvdmlkZXJzID0gX3JlZjIyLnByb3ZpZGVycywKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjIyLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBkYXRhUHJvdmlkZXJzOiBwcm92aWRlcnMKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVUaW1lbGluZVByb3ZpZGVycyA9IHVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJzOwoKdmFyIHVwZGF0ZVRpbWVsaW5lUmFuZ2UgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZVJhbmdlKF9yZWYyMykgewogIHZhciBpZCA9IF9yZWYyMy5pZCwKICAgICAgc3RhcnQgPSBfcmVmMjMuc3RhcnQsCiAgICAgIGVuZCA9IF9yZWYyMy5lbmQsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYyMy50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZGF0ZVJhbmdlOiB7CiAgICAgIHN0YXJ0OiBzdGFydCwKICAgICAgZW5kOiBlbmQKICAgIH0KICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVUaW1lbGluZVJhbmdlID0gdXBkYXRlVGltZWxpbmVSYW5nZTsKCnZhciB1cGRhdGVUaW1lbGluZVNvcnQgPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZVNvcnQoX3JlZjI0KSB7CiAgdmFyIGlkID0gX3JlZjI0LmlkLAogICAgICBzb3J0ID0gX3JlZjI0LnNvcnQsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYyNC50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgc29ydDogc29ydAogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lU29ydCA9IHVwZGF0ZVRpbWVsaW5lU29ydDsKCnZhciB1cGRhdGVFbmFibGVkQW5kUHJvdmlkZXIgPSBmdW5jdGlvbiB1cGRhdGVFbmFibGVkQW5kUHJvdmlkZXIoYW5kUHJvdmlkZXJJZCwgZW5hYmxlZCwgcHJvdmlkZXJJZCwgdGltZWxpbmUpIHsKICByZXR1cm4gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5tYXAoZnVuY3Rpb24gKHByb3ZpZGVyKSB7CiAgICByZXR1cm4gcHJvdmlkZXIuaWQgPT09IHByb3ZpZGVySWQgPyBfb2JqZWN0U3ByZWFkKHt9LCBwcm92aWRlciwgewogICAgICBhbmQ6IHByb3ZpZGVyLmFuZC5tYXAoZnVuY3Rpb24gKGFuZFByb3ZpZGVyKSB7CiAgICAgICAgcmV0dXJuIGFuZFByb3ZpZGVyLmlkID09PSBhbmRQcm92aWRlcklkID8gX29iamVjdFNwcmVhZCh7fSwgYW5kUHJvdmlkZXIsIHsKICAgICAgICAgIGVuYWJsZWQ6IGVuYWJsZWQKICAgICAgICB9KSA6IGFuZFByb3ZpZGVyOwogICAgICB9KQogICAgfSkgOiBwcm92aWRlcjsKICB9KTsKfTsKCnZhciB1cGRhdGVFbmFibGVkUHJvdmlkZXIgPSBmdW5jdGlvbiB1cGRhdGVFbmFibGVkUHJvdmlkZXIoZW5hYmxlZCwgcHJvdmlkZXJJZCwgdGltZWxpbmUpIHsKICByZXR1cm4gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5tYXAoZnVuY3Rpb24gKHByb3ZpZGVyKSB7CiAgICByZXR1cm4gcHJvdmlkZXIuaWQgPT09IHByb3ZpZGVySWQgPyBfb2JqZWN0U3ByZWFkKHt9LCBwcm92aWRlciwgewogICAgICBlbmFibGVkOiBlbmFibGVkCiAgICB9KSA6IHByb3ZpZGVyOwogIH0pOwp9OwoKdmFyIHVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJFbmFibGVkID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVQcm92aWRlckVuYWJsZWQoX3JlZjI1KSB7CiAgdmFyIGlkID0gX3JlZjI1LmlkLAogICAgICBwcm92aWRlcklkID0gX3JlZjI1LnByb3ZpZGVySWQsCiAgICAgIGVuYWJsZWQgPSBfcmVmMjUuZW5hYmxlZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjI1LnRpbWVsaW5lQnlJZCwKICAgICAgYW5kUHJvdmlkZXJJZCA9IF9yZWYyNS5hbmRQcm92aWRlcklkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGRhdGFQcm92aWRlcnM6IGFuZFByb3ZpZGVySWQgPyB1cGRhdGVFbmFibGVkQW5kUHJvdmlkZXIoYW5kUHJvdmlkZXJJZCwgZW5hYmxlZCwgcHJvdmlkZXJJZCwgdGltZWxpbmUpIDogdXBkYXRlRW5hYmxlZFByb3ZpZGVyKGVuYWJsZWQsIHByb3ZpZGVySWQsIHRpbWVsaW5lKQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJFbmFibGVkID0gdXBkYXRlVGltZWxpbmVQcm92aWRlckVuYWJsZWQ7Cgp2YXIgdXBkYXRlRXhjbHVkZWRBbmRQcm92aWRlciA9IGZ1bmN0aW9uIHVwZGF0ZUV4Y2x1ZGVkQW5kUHJvdmlkZXIoYW5kUHJvdmlkZXJJZCwgZXhjbHVkZWQsIHByb3ZpZGVySWQsIHRpbWVsaW5lKSB7CiAgcmV0dXJuIHRpbWVsaW5lLmRhdGFQcm92aWRlcnMubWFwKGZ1bmN0aW9uIChwcm92aWRlcikgewogICAgcmV0dXJuIHByb3ZpZGVyLmlkID09PSBwcm92aWRlcklkID8gX29iamVjdFNwcmVhZCh7fSwgcHJvdmlkZXIsIHsKICAgICAgYW5kOiBwcm92aWRlci5hbmQubWFwKGZ1bmN0aW9uIChhbmRQcm92aWRlcikgewogICAgICAgIHJldHVybiBhbmRQcm92aWRlci5pZCA9PT0gYW5kUHJvdmlkZXJJZCA/IF9vYmplY3RTcHJlYWQoe30sIGFuZFByb3ZpZGVyLCB7CiAgICAgICAgICBleGNsdWRlZDogZXhjbHVkZWQKICAgICAgICB9KSA6IGFuZFByb3ZpZGVyOwogICAgICB9KQogICAgfSkgOiBwcm92aWRlcjsKICB9KTsKfTsKCnZhciB1cGRhdGVFeGNsdWRlZFByb3ZpZGVyID0gZnVuY3Rpb24gdXBkYXRlRXhjbHVkZWRQcm92aWRlcihleGNsdWRlZCwgcHJvdmlkZXJJZCwgdGltZWxpbmUpIHsKICByZXR1cm4gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5tYXAoZnVuY3Rpb24gKHByb3ZpZGVyKSB7CiAgICByZXR1cm4gcHJvdmlkZXIuaWQgPT09IHByb3ZpZGVySWQgPyBfb2JqZWN0U3ByZWFkKHt9LCBwcm92aWRlciwgewogICAgICBleGNsdWRlZDogZXhjbHVkZWQKICAgIH0pIDogcHJvdmlkZXI7CiAgfSk7Cn07Cgp2YXIgdXBkYXRlVGltZWxpbmVQcm92aWRlckV4Y2x1ZGVkID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVQcm92aWRlckV4Y2x1ZGVkKF9yZWYyNikgewogIHZhciBpZCA9IF9yZWYyNi5pZCwKICAgICAgcHJvdmlkZXJJZCA9IF9yZWYyNi5wcm92aWRlcklkLAogICAgICBleGNsdWRlZCA9IF9yZWYyNi5leGNsdWRlZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjI2LnRpbWVsaW5lQnlJZCwKICAgICAgYW5kUHJvdmlkZXJJZCA9IF9yZWYyNi5hbmRQcm92aWRlcklkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGRhdGFQcm92aWRlcnM6IGFuZFByb3ZpZGVySWQgPyB1cGRhdGVFeGNsdWRlZEFuZFByb3ZpZGVyKGFuZFByb3ZpZGVySWQsIGV4Y2x1ZGVkLCBwcm92aWRlcklkLCB0aW1lbGluZSkgOiB1cGRhdGVFeGNsdWRlZFByb3ZpZGVyKGV4Y2x1ZGVkLCBwcm92aWRlcklkLCB0aW1lbGluZSkKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVUaW1lbGluZVByb3ZpZGVyRXhjbHVkZWQgPSB1cGRhdGVUaW1lbGluZVByb3ZpZGVyRXhjbHVkZWQ7Cgp2YXIgdXBkYXRlUHJvdmlkZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdXBkYXRlUHJvdmlkZXJQcm9wZXJ0aWVzKF9yZWYyNykgewogIHZhciBleGNsdWRlZCA9IF9yZWYyNy5leGNsdWRlZCwKICAgICAgZmllbGQgPSBfcmVmMjcuZmllbGQsCiAgICAgIG9wZXJhdG9yID0gX3JlZjI3Lm9wZXJhdG9yLAogICAgICBwcm92aWRlcklkID0gX3JlZjI3LnByb3ZpZGVySWQsCiAgICAgIHRpbWVsaW5lID0gX3JlZjI3LnRpbWVsaW5lLAogICAgICB2YWx1ZSA9IF9yZWYyNy52YWx1ZTsKICByZXR1cm4gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5tYXAoZnVuY3Rpb24gKHByb3ZpZGVyKSB7CiAgICByZXR1cm4gcHJvdmlkZXIuaWQgPT09IHByb3ZpZGVySWQgPyBfb2JqZWN0U3ByZWFkKHt9LCBwcm92aWRlciwgewogICAgICBleGNsdWRlZDogZXhjbHVkZWQsCiAgICAgIHF1ZXJ5TWF0Y2g6IF9vYmplY3RTcHJlYWQoe30sIHByb3ZpZGVyLnF1ZXJ5TWF0Y2gsIHsKICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgZGlzcGxheUZpZWxkOiBmaWVsZCwKICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgZGlzcGxheVZhbHVlOiB2YWx1ZSwKICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3IKICAgICAgfSkKICAgIH0pIDogcHJvdmlkZXI7CiAgfSk7Cn07Cgp2YXIgdXBkYXRlQW5kUHJvdmlkZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdXBkYXRlQW5kUHJvdmlkZXJQcm9wZXJ0aWVzKF9yZWYyOCkgewogIHZhciBhbmRQcm92aWRlcklkID0gX3JlZjI4LmFuZFByb3ZpZGVySWQsCiAgICAgIGV4Y2x1ZGVkID0gX3JlZjI4LmV4Y2x1ZGVkLAogICAgICBmaWVsZCA9IF9yZWYyOC5maWVsZCwKICAgICAgb3BlcmF0b3IgPSBfcmVmMjgub3BlcmF0b3IsCiAgICAgIHByb3ZpZGVySWQgPSBfcmVmMjgucHJvdmlkZXJJZCwKICAgICAgdGltZWxpbmUgPSBfcmVmMjgudGltZWxpbmUsCiAgICAgIHZhbHVlID0gX3JlZjI4LnZhbHVlOwogIHJldHVybiB0aW1lbGluZS5kYXRhUHJvdmlkZXJzLm1hcChmdW5jdGlvbiAocHJvdmlkZXIpIHsKICAgIHJldHVybiBwcm92aWRlci5pZCA9PT0gcHJvdmlkZXJJZCA/IF9vYmplY3RTcHJlYWQoe30sIHByb3ZpZGVyLCB7CiAgICAgIGFuZDogcHJvdmlkZXIuYW5kLm1hcChmdW5jdGlvbiAoYW5kUHJvdmlkZXIpIHsKICAgICAgICByZXR1cm4gYW5kUHJvdmlkZXIuaWQgPT09IGFuZFByb3ZpZGVySWQgPyBfb2JqZWN0U3ByZWFkKHt9LCBhbmRQcm92aWRlciwgewogICAgICAgICAgZXhjbHVkZWQ6IGV4Y2x1ZGVkLAogICAgICAgICAgcXVlcnlNYXRjaDogX29iamVjdFNwcmVhZCh7fSwgYW5kUHJvdmlkZXIucXVlcnlNYXRjaCwgewogICAgICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgICAgIGRpc3BsYXlGaWVsZDogZmllbGQsCiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgZGlzcGxheVZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yCiAgICAgICAgICB9KQogICAgICAgIH0pIDogYW5kUHJvdmlkZXI7CiAgICAgIH0pCiAgICB9KSA6IHByb3ZpZGVyOwogIH0pOwp9OwoKdmFyIHVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVQcm92aWRlclByb3BlcnRpZXMoX3JlZjI5KSB7CiAgdmFyIGFuZFByb3ZpZGVySWQgPSBfcmVmMjkuYW5kUHJvdmlkZXJJZCwKICAgICAgZXhjbHVkZWQgPSBfcmVmMjkuZXhjbHVkZWQsCiAgICAgIGZpZWxkID0gX3JlZjI5LmZpZWxkLAogICAgICBpZCA9IF9yZWYyOS5pZCwKICAgICAgb3BlcmF0b3IgPSBfcmVmMjkub3BlcmF0b3IsCiAgICAgIHByb3ZpZGVySWQgPSBfcmVmMjkucHJvdmlkZXJJZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjI5LnRpbWVsaW5lQnlJZCwKICAgICAgdmFsdWUgPSBfcmVmMjkudmFsdWU7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZGF0YVByb3ZpZGVyczogYW5kUHJvdmlkZXJJZCA/IHVwZGF0ZUFuZFByb3ZpZGVyUHJvcGVydGllcyh7CiAgICAgIGFuZFByb3ZpZGVySWQ6IGFuZFByb3ZpZGVySWQsCiAgICAgIGV4Y2x1ZGVkOiBleGNsdWRlZCwKICAgICAgZmllbGQ6IGZpZWxkLAogICAgICBvcGVyYXRvcjogb3BlcmF0b3IsCiAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVySWQsCiAgICAgIHRpbWVsaW5lOiB0aW1lbGluZSwKICAgICAgdmFsdWU6IHZhbHVlCiAgICB9KSA6IHVwZGF0ZVByb3ZpZGVyUHJvcGVydGllcyh7CiAgICAgIGV4Y2x1ZGVkOiBleGNsdWRlZCwKICAgICAgZmllbGQ6IGZpZWxkLAogICAgICBvcGVyYXRvcjogb3BlcmF0b3IsCiAgICAgIHByb3ZpZGVySWQ6IHByb3ZpZGVySWQsCiAgICAgIHRpbWVsaW5lOiB0aW1lbGluZSwKICAgICAgdmFsdWU6IHZhbHVlCiAgICB9KQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJQcm9wZXJ0aWVzID0gdXBkYXRlVGltZWxpbmVQcm92aWRlclByb3BlcnRpZXM7Cgp2YXIgdXBkYXRlVGltZWxpbmVQcm92aWRlcktxbFF1ZXJ5ID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVQcm92aWRlcktxbFF1ZXJ5KF9yZWYzMCkgewogIHZhciBpZCA9IF9yZWYzMC5pZCwKICAgICAgcHJvdmlkZXJJZCA9IF9yZWYzMC5wcm92aWRlcklkLAogICAgICBrcWxRdWVyeSA9IF9yZWYzMC5rcWxRdWVyeSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjMwLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBkYXRhUHJvdmlkZXJzOiB0aW1lbGluZS5kYXRhUHJvdmlkZXJzLm1hcChmdW5jdGlvbiAocHJvdmlkZXIpIHsKICAgICAgcmV0dXJuIHByb3ZpZGVyLmlkID09PSBwcm92aWRlcklkID8gX29iamVjdFNwcmVhZCh7fSwgcHJvdmlkZXIsIHt9LCB7CiAgICAgICAga3FsUXVlcnk6IGtxbFF1ZXJ5CiAgICAgIH0pIDogcHJvdmlkZXI7CiAgICB9KQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJLcWxRdWVyeSA9IHVwZGF0ZVRpbWVsaW5lUHJvdmlkZXJLcWxRdWVyeTsKCnZhciB1cGRhdGVUaW1lbGluZUl0ZW1zUGVyUGFnZSA9IGZ1bmN0aW9uIHVwZGF0ZVRpbWVsaW5lSXRlbXNQZXJQYWdlKF9yZWYzMSkgewogIHZhciBpZCA9IF9yZWYzMS5pZCwKICAgICAgaXRlbXNQZXJQYWdlID0gX3JlZjMxLml0ZW1zUGVyUGFnZSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjMxLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBpdGVtc1BlclBhZ2U6IGl0ZW1zUGVyUGFnZQogIH0pKSk7Cn07CgpleHBvcnRzLnVwZGF0ZVRpbWVsaW5lSXRlbXNQZXJQYWdlID0gdXBkYXRlVGltZWxpbmVJdGVtc1BlclBhZ2U7Cgp2YXIgdXBkYXRlVGltZWxpbmVQYWdlSW5kZXggPSBmdW5jdGlvbiB1cGRhdGVUaW1lbGluZVBhZ2VJbmRleChfcmVmMzIpIHsKICB2YXIgaWQgPSBfcmVmMzIuaWQsCiAgICAgIGFjdGl2ZVBhZ2UgPSBfcmVmMzIuYWN0aXZlUGFnZSwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjMyLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBhY3RpdmVQYWdlOiBhY3RpdmVQYWdlCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlVGltZWxpbmVQYWdlSW5kZXggPSB1cGRhdGVUaW1lbGluZVBhZ2VJbmRleDsKCnZhciB1cGRhdGVUaW1lbGluZVBlclBhZ2VPcHRpb25zID0gZnVuY3Rpb24gdXBkYXRlVGltZWxpbmVQZXJQYWdlT3B0aW9ucyhfcmVmMzMpIHsKICB2YXIgaWQgPSBfcmVmMzMuaWQsCiAgICAgIGl0ZW1zUGVyUGFnZU9wdGlvbnMgPSBfcmVmMzMuaXRlbXNQZXJQYWdlT3B0aW9ucywKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjMzLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBpdGVtc1BlclBhZ2VPcHRpb25zOiBpdGVtc1BlclBhZ2VPcHRpb25zCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlVGltZWxpbmVQZXJQYWdlT3B0aW9ucyA9IHVwZGF0ZVRpbWVsaW5lUGVyUGFnZU9wdGlvbnM7Cgp2YXIgcmVtb3ZlQW5kUHJvdmlkZXIgPSBmdW5jdGlvbiByZW1vdmVBbmRQcm92aWRlcihhbmRQcm92aWRlcklkLCBwcm92aWRlcklkLCB0aW1lbGluZSkgewogIHZhciBwcm92aWRlckluZGV4ID0gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5maW5kSW5kZXgoZnVuY3Rpb24gKHApIHsKICAgIHJldHVybiBwLmlkID09PSBwcm92aWRlcklkOwogIH0pOwogIHZhciBwcm92aWRlckFuZEluZGV4ID0gdGltZWxpbmUuZGF0YVByb3ZpZGVyc1twcm92aWRlckluZGV4XS5hbmQuZmluZEluZGV4KGZ1bmN0aW9uIChwKSB7CiAgICByZXR1cm4gcC5pZCA9PT0gYW5kUHJvdmlkZXJJZDsKICB9KTsKICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzLnNsaWNlKDAsIHByb3ZpZGVySW5kZXgpKSwgW19vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLmRhdGFQcm92aWRlcnNbcHJvdmlkZXJJbmRleF0sIHsKICAgIGFuZDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzW3Byb3ZpZGVySW5kZXhdLmFuZC5zbGljZSgwLCBwcm92aWRlckFuZEluZGV4KSksIF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzW3Byb3ZpZGVySW5kZXhdLmFuZC5zbGljZShwcm92aWRlckFuZEluZGV4ICsgMSkpKQogIH0pXSwgX3RvQ29uc3VtYWJsZUFycmF5KHRpbWVsaW5lLmRhdGFQcm92aWRlcnMuc2xpY2UocHJvdmlkZXJJbmRleCArIDEpKSk7Cn07Cgp2YXIgcmVtb3ZlUHJvdmlkZXIgPSBmdW5jdGlvbiByZW1vdmVQcm92aWRlcihwcm92aWRlcklkLCB0aW1lbGluZSkgewogIHZhciBwcm92aWRlckluZGV4ID0gdGltZWxpbmUuZGF0YVByb3ZpZGVycy5maW5kSW5kZXgoZnVuY3Rpb24gKHApIHsKICAgIHJldHVybiBwLmlkID09PSBwcm92aWRlcklkOwogIH0pOwogIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRpbWVsaW5lLmRhdGFQcm92aWRlcnMuc2xpY2UoMCwgcHJvdmlkZXJJbmRleCkpLCBfdG9Db25zdW1hYmxlQXJyYXkodGltZWxpbmUuZGF0YVByb3ZpZGVyc1twcm92aWRlckluZGV4XS5hbmQubGVuZ3RoID8gW19vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLmRhdGFQcm92aWRlcnNbcHJvdmlkZXJJbmRleF0uYW5kLnNsaWNlKDAsIDEpWzBdLCB7CiAgICBhbmQ6IF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzW3Byb3ZpZGVySW5kZXhdLmFuZC5zbGljZSgxKSkKICB9KV0gOiBbXSksIF90b0NvbnN1bWFibGVBcnJheSh0aW1lbGluZS5kYXRhUHJvdmlkZXJzLnNsaWNlKHByb3ZpZGVySW5kZXggKyAxKSkpOwp9OwoKdmFyIHJlbW92ZVRpbWVsaW5lUHJvdmlkZXIgPSBmdW5jdGlvbiByZW1vdmVUaW1lbGluZVByb3ZpZGVyKF9yZWYzNCkgewogIHZhciBpZCA9IF9yZWYzNC5pZCwKICAgICAgcHJvdmlkZXJJZCA9IF9yZWYzNC5wcm92aWRlcklkLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMzQudGltZWxpbmVCeUlkLAogICAgICBhbmRQcm92aWRlcklkID0gX3JlZjM0LmFuZFByb3ZpZGVySWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZGF0YVByb3ZpZGVyczogYW5kUHJvdmlkZXJJZCA/IHJlbW92ZUFuZFByb3ZpZGVyKGFuZFByb3ZpZGVySWQsIHByb3ZpZGVySWQsIHRpbWVsaW5lKSA6IHJlbW92ZVByb3ZpZGVyKHByb3ZpZGVySWQsIHRpbWVsaW5lKQogIH0pKSk7Cn07CgpleHBvcnRzLnJlbW92ZVRpbWVsaW5lUHJvdmlkZXIgPSByZW1vdmVUaW1lbGluZVByb3ZpZGVyOwoKdmFyIHNldERlbGV0ZWRUaW1lbGluZUV2ZW50cyA9IGZ1bmN0aW9uIHNldERlbGV0ZWRUaW1lbGluZUV2ZW50cyhfcmVmMzUpIHsKICB2YXIgaWQgPSBfcmVmMzUuaWQsCiAgICAgIGV2ZW50SWRzID0gX3JlZjM1LmV2ZW50SWRzLAogICAgICBpc0RlbGV0ZWQgPSBfcmVmMzUuaXNEZWxldGVkLAogICAgICB0aW1lbGluZUJ5SWQgPSBfcmVmMzUudGltZWxpbmVCeUlkOwogIHZhciB0aW1lbGluZSA9IHRpbWVsaW5lQnlJZFtpZF07CiAgdmFyIGRlbGV0ZWRFdmVudElkcyA9IGlzRGVsZXRlZCA/ICgwLCBfZnAudW5pb24pKHRpbWVsaW5lLmRlbGV0ZWRFdmVudElkcywgZXZlbnRJZHMpIDogdGltZWxpbmUuZGVsZXRlZEV2ZW50SWRzLmZpbHRlcihmdW5jdGlvbiAoY3VycmVudEV2ZW50SWQpIHsKICAgIHJldHVybiAhZXZlbnRJZHMuaW5jbHVkZXMoY3VycmVudEV2ZW50SWQpOwogIH0pOwogIHZhciBzZWxlY3RlZEV2ZW50SWRzID0gT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHRpbWVsaW5lLnNlbGVjdGVkRXZlbnRJZHMpLmZpbHRlcihmdW5jdGlvbiAoX3JlZjM2KSB7CiAgICB2YXIgX3JlZjM3ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjM2LCAxKSwKICAgICAgICBzZWxlY3RlZEV2ZW50SWQgPSBfcmVmMzdbMF07CgogICAgcmV0dXJuICFkZWxldGVkRXZlbnRJZHMuaW5jbHVkZXMoc2VsZWN0ZWRFdmVudElkKTsKICB9KSk7CiAgdmFyIGlzU2VsZWN0QWxsQ2hlY2tlZCA9IE9iamVjdC5rZXlzKHNlbGVjdGVkRXZlbnRJZHMpLmxlbmd0aCA+IDAgPyB0aW1lbGluZS5pc1NlbGVjdEFsbENoZWNrZWQgOiBmYWxzZTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgZGVsZXRlZEV2ZW50SWRzOiBkZWxldGVkRXZlbnRJZHMsCiAgICBzZWxlY3RlZEV2ZW50SWRzOiBzZWxlY3RlZEV2ZW50SWRzLAogICAgaXNTZWxlY3RBbGxDaGVja2VkOiBpc1NlbGVjdEFsbENoZWNrZWQKICB9KSkpOwp9OwoKZXhwb3J0cy5zZXREZWxldGVkVGltZWxpbmVFdmVudHMgPSBzZXREZWxldGVkVGltZWxpbmVFdmVudHM7Cgp2YXIgc2V0TG9hZGluZ1RpbWVsaW5lRXZlbnRzID0gZnVuY3Rpb24gc2V0TG9hZGluZ1RpbWVsaW5lRXZlbnRzKF9yZWYzOCkgewogIHZhciBpZCA9IF9yZWYzOC5pZCwKICAgICAgZXZlbnRJZHMgPSBfcmVmMzguZXZlbnRJZHMsCiAgICAgIGlzTG9hZGluZyA9IF9yZWYzOC5pc0xvYWRpbmcsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWYzOC50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICB2YXIgbG9hZGluZ0V2ZW50SWRzID0gaXNMb2FkaW5nID8gKDAsIF9mcC51bmlvbikodGltZWxpbmUubG9hZGluZ0V2ZW50SWRzLCBldmVudElkcykgOiB0aW1lbGluZS5sb2FkaW5nRXZlbnRJZHMuZmlsdGVyKGZ1bmN0aW9uIChjdXJyZW50RXZlbnRJZCkgewogICAgcmV0dXJuICFldmVudElkcy5pbmNsdWRlcyhjdXJyZW50RXZlbnRJZCk7CiAgfSk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIGxvYWRpbmdFdmVudElkczogbG9hZGluZ0V2ZW50SWRzCiAgfSkpKTsKfTsKCmV4cG9ydHMuc2V0TG9hZGluZ1RpbWVsaW5lRXZlbnRzID0gc2V0TG9hZGluZ1RpbWVsaW5lRXZlbnRzOwoKdmFyIHNldFNlbGVjdGVkVGltZWxpbmVFdmVudHMgPSBmdW5jdGlvbiBzZXRTZWxlY3RlZFRpbWVsaW5lRXZlbnRzKF9yZWYzOSkgewogIHZhciBpZCA9IF9yZWYzOS5pZCwKICAgICAgZXZlbnRJZHMgPSBfcmVmMzkuZXZlbnRJZHMsCiAgICAgIF9yZWYzOSRpc1NlbGVjdEFsbENoZSA9IF9yZWYzOS5pc1NlbGVjdEFsbENoZWNrZWQsCiAgICAgIGlzU2VsZWN0QWxsQ2hlY2tlZCA9IF9yZWYzOSRpc1NlbGVjdEFsbENoZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmMzkkaXNTZWxlY3RBbGxDaGUsCiAgICAgIGlzU2VsZWN0ZWQgPSBfcmVmMzkuaXNTZWxlY3RlZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjM5LnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHZhciBzZWxlY3RlZEV2ZW50SWRzID0gaXNTZWxlY3RlZCA/IF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLnNlbGVjdGVkRXZlbnRJZHMsIHt9LCBldmVudElkcykgOiAoMCwgX2ZwLm9taXQpKE9iamVjdC5rZXlzKGV2ZW50SWRzKSwgdGltZWxpbmUuc2VsZWN0ZWRFdmVudElkcyk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lQnlJZCwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmUsIHsKICAgIHNlbGVjdGVkRXZlbnRJZHM6IHNlbGVjdGVkRXZlbnRJZHMsCiAgICBpc1NlbGVjdEFsbENoZWNrZWQ6IGlzU2VsZWN0QWxsQ2hlY2tlZAogIH0pKSk7Cn07CgpleHBvcnRzLnNldFNlbGVjdGVkVGltZWxpbmVFdmVudHMgPSBzZXRTZWxlY3RlZFRpbWVsaW5lRXZlbnRzOwoKdmFyIHVuUGluVGltZWxpbmVFdmVudCA9IGZ1bmN0aW9uIHVuUGluVGltZWxpbmVFdmVudChfcmVmNDApIHsKICB2YXIgaWQgPSBfcmVmNDAuaWQsCiAgICAgIGV2ZW50SWQgPSBfcmVmNDAuZXZlbnRJZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjQwLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBwaW5uZWRFdmVudElkczogKDAsIF9mcC5vbWl0KShldmVudElkLCB0aW1lbGluZS5waW5uZWRFdmVudElkcykKICB9KSkpOwp9OwoKZXhwb3J0cy51blBpblRpbWVsaW5lRXZlbnQgPSB1blBpblRpbWVsaW5lRXZlbnQ7Cgp2YXIgdXBkYXRlSGlnaGxpZ2h0ZWREcm9wQW5kUHJvdmlkZXIgPSBmdW5jdGlvbiB1cGRhdGVIaWdobGlnaHRlZERyb3BBbmRQcm92aWRlcihfcmVmNDEpIHsKICB2YXIgaWQgPSBfcmVmNDEuaWQsCiAgICAgIHByb3ZpZGVySWQgPSBfcmVmNDEucHJvdmlkZXJJZCwKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjQxLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBoaWdobGlnaHRlZERyb3BBbmRQcm92aWRlcklkOiBwcm92aWRlcklkCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlSGlnaGxpZ2h0ZWREcm9wQW5kUHJvdmlkZXIgPSB1cGRhdGVIaWdobGlnaHRlZERyb3BBbmRQcm92aWRlcjsKCnZhciB1cGRhdGVTYXZlZFF1ZXJ5ID0gZnVuY3Rpb24gdXBkYXRlU2F2ZWRRdWVyeShfcmVmNDIpIHsKICB2YXIgaWQgPSBfcmVmNDIuaWQsCiAgICAgIHNhdmVkUXVlcnlJZCA9IF9yZWY0Mi5zYXZlZFF1ZXJ5SWQsCiAgICAgIHRpbWVsaW5lQnlJZCA9IF9yZWY0Mi50aW1lbGluZUJ5SWQ7CiAgdmFyIHRpbWVsaW5lID0gdGltZWxpbmVCeUlkW2lkXTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgdGltZWxpbmVCeUlkLCBfZGVmaW5lUHJvcGVydHkoe30sIGlkLCBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZSwgewogICAgc2F2ZWRRdWVyeUlkOiBzYXZlZFF1ZXJ5SWQKICB9KSkpOwp9OwoKZXhwb3J0cy51cGRhdGVTYXZlZFF1ZXJ5ID0gdXBkYXRlU2F2ZWRRdWVyeTsKCnZhciB1cGRhdGVGaWx0ZXJzID0gZnVuY3Rpb24gdXBkYXRlRmlsdGVycyhfcmVmNDMpIHsKICB2YXIgaWQgPSBfcmVmNDMuaWQsCiAgICAgIGZpbHRlcnMgPSBfcmVmNDMuZmlsdGVycywKICAgICAgdGltZWxpbmVCeUlkID0gX3JlZjQzLnRpbWVsaW5lQnlJZDsKICB2YXIgdGltZWxpbmUgPSB0aW1lbGluZUJ5SWRbaWRdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aW1lbGluZUJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIF9vYmplY3RTcHJlYWQoe30sIHRpbWVsaW5lLCB7CiAgICBmaWx0ZXJzOiBmaWx0ZXJzCiAgfSkpKTsKfTsKCmV4cG9ydHMudXBkYXRlRmlsdGVycyA9IHVwZGF0ZUZpbHRlcnM7"},null]}