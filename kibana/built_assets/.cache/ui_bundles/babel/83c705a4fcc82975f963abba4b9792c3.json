{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/plugins/index_management/public/application/components/mappings_editor/reducer.js","dependencies":[{"path":"x-pack/plugins/index_management/public/application/components/mappings_editor/reducer.js","mtime":1589249554088},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLnJlZHVjZXIgPSBleHBvcnRzLmFkZEZpZWxkVG9TdGF0ZSA9IHZvaWQgMDsKCnZhciBfbGliID0gcmVxdWlyZSgiLi9saWIiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi9jb25zdGFudHMiKTsKCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICB0cnkgewogICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVqZWN0KGVycm9yKTsKICAgIHJldHVybjsKICB9CgogIGlmIChpbmZvLmRvbmUpIHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0gZWxzZSB7CiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgfQp9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgfQoKICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBhZGRGaWVsZFRvU3RhdGUgPSBmdW5jdGlvbiBhZGRGaWVsZFRvU3RhdGUoZmllbGQsIHN0YXRlKSB7CiAgdmFyIHVwZGF0ZWRGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5maWVsZHMpOwoKICB2YXIgaWQgPSAoMCwgX2xpYi5nZXRVbmlxdWVJZCkoKTsKICB2YXIgZmllbGRUb0FkZEZpZWxkVG8gPSBzdGF0ZS5kb2N1bWVudEZpZWxkcy5maWVsZFRvQWRkRmllbGRUbzsKICB2YXIgYWRkVG9Sb290TGV2ZWwgPSBmaWVsZFRvQWRkRmllbGRUbyA9PT0gdW5kZWZpbmVkOwogIHZhciBwYXJlbnRGaWVsZCA9IGFkZFRvUm9vdExldmVsID8gdW5kZWZpbmVkIDogdXBkYXRlZEZpZWxkcy5ieUlkW2ZpZWxkVG9BZGRGaWVsZFRvXTsKICB2YXIgaXNNdWx0aUZpZWxkID0gcGFyZW50RmllbGQgPyBwYXJlbnRGaWVsZC5jYW5IYXZlTXVsdGlGaWVsZHMgOiBmYWxzZTsKICB1cGRhdGVkRmllbGRzLmJ5SWQgPSBfb2JqZWN0U3ByZWFkKHt9LCB1cGRhdGVkRmllbGRzLmJ5SWQpOwogIHVwZGF0ZWRGaWVsZHMucm9vdExldmVsRmllbGRzID0gYWRkVG9Sb290TGV2ZWwgPyBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHVwZGF0ZWRGaWVsZHMucm9vdExldmVsRmllbGRzKSwgW2lkXSkgOiB1cGRhdGVkRmllbGRzLnJvb3RMZXZlbEZpZWxkczsKICB2YXIgbmVzdGVkRGVwdGggPSBwYXJlbnRGaWVsZCAmJiAocGFyZW50RmllbGQuY2FuSGF2ZUNoaWxkRmllbGRzIHx8IHBhcmVudEZpZWxkLmNhbkhhdmVNdWx0aUZpZWxkcykgPyBwYXJlbnRGaWVsZC5uZXN0ZWREZXB0aCArIDEgOiAwOwogIHVwZGF0ZWRGaWVsZHMubWF4TmVzdGVkRGVwdGggPSBNYXRoLm1heCh1cGRhdGVkRmllbGRzLm1heE5lc3RlZERlcHRoLCBuZXN0ZWREZXB0aCk7CiAgdmFyIG5hbWUgPSBmaWVsZC5uYW1lOwogIHZhciBwYXRoID0gcGFyZW50RmllbGQgPyBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHBhcmVudEZpZWxkLnBhdGgpLCBbbmFtZV0pIDogW25hbWVdOwoKICB2YXIgbmV3RmllbGQgPSBfb2JqZWN0U3ByZWFkKHsKICAgIGlkOiBpZCwKICAgIHBhcmVudElkOiBmaWVsZFRvQWRkRmllbGRUbywKICAgIGlzTXVsdGlGaWVsZDogaXNNdWx0aUZpZWxkLAogICAgc291cmNlOiBmaWVsZCwKICAgIHBhdGg6IHBhdGgsCiAgICBuZXN0ZWREZXB0aDogbmVzdGVkRGVwdGgKICB9LCAoMCwgX2xpYi5nZXRGaWVsZE1ldGEpKGZpZWxkLCBpc011bHRpRmllbGQpKTsKCiAgdXBkYXRlZEZpZWxkcy5ieUlkW2lkXSA9IG5ld0ZpZWxkOwoKICBpZiAocGFyZW50RmllbGQpIHsKICAgIHZhciBjaGlsZEZpZWxkcyA9IHBhcmVudEZpZWxkLmNoaWxkRmllbGRzIHx8IFtdOyAvLyBVcGRhdGUgcGFyZW50IGZpZWxkIHdpdGggbmV3IGNoaWxkcmVuCgogICAgdXBkYXRlZEZpZWxkcy5ieUlkW2ZpZWxkVG9BZGRGaWVsZFRvXSA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmVudEZpZWxkLCB7CiAgICAgIGNoaWxkRmllbGRzOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGNoaWxkRmllbGRzKSwgW2lkXSksCiAgICAgIGhhc0NoaWxkRmllbGRzOiBwYXJlbnRGaWVsZC5jYW5IYXZlQ2hpbGRGaWVsZHMsCiAgICAgIGhhc011bHRpRmllbGRzOiBwYXJlbnRGaWVsZC5jYW5IYXZlTXVsdGlGaWVsZHMsCiAgICAgIGlzRXhwYW5kZWQ6IHRydWUKICAgIH0pOwogIH0KCiAgaWYgKG5ld0ZpZWxkLnNvdXJjZS50eXBlID09PSAnYWxpYXMnKSB7CiAgICB1cGRhdGVkRmllbGRzLmFsaWFzZXMgPSB1cGRhdGVBbGlhc2VzUmVmZXJlbmNlcyhuZXdGaWVsZCwgdXBkYXRlZEZpZWxkcyk7CiAgfQoKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGlzVmFsaWQ6ICgwLCBfbGliLmlzU3RhdGVWYWxpZCkoc3RhdGUpLAogICAgZmllbGRzOiB1cGRhdGVkRmllbGRzCiAgfSk7Cn07CgpleHBvcnRzLmFkZEZpZWxkVG9TdGF0ZSA9IGFkZEZpZWxkVG9TdGF0ZTsKCnZhciB1cGRhdGVBbGlhc2VzUmVmZXJlbmNlcyA9IGZ1bmN0aW9uIHVwZGF0ZUFsaWFzZXNSZWZlcmVuY2VzKGZpZWxkLCBfcmVmLCBwcmV2aW91c1RhcmdldFBhdGgpIHsKICB2YXIgYWxpYXNlcyA9IF9yZWYuYWxpYXNlczsKCiAgdmFyIHVwZGF0ZWRBbGlhc2VzID0gX29iamVjdFNwcmVhZCh7fSwgYWxpYXNlcyk7CiAgLyoqCiAgICogSWYgdGhlIGZpZWxkIHdoZXJlIHRoZSBhbGlhcyBwb2ludHMgdG8gaGFzIGNoYW5nZWQsIHdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBhbGlhcyBmaWVsZCBpZCBmcm9tIHRoZSBwcmV2aW91cyByZWZlcmVuY2UgYXJyYXkuCiAgICovCgoKICBpZiAocHJldmlvdXNUYXJnZXRQYXRoICYmIHVwZGF0ZWRBbGlhc2VzW3ByZXZpb3VzVGFyZ2V0UGF0aF0pIHsKICAgIHVwZGF0ZWRBbGlhc2VzW3ByZXZpb3VzVGFyZ2V0UGF0aF0gPSB1cGRhdGVkQWxpYXNlc1twcmV2aW91c1RhcmdldFBhdGhdLmZpbHRlcihmdW5jdGlvbiAoaWQpIHsKICAgICAgcmV0dXJuIGlkICE9PSBmaWVsZC5pZDsKICAgIH0pOwogIH0KCiAgdmFyIHRhcmdldElkID0gZmllbGQuc291cmNlLnBhdGg7CgogIGlmICghdXBkYXRlZEFsaWFzZXNbdGFyZ2V0SWRdKSB7CiAgICB1cGRhdGVkQWxpYXNlc1t0YXJnZXRJZF0gPSBbXTsKICB9CgogIHVwZGF0ZWRBbGlhc2VzW3RhcmdldElkXSA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodXBkYXRlZEFsaWFzZXNbdGFyZ2V0SWRdKSwgW2ZpZWxkLmlkXSk7CiAgcmV0dXJuIHVwZGF0ZWRBbGlhc2VzOwp9OwovKioKICogSGVscGVyIHRvIHJlbW92ZSBhIGZpZWxkIGZyb20gb3VyIG1hcCwgaW4gYW4gaW1tdXRhYmxlIHdheS4KICogV2hlbiB3ZSByZW1vdmUgYSBmaWVsZCB3ZSBhbHNvIG5lZWQgdG8gdXBkYXRlIGl0cyBwYXJlbnQgImNoaWxkRmllbGRzIiBhcnJheSwgb3IKICogaWYgdGhlcmUgYXJlIG5vIHBhcmVudCwgd2UgdGhlbiBuZWVkIHRvIHVwZGF0ZSB0aGUgInJvb3RMZXZlbEZpZWxkcyIgYXJyYXkuCiAqCiAqIEBwYXJhbSBmaWVsZElkIFRoZSBmaWVsZCBpZCB0aGF0IGhhcyBiZWVuIHJlbW92ZWQKICogQHBhcmFtIGJ5SWQgVGhlIGZpZWxkcyBtYXAgYnkgSWQKICovCgoKdmFyIHJlbW92ZUZpZWxkRnJvbU1hcCA9IGZ1bmN0aW9uIHJlbW92ZUZpZWxkRnJvbU1hcChmaWVsZElkLCBmaWVsZHMpIHsKICB2YXIgcm9vdExldmVsRmllbGRzID0gZmllbGRzLnJvb3RMZXZlbEZpZWxkczsKCiAgdmFyIHVwZGF0ZWRCeUlkID0gX29iamVjdFNwcmVhZCh7fSwgZmllbGRzLmJ5SWQpOwoKICB2YXIgcGFyZW50SWQgPSB1cGRhdGVkQnlJZFtmaWVsZElkXS5wYXJlbnRJZDsgLy8gUmVtb3ZlIHRoZSBmaWVsZCBmcm9tIHRoZSBtYXAKCiAgZGVsZXRlIHVwZGF0ZWRCeUlkW2ZpZWxkSWRdOwoKICBpZiAocGFyZW50SWQpIHsKICAgIHZhciBwYXJlbnRGaWVsZCA9IHVwZGF0ZWRCeUlkW3BhcmVudElkXTsKCiAgICBpZiAocGFyZW50RmllbGQpIHsKICAgICAgLy8gSWYgdGhlIHBhcmVudCBleGlzdCwgdXBkYXRlIGl0cyBjaGlsZEZpZWxkcyBBcnJheQogICAgICB2YXIgY2hpbGRGaWVsZHMgPSBwYXJlbnRGaWVsZC5jaGlsZEZpZWxkcy5maWx0ZXIoZnVuY3Rpb24gKGNoaWxkSWQpIHsKICAgICAgICByZXR1cm4gY2hpbGRJZCAhPT0gZmllbGRJZDsKICAgICAgfSk7CiAgICAgIHVwZGF0ZWRCeUlkW3BhcmVudElkXSA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmVudEZpZWxkLCB7CiAgICAgICAgY2hpbGRGaWVsZHM6IGNoaWxkRmllbGRzLAogICAgICAgIGhhc0NoaWxkRmllbGRzOiBwYXJlbnRGaWVsZC5jYW5IYXZlQ2hpbGRGaWVsZHMgJiYgQm9vbGVhbihjaGlsZEZpZWxkcy5sZW5ndGgpLAogICAgICAgIGhhc011bHRpRmllbGRzOiBwYXJlbnRGaWVsZC5jYW5IYXZlTXVsdGlGaWVsZHMgJiYgQm9vbGVhbihjaGlsZEZpZWxkcy5sZW5ndGgpLAogICAgICAgIGlzRXhwYW5kZWQ6ICFwYXJlbnRGaWVsZC5oYXNDaGlsZEZpZWxkcyAmJiAhcGFyZW50RmllbGQuaGFzTXVsdGlGaWVsZHMgPyBmYWxzZSA6IHBhcmVudEZpZWxkLmlzRXhwYW5kZWQKICAgICAgfSk7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIElmIHRoZXJlIGFyZSBubyBwYXJlbnRJZCBpdCBtZWFucyB0aGF0IHdlIGhhdmUgZGVsZXRlZCBhIHRvcCBsZXZlbCBmaWVsZAogICAgLy8gV2UgbmVlZCB0byB1cGRhdGUgdGhlIHJvb3QgbGV2ZWwgZmllbGRzIEFycmF5CiAgICByb290TGV2ZWxGaWVsZHMgPSByb290TGV2ZWxGaWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChjaGlsZElkKSB7CiAgICAgIHJldHVybiBjaGlsZElkICE9PSBmaWVsZElkOwogICAgfSk7CiAgfQoKICB2YXIgdXBkYXRlZEZpZWxkcyA9IF9vYmplY3RTcHJlYWQoe30sIGZpZWxkcywgewogICAgcm9vdExldmVsRmllbGRzOiByb290TGV2ZWxGaWVsZHMsCiAgICBieUlkOiB1cGRhdGVkQnlJZAogIH0pOwoKICBpZiAodXBkYXRlZEZpZWxkcy5hbGlhc2VzW2ZpZWxkSWRdKSB7CiAgICAvLyBSZWN1cnNpdmVseSByZW1vdmUgYWxsIHRoZSBhbGlhcyBmaWVsZHMgcG9pbnRpbmcgdG8gdGhpcyBmaWVsZCBiZWluZyByZW1vdmVkLgogICAgdXBkYXRlZEZpZWxkcyA9IHVwZGF0ZWRGaWVsZHMuYWxpYXNlc1tmaWVsZElkXS5yZWR1Y2UoZnVuY3Rpb24gKF91cGRhdGVkRmllbGRzLCBhbGlhc0lkKSB7CiAgICAgIHJldHVybiByZW1vdmVGaWVsZEZyb21NYXAoYWxpYXNJZCwgX3VwZGF0ZWRGaWVsZHMpOwogICAgfSwgdXBkYXRlZEZpZWxkcyk7CgogICAgdmFyIHVwZGRhdGVkQWxpYXNlcyA9IF9vYmplY3RTcHJlYWQoe30sIHVwZGF0ZWRGaWVsZHMuYWxpYXNlcyk7CgogICAgZGVsZXRlIHVwZGRhdGVkQWxpYXNlc1tmaWVsZElkXTsKICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB1cGRhdGVkRmllbGRzLCB7CiAgICAgIGFsaWFzZXM6IHVwZGRhdGVkQWxpYXNlcwogICAgfSk7CiAgfQoKICByZXR1cm4gdXBkYXRlZEZpZWxkczsKfTsKCnZhciByZWR1Y2VyID0gZnVuY3Rpb24gcmVkdWNlcihzdGF0ZSwgYWN0aW9uKSB7CiAgc3dpdGNoIChhY3Rpb24udHlwZSkgewogICAgY2FzZSAnZWRpdG9yLnJlcGxhY2VNYXBwaW5ncyc6CiAgICAgIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICAgIGZpZWxkRm9ybTogdW5kZWZpbmVkLAogICAgICAgICAgZmllbGRzOiBhY3Rpb24udmFsdWUuZmllbGRzLAogICAgICAgICAgY29uZmlndXJhdGlvbjogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuY29uZmlndXJhdGlvbiwgewogICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGFjdGlvbi52YWx1ZS5jb25maWd1cmF0aW9uCiAgICAgICAgICB9KSwKICAgICAgICAgIHRlbXBsYXRlczogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUudGVtcGxhdGVzLCB7CiAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYWN0aW9uLnZhbHVlLnRlbXBsYXRlcwogICAgICAgICAgfSksCiAgICAgICAgICBkb2N1bWVudEZpZWxkczogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuZG9jdW1lbnRGaWVsZHMsIHsKICAgICAgICAgICAgc3RhdHVzOiAnaWRsZScsCiAgICAgICAgICAgIGZpZWxkVG9BZGRGaWVsZFRvOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZpZWxkVG9FZGl0OiB1bmRlZmluZWQKICAgICAgICAgIH0pLAogICAgICAgICAgc2VhcmNoOiB7CiAgICAgICAgICAgIHRlcm06ICcnLAogICAgICAgICAgICByZXN1bHQ6IFtdCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdjb25maWd1cmF0aW9uLnVwZGF0ZSc6CiAgICAgIHsKICAgICAgICB2YXIgbmV4dFN0YXRlID0gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICAgIGNvbmZpZ3VyYXRpb246IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLmNvbmZpZ3VyYXRpb24sIHt9LCBhY3Rpb24udmFsdWUpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBfaXNWYWxpZCA9ICgwLCBfbGliLmlzU3RhdGVWYWxpZCkobmV4dFN0YXRlKTsKCiAgICAgICAgbmV4dFN0YXRlLmlzVmFsaWQgPSBfaXNWYWxpZDsKICAgICAgICByZXR1cm4gbmV4dFN0YXRlOwogICAgICB9CgogICAgY2FzZSAnY29uZmlndXJhdGlvbi5zYXZlJzoKICAgICAgewogICAgICAgIHZhciBfc3RhdGUkY29uZmlndXJhdGlvbiQgPSBzdGF0ZS5jb25maWd1cmF0aW9uLmRhdGEsCiAgICAgICAgICAgIHJhdyA9IF9zdGF0ZSRjb25maWd1cmF0aW9uJC5yYXcsCiAgICAgICAgICAgIF9mb3JtYXQgPSBfc3RhdGUkY29uZmlndXJhdGlvbiQuZm9ybWF0OwoKICAgICAgICB2YXIgY29uZmlndXJhdGlvbkRhdGEgPSBfZm9ybWF0KCk7CgogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgICAgY29uZmlndXJhdGlvbjogewogICAgICAgICAgICBpc1ZhbGlkOiB0cnVlLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGNvbmZpZ3VyYXRpb25EYXRhLAogICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgcmF3OiByYXcsCiAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiBmb3JtYXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvbkRhdGE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBfdmFsaWRhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIF9jYWxsZWUpOwogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX3ZhbGlkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGU7CiAgICAgICAgICAgIH0oKQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgY2FzZSAndGVtcGxhdGVzLnVwZGF0ZSc6CiAgICAgIHsKICAgICAgICB2YXIgX25leHRTdGF0ZSA9IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICB0ZW1wbGF0ZXM6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLnRlbXBsYXRlcywge30sIGFjdGlvbi52YWx1ZSkKICAgICAgICB9KTsKCiAgICAgICAgdmFyIF9pc1ZhbGlkMiA9ICgwLCBfbGliLmlzU3RhdGVWYWxpZCkoX25leHRTdGF0ZSk7CgogICAgICAgIF9uZXh0U3RhdGUuaXNWYWxpZCA9IF9pc1ZhbGlkMjsKICAgICAgICByZXR1cm4gX25leHRTdGF0ZTsKICAgICAgfQoKICAgIGNhc2UgJ3RlbXBsYXRlcy5zYXZlJzoKICAgICAgewogICAgICAgIHZhciBfc3RhdGUkdGVtcGxhdGVzJGRhdGEgPSBzdGF0ZS50ZW1wbGF0ZXMuZGF0YSwKICAgICAgICAgICAgX3JhdyA9IF9zdGF0ZSR0ZW1wbGF0ZXMkZGF0YS5yYXcsCiAgICAgICAgICAgIF9mb3JtYXQyID0gX3N0YXRlJHRlbXBsYXRlcyRkYXRhLmZvcm1hdDsKCiAgICAgICAgdmFyIHRlbXBsYXRlc0RhdGEgPSBfZm9ybWF0MigpOwoKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICAgIHRlbXBsYXRlczogewogICAgICAgICAgICBpc1ZhbGlkOiB0cnVlLAogICAgICAgICAgICBkZWZhdWx0VmFsdWU6IHRlbXBsYXRlc0RhdGEsCiAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICByYXc6IF9yYXcsCiAgICAgICAgICAgICAgZm9ybWF0OiBmdW5jdGlvbiBmb3JtYXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzRGF0YTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIF92YWxpZGF0ZTIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfdmFsaWRhdGUyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdmFsaWRhdGU7CiAgICAgICAgICAgIH0oKQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgY2FzZSAnZmllbGRGb3JtLnVwZGF0ZSc6CiAgICAgIHsKICAgICAgICB2YXIgX25leHRTdGF0ZTIgPSBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgICAgZmllbGRGb3JtOiBhY3Rpb24udmFsdWUKICAgICAgICB9KTsKCiAgICAgICAgdmFyIF9pc1ZhbGlkMyA9ICgwLCBfbGliLmlzU3RhdGVWYWxpZCkoX25leHRTdGF0ZTIpOwoKICAgICAgICBfbmV4dFN0YXRlMi5pc1ZhbGlkID0gX2lzVmFsaWQzOwogICAgICAgIHJldHVybiBfbmV4dFN0YXRlMjsKICAgICAgfQoKICAgIGNhc2UgJ2RvY3VtZW50RmllbGQuY3JlYXRlRmllbGQnOgogICAgICB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICBkb2N1bWVudEZpZWxkczogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuZG9jdW1lbnRGaWVsZHMsIHsKICAgICAgICAgICAgZmllbGRUb0FkZEZpZWxkVG86IGFjdGlvbi52YWx1ZSwKICAgICAgICAgICAgc3RhdHVzOiAnY3JlYXRpbmdGaWVsZCcKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdkb2N1bWVudEZpZWxkLmVkaXRGaWVsZCc6CiAgICAgIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICAgIGRvY3VtZW50RmllbGRzOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5kb2N1bWVudEZpZWxkcywgewogICAgICAgICAgICBzdGF0dXM6ICdlZGl0aW5nRmllbGQnLAogICAgICAgICAgICBmaWVsZFRvRWRpdDogYWN0aW9uLnZhbHVlCiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9CgogICAgY2FzZSAnZG9jdW1lbnRGaWVsZC5jaGFuZ2VTdGF0dXMnOgogICAgICB2YXIgaXNWYWxpZCA9IGFjdGlvbi52YWx1ZSA9PT0gJ2lkbGUnID8gc3RhdGUuY29uZmlndXJhdGlvbi5pc1ZhbGlkIDogc3RhdGUuaXNWYWxpZDsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgaXNWYWxpZDogaXNWYWxpZCwKICAgICAgICBmaWVsZEZvcm06IHVuZGVmaW5lZCwKICAgICAgICBkb2N1bWVudEZpZWxkczogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuZG9jdW1lbnRGaWVsZHMsIHsKICAgICAgICAgIHN0YXR1czogYWN0aW9uLnZhbHVlLAogICAgICAgICAgZmllbGRUb0FkZEZpZWxkVG86IHVuZGVmaW5lZCwKICAgICAgICAgIGZpZWxkVG9FZGl0OiB1bmRlZmluZWQKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlICdkb2N1bWVudEZpZWxkLmNoYW5nZUVkaXRvcic6CiAgICAgIHsKICAgICAgICB2YXIgc3dpdGNoaW5nVG9EZWZhdWx0ID0gYWN0aW9uLnZhbHVlID09PSAnZGVmYXVsdCc7CiAgICAgICAgdmFyIGZpZWxkcyA9IHN3aXRjaGluZ1RvRGVmYXVsdCA/ICgwLCBfbGliLm5vcm1hbGl6ZSkoc3RhdGUuZmllbGRzSnNvbkVkaXRvci5mb3JtYXQoKSkgOiBzdGF0ZS5maWVsZHM7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICBmaWVsZHM6IGZpZWxkcywKICAgICAgICAgIGZpZWxkRm9ybTogdW5kZWZpbmVkLAogICAgICAgICAgZG9jdW1lbnRGaWVsZHM6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLmRvY3VtZW50RmllbGRzLCB7CiAgICAgICAgICAgIHN0YXR1czogJ2lkbGUnLAogICAgICAgICAgICBmaWVsZFRvQWRkRmllbGRUbzogdW5kZWZpbmVkLAogICAgICAgICAgICBmaWVsZFRvRWRpdDogdW5kZWZpbmVkLAogICAgICAgICAgICBlZGl0b3I6IGFjdGlvbi52YWx1ZQogICAgICAgICAgfSkKICAgICAgICB9KTsKICAgICAgfQoKICAgIGNhc2UgJ2ZpZWxkLmFkZCc6CiAgICAgIHsKICAgICAgICByZXR1cm4gYWRkRmllbGRUb1N0YXRlKGFjdGlvbi52YWx1ZSwgc3RhdGUpOwogICAgICB9CgogICAgY2FzZSAnZmllbGQucmVtb3ZlJzoKICAgICAgewogICAgICAgIHZhciBmaWVsZCA9IHN0YXRlLmZpZWxkcy5ieUlkW2FjdGlvbi52YWx1ZV07CiAgICAgICAgdmFyIGlkID0gZmllbGQuaWQsCiAgICAgICAgICAgIGhhc0NoaWxkRmllbGRzID0gZmllbGQuaGFzQ2hpbGRGaWVsZHMsCiAgICAgICAgICAgIGhhc011bHRpRmllbGRzID0gZmllbGQuaGFzTXVsdGlGaWVsZHM7IC8vIFJlbW92ZSB0aGUgZmllbGQKCiAgICAgICAgdmFyIHVwZGF0ZWRGaWVsZHMgPSByZW1vdmVGaWVsZEZyb21NYXAoaWQsIHN0YXRlLmZpZWxkcyk7CgogICAgICAgIGlmIChoYXNDaGlsZEZpZWxkcyB8fCBoYXNNdWx0aUZpZWxkcykgewogICAgICAgICAgdmFyIGFsbENoaWxkRmllbGRzID0gKDAsIF9saWIuZ2V0QWxsQ2hpbGRGaWVsZHMpKGZpZWxkLCBzdGF0ZS5maWVsZHMuYnlJZCk7IC8vIFJlbW92ZSBhbGwgb2YgaXRzIGNoaWxkcmVuCgogICAgICAgICAgYWxsQ2hpbGRGaWVsZHMuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGRGaWVsZCkgewogICAgICAgICAgICB1cGRhdGVkRmllbGRzID0gcmVtb3ZlRmllbGRGcm9tTWFwKGNoaWxkRmllbGQuaWQsIHVwZGF0ZWRGaWVsZHMpOwogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyBIYW5kbGUgQWxpYXMKCgogICAgICAgIGlmIChmaWVsZC5zb3VyY2UudHlwZSA9PT0gJ2FsaWFzJyAmJiBmaWVsZC5zb3VyY2UucGF0aCkgewogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBJZiB3ZSBkZWxldGUgYW4gYWxpYXMgZmllbGQsIHdlIG5lZWQgdG8gcmVtb3ZlIGl0cyBpZCBmcm9tIHRoZSByZWZlcmVuY2UgQXJyYXkKICAgICAgICAgICAqLwogICAgICAgICAgdmFyIHRhcmdldElkID0gZmllbGQuc291cmNlLnBhdGg7CiAgICAgICAgICB1cGRhdGVkRmllbGRzLmFsaWFzZXMgPSBfb2JqZWN0U3ByZWFkKHt9LCB1cGRhdGVkRmllbGRzLmFsaWFzZXMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgdGFyZ2V0SWQsIHVwZGF0ZWRGaWVsZHMuYWxpYXNlc1t0YXJnZXRJZF0uZmlsdGVyKGZ1bmN0aW9uIChhbGlhc0lkKSB7CiAgICAgICAgICAgIHJldHVybiBhbGlhc0lkICE9PSBpZDsKICAgICAgICAgIH0pKSk7CiAgICAgICAgfQoKICAgICAgICB1cGRhdGVkRmllbGRzLm1heE5lc3RlZERlcHRoID0gKDAsIF9saWIuZ2V0TWF4TmVzdGVkRGVwdGgpKHVwZGF0ZWRGaWVsZHMuYnlJZCk7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICBmaWVsZHM6IHVwZGF0ZWRGaWVsZHMsCiAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgc2VhcmNoIGluIHByb2dyZXNzLCB3ZSByZWV4ZWN1dGUgdGhlIHNlYXJjaCB0byB1cGRhdGUgb3VyIHJlc3VsdCBhcnJheQogICAgICAgICAgc2VhcmNoOiBCb29sZWFuKHN0YXRlLnNlYXJjaC50ZXJtKSA/IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLnNlYXJjaCwgewogICAgICAgICAgICByZXN1bHQ6ICgwLCBfbGliLnNlYXJjaEZpZWxkcykoc3RhdGUuc2VhcmNoLnRlcm0sIHVwZGF0ZWRGaWVsZHMuYnlJZCkKICAgICAgICAgIH0pIDogc3RhdGUuc2VhcmNoCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdmaWVsZC5lZGl0JzoKICAgICAgewogICAgICAgIHZhciBfdXBkYXRlZEZpZWxkczIgPSBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5maWVsZHMpOwoKICAgICAgICB2YXIgZmllbGRUb0VkaXQgPSBzdGF0ZS5kb2N1bWVudEZpZWxkcy5maWVsZFRvRWRpdDsKICAgICAgICB2YXIgcHJldmlvdXNGaWVsZCA9IF91cGRhdGVkRmllbGRzMi5ieUlkW2ZpZWxkVG9FZGl0XTsKCiAgICAgICAgdmFyIG5ld0ZpZWxkID0gX29iamVjdFNwcmVhZCh7fSwgcHJldmlvdXNGaWVsZCwgewogICAgICAgICAgc291cmNlOiBhY3Rpb24udmFsdWUKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG5ld0ZpZWxkLnNvdXJjZS50eXBlID09PSAnYWxpYXMnKSB7CiAgICAgICAgICBfdXBkYXRlZEZpZWxkczIuYWxpYXNlcyA9IHVwZGF0ZUFsaWFzZXNSZWZlcmVuY2VzKG5ld0ZpZWxkLCBfdXBkYXRlZEZpZWxkczIsIHByZXZpb3VzRmllbGQuc291cmNlLnBhdGgpOwogICAgICAgIH0KCiAgICAgICAgdmFyIG5hbWVIYXNDaGFuZ2VkID0gbmV3RmllbGQuc291cmNlLm5hbWUgIT09IHByZXZpb3VzRmllbGQuc291cmNlLm5hbWU7CiAgICAgICAgdmFyIHR5cGVIYXNDaGFuZ2VkID0gbmV3RmllbGQuc291cmNlLnR5cGUgIT09IHByZXZpb3VzRmllbGQuc291cmNlLnR5cGU7CgogICAgICAgIGlmIChuYW1lSGFzQ2hhbmdlZCkgewogICAgICAgICAgLy8gSWYgdGhlIG5hbWUgaGFzIGNoYW5nZWQsIHdlIG5lZWQgdG8gdXBkYXRlIHRoZSBgcGF0aGAgb2YgdGhlIGZpZWxkIGFuZCByZWN1cnNpdmVseQogICAgICAgICAgLy8gdGhlIHBhdGhzIG9mIGFsbCBpdHMgImRlc2NlbmRhbnQiIGZpZWxkcyAoY2hpbGQgb3IgbXVsdGktZmllbGQpCiAgICAgICAgICB2YXIgX3VwZGF0ZUZpZWxkc1BhdGhBZnRlID0gKDAsIF9saWIudXBkYXRlRmllbGRzUGF0aEFmdGVyRmllbGROYW1lQ2hhbmdlKShuZXdGaWVsZCwgX3VwZGF0ZWRGaWVsZHMyLmJ5SWQpLAogICAgICAgICAgICAgIHVwZGF0ZWRGaWVsZFBhdGggPSBfdXBkYXRlRmllbGRzUGF0aEFmdGUudXBkYXRlZEZpZWxkUGF0aCwKICAgICAgICAgICAgICB1cGRhdGVkQnlJZCA9IF91cGRhdGVGaWVsZHNQYXRoQWZ0ZS51cGRhdGVkQnlJZDsKCiAgICAgICAgICBuZXdGaWVsZC5wYXRoID0gdXBkYXRlZEZpZWxkUGF0aDsKICAgICAgICAgIF91cGRhdGVkRmllbGRzMi5ieUlkID0gdXBkYXRlZEJ5SWQ7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlZEZpZWxkczIuYnlJZFtmaWVsZFRvRWRpdF0gPSBuZXdGaWVsZDsKCiAgICAgICAgaWYgKHR5cGVIYXNDaGFuZ2VkKSB7CiAgICAgICAgICAvLyBUaGUgZmllbGQgYHR5cGVgIGhhcyBjaGFuZ2VkLCB3ZSBuZWVkIHRvIHVwZGF0ZSBpdHMgbWV0YSBpbmZvcm1hdGlvbgogICAgICAgICAgLy8gYW5kIGRlbGV0ZSBhbGwgaXRzIGNoaWxkcmVuIGZpZWxkcy4KICAgICAgICAgIHZhciBzaG91bGREZWxldGVDaGlsZEZpZWxkcyA9ICgwLCBfbGliLnNob3VsZERlbGV0ZUNoaWxkRmllbGRzQWZ0ZXJUeXBlQ2hhbmdlKShwcmV2aW91c0ZpZWxkLnNvdXJjZS50eXBlLCBuZXdGaWVsZC5zb3VyY2UudHlwZSk7CgogICAgICAgICAgaWYgKHByZXZpb3VzRmllbGQuc291cmNlLnR5cGUgPT09ICdhbGlhcycgJiYgcHJldmlvdXNGaWVsZC5zb3VyY2UucGF0aCkgewogICAgICAgICAgICAvLyBUaGUgZmllbGQgd2FzIHByZXZpb3VzbHkgYW4gYWxpYXMsIG5vdyB0aGF0IGl0IGlzIG5vdCBhbiBhbGlhcyBhbnltb3JlCiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gcmVtb3ZlIGl0cyByZWZlcmVuY2UgZnJvbSBvdXIgc3RhdGUuYWxpYXNlcyBtYXAKICAgICAgICAgICAgX3VwZGF0ZWRGaWVsZHMyLmFsaWFzZXMgPSBfb2JqZWN0U3ByZWFkKHt9LCBfdXBkYXRlZEZpZWxkczIuYWxpYXNlcywgX2RlZmluZVByb3BlcnR5KHt9LCBwcmV2aW91c0ZpZWxkLnNvdXJjZS5wYXRoLCBfdXBkYXRlZEZpZWxkczIuYWxpYXNlc1twcmV2aW91c0ZpZWxkLnNvdXJjZS5wYXRoXS5maWx0ZXIoZnVuY3Rpb24gKGFsaWFzSWQpIHsKICAgICAgICAgICAgICByZXR1cm4gYWxpYXNJZCAhPT0gZmllbGRUb0VkaXQ7CiAgICAgICAgICAgIH0pKSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgbmV4dFR5cGVDYW5IYXZlQWxpYXMgPSAhX2NvbnN0YW50cy5QQVJBTUVURVJTX0RFRklOSVRJT04ucGF0aC50YXJnZXRUeXBlc05vdEFsbG93ZWQuaW5jbHVkZXMobmV3RmllbGQuc291cmNlLnR5cGUpOwoKICAgICAgICAgICAgaWYgKCFuZXh0VHlwZUNhbkhhdmVBbGlhcyAmJiBfdXBkYXRlZEZpZWxkczIuYWxpYXNlc1tmaWVsZFRvRWRpdF0pIHsKICAgICAgICAgICAgICBfdXBkYXRlZEZpZWxkczIuYWxpYXNlc1tmaWVsZFRvRWRpdF0uZm9yRWFjaChmdW5jdGlvbiAoYWxpYXNJZCkgewogICAgICAgICAgICAgICAgX3VwZGF0ZWRGaWVsZHMyID0gcmVtb3ZlRmllbGRGcm9tTWFwKGFsaWFzSWQsIF91cGRhdGVkRmllbGRzMik7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGRlbGV0ZSBfdXBkYXRlZEZpZWxkczIuYWxpYXNlc1tmaWVsZFRvRWRpdF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoc2hvdWxkRGVsZXRlQ2hpbGRGaWVsZHMgJiYgcHJldmlvdXNGaWVsZC5jaGlsZEZpZWxkcykgewogICAgICAgICAgICB2YXIgX2FsbENoaWxkRmllbGRzID0gKDAsIF9saWIuZ2V0QWxsQ2hpbGRGaWVsZHMpKHByZXZpb3VzRmllbGQsIF91cGRhdGVkRmllbGRzMi5ieUlkKTsKCiAgICAgICAgICAgIF9hbGxDaGlsZEZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZEZpZWxkKSB7CiAgICAgICAgICAgICAgX3VwZGF0ZWRGaWVsZHMyID0gcmVtb3ZlRmllbGRGcm9tTWFwKGNoaWxkRmllbGQuaWQsIF91cGRhdGVkRmllbGRzMik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIG5ld0ZpZWxkID0gX29iamVjdFNwcmVhZCh7fSwgbmV3RmllbGQsIHt9LCAoMCwgX2xpYi5nZXRGaWVsZE1ldGEpKGFjdGlvbi52YWx1ZSwgbmV3RmllbGQuaXNNdWx0aUZpZWxkKSwgewogICAgICAgICAgICBjaGlsZEZpZWxkczogc2hvdWxkRGVsZXRlQ2hpbGRGaWVsZHMgPyB1bmRlZmluZWQgOiBwcmV2aW91c0ZpZWxkLmNoaWxkRmllbGRzLAogICAgICAgICAgICBoYXNDaGlsZEZpZWxkczogc2hvdWxkRGVsZXRlQ2hpbGRGaWVsZHMgPyBmYWxzZSA6IHByZXZpb3VzRmllbGQuaGFzQ2hpbGRGaWVsZHMsCiAgICAgICAgICAgIGhhc011bHRpRmllbGRzOiBzaG91bGREZWxldGVDaGlsZEZpZWxkcyA/IGZhbHNlIDogcHJldmlvdXNGaWVsZC5oYXNNdWx0aUZpZWxkcywKICAgICAgICAgICAgaXNFeHBhbmRlZDogc2hvdWxkRGVsZXRlQ2hpbGRGaWVsZHMgPyBmYWxzZSA6IHByZXZpb3VzRmllbGQuaXNFeHBhbmRlZAogICAgICAgICAgfSk7CiAgICAgICAgICBfdXBkYXRlZEZpZWxkczIuYnlJZFtmaWVsZFRvRWRpdF0gPSBuZXdGaWVsZDsKICAgICAgICB9CgogICAgICAgIF91cGRhdGVkRmllbGRzMi5tYXhOZXN0ZWREZXB0aCA9ICgwLCBfbGliLmdldE1heE5lc3RlZERlcHRoKShfdXBkYXRlZEZpZWxkczIuYnlJZCk7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICBpc1ZhbGlkOiAoMCwgX2xpYi5pc1N0YXRlVmFsaWQpKHN0YXRlKSwKICAgICAgICAgIGZpZWxkRm9ybTogdW5kZWZpbmVkLAogICAgICAgICAgZmllbGRzOiBfdXBkYXRlZEZpZWxkczIsCiAgICAgICAgICBkb2N1bWVudEZpZWxkczogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuZG9jdW1lbnRGaWVsZHMsIHsKICAgICAgICAgICAgZmllbGRUb0VkaXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgc3RhdHVzOiAnaWRsZScKICAgICAgICAgIH0pLAogICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHNlYXJjaCBpbiBwcm9ncmVzcywgd2UgcmVleGVjdXRlIHRoZSBzZWFyY2ggdG8gdXBkYXRlIG91ciByZXN1bHQgYXJyYXkKICAgICAgICAgIHNlYXJjaDogQm9vbGVhbihzdGF0ZS5zZWFyY2gudGVybSkgPyBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5zZWFyY2gsIHsKICAgICAgICAgICAgcmVzdWx0OiAoMCwgX2xpYi5zZWFyY2hGaWVsZHMpKHN0YXRlLnNlYXJjaC50ZXJtLCBfdXBkYXRlZEZpZWxkczIuYnlJZCkKICAgICAgICAgIH0pIDogc3RhdGUuc2VhcmNoCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdmaWVsZC50b2dnbGVFeHBhbmQnOgogICAgICB7CiAgICAgICAgdmFyIF9hY3Rpb24kdmFsdWUgPSBhY3Rpb24udmFsdWUsCiAgICAgICAgICAgIGZpZWxkSWQgPSBfYWN0aW9uJHZhbHVlLmZpZWxkSWQsCiAgICAgICAgICAgIGlzRXhwYW5kZWQgPSBfYWN0aW9uJHZhbHVlLmlzRXhwYW5kZWQ7CiAgICAgICAgdmFyIF9wcmV2aW91c0ZpZWxkID0gc3RhdGUuZmllbGRzLmJ5SWRbZmllbGRJZF07CgogICAgICAgIHZhciBuZXh0RmllbGQgPSBfb2JqZWN0U3ByZWFkKHt9LCBfcHJldmlvdXNGaWVsZCwgewogICAgICAgICAgaXNFeHBhbmRlZDogaXNFeHBhbmRlZCA9PT0gdW5kZWZpbmVkID8gIV9wcmV2aW91c0ZpZWxkLmlzRXhwYW5kZWQgOiBpc0V4cGFuZGVkCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgICAgZmllbGRzOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5maWVsZHMsIHsKICAgICAgICAgICAgYnlJZDogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUuZmllbGRzLmJ5SWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgZmllbGRJZCwgbmV4dEZpZWxkKSkKICAgICAgICAgIH0pCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBjYXNlICdmaWVsZHNKc29uRWRpdG9yLnVwZGF0ZSc6CiAgICAgIHsKICAgICAgICB2YXIgX25leHRTdGF0ZTMgPSBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgICAgZmllbGRzSnNvbkVkaXRvcjogewogICAgICAgICAgICBmb3JtYXQ6IGZ1bmN0aW9uIGZvcm1hdCgpIHsKICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uLnZhbHVlLmpzb247CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGlzVmFsaWQ6IGFjdGlvbi52YWx1ZS5pc1ZhbGlkCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIF9uZXh0U3RhdGUzLmlzVmFsaWQgPSAoMCwgX2xpYi5pc1N0YXRlVmFsaWQpKF9uZXh0U3RhdGUzKTsKICAgICAgICByZXR1cm4gX25leHRTdGF0ZTM7CiAgICAgIH0KCiAgICBjYXNlICdzZWFyY2g6dXBkYXRlJzoKICAgICAgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgICAgc2VhcmNoOiB7CiAgICAgICAgICAgIHRlcm06IGFjdGlvbi52YWx1ZSwKICAgICAgICAgICAgcmVzdWx0OiAoMCwgX2xpYi5zZWFyY2hGaWVsZHMpKGFjdGlvbi52YWx1ZSwgc3RhdGUuZmllbGRzLmJ5SWQpCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgRXJyb3IoIkFjdGlvbiBcIiIuY29uY2F0KGFjdGlvbi50eXBlLCAiXCIgbm90IHJlY29nbml6ZWQuIikpOwogIH0KfTsKCmV4cG9ydHMucmVkdWNlciA9IHJlZHVjZXI7"},null]}