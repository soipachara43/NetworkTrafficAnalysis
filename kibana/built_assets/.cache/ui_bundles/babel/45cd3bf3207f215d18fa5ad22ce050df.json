{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/styles/vector/components/vector_style_editor.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/styles/vector/components/vector_style_editor.js","mtime":1589249552472},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlZlY3RvclN0eWxlRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfdmVjdG9yX3N0eWxlX2NvbG9yX2VkaXRvciA9IHJlcXVpcmUoIi4vY29sb3IvdmVjdG9yX3N0eWxlX2NvbG9yX2VkaXRvciIpOwoKdmFyIF92ZWN0b3Jfc3R5bGVfc2l6ZV9lZGl0b3IgPSByZXF1aXJlKCIuL3NpemUvdmVjdG9yX3N0eWxlX3NpemVfZWRpdG9yIik7Cgp2YXIgX3ZlY3Rvcl9zdHlsZV9zeW1ib2xpemVfYXNfZWRpdG9yID0gcmVxdWlyZSgiLi9zeW1ib2wvdmVjdG9yX3N0eWxlX3N5bWJvbGl6ZV9hc19lZGl0b3IiKTsKCnZhciBfdmVjdG9yX3N0eWxlX2ljb25fZWRpdG9yID0gcmVxdWlyZSgiLi9zeW1ib2wvdmVjdG9yX3N0eWxlX2ljb25fZWRpdG9yIik7Cgp2YXIgX3ZlY3Rvcl9zdHlsZV9sYWJlbF9lZGl0b3IgPSByZXF1aXJlKCIuL2xhYmVsL3ZlY3Rvcl9zdHlsZV9sYWJlbF9lZGl0b3IiKTsKCnZhciBfdmVjdG9yX3N0eWxlX2xhYmVsX2JvcmRlcl9zaXplX2VkaXRvciA9IHJlcXVpcmUoIi4vbGFiZWwvdmVjdG9yX3N0eWxlX2xhYmVsX2JvcmRlcl9zaXplX2VkaXRvciIpOwoKdmFyIF9vcmllbnRhdGlvbl9lZGl0b3IgPSByZXF1aXJlKCIuL29yaWVudGF0aW9uL29yaWVudGF0aW9uX2VkaXRvciIpOwoKdmFyIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMgPSByZXF1aXJlKCIuLi92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMiKTsKCnZhciBfY29sb3JfdXRpbHMgPSByZXF1aXJlKCIuLi8uLi9jb2xvcl91dGlscyIpOwoKdmFyIF92ZWN0b3JfZmVhdHVyZV90eXBlcyA9IHJlcXVpcmUoIi4uLy4uLy4uL3NvdXJjZXMvdmVjdG9yX2ZlYXR1cmVfdHlwZXMiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHNlbGYgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7IGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7IH0gX25leHQodW5kZWZpbmVkKTsgfSk7IH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIFZlY3RvclN0eWxlRWRpdG9yID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhWZWN0b3JTdHlsZUVkaXRvciwgX0NvbXBvbmVudCk7CgogIGZ1bmN0aW9uIFZlY3RvclN0eWxlRWRpdG9yKCkgewogICAgdmFyIF9nZXRQcm90b3R5cGVPZjI7CgogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBWZWN0b3JTdHlsZUVkaXRvcik7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihWZWN0b3JTdHlsZUVkaXRvcikpLmNhbGwuYXBwbHkoX2dldFByb3RvdHlwZU9mMiwgW3RoaXNdLmNvbmNhdChhcmdzKSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInN0YXRlIiwgewogICAgICBkYXRlRmllbGRzOiBbXSwKICAgICAgbnVtYmVyRmllbGRzOiBbXSwKICAgICAgZmllbGRzOiBbXSwKICAgICAgb3JkaW5hbEFuZENhdGVnb3JpY2FsRmllbGRzOiBbXSwKICAgICAgZGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzOiAoMCwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5nZXREZWZhdWx0RHluYW1pY1Byb3BlcnRpZXMpKCksCiAgICAgIGRlZmF1bHRTdGF0aWNQcm9wZXJ0aWVzOiAoMCwgX3ZlY3Rvcl9zdHlsZV9kZWZhdWx0cy5nZXREZWZhdWx0U3RhdGljUHJvcGVydGllcykoKSwKICAgICAgc3VwcG9ydGVkRmVhdHVyZXM6IHVuZGVmaW5lZCwKICAgICAgc2VsZWN0ZWRGZWF0dXJlVHlwZTogdW5kZWZpbmVkCiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfaGFuZGxlU2VsZWN0ZWRGZWF0dXJlQ2hhbmdlIiwgZnVuY3Rpb24gKHNlbGVjdGVkRmVhdHVyZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2VsZWN0ZWRGZWF0dXJlOiBzZWxlY3RlZEZlYXR1cmUKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJfb25Jc1RpbWVBd2FyZUNoYW5nZSIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBfdGhpcy5wcm9wcy5vbklzVGltZUF3YXJlQ2hhbmdlKGV2ZW50LnRhcmdldC5jaGVja2VkKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIl9vblN0YXRpY1N0eWxlQ2hhbmdlIiwgZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgb3B0aW9ucykgewogICAgICB2YXIgc3R5bGVEZXNjcmlwdG9yID0gewogICAgICAgIHR5cGU6IF9jb25zdGFudHMuU1RZTEVfVFlQRS5TVEFUSUMsCiAgICAgICAgb3B0aW9uczogb3B0aW9ucwogICAgICB9OwoKICAgICAgX3RoaXMucHJvcHMuaGFuZGxlUHJvcGVydHlDaGFuZ2UocHJvcGVydHlOYW1lLCBzdHlsZURlc2NyaXB0b3IpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiX29uRHluYW1pY1N0eWxlQ2hhbmdlIiwgZnVuY3Rpb24gKHByb3BlcnR5TmFtZSwgb3B0aW9ucykgewogICAgICB2YXIgc3R5bGVEZXNjcmlwdG9yID0gewogICAgICAgIHR5cGU6IF9jb25zdGFudHMuU1RZTEVfVFlQRS5EWU5BTUlDLAogICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgfTsKCiAgICAgIF90aGlzLnByb3BzLmhhbmRsZVByb3BlcnR5Q2hhbmdlKHByb3BlcnR5TmFtZSwgc3R5bGVEZXNjcmlwdG9yKTsKICAgIH0pOwoKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhWZWN0b3JTdHlsZUVkaXRvciwgW3sKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy5faXNNb3VudGVkID0gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICB0aGlzLl9pc01vdW50ZWQgPSB0cnVlOwoKICAgICAgdGhpcy5fbG9hZEZpZWxkcygpOwoKICAgICAgdGhpcy5fbG9hZFN1cHBvcnRlZEZlYXR1cmVzKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY29tcG9uZW50RGlkVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRVcGRhdGUoKSB7CiAgICAgIHRoaXMuX2xvYWRGaWVsZHMoKTsKCiAgICAgIHRoaXMuX2xvYWRTdXBwb3J0ZWRGZWF0dXJlcygpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9sb2FkRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbG9hZEZpZWxkczIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgZ2V0RmllbGRNZXRhLCBmaWVsZHMsIGZpZWxkUHJvbWlzZXMsIGZpZWxkc0FycmF5QWxsOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBnZXRGaWVsZE1ldGEgPQogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXRMYWJlbCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MSA9IGZpZWxkLmdldE5hbWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0LnQyID0gZmllbGQuZ2V0T3JpZ2luKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5nZXREYXRhVHlwZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC50MyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBfY29udGV4dC50MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogX2NvbnRleHQudDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogX2NvbnRleHQudDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IF9jb250ZXh0LnQzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBnZXRGaWVsZE1ldGEoX3gpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpOyAvL1RoZXNlIGFyZSBhbGwgZmllbGRzIChvbmx5IHVzZWQgZm9yIHRleHQgbGFiZWxpbmcpCgoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3BzLmxheWVyLmdldFN0eWxlRWRpdG9yRmllbGRzKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGZpZWxkcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgZmllbGRQcm9taXNlcyA9IGZpZWxkcy5tYXAoZ2V0RmllbGRNZXRhKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChmaWVsZFByb21pc2VzKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgZmllbGRzQXJyYXlBbGwgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoISghdGhpcy5faXNNb3VudGVkIHx8IF9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGZpZWxkc0FycmF5QWxsLCB0aGlzLnN0YXRlLmZpZWxkcykpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBmaWVsZHM6IGZpZWxkc0FycmF5QWxsLAogICAgICAgICAgICAgICAgICBvcmRpbmFsQW5kQ2F0ZWdvcmljYWxGaWVsZHM6IGZpZWxkc0FycmF5QWxsLmZpbHRlcihmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnN0YW50cy5DQVRFR09SSUNBTF9EQVRBX1RZUEVTLmluY2x1ZGVzKGZpZWxkLnR5cGUpIHx8IF9jb25zdGFudHMuT1JESU5BTF9EQVRBX1RZUEVTLmluY2x1ZGVzKGZpZWxkLnR5cGUpOwogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgZGF0ZUZpZWxkczogZmllbGRzQXJyYXlBbGwuZmlsdGVyKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC50eXBlID09PSAnZGF0ZSc7CiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICBudW1iZXJGaWVsZHM6IGZpZWxkc0FycmF5QWxsLmZpbHRlcihmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmllbGQudHlwZSA9PT0gJ251bWJlcic7CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9sb2FkRmllbGRzKCkgewogICAgICAgIHJldHVybiBfbG9hZEZpZWxkczIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9sb2FkRmllbGRzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2xvYWRTdXBwb3J0ZWRGZWF0dXJlcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2xvYWRTdXBwb3J0ZWRGZWF0dXJlczIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgc3VwcG9ydGVkRmVhdHVyZXMsIHNlbGVjdGVkRmVhdHVyZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMubGF5ZXIuZ2V0U291cmNlKCkuZ2V0U3VwcG9ydGVkU2hhcGVUeXBlcygpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBzdXBwb3J0ZWRGZWF0dXJlcyA9IF9jb250ZXh0My5zZW50OwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9pc01vdW50ZWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHNlbGVjdGVkRmVhdHVyZSA9IF92ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuUE9MWUdPTjsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9wcy5pc1BvaW50c09ubHkpIHsKICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlID0gX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5pc0xpbmVzT25seSkgewogICAgICAgICAgICAgICAgICBzZWxlY3RlZEZlYXR1cmUgPSBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChzdXBwb3J0ZWRGZWF0dXJlcywgdGhpcy5zdGF0ZS5zdXBwb3J0ZWRGZWF0dXJlcykgfHwgc2VsZWN0ZWRGZWF0dXJlICE9PSB0aGlzLnN0YXRlLnNlbGVjdGVkRmVhdHVyZSkgewogICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICBzdXBwb3J0ZWRGZWF0dXJlczogc3VwcG9ydGVkRmVhdHVyZXMsCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRGZWF0dXJlOiBzZWxlY3RlZEZlYXR1cmUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9sb2FkU3VwcG9ydGVkRmVhdHVyZXMoKSB7CiAgICAgICAgcmV0dXJuIF9sb2FkU3VwcG9ydGVkRmVhdHVyZXMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfbG9hZFN1cHBvcnRlZEZlYXR1cmVzOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2dldE9yZGluYWxGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRPcmRpbmFsRmllbGRzKCkgewogICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLnN0YXRlLmRhdGVGaWVsZHMpLCBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5zdGF0ZS5udW1iZXJGaWVsZHMpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFzTWFya2VyT3JJY29uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaGFzTWFya2VyT3JJY29uKCkgewogICAgICB2YXIgaWNvblNpemUgPSB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9TSVpFXTsKICAgICAgcmV0dXJuIGljb25TaXplLmlzRHluYW1pYygpIHx8IGljb25TaXplLmdldE9wdGlvbnMoKS5zaXplID4gMDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFzTGFiZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9oYXNMYWJlbCgpIHsKICAgICAgdmFyIGxhYmVsID0gdGhpcy5wcm9wcy5zdHlsZVByb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFRdOwogICAgICByZXR1cm4gbGFiZWwuaXNEeW5hbWljKCkgPyBsYWJlbC5pc0NvbXBsZXRlKCkgOiBsYWJlbC5nZXRPcHRpb25zKCkudmFsdWUgIT0gbnVsbCAmJiBsYWJlbC5nZXRPcHRpb25zKCkudmFsdWUubGVuZ3RoOwogICAgfQogIH0sIHsKICAgIGtleTogIl9oYXNMYWJlbEJvcmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhc0xhYmVsQm9yZGVyKCkgewogICAgICB2YXIgbGFiZWxCb3JkZXJTaXplID0gdGhpcy5wcm9wcy5zdHlsZVByb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0JPUkRFUl9TSVpFXTsKICAgICAgcmV0dXJuIGxhYmVsQm9yZGVyU2l6ZS5nZXRPcHRpb25zKCkuc2l6ZSAhPT0gX2NvbnN0YW50cy5MQUJFTF9CT1JERVJfU0laRVMuTk9ORTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyRmlsbENvbG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyRmlsbENvbG9yKCkgewogICAgICB2YXIgaXNQb2ludEZpbGxDb2xvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92ZWN0b3Jfc3R5bGVfY29sb3JfZWRpdG9yLlZlY3RvclN0eWxlQ29sb3JFZGl0b3IsIHsKICAgICAgICBkaXNhYmxlZDogaXNQb2ludEZpbGxDb2xvciAmJiAhdGhpcy5faGFzTWFya2VyT3JJY29uKCksCiAgICAgICAgZGlzYWJsZWRCeTogX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05fU0laRSwKICAgICAgICBzd2F0Y2hlczogX2NvbG9yX3V0aWxzLkRFRkFVTFRfRklMTF9DT0xPUlMsCiAgICAgICAgb25TdGF0aWNTdHlsZUNoYW5nZTogdGhpcy5fb25TdGF0aWNTdHlsZUNoYW5nZSwKICAgICAgICBvbkR5bmFtaWNTdHlsZUNoYW5nZTogdGhpcy5fb25EeW5hbWljU3R5bGVDaGFuZ2UsCiAgICAgICAgc3R5bGVQcm9wZXJ0eTogdGhpcy5wcm9wcy5zdHlsZVByb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkZJTExfQ09MT1JdLAogICAgICAgIGZpZWxkczogdGhpcy5zdGF0ZS5vcmRpbmFsQW5kQ2F0ZWdvcmljYWxGaWVsZHMsCiAgICAgICAgZGVmYXVsdFN0YXRpY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0U3RhdGljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuRklMTF9DT0xPUl0ub3B0aW9ucywKICAgICAgICBkZWZhdWx0RHluYW1pY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0RHluYW1pY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkZJTExfQ09MT1JdLm9wdGlvbnMKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3JlbmRlckxpbmVDb2xvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlckxpbmVDb2xvcigpIHsKICAgICAgdmFyIGlzUG9pbnRCb3JkZXJDb2xvciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CiAgICAgIHZhciBkaXNhYmxlZEJ5SWNvblNpemUgPSBpc1BvaW50Qm9yZGVyQ29sb3IgJiYgIXRoaXMuX2hhc01hcmtlck9ySWNvbigpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfdmVjdG9yX3N0eWxlX2NvbG9yX2VkaXRvci5WZWN0b3JTdHlsZUNvbG9yRWRpdG9yLCB7CiAgICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkQnlJY29uU2l6ZSB8fCAhdGhpcy5wcm9wcy5oYXNCb3JkZXIsCiAgICAgICAgZGlzYWJsZWRCeTogZGlzYWJsZWRCeUljb25TaXplID8gX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05fU0laRSA6IF9jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MSU5FX1dJRFRILAogICAgICAgIHN3YXRjaGVzOiBfY29sb3JfdXRpbHMuREVGQVVMVF9MSU5FX0NPTE9SUywKICAgICAgICBvblN0YXRpY1N0eWxlQ2hhbmdlOiB0aGlzLl9vblN0YXRpY1N0eWxlQ2hhbmdlLAogICAgICAgIG9uRHluYW1pY1N0eWxlQ2hhbmdlOiB0aGlzLl9vbkR5bmFtaWNTdHlsZUNoYW5nZSwKICAgICAgICBzdHlsZVByb3BlcnR5OiB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTElORV9DT0xPUl0sCiAgICAgICAgZmllbGRzOiB0aGlzLnN0YXRlLm9yZGluYWxBbmRDYXRlZ29yaWNhbEZpZWxkcywKICAgICAgICBkZWZhdWx0U3RhdGljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHRTdGF0aWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MSU5FX0NPTE9SXS5vcHRpb25zLAogICAgICAgIGRlZmF1bHREeW5hbWljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHREeW5hbWljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTElORV9DT0xPUl0ub3B0aW9ucwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyTGluZVdpZHRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyTGluZVdpZHRoKCkgewogICAgICB2YXIgaXNQb2ludEJvcmRlcldpZHRoID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9zdHlsZV9zaXplX2VkaXRvci5WZWN0b3JTdHlsZVNpemVFZGl0b3IsIHsKICAgICAgICBkaXNhYmxlZDogaXNQb2ludEJvcmRlcldpZHRoICYmICF0aGlzLl9oYXNNYXJrZXJPckljb24oKSwKICAgICAgICBkaXNhYmxlZEJ5OiBfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9TSVpFLAogICAgICAgIG9uU3RhdGljU3R5bGVDaGFuZ2U6IHRoaXMuX29uU3RhdGljU3R5bGVDaGFuZ2UsCiAgICAgICAgb25EeW5hbWljU3R5bGVDaGFuZ2U6IHRoaXMuX29uRHluYW1pY1N0eWxlQ2hhbmdlLAogICAgICAgIHN0eWxlUHJvcGVydHk6IHRoaXMucHJvcHMuc3R5bGVQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MSU5FX1dJRFRIXSwKICAgICAgICBmaWVsZHM6IHRoaXMuX2dldE9yZGluYWxGaWVsZHMoKSwKICAgICAgICBkZWZhdWx0U3RhdGljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHRTdGF0aWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MSU5FX1dJRFRIXS5vcHRpb25zLAogICAgICAgIGRlZmF1bHREeW5hbWljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHREeW5hbWljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTElORV9XSURUSF0ub3B0aW9ucwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyTGFiZWxQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyTGFiZWxQcm9wZXJ0aWVzKCkgewogICAgICB2YXIgaGFzTGFiZWwgPSB0aGlzLl9oYXNMYWJlbCgpOwoKICAgICAgdmFyIGhhc0xhYmVsQm9yZGVyID0gdGhpcy5faGFzTGFiZWxCb3JkZXIoKTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfdmVjdG9yX3N0eWxlX2xhYmVsX2VkaXRvci5WZWN0b3JTdHlsZUxhYmVsRWRpdG9yLCB7CiAgICAgICAgb25TdGF0aWNTdHlsZUNoYW5nZTogdGhpcy5fb25TdGF0aWNTdHlsZUNoYW5nZSwKICAgICAgICBvbkR5bmFtaWNTdHlsZUNoYW5nZTogdGhpcy5fb25EeW5hbWljU3R5bGVDaGFuZ2UsCiAgICAgICAgc3R5bGVQcm9wZXJ0eTogdGhpcy5wcm9wcy5zdHlsZVByb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFRdLAogICAgICAgIGZpZWxkczogdGhpcy5zdGF0ZS5maWVsZHMsCiAgICAgICAgZGVmYXVsdFN0YXRpY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0U3RhdGljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfVEVYVF0ub3B0aW9ucywKICAgICAgICBkZWZhdWx0RHluYW1pY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0RHluYW1pY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFRdLm9wdGlvbnMKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9zdHlsZV9jb2xvcl9lZGl0b3IuVmVjdG9yU3R5bGVDb2xvckVkaXRvciwgewogICAgICAgIGRpc2FibGVkOiAhaGFzTGFiZWwsCiAgICAgICAgZGlzYWJsZWRCeTogX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFQsCiAgICAgICAgc3dhdGNoZXM6IF9jb2xvcl91dGlscy5ERUZBVUxUX0xJTkVfQ09MT1JTLAogICAgICAgIG9uU3RhdGljU3R5bGVDaGFuZ2U6IHRoaXMuX29uU3RhdGljU3R5bGVDaGFuZ2UsCiAgICAgICAgb25EeW5hbWljU3R5bGVDaGFuZ2U6IHRoaXMuX29uRHluYW1pY1N0eWxlQ2hhbmdlLAogICAgICAgIHN0eWxlUHJvcGVydHk6IHRoaXMucHJvcHMuc3R5bGVQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9DT0xPUl0sCiAgICAgICAgZmllbGRzOiB0aGlzLnN0YXRlLm9yZGluYWxBbmRDYXRlZ29yaWNhbEZpZWxkcywKICAgICAgICBkZWZhdWx0U3RhdGljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHRTdGF0aWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9DT0xPUl0ub3B0aW9ucywKICAgICAgICBkZWZhdWx0RHluYW1pY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0RHluYW1pY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0NPTE9SXS5vcHRpb25zCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92ZWN0b3Jfc3R5bGVfc2l6ZV9lZGl0b3IuVmVjdG9yU3R5bGVTaXplRWRpdG9yLCB7CiAgICAgICAgZGlzYWJsZWQ6ICFoYXNMYWJlbCwKICAgICAgICBkaXNhYmxlZEJ5OiBfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfVEVYVCwKICAgICAgICBvblN0YXRpY1N0eWxlQ2hhbmdlOiB0aGlzLl9vblN0YXRpY1N0eWxlQ2hhbmdlLAogICAgICAgIG9uRHluYW1pY1N0eWxlQ2hhbmdlOiB0aGlzLl9vbkR5bmFtaWNTdHlsZUNoYW5nZSwKICAgICAgICBzdHlsZVByb3BlcnR5OiB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfU0laRV0sCiAgICAgICAgZmllbGRzOiB0aGlzLl9nZXRPcmRpbmFsRmllbGRzKCksCiAgICAgICAgZGVmYXVsdFN0YXRpY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0U3RhdGljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfU0laRV0ub3B0aW9ucywKICAgICAgICBkZWZhdWx0RHluYW1pY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0RHluYW1pY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1NJWkVdLm9wdGlvbnMKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9zdHlsZV9jb2xvcl9lZGl0b3IuVmVjdG9yU3R5bGVDb2xvckVkaXRvciwgewogICAgICAgIGRpc2FibGVkOiAhaGFzTGFiZWwgfHwgIWhhc0xhYmVsQm9yZGVyLAogICAgICAgIGRpc2FibGVkQnk6IGhhc0xhYmVsID8gX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX0JPUkRFUl9TSVpFIDogX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxBQkVMX1RFWFQsCiAgICAgICAgc3dhdGNoZXM6IF9jb2xvcl91dGlscy5ERUZBVUxUX0xJTkVfQ09MT1JTLAogICAgICAgIG9uU3RhdGljU3R5bGVDaGFuZ2U6IHRoaXMuX29uU3RhdGljU3R5bGVDaGFuZ2UsCiAgICAgICAgb25EeW5hbWljU3R5bGVDaGFuZ2U6IHRoaXMuX29uRHluYW1pY1N0eWxlQ2hhbmdlLAogICAgICAgIHN0eWxlUHJvcGVydHk6IHRoaXMucHJvcHMuc3R5bGVQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9CT1JERVJfQ09MT1JdLAogICAgICAgIGZpZWxkczogdGhpcy5zdGF0ZS5vcmRpbmFsQW5kQ2F0ZWdvcmljYWxGaWVsZHMsCiAgICAgICAgZGVmYXVsdFN0YXRpY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0U3RhdGljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfQk9SREVSX0NPTE9SXS5vcHRpb25zLAogICAgICAgIGRlZmF1bHREeW5hbWljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHREeW5hbWljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfQk9SREVSX0NPTE9SXS5vcHRpb25zCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92ZWN0b3Jfc3R5bGVfbGFiZWxfYm9yZGVyX3NpemVfZWRpdG9yLlZlY3RvclN0eWxlTGFiZWxCb3JkZXJTaXplRWRpdG9yLCB7CiAgICAgICAgZGlzYWJsZWQ6ICFoYXNMYWJlbCwKICAgICAgICBkaXNhYmxlZEJ5OiBfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfVEVYVCwKICAgICAgICBoYW5kbGVQcm9wZXJ0eUNoYW5nZTogdGhpcy5wcm9wcy5oYW5kbGVQcm9wZXJ0eUNoYW5nZSwKICAgICAgICBzdHlsZVByb3BlcnR5OiB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfQk9SREVSX1NJWkVdCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyUG9pbnRQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyUG9pbnRQcm9wZXJ0aWVzKCkgewogICAgICB2YXIgaGFzTWFya2VyT3JJY29uID0gdGhpcy5faGFzTWFya2VyT3JJY29uKCk7CgogICAgICB2YXIgaWNvbk9yaWVudGF0aW9uRWRpdG9yOwogICAgICB2YXIgaWNvbkVkaXRvcjsKCiAgICAgIGlmICh0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuU1lNQk9MSVpFX0FTXS5pc1N5bWJvbGl6ZWRBc0ljb24oKSkgewogICAgICAgIGljb25PcmllbnRhdGlvbkVkaXRvciA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9vcmllbnRhdGlvbl9lZGl0b3IuT3JpZW50YXRpb25FZGl0b3IsIHsKICAgICAgICAgIGRpc2FibGVkOiAhaGFzTWFya2VyT3JJY29uLAogICAgICAgICAgZGlzYWJsZWRCeTogX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05fU0laRSwKICAgICAgICAgIG9uU3RhdGljU3R5bGVDaGFuZ2U6IHRoaXMuX29uU3RhdGljU3R5bGVDaGFuZ2UsCiAgICAgICAgICBvbkR5bmFtaWNTdHlsZUNoYW5nZTogdGhpcy5fb25EeW5hbWljU3R5bGVDaGFuZ2UsCiAgICAgICAgICBzdHlsZVByb3BlcnR5OiB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9PUklFTlRBVElPTl0sCiAgICAgICAgICBmaWVsZHM6IHRoaXMuc3RhdGUubnVtYmVyRmllbGRzLAogICAgICAgICAgZGVmYXVsdFN0YXRpY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0U3RhdGljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9PUklFTlRBVElPTl0ub3B0aW9ucywKICAgICAgICAgIGRlZmF1bHREeW5hbWljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHREeW5hbWljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9PUklFTlRBVElPTl0ub3B0aW9ucwogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICBzaXplOiAibSIKICAgICAgICB9KSk7CiAgICAgICAgaWNvbkVkaXRvciA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF92ZWN0b3Jfc3R5bGVfaWNvbl9lZGl0b3IuVmVjdG9yU3R5bGVJY29uRWRpdG9yLCB7CiAgICAgICAgICBkaXNhYmxlZDogIWhhc01hcmtlck9ySWNvbiwKICAgICAgICAgIGRpc2FibGVkQnk6IF9jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5JQ09OX1NJWkUsCiAgICAgICAgICBvblN0YXRpY1N0eWxlQ2hhbmdlOiB0aGlzLl9vblN0YXRpY1N0eWxlQ2hhbmdlLAogICAgICAgICAgb25EeW5hbWljU3R5bGVDaGFuZ2U6IHRoaXMuX29uRHluYW1pY1N0eWxlQ2hhbmdlLAogICAgICAgICAgc3R5bGVQcm9wZXJ0eTogdGhpcy5wcm9wcy5zdHlsZVByb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05dLAogICAgICAgICAgZmllbGRzOiB0aGlzLnN0YXRlLm9yZGluYWxBbmRDYXRlZ29yaWNhbEZpZWxkcywKICAgICAgICAgIGRlZmF1bHRTdGF0aWNTdHlsZU9wdGlvbnM6IHRoaXMuc3RhdGUuZGVmYXVsdFN0YXRpY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05dLm9wdGlvbnMsCiAgICAgICAgICBkZWZhdWx0RHluYW1pY1N0eWxlT3B0aW9uczogdGhpcy5zdGF0ZS5kZWZhdWx0RHluYW1pY1Byb3BlcnRpZXNbX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05dLm9wdGlvbnMKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogIm0iCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9zdHlsZV9zeW1ib2xpemVfYXNfZWRpdG9yLlZlY3RvclN0eWxlU3ltYm9saXplQXNFZGl0b3IsIHsKICAgICAgICBkaXNhYmxlZDogIWhhc01hcmtlck9ySWNvbiwKICAgICAgICBkaXNhYmxlZEJ5OiBfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9TSVpFLAogICAgICAgIHN0eWxlUHJvcGVydHk6IHRoaXMucHJvcHMuc3R5bGVQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5TWU1CT0xJWkVfQVNdLAogICAgICAgIGhhbmRsZVByb3BlcnR5Q2hhbmdlOiB0aGlzLnByb3BzLmhhbmRsZVByb3BlcnR5Q2hhbmdlCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBpY29uRWRpdG9yLCB0aGlzLl9yZW5kZXJGaWxsQ29sb3IodHJ1ZSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIHRoaXMuX3JlbmRlckxpbmVDb2xvcih0cnVlKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgdGhpcy5fcmVuZGVyTGluZVdpZHRoKHRydWUpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBpY29uT3JpZW50YXRpb25FZGl0b3IsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3ZlY3Rvcl9zdHlsZV9zaXplX2VkaXRvci5WZWN0b3JTdHlsZVNpemVFZGl0b3IsIHsKICAgICAgICBvblN0YXRpY1N0eWxlQ2hhbmdlOiB0aGlzLl9vblN0YXRpY1N0eWxlQ2hhbmdlLAogICAgICAgIG9uRHluYW1pY1N0eWxlQ2hhbmdlOiB0aGlzLl9vbkR5bmFtaWNTdHlsZUNoYW5nZSwKICAgICAgICBzdHlsZVByb3BlcnR5OiB0aGlzLnByb3BzLnN0eWxlUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuSUNPTl9TSVpFXSwKICAgICAgICBmaWVsZHM6IHRoaXMuX2dldE9yZGluYWxGaWVsZHMoKSwKICAgICAgICBkZWZhdWx0U3RhdGljU3R5bGVPcHRpb25zOiB0aGlzLnN0YXRlLmRlZmF1bHRTdGF0aWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5JQ09OX1NJWkVdLm9wdGlvbnMsCiAgICAgICAgZGVmYXVsdER5bmFtaWNTdHlsZU9wdGlvbnM6IHRoaXMuc3RhdGUuZGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5JQ09OX1NJWkVdLm9wdGlvbnMKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIHRoaXMuX3JlbmRlckxhYmVsUHJvcGVydGllcygpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfcmVuZGVyTGluZVByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZW5kZXJMaW5lUHJvcGVydGllcygpIHsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCB0aGlzLl9yZW5kZXJMaW5lQ29sb3IoKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgdGhpcy5fcmVuZGVyTGluZVdpZHRoKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9yZW5kZXJQb2x5Z29uUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlclBvbHlnb25Qcm9wZXJ0aWVzKCkgewogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIHRoaXMuX3JlbmRlckZpbGxDb2xvcigpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCB0aGlzLl9yZW5kZXJMaW5lQ29sb3IoKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgdGhpcy5fcmVuZGVyTGluZVdpZHRoKCkpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9yZW5kZXJQcm9wZXJ0aWVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVuZGVyUHJvcGVydGllcygpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIHN1cHBvcnRlZEZlYXR1cmVzID0gX3RoaXMkc3RhdGUuc3VwcG9ydGVkRmVhdHVyZXMsCiAgICAgICAgICBzZWxlY3RlZEZlYXR1cmUgPSBfdGhpcyRzdGF0ZS5zZWxlY3RlZEZlYXR1cmU7CgogICAgICBpZiAoIXN1cHBvcnRlZEZlYXR1cmVzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChzdXBwb3J0ZWRGZWF0dXJlcy5sZW5ndGggPT09IDEpIHsKICAgICAgICBzd2l0Y2ggKHN1cHBvcnRlZEZlYXR1cmVzWzBdKSB7CiAgICAgICAgICBjYXNlIF92ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuUE9JTlQ6CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJQb2ludFByb3BlcnRpZXMoKTsKCiAgICAgICAgICBjYXNlIF92ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuTElORToKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlckxpbmVQcm9wZXJ0aWVzKCk7CgogICAgICAgICAgY2FzZSBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT046CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJQb2x5Z29uUHJvcGVydGllcygpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIGZlYXR1cmVCdXR0b25zID0gW3sKICAgICAgICBpZDogX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVCwKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMudmVjdG9yU3R5bGVFZGl0b3IucG9pbnRMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUG9pbnRzJwogICAgICAgIH0pCiAgICAgIH0sIHsKICAgICAgICBpZDogX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5MSU5FLAogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy52ZWN0b3JTdHlsZUVkaXRvci5saW5lTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0xpbmVzJwogICAgICAgIH0pCiAgICAgIH0sIHsKICAgICAgICBpZDogX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0xZR09OLAogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy52ZWN0b3JTdHlsZUVkaXRvci5wb2x5Z29uTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1BvbHlnb25zJwogICAgICAgIH0pCiAgICAgIH1dOwoKICAgICAgdmFyIHN0eWxlUHJvcGVydGllcyA9IHRoaXMuX3JlbmRlclBvbHlnb25Qcm9wZXJ0aWVzKCk7CgogICAgICBpZiAoc2VsZWN0ZWRGZWF0dXJlID09PSBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkUpIHsKICAgICAgICBzdHlsZVByb3BlcnRpZXMgPSB0aGlzLl9yZW5kZXJMaW5lUHJvcGVydGllcygpOwogICAgICB9IGVsc2UgaWYgKHNlbGVjdGVkRmVhdHVyZSA9PT0gX3ZlY3Rvcl9mZWF0dXJlX3R5cGVzLlZFQ1RPUl9TSEFQRV9UWVBFUy5QT0lOVCkgewogICAgICAgIHN0eWxlUHJvcGVydGllcyA9IHRoaXMuX3JlbmRlclBvaW50UHJvcGVydGllcygpOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25Hcm91cCwgewogICAgICAgIGxlZ2VuZDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMudmVjdG9yU3R5bGVFZGl0b3IuZmVhdHVyZVR5cGVCdXR0b25Hcm91cExlZ2VuZCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAndmVjdG9yIGZlYXR1cmUgYnV0dG9uIGdyb3VwJwogICAgICAgIH0pLAogICAgICAgIG9wdGlvbnM6IGZlYXR1cmVCdXR0b25zLAogICAgICAgIGlkU2VsZWN0ZWQ6IHNlbGVjdGVkRmVhdHVyZSwKICAgICAgICBvbkNoYW5nZTogdGhpcy5faGFuZGxlU2VsZWN0ZWRGZWF0dXJlQ2hhbmdlCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBzdHlsZVByb3BlcnRpZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9yZW5kZXJJc1RpbWVBd2FyZVN3aXRjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbmRlcklzVGltZUF3YXJlU3dpdGNoKCkgewogICAgICBpZiAoIXRoaXMucHJvcHMuc2hvd0lzVGltZUF3YXJlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGRpc3BsYXk6ICJjb2x1bW5Db21wcmVzc2VkU3dpdGNoIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3dpdGNoLCB7CiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnZlY3RvclN0eWxlRWRpdG9yLmlzVGltZUF3YXJlTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0FwcGx5IGdsb2JhbCB0aW1lIHRvIHN0eWxlIG1ldGFkYXRhIHJlcXVlc3RzJwogICAgICAgIH0pLAogICAgICAgIGNoZWNrZWQ6IHRoaXMucHJvcHMuaXNUaW1lQXdhcmUsCiAgICAgICAgb25DaGFuZ2U6IHRoaXMuX29uSXNUaW1lQXdhcmVDaGFuZ2UsCiAgICAgICAgY29tcHJlc3NlZDogdHJ1ZQogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgdGhpcy5fcmVuZGVyUHJvcGVydGllcygpLCB0aGlzLl9yZW5kZXJJc1RpbWVBd2FyZVN3aXRjaCgpKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBWZWN0b3JTdHlsZUVkaXRvcjsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuVmVjdG9yU3R5bGVFZGl0b3IgPSBWZWN0b3JTdHlsZUVkaXRvcjs="},null]}