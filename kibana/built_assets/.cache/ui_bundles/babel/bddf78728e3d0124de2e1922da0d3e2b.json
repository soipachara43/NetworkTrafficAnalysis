{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/vis/map/kibana_map.js","dependencies":[{"path":"src/legacy/ui/public/vis/map/kibana_map.js","mtime":1589249550387},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLktpYmFuYU1hcCA9IHZvaWQgMDsKCnZhciBfZXZlbnRzID0gcmVxdWlyZSgiZXZlbnRzIik7Cgp2YXIgX21hcF9tZXNzYWdlcyA9IHJlcXVpcmUoIi4vbWFwX21lc3NhZ2VzIik7Cgp2YXIgX2xlYWZsZXQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxlYWZsZXQiKSk7Cgp2YXIgX2pxdWVyeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgianF1ZXJ5IikpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfem9vbV90b19wcmVjaXNpb24gPSByZXF1aXJlKCIuL3pvb21fdG9fcHJlY2lzaW9uIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfb3JpZ2luID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29yZV9wbHVnaW5zL3RpbGVfbWFwL2NvbW1vbi9vcmlnaW4iKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSAic3ltYm9sIikgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH07IH0gZWxzZSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mKG9iaik7IH0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsgdHJ5IHsgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOyB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOyB9IGNhdGNoIChlcnJvcikgeyByZWplY3QoZXJyb3IpOyByZXR1cm47IH0gaWYgKGluZm8uZG9uZSkgeyByZXNvbHZlKHZhbHVlKTsgfSBlbHNlIHsgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOyB9IH0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7IHZhciBzZWxmID0gdGhpcywgYXJncyA9IGFyZ3VtZW50czsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOyBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOyB9IGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOyB9IF9uZXh0KHVuZGVmaW5lZCk7IH0pOyB9OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCmZ1bmN0aW9uIG1ha2VGaXRDb250cm9sKGZpdENvbnRhaW5lciwga2liYW5hTWFwKSB7CiAgdmFyIEZpdENvbnRyb2wgPSBfbGVhZmxldC5kZWZhdWx0LkNvbnRyb2wuZXh0ZW5kKHsKICAgIG9wdGlvbnM6IHsKICAgICAgcG9zaXRpb246ICd0b3BsZWZ0JwogICAgfSwKICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoZml0Q29udGFpbmVyLCBraWJhbmFNYXApIHsKICAgICAgdGhpcy5fZml0Q29udGFpbmVyID0gZml0Q29udGFpbmVyOwogICAgICB0aGlzLl9raWJhbmFNYXAgPSBraWJhbmFNYXA7CiAgICAgIHRoaXMuX2xlYWZsZXRNYXAgPSBudWxsOwogICAgfSwKICAgIG9uQWRkOiBmdW5jdGlvbiBvbkFkZChsZWFmbGV0TWFwKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB0aGlzLl9sZWFmbGV0TWFwID0gbGVhZmxldE1hcDsKCiAgICAgIHZhciBmaXREYXRCb3VuZHNMYWJlbCA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkudmlzLmtpYmFuYU1hcC5sZWFmbGV0LmZpdERhdGFCb3VuZHNBcmlhTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdGaXQgRGF0YSBCb3VuZHMnCiAgICAgIH0pOwoKICAgICAgKDAsIF9qcXVlcnkuZGVmYXVsdCkodGhpcy5fZml0Q29udGFpbmVyKS5odG1sKCI8YSBjbGFzcz1cImt1aUljb24gZmEtY3JvcFwiIGhyZWY9XCIjXCIgdGl0bGU9XCIiLmNvbmNhdChmaXREYXRCb3VuZHNMYWJlbCwgIlwiIGFyaWEtbGFiZWw9XCIiKS5jb25jYXQoZml0RGF0Qm91bmRzTGFiZWwsICJcIj48L2E+IikpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICBfdGhpcy5fa2liYW5hTWFwLmZpdFRvRGF0YSgpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRoaXMuX2ZpdENvbnRhaW5lcjsKICAgIH0sCiAgICBvblJlbW92ZTogZnVuY3Rpb24gb25SZW1vdmUoKSB7CiAgICAgICgwLCBfanF1ZXJ5LmRlZmF1bHQpKHRoaXMuX2ZpdENvbnRhaW5lcikub2ZmKCdjbGljaycpOwogICAgfQogIH0pOwoKICByZXR1cm4gbmV3IEZpdENvbnRyb2woZml0Q29udGFpbmVyLCBraWJhbmFNYXApOwp9CgpmdW5jdGlvbiBtYWtlTGVnZW5kQ29udHJvbChjb250YWluZXIsIGtpYmFuYU1hcCwgcG9zaXRpb24pIHsKICB2YXIgTGVnZW5kQ29udHJvbCA9IF9sZWFmbGV0LmRlZmF1bHQuQ29udHJvbC5leHRlbmQoewogICAgb3B0aW9uczogewogICAgICBwb3NpdGlvbjogJ3RvcHJpZ2h0JwogICAgfSwKICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCBraWJhbmFNYXAsIHBvc2l0aW9uKSB7CiAgICAgIHRoaXMuX2xlZ2VuZENvbnRhaW5lciA9IGNvbnRhaW5lcjsKICAgICAgdGhpcy5fa2liYW5hTWFwID0ga2liYW5hTWFwOwogICAgICB0aGlzLm9wdGlvbnMucG9zaXRpb24gPSBwb3NpdGlvbjsKICAgIH0sCiAgICB1cGRhdGVDb250ZW50czogZnVuY3Rpb24gdXBkYXRlQ29udGVudHMoKSB7CiAgICAgIHRoaXMuX2xlZ2VuZENvbnRhaW5lci5lbXB0eSgpOwoKICAgICAgdmFyICRkaXYgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgnPGRpdj4nKS5hZGRDbGFzcygndmlzTWFwTGVnZW5kJyk7CgogICAgICB0aGlzLl9sZWdlbmRDb250YWluZXIuYXBwZW5kKCRkaXYpOwoKICAgICAgdmFyIGxheWVycyA9IHRoaXMuX2tpYmFuYU1hcC5nZXRMYXllcnMoKTsKCiAgICAgIGxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5hcHBlbmRMZWdlbmRDb250ZW50cygkZGl2KTsKICAgICAgfSk7CiAgICB9LAogICAgb25BZGQ6IGZ1bmN0aW9uIG9uQWRkKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHRoaXMuX2xheWVyVXBkYXRlSGFuZGxlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczIudXBkYXRlQ29udGVudHMoKTsKICAgICAgfTsKCiAgICAgIHRoaXMuX2tpYmFuYU1hcC5vbignbGF5ZXJzOnVwZGF0ZScsIHRoaXMuX2xheWVyVXBkYXRlSGFuZGxlKTsKCiAgICAgIHRoaXMudXBkYXRlQ29udGVudHMoKTsKICAgICAgcmV0dXJuIHRoaXMuX2xlZ2VuZENvbnRhaW5lci5nZXQoMCk7CiAgICB9LAogICAgb25SZW1vdmU6IGZ1bmN0aW9uIG9uUmVtb3ZlKCkgewogICAgICB0aGlzLl9raWJhbmFNYXAucmVtb3ZlTGlzdGVuZXIoJ2xheWVyczp1cGRhdGUnLCB0aGlzLl9sYXllclVwZGF0ZUhhbmRsZSk7CgogICAgICB0aGlzLl9sZWdlbmRDb250YWluZXIuZW1wdHkoKTsKICAgIH0KICB9KTsKCiAgcmV0dXJuIG5ldyBMZWdlbmRDb250cm9sKGNvbnRhaW5lciwga2liYW5hTWFwLCBwb3NpdGlvbik7Cn0KLyoqCiAqIENvbGxlY3RzIG1hcCBmdW5jdGlvbmFsaXR5IHJlcXVpcmVkIGZvciBLaWJhbmEuCiAqIFNlcnZlcyBhcyBzaW1wbGUgYWJzdHJhY3Rpb24gZm9yIGxlYWZsZXQgYXMgd2VsbC4KICovCgoKdmFyIEtpYmFuYU1hcCA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoS2liYW5hTWFwLCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gS2liYW5hTWFwKGNvbnRhaW5lck5vZGUsIG9wdGlvbnMpIHsKICAgIHZhciBfdGhpczM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEtpYmFuYU1hcCk7CgogICAgX3RoaXMzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEtpYmFuYU1hcCkuY2FsbCh0aGlzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMzKSwgImdldFpvb21MZXZlbCIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGVhZmxldE1hcC5nZXRab29tKCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpczMpLCAiZ2V0TWF4Wm9vbUxldmVsIiwgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLl9sZWFmbGV0TWFwLmdldE1heFpvb20oKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzMyksICJfYWRkTWF4Wm9vbU1lc3NhZ2UiLCBmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgdmFyIHpvb21XYXJuaW5nTXNnID0gKDAsIF9tYXBfbWVzc2FnZXMuY3JlYXRlWm9vbVdhcm5pbmdNc2cpKF90aGlzMy5nZXRab29tTGV2ZWwsIF90aGlzMy5nZXRNYXhab29tTGV2ZWwpOwoKICAgICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCd6b29tZW5kJywgem9vbVdhcm5pbmdNc2cpOwoKICAgICAgX3RoaXMzLl9jb250YWluZXJOb2RlLnNldEF0dHJpYnV0ZSgnZGF0YS10ZXN0LXN1YmonLCAnem9vbVdhcm5pbmdFbmFibGVkJyk7CgogICAgICBsYXllci5vbigncmVtb3ZlJywgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMy5fbGVhZmxldE1hcC5vZmYoJ3pvb21lbmQnLCB6b29tV2FybmluZ01zZyk7CgogICAgICAgIF90aGlzMy5fY29udGFpbmVyTm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtdGVzdC1zdWJqJyk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMzLl9jb250YWluZXJOb2RlID0gY29udGFpbmVyTm9kZTsKICAgIF90aGlzMy5fbGVhZmxldEJhc2VMYXllciA9IG51bGw7CiAgICBfdGhpczMuX2Jhc2VMYXllclNldHRpbmdzID0gbnVsbDsKICAgIF90aGlzMy5fYmFzZUxheWVySXNEZXNhdHVyYXRlZCA9IHRydWU7CiAgICBfdGhpczMuX2xlYWZsZXREcmF3Q29udHJvbCA9IG51bGw7CiAgICBfdGhpczMuX2xlYWZsZXRGaXRDb250cm9sID0gbnVsbDsKICAgIF90aGlzMy5fbGVhZmxldExlZ2VuZENvbnRyb2wgPSBudWxsOwogICAgX3RoaXMzLl9sZWdlbmRQb3NpdGlvbiA9ICd0b3ByaWdodCc7CiAgICBfdGhpczMuX2xheWVycyA9IFtdOwogICAgX3RoaXMzLl9saXN0ZW5lcnMgPSBbXTsKICAgIF90aGlzMy5fc2hvd1Rvb2x0aXAgPSBmYWxzZTsKICAgIHZhciBsZWFmbGV0T3B0aW9ucyA9IHsKICAgICAgbWluWm9vbTogb3B0aW9ucy5taW5ab29tLAogICAgICBtYXhab29tOiBvcHRpb25zLm1heFpvb20sCiAgICAgIGNlbnRlcjogb3B0aW9ucy5jZW50ZXIgPyBvcHRpb25zLmNlbnRlciA6IFswLCAwXSwKICAgICAgem9vbTogb3B0aW9ucy56b29tID8gb3B0aW9ucy56b29tIDogMiwKICAgICAgcmVuZGVyZXI6IF9sZWFmbGV0LmRlZmF1bHQuY2FudmFzKCksCiAgICAgIHpvb21BbmltYXRpb246IGZhbHNlLAogICAgICAvLyBEZXNhdHVyYXRlIG1hcCB0aWxlcyBjYXVzZXMgYW5pbWF0aW9uIHJlbmRlcmluZyBhcnRpZmFjdHMKICAgICAgem9vbUNvbnRyb2w6IG9wdGlvbnMuem9vbUNvbnRyb2wgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBvcHRpb25zLnpvb21Db250cm9sCiAgICB9OwogICAgX3RoaXMzLl9sZWFmbGV0TWFwID0gX2xlYWZsZXQuZGVmYXVsdC5tYXAoY29udGFpbmVyTm9kZSwgbGVhZmxldE9wdGlvbnMpOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5hdHRyaWJ1dGlvbkNvbnRyb2wuc2V0UHJlZml4KCcnKTsKCiAgICBpZiAoIW9wdGlvbnMuc2Nyb2xsV2hlZWxab29tKSB7CiAgICAgIF90aGlzMy5fbGVhZmxldE1hcC5zY3JvbGxXaGVlbFpvb20uZGlzYWJsZSgpOwogICAgfQoKICAgIHZhciBwcmV2aW91c1pvb20gPSBfdGhpczMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHByZXZpb3VzWm9vbSAhPT0gX3RoaXMzLl9sZWFmbGV0TWFwLmdldFpvb20oKSkgewogICAgICAgIHByZXZpb3VzWm9vbSA9IF90aGlzMy5fbGVhZmxldE1hcC5nZXRab29tKCk7CgogICAgICAgIF90aGlzMy5lbWl0KCd6b29tY2hhbmdlJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignem9vbWVuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5lbWl0KCd6b29tZW5kJyk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ2RyYWdlbmQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpczMuZW1pdCgnZHJhZ2VuZCcpOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCd6b29tZW5kJywgZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gX3RoaXMzLl91cGRhdGVFeHRlbnQoKTsKICAgIH0pOwoKICAgIF90aGlzMy5fbGVhZmxldE1hcC5vbignZHJhZ2VuZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fdXBkYXRlRXh0ZW50KCk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ21vdXNlbW92ZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5tb3ZlUG9pbnRlcignbW91c2Vtb3ZlJywgZSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5tb3ZlUG9pbnRlcignbW91c2VvdXQnLCBlKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfdGhpczMuX2xlYWZsZXRNYXAub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiBfdGhpczMuX2xheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBsYXllci5tb3ZlUG9pbnRlcignbW91c2Vkb3duJywgZSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIF90aGlzMy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLm1vdmVQb2ludGVyKCdtb3VzZXVwJywgZSk7CiAgICAgIH0pOwogICAgfSk7CgogICAgX3RoaXMzLl9sZWFmbGV0TWFwLm9uKCdkcmF3OmNyZWF0ZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdmFyIGRyYXdUeXBlID0gZXZlbnQubGF5ZXJUeXBlOwoKICAgICAgaWYgKGRyYXdUeXBlID09PSAncmVjdGFuZ2xlJykgewogICAgICAgIHZhciBib3VuZHMgPSBldmVudC5sYXllci5nZXRCb3VuZHMoKTsKICAgICAgICB2YXIgc291dGhFYXN0ID0gYm91bmRzLmdldFNvdXRoRWFzdCgpOwogICAgICAgIHZhciBub3J0aFdlc3QgPSBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7CiAgICAgICAgdmFyIHNvdXRoRWFzdExuZyA9IHNvdXRoRWFzdC5sbmc7CgogICAgICAgIGlmIChzb3V0aEVhc3RMbmcgPiAxODApIHsKICAgICAgICAgIHNvdXRoRWFzdExuZyAtPSAzNjA7CiAgICAgICAgfQoKICAgICAgICB2YXIgbm9ydGhXZXN0TG5nID0gbm9ydGhXZXN0LmxuZzsKCiAgICAgICAgaWYgKG5vcnRoV2VzdExuZyA8IC0xODApIHsKICAgICAgICAgIG5vcnRoV2VzdExuZyArPSAzNjA7CiAgICAgICAgfQoKICAgICAgICB2YXIgc291dGhFYXN0TGF0ID0gc291dGhFYXN0LmxhdDsKICAgICAgICB2YXIgbm9ydGhXZXN0TGF0ID0gbm9ydGhXZXN0LmxhdDsgLy9Cb3VuZHMgY2Fubm90IGJlIGNyZWF0ZWQgdW5sZXNzIHRoZXkgZm9ybSBhIGJveCB3aXRoIGxhcmdlciB0aGFuIDAgZGltZW5zaW9ucwogICAgICAgIC8vSW52YWxpZCBhcmVhcyBhcmUgcmVqZWN0ZWQgYnkgRVMuCgogICAgICAgIGlmIChzb3V0aEVhc3RMYXQgPT09IG5vcnRoV2VzdExhdCB8fCBzb3V0aEVhc3RMbmcgPT09IG5vcnRoV2VzdExuZykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMzLmVtaXQoJ2RyYXdDcmVhdGVkOnJlY3RhbmdsZScsIHsKICAgICAgICAgIGJvdW5kczogewogICAgICAgICAgICBib3R0b21fcmlnaHQ6IHsKICAgICAgICAgICAgICBsYXQ6IHNvdXRoRWFzdExhdCwKICAgICAgICAgICAgICBsb246IHNvdXRoRWFzdExuZwogICAgICAgICAgICB9LAogICAgICAgICAgICB0b3BfbGVmdDogewogICAgICAgICAgICAgIGxhdDogbm9ydGhXZXN0TGF0LAogICAgICAgICAgICAgIGxvbjogbm9ydGhXZXN0TG5nCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChkcmF3VHlwZSA9PT0gJ3BvbHlnb24nKSB7CiAgICAgICAgdmFyIGxhdExvbmdzID0gZXZlbnQubGF5ZXIuZ2V0TGF0TG5ncygpWzBdOwoKICAgICAgICBfdGhpczMuZW1pdCgnZHJhd0NyZWF0ZWQ6cG9seWdvbicsIHsKICAgICAgICAgIHBvaW50czogbGF0TG9uZ3MubWFwKGZ1bmN0aW9uIChsZWFmbGV0TGF0TG5nKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbGF0OiBsZWFmbGV0TGF0TG5nLmxhdCwKICAgICAgICAgICAgICBsb246IGxlYWZsZXRMYXRMbmcubG5nCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfdGhpczMucmVzaXplKCk7CgogICAgcmV0dXJuIF90aGlzMzsKICB9CgogIF9jcmVhdGVDbGFzcyhLaWJhbmFNYXAsIFt7CiAgICBrZXk6ICJzZXRTaG93VG9vbHRpcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0U2hvd1Rvb2x0aXAoc2hvd1Rvb2x0aXApIHsKICAgICAgdGhpcy5fc2hvd1Rvb2x0aXAgPSBzaG93VG9vbHRpcDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMYXllcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExheWVycygpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xheWVycy5zbGljZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZExheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMYXllcihraWJhbmFMYXllcikgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHZhciBvbnNob3dUb29sdGlwID0gZnVuY3Rpb24gb25zaG93VG9vbHRpcChldmVudCkgewogICAgICAgIGlmICghX3RoaXM0Ll9zaG93VG9vbHRpcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFfdGhpczQuX3BvcHVwKSB7CiAgICAgICAgICBfdGhpczQuX3BvcHVwID0gX2xlYWZsZXQuZGVmYXVsdC5yZXNwb25zaXZlUG9wdXAoewogICAgICAgICAgICBhdXRvUGFuOiBmYWxzZQogICAgICAgICAgfSk7CgogICAgICAgICAgX3RoaXM0Ll9wb3B1cC5zZXRMYXRMbmcoZXZlbnQucG9zaXRpb24pOwoKICAgICAgICAgIF90aGlzNC5fcG9wdXAuc2V0Q29udGVudChldmVudC5jb250ZW50KTsKCiAgICAgICAgICBfdGhpczQuX3BvcHVwLm9wZW5PbihfdGhpczQuX2xlYWZsZXRNYXApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIV90aGlzNC5fcG9wdXAuZ2V0TGF0TG5nKCkuZXF1YWxzKGV2ZW50LnBvc2l0aW9uKSkgewogICAgICAgICAgICBfdGhpczQuX3BvcHVwLnNldExhdExuZyhldmVudC5wb3NpdGlvbik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKF90aGlzNC5fcG9wdXAuZ2V0Q29udGVudCgpICE9PSBldmVudC5jb250ZW50KSB7CiAgICAgICAgICAgIF90aGlzNC5fcG9wdXAuc2V0Q29udGVudChldmVudC5jb250ZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICBraWJhbmFMYXllci5vbignc2hvd1Rvb2x0aXAnLCBvbnNob3dUb29sdGlwKTsKCiAgICAgIHRoaXMuX2xpc3RlbmVycy5wdXNoKHsKICAgICAgICBuYW1lOiAnc2hvd1Rvb2x0aXAnLAogICAgICAgIGhhbmRsZTogb25zaG93VG9vbHRpcCwKICAgICAgICBsYXllcjoga2liYW5hTGF5ZXIKICAgICAgfSk7CgogICAgICB2YXIgb25IaWRlVG9vbHRpcCA9IGZ1bmN0aW9uIG9uSGlkZVRvb2x0aXAoKSB7CiAgICAgICAgX3RoaXM0Ll9sZWFmbGV0TWFwLmNsb3NlUG9wdXAoKTsKCiAgICAgICAgX3RoaXM0Ll9wb3B1cCA9IG51bGw7CiAgICAgIH07CgogICAgICBraWJhbmFMYXllci5vbignaGlkZVRvb2x0aXAnLCBvbkhpZGVUb29sdGlwKTsKCiAgICAgIHRoaXMuX2xpc3RlbmVycy5wdXNoKHsKICAgICAgICBuYW1lOiAnaGlkZVRvb2x0aXAnLAogICAgICAgIGhhbmRsZTogb25IaWRlVG9vbHRpcCwKICAgICAgICBsYXllcjoga2liYW5hTGF5ZXIKICAgICAgfSk7CgogICAgICB2YXIgb25TdHlsZUNoYW5nZWQgPSBmdW5jdGlvbiBvblN0eWxlQ2hhbmdlZCgpIHsKICAgICAgICBpZiAoX3RoaXM0Ll9sZWFmbGV0TGVnZW5kQ29udHJvbCkgewogICAgICAgICAgX3RoaXM0Ll9sZWFmbGV0TGVnZW5kQ29udHJvbC51cGRhdGVDb250ZW50cygpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGtpYmFuYUxheWVyLm9uKCdzdHlsZUNoYW5nZWQnLCBvblN0eWxlQ2hhbmdlZCk7CgogICAgICB0aGlzLl9saXN0ZW5lcnMucHVzaCh7CiAgICAgICAgbmFtZTogJ3N0eWxlQ2hhbmdlZCcsCiAgICAgICAgaGFuZGxlOiBvblN0eWxlQ2hhbmdlZCwKICAgICAgICBsYXllcjoga2liYW5hTGF5ZXIKICAgICAgfSk7CgogICAgICB0aGlzLl9sYXllcnMucHVzaChraWJhbmFMYXllcik7CgogICAgICBraWJhbmFMYXllci5hZGRUb0xlYWZsZXRNYXAodGhpcy5fbGVhZmxldE1hcCk7CiAgICAgIHRoaXMuZW1pdCgnbGF5ZXJzOnVwZGF0ZScpOwoKICAgICAgdGhpcy5fYWRkQXR0cmlidXRpb25zKGtpYmFuYUxheWVyLmdldEF0dHJpYnV0aW9ucygpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTGF5ZXIoa2liYW5hTGF5ZXIpIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICBpZiAoIWtpYmFuYUxheWVyKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9yZW1vdmVBdHRyaWJ1dGlvbnMoa2liYW5hTGF5ZXIuZ2V0QXR0cmlidXRpb25zKCkpOwoKICAgICAgdmFyIGluZGV4ID0gdGhpcy5fbGF5ZXJzLmluZGV4T2Yoa2liYW5hTGF5ZXIpOwoKICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICB0aGlzLl9sYXllcnMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAga2liYW5hTGF5ZXIucmVtb3ZlRnJvbUxlYWZsZXRNYXAodGhpcy5fbGVhZmxldE1hcCk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2xpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIGlmIChsaXN0ZW5lci5sYXllciA9PT0ga2liYW5hTGF5ZXIpIHsKICAgICAgICAgIGxpc3RlbmVyLmxheWVyLnJlbW92ZUxpc3RlbmVyKGxpc3RlbmVyLm5hbWUsIGxpc3RlbmVyLmhhbmRsZSk7CiAgICAgICAgfQogICAgICB9KTsgLy9tdXN0IHJlYWRkIGFsbCBhdHRyaWJ1dGlvbnMsIGJlY2F1c2Ugd2UgbWlnaHQgaGF2ZSByZW1vdmVkIGR1cGVzCgoKICAgICAgdGhpcy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNS5fYWRkQXR0cmlidXRpb25zKGxheWVyLmdldEF0dHJpYnV0aW9ucygpKTsKICAgICAgfSk7CgogICAgICBpZiAodGhpcy5fYmFzZUxheWVyU2V0dGluZ3MpIHsKICAgICAgICB0aGlzLl9hZGRBdHRyaWJ1dGlvbnModGhpcy5fYmFzZUxheWVyU2V0dGluZ3Mub3B0aW9ucy5hdHRyaWJ1dGlvbik7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJfYWRkQXR0cmlidXRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfYWRkQXR0cmlidXRpb25zKGF0dHJpYnV0aW9uKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgdmFyIGF0dHJpYnV0aW9ucyA9IGdldEF0dHJpYnV0aW9uQXJyYXkoYXR0cmlidXRpb24pOwogICAgICBhdHRyaWJ1dGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoYXR0cmlidXRpb24pIHsKICAgICAgICBfdGhpczYuX2xlYWZsZXRNYXAuYXR0cmlidXRpb25Db250cm9sLnJlbW92ZUF0dHJpYnV0aW9uKGF0dHJpYnV0aW9uKTsgLy90aGlzIGVuc3VyZXMgd2UgZG8gbm90IGFkZCBkdXBsaWNhdGVzCgoKICAgICAgICBfdGhpczYuX2xlYWZsZXRNYXAuYXR0cmlidXRpb25Db250cm9sLmFkZEF0dHJpYnV0aW9uKGF0dHJpYnV0aW9uKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3JlbW92ZUF0dHJpYnV0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3JlbW92ZUF0dHJpYnV0aW9ucyhhdHRyaWJ1dGlvbikgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHZhciBhdHRyaWJ1dGlvbnMgPSBnZXRBdHRyaWJ1dGlvbkFycmF5KGF0dHJpYnV0aW9uKTsKICAgICAgYXR0cmlidXRpb25zLmZvckVhY2goZnVuY3Rpb24gKGF0dHJpYnV0aW9uKSB7CiAgICAgICAgX3RoaXM3Ll9sZWFmbGV0TWFwLmF0dHJpYnV0aW9uQ29udHJvbC5yZW1vdmVBdHRyaWJ1dGlvbihhdHRyaWJ1dGlvbik7IC8vdGhpcyBlbnN1cmVzIHdlIGRvIG5vdCBhZGQgZHVwbGljYXRlcwoKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRGaXRDb250cm9sKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVDb250cm9sKHRoaXMuX2xlYWZsZXRGaXRDb250cm9sKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2xlYWZsZXREcmF3Q29udHJvbCkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlQ29udHJvbCh0aGlzLl9sZWFmbGV0RHJhd0NvbnRyb2wpOwogICAgICB9CgogICAgICBpZiAodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpIHsKICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnJlbW92ZUNvbnRyb2wodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpOwogICAgICB9CgogICAgICB0aGlzLnNldEJhc2VMYXllcihudWxsKTsKICAgICAgdmFyIGxheWVyOwoKICAgICAgd2hpbGUgKHRoaXMuX2xheWVycy5sZW5ndGgpIHsKICAgICAgICBsYXllciA9IHRoaXMuX2xheWVycy5wb3AoKTsKICAgICAgICBsYXllci5yZW1vdmVGcm9tTGVhZmxldE1hcCh0aGlzLl9sZWFmbGV0TWFwKTsKICAgICAgfQoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmUoKTsKCiAgICAgIHRoaXMuX2NvbnRhaW5lck5vZGUuaW5uZXJIVE1MID0gJyc7CgogICAgICB0aGlzLl9saXN0ZW5lcnMuZm9yRWFjaChmdW5jdGlvbiAobGlzdGVuZXIpIHsKICAgICAgICByZXR1cm4gbGlzdGVuZXIubGF5ZXIucmVtb3ZlTGlzdGVuZXIobGlzdGVuZXIubmFtZSwgbGlzdGVuZXIuaGFuZGxlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Q2VudGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDZW50ZXIoKSB7CiAgICAgIHZhciBjZW50ZXIgPSB0aGlzLl9sZWFmbGV0TWFwLmdldENlbnRlcigpOwoKICAgICAgcmV0dXJuIHsKICAgICAgICBsb246IGNlbnRlci5sbmcsCiAgICAgICAgbGF0OiBjZW50ZXIubGF0CiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0Q2VudGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDZW50ZXIobGF0aXR1ZGUsIGxvbmdpdHVkZSkgewogICAgICB2YXIgbGF0TG9uZyA9IF9sZWFmbGV0LmRlZmF1bHQubGF0TG5nKGxhdGl0dWRlLCBsb25naXR1ZGUpOwoKICAgICAgaWYgKGxhdExvbmcuZXF1YWxzICYmICFsYXRMb25nLmVxdWFscyh0aGlzLl9sZWFmbGV0TWFwLmdldENlbnRlcigpKSkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0VmlldyhsYXRMb25nKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNldFpvb21MZXZlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Wm9vbUxldmVsKHpvb21MZXZlbCkgewogICAgICBpZiAodGhpcy5fbGVhZmxldE1hcC5nZXRab29tKCkgIT09IHpvb21MZXZlbCkgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuc2V0Wm9vbSh6b29tTGV2ZWwpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0R2VvaGFzaFByZWNpc2lvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0R2VvaGFzaFByZWNpc2lvbigpIHsKICAgICAgcmV0dXJuICgwLCBfem9vbV90b19wcmVjaXNpb24uem9vbVRvUHJlY2lzaW9uKSh0aGlzLl9sZWFmbGV0TWFwLmdldFpvb20oKSwgMTIsIHRoaXMuX2xlYWZsZXRNYXAuZ2V0TWF4Wm9vbSgpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMZWFmbGV0Qm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMZWFmbGV0Qm91bmRzKCkgewogICAgICByZXR1cm4gdGhpcy5fbGVhZmxldE1hcC5nZXRCb3VuZHMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNZXRlcnNQZXJQaXhlbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWV0ZXJzUGVyUGl4ZWwoKSB7CiAgICAgIHZhciBwb2ludEMgPSB0aGlzLl9sZWFmbGV0TWFwLmxhdExuZ1RvQ29udGFpbmVyUG9pbnQodGhpcy5fbGVhZmxldE1hcC5nZXRDZW50ZXIoKSk7IC8vIGNlbnRlciAocGl4ZWxzKQoKCiAgICAgIHZhciBwb2ludFggPSBbcG9pbnRDLnggKyAxLCBwb2ludEMueV07IC8vIGFkZCBvbmUgcGl4ZWwgdG8geAoKICAgICAgdmFyIHBvaW50WSA9IFtwb2ludEMueCwgcG9pbnRDLnkgKyAxXTsgLy8gYWRkIG9uZSBwaXhlbCB0byB5CgogICAgICB2YXIgbGF0TG5nQyA9IHRoaXMuX2xlYWZsZXRNYXAuY29udGFpbmVyUG9pbnRUb0xhdExuZyhwb2ludEMpOwoKICAgICAgdmFyIGxhdExuZ1ggPSB0aGlzLl9sZWFmbGV0TWFwLmNvbnRhaW5lclBvaW50VG9MYXRMbmcocG9pbnRYKTsKCiAgICAgIHZhciBsYXRMbmdZID0gdGhpcy5fbGVhZmxldE1hcC5jb250YWluZXJQb2ludFRvTGF0TG5nKHBvaW50WSk7CgogICAgICB2YXIgZGlzdGFuY2VYID0gbGF0TG5nQy5kaXN0YW5jZVRvKGxhdExuZ1gpOyAvLyBjYWxjdWxhdGUgZGlzdGFuY2UgYmV0d2VlbiBjIGFuZCB4IChsYXRpdHVkZSkKCiAgICAgIHZhciBkaXN0YW5jZVkgPSBsYXRMbmdDLmRpc3RhbmNlVG8obGF0TG5nWSk7IC8vIGNhbGN1bGF0ZSBkaXN0YW5jZSBiZXR3ZWVuIGMgYW5kIHkgKGxvbmdpdHVkZSkKCiAgICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQubWluKFtkaXN0YW5jZVgsIGRpc3RhbmNlWV0pOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRMZWFmbGV0Qm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0TGVhZmxldEJvdW5kcyhyZXNpemVPbkZhaWwpIHsKICAgICAgdmFyIGJvdW5kc1JhdyA9IHRoaXMuX2xlYWZsZXRNYXAuZ2V0Qm91bmRzKCk7CgogICAgICB2YXIgYm91bmRzID0gdGhpcy5fbGVhZmxldE1hcC53cmFwTGF0TG5nQm91bmRzKGJvdW5kc1Jhdyk7CgogICAgICBpZiAoIWJvdW5kcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgc291dGhFYXN0ID0gYm91bmRzLmdldFNvdXRoRWFzdCgpOwogICAgICB2YXIgbm9ydGhXZXN0ID0gYm91bmRzLmdldE5vcnRoV2VzdCgpOwoKICAgICAgaWYgKHNvdXRoRWFzdC5sbmcgPT09IG5vcnRoV2VzdC5sbmcgfHwgc291dGhFYXN0LmxhdCA9PT0gbm9ydGhXZXN0LmxhdCkgewogICAgICAgIGlmIChyZXNpemVPbkZhaWwpIHsKICAgICAgICAgIHRoaXMuX2xlYWZsZXRNYXAuaW52YWxpZGF0ZVNpemUoKTsKCiAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0TGVhZmxldEJvdW5kcyhmYWxzZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYm91bmRzOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Qm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCb3VuZHMoKSB7CiAgICAgIHZhciBib3VuZHMgPSB0aGlzLl9nZXRMZWFmbGV0Qm91bmRzKHRydWUpOwoKICAgICAgaWYgKCFib3VuZHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIHNvdXRoRWFzdCA9IGJvdW5kcy5nZXRTb3V0aEVhc3QoKTsKICAgICAgdmFyIG5vcnRoV2VzdCA9IGJvdW5kcy5nZXROb3J0aFdlc3QoKTsKICAgICAgdmFyIHNvdXRoRWFzdExuZyA9IHNvdXRoRWFzdC5sbmc7CiAgICAgIHZhciBub3J0aFdlc3RMbmcgPSBub3J0aFdlc3QubG5nOwogICAgICB2YXIgc291dGhFYXN0TGF0ID0gc291dGhFYXN0LmxhdDsKICAgICAgdmFyIG5vcnRoV2VzdExhdCA9IG5vcnRoV2VzdC5sYXQ7IC8vIFdoZW4gbWFwIGhhcyBub3Qgd2lkdGggb3IgaGVpZ2h0LCB0aGUgbWFwIGhhcyBubyBkaW1lbnNpb25zLgogICAgICAvLyBUaGVzZSBkaW1lbnNpb25zIGFyZSBlbmZvcmNlZCBkdWUgdG8gQ1NTIHN0eWxlIHJ1bGVzIHRoYXQgZW5mb3JjZSBtaW4td2lkdGgvaGVpZ2h0IG9mIDAKICAgICAgLy8gdGhhdCBlbmZvcmNlbWVudCBhbHNvIHJlc29sdmVzIGVycm9ycyB3aXRoIHRoZSBoZWF0bWFwIGxheWVyIHBsdWdpbi4KCiAgICAgIHJldHVybiB7CiAgICAgICAgYm90dG9tX3JpZ2h0OiB7CiAgICAgICAgICBsYXQ6IHNvdXRoRWFzdExhdCwKICAgICAgICAgIGxvbjogc291dGhFYXN0TG5nCiAgICAgICAgfSwKICAgICAgICB0b3BfbGVmdDogewogICAgICAgICAgbGF0OiBub3J0aFdlc3RMYXQsCiAgICAgICAgICBsb246IG5vcnRoV2VzdExuZwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXREZXNhdHVyYXRlQmFzZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXREZXNhdHVyYXRlQmFzZUxheWVyKGlzRGVzYXR1cmF0ZWQpIHsKICAgICAgaWYgKGlzRGVzYXR1cmF0ZWQgPT09IHRoaXMuX2Jhc2VMYXllcklzRGVzYXR1cmF0ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX2Jhc2VMYXllcklzRGVzYXR1cmF0ZWQgPSBpc0Rlc2F0dXJhdGVkOwoKICAgICAgdGhpcy5fdXBkYXRlRGVzYXR1cmF0aW9uKCk7CgogICAgICBpZiAodGhpcy5fbGVhZmxldEJhc2VMYXllcikgewogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIucmVkcmF3KCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGREcmF3Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkRHJhd0NvbnRyb2woKSB7CiAgICAgIHZhciBkcmF3Q29sb3IgPSAnIzAwMCc7CiAgICAgIHZhciBkcmF3T3B0aW9ucyA9IHsKICAgICAgICBkcmF3OiB7CiAgICAgICAgICBwb2x5bGluZTogZmFsc2UsCiAgICAgICAgICBtYXJrZXI6IGZhbHNlLAogICAgICAgICAgY2lyY2xlOiBmYWxzZSwKICAgICAgICAgIHJlY3RhbmdsZTogewogICAgICAgICAgICBzaGFwZU9wdGlvbnM6IHsKICAgICAgICAgICAgICBzdHJva2U6IGZhbHNlLAogICAgICAgICAgICAgIGNvbG9yOiBkcmF3Q29sb3IKICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHBvbHlnb246IHsKICAgICAgICAgICAgc2hhcGVPcHRpb25zOiB7CiAgICAgICAgICAgICAgY29sb3I6IGRyYXdDb2xvcgogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgY2lyY2xlbWFya2VyOiBmYWxzZQogICAgICAgIH0KICAgICAgfTsKICAgICAgdGhpcy5fbGVhZmxldERyYXdDb250cm9sID0gbmV3IF9sZWFmbGV0LmRlZmF1bHQuQ29udHJvbC5EcmF3KGRyYXdPcHRpb25zKTsKCiAgICAgIHRoaXMuX2xlYWZsZXRNYXAuYWRkQ29udHJvbCh0aGlzLl9sZWFmbGV0RHJhd0NvbnRyb2wpOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZEZpdENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEZpdENvbnRyb2woKSB7CiAgICAgIGlmICh0aGlzLl9sZWFmbGV0Rml0Q29udHJvbCB8fCAhdGhpcy5fbGVhZmxldE1hcCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGZpdENvbnRhaW5lciA9IF9sZWFmbGV0LmRlZmF1bHQuRG9tVXRpbC5jcmVhdGUoJ2RpdicsICdsZWFmbGV0LWNvbnRyb2wgbGVhZmxldC1iYXIgbGVhZmxldC1jb250cm9sLWZpdCcpOwoKICAgICAgdGhpcy5fbGVhZmxldEZpdENvbnRyb2wgPSBtYWtlRml0Q29udHJvbChmaXRDb250YWluZXIsIHRoaXMpOwoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5hZGRDb250cm9sKHRoaXMuX2xlYWZsZXRGaXRDb250cm9sKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJhZGRMZWdlbmRDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMZWdlbmRDb250cm9sKCkgewogICAgICBpZiAodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wgfHwgIXRoaXMuX2xlYWZsZXRNYXApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX3VwZGF0ZUxlZ2VuZCgpOwogICAgfQogIH0sIHsKICAgIGtleTogInNldExlZ2VuZFBvc2l0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMZWdlbmRQb3NpdGlvbihwb3NpdGlvbikgewogICAgICBpZiAodGhpcy5fbGVnZW5kUG9zaXRpb24gPT09IHBvc2l0aW9uKSB7CiAgICAgICAgaWYgKCF0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCkgewogICAgICAgICAgdGhpcy5fdXBkYXRlTGVnZW5kKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuX2xlZ2VuZFBvc2l0aW9uID0gcG9zaXRpb247CgogICAgICAgIHRoaXMuX3VwZGF0ZUxlZ2VuZCgpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX3VwZGF0ZUxlZ2VuZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZUxlZ2VuZCgpIHsKICAgICAgaWYgKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKSB7CiAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5yZW1vdmVDb250cm9sKHRoaXMuX2xlYWZsZXRMZWdlbmRDb250cm9sKTsKICAgICAgfQoKICAgICAgdmFyICR3cmFwcGVyID0gKDAsIF9qcXVlcnkuZGVmYXVsdCkoJzxkaXY+JykuYWRkQ2xhc3MoJ3Zpc01hcExlZ2VuZF9fd3JhcHBlcicpOwogICAgICB0aGlzLl9sZWFmbGV0TGVnZW5kQ29udHJvbCA9IG1ha2VMZWdlbmRDb250cm9sKCR3cmFwcGVyLCB0aGlzLCB0aGlzLl9sZWdlbmRQb3NpdGlvbik7CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLmFkZENvbnRyb2wodGhpcy5fbGVhZmxldExlZ2VuZENvbnRyb2wpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlc2l6ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzaXplKCkgewogICAgICB0aGlzLl9sZWFmbGV0TWFwLmludmFsaWRhdGVTaXplKCk7CgogICAgICB0aGlzLl91cGRhdGVFeHRlbnQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRNaW5ab29tIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRNaW5ab29tKHpvb20pIHsKICAgICAgdGhpcy5fbGVhZmxldE1hcC5zZXRNaW5ab29tKHpvb20pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldE1heFpvb20iLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldE1heFpvb20oem9vbSkgewogICAgICB0aGlzLl9sZWFmbGV0TWFwLnNldE1heFpvb20oem9vbSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGVhZmxldEJhc2VMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGVhZmxldEJhc2VMYXllcigpIHsKICAgICAgcmV0dXJuIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0QmFzZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRCYXNlTGF5ZXIoc2V0dGluZ3MpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwoc2V0dGluZ3MsIHRoaXMuX2Jhc2VMYXllclNldHRpbmdzKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNldHRpbmdzID09PSBudWxsKSB7CiAgICAgICAgaWYgKHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIgJiYgdGhpcy5fbGVhZmxldE1hcCkgewogICAgICAgICAgdGhpcy5fcmVtb3ZlQXR0cmlidXRpb25zKHRoaXMuX2Jhc2VMYXllclNldHRpbmdzLm9wdGlvbnMuYXR0cmlidXRpb24pOwoKICAgICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlTGF5ZXIodGhpcy5fbGVhZmxldEJhc2VMYXllcik7CgogICAgICAgICAgdGhpcy5fbGVhZmxldEJhc2VMYXllciA9IG51bGw7CiAgICAgICAgICB0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncyA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuX2Jhc2VMYXllclNldHRpbmdzID0gc2V0dGluZ3M7CgogICAgICBpZiAodGhpcy5fbGVhZmxldEJhc2VMYXllcikgewogICAgICAgIHRoaXMuX2xlYWZsZXRNYXAucmVtb3ZlTGF5ZXIodGhpcy5fbGVhZmxldEJhc2VMYXllcik7CgogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIgPSBudWxsOwogICAgICB9CgogICAgICB2YXIgYmFzZUxheWVyOwoKICAgICAgaWYgKHNldHRpbmdzLmJhc2VMYXllclR5cGUgPT09ICd3bXMnKSB7CiAgICAgICAgLy9UaGlzIGlzIHVzZXItaW5wdXQgdGhhdCBpcyByZW5kZXJlZCB3aXRoIHRoZSBMZWFmbGV0IGF0dHJpYnV0aW9uIGNvbnRyb2wuIE5lZWRzIHRvIGJlIHNhbml0aXplZC4KICAgICAgICB0aGlzLl9iYXNlTGF5ZXJTZXR0aW5ncy5vcHRpb25zLmF0dHJpYnV0aW9uID0gX2xvZGFzaC5kZWZhdWx0LmVzY2FwZShzZXR0aW5ncy5vcHRpb25zLmF0dHJpYnV0aW9uKTsKICAgICAgICBiYXNlTGF5ZXIgPSB0aGlzLl9nZXRXTVNCYXNlTGF5ZXIoc2V0dGluZ3Mub3B0aW9ucyk7CiAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MuYmFzZUxheWVyVHlwZSA9PT0gJ3RtcycpIHsKICAgICAgICBiYXNlTGF5ZXIgPSB0aGlzLl9nZXRUTVNCYXNlTGF5ZXIoc2V0dGluZ3Mub3B0aW9ucyk7CiAgICAgIH0KCiAgICAgIGlmIChiYXNlTGF5ZXIpIHsKICAgICAgICBiYXNlTGF5ZXIub24oJ3RpbGVsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIF90aGlzOC5fdXBkYXRlRGVzYXR1cmF0aW9uKCk7CiAgICAgICAgfSk7CiAgICAgICAgYmFzZUxheWVyLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXM4LmVtaXQoJ2Jhc2VMYXllcjpsb2FkZWQnKTsKICAgICAgICB9KTsKICAgICAgICBiYXNlTGF5ZXIub24oJ2xvYWRpbmcnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpczguZW1pdCgnYmFzZUxheWVyOmxvYWRpbmcnKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLl9sZWFmbGV0QmFzZUxheWVyID0gYmFzZUxheWVyOwoKICAgICAgICBpZiAoc2V0dGluZ3Mub3B0aW9ucy5zaG93Wm9vbU1lc3NhZ2UpIHsKICAgICAgICAgIGJhc2VMYXllci5vbignYWRkJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczguX2FkZE1heFpvb21NZXNzYWdlKGJhc2VMYXllcik7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIuYWRkVG8odGhpcy5fbGVhZmxldE1hcCk7CgogICAgICAgIHRoaXMuX2xlYWZsZXRCYXNlTGF5ZXIuYnJpbmdUb0JhY2soKTsKCiAgICAgICAgaWYgKHNldHRpbmdzLm9wdGlvbnMubWluWm9vbSA+IHRoaXMuX2xlYWZsZXRNYXAuZ2V0Wm9vbSgpKSB7CiAgICAgICAgICB0aGlzLl9sZWFmbGV0TWFwLnNldFpvb20oc2V0dGluZ3Mub3B0aW9ucy5taW5ab29tKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuX2FkZEF0dHJpYnV0aW9ucyhzZXR0aW5ncy5vcHRpb25zLmF0dHJpYnV0aW9uKTsKCiAgICAgICAgdGhpcy5yZXNpemUoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImlzSW5zaWRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0luc2lkZShidWNrZXRSZWN0Qm91bmRzKSB7CiAgICAgIHZhciBtYXBCb3VuZHMgPSB0aGlzLl9sZWFmbGV0TWFwLmdldEJvdW5kcygpOwoKICAgICAgcmV0dXJuIG1hcEJvdW5kcy5pbnRlcnNlY3RzKGJ1Y2tldFJlY3RCb3VuZHMpOwogICAgfQogIH0sIHsKICAgIGtleTogImZpdFRvRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2ZpdFRvRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBib3VuZHNBcnJheSwgYm91bmRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGVhZmxldE1hcCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHRoaXMuX2xheWVycy5tYXAoCiAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShsYXllcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyLmdldEJvdW5kcygpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dC5zZW50KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGJvdW5kc0FycmF5ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBib3VuZHMgPSBudWxsOwogICAgICAgICAgICAgICAgYm91bmRzQXJyYXkuZm9yRWFjaCgKICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgICAgICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoYikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYm91bmRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQoYik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMgPSBiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKF94MikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKTsKCiAgICAgICAgICAgICAgICBpZiAoYm91bmRzICYmIGJvdW5kcy5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fbGVhZmxldE1hcC5maXRCb3VuZHMoYm91bmRzKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZml0VG9EYXRhKCkgewogICAgICAgIHJldHVybiBfZml0VG9EYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmaXRUb0RhdGE7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfZ2V0VE1TQmFzZUxheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0VE1TQmFzZUxheWVyKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF9sZWFmbGV0LmRlZmF1bHQudGlsZUxheWVyKG9wdGlvbnMudXJsLCB7CiAgICAgICAgbWluWm9vbTogb3B0aW9ucy5taW5ab29tLAogICAgICAgIG1heFpvb206IG9wdGlvbnMubWF4Wm9vbSwKICAgICAgICBzdWJkb21haW5zOiBvcHRpb25zLnN1YmRvbWFpbnMgfHwgW10KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldFdNU0Jhc2VMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2dldFdNU0Jhc2VMYXllcihvcHRpb25zKSB7CiAgICAgIHZhciB3bXNPcHRpb25zID0gewogICAgICAgIGZvcm1hdDogb3B0aW9ucy5mb3JtYXQgfHwgJycsCiAgICAgICAgbGF5ZXJzOiBvcHRpb25zLmxheWVycyB8fCAnJywKICAgICAgICBtaW5ab29tOiBvcHRpb25zLm1pblpvb20sCiAgICAgICAgbWF4Wm9vbTogb3B0aW9ucy5tYXhab29tLAogICAgICAgIHN0eWxlczogb3B0aW9ucy5zdHlsZXMgfHwgJycsCiAgICAgICAgdHJhbnNwYXJlbnQ6IG9wdGlvbnMudHJhbnNwYXJlbnQsCiAgICAgICAgdmVyc2lvbjogb3B0aW9ucy52ZXJzaW9uIHx8ICcxLjMuMCcKICAgICAgfTsKICAgICAgcmV0dXJuIHR5cGVvZiBvcHRpb25zLnVybCA9PT0gJ3N0cmluZycgJiYgb3B0aW9ucy51cmwubGVuZ3RoID8gX2xlYWZsZXQuZGVmYXVsdC50aWxlTGF5ZXIud21zKG9wdGlvbnMudXJsLCB3bXNPcHRpb25zKSA6IG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3VwZGF0ZUV4dGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3VwZGF0ZUV4dGVudCgpIHsKICAgICAgdGhpcy5fbGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGxheWVyKSB7CiAgICAgICAgcmV0dXJuIGxheWVyLnVwZGF0ZUV4dGVudCgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfdXBkYXRlRGVzYXR1cmF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfdXBkYXRlRGVzYXR1cmF0aW9uKCkgewogICAgICB2YXIgdGlsZXMgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgnaW1nLmxlYWZsZXQtdGlsZS1sb2FkZWQnKTsgLy8gRG9uJ3QgYXBwbHkgY2xpZW50LXNpZGUgc3R5bGluZyB0byBFTVMgYmFzZW1hcHMKCiAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuZ2V0KHRoaXMuX2Jhc2VMYXllclNldHRpbmdzLCAnb3B0aW9ucy5vcmlnaW4nKSA9PT0gX29yaWdpbi5PUklHSU4uRU1TKSB7CiAgICAgICAgdGlsZXMuYWRkQ2xhc3MoJ2ZpbHRlcnMtb2ZmJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHRoaXMuX2Jhc2VMYXllcklzRGVzYXR1cmF0ZWQpIHsKICAgICAgICAgIHRpbGVzLnJlbW92ZUNsYXNzKCdmaWx0ZXJzLW9mZicpOwogICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2Jhc2VMYXllcklzRGVzYXR1cmF0ZWQpIHsKICAgICAgICAgIHRpbGVzLmFkZENsYXNzKCdmaWx0ZXJzLW9mZicpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInBlcnNpc3RVaVN0YXRlRm9yVmlzdWFsaXphdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGVyc2lzdFVpU3RhdGVGb3JWaXN1YWxpemF0aW9uKHZpc3VhbGl6YXRpb24pIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICBmdW5jdGlvbiBwZXJzaXN0TWFwU3RhdGVJblVpU3RhdGUoKSB7CiAgICAgICAgdmFyIHVpU3RhdGUgPSB2aXN1YWxpemF0aW9uLmdldFVpU3RhdGUoKTsKICAgICAgICB2YXIgY2VudGVyRnJvbVVJU3RhdGUgPSB1aVN0YXRlLmdldCgnbWFwQ2VudGVyJyk7CiAgICAgICAgdmFyIHpvb21Gcm9tVWlTdGF0ZSA9IHBhcnNlSW50KHVpU3RhdGUuZ2V0KCdtYXBab29tJykpOwoKICAgICAgICBpZiAoaXNOYU4oem9vbUZyb21VaVN0YXRlKSB8fCB0aGlzLmdldFpvb21MZXZlbCgpICE9PSB6b29tRnJvbVVpU3RhdGUpIHsKICAgICAgICAgIHZpc3VhbGl6YXRpb24udWlTdGF0ZVZhbCgnbWFwWm9vbScsIHRoaXMuZ2V0Wm9vbUxldmVsKCkpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNlbnRlckZyb21NYXAgPSB0aGlzLmdldENlbnRlcigpOwoKICAgICAgICBpZiAoIWNlbnRlckZyb21VSVN0YXRlIHx8IGNlbnRlckZyb21NYXAubG9uICE9PSBjZW50ZXJGcm9tVUlTdGF0ZVsxXSB8fCBjZW50ZXJGcm9tTWFwLmxhdCAhPT0gY2VudGVyRnJvbVVJU3RhdGVbMF0pIHsKICAgICAgICAgIHZpc3VhbGl6YXRpb24udWlTdGF0ZVZhbCgnbWFwQ2VudGVyJywgW2NlbnRlckZyb21NYXAubGF0LCBjZW50ZXJGcm9tTWFwLmxvbl0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5fbGVhZmxldE1hcC5vbigncmVzaXplJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZpc3VhbGl6YXRpb24uc2Vzc2lvblN0YXRlLm1hcEJvdW5kcyA9IF90aGlzOS5nZXRCb3VuZHMoKTsKICAgICAgfSk7CgogICAgICB0aGlzLl9sZWFmbGV0TWFwLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkgewogICAgICAgIHZpc3VhbGl6YXRpb24uc2Vzc2lvblN0YXRlLm1hcEJvdW5kcyA9IF90aGlzOS5nZXRCb3VuZHMoKTsKICAgICAgfSk7CgogICAgICB0aGlzLm9uKCdkcmFnZW5kJywgcGVyc2lzdE1hcFN0YXRlSW5VaVN0YXRlKTsKICAgICAgdGhpcy5vbignem9vbWVuZCcsIHBlcnNpc3RNYXBTdGF0ZUluVWlTdGF0ZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAidXNlVWlTdGF0ZUZyb21WaXN1YWxpemF0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1c2VVaVN0YXRlRnJvbVZpc3VhbGl6YXRpb24odmlzdWFsaXphdGlvbikgewogICAgICB2YXIgdWlTdGF0ZSA9IHZpc3VhbGl6YXRpb24uZ2V0VWlTdGF0ZSgpOwogICAgICB2YXIgem9vbUZyb21VaVN0YXRlID0gcGFyc2VJbnQodWlTdGF0ZS5nZXQoJ21hcFpvb20nKSk7CiAgICAgIHZhciBjZW50ZXJGcm9tVUlTdGF0ZSA9IHVpU3RhdGUuZ2V0KCdtYXBDZW50ZXInKTsKCiAgICAgIGlmICghaXNOYU4oem9vbUZyb21VaVN0YXRlKSkgewogICAgICAgIHRoaXMuc2V0Wm9vbUxldmVsKHpvb21Gcm9tVWlTdGF0ZSk7CiAgICAgIH0KCiAgICAgIGlmIChjZW50ZXJGcm9tVUlTdGF0ZSkgewogICAgICAgIHRoaXMuc2V0Q2VudGVyKGNlbnRlckZyb21VSVN0YXRlWzBdLCBjZW50ZXJGcm9tVUlTdGF0ZVsxXSk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBLaWJhbmFNYXA7Cn0oX2V2ZW50cy5FdmVudEVtaXR0ZXIpOwoKZXhwb3J0cy5LaWJhbmFNYXAgPSBLaWJhbmFNYXA7CgpmdW5jdGlvbiBnZXRBdHRyaWJ1dGlvbkFycmF5KGF0dHJpYnV0aW9uKSB7CiAgdmFyIGF0dHJpYnV0aW9uU3RyaW5nID0gYXR0cmlidXRpb24gfHwgJyc7CiAgdmFyIGF0dHJpYnV0aW9ucyA9IGF0dHJpYnV0aW9uU3RyaW5nLnNwbGl0KC9ccypcfFxzKi8pOwoKICBpZiAoYXR0cmlidXRpb25zLmxlbmd0aCA9PT0gMSkgewogICAgLy90ZW1wIHdvcmstYXJvdW5kIGR1ZSB0byBpbmNvbnNpc3RlbmN5IGluIG1hbmlmZXN0cyBvZiBob3cgYXR0cmlidXRpb25zIGFyZSBkZWxpbWl0ZWQKICAgIGF0dHJpYnV0aW9ucyA9IGF0dHJpYnV0aW9uc1swXS5zcGxpdCgnLCcpOwogIH0KCiAgcmV0dXJuIGF0dHJpYnV0aW9uczsKfQ=="},null]}