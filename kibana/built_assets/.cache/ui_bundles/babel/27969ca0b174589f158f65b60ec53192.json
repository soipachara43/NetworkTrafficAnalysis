{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/angular/map_controller.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/angular/map_controller.js","mtime":1589249552384},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfY2hyb21lID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1aS9jaHJvbWUiKSk7Cgp2YXIgX3Jpc29uTm9kZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicmlzb24tbm9kZSIpKTsKCnJlcXVpcmUoInVpL2RpcmVjdGl2ZXMvbGlzdGVuIik7CgpyZXF1aXJlKCJ1aS9kaXJlY3RpdmVzL3N0b3JhZ2UiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9jYXBhYmlsaXRpZXMgPSByZXF1aXJlKCJ1aS9jYXBhYmlsaXRpZXMiKTsKCnZhciBfcmVhY3REb20gPSByZXF1aXJlKCJyZWFjdC1kb20iKTsKCnZhciBfbW9kdWxlcyA9IHJlcXVpcmUoInVpL21vZHVsZXMiKTsKCnZhciBfa2liYW5hX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4va2liYW5hX3NlcnZpY2VzIik7Cgp2YXIgX3JlYWN0UmVkdXggPSByZXF1aXJlKCJyZWFjdC1yZWR1eCIpOwoKdmFyIF9zdG9yZSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvbWFwcy9wdWJsaWMvcmVkdWNlcnMvc3RvcmUiKTsKCnZhciBfZ2lzX21hcCA9IHJlcXVpcmUoIi4uL2Nvbm5lY3RlZF9jb21wb25lbnRzL2dpc19tYXAiKTsKCnZhciBfaGVscF9tZW51X3V0aWwgPSByZXF1aXJlKCIuLi9oZWxwX21lbnVfdXRpbCIpOwoKdmFyIF9tYXBfYWN0aW9ucyA9IHJlcXVpcmUoIi4uL2FjdGlvbnMvbWFwX2FjdGlvbnMiKTsKCnZhciBfdWkgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9wbHVnaW5zL21hcHMvcHVibGljL3JlZHVjZXJzL3VpIik7Cgp2YXIgX3VpX2FjdGlvbnMgPSByZXF1aXJlKCIuLi9hY3Rpb25zL3VpX2FjdGlvbnMiKTsKCnZhciBfdWlfc2VsZWN0b3JzID0gcmVxdWlyZSgiLi4vc2VsZWN0b3JzL3VpX3NlbGVjdG9ycyIpOwoKdmFyIF91dGlsID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9tYXBzL3B1YmxpYy9yZWR1Y2Vycy91dGlsIik7Cgp2YXIgX21hcF9zZWxlY3RvcnMgPSByZXF1aXJlKCIuLi9zZWxlY3RvcnMvbWFwX3NlbGVjdG9ycyIpOwoKdmFyIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvbWFwcy9wdWJsaWMvcmVkdWNlcnMvbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMiKTsKCnZhciBfZG9jX3RpdGxlID0gcmVxdWlyZSgidWkvZG9jX3RpdGxlIik7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoInVpL25vdGlmeSIpOwoKdmFyIF9nZXRfaW5pdGlhbF9sYXllcnMgPSByZXF1aXJlKCIuL2dldF9pbml0aWFsX2xheWVycyIpOwoKdmFyIF9nZXRfaW5pdGlhbF9xdWVyeSA9IHJlcXVpcmUoIi4vZ2V0X2luaXRpYWxfcXVlcnkiKTsKCnZhciBfZ2V0X2luaXRpYWxfdGltZV9maWx0ZXJzID0gcmVxdWlyZSgiLi9nZXRfaW5pdGlhbF90aW1lX2ZpbHRlcnMiKTsKCnZhciBfZ2V0X2luaXRpYWxfcmVmcmVzaF9jb25maWcgPSByZXF1aXJlKCIuL2dldF9pbml0aWFsX3JlZnJlc2hfY29uZmlnIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4uLy4uL2NvbW1vbi9jb25zdGFudHMiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2RhdGEvcHVibGljIik7Cgp2YXIgX3B1YmxpYzIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9zYXZlZF9vYmplY3RzL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMva2liYW5hX2xlZ2FjeS9wdWJsaWMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKKDAsIF9wdWJsaWMzLmxvYWRLYm5Ub3BOYXZEaXJlY3RpdmVzKShfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5uYXZpZ2F0aW9uLnVpKTsKdmFyIHNhdmVkUXVlcnlTZXJ2aWNlID0gX25ld19wbGF0Zm9ybS5ucFN0YXJ0LnBsdWdpbnMuZGF0YS5xdWVyeS5zYXZlZFF1ZXJpZXM7CnZhciBSRUFDVF9BTkNIT1JfRE9NX0VMRU1FTlRfSUQgPSAncmVhY3QtbWFwcy1yb290JzsKCnZhciBhcHAgPSBfbW9kdWxlcy51aU1vZHVsZXMuZ2V0KF9jb25zdGFudHMuTUFQX0FQUF9QQVRILCBbXSk7CgpmdW5jdGlvbiBnZXRJbml0aWFsTGF5ZXJzRnJvbVVybFBhcmFtKCkgewogIHZhciBsb2NhdGlvblNwbGl0ID0gd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJz8nKTsKCiAgaWYgKGxvY2F0aW9uU3BsaXQubGVuZ3RoIDw9IDEpIHsKICAgIHJldHVybiBbXTsKICB9CgogIHZhciBtYXBBcHBQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKGxvY2F0aW9uU3BsaXRbMV0pOwoKICBpZiAoIW1hcEFwcFBhcmFtcy5oYXMoJ2luaXRpYWxMYXllcnMnKSkgewogICAgcmV0dXJuIFtdOwogIH0KCiAgdHJ5IHsKICAgIHJldHVybiBfcmlzb25Ob2RlLmRlZmF1bHQuZGVjb2RlX2FycmF5KG1hcEFwcFBhcmFtcy5nZXQoJ2luaXRpYWxMYXllcnMnKSk7CiAgfSBjYXRjaCAoZSkgewogICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkV2FybmluZyh7CiAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5pbml0aWFsTGF5ZXJzLnVuYWJsZVRvUGFyc2VUaXRsZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluaXRhbCBsYXllcnMgbm90IGFkZGVkIHRvIG1hcCIKICAgICAgfSksCiAgICAgIHRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLmluaXRpYWxMYXllcnMudW5hYmxlVG9QYXJzZU1lc3NhZ2UnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJVbmFibGUgdG8gcGFyc2UgY29udGVudHMgb2YgJ2luaXRpYWxMYXllcnMnIHBhcmFtZXRlci4gRXJyb3I6IHtlcnJvck1zZ30iLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgZXJyb3JNc2c6IGUubWVzc2FnZQogICAgICAgIH0KICAgICAgfSkKICAgIH0pOwoKICAgIHJldHVybiBbXTsKICB9Cn0KCmFwcC5jb250cm9sbGVyKCdHaXNNYXBDb250cm9sbGVyJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvdXRlLCBrYm5VcmwsIGxvY2FsU3RvcmFnZSwgQXBwU3RhdGUsIGdsb2JhbFN0YXRlKSB7CiAgdmFyIGZpbHRlck1hbmFnZXIgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5kYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXI7CiAgdmFyIHNhdmVkTWFwID0gJHJvdXRlLmN1cnJlbnQubG9jYWxzLm1hcDsKICAkc2NvcGUuc2NyZWVuVGl0bGUgPSBzYXZlZE1hcC50aXRsZTsKICB2YXIgdW5zdWJzY3JpYmU7CiAgdmFyIGluaXRpYWxMYXllckxpc3RDb25maWc7CiAgdmFyICRzdGF0ZSA9IG5ldyBBcHBTdGF0ZSgpOwogIHZhciBzdG9yZSA9ICgwLCBfc3RvcmUuY3JlYXRlTWFwU3RvcmUpKCk7CgogIGZ1bmN0aW9uIGdldEFwcFN0YXRlRmlsdGVycygpIHsKICAgIHJldHVybiBfbG9kYXNoLmRlZmF1bHQuZ2V0KCRzdGF0ZSwgJ2ZpbHRlcnMnLCBbXSk7CiAgfQoKICAkc2NvcGUuJGxpc3RlbihnbG9iYWxTdGF0ZSwgJ2ZldGNoX3dpdGhfY2hhbmdlcycsIGZ1bmN0aW9uIChkaWZmKSB7CiAgICBpZiAoZGlmZi5pbmNsdWRlcygndGltZScpIHx8IGRpZmYuaW5jbHVkZXMoJ2ZpbHRlcnMnKSkgewogICAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgICBmaWx0ZXJzOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGdsb2JhbFN0YXRlLmZpbHRlcnMpLCBfdG9Db25zdW1hYmxlQXJyYXkoZ2V0QXBwU3RhdGVGaWx0ZXJzKCkpKSwKICAgICAgICB0aW1lOiBnbG9iYWxTdGF0ZS50aW1lCiAgICAgIH0pOwogICAgfQoKICAgIGlmIChkaWZmLmluY2x1ZGVzKCdyZWZyZXNoSW50ZXJ2YWwnKSkgewogICAgICAkc2NvcGUub25SZWZyZXNoQ2hhbmdlKHsKICAgICAgICBpc1BhdXNlZDogZ2xvYmFsU3RhdGUucGF1c2UsCiAgICAgICAgcmVmcmVzaEludGVydmFsOiBnbG9iYWxTdGF0ZS52YWx1ZQogICAgICB9KTsKICAgIH0KICB9KTsKICAkc2NvcGUuJGxpc3Rlbigkc3RhdGUsICdmZXRjaF93aXRoX2NoYW5nZXMnLCBmdW5jdGlvbiAoZGlmZikgewogICAgaWYgKChkaWZmLmluY2x1ZGVzKCdxdWVyeScpIHx8IGRpZmYuaW5jbHVkZXMoJ2ZpbHRlcnMnKSkgJiYgJHN0YXRlLnF1ZXJ5KSB7CiAgICAgIG9uUXVlcnlDaGFuZ2UoewogICAgICAgIGZpbHRlcnM6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZ2xvYmFsU3RhdGUuZmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShnZXRBcHBTdGF0ZUZpbHRlcnMoKSkpLAogICAgICAgIHF1ZXJ5OiAkc3RhdGUucXVlcnkKICAgICAgfSk7CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIHN5bmNBcHBBbmRHbG9iYWxTdGF0ZSgpIHsKICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgLy8gYXBwU3RhdGUKICAgICAgJHN0YXRlLnF1ZXJ5ID0gJHNjb3BlLnF1ZXJ5OwogICAgICAkc3RhdGUuZmlsdGVycyA9IGZpbHRlck1hbmFnZXIuZ2V0QXBwRmlsdGVycygpOwogICAgICAkc3RhdGUuc2F2ZSgpOyAvLyBnbG9iYWxTdGF0ZQoKICAgICAgZ2xvYmFsU3RhdGUudGltZSA9ICRzY29wZS50aW1lOwogICAgICBnbG9iYWxTdGF0ZS5yZWZyZXNoSW50ZXJ2YWwgPSB7CiAgICAgICAgcGF1c2U6ICRzY29wZS5yZWZyZXNoQ29uZmlnLmlzUGF1c2VkLAogICAgICAgIHZhbHVlOiAkc2NvcGUucmVmcmVzaENvbmZpZy5pbnRlcnZhbAogICAgICB9OwogICAgICBnbG9iYWxTdGF0ZS5maWx0ZXJzID0gZmlsdGVyTWFuYWdlci5nZXRHbG9iYWxGaWx0ZXJzKCk7CiAgICAgIGdsb2JhbFN0YXRlLnNhdmUoKTsKICAgIH0pOwogIH0KCiAgJHNjb3BlLnF1ZXJ5ID0gKDAsIF9nZXRfaW5pdGlhbF9xdWVyeS5nZXRJbml0aWFsUXVlcnkpKHsKICAgIG1hcFN0YXRlSlNPTjogc2F2ZWRNYXAubWFwU3RhdGVKU09OLAogICAgYXBwU3RhdGU6ICRzdGF0ZSwKICAgIHVzZXJRdWVyeUxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKQogIH0pOwogICRzY29wZS50aW1lID0gKDAsIF9nZXRfaW5pdGlhbF90aW1lX2ZpbHRlcnMuZ2V0SW5pdGlhbFRpbWVGaWx0ZXJzKSh7CiAgICBtYXBTdGF0ZUpTT046IHNhdmVkTWFwLm1hcFN0YXRlSlNPTiwKICAgIGdsb2JhbFN0YXRlOiBnbG9iYWxTdGF0ZQogIH0pOwogICRzY29wZS5yZWZyZXNoQ29uZmlnID0gKDAsIF9nZXRfaW5pdGlhbF9yZWZyZXNoX2NvbmZpZy5nZXRJbml0aWFsUmVmcmVzaENvbmZpZykoewogICAgbWFwU3RhdGVKU09OOiBzYXZlZE1hcC5tYXBTdGF0ZUpTT04sCiAgICBnbG9iYWxTdGF0ZTogZ2xvYmFsU3RhdGUKICB9KTsKICAvKiBTYXZlZCBRdWVyaWVzICovCgogICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkubWFwcy5zYXZlUXVlcnk7CiAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkubWFwcy5zYXZlUXVlcnk7CiAgfSwgZnVuY3Rpb24gKG5ld0NhcGFiaWxpdHkpIHsKICAgICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gbmV3Q2FwYWJpbGl0eTsKICB9KTsKCiAgJHNjb3BlLm9uUXVlcnlTYXZlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgfTsKCiAgJHNjb3BlLm9uU2F2ZWRRdWVyeVVwZGF0ZWQgPSBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBzYXZlZFF1ZXJ5KTsKICB9OwoKICAkc2NvcGUub25DbGVhclNhdmVkUXVlcnkgPSBmdW5jdGlvbiAoKSB7CiAgICBkZWxldGUgJHNjb3BlLnNhdmVkUXVlcnk7CiAgICBkZWxldGUgJHN0YXRlLnNhdmVkUXVlcnk7CiAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgZmlsdGVyczogZmlsdGVyTWFuYWdlci5nZXRHbG9iYWxGaWx0ZXJzKCksCiAgICAgIHF1ZXJ5OiB7CiAgICAgICAgcXVlcnk6ICcnLAogICAgICAgIGxhbmd1YWdlOiBsb2NhbFN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKQogICAgICB9CiAgICB9KTsKICB9OwoKICBmdW5jdGlvbiB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpIHsKICAgIHZhciBzYXZlZFF1ZXJ5RmlsdGVycyA9IHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdOwogICAgdmFyIGdsb2JhbEZpbHRlcnMgPSBmaWx0ZXJNYW5hZ2VyLmdldEdsb2JhbEZpbHRlcnMoKTsKICAgIHZhciBhbGxGaWx0ZXJzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzYXZlZFF1ZXJ5RmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShnbG9iYWxGaWx0ZXJzKSk7CgogICAgaWYgKHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyKSB7CiAgICAgIGlmIChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwpIHsKICAgICAgICAkc2NvcGUub25SZWZyZXNoQ2hhbmdlKHsKICAgICAgICAgIGlzUGF1c2VkOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlci5yZWZyZXNoSW50ZXJ2YWwucGF1c2UsCiAgICAgICAgICByZWZyZXNoSW50ZXJ2YWw6IHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLnJlZnJlc2hJbnRlcnZhbC52YWx1ZQogICAgICAgIH0pOwogICAgICB9CgogICAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgICBmaWx0ZXJzOiBhbGxGaWx0ZXJzLAogICAgICAgIHF1ZXJ5OiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnksCiAgICAgICAgdGltZTogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgICBmaWx0ZXJzOiBhbGxGaWx0ZXJzLAogICAgICAgIHF1ZXJ5OiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnkKICAgICAgfSk7CiAgICB9CiAgfQoKICAkc2NvcGUuJHdhdGNoKCdzYXZlZFF1ZXJ5JywgZnVuY3Rpb24gKG5ld1NhdmVkUXVlcnkpIHsKICAgIGlmICghbmV3U2F2ZWRRdWVyeSkgcmV0dXJuOwogICAgJHN0YXRlLnNhdmVkUXVlcnkgPSBuZXdTYXZlZFF1ZXJ5LmlkOwogICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5KTsKICB9KTsKICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAkc3RhdGUuc2F2ZWRRdWVyeTsKICB9LCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeUlkKSB7CiAgICBpZiAoIW5ld1NhdmVkUXVlcnlJZCkgewogICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHVuZGVmaW5lZDsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICgkc2NvcGUuc2F2ZWRRdWVyeSAmJiBuZXdTYXZlZFF1ZXJ5SWQgIT09ICRzY29wZS5zYXZlZFF1ZXJ5LmlkKSB7CiAgICAgIHNhdmVkUXVlcnlTZXJ2aWNlLmdldFNhdmVkUXVlcnkobmV3U2F2ZWRRdWVyeUlkKS50aGVuKGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBzYXZlZFF1ZXJ5OwogICAgICAgICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShzYXZlZFF1ZXJ5KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSk7CiAgLyogRW5kIG9mIFNhdmVkIFF1ZXJpZXMgKi8KCiAgZnVuY3Rpb24gb25RdWVyeUNoYW5nZShfeCkgewogICAgcmV0dXJuIF9vblF1ZXJ5Q2hhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBmdW5jdGlvbiBfb25RdWVyeUNoYW5nZSgpIHsKICAgIF9vblF1ZXJ5Q2hhbmdlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihfcmVmNCkgewogICAgICB2YXIgZmlsdGVycywgcXVlcnksIHRpbWUsIHJlZnJlc2g7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZmlsdGVycyA9IF9yZWY0LmZpbHRlcnMsIHF1ZXJ5ID0gX3JlZjQucXVlcnksIHRpbWUgPSBfcmVmNC50aW1lLCByZWZyZXNoID0gX3JlZjQucmVmcmVzaDsKCiAgICAgICAgICAgICAgaWYgKGZpbHRlcnMpIHsKICAgICAgICAgICAgICAgIGZpbHRlck1hbmFnZXIuc2V0RmlsdGVycyhmaWx0ZXJzKTsgLy8gTWFwcyBhbmQgbWVyZ2VzIGZpbHRlcnMKCiAgICAgICAgICAgICAgICAkc2NvcGUuZmlsdGVycyA9IGZpbHRlck1hbmFnZXIuZ2V0RmlsdGVycygpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHF1ZXJ5KSB7CiAgICAgICAgICAgICAgICAkc2NvcGUucXVlcnkgPSBxdWVyeTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0aW1lKSB7CiAgICAgICAgICAgICAgICAkc2NvcGUudGltZSA9IHRpbWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzeW5jQXBwQW5kR2xvYmFsU3RhdGUoKTsKICAgICAgICAgICAgICBkaXNwYXRjaFNldFF1ZXJ5KHJlZnJlc2gpOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIpOwogICAgfSkpOwogICAgcmV0dXJuIF9vblF1ZXJ5Q2hhbmdlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICBmdW5jdGlvbiBkaXNwYXRjaFNldFF1ZXJ5KHJlZnJlc2gpIHsKICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfbWFwX2FjdGlvbnMuc2V0UXVlcnkpKHsKICAgICAgZmlsdGVyczogJHNjb3BlLmZpbHRlcnMsCiAgICAgIHF1ZXJ5OiAkc2NvcGUucXVlcnksCiAgICAgIHRpbWVGaWx0ZXJzOiAkc2NvcGUudGltZSwKICAgICAgcmVmcmVzaDogcmVmcmVzaAogICAgfSkpOwogIH0KCiAgJHNjb3BlLmluZGV4UGF0dGVybnMgPSBbXTsKCiAgJHNjb3BlLm9uUXVlcnlTdWJtaXQgPSBmdW5jdGlvbiAoX3JlZikgewogICAgdmFyIGRhdGVSYW5nZSA9IF9yZWYuZGF0ZVJhbmdlLAogICAgICAgIHF1ZXJ5ID0gX3JlZi5xdWVyeTsKICAgIG9uUXVlcnlDaGFuZ2UoewogICAgICBxdWVyeTogcXVlcnksCiAgICAgIHRpbWU6IGRhdGVSYW5nZSwKICAgICAgcmVmcmVzaDogdHJ1ZQogICAgfSk7CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZUZpbHRlcnNBbmREaXNwYXRjaCA9IGZ1bmN0aW9uIChmaWx0ZXJzKSB7CiAgICBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgZmlsdGVyczogZmlsdGVycwogICAgfSk7CiAgfTsKCiAgJHNjb3BlLm9uUmVmcmVzaENoYW5nZSA9IGZ1bmN0aW9uIChfcmVmMikgewogICAgdmFyIGlzUGF1c2VkID0gX3JlZjIuaXNQYXVzZWQsCiAgICAgICAgcmVmcmVzaEludGVydmFsID0gX3JlZjIucmVmcmVzaEludGVydmFsOwogICAgJHNjb3BlLnJlZnJlc2hDb25maWcgPSB7CiAgICAgIGlzUGF1c2VkOiBpc1BhdXNlZCwKICAgICAgaW50ZXJ2YWw6IHJlZnJlc2hJbnRlcnZhbCA/IHJlZnJlc2hJbnRlcnZhbCA6ICRzY29wZS5yZWZyZXNoQ29uZmlnLmludGVydmFsCiAgICB9OwogICAgc3luY0FwcEFuZEdsb2JhbFN0YXRlKCk7CiAgICBzdG9yZS5kaXNwYXRjaCgoMCwgX21hcF9hY3Rpb25zLnNldFJlZnJlc2hDb25maWcpKCRzY29wZS5yZWZyZXNoQ29uZmlnKSk7CiAgfTsKCiAgZnVuY3Rpb24gYWRkRmlsdGVycyhuZXdGaWx0ZXJzKSB7CiAgICBuZXdGaWx0ZXJzLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikgewogICAgICBmaWx0ZXIuJHN0YXRlID0gX3B1YmxpYy5lc0ZpbHRlcnMuRmlsdGVyU3RhdGVTdG9yZS5BUFBfU1RBVEU7CiAgICB9KTsKICAgICRzY29wZS51cGRhdGVGaWx0ZXJzQW5kRGlzcGF0Y2goW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSgkc2NvcGUuZmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShuZXdGaWx0ZXJzKSkpOwogIH0KCiAgZnVuY3Rpb24gaGFzVW5zYXZlZENoYW5nZXMoKSB7CiAgICB2YXIgc3RhdGUgPSBzdG9yZS5nZXRTdGF0ZSgpOwogICAgdmFyIGxheWVyTGlzdCA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRMYXllckxpc3RSYXcpKHN0YXRlKTsKICAgIHZhciBsYXllckxpc3RDb25maWdPbmx5ID0gKDAsIF91dGlsLmNvcHlQZXJzaXN0ZW50U3RhdGUpKGxheWVyTGlzdCk7CiAgICB2YXIgc2F2ZWRMYXllckxpc3QgPSBzYXZlZE1hcC5nZXRMYXllckxpc3QoKTsKICAgIHJldHVybiAhc2F2ZWRMYXllckxpc3QgPyAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwobGF5ZXJMaXN0Q29uZmlnT25seSwgaW5pdGlhbExheWVyTGlzdENvbmZpZykgOiAvLyBzYXZlZE1hcCBzdG9yZXMgbGF5ZXJMaXN0IGFzIGEgSlNPTiBzdHJpbmcgdXNpbmcgSlNPTi5zdHJpbmdpZnkuCiAgICAvLyBKU09OLnN0cmluZ2lmeSByZW1vdmVzIHVuZGVmaW5lZCBwcm9wZXJ0aWVzIGZyb20gb2JqZWN0cy4KICAgIC8vIHNhdmVkTWFwLmdldExheWVyTGlzdCBjb252ZXJ0cyB0aGUgSlNPTiBzdHJpbmcgYmFjayBpbnRvIEphdmFzY3JpcHQgYXJyYXkgb2Ygb2JqZWN0cy4KICAgIC8vIE5lZWQgdG8gcGVyZm9ybSB0aGUgc2FtZSBwcm9jZXNzIGZvciBsYXllckxpc3RDb25maWdPbmx5IHRvIGNvbXBhcmUgYXBwbGVzIHRvIGFwcGxlcwogICAgLy8gYW5kIGF2b2lkIHVuZGVmaW5lZCBwcm9wZXJ0aWVzIGluIGxheWVyTGlzdENvbmZpZ09ubHkgdHJpZ2dlcmluZyB1bnNhdmVkIGNoYW5nZXMuCiAgICAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwoSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShsYXllckxpc3RDb25maWdPbmx5KSksIHNhdmVkTGF5ZXJMaXN0KTsKICB9CgogIGZ1bmN0aW9uIGlzT25NYXBOb3coKSB7CiAgICByZXR1cm4gd2luZG93LmxvY2F0aW9uLmhhc2guc3RhcnRzV2l0aCgiIy8iLmNvbmNhdChfY29uc3RhbnRzLk1BUF9TQVZFRF9PQkpFQ1RfVFlQRSkpOwogIH0KCiAgZnVuY3Rpb24gYmVmb3JlVW5sb2FkKGV2ZW50KSB7CiAgICBpZiAoIWlzT25NYXBOb3coKSkgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGhhc0NoYW5nZWQgPSBoYXNVbnNhdmVkQ2hhbmdlcygpOwoKICAgIGlmIChoYXNDaGFuZ2VkKSB7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGV2ZW50LnJldHVyblZhbHVlID0gJ2Zvb2Jhcic7IC8vdGhpcyBpcyByZXF1aXJlZCBmb3IgQ2hyb21lCiAgICB9CiAgfQoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgYmVmb3JlVW5sb2FkKTsKCiAgZnVuY3Rpb24gcmVuZGVyTWFwKCkgewogICAgcmV0dXJuIF9yZW5kZXJNYXAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogIGZ1bmN0aW9uIF9yZW5kZXJNYXAoKSB7CiAgICBfcmVuZGVyTWFwID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgdmFyIHNhdmVkT2JqZWN0RmlsdGVycywgbWFwU3RhdGUsIHVpU3RhdGUsIGxheWVyTGlzdCwgaW5pdGlhbEZpbHRlcnMsIHJvb3Q7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgLy8gY2xlYXIgb2xkIFVJIHN0YXRlCiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5zZXRTZWxlY3RlZExheWVyKShudWxsKSk7CiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF91aV9hY3Rpb25zLnVwZGF0ZUZseW91dCkoX3VpLkZMWU9VVF9TVEFURS5OT05FKSk7CiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF91aV9hY3Rpb25zLnNldFJlYWRPbmx5KSghX2NhcGFiaWxpdGllcy5jYXBhYmlsaXRpZXMuZ2V0KCkubWFwcy5zYXZlKSk7CiAgICAgICAgICAgICAgaGFuZGxlU3RvcmVDaGFuZ2VzKHN0b3JlKTsKICAgICAgICAgICAgICB1bnN1YnNjcmliZSA9IHN0b3JlLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVTdG9yZUNoYW5nZXMoc3RvcmUpOwogICAgICAgICAgICAgIH0pOyAvLyBzeW5jIHN0b3JlIHdpdGggc2F2ZWRNYXAgbWFwU3RhdGUKCiAgICAgICAgICAgICAgc2F2ZWRPYmplY3RGaWx0ZXJzID0gW107CgogICAgICAgICAgICAgIGlmIChzYXZlZE1hcC5tYXBTdGF0ZUpTT04pIHsKICAgICAgICAgICAgICAgIG1hcFN0YXRlID0gSlNPTi5wYXJzZShzYXZlZE1hcC5tYXBTdGF0ZUpTT04pOwogICAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5zZXRHb3RvV2l0aENlbnRlcikoewogICAgICAgICAgICAgICAgICBsYXQ6IG1hcFN0YXRlLmNlbnRlci5sYXQsCiAgICAgICAgICAgICAgICAgIGxvbjogbWFwU3RhdGUuY2VudGVyLmxvbiwKICAgICAgICAgICAgICAgICAgem9vbTogbWFwU3RhdGUuem9vbQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgIGlmIChtYXBTdGF0ZS5maWx0ZXJzKSB7CiAgICAgICAgICAgICAgICAgIHNhdmVkT2JqZWN0RmlsdGVycyA9IG1hcFN0YXRlLmZpbHRlcnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoc2F2ZWRNYXAudWlTdGF0ZUpTT04pIHsKICAgICAgICAgICAgICAgIHVpU3RhdGUgPSBKU09OLnBhcnNlKHNhdmVkTWFwLnVpU3RhdGVKU09OKTsKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5zZXRJc0xheWVyVE9DT3BlbikoX2xvZGFzaC5kZWZhdWx0LmdldCh1aVN0YXRlLCAnaXNMYXllclRPQ09wZW4nLCBfdWkuREVGQVVMVF9JU19MQVlFUl9UT0NfT1BFTikpKTsKICAgICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5zZXRPcGVuVE9DRGV0YWlscykoX2xvZGFzaC5kZWZhdWx0LmdldCh1aVN0YXRlLCAnb3BlblRPQ0RldGFpbHMnLCBbXSkpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGxheWVyTGlzdCA9ICgwLCBfZ2V0X2luaXRpYWxfbGF5ZXJzLmdldEluaXRpYWxMYXllcnMpKHNhdmVkTWFwLmxheWVyTGlzdEpTT04sIGdldEluaXRpYWxMYXllcnNGcm9tVXJsUGFyYW0oKSk7CiAgICAgICAgICAgICAgaW5pdGlhbExheWVyTGlzdENvbmZpZyA9ICgwLCBfdXRpbC5jb3B5UGVyc2lzdGVudFN0YXRlKShsYXllckxpc3QpOwogICAgICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfbWFwX2FjdGlvbnMucmVwbGFjZUxheWVyTGlzdCkobGF5ZXJMaXN0KSk7CiAgICAgICAgICAgICAgc3RvcmUuZGlzcGF0Y2goKDAsIF9tYXBfYWN0aW9ucy5zZXRSZWZyZXNoQ29uZmlnKSgkc2NvcGUucmVmcmVzaENvbmZpZykpOwogICAgICAgICAgICAgIGluaXRpYWxGaWx0ZXJzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfbG9kYXNoLmRlZmF1bHQuZ2V0KGdsb2JhbFN0YXRlLCAnZmlsdGVycycsIFtdKSksIF90b0NvbnN1bWFibGVBcnJheShnZXRBcHBTdGF0ZUZpbHRlcnMoKSksIF90b0NvbnN1bWFibGVBcnJheShzYXZlZE9iamVjdEZpbHRlcnMpKTsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDE1OwogICAgICAgICAgICAgIHJldHVybiBvblF1ZXJ5Q2hhbmdlKHsKICAgICAgICAgICAgICAgIGZpbHRlcnM6IGluaXRpYWxGaWx0ZXJzCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIHJvb3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChSRUFDVF9BTkNIT1JfRE9NX0VMRU1FTlRfSUQpOwogICAgICAgICAgICAgICgwLCBfcmVhY3REb20ucmVuZGVyKShfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdFJlZHV4LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICBzdG9yZTogc3RvcmUKICAgICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuSTE4blByb3ZpZGVyLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9naXNfbWFwLkdpc01hcCwgewogICAgICAgICAgICAgICAgYWRkRmlsdGVyczogYWRkRmlsdGVycwogICAgICAgICAgICAgIH0pKSksIHJvb3QpOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzKTsKICAgIH0pKTsKICAgIHJldHVybiBfcmVuZGVyTWFwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfQoKICByZW5kZXJNYXAoKTsKICB2YXIgcHJldkluZGV4UGF0dGVybklkczsKCiAgZnVuY3Rpb24gdXBkYXRlSW5kZXhQYXR0ZXJucyhfeDIpIHsKICAgIHJldHVybiBfdXBkYXRlSW5kZXhQYXR0ZXJucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgZnVuY3Rpb24gX3VwZGF0ZUluZGV4UGF0dGVybnMoKSB7CiAgICBfdXBkYXRlSW5kZXhQYXR0ZXJucyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUobmV4dEluZGV4UGF0dGVybklkcykgewogICAgICB2YXIgaW5kZXhQYXR0ZXJucywgZ2V0SW5kZXhQYXR0ZXJuUHJvbWlzZXM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJucyA9IFtdOwogICAgICAgICAgICAgIGdldEluZGV4UGF0dGVyblByb21pc2VzID0gbmV4dEluZGV4UGF0dGVybklkcy5tYXAoCiAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVmNSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoaW5kZXhQYXR0ZXJuSWQpIHsKICAgICAgICAgICAgICAgICAgdmFyIGluZGV4UGF0dGVybjsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2tpYmFuYV9zZXJ2aWNlcy5nZXRJbmRleFBhdHRlcm5TZXJ2aWNlKSgpLmdldChpbmRleFBhdHRlcm5JZCk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJucy5wdXNoKGluZGV4UGF0dGVybik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNCwgbnVsbCwgW1swLCA3XV0pOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9KCkpOwogICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZ2V0SW5kZXhQYXR0ZXJuUHJvbWlzZXMpOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGlmICghKHByZXZJbmRleFBhdHRlcm5JZHMgIT09IG5leHRJbmRleFBhdHRlcm5JZHMpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDY7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkc2NvcGUuaW5kZXhQYXR0ZXJucyA9IGluZGV4UGF0dGVybnM7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlNSk7CiAgICB9KSk7CiAgICByZXR1cm4gX3VwZGF0ZUluZGV4UGF0dGVybnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9CgogICRzY29wZS5pc0Z1bGxTY3JlZW4gPSBmYWxzZTsKICAkc2NvcGUuaXNTYXZlRGlzYWJsZWQgPSBmYWxzZTsKCiAgZnVuY3Rpb24gaGFuZGxlU3RvcmVDaGFuZ2VzKHN0b3JlKSB7CiAgICB2YXIgbmV4dElzRnVsbFNjcmVlbiA9ICgwLCBfdWlfc2VsZWN0b3JzLmdldElzRnVsbFNjcmVlbikoc3RvcmUuZ2V0U3RhdGUoKSk7CgogICAgaWYgKG5leHRJc0Z1bGxTY3JlZW4gIT09ICRzY29wZS5pc0Z1bGxTY3JlZW4pIHsKICAgICAgLy8gTXVzdCB0cmlnZ2VyIGRpZ2VzdCBjeWNsZSBmb3IgYW5ndWxhciB0b3AgbmF2IHRvIHJlZHJhdyBpdHNlbGYgd2hlbiBpc0Z1bGxTY3JlZW4gY2hhbmdlcwogICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgJHNjb3BlLmlzRnVsbFNjcmVlbiA9IG5leHRJc0Z1bGxTY3JlZW47CiAgICAgIH0pOwogICAgfQoKICAgIHZhciBuZXh0SW5kZXhQYXR0ZXJuSWRzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFF1ZXJ5YWJsZVVuaXF1ZUluZGV4UGF0dGVybklkcykoc3RvcmUuZ2V0U3RhdGUoKSk7CgogICAgaWYgKG5leHRJbmRleFBhdHRlcm5JZHMgIT09IHByZXZJbmRleFBhdHRlcm5JZHMpIHsKICAgICAgcHJldkluZGV4UGF0dGVybklkcyA9IG5leHRJbmRleFBhdHRlcm5JZHM7CiAgICAgIHVwZGF0ZUluZGV4UGF0dGVybnMobmV4dEluZGV4UGF0dGVybklkcyk7CiAgICB9CgogICAgdmFyIG5leHRJc1NhdmVEaXNhYmxlZCA9ICgwLCBfbWFwX3NlbGVjdG9ycy5oYXNEaXJ0eVN0YXRlKShzdG9yZS5nZXRTdGF0ZSgpKTsKCiAgICBpZiAobmV4dElzU2F2ZURpc2FibGVkICE9PSAkc2NvcGUuaXNTYXZlRGlzYWJsZWQpIHsKICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICRzY29wZS5pc1NhdmVEaXNhYmxlZCA9IG5leHRJc1NhdmVEaXNhYmxlZDsKICAgICAgfSk7CiAgICB9CiAgfQoKICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBiZWZvcmVVbmxvYWQpOwoKICAgIGlmICh1bnN1YnNjcmliZSkgewogICAgICB1bnN1YnNjcmliZSgpOwogICAgfQoKICAgIHZhciBub2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUkVBQ1RfQU5DSE9SX0RPTV9FTEVNRU5UX0lEKTsKCiAgICBpZiAobm9kZSkgewogICAgICAoMCwgX3JlYWN0RG9tLnVubW91bnRDb21wb25lbnRBdE5vZGUpKG5vZGUpOwogICAgfQogIH0pOwoKICB2YXIgdXBkYXRlQnJlYWRjcnVtYnMgPSBmdW5jdGlvbiB1cGRhdGVCcmVhZGNydW1icygpIHsKICAgIF9jaHJvbWUuZGVmYXVsdC5icmVhZGNydW1icy5zZXQoW3sKICAgICAgdGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMubWFwQ29udHJvbGxlci5tYXBzQnJlYWRjcnVtYkxhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTWFwcycKICAgICAgfSksCiAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgaWYgKGlzT25NYXBOb3coKSAmJiBoYXNVbnNhdmVkQ2hhbmdlcygpKSB7CiAgICAgICAgICB2YXIgbmF2aWdhdGVBd2F5ID0gd2luZG93LmNvbmZpcm0oX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMubWFwQ29udHJvbGxlci51bnNhdmVkQ2hhbmdlc1dhcm5pbmcnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiWW91ciB1bnNhdmVkIGNoYW5nZXMgbWlnaHQgbm90IGJlIHNhdmVkIgogICAgICAgICAgfSkpOwoKICAgICAgICAgIGlmIChuYXZpZ2F0ZUF3YXkpIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnIyc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJyMnOwogICAgICAgIH0KICAgICAgfQogICAgfSwgewogICAgICB0ZXh0OiBzYXZlZE1hcC50aXRsZQogICAgfV0pOwogIH07CgogIHVwZGF0ZUJyZWFkY3J1bWJzKCk7CiAgKDAsIF9oZWxwX21lbnVfdXRpbC5hZGRIZWxwTWVudVRvQXBwQ2hyb21lKShfY2hyb21lLmRlZmF1bHQpOwoKICBmdW5jdGlvbiBkb1NhdmUoX3gzKSB7CiAgICByZXR1cm4gX2RvU2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0gLy8gSGlkZSBhbmd1bGFyIHRpbWVwaWNlci9yZWZyZXNoIFVJIGZyb20gdG9wIG5hdgoKCiAgZnVuY3Rpb24gX2RvU2F2ZSgpIHsKICAgIF9kb1NhdmUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgIC8qI19fUFVSRV9fKi8KICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KHNhdmVPcHRpb25zKSB7CiAgICAgIHZhciBpZDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI7CiAgICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCgwLCBfbWFwX2FjdGlvbnMuY2xlYXJUcmFuc2llbnRMYXllclN0YXRlQW5kQ2xvc2VGbHlvdXQpKCkpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIHNhdmVkTWFwLnN5bmNXaXRoU3RvcmUoc3RvcmUuZ2V0U3RhdGUoKSk7CiAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAzOwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICByZXR1cm4gc2F2ZWRNYXAuc2F2ZShzYXZlT3B0aW9ucyk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgaWQgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICAgICAgX2RvY190aXRsZS5kb2NUaXRsZS5jaGFuZ2Uoc2F2ZWRNYXAudGl0bGUpOwoKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDEwOwogICAgICAgICAgICAgIF9jb250ZXh0Ni50MCA9IF9jb250ZXh0NlsiY2F0Y2giXSgzKTsKCiAgICAgICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkRGFuZ2VyKHsKICAgICAgICAgICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLnNhdmVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRXJyb3Igb24gc2F2aW5nICd7dGl0bGV9JyIsCiAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzYXZlZE1hcC50aXRsZQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHRleHQ6IF9jb250ZXh0Ni50MC5tZXNzYWdlLAogICAgICAgICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ3NhdmVNYXBFcnJvcicKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDYudDAKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgaWYgKGlkKSB7CiAgICAgICAgICAgICAgICBfbm90aWZ5LnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuc2F2ZVN1Y2Nlc3NNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZWQgJ3t0aXRsZX0nIiwKICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBzYXZlZE1hcC50aXRsZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICdkYXRhLXRlc3Qtc3Viaic6ICdzYXZlTWFwU3VjY2VzcycKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHVwZGF0ZUJyZWFkY3J1bWJzKCk7CgogICAgICAgICAgICAgICAgaWYgKHNhdmVkTWFwLmlkICE9PSAkcm91dGUuY3VycmVudC5wYXJhbXMuaWQpIHsKICAgICAgICAgICAgICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGtiblVybC5jaGFuZ2UoIm1hcC97e2lkfX0iLCB7CiAgICAgICAgICAgICAgICAgICAgICBpZDogc2F2ZWRNYXAuaWQKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgaWQ6IGlkCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTYsIG51bGwsIFtbMywgMTBdXSk7CiAgICB9KSk7CiAgICByZXR1cm4gX2RvU2F2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0KCiAgKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0VGltZUZpbHRlcikoKS5kaXNhYmxlVGltZVJhbmdlU2VsZWN0b3IoKTsKICAoMCwgX2tpYmFuYV9zZXJ2aWNlcy5nZXRUaW1lRmlsdGVyKSgpLmRpc2FibGVBdXRvUmVmcmVzaFNlbGVjdG9yKCk7CiAgJHNjb3BlLnNob3dEYXRlUGlja2VyID0gdHJ1ZTsgLy8gdXNlZCBieSBxdWVyeS1iYXIgZGlyZWN0aXZlIHRvIGVuYWJsZSB0aW1lcGlrY2VyIGluIHF1ZXJ5IGJhcgoKICAkc2NvcGUudG9wTmF2TWVudSA9IFt7CiAgICBpZDogJ2Z1bGwtc2NyZWVuJywKICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLmZ1bGxTY3JlZW5CdXR0b25MYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJmdWxsIHNjcmVlbiIKICAgIH0pLAogICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuZnVsbFNjcmVlbkRlc2NyaXB0aW9uJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogImZ1bGwgc2NyZWVuIgogICAgfSksCiAgICB0ZXN0SWQ6ICdtYXBzRnVsbFNjcmVlbk1vZGUnLAogICAgcnVuOiBmdW5jdGlvbiBydW4oKSB7CiAgICAgIHN0b3JlLmRpc3BhdGNoKCgwLCBfdWlfYWN0aW9ucy5lbmFibGVGdWxsU2NyZWVuKSgpKTsKICAgIH0KICB9LCB7CiAgICBpZDogJ2luc3BlY3QnLAogICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIub3Blbkluc3BlY3RvckJ1dHRvbkxhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogImluc3BlY3QiCiAgICB9KSwKICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLm9wZW5JbnNwZWN0b3JEZXNjcmlwdGlvbicsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPcGVuIEluc3BlY3RvciIKICAgIH0pLAogICAgdGVzdElkOiAnb3Blbkluc3BlY3RvckJ1dHRvbicsCiAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgdmFyIGluc3BlY3RvckFkYXB0ZXJzID0gKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5nZXRJbnNwZWN0b3JBZGFwdGVycykoc3RvcmUuZ2V0U3RhdGUoKSk7CiAgICAgICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldEluc3BlY3RvcikoKS5vcGVuKGluc3BlY3RvckFkYXB0ZXJzLCB7fSk7CiAgICB9CiAgfV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfY2FwYWJpbGl0aWVzLmNhcGFiaWxpdGllcy5nZXQoKS5tYXBzLnNhdmUgPyBbewogICAgaWQ6ICdzYXZlJywKICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5tYXBDb250cm9sbGVyLnNhdmVNYXBCdXR0b25MYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJzYXZlIgogICAgfSksCiAgICBkZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMubWFwQ29udHJvbGxlci5zYXZlTWFwRGVzY3JpcHRpb24nLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSBtYXAiCiAgICB9KSwKICAgIHRlc3RJZDogJ21hcFNhdmVCdXR0b24nLAogICAgZGlzYWJsZUJ1dHRvbjogZnVuY3Rpb24gZGlzYWJsZUJ1dHRvbigpIHsKICAgICAgcmV0dXJuICRzY29wZS5pc1NhdmVEaXNhYmxlZDsKICAgIH0sCiAgICB0b29sdGlwOiBmdW5jdGlvbiB0b29sdGlwKCkgewogICAgICBpZiAoJHNjb3BlLmlzU2F2ZURpc2FibGVkKSB7CiAgICAgICAgcmV0dXJuIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLm1hcENvbnRyb2xsZXIuc2F2ZU1hcERpc2FibGVkQnV0dG9uVG9vbHRpcCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZSBvciBDYW5jZWwgeW91ciBsYXllciBjaGFuZ2VzIGJlZm9yZSBzYXZpbmcnCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBydW46IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9ydW4gPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBvblNhdmUsIHNhdmVNb2RhbDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBvblNhdmUgPSBmdW5jdGlvbiBvblNhdmUoX3JlZjMpIHsKICAgICAgICAgICAgICAgICAgdmFyIG5ld1RpdGxlID0gX3JlZjMubmV3VGl0bGUsCiAgICAgICAgICAgICAgICAgICAgICBuZXdDb3B5T25TYXZlID0gX3JlZjMubmV3Q29weU9uU2F2ZSwKICAgICAgICAgICAgICAgICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQgPSBfcmVmMy5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgICAgICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZSA9IF9yZWYzLm9uVGl0bGVEdXBsaWNhdGU7CiAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGl0bGUgPSBzYXZlZE1hcC50aXRsZTsKICAgICAgICAgICAgICAgICAgc2F2ZWRNYXAudGl0bGUgPSBuZXdUaXRsZTsKICAgICAgICAgICAgICAgICAgc2F2ZWRNYXAuY29weU9uU2F2ZSA9IG5ld0NvcHlPblNhdmU7CiAgICAgICAgICAgICAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgICBjb25maXJtT3ZlcndyaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgICAgICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvU2F2ZShzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgc2F2ZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgcHV0IHRoZSBvcmlnaW5hbCB2YWx1ZXMgYmFjay4KICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmlkIHx8IHJlc3BvbnNlLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICBzYXZlZE1hcC50aXRsZSA9IGN1cnJlbnRUaXRsZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHNhdmVNb2RhbCA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3B1YmxpYzIuU2F2ZWRPYmplY3RTYXZlTW9kYWwsIHsKICAgICAgICAgICAgICAgICAgb25TYXZlOiBvblNhdmUsCiAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7fSwKICAgICAgICAgICAgICAgICAgdGl0bGU6IHNhdmVkTWFwLnRpdGxlLAogICAgICAgICAgICAgICAgICBzaG93Q29weU9uU2F2ZTogc2F2ZWRNYXAuaWQgPyB0cnVlIDogZmFsc2UsCiAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IF9jb25zdGFudHMuTUFQX1NBVkVEX09CSkVDVF9UWVBFLAogICAgICAgICAgICAgICAgICBzaG93RGVzY3JpcHRpb246IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICgwLCBfcHVibGljMi5zaG93U2F2ZU1vZGFsKShzYXZlTW9kYWwsIF9uZXdfcGxhdGZvcm0ubnBTdGFydC5jb3JlLmkxOG4uQ29udGV4dCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBydW4oKSB7CiAgICAgICAgcmV0dXJuIF9ydW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJ1bjsKICAgIH0oKQogIH1dIDogW10pKTsKfSk7"},null]}