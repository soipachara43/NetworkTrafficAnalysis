{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/sources/es_search_source/es_search_source.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/sources/es_search_source/es_search_source.js","mtime":1589249552452},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkVTU2VhcmNoU291cmNlID0gdm9pZCAwOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF92ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1dWlkL3Y0IikpOwoKdmFyIF92ZWN0b3JfZmVhdHVyZV90eXBlcyA9IHJlcXVpcmUoIi4uL3ZlY3Rvcl9mZWF0dXJlX3R5cGVzIik7Cgp2YXIgX2VzX3NvdXJjZSA9IHJlcXVpcmUoIi4uL2VzX3NvdXJjZSIpOwoKdmFyIF9raWJhbmFfc2VydmljZXMgPSByZXF1aXJlKCIuLi8uLi8uLi9raWJhbmFfc2VydmljZXMiKTsKCnZhciBfdmVjdG9yX3N0eWxlID0gcmVxdWlyZSgiLi4vLi4vc3R5bGVzL3ZlY3Rvci92ZWN0b3Jfc3R5bGUiKTsKCnZhciBfdmVjdG9yX2xheWVyID0gcmVxdWlyZSgiLi4vLi4vdmVjdG9yX2xheWVyIik7Cgp2YXIgX2VsYXN0aWNzZWFyY2hfZ2VvX3V0aWxzID0gcmVxdWlyZSgiLi4vLi4vLi4vZWxhc3RpY3NlYXJjaF9nZW9fdXRpbHMiKTsKCnZhciBfY3JlYXRlX3NvdXJjZV9lZGl0b3IgPSByZXF1aXJlKCIuL2NyZWF0ZV9zb3VyY2VfZWRpdG9yIik7Cgp2YXIgX3VwZGF0ZV9zb3VyY2VfZWRpdG9yID0gcmVxdWlyZSgiLi91cGRhdGVfc291cmNlX2VkaXRvciIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vY29uc3RhbnRzIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfaTE4bl9nZXR0ZXJzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL2kxOG5fZ2V0dGVycyIpOwoKdmFyIF9pbmRleF9wYXR0ZXJuX3V0aWwgPSByZXF1aXJlKCIuLi8uLi8uLi9pbmRleF9wYXR0ZXJuX3V0aWwiKTsKCnZhciBfbG9hZF9pbmRleF9zZXR0aW5ncyA9IHJlcXVpcmUoIi4vbG9hZF9pbmRleF9zZXR0aW5ncyIpOwoKdmFyIF9ibGVuZGVkX3ZlY3Rvcl9sYXllciA9IHJlcXVpcmUoIi4uLy4uL2JsZW5kZWRfdmVjdG9yX2xheWVyIik7Cgp2YXIgX2NvbnN0YW50czIgPSByZXF1aXJlKCIuL2NvbnN0YW50cyIpOwoKdmFyIF9lc19kb2NfZmllbGQgPSByZXF1aXJlKCIuLi8uLi9maWVsZHMvZXNfZG9jX2ZpZWxkIik7Cgp2YXIgX2VzX2FnZ191dGlscyA9IHJlcXVpcmUoIi4uLy4uL3V0aWwvZXNfYWdnX3V0aWxzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCmZ1bmN0aW9uIGdldERvY1ZhbHVlQW5kU291cmNlRmllbGRzKGluZGV4UGF0dGVybiwgZmllbGROYW1lcykgewogIHZhciBkb2NWYWx1ZUZpZWxkcyA9IFtdOwogIHZhciBzb3VyY2VPbmx5RmllbGRzID0gW107CiAgdmFyIHNjcmlwdEZpZWxkcyA9IHt9OwogIGZpZWxkTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoZmllbGROYW1lKSB7CiAgICB2YXIgZmllbGQgPSAoMCwgX2VzX2FnZ191dGlscy5nZXRGaWVsZCkoaW5kZXhQYXR0ZXJuLCBmaWVsZE5hbWUpOwoKICAgIGlmIChmaWVsZC5zY3JpcHRlZCkgewogICAgICBzY3JpcHRGaWVsZHNbZmllbGQubmFtZV0gPSB7CiAgICAgICAgc2NyaXB0OiB7CiAgICAgICAgICBzb3VyY2U6IGZpZWxkLnNjcmlwdCwKICAgICAgICAgIGxhbmc6IGZpZWxkLmxhbmcKICAgICAgICB9CiAgICAgIH07CiAgICB9IGVsc2UgaWYgKGZpZWxkLnJlYWRGcm9tRG9jVmFsdWVzKSB7CiAgICAgIHZhciBkb2NWYWx1ZUZpZWxkID0gZmllbGQudHlwZSA9PT0gJ2RhdGUnID8gewogICAgICAgIGZpZWxkOiBmaWVsZE5hbWUsCiAgICAgICAgZm9ybWF0OiAnZXBvY2hfbWlsbGlzJwogICAgICB9IDogZmllbGROYW1lOwogICAgICBkb2NWYWx1ZUZpZWxkcy5wdXNoKGRvY1ZhbHVlRmllbGQpOwogICAgfSBlbHNlIHsKICAgICAgc291cmNlT25seUZpZWxkcy5wdXNoKGZpZWxkTmFtZSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIHsKICAgIGRvY1ZhbHVlRmllbGRzOiBkb2NWYWx1ZUZpZWxkcywKICAgIHNvdXJjZU9ubHlGaWVsZHM6IHNvdXJjZU9ubHlGaWVsZHMsCiAgICBzY3JpcHRGaWVsZHM6IHNjcmlwdEZpZWxkcwogIH07Cn0KCnZhciBFU1NlYXJjaFNvdXJjZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9BYnN0cmFjdEVTU291cmNlKSB7CiAgX2luaGVyaXRzKEVTU2VhcmNoU291cmNlLCBfQWJzdHJhY3RFU1NvdXJjZSk7CgogIF9jcmVhdGVDbGFzcyhFU1NlYXJjaFNvdXJjZSwgbnVsbCwgW3sKICAgIGtleTogInJlbmRlckVkaXRvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyRWRpdG9yKF9yZWYpIHsKICAgICAgdmFyIG9uUHJldmlld1NvdXJjZSA9IF9yZWYub25QcmV2aWV3U291cmNlLAogICAgICAgICAgaW5zcGVjdG9yQWRhcHRlcnMgPSBfcmVmLmluc3BlY3RvckFkYXB0ZXJzOwoKICAgICAgdmFyIG9uU291cmNlQ29uZmlnQ2hhbmdlID0gZnVuY3Rpb24gb25Tb3VyY2VDb25maWdDaGFuZ2Uoc291cmNlQ29uZmlnKSB7CiAgICAgICAgaWYgKCFzb3VyY2VDb25maWcpIHsKICAgICAgICAgIG9uUHJldmlld1NvdXJjZShudWxsKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBzb3VyY2UgPSBuZXcgRVNTZWFyY2hTb3VyY2UoX29iamVjdFNwcmVhZCh7CiAgICAgICAgICBpZDogKDAsIF92LmRlZmF1bHQpKCkKICAgICAgICB9LCBzb3VyY2VDb25maWcpLCBpbnNwZWN0b3JBZGFwdGVycyk7CiAgICAgICAgb25QcmV2aWV3U291cmNlKHNvdXJjZSk7CiAgICAgIH07CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY3JlYXRlX3NvdXJjZV9lZGl0b3IuQ3JlYXRlU291cmNlRWRpdG9yLCB7CiAgICAgICAgb25Tb3VyY2VDb25maWdDaGFuZ2U6IG9uU291cmNlQ29uZmlnQ2hhbmdlCiAgICAgIH0pOwogICAgfQogIH1dKTsKCiAgZnVuY3Rpb24gRVNTZWFyY2hTb3VyY2UoZGVzY3JpcHRvciwgaW5zcGVjdG9yQWRhcHRlcnMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRVNTZWFyY2hTb3VyY2UpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEVTU2VhcmNoU291cmNlKS5jYWxsKHRoaXMsIF9vYmplY3RTcHJlYWQoe30sIGRlc2NyaXB0b3IsIHsKICAgICAgaWQ6IGRlc2NyaXB0b3IuaWQsCiAgICAgIHR5cGU6IEVTU2VhcmNoU291cmNlLnR5cGUsCiAgICAgIGluZGV4UGF0dGVybklkOiBkZXNjcmlwdG9yLmluZGV4UGF0dGVybklkLAogICAgICBnZW9GaWVsZDogZGVzY3JpcHRvci5nZW9GaWVsZCwKICAgICAgZmlsdGVyQnlNYXBCb3VuZHM6IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGVzY3JpcHRvciwgJ2ZpbHRlckJ5TWFwQm91bmRzJywgX2NvbnN0YW50czIuREVGQVVMVF9GSUxURVJfQllfTUFQX0JPVU5EUyksCiAgICAgIHRvb2x0aXBQcm9wZXJ0aWVzOiBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRlc2NyaXB0b3IsICd0b29sdGlwUHJvcGVydGllcycsIFtdKSwKICAgICAgc29ydEZpZWxkOiBfbG9kYXNoLmRlZmF1bHQuZ2V0KGRlc2NyaXB0b3IsICdzb3J0RmllbGQnLCAnJyksCiAgICAgIHNvcnRPcmRlcjogX2xvZGFzaC5kZWZhdWx0LmdldChkZXNjcmlwdG9yLCAnc29ydE9yZGVyJywgX2NvbnN0YW50cy5TT1JUX09SREVSLkRFU0MpLAogICAgICBzY2FsaW5nVHlwZTogX2xvZGFzaC5kZWZhdWx0LmdldChkZXNjcmlwdG9yLCAnc2NhbGluZ1R5cGUnLCBfY29uc3RhbnRzLlNDQUxJTkdfVFlQRVMuTElNSVQpLAogICAgICB0b3BIaXRzU3BsaXRGaWVsZDogZGVzY3JpcHRvci50b3BIaXRzU3BsaXRGaWVsZCwKICAgICAgdG9wSGl0c1NpemU6IF9sb2Rhc2guZGVmYXVsdC5nZXQoZGVzY3JpcHRvciwgJ3RvcEhpdHNTaXplJywgMSkKICAgIH0pLCBpbnNwZWN0b3JBZGFwdGVycykpOwogICAgX3RoaXMuX3Rvb2x0aXBGaWVsZHMgPSBfdGhpcy5fZGVzY3JpcHRvci50b29sdGlwUHJvcGVydGllcy5tYXAoZnVuY3Rpb24gKHByb3BlcnR5KSB7CiAgICAgIHJldHVybiBfdGhpcy5jcmVhdGVGaWVsZCh7CiAgICAgICAgZmllbGROYW1lOiBwcm9wZXJ0eQogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEVTU2VhcmNoU291cmNlLCBbewogICAga2V5OiAiY3JlYXRlRGVmYXVsdExheWVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0TGF5ZXIob3B0aW9ucywgbWFwQ29sb3JzKSB7CiAgICAgIGlmICh0aGlzLl9kZXNjcmlwdG9yLnNjYWxpbmdUeXBlID09PSBfY29uc3RhbnRzLlNDQUxJTkdfVFlQRVMuQ0xVU1RFUlMpIHsKICAgICAgICB2YXIgX2xheWVyRGVzY3JpcHRvciA9IF9ibGVuZGVkX3ZlY3Rvcl9sYXllci5CbGVuZGVkVmVjdG9yTGF5ZXIuY3JlYXRlRGVzY3JpcHRvcihfb2JqZWN0U3ByZWFkKHsKICAgICAgICAgIHNvdXJjZURlc2NyaXB0b3I6IHRoaXMuX2Rlc2NyaXB0b3IKICAgICAgICB9LCBvcHRpb25zKSwgbWFwQ29sb3JzKTsKCiAgICAgICAgdmFyIF9zdHlsZSA9IG5ldyBfdmVjdG9yX3N0eWxlLlZlY3RvclN0eWxlKF9sYXllckRlc2NyaXB0b3Iuc3R5bGUsIHRoaXMpOwoKICAgICAgICByZXR1cm4gbmV3IF9ibGVuZGVkX3ZlY3Rvcl9sYXllci5CbGVuZGVkVmVjdG9yTGF5ZXIoewogICAgICAgICAgbGF5ZXJEZXNjcmlwdG9yOiBfbGF5ZXJEZXNjcmlwdG9yLAogICAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgICAgc3R5bGU6IF9zdHlsZQogICAgICAgIH0pOwogICAgICB9CgogICAgICB2YXIgbGF5ZXJEZXNjcmlwdG9yID0gdGhpcy5fY3JlYXRlRGVmYXVsdExheWVyRGVzY3JpcHRvcihvcHRpb25zLCBtYXBDb2xvcnMpOwoKICAgICAgdmFyIHN0eWxlID0gbmV3IF92ZWN0b3Jfc3R5bGUuVmVjdG9yU3R5bGUobGF5ZXJEZXNjcmlwdG9yLnN0eWxlLCB0aGlzKTsKICAgICAgcmV0dXJuIG5ldyBfdmVjdG9yX2xheWVyLlZlY3RvckxheWVyKHsKICAgICAgICBsYXllckRlc2NyaXB0b3I6IGxheWVyRGVzY3JpcHRvciwKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgc3R5bGU6IHN0eWxlCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUZpZWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVGaWVsZChfcmVmMikgewogICAgICB2YXIgZmllbGROYW1lID0gX3JlZjIuZmllbGROYW1lOwogICAgICByZXR1cm4gbmV3IF9lc19kb2NfZmllbGQuRVNEb2NGaWVsZCh7CiAgICAgICAgZmllbGROYW1lOiBmaWVsZE5hbWUsCiAgICAgICAgc291cmNlOiB0aGlzCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclNvdXJjZVNldHRpbmdzRWRpdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJTb3VyY2VTZXR0aW5nc0VkaXRvcihfcmVmMykgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBvbkNoYW5nZSA9IF9yZWYzLm9uQ2hhbmdlOwoKICAgICAgdmFyIGdldEdlb0ZpZWxkID0gZnVuY3Rpb24gZ2V0R2VvRmllbGQoKSB7CiAgICAgICAgcmV0dXJuIF90aGlzMi5fZ2V0R2VvRmllbGQoKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF91cGRhdGVfc291cmNlX2VkaXRvci5VcGRhdGVTb3VyY2VFZGl0b3IsIHsKICAgICAgICBzb3VyY2U6IHRoaXMsCiAgICAgICAgaW5kZXhQYXR0ZXJuSWQ6IHRoaXMuZ2V0SW5kZXhQYXR0ZXJuSWQoKSwKICAgICAgICBnZXRHZW9GaWVsZDogZ2V0R2VvRmllbGQsCiAgICAgICAgb25DaGFuZ2U6IG9uQ2hhbmdlLAogICAgICAgIHRvb2x0aXBGaWVsZHM6IHRoaXMuX3Rvb2x0aXBGaWVsZHMsCiAgICAgICAgc29ydEZpZWxkOiB0aGlzLl9kZXNjcmlwdG9yLnNvcnRGaWVsZCwKICAgICAgICBzb3J0T3JkZXI6IHRoaXMuX2Rlc2NyaXB0b3Iuc29ydE9yZGVyLAogICAgICAgIHNjYWxpbmdUeXBlOiB0aGlzLl9kZXNjcmlwdG9yLnNjYWxpbmdUeXBlLAogICAgICAgIGZpbHRlckJ5TWFwQm91bmRzOiB0aGlzLmlzRmlsdGVyQnlNYXBCb3VuZHMoKSwKICAgICAgICB0b3BIaXRzU3BsaXRGaWVsZDogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU3BsaXRGaWVsZCwKICAgICAgICB0b3BIaXRzU2l6ZTogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU2l6ZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRGaWVsZHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRGaWVsZHMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGluZGV4UGF0dGVybi5maWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgZmllbGRkYXRhIGlzIGVuYWJsZWQgZm9yIGZpZWxkLgogICAgICAgICAgICAgICAgICAvLyBTZWFyY2ggZG9lcyBub3QgcmVxdWVzdCBfc291cmNlCiAgICAgICAgICAgICAgICAgIHJldHVybiBmaWVsZC5hZ2dyZWdhdGFibGU7CiAgICAgICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczMuY3JlYXRlRmllbGQoewogICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDApOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgW10pOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcywgW1swLCA3XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgICAgcmV0dXJuIF9nZXRGaWVsZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldEZpZWxkczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEZpZWxkTmFtZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkTmFtZXMoKSB7CiAgICAgIHJldHVybiBbdGhpcy5fZGVzY3JpcHRvci5nZW9GaWVsZF07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SW1tdXRhYmxlUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEltbXV0YWJsZVByb3BlcnRpZXMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuVGl0bGUsIGdlb0ZpZWxkVHlwZSwgaW5kZXhQYXR0ZXJuLCBnZW9GaWVsZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGUgPSB0aGlzLmdldEluZGV4UGF0dGVybklkKCk7CiAgICAgICAgICAgICAgICBnZW9GaWVsZFR5cGUgPSAnJzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVyblRpdGxlID0gaW5kZXhQYXR0ZXJuLnRpdGxlOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldEdlb0ZpZWxkKCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIGdlb0ZpZWxkID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBnZW9GaWVsZFR5cGUgPSBnZW9GaWVsZC50eXBlOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxMzsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgyKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBbewogICAgICAgICAgICAgICAgICBsYWJlbDogKDAsIF9pMThuX2dldHRlcnMuZ2V0RGF0YVNvdXJjZUxhYmVsKSgpLAogICAgICAgICAgICAgICAgICB2YWx1ZTogRVNTZWFyY2hTb3VyY2UudGl0bGUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaC5pbmRleFBhdHRlcm5MYWJlbCcsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IHBhdHRlcm4iCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICB2YWx1ZTogaW5kZXhQYXR0ZXJuVGl0bGUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc1NlYXJjaC5nZW9GaWVsZExhYmVsJywgewogICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnR2Vvc3BhdGlhbCBmaWVsZCcKICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLl9kZXNjcmlwdG9yLmdlb0ZpZWxkCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2guZ2VvRmllbGRUeXBlTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdHZW9zcGF0aWFsIGZpZWxkIHR5cGUnCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICB2YWx1ZTogZ2VvRmllbGRUeXBlCiAgICAgICAgICAgICAgICB9XSk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMsIFtbMiwgMTNdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEltbXV0YWJsZVByb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJuIF9nZXRJbW11dGFibGVQcm9wZXJ0aWVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRJbW11dGFibGVQcm9wZXJ0aWVzOwogICAgfSgpIC8vIFJldHVybnMgc29ydCBjb250ZW50IGZvciBhbiBFbGFzdGljc2VhcmNoIHNlYXJjaCBib2R5CgogIH0sIHsKICAgIGtleTogIl9idWlsZEVzU29ydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2J1aWxkRXNTb3J0KCkgewogICAgICB2YXIgX3RoaXMkX2Rlc2NyaXB0b3IgPSB0aGlzLl9kZXNjcmlwdG9yLAogICAgICAgICAgc29ydEZpZWxkID0gX3RoaXMkX2Rlc2NyaXB0b3Iuc29ydEZpZWxkLAogICAgICAgICAgc29ydE9yZGVyID0gX3RoaXMkX2Rlc2NyaXB0b3Iuc29ydE9yZGVyOwogICAgICByZXR1cm4gW19kZWZpbmVQcm9wZXJ0eSh7fSwgc29ydEZpZWxkLCB7CiAgICAgICAgb3JkZXI6IHNvcnRPcmRlcgogICAgICB9KV07CiAgICB9CiAgfSwgewogICAga2V5OiAiX2dldFRvcEhpdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRUb3BIaXRzMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGxheWVyTmFtZSwgc2VhcmNoRmlsdGVycywgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaykgewogICAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvcjIsIHRvcEhpdHNTcGxpdEZpZWxkTmFtZSwgdG9wSGl0c1NpemUsIGluZGV4UGF0dGVybiwgX2dldERvY1ZhbHVlQW5kU291cmNlLCBkb2NWYWx1ZUZpZWxkcywgc291cmNlT25seUZpZWxkcywgc2NyaXB0RmllbGRzLCB0b3BIaXRzLCB0b3BIaXRzU3BsaXRGaWVsZCwgY2FyZGluYWxpdHlBZ2csIHRlcm1zQWdnLCBzZWFyY2hTb3VyY2UsIHJlc3AsIGFsbEhpdHMsIGVudGl0eUJ1Y2tldHMsIHRvdGFsRW50aXRpZXMsIGFyZUVudGl0aWVzVHJpbW1lZCwgYXJlVG9wSGl0c1RyaW1tZWQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpcyRfZGVzY3JpcHRvcjIgPSB0aGlzLl9kZXNjcmlwdG9yLCB0b3BIaXRzU3BsaXRGaWVsZE5hbWUgPSBfdGhpcyRfZGVzY3JpcHRvcjIudG9wSGl0c1NwbGl0RmllbGQsIHRvcEhpdHNTaXplID0gX3RoaXMkX2Rlc2NyaXB0b3IyLnRvcEhpdHNTaXplOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW5kZXhQYXR0ZXJuKCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgX2dldERvY1ZhbHVlQW5kU291cmNlID0gZ2V0RG9jVmFsdWVBbmRTb3VyY2VGaWVsZHMoaW5kZXhQYXR0ZXJuLCBzZWFyY2hGaWx0ZXJzLmZpZWxkTmFtZXMpLCBkb2NWYWx1ZUZpZWxkcyA9IF9nZXREb2NWYWx1ZUFuZFNvdXJjZS5kb2NWYWx1ZUZpZWxkcywgc291cmNlT25seUZpZWxkcyA9IF9nZXREb2NWYWx1ZUFuZFNvdXJjZS5zb3VyY2VPbmx5RmllbGRzLCBzY3JpcHRGaWVsZHMgPSBfZ2V0RG9jVmFsdWVBbmRTb3VyY2Uuc2NyaXB0RmllbGRzOwogICAgICAgICAgICAgICAgdG9wSGl0cyA9IHsKICAgICAgICAgICAgICAgICAgc2l6ZTogdG9wSGl0c1NpemUsCiAgICAgICAgICAgICAgICAgIHNjcmlwdF9maWVsZHM6IHNjcmlwdEZpZWxkcywKICAgICAgICAgICAgICAgICAgZG9jdmFsdWVfZmllbGRzOiBkb2NWYWx1ZUZpZWxkcwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5faGFzU29ydCgpKSB7CiAgICAgICAgICAgICAgICAgIHRvcEhpdHMuc29ydCA9IHRoaXMuX2J1aWxkRXNTb3J0KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHNvdXJjZU9ubHlGaWVsZHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHRvcEhpdHMuX3NvdXJjZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdG9wSGl0cy5fc291cmNlID0gewogICAgICAgICAgICAgICAgICAgIGluY2x1ZGVzOiBzb3VyY2VPbmx5RmllbGRzCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG9wSGl0c1NwbGl0RmllbGQgPSAoMCwgX2VzX2FnZ191dGlscy5nZXRGaWVsZCkoaW5kZXhQYXR0ZXJuLCB0b3BIaXRzU3BsaXRGaWVsZE5hbWUpOwogICAgICAgICAgICAgICAgY2FyZGluYWxpdHlBZ2cgPSB7CiAgICAgICAgICAgICAgICAgIHByZWNpc2lvbl90aHJlc2hvbGQ6IDEKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB0ZXJtc0FnZyA9IHsKICAgICAgICAgICAgICAgICAgc2l6ZTogX2NvbnN0YW50cy5ERUZBVUxUX01BWF9CVUNLRVRTX0xJTUlULAogICAgICAgICAgICAgICAgICBzaGFyZF9zaXplOiBfY29uc3RhbnRzLkRFRkFVTFRfTUFYX0JVQ0tFVFNfTElNSVQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZVNlYXJjaFNvdXJjZShzZWFyY2hGaWx0ZXJzLCAwKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdhZ2dzJywgewogICAgICAgICAgICAgICAgICB0b3RhbEVudGl0aWVzOiB7CiAgICAgICAgICAgICAgICAgICAgY2FyZGluYWxpdHk6ICgwLCBfZXNfYWdnX3V0aWxzLmFkZEZpZWxkVG9EU0wpKGNhcmRpbmFsaXR5QWdnLCB0b3BIaXRzU3BsaXRGaWVsZCkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgZW50aXR5U3BsaXQ6IHsKICAgICAgICAgICAgICAgICAgICB0ZXJtczogKDAsIF9lc19hZ2dfdXRpbHMuYWRkRmllbGRUb0RTTCkodGVybXNBZ2csIHRvcEhpdHNTcGxpdEZpZWxkKSwKICAgICAgICAgICAgICAgICAgICBhZ2dzOiB7CiAgICAgICAgICAgICAgICAgICAgICBlbnRpdHlIaXRzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRvcF9oaXRzOiB0b3BIaXRzCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVuRXNRdWVyeSh7CiAgICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogdGhpcy5nZXRJZCgpLAogICAgICAgICAgICAgICAgICByZXF1ZXN0TmFtZTogbGF5ZXJOYW1lLAogICAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2U6IHNlYXJjaFNvdXJjZSwKICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjazogcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaywKICAgICAgICAgICAgICAgICAgcmVxdWVzdERlc2NyaXB0aW9uOiAnRWxhc3RpY3NlYXJjaCBkb2N1bWVudCB0b3AgaGl0cyByZXF1ZXN0JwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBhbGxIaXRzID0gW107CiAgICAgICAgICAgICAgICBlbnRpdHlCdWNrZXRzID0gX2xvZGFzaC5kZWZhdWx0LmdldChyZXNwLCAnYWdncmVnYXRpb25zLmVudGl0eVNwbGl0LmJ1Y2tldHMnLCBbXSk7CiAgICAgICAgICAgICAgICB0b3RhbEVudGl0aWVzID0gX2xvZGFzaC5kZWZhdWx0LmdldChyZXNwLCAnYWdncmVnYXRpb25zLnRvdGFsRW50aXRpZXMudmFsdWUnLCAwKTsgLy8gY2FuIG5vdCBjb21wYXJlIGVudGl0eUJ1Y2tldHMubGVuZ3RoIHRvIHRvdGFsRW50aXRpZXMgYmVjYXVzZSB0b3RhbEVudGl0aWVzIGlzIGFuIGFwcHJveGltYXRlCgogICAgICAgICAgICAgICAgYXJlRW50aXRpZXNUcmltbWVkID0gZW50aXR5QnVja2V0cy5sZW5ndGggPj0gX2NvbnN0YW50cy5ERUZBVUxUX01BWF9CVUNLRVRTX0xJTUlUOwogICAgICAgICAgICAgICAgYXJlVG9wSGl0c1RyaW1tZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGVudGl0eUJ1Y2tldHMuZm9yRWFjaChmdW5jdGlvbiAoZW50aXR5QnVja2V0KSB7CiAgICAgICAgICAgICAgICAgIHZhciB0b3RhbCA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoZW50aXR5QnVja2V0LCAnZW50aXR5SGl0cy5oaXRzLnRvdGFsJywgMCk7CgogICAgICAgICAgICAgICAgICB2YXIgaGl0cyA9IF9sb2Rhc2guZGVmYXVsdC5nZXQoZW50aXR5QnVja2V0LCAnZW50aXR5SGl0cy5oaXRzLmhpdHMnLCBbXSk7IC8vIFJldmVyc2UgaGl0cyBsaXN0IHNvIHRvcCBkb2N1bWVudHMgYnkgc29ydCBhcmUgZHJhd24gb24gdG9wCgoKICAgICAgICAgICAgICAgICAgYWxsSGl0cy5wdXNoLmFwcGx5KGFsbEhpdHMsIF90b0NvbnN1bWFibGVBcnJheShoaXRzLnJldmVyc2UoKSkpOwoKICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gaGl0cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBhcmVUb3BIaXRzVHJpbW1lZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgaGl0czogYWxsSGl0cywKICAgICAgICAgICAgICAgICAgbWV0YTogewogICAgICAgICAgICAgICAgICAgIGFyZVJlc3VsdHNUcmltbWVkOiBhcmVFbnRpdGllc1RyaW1tZWQgfHwgYXJlVG9wSGl0c1RyaW1tZWQsCiAgICAgICAgICAgICAgICAgICAgLy8gdXNlZCB0byBmb3JjZSByZS1mZXRjaCB3aGVuIHpvb21pbmcgaW4KICAgICAgICAgICAgICAgICAgICBhcmVFbnRpdGllc1RyaW1tZWQ6IGFyZUVudGl0aWVzVHJpbW1lZCwKICAgICAgICAgICAgICAgICAgICBlbnRpdHlDb3VudDogZW50aXR5QnVja2V0cy5sZW5ndGgsCiAgICAgICAgICAgICAgICAgICAgdG90YWxFbnRpdGllczogdG90YWxFbnRpdGllcwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9nZXRUb3BIaXRzKF94LCBfeDIsIF94MykgewogICAgICAgIHJldHVybiBfZ2V0VG9wSGl0czIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9nZXRUb3BIaXRzOwogICAgfSgpIC8vIHNlYXJjaEZpbHRlcnMuZmllbGROYW1lcyBjb250YWlucyBnZW8gZmllbGQgYW5kIGFueSBmaWVsZHMgbmVlZGVkIGZvciBzdHlsaW5nIGZlYXR1cmVzCiAgICAvLyBQZXJmb3JtcyBFbGFzdGljc2VhcmNoIHNlYXJjaCByZXF1ZXN0IGJlaW5nIGNhcmVmdWwgdG8gcHVsbCBiYWNrIG9ubHkgcmVxdWlyZWQgZmllbGRzIHRvIG1pbmltaXplIHJlc3BvbnNlIHNpemUKCiAgfSwgewogICAga2V5OiAiX2dldFNlYXJjaEhpdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRTZWFyY2hIaXRzMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGxheWVyTmFtZSwgc2VhcmNoRmlsdGVycywgbWF4UmVzdWx0V2luZG93LCByZWdpc3RlckNhbmNlbENhbGxiYWNrKSB7CiAgICAgICAgdmFyIGluZGV4UGF0dGVybiwgX2dldERvY1ZhbHVlQW5kU291cmNlMiwgZG9jVmFsdWVGaWVsZHMsIHNvdXJjZU9ubHlGaWVsZHMsIGluaXRpYWxTZWFyY2hDb250ZXh0LCBzZWFyY2hTb3VyY2UsIHJlc3A7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfZ2V0RG9jVmFsdWVBbmRTb3VyY2UyID0gZ2V0RG9jVmFsdWVBbmRTb3VyY2VGaWVsZHMoaW5kZXhQYXR0ZXJuLCBzZWFyY2hGaWx0ZXJzLmZpZWxkTmFtZXMpLCBkb2NWYWx1ZUZpZWxkcyA9IF9nZXREb2NWYWx1ZUFuZFNvdXJjZTIuZG9jVmFsdWVGaWVsZHMsIHNvdXJjZU9ubHlGaWVsZHMgPSBfZ2V0RG9jVmFsdWVBbmRTb3VyY2UyLnNvdXJjZU9ubHlGaWVsZHM7CiAgICAgICAgICAgICAgICBpbml0aWFsU2VhcmNoQ29udGV4dCA9IHsKICAgICAgICAgICAgICAgICAgZG9jdmFsdWVfZmllbGRzOiBkb2NWYWx1ZUZpZWxkcwogICAgICAgICAgICAgICAgfTsgLy8gUmVxdWVzdCBmaWVsZHMgaW4gZG9jdmFsdWVfZmllbGRzIGluc3RlZCBvZiBfc291cmNlCgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWFrZVNlYXJjaFNvdXJjZShzZWFyY2hGaWx0ZXJzLCBtYXhSZXN1bHRXaW5kb3csIGluaXRpYWxTZWFyY2hDb250ZXh0KTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2ZpZWxkcycsIHNlYXJjaEZpbHRlcnMuZmllbGROYW1lcyk7IC8vIFNldHRpbmcgImZpZWxkcyIgZmlsdGVycyBvdXQgdW51c2VkIHNjcmlwdGVkIGZpZWxkcwoKICAgICAgICAgICAgICAgIGlmIChzb3VyY2VPbmx5RmllbGRzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3NvdXJjZScsIGZhbHNlKTsgLy8gZG8gbm90IG5lZWQgYW55dGhpbmcgZnJvbSBfc291cmNlCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3NvdXJjZScsIHNvdXJjZU9ubHlGaWVsZHMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0aGlzLl9oYXNTb3J0KCkpIHsKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdzb3J0JywgdGhpcy5fYnVpbGRFc1NvcnQoKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9ydW5Fc1F1ZXJ5KHsKICAgICAgICAgICAgICAgICAgcmVxdWVzdElkOiB0aGlzLmdldElkKCksCiAgICAgICAgICAgICAgICAgIHJlcXVlc3ROYW1lOiBsYXllck5hbWUsCiAgICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICAgICAgICAgICAgICByZWdpc3RlckNhbmNlbENhbGxiYWNrOiByZWdpc3RlckNhbmNlbENhbGxiYWNrLAogICAgICAgICAgICAgICAgICByZXF1ZXN0RGVzY3JpcHRpb246ICdFbGFzdGljc2VhcmNoIGRvY3VtZW50IHJlcXVlc3QnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJlc3AgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIGhpdHM6IHJlc3AuaGl0cy5oaXRzLnJldmVyc2UoKSwKICAgICAgICAgICAgICAgICAgLy8gUmV2ZXJzZSBoaXRzIHNvIHRvcCBkb2N1bWVudHMgYnkgc29ydCBhcmUgZHJhd24gb24gdG9wCiAgICAgICAgICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogcmVzcC5oaXRzLnRvdGFsID4gcmVzcC5oaXRzLmhpdHMubGVuZ3RoCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX2dldFNlYXJjaEhpdHMoX3g0LCBfeDUsIF94NiwgX3g3KSB7CiAgICAgICAgcmV0dXJuIF9nZXRTZWFyY2hIaXRzMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX2dldFNlYXJjaEhpdHM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfaXNUb3BIaXRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfaXNUb3BIaXRzKCkgewogICAgICB2YXIgX3RoaXMkX2Rlc2NyaXB0b3IzID0gdGhpcy5fZGVzY3JpcHRvciwKICAgICAgICAgIHNjYWxpbmdUeXBlID0gX3RoaXMkX2Rlc2NyaXB0b3IzLnNjYWxpbmdUeXBlLAogICAgICAgICAgdG9wSGl0c1NwbGl0RmllbGQgPSBfdGhpcyRfZGVzY3JpcHRvcjMudG9wSGl0c1NwbGl0RmllbGQ7CiAgICAgIHJldHVybiAhIShzY2FsaW5nVHlwZSA9PT0gX2NvbnN0YW50cy5TQ0FMSU5HX1RZUEVTLlRPUF9ISVRTICYmIHRvcEhpdHNTcGxpdEZpZWxkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfaGFzU29ydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2hhc1NvcnQoKSB7CiAgICAgIHZhciBfdGhpcyRfZGVzY3JpcHRvcjQgPSB0aGlzLl9kZXNjcmlwdG9yLAogICAgICAgICAgc29ydEZpZWxkID0gX3RoaXMkX2Rlc2NyaXB0b3I0LnNvcnRGaWVsZCwKICAgICAgICAgIHNvcnRPcmRlciA9IF90aGlzJF9kZXNjcmlwdG9yNC5zb3J0T3JkZXI7CiAgICAgIHJldHVybiAhIXNvcnRGaWVsZCAmJiAhIXNvcnRPcmRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRNYXhSZXN1bHRXaW5kb3ciLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRNYXhSZXN1bHRXaW5kb3cgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuLCBpbmRleFNldHRpbmdzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9sb2FkX2luZGV4X3NldHRpbmdzLmxvYWRJbmRleFNldHRpbmdzKShpbmRleFBhdHRlcm4udGl0bGUpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpbmRleFNldHRpbmdzID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgaW5kZXhTZXR0aW5ncy5tYXhSZXN1bHRXaW5kb3cpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRNYXhSZXN1bHRXaW5kb3coKSB7CiAgICAgICAgcmV0dXJuIF9nZXRNYXhSZXN1bHRXaW5kb3cuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldE1heFJlc3VsdFdpbmRvdzsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEdlb0pzb25XaXRoTWV0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEdlb0pzb25XaXRoTWV0YSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KGxheWVyTmFtZSwgc2VhcmNoRmlsdGVycywgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjaykgewogICAgICAgIHZhciBpbmRleFBhdHRlcm4sIGluZGV4U2V0dGluZ3MsIF9yZWY1LCBoaXRzLCBtZXRhLCB1bnVzZWRNZXRhRmllbGRzLCBmbGF0dGVuSGl0LCBmZWF0dXJlQ29sbGVjdGlvbiwgZ2VvRmllbGQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9sb2FkX2luZGV4X3NldHRpbmdzLmxvYWRJbmRleFNldHRpbmdzKShpbmRleFBhdHRlcm4udGl0bGUpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBpbmRleFNldHRpbmdzID0gX2NvbnRleHQ2LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pc1RvcEhpdHMoKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0VG9wSGl0cyhsYXllck5hbWUsIHNlYXJjaEZpbHRlcnMsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2spOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0U2VhcmNoSGl0cyhsYXllck5hbWUsIHNlYXJjaEZpbHRlcnMsIGluZGV4U2V0dGluZ3MubWF4UmVzdWx0V2luZG93LCByZWdpc3RlckNhbmNlbENhbGxiYWNrKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni50MCA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgICAgX3JlZjUgPSBfY29udGV4dDYudDA7CiAgICAgICAgICAgICAgICBoaXRzID0gX3JlZjUuaGl0czsKICAgICAgICAgICAgICAgIG1ldGEgPSBfcmVmNS5tZXRhOwogICAgICAgICAgICAgICAgdW51c2VkTWV0YUZpZWxkcyA9IGluZGV4UGF0dGVybi5tZXRhRmllbGRzLmZpbHRlcihmdW5jdGlvbiAobWV0YUZpZWxkKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiAhWydfaWQnLCAnX2luZGV4J10uaW5jbHVkZXMobWV0YUZpZWxkKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGZsYXR0ZW5IaXQgPSBmdW5jdGlvbiBmbGF0dGVuSGl0KGhpdCkgewogICAgICAgICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IGluZGV4UGF0dGVybi5mbGF0dGVuSGl0KGhpdCk7IC8vIHJlbW92ZSBtZXRhRmllbGRzCgogICAgICAgICAgICAgICAgICB1bnVzZWRNZXRhRmllbGRzLmZvckVhY2goZnVuY3Rpb24gKG1ldGFGaWVsZCkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwcm9wZXJ0aWVzW21ldGFGaWVsZF07CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydGllczsKICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAyMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0R2VvRmllbGQoKTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgIGdlb0ZpZWxkID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBmZWF0dXJlQ29sbGVjdGlvbiA9ICgwLCBfZWxhc3RpY3NlYXJjaF9nZW9fdXRpbHMuaGl0c1RvR2VvSnNvbikoaGl0cywgZmxhdHRlbkhpdCwgZ2VvRmllbGQubmFtZSwgZ2VvRmllbGQudHlwZSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDMwOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjc6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDI3OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQxID0gX2NvbnRleHQ2WyJjYXRjaCJdKDIwKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2guY29udmVydFRvR2VvSnNvbkVycm9yTXNnJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuYWJsZSB0byBjb252ZXJ0IHNlYXJjaCByZXNwb25zZSB0byBnZW9Kc29uIGZlYXR1cmUgY29sbGVjdGlvbiwgZXJyb3I6IHtlcnJvck1zZ30nLAogICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICBlcnJvck1zZzogX2NvbnRleHQ2LnQxLm1lc3NhZ2UKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgZGF0YTogZmVhdHVyZUNvbGxlY3Rpb24sCiAgICAgICAgICAgICAgICAgIG1ldGE6IF9vYmplY3RTcHJlYWQoe30sIG1ldGEsIHsKICAgICAgICAgICAgICAgICAgICBzb3VyY2VUeXBlOiBfY29uc3RhbnRzLkVTX1NFQVJDSAogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMsIFtbMjAsIDI3XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRHZW9Kc29uV2l0aE1ldGEoX3g4LCBfeDksIF94MTApIHsKICAgICAgICByZXR1cm4gX2dldEdlb0pzb25XaXRoTWV0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0R2VvSnNvbldpdGhNZXRhOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY2FuRm9ybWF0RmVhdHVyZVByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNhbkZvcm1hdEZlYXR1cmVQcm9wZXJ0aWVzKCkgewogICAgICByZXR1cm4gdGhpcy5fdG9vbHRpcEZpZWxkcy5sZW5ndGggPiAwOwogICAgfQogIH0sIHsKICAgIGtleTogIl9sb2FkVG9vbHRpcFByb3BlcnRpZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9sb2FkVG9vbHRpcFByb3BlcnRpZXMyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoZG9jSWQsIGluZGV4LCBpbmRleFBhdHRlcm4pIHsKICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgdmFyIHNlYXJjaFNvdXJjZSwgcXVlcnksIHJlc3AsIGhpdCwgcHJvcGVydGllczsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCEodGhpcy5fdG9vbHRpcEZpZWxkcy5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIHt9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlID0gbmV3IF9raWJhbmFfc2VydmljZXMuU2VhcmNoU291cmNlKCk7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2luZGV4JywgaW5kZXhQYXR0ZXJuKTsKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnc2l6ZScsIDEpOwogICAgICAgICAgICAgICAgcXVlcnkgPSB7CiAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAna3VlcnknLAogICAgICAgICAgICAgICAgICBxdWVyeTogIl9pZDpcIiIuY29uY2F0KGRvY0lkLCAiXCIgYW5kIF9pbmRleDpcIiIpLmNvbmNhdChpbmRleCwgIlwiIikKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3F1ZXJ5JywgcXVlcnkpOwogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWVsZHMnLCB0aGlzLl9nZXRUb29sdGlwUHJvcGVydHlOYW1lcygpKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICByZXR1cm4gc2VhcmNoU291cmNlLmZldGNoKCk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXNwID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICBoaXQgPSBfbG9kYXNoLmRlZmF1bHQuZ2V0KHJlc3AsICdoaXRzLmhpdHNbMF0nKTsKCiAgICAgICAgICAgICAgICBpZiAoaGl0KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2gubG9hZFRvb2x0aXBQcm9wZXJ0aWVzRXJyb3JNc2cnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVW5hYmxlIHRvIGZpbmQgZG9jdW1lbnQsIF9pZDoge2RvY0lkfScsCiAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgIGRvY0lkOiBkb2NJZAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gaW5kZXhQYXR0ZXJuLmZsYXR0ZW5IaXQoaGl0KTsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5tZXRhRmllbGRzLmZvckVhY2goZnVuY3Rpb24gKG1ldGFGaWVsZCkgewogICAgICAgICAgICAgICAgICBpZiAoIV90aGlzNC5fZ2V0VG9vbHRpcFByb3BlcnR5TmFtZXMoKS5pbmNsdWRlcyhtZXRhRmllbGQpKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHByb3BlcnRpZXNbbWV0YUZpZWxkXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgcHJvcGVydGllcyk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfbG9hZFRvb2x0aXBQcm9wZXJ0aWVzKF94MTEsIF94MTIsIF94MTMpIHsKICAgICAgICByZXR1cm4gX2xvYWRUb29sdGlwUHJvcGVydGllczIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9sb2FkVG9vbHRpcFByb3BlcnRpZXM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJmaWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZmlsdGVyQW5kRm9ybWF0UHJvcGVydGllc1RvSHRtbCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KHByb3BlcnRpZXMpIHsKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuLCBwcm9wZXJ0eVZhbHVlcywgdG9vbHRpcFByb3BlcnRpZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9sb2FkVG9vbHRpcFByb3BlcnRpZXMocHJvcGVydGllcy5faWQsIHByb3BlcnRpZXMuX2luZGV4LCBpbmRleFBhdHRlcm4pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlcyA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgdG9vbHRpcFByb3BlcnRpZXMgPSB0aGlzLl90b29sdGlwRmllbGRzLm1hcChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcHJvcGVydHlWYWx1ZXNbZmllbGQuZ2V0TmFtZSgpXTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkLmNyZWF0ZVRvb2x0aXBQcm9wZXJ0eSh2YWx1ZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLmFsbCh0b29sdGlwUHJvcGVydGllcykpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sKF94MTQpIHsKICAgICAgICByZXR1cm4gX2ZpbHRlckFuZEZvcm1hdFByb3BlcnRpZXNUb0h0bWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZpbHRlckFuZEZvcm1hdFByb3BlcnRpZXNUb0h0bWw7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJpc0ZpbHRlckJ5TWFwQm91bmRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0ZpbHRlckJ5TWFwQm91bmRzKCkgewogICAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRvci5zY2FsaW5nVHlwZSA9PT0gX2NvbnN0YW50cy5TQ0FMSU5HX1RZUEVTLkNMVVNURVIgPyB0cnVlIDogdGhpcy5fZGVzY3JpcHRvci5maWx0ZXJCeU1hcEJvdW5kczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMZWZ0Sm9pbkZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldExlZnRKb2luRmllbGRzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICAgIHZhciBpbmRleFBhdHRlcm47CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCAoMCwgX2luZGV4X3BhdHRlcm5fdXRpbC5nZXRTb3VyY2VGaWVsZHMpKGluZGV4UGF0dGVybi5maWVsZHMpLm1hcChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzNS5jcmVhdGVGaWVsZCh7CiAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRMZWZ0Sm9pbkZpZWxkcygpIHsKICAgICAgICByZXR1cm4gX2dldExlZnRKb2luRmllbGRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRMZWZ0Sm9pbkZpZWxkczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldFN1cHBvcnRlZFNoYXBlVHlwZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRTdXBwb3J0ZWRTaGFwZVR5cGVzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKCkgewogICAgICAgIHZhciBnZW9GaWVsZFR5cGUsIGdlb0ZpZWxkOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0R2VvRmllbGQoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgZ2VvRmllbGQgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBnZW9GaWVsZFR5cGUgPSBnZW9GaWVsZC50eXBlOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLnByZXYgPSA3OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMC50MCA9IF9jb250ZXh0MTBbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIGlmICghKGdlb0ZpZWxkVHlwZSA9PT0gX2NvbnN0YW50cy5FU19HRU9fRklFTERfVFlQRS5HRU9fUE9JTlQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDExOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIFtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPSU5UXSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIFtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPSU5ULCBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLkxJTkUsIF92ZWN0b3JfZmVhdHVyZV90eXBlcy5WRUNUT1JfU0hBUEVfVFlQRVMuUE9MWUdPTl0pOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTAsIHRoaXMsIFtbMCwgN11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0U3VwcG9ydGVkU2hhcGVUeXBlcygpIHsKICAgICAgICByZXR1cm4gX2dldFN1cHBvcnRlZFNoYXBlVHlwZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldFN1cHBvcnRlZFNoYXBlVHlwZXM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJnZXRTb3VyY2VUb29sdGlwQ29udGVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U291cmNlVG9vbHRpcENvbnRlbnQoc291cmNlRGF0YVJlcXVlc3QpIHsKICAgICAgdmFyIGZlYXR1cmVDb2xsZWN0aW9uID0gc291cmNlRGF0YVJlcXVlc3QgPyBzb3VyY2VEYXRhUmVxdWVzdC5nZXREYXRhKCkgOiBudWxsOwogICAgICB2YXIgbWV0YSA9IHNvdXJjZURhdGFSZXF1ZXN0ID8gc291cmNlRGF0YVJlcXVlc3QuZ2V0TWV0YSgpIDogbnVsbDsKCiAgICAgIGlmICghZmVhdHVyZUNvbGxlY3Rpb24gfHwgIW1ldGEpIHsKICAgICAgICAvLyBubyB0b29sdGlwIGNvbnRlbnQgbmVlZGVkIHdoZW4gdGhlcmUgaXMgbm8gZmVhdHVyZSBjb2xsZWN0aW9uIG9yIG1ldGEKICAgICAgICByZXR1cm4gewogICAgICAgICAgdG9vbHRpcENvbnRlbnQ6IG51bGwsCiAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogZmFsc2UKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAodGhpcy5faXNUb3BIaXRzKCkpIHsKICAgICAgICB2YXIgZW50aXRpZXNGb3VuZE1zZyA9IG1ldGEuYXJlRW50aXRpZXNUcmltbWVkID8gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuZXNTZWFyY2gudG9wSGl0c1Jlc3VsdHNUcmltbWVkTXNnJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZXN1bHRzIGxpbWl0ZWQgdG8gZmlyc3Qge2VudGl0eUNvdW50fSBlbnRpdGllcyBvZiB+e3RvdGFsRW50aXRpZXN9LiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgZW50aXR5Q291bnQ6IG1ldGEuZW50aXR5Q291bnQsCiAgICAgICAgICAgIHRvdGFsRW50aXRpZXM6IG1ldGEudG90YWxFbnRpdGllcwogICAgICAgICAgfQogICAgICAgIH0pIDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuZXNTZWFyY2gudG9wSGl0c0VudGl0aWVzQ291bnRNc2cnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvdW5kIHtlbnRpdHlDb3VudH0gZW50aXRpZXMuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBlbnRpdHlDb3VudDogbWV0YS5lbnRpdHlDb3VudAogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICB2YXIgZG9jc1BlckVudGl0eU1zZyA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLmVzU2VhcmNoLnRvcEhpdHNTaXplTXNnJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTaG93aW5nIHRvcCB7dG9wSGl0c1NpemV9IGRvY3VtZW50cyBwZXIgZW50aXR5LiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgdG9wSGl0c1NpemU6IHRoaXMuX2Rlc2NyaXB0b3IudG9wSGl0c1NpemUKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHRvb2x0aXBDb250ZW50OiAiIi5jb25jYXQoZW50aXRpZXNGb3VuZE1zZywgIiAiKS5jb25jYXQoZG9jc1BlckVudGl0eU1zZyksCiAgICAgICAgICAvLyBVc2VkIHRvIHNob3cgdHJpbW1lZCBpY29uIGluIGxlZ2VuZAogICAgICAgICAgLy8gdXNlciBvbmx5IG5lZWRzIHRvIGJlIG5vdGlmaWVkIG9mIHRyaW1tZWQgcmVzdWx0cyB3aGVuIGVudGl0aWVzIGFyZSB0cmltbWVkCiAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogbWV0YS5hcmVFbnRpdGllc1RyaW1tZWQKICAgICAgICB9OwogICAgICB9CgogICAgICBpZiAobWV0YS5hcmVSZXN1bHRzVHJpbW1lZCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0b29sdGlwQ29udGVudDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuZXNTZWFyY2gucmVzdWx0c1RyaW1tZWRNc2cnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVzdWx0cyBsaW1pdGVkIHRvIGZpcnN0IHtjb3VudH0gZG9jdW1lbnRzLiIsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGNvdW50OiBmZWF0dXJlQ29sbGVjdGlvbi5mZWF0dXJlcy5sZW5ndGgKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogdHJ1ZQogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgdG9vbHRpcENvbnRlbnQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLmVzU2VhcmNoLmZlYXR1cmVDb3VudE1zZycsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRm91bmQge2NvdW50fSBkb2N1bWVudHMuIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBjb3VudDogZmVhdHVyZUNvbGxlY3Rpb24uZmVhdHVyZXMubGVuZ3RoCiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgYXJlUmVzdWx0c1RyaW1tZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0U3luY01ldGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN5bmNNZXRhKCkgewogICAgICByZXR1cm4gewogICAgICAgIHNvcnRGaWVsZDogdGhpcy5fZGVzY3JpcHRvci5zb3J0RmllbGQsCiAgICAgICAgc29ydE9yZGVyOiB0aGlzLl9kZXNjcmlwdG9yLnNvcnRPcmRlciwKICAgICAgICBzY2FsaW5nVHlwZTogdGhpcy5fZGVzY3JpcHRvci5zY2FsaW5nVHlwZSwKICAgICAgICB0b3BIaXRzU3BsaXRGaWVsZDogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU3BsaXRGaWVsZCwKICAgICAgICB0b3BIaXRzU2l6ZTogdGhpcy5fZGVzY3JpcHRvci50b3BIaXRzU2l6ZQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFByZUluZGV4ZWRTaGFwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldFByZUluZGV4ZWRTaGFwZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShwcm9wZXJ0aWVzKSB7CiAgICAgICAgdmFyIGdlb0ZpZWxkOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRHZW9GaWVsZCgpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBnZW9GaWVsZCA9IF9jb250ZXh0MTEuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBpbmRleDogcHJvcGVydGllcy5faW5kZXgsCiAgICAgICAgICAgICAgICAgIC8vIENhbiBub3QgdXNlIGluZGV4IHBhdHRlcm4gdGl0bGUgYmVjYXVzZSBpdCBtYXkgcmVmZXJlbmNlIG1hbnkgaW5kaWNlcwogICAgICAgICAgICAgICAgICBpZDogcHJvcGVydGllcy5faWQsCiAgICAgICAgICAgICAgICAgIHBhdGg6IGdlb0ZpZWxkLm5hbWUKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFByZUluZGV4ZWRTaGFwZShfeDE1KSB7CiAgICAgICAgcmV0dXJuIF9nZXRQcmVJbmRleGVkU2hhcGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldFByZUluZGV4ZWRTaGFwZTsKICAgIH0oKQogIH1dKTsKCiAgcmV0dXJuIEVTU2VhcmNoU291cmNlOwp9KF9lc19zb3VyY2UuQWJzdHJhY3RFU1NvdXJjZSk7CgpleHBvcnRzLkVTU2VhcmNoU291cmNlID0gRVNTZWFyY2hTb3VyY2U7CgpfZGVmaW5lUHJvcGVydHkoRVNTZWFyY2hTb3VyY2UsICJ0eXBlIiwgX2NvbnN0YW50cy5FU19TRUFSQ0gpOwoKX2RlZmluZVByb3BlcnR5KEVTU2VhcmNoU291cmNlLCAidGl0bGUiLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2hUaXRsZScsIHsKICBkZWZhdWx0TWVzc2FnZTogJ0RvY3VtZW50cycKfSkpOwoKX2RlZmluZVByb3BlcnR5KEVTU2VhcmNoU291cmNlLCAiZGVzY3JpcHRpb24iLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNTZWFyY2hEZXNjcmlwdGlvbicsIHsKICBkZWZhdWx0TWVzc2FnZTogJ1ZlY3RvciBkYXRhIGZyb20gYSBLaWJhbmEgaW5kZXggcGF0dGVybicKfSkpOw=="},null]}