{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/lens/public/indexpattern_datasource/field_item.js","dependencies":[{"path":"x-pack/legacy/plugins/lens/public/indexpattern_datasource/field_item.js","mtime":1589249552304},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkSXRlbSA9IEZpZWxkSXRlbTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfZGF0ZW1hdGggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkBlbGFzdGljL2RhdGVtYXRoIikpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX2V1aV9jaGFydHNfdGhlbWUgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkvZGlzdC9ldWlfY2hhcnRzX3RoZW1lIik7Cgp2YXIgX2NoYXJ0cyA9IHJlcXVpcmUoIkBlbGFzdGljL2NoYXJ0cyIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2RhdGEvcHVibGljIik7Cgp2YXIgX2RyYWdfZHJvcCA9IHJlcXVpcmUoIi4uL2RyYWdfZHJvcCIpOwoKdmFyIF9sZW5zX2ZpZWxkX2ljb24gPSByZXF1aXJlKCIuL2xlbnNfZmllbGRfaWNvbiIpOwoKdmFyIF9sZW5zX3VpX3RlbGVtZXRyeSA9IHJlcXVpcmUoIi4uL2xlbnNfdWlfdGVsZW1ldHJ5Iik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsKICBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7CiAgICByZXR1cm4gb2JqOwogIH0gZWxzZSB7CiAgICB2YXIgbmV3T2JqID0ge307CgogICAgaWYgKG9iaiAhPSBudWxsKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgewogICAgICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307CgogICAgICAgICAgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdPYmpba2V5XSA9IG9ialtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIG5ld09iai5kZWZhdWx0ID0gb2JqOwogICAgcmV0dXJuIG5ld09iajsKICB9Cn0KCmZ1bmN0aW9uIF9leHRlbmRzKCkgewogIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiB0YXJnZXQ7CiAgfTsKCiAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiB3cmFwT25Eb3Qoc3RyKSB7CiAgLy8gdTIwMEIgaXMgYSBub24td2lkdGggd2hpdGUtc3BhY2UgY2hhcmFjdGVyLCB3aGljaCBhbGxvd3MKICAvLyB0aGUgYnJvd3NlciB0byBlZmZpY2llbnRseSB3b3JkLXdyYXAgcmlnaHQgYWZ0ZXIgdGhlIGRvdAogIC8vIHdpdGhvdXQgdXMgaGF2aW5nIHRvIGRyYXcgYSBsb3Qgb2YgZXh0cmEgRE9NIGVsZW1lbnRzLCBldGMKICByZXR1cm4gc3RyID8gc3RyLnJlcGxhY2UoL1wuL2csICIuXHUyMDBCIikgOiAnJzsKfQoKZnVuY3Rpb24gRmllbGRJdGVtKHByb3BzKSB7CiAgdmFyIGNvcmUgPSBwcm9wcy5jb3JlLAogICAgICBmaWVsZCA9IHByb3BzLmZpZWxkLAogICAgICBpbmRleFBhdHRlcm4gPSBwcm9wcy5pbmRleFBhdHRlcm4sCiAgICAgIGhpZ2hsaWdodCA9IHByb3BzLmhpZ2hsaWdodCwKICAgICAgZXhpc3RzID0gcHJvcHMuZXhpc3RzLAogICAgICBxdWVyeSA9IHByb3BzLnF1ZXJ5LAogICAgICBkYXRlUmFuZ2UgPSBwcm9wcy5kYXRlUmFuZ2UsCiAgICAgIGZpbHRlcnMgPSBwcm9wcy5maWx0ZXJzLAogICAgICBoaWRlRGV0YWlscyA9IHByb3BzLmhpZGVEZXRhaWxzOwoKICB2YXIgX3VzZVN0YXRlID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoZmFsc2UpLAogICAgICBfdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSwKICAgICAgaW5mb0lzT3BlbiA9IF91c2VTdGF0ZTJbMF0sCiAgICAgIHNldE9wZW4gPSBfdXNlU3RhdGUyWzFdOwoKICB2YXIgX3VzZVN0YXRlMyA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKHsKICAgIGlzTG9hZGluZzogZmFsc2UKICB9KSwKICAgICAgX3VzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTMsIDIpLAogICAgICBzdGF0ZSA9IF91c2VTdGF0ZTRbMF0sCiAgICAgIHNldFN0YXRlID0gX3VzZVN0YXRlNFsxXTsKCiAgdmFyIHdyYXBwYWJsZU5hbWUgPSB3cmFwT25Eb3QoZmllbGQubmFtZSk7CiAgdmFyIHdyYXBwYWJsZUhpZ2hsaWdodCA9IHdyYXBPbkRvdChoaWdobGlnaHQpOwogIHZhciBoaWdobGlnaHRJbmRleCA9IHdyYXBwYWJsZUhpZ2hsaWdodCA/IHdyYXBwYWJsZU5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHdyYXBwYWJsZUhpZ2hsaWdodC50b0xvd2VyQ2FzZSgpKSA6IC0xOwogIHZhciB3cmFwcGFibGVIaWdobGlnaHRhYmxlRmllbGROYW1lID0gaGlnaGxpZ2h0SW5kZXggPCAwID8gd3JhcHBhYmxlTmFtZSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgbnVsbCwgd3JhcHBhYmxlTmFtZS5zdWJzdHIoMCwgaGlnaGxpZ2h0SW5kZXgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgd3JhcHBhYmxlTmFtZS5zdWJzdHIoaGlnaGxpZ2h0SW5kZXgsIHdyYXBwYWJsZUhpZ2hsaWdodC5sZW5ndGgpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIHdyYXBwYWJsZU5hbWUuc3Vic3RyKGhpZ2hsaWdodEluZGV4ICsgd3JhcHBhYmxlSGlnaGxpZ2h0Lmxlbmd0aCkpKTsKCiAgZnVuY3Rpb24gZmV0Y2hEYXRhKCkgewogICAgaWYgKHN0YXRlLmlzTG9hZGluZyB8fCBmaWVsZC50eXBlICE9PSAnbnVtYmVyJyAmJiBmaWVsZC50eXBlICE9PSAnc3RyaW5nJyAmJiBmaWVsZC50eXBlICE9PSAnZGF0ZScgJiYgZmllbGQudHlwZSAhPT0gJ2Jvb2xlYW4nICYmIGZpZWxkLnR5cGUgIT09ICdpcCcpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgaXNMb2FkaW5nOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CiAgICBjb3JlLmh0dHAucG9zdCgiL2FwaS9sZW5zL2luZGV4X3N0YXRzLyIuY29uY2F0KGluZGV4UGF0dGVybi50aXRsZSwgIi9maWVsZCIpLCB7CiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBkc2xRdWVyeTogX3B1YmxpYy5lc1F1ZXJ5LmJ1aWxkRXNRdWVyeShpbmRleFBhdHRlcm4sIHF1ZXJ5LCBmaWx0ZXJzLCBfcHVibGljLmVzUXVlcnkuZ2V0RXNRdWVyeUNvbmZpZyhjb3JlLnVpU2V0dGluZ3MpKSwKICAgICAgICBmcm9tRGF0ZTogZGF0ZVJhbmdlLmZyb21EYXRlLAogICAgICAgIHRvRGF0ZTogZGF0ZVJhbmdlLnRvRGF0ZSwKICAgICAgICB0aW1lRmllbGROYW1lOiBpbmRleFBhdHRlcm4udGltZUZpZWxkTmFtZSwKICAgICAgICBmaWVsZDogZmllbGQKICAgICAgfSkKICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdHMpIHsKICAgICAgc2V0U3RhdGUoZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZSwKICAgICAgICAgIHRvdGFsRG9jdW1lbnRzOiByZXN1bHRzLnRvdGFsRG9jdW1lbnRzLAogICAgICAgICAgc2FtcGxlZERvY3VtZW50czogcmVzdWx0cy5zYW1wbGVkRG9jdW1lbnRzLAogICAgICAgICAgc2FtcGxlZFZhbHVlczogcmVzdWx0cy5zYW1wbGVkVmFsdWVzLAogICAgICAgICAgaGlzdG9ncmFtOiByZXN1bHRzLmhpc3RvZ3JhbSwKICAgICAgICAgIHRvcFZhbHVlczogcmVzdWx0cy50b3BWYWx1ZXMKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7CiAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHRvZ2dsZVBvcG92ZXIoKSB7CiAgICBpZiAoaGlkZURldGFpbHMpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNldE9wZW4oIWluZm9Jc09wZW4pOwoKICAgIGlmICghaW5mb0lzT3BlbikgewogICAgICAoMCwgX2xlbnNfdWlfdGVsZW1ldHJ5LnRyYWNrVWlFdmVudCkoJ2luZGV4cGF0dGVybl9maWVsZF9pbmZvX2NsaWNrJyk7CiAgICAgIGZldGNoRGF0YSgpOwogICAgfQogIH0KCiAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQb3BvdmVyLCB7CiAgICBpZDogImxuc0ZpZWxkTGlzdFBhbmVsX19maWVsZCIsCiAgICBjbGFzc05hbWU6ICJsbnNGaWVsZEl0ZW1fX3BvcG92ZXJBbmNob3IiLAogICAgZGlzcGxheTogImJsb2NrIiwKICAgIGNvbnRhaW5lcjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFwcGxpY2F0aW9uJykgfHwgdW5kZWZpbmVkLAogICAgYnV0dG9uOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9kcmFnX2Ryb3AuRHJhZ0Ryb3AsIHsKICAgICAgbGFiZWw6IGZpZWxkLm5hbWUsCiAgICAgIHZhbHVlOiB7CiAgICAgICAgZmllbGQ6IGZpZWxkLAogICAgICAgIGluZGV4UGF0dGVybklkOiBpbmRleFBhdHRlcm4uaWQKICAgICAgfSwKICAgICAgImRhdGEtdGVzdC1zdWJqIjogImxuc0ZpZWxkTGlzdFBhbmVsRmllbGQiLAogICAgICBkcmFnZ2FibGU6IHRydWUsCiAgICAgIGNsYXNzTmFtZTogImxuc0ZpZWxkSXRlbSBsbnNGaWVsZEl0ZW0tLSIuY29uY2F0KGZpZWxkLnR5cGUsICIgbG5zRmllbGRJdGVtLS0iKS5jb25jYXQoZXhpc3RzID8gJ2V4aXN0cycgOiAnbWlzc2luZycpCiAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpS2V5Ym9hcmRBY2Nlc3NpYmxlLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgIGNsYXNzTmFtZTogImxuc0ZpZWxkSXRlbV9faW5mbyAiLmNvbmNhdChpbmZvSXNPcGVuID8gJ2xuc0ZpZWxkSXRlbV9faW5mby1pc09wZW4nIDogJycpLAogICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zRmllbGRMaXN0UGFuZWxGaWVsZC0iLmNvbmNhdChmaWVsZC5uYW1lKSwKICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICB0b2dnbGVQb3BvdmVyKCk7CiAgICAgIH0sCiAgICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uIG9uS2V5UHJlc3MoZXZlbnQpIHsKICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnRU5URVInKSB7CiAgICAgICAgICB0b2dnbGVQb3BvdmVyKCk7CiAgICAgICAgfQogICAgICB9LAogICAgICAiYXJpYS1sYWJlbCI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5maWVsZFN0YXRzQnV0dG9uTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDbGljayBmb3IgYSBmaWVsZCBwcmV2aWV3LCBvciBkcmFnIGFuZCBkcm9wIHRvIHZpc3VhbGl6ZS4nCiAgICAgIH0pCiAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9sZW5zX2ZpZWxkX2ljb24uTGVuc0ZpZWxkSWNvbiwgewogICAgICB0eXBlOiBmaWVsZC50eXBlCiAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgY2xhc3NOYW1lOiAibG5zRmllbGRJdGVtX19uYW1lIiwKICAgICAgdGl0bGU6IGZpZWxkLm5hbWUKICAgIH0sIHdyYXBwYWJsZUhpZ2hsaWdodGFibGVGaWVsZE5hbWUpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvblRpcCwgewogICAgICBhbmNob3JDbGFzc05hbWU6ICJsbnNGaWVsZEl0ZW1fX2luZm9JY29uIiwKICAgICAgY29udGVudDogaGlkZURldGFpbHMgPyBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm4uZmllbGRJdGVtVG9vbHRpcCcsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0RyYWcgYW5kIGRyb3AgdG8gdmlzdWFsaXplLicKICAgICAgfSkgOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm4uZmllbGRTdGF0c0J1dHRvbkxhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ2xpY2sgZm9yIGEgZmllbGQgcHJldmlldywgb3IgZHJhZyBhbmQgZHJvcCB0byB2aXN1YWxpemUuJwogICAgICB9KSwKICAgICAgdHlwZTogImlJbkNpcmNsZSIsCiAgICAgIGNvbG9yOiAic3ViZHVlZCIsCiAgICAgIHNpemU6ICJzIgogICAgfSkpKSksCiAgICBpc09wZW46IGluZm9Jc09wZW4sCiAgICBjbG9zZVBvcG92ZXI6IGZ1bmN0aW9uIGNsb3NlUG9wb3ZlcigpIHsKICAgICAgcmV0dXJuIHNldE9wZW4oZmFsc2UpOwogICAgfSwKICAgIGFuY2hvclBvc2l0aW9uOiAicmlnaHRVcCIsCiAgICBwYW5lbENsYXNzTmFtZTogImxuc0ZpZWxkSXRlbV9fZmllbGRQb3BvdmVyUGFuZWwiCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChGaWVsZEl0ZW1Qb3BvdmVyQ29udGVudHMsIF9leHRlbmRzKHt9LCBzdGF0ZSwgcHJvcHMpKSk7Cn0KCmZ1bmN0aW9uIEZpZWxkSXRlbVBvcG92ZXJDb250ZW50cyhwcm9wcykgewogIHZhciBmaWVsZEZvcm1hdHMgPSBfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5kYXRhLmZpZWxkRm9ybWF0czsKICB2YXIgaGlzdG9ncmFtID0gcHJvcHMuaGlzdG9ncmFtLAogICAgICB0b3BWYWx1ZXMgPSBwcm9wcy50b3BWYWx1ZXMsCiAgICAgIGluZGV4UGF0dGVybiA9IHByb3BzLmluZGV4UGF0dGVybiwKICAgICAgZmllbGQgPSBwcm9wcy5maWVsZCwKICAgICAgZGF0ZVJhbmdlID0gcHJvcHMuZGF0ZVJhbmdlLAogICAgICBjb3JlID0gcHJvcHMuY29yZSwKICAgICAgc2FtcGxlZFZhbHVlcyA9IHByb3BzLnNhbXBsZWRWYWx1ZXM7CiAgdmFyIElTX0RBUktfVEhFTUUgPSBjb3JlLnVpU2V0dGluZ3MuZ2V0KCd0aGVtZTpkYXJrTW9kZScpOwogIHZhciBjaGFydFRoZW1lID0gSVNfREFSS19USEVNRSA/IF9ldWlfY2hhcnRzX3RoZW1lLkVVSV9DSEFSVFNfVEhFTUVfREFSSy50aGVtZSA6IF9ldWlfY2hhcnRzX3RoZW1lLkVVSV9DSEFSVFNfVEhFTUVfTElHSFQudGhlbWU7CgogIGlmIChwcm9wcy5pc0xvYWRpbmcpIHsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTG9hZGluZ1NwaW5uZXIsIG51bGwpOwogIH0gZWxzZSBpZiAoKCFwcm9wcy5oaXN0b2dyYW0gfHwgcHJvcHMuaGlzdG9ncmFtLmJ1Y2tldHMubGVuZ3RoID09PSAwKSAmJiAoIXByb3BzLnRvcFZhbHVlcyB8fCBwcm9wcy50b3BWYWx1ZXMuYnVja2V0cy5sZW5ndGggPT09IDApKSB7CiAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgc2l6ZTogInMiCiAgICB9LCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm4uZmllbGRTdGF0c05vRGF0YScsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdObyBkYXRhIHRvIGRpc3BsYXkuJwogICAgfSkpOwogIH0KCiAgdmFyIGhpc3RvZ3JhbURlZmF1bHQgPSAhIXByb3BzLmhpc3RvZ3JhbTsKICB2YXIgdG90YWxWYWx1ZXNDb3VudCA9IHRvcFZhbHVlcyAmJiB0b3BWYWx1ZXMuYnVja2V0cy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIGJ1Y2tldCkgewogICAgcmV0dXJuIGJ1Y2tldC5jb3VudCArIHByZXY7CiAgfSwgMCk7CiAgdmFyIG90aGVyQ291bnQgPSBzYW1wbGVkVmFsdWVzICYmIHRvdGFsVmFsdWVzQ291bnQgPyBzYW1wbGVkVmFsdWVzIC0gdG90YWxWYWx1ZXNDb3VudCA6IDA7CgogIGlmICh0b3RhbFZhbHVlc0NvdW50ICYmIGhpc3RvZ3JhbSAmJiBoaXN0b2dyYW0uYnVja2V0cy5sZW5ndGggJiYgdG9wVmFsdWVzICYmIHRvcFZhbHVlcy5idWNrZXRzLmxlbmd0aCkgewogICAgLy8gRGVmYXVsdCB0byBoaXN0b2dyYW0gd2hlbiB0b3AgdmFsdWVzIGFyZSBsZXNzIHRoYW4gMTAlIG9mIHRvdGFsCiAgICBoaXN0b2dyYW1EZWZhdWx0ID0gb3RoZXJDb3VudCAvIHRvdGFsVmFsdWVzQ291bnQgPiAwLjk7CiAgfQoKICB2YXIgX3VzZVN0YXRlNSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKGhpc3RvZ3JhbURlZmF1bHQpLAogICAgICBfdXNlU3RhdGU2ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNSwgMiksCiAgICAgIHNob3dpbmdIaXN0b2dyYW0gPSBfdXNlU3RhdGU2WzBdLAogICAgICBzZXRTaG93aW5nSGlzdG9ncmFtID0gX3VzZVN0YXRlNlsxXTsKCiAgdmFyIGZvcm1hdHRlcjsKCiAgaWYgKGluZGV4UGF0dGVybi5maWVsZEZvcm1hdE1hcCAmJiBpbmRleFBhdHRlcm4uZmllbGRGb3JtYXRNYXBbZmllbGQubmFtZV0pIHsKICAgIHZhciBGb3JtYXRUeXBlID0gZmllbGRGb3JtYXRzLmdldFR5cGUoaW5kZXhQYXR0ZXJuLmZpZWxkRm9ybWF0TWFwW2ZpZWxkLm5hbWVdLmlkKTsKCiAgICBpZiAoRm9ybWF0VHlwZSkgewogICAgICBmb3JtYXR0ZXIgPSBuZXcgRm9ybWF0VHlwZShpbmRleFBhdHRlcm4uZmllbGRGb3JtYXRNYXBbZmllbGQubmFtZV0ucGFyYW1zLCBjb3JlLnVpU2V0dGluZ3MuZ2V0LmJpbmQoY29yZS51aVNldHRpbmdzKSk7CiAgICB9IGVsc2UgewogICAgICBmb3JtYXR0ZXIgPSB7CiAgICAgICAgY29udmVydDogZnVuY3Rpb24gY29udmVydChkYXRhKSB7CiAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7CiAgICAgICAgfQogICAgICB9OwogICAgfQogIH0gZWxzZSB7CiAgICBmb3JtYXR0ZXIgPSBmaWVsZEZvcm1hdHMuZ2V0RGVmYXVsdEluc3RhbmNlKGZpZWxkLnR5cGUsIGZpZWxkLmVzVHlwZXMpOwogIH0KCiAgdmFyIGZyb21EYXRlID0gX2RhdGVtYXRoLmRlZmF1bHQucGFyc2UoZGF0ZVJhbmdlLmZyb21EYXRlKTsKCiAgdmFyIHRvRGF0ZSA9IF9kYXRlbWF0aC5kZWZhdWx0LnBhcnNlKGRhdGVSYW5nZS50b0RhdGUpOwoKICB2YXIgdGl0bGUgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsKTsKCiAgaWYgKGhpc3RvZ3JhbSAmJiBoaXN0b2dyYW0uYnVja2V0cy5sZW5ndGggJiYgdG9wVmFsdWVzICYmIHRvcFZhbHVlcy5idWNrZXRzLmxlbmd0aCkgewogICAgdGl0bGUgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uR3JvdXAsIHsKICAgICAgY2xhc3NOYW1lOiAibG5zRmllbGRJdGVtX19wb3BvdmVyQnV0dG9uR3JvdXAiLAogICAgICBidXR0b25TaXplOiAiY29tcHJlc3NlZCIsCiAgICAgIGlzRnVsbFdpZHRoOiB0cnVlLAogICAgICBsZWdlbmQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5maWVsZFN0YXRzRGlzcGxheVRvZ2dsZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RvZ2dsZSBlaXRoZXIgdGhlJwogICAgICB9KSwKICAgICAgb3B0aW9uczogW3sKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLmZpZWxkVG9wVmFsdWVzTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RvcCB2YWx1ZXMnCiAgICAgICAgfSksCiAgICAgICAgaWQ6ICd0b3BWYWx1ZXMnCiAgICAgIH0sIHsKICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLmZpZWxkRGlzdHJpYnV0aW9uTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Rpc3RyaWJ1dGlvbicKICAgICAgICB9KSwKICAgICAgICBpZDogJ2hpc3RvZ3JhbScKICAgICAgfV0sCiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShvcHRpb25JZCkgewogICAgICAgIHNldFNob3dpbmdIaXN0b2dyYW0ob3B0aW9uSWQgPT09ICdoaXN0b2dyYW0nKTsKICAgICAgfSwKICAgICAgaWRTZWxlY3RlZDogc2hvd2luZ0hpc3RvZ3JhbSA/ICdoaXN0b2dyYW0nIDogJ3RvcFZhbHVlcycKICAgIH0pOwogIH0gZWxzZSBpZiAoZmllbGQudHlwZSA9PT0gJ2RhdGUnKSB7CiAgICB0aXRsZSA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5maWVsZFRpbWVEaXN0cmlidXRpb25MYWJlbCcsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaW1lIGRpc3RyaWJ1dGlvbicKICAgIH0pKTsKICB9IGVsc2UgaWYgKHRvcFZhbHVlcyAmJiB0b3BWYWx1ZXMuYnVja2V0cy5sZW5ndGgpIHsKICAgIHRpdGxlID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLmZpZWxkVG9wVmFsdWVzTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVG9wIHZhbHVlcycKICAgIH0pKTsKICB9CgogIGZ1bmN0aW9uIHdyYXBJblBvcG92ZXIoZWwpIHsKICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCB0aXRsZSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQb3BvdmVyVGl0bGUsIG51bGwsIHRpdGxlKSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwpLCBlbCwgcHJvcHMudG90YWxEb2N1bWVudHMgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUG9wb3ZlckZvb3RlciwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgc2l6ZTogInhzIiwKICAgICAgdGV4dEFsaWduOiAiY2VudGVyIgogICAgfSwgcHJvcHMuc2FtcGxlZERvY3VtZW50cyAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5pbmRleFBhdHRlcm4ucGVyY2VudGFnZU9mTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAne3BlcmNlbnRhZ2V9JSBvZicsCiAgICAgIHZhbHVlczogewogICAgICAgIHBlcmNlbnRhZ2U6IE1hdGgucm91bmQocHJvcHMuc2FtcGxlZERvY3VtZW50cyAvIHByb3BzLnRvdGFsRG9jdW1lbnRzICogMTAwKQogICAgICB9CiAgICB9KSksICcgJywgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgZmllbGRGb3JtYXRzLmdldERlZmF1bHRJbnN0YW5jZShfcHVibGljLktCTl9GSUVMRF9UWVBFUy5OVU1CRVIsIFtfcHVibGljLkVTX0ZJRUxEX1RZUEVTLklOVEVHRVJdKS5jb252ZXJ0KHByb3BzLnRvdGFsRG9jdW1lbnRzKSksICcgJywgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLm9mRG9jdW1lbnRzTGFiZWwnLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnZG9jdW1lbnRzJwogICAgfSkpKSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwpKTsKICB9CgogIGlmIChoaXN0b2dyYW0gJiYgaGlzdG9ncmFtLmJ1Y2tldHMubGVuZ3RoKSB7CiAgICB2YXIgc3BlY0lkID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLmZpZWxkU3RhdHNDb3VudExhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ0NvdW50JwogICAgfSk7CgogICAgaWYgKGZpZWxkLnR5cGUgPT09ICdkYXRlJykgewogICAgICByZXR1cm4gd3JhcEluUG9wb3ZlcihfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQ2hhcnQsIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zRmllbGRMaXN0UGFuZWwtaGlzdG9ncmFtIiwKICAgICAgICBzaXplOiB7CiAgICAgICAgICBoZWlnaHQ6IDIwMCwKICAgICAgICAgIHdpZHRoOiAzMDAgLSAzMgogICAgICAgIH0KICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfY2hhcnRzLlNldHRpbmdzLCB7CiAgICAgICAgdG9vbHRpcDogewogICAgICAgICAgdHlwZTogX2NoYXJ0cy5Ub29sdGlwVHlwZS5Ob25lCiAgICAgICAgfSwKICAgICAgICB0aGVtZTogY2hhcnRUaGVtZSwKICAgICAgICB4RG9tYWluOiBmcm9tRGF0ZSAmJiB0b0RhdGUgPyB7CiAgICAgICAgICBtaW46IGZyb21EYXRlLnZhbHVlT2YoKSwKICAgICAgICAgIG1heDogdG9EYXRlLnZhbHVlT2YoKSwKICAgICAgICAgIG1pbkludGVydmFsOiBNYXRoLnJvdW5kKCh0b0RhdGUudmFsdWVPZigpIC0gZnJvbURhdGUudmFsdWVPZigpKSAvIDEwKQogICAgICAgIH0gOiB1bmRlZmluZWQKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NoYXJ0cy5BeGlzLCB7CiAgICAgICAgaWQ6ICJrZXkiLAogICAgICAgIHBvc2l0aW9uOiBfY2hhcnRzLlBvc2l0aW9uLkJvdHRvbSwKICAgICAgICB0aWNrRm9ybWF0OiBmcm9tRGF0ZSAmJiB0b0RhdGUgPyAoMCwgX2NoYXJ0cy5uaWNlVGltZUZvcm1hdHRlcikoW2Zyb21EYXRlLnZhbHVlT2YoKSwgdG9EYXRlLnZhbHVlT2YoKV0pIDogdW5kZWZpbmVkLAogICAgICAgIHNob3dPdmVybGFwcGluZ1RpY2tzOiB0cnVlCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQmFyU2VyaWVzLCB7CiAgICAgICAgZGF0YTogaGlzdG9ncmFtLmJ1Y2tldHMsCiAgICAgICAgaWQ6IHNwZWNJZCwKICAgICAgICB4QWNjZXNzb3I6ICdrZXknLAogICAgICAgIHlBY2Nlc3NvcnM6IFsnY291bnQnXSwKICAgICAgICB4U2NhbGVUeXBlOiBfY2hhcnRzLlNjYWxlVHlwZS5UaW1lLAogICAgICAgIHlTY2FsZVR5cGU6IF9jaGFydHMuU2NhbGVUeXBlLkxpbmVhciwKICAgICAgICB0aW1lWm9uZTogImxvY2FsIgogICAgICB9KSkpOwogICAgfSBlbHNlIGlmIChzaG93aW5nSGlzdG9ncmFtIHx8ICF0b3BWYWx1ZXMgfHwgIXRvcFZhbHVlcy5idWNrZXRzLmxlbmd0aCkgewogICAgICByZXR1cm4gd3JhcEluUG9wb3ZlcihfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQ2hhcnQsIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAibG5zRmllbGRMaXN0UGFuZWwtaGlzdG9ncmFtIiwKICAgICAgICBzaXplOiB7CiAgICAgICAgICBoZWlnaHQ6IDIwMCwKICAgICAgICAgIHdpZHRoOiAnMTAwJScKICAgICAgICB9CiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NoYXJ0cy5TZXR0aW5ncywgewogICAgICAgIHJvdGF0aW9uOiA5MCwKICAgICAgICB0b29sdGlwOiB7CiAgICAgICAgICB0eXBlOiBfY2hhcnRzLlRvb2x0aXBUeXBlLk5vbmUKICAgICAgICB9LAogICAgICAgIHRoZW1lOiBjaGFydFRoZW1lCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9jaGFydHMuQXhpcywgewogICAgICAgIGlkOiAia2V5IiwKICAgICAgICBwb3NpdGlvbjogX2NoYXJ0cy5Qb3NpdGlvbi5MZWZ0LAogICAgICAgIHNob3dPdmVybGFwcGluZ1RpY2tzOiB0cnVlLAogICAgICAgIHRpY2tGb3JtYXQ6IGZ1bmN0aW9uIHRpY2tGb3JtYXQoZCkgewogICAgICAgICAgcmV0dXJuIGZvcm1hdHRlci5jb252ZXJ0KGQpOwogICAgICAgIH0KICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NoYXJ0cy5CYXJTZXJpZXMsIHsKICAgICAgICBkYXRhOiBoaXN0b2dyYW0uYnVja2V0cywKICAgICAgICBpZDogc3BlY0lkLAogICAgICAgIHhBY2Nlc3NvcjogJ2tleScsCiAgICAgICAgeUFjY2Vzc29yczogWydjb3VudCddLAogICAgICAgIHhTY2FsZVR5cGU6IF9jaGFydHMuU2NhbGVUeXBlLkxpbmVhciwKICAgICAgICB5U2NhbGVUeXBlOiBfY2hhcnRzLlNjYWxlVHlwZS5MaW5lYXIKICAgICAgfSkpKTsKICAgIH0KICB9CgogIGlmIChwcm9wcy50b3BWYWx1ZXMgJiYgcHJvcHMudG9wVmFsdWVzLmJ1Y2tldHMubGVuZ3RoKSB7CiAgICByZXR1cm4gd3JhcEluUG9wb3ZlcihfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJsbnNGaWVsZExpc3RQYW5lbC10b3BWYWx1ZXMiCiAgICB9LCBwcm9wcy50b3BWYWx1ZXMuYnVja2V0cy5tYXAoZnVuY3Rpb24gKHRvcFZhbHVlKSB7CiAgICAgIHZhciBmb3JtYXR0ZWQgPSBmb3JtYXR0ZXIuY29udmVydCh0b3BWYWx1ZS5rZXkpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIGNsYXNzTmFtZTogImxuc0ZpZWxkSXRlbV9fdG9wVmFsdWUiLAogICAgICAgIGtleTogdG9wVmFsdWUua2V5CiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBhbGlnbkl0ZW1zOiAic3RyZXRjaCIsCiAgICAgICAga2V5OiB0b3BWYWx1ZS5rZXksCiAgICAgICAgZ3V0dGVyU2l6ZTogInhzIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiB0cnVlLAogICAgICAgIGNsYXNzTmFtZTogImV1aS10ZXh0VHJ1bmNhdGUiCiAgICAgIH0sIGZvcm1hdHRlZCA9PT0gJycgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIHNpemU6ICJ4cyIsCiAgICAgICAgY29sb3I6ICJzdWJkdWVkIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJlbSIsIG51bGwsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmluZGV4UGF0dGVybi5maWVsZFBhbmVsRW1wdHlTdHJpbmdWYWx1ZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0VtcHR5IHN0cmluZycKICAgICAgfSkpKSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUb29sVGlwLCB7CiAgICAgICAgY29udGVudDogZm9ybWF0dGVkLAogICAgICAgIGRlbGF5OiAibG9uZyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgICBzaXplOiAieHMiLAogICAgICAgIGNvbG9yOiAic3ViZHVlZCIsCiAgICAgICAgY2xhc3NOYW1lOiAiZXVpLXRleHRUcnVuY2F0ZSIKICAgICAgfSwgZm9ybWF0dGVkKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICAgIHNpemU6ICJ4cyIsCiAgICAgICAgdGV4dEFsaWduOiAibGVmdCIsCiAgICAgICAgY29sb3I6ICJhY2NlbnQiCiAgICAgIH0sIE1hdGgucm91bmQodG9wVmFsdWUuY291bnQgLyBwcm9wcy5zYW1wbGVkVmFsdWVzICogMTAwKSwgIiUiKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUHJvZ3Jlc3MsIHsKICAgICAgICBjbGFzc05hbWU6ICJsbnNGaWVsZEl0ZW1fX3RvcFZhbHVlUHJvZ3Jlc3MiLAogICAgICAgIHZhbHVlOiB0b3BWYWx1ZS5jb3VudCAvIHByb3BzLnNhbXBsZWRWYWx1ZXMsCiAgICAgICAgbWF4OiAxLAogICAgICAgIHNpemU6ICJzIiwKICAgICAgICBjb2xvcjogImFjY2VudCIKICAgICAgfSkpOwogICAgfSksIG90aGVyQ291bnQgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgIGFsaWduSXRlbXM6ICJzdHJldGNoIiwKICAgICAgZ3V0dGVyU2l6ZTogInhzIgogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgIGdyb3c6IHRydWUsCiAgICAgIGNsYXNzTmFtZTogImV1aS10ZXh0VHJ1bmNhdGUiCiAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgewogICAgICBzaXplOiAieHMiLAogICAgICBjbGFzc05hbWU6ICJldWktdGV4dFRydW5jYXRlIiwKICAgICAgY29sb3I6ICJzdWJkdWVkIgogICAgfSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuaW5kZXhQYXR0ZXJuLm90aGVyRG9jc0xhYmVsJywgewogICAgICBkZWZhdWx0TWVzc2FnZTogJ090aGVyJwogICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgIGdyb3c6IGZhbHNlLAogICAgICBjbGFzc05hbWU6ICJldWktdGV4dFRydW5jYXRlIgogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIHsKICAgICAgc2l6ZTogInMiLAogICAgICBjb2xvcjogInN1YmR1ZWQiCiAgICB9LCBNYXRoLnJvdW5kKG90aGVyQ291bnQgLyBwcm9wcy5zYW1wbGVkVmFsdWVzICogMTAwKSwgIiUiKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUHJvZ3Jlc3MsIHsKICAgICAgY2xhc3NOYW1lOiAibG5zRmllbGRJdGVtX190b3BWYWx1ZVByb2dyZXNzIiwKICAgICAgdmFsdWU6IG90aGVyQ291bnQgLyBwcm9wcy5zYW1wbGVkVmFsdWVzLAogICAgICBtYXg6IDEsCiAgICAgIHNpemU6ICJzIiwKICAgICAgY29sb3I6ICJzdWJkdWVkIgogICAgfSkpIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCkpKTsKICB9CgogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsKTsKfQ=="},null]}