{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/ui/public/field_editor/field_editor.js","dependencies":[{"path":"src/legacy/ui/public/field_editor/field_editor.js","mtime":1589249550299},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZpZWxkRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInByb3AtdHlwZXMiKSk7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF9zY3JpcHRpbmdfbGFuZ3VhZ2VzID0gcmVxdWlyZSgidWkvc2NyaXB0aW5nX2xhbmd1YWdlcyIpOwoKdmFyIF9kb2N1bWVudGF0aW9uX2xpbmtzID0gcmVxdWlyZSgidWkvZG9jdW1lbnRhdGlvbl9saW5rcyIpOwoKdmFyIF9ub3RpZnkgPSByZXF1aXJlKCJ1aS9ub3RpZnkiKTsKCnZhciBfbmV3X3BsYXRmb3JtID0gcmVxdWlyZSgidWkvbmV3X3BsYXRmb3JtIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9zY3JpcHRpbmdfY2FsbF9vdXRzID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL3NjcmlwdGluZ19jYWxsX291dHMiKTsKCnZhciBfc2NyaXB0aW5nX2hlbHAgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvc2NyaXB0aW5nX2hlbHAiKTsKCnZhciBfZmllbGRfZm9ybWF0X2VkaXRvciA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9maWVsZF9mb3JtYXRfZWRpdG9yIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4vY29uc3RhbnRzIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4vbGliIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7CgpyZXF1aXJlKCJicmFjZS9tb2RlL2dyb292eSIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfZSA9IHVuZGVmaW5lZDsgdHJ5IHsgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgeyBfYXJyLnB1c2goX3MudmFsdWUpOyBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7IH0gfSBjYXRjaCAoZXJyKSB7IF9kID0gdHJ1ZTsgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9Cgp2YXIgZ2V0RmllbGRGb3JtYXRzID0gZnVuY3Rpb24gZ2V0RmllbGRGb3JtYXRzKCkgewogIHJldHVybiBfbmV3X3BsYXRmb3JtLm5wU3RhcnQucGx1Z2lucy5kYXRhLmZpZWxkRm9ybWF0czsKfTsKCnZhciBnZXRGaWVsZFR5cGVGb3JtYXRzTGlzdCA9IGZ1bmN0aW9uIGdldEZpZWxkVHlwZUZvcm1hdHNMaXN0KGZpZWxkLCBkZWZhdWx0RmllbGRGb3JtYXQpIHsKICB2YXIgZmllbGRGb3JtYXRzID0gZ2V0RmllbGRGb3JtYXRzKCk7CiAgdmFyIGZvcm1hdHNCeVR5cGUgPSBmaWVsZEZvcm1hdHMuZ2V0QnlGaWVsZFR5cGUoZmllbGQudHlwZSkubWFwKGZ1bmN0aW9uIChfcmVmKSB7CiAgICB2YXIgaWQgPSBfcmVmLmlkLAogICAgICAgIHRpdGxlID0gX3JlZi50aXRsZTsKICAgIHJldHVybiB7CiAgICAgIGlkOiBpZCwKICAgICAgdGl0bGU6IHRpdGxlCiAgICB9OwogIH0pOwogIHJldHVybiBbewogICAgaWQ6ICcnLAogICAgZGVmYXVsdEZpZWxkRm9ybWF0OiBkZWZhdWx0RmllbGRGb3JtYXQsCiAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWZhdWx0Rm9ybWF0RHJvcERvd24nLCB7CiAgICAgIGRlZmF1bHRNZXNzYWdlOiAnLSBEZWZhdWx0IC0nCiAgICB9KQogIH1dLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZm9ybWF0c0J5VHlwZSkpOwp9OwoKdmFyIEZpZWxkRWRpdG9yID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmllbGRFZGl0b3IsIF9QdXJlQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRmllbGRFZGl0b3IocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRmllbGRFZGl0b3IpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZpZWxkRWRpdG9yKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZENoYW5nZSIsIGZ1bmN0aW9uIChmaWVsZE5hbWUsIHZhbHVlKSB7CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICBmaWVsZFtmaWVsZE5hbWVdID0gdmFsdWU7CgogICAgICBfdGhpcy5mb3JjZVVwZGF0ZSgpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25UeXBlQ2hhbmdlIiwgZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgdmFyIGdldENvbmZpZyA9IF90aGlzLnByb3BzLmhlbHBlcnMuZ2V0Q29uZmlnOwogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgdmFyIGZpZWxkRm9ybWF0cyA9IGdldEZpZWxkRm9ybWF0cygpOwogICAgICB2YXIgRGVmYXVsdEZpZWxkRm9ybWF0ID0gZmllbGRGb3JtYXRzLmdldERlZmF1bHRUeXBlKHR5cGUpOwogICAgICBmaWVsZC50eXBlID0gdHlwZTsKICAgICAgZmllbGQuZm9ybWF0ID0gbmV3IERlZmF1bHRGaWVsZEZvcm1hdChudWxsLCBnZXRDb25maWcpOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGZpZWxkVHlwZUZvcm1hdHM6IGdldEZpZWxkVHlwZUZvcm1hdHNMaXN0KGZpZWxkLCBEZWZhdWx0RmllbGRGb3JtYXQpLAogICAgICAgIGZpZWxkRm9ybWF0SWQ6IERlZmF1bHRGaWVsZEZvcm1hdC5pZCwKICAgICAgICBmaWVsZEZvcm1hdFBhcmFtczogZmllbGQuZm9ybWF0LnBhcmFtcygpCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25MYW5nQ2hhbmdlIiwgZnVuY3Rpb24gKGxhbmcpIHsKICAgICAgdmFyIGZpZWxkID0gX3RoaXMuc3RhdGUuZmllbGQ7CiAgICAgIHZhciBmaWVsZFR5cGVzID0gKDAsIF9sb2Rhc2guZ2V0KShfY29uc3RhbnRzLkZJRUxEX1RZUEVTX0JZX0xBTkcsIGxhbmcsIF9jb25zdGFudHMuREVGQVVMVF9GSUVMRF9UWVBFUyk7CiAgICAgIGZpZWxkLmxhbmcgPSBsYW5nOwogICAgICBmaWVsZC50eXBlID0gZmllbGRUeXBlcy5pbmNsdWRlcyhmaWVsZC50eXBlKSA/IGZpZWxkLnR5cGUgOiBmaWVsZFR5cGVzWzBdOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGZpZWxkVHlwZXM6IGZpZWxkVHlwZXMKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZvcm1hdENoYW5nZSIsIGZ1bmN0aW9uIChmb3JtYXRJZCwgcGFyYW1zKSB7CiAgICAgIHZhciBfZmllbGRUeXBlRm9ybWF0cyQ7CgogICAgICB2YXIgZmllbGRGb3JtYXRzID0gZ2V0RmllbGRGb3JtYXRzKCk7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZS5maWVsZCwKICAgICAgICAgIGZpZWxkVHlwZUZvcm1hdHMgPSBfdGhpcyRzdGF0ZS5maWVsZFR5cGVGb3JtYXRzOwogICAgICB2YXIgRmllbGRGb3JtYXQgPSBmaWVsZEZvcm1hdHMuZ2V0VHlwZShmb3JtYXRJZCB8fCAoKF9maWVsZFR5cGVGb3JtYXRzJCA9IGZpZWxkVHlwZUZvcm1hdHNbMF0pID09PSBudWxsIHx8IF9maWVsZFR5cGVGb3JtYXRzJCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ZpZWxkVHlwZUZvcm1hdHMkLmRlZmF1bHRGaWVsZEZvcm1hdC5pZCkpOwogICAgICBmaWVsZC5mb3JtYXQgPSBuZXcgRmllbGRGb3JtYXQocGFyYW1zLCBfdGhpcy5wcm9wcy5oZWxwZXJzLmdldENvbmZpZyk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmllbGRGb3JtYXRJZDogRmllbGRGb3JtYXQuaWQsCiAgICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IGZpZWxkLmZvcm1hdC5wYXJhbXMoKQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRm9ybWF0UGFyYW1zQ2hhbmdlIiwgZnVuY3Rpb24gKG5ld1BhcmFtcykgewogICAgICB2YXIgZmllbGRGb3JtYXRJZCA9IF90aGlzLnN0YXRlLmZpZWxkRm9ybWF0SWQ7CgogICAgICBfdGhpcy5vbkZvcm1hdENoYW5nZShmaWVsZEZvcm1hdElkLCBuZXdQYXJhbXMpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25Gb3JtYXRQYXJhbXNFcnJvciIsIGZ1bmN0aW9uIChlcnJvcikgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaGFzRm9ybWF0RXJyb3I6ICEhZXJyb3IKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblNjcmlwdENoYW5nZSIsIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgaGFzU2NyaXB0RXJyb3I6IGZhbHNlCiAgICAgIH0pOwoKICAgICAgX3RoaXMub25GaWVsZENoYW5nZSgnc2NyaXB0JywgdmFsdWUpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd1NjcmlwdGluZ0hlbHAiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzaG93U2NyaXB0aW5nSGVscDogdHJ1ZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhpZGVTY3JpcHRpbmdIZWxwIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd1NjcmlwdGluZ0hlbHA6IGZhbHNlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRGVsZXRlTW9kYWwiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkOwogICAgICByZXR1cm4gX3RoaXMuc3RhdGUuc2hvd0RlbGV0ZU1vZGFsID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU92ZXJsYXlNYXNrLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29uZmlybU1vZGFsLCB7CiAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGRIZWFkZXInLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRlbGV0ZSBmaWVsZCAne2ZpZWxkTmFtZX0nIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBvbkNhbmNlbDogX3RoaXMuaGlkZURlbGV0ZU1vZGFsLAogICAgICAgIG9uQ29uZmlybTogZnVuY3Rpb24gb25Db25maXJtKCkgewogICAgICAgICAgX3RoaXMuaGlkZURlbGV0ZU1vZGFsKCk7CgogICAgICAgICAgX3RoaXMuZGVsZXRlRmllbGQoKTsKICAgICAgICB9LAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGQuY2FuY2VsQnV0dG9uJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDYW5jZWwnCiAgICAgICAgfSksCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGQuZGVsZXRlQnV0dG9uJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEZWxldGUnCiAgICAgICAgfSksCiAgICAgICAgYnV0dG9uQ29sb3I6ICJkYW5nZXIiLAogICAgICAgIGRlZmF1bHRGb2N1c2VkQnV0dG9uOiBfZXVpLkVVSV9NT0RBTF9DT05GSVJNX0JVVFRPTgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZExhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIllvdSBjYW4ndCByZWNvdmVyIGEgZGVsZXRlZCBmaWVsZC57c2VwYXJhdG9yfUFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkbyB0aGlzPyIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBzZXBhcmF0b3I6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpKQogICAgICAgIH0KICAgICAgfSkpKSkgOiBudWxsOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2hvd0RlbGV0ZU1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd0RlbGV0ZU1vZGFsOiB0cnVlCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaGlkZURlbGV0ZU1vZGFsIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2hvd0RlbGV0ZU1vZGFsOiBmYWxzZQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlclNjcmlwdGluZ1BhbmVscyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgc2NyaXB0aW5nTGFuZ3MgPSBfdGhpcyRzdGF0ZTIuc2NyaXB0aW5nTGFuZ3MsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlMi5maWVsZCwKICAgICAgICAgIHNob3dTY3JpcHRpbmdIZWxwID0gX3RoaXMkc3RhdGUyLnNob3dTY3JpcHRpbmdIZWxwOwoKICAgICAgaWYgKCFmaWVsZC5zY3JpcHRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zY3JpcHRpbmdfY2FsbF9vdXRzLlNjcmlwdGluZ0Rpc2FibGVkQ2FsbE91dCwgewogICAgICAgIGlzVmlzaWJsZTogIXNjcmlwdGluZ0xhbmdzLmxlbmd0aAogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2NyaXB0aW5nX2NhbGxfb3V0cy5TY3JpcHRpbmdXYXJuaW5nQ2FsbE91dCwgewogICAgICAgIGlzVmlzaWJsZTogdHJ1ZQogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2NyaXB0aW5nX2hlbHAuU2NyaXB0aW5nSGVscEZseW91dCwgewogICAgICAgIGlzVmlzaWJsZTogc2hvd1NjcmlwdGluZ0hlbHAsCiAgICAgICAgb25DbG9zZTogX3RoaXMuaGlkZVNjcmlwdGluZ0hlbHAsCiAgICAgICAgaW5kZXhQYXR0ZXJuOiBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm4sCiAgICAgICAgbGFuZzogZmllbGQubGFuZywKICAgICAgICBuYW1lOiBmaWVsZC5uYW1lLAogICAgICAgIHNjcmlwdDogZmllbGQuc2NyaXB0LAogICAgICAgIGV4ZWN1dGVTY3JpcHQ6IF9saWIuZXhlY3V0ZVNjcmlwdAogICAgICB9KSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJkZWxldGVGaWVsZCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHJlZGlyZWN0QXdheSA9IF90aGlzLnByb3BzLmhlbHBlcnMucmVkaXJlY3RBd2F5OwogICAgICB2YXIgaW5kZXhQYXR0ZXJuID0gX3RoaXMucHJvcHMuaW5kZXhQYXR0ZXJuOwogICAgICB2YXIgZmllbGQgPSBfdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgdmFyIHJlbW92ZSA9IGluZGV4UGF0dGVybi5yZW1vdmVTY3JpcHRlZEZpZWxkKGZpZWxkKTsKCiAgICAgIGlmIChyZW1vdmUpIHsKICAgICAgICByZW1vdmUudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgbWVzc2FnZSA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IuZGVsZXRlRmllbGQuZGVsZXRlZEhlYWRlcicsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEZWxldGVkICd7ZmllbGROYW1lfSciLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBmaWVsZE5hbWU6IGZpZWxkLm5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgX25vdGlmeS50b2FzdE5vdGlmaWNhdGlvbnMuYWRkU3VjY2VzcyhtZXNzYWdlKTsKCiAgICAgICAgICByZWRpcmVjdEF3YXkoKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZWRpcmVjdEF3YXkoKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2F2ZUZpZWxkIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIGZpZWxkLCBpbmRleFBhdHRlcm4sIGZpZWxkRm9ybWF0SWQsIGlzVmFsaWQsIHJlZGlyZWN0QXdheSwgaW5kZXg7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBmaWVsZCA9IF90aGlzLnN0YXRlLmZpZWxkLnRvQWN0dWFsRmllbGQoKTsKICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm47CiAgICAgICAgICAgICAgZmllbGRGb3JtYXRJZCA9IF90aGlzLnN0YXRlLmZpZWxkRm9ybWF0SWQ7CgogICAgICAgICAgICAgIGlmICghZmllbGQuc2NyaXB0ZWQpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaXNTYXZpbmc6IHRydWUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfbGliLmlzU2NyaXB0VmFsaWQpKHsKICAgICAgICAgICAgICAgIG5hbWU6IGZpZWxkLm5hbWUsCiAgICAgICAgICAgICAgICBsYW5nOiBmaWVsZC5sYW5nLAogICAgICAgICAgICAgICAgc2NyaXB0OiBmaWVsZC5zY3JpcHQsCiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm5UaXRsZTogaW5kZXhQYXR0ZXJuLnRpdGxlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgaXNWYWxpZCA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgIGlmIChpc1ZhbGlkKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGhhc1NjcmlwdEVycm9yOiB0cnVlLAogICAgICAgICAgICAgICAgaXNTYXZpbmc6IGZhbHNlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICByZWRpcmVjdEF3YXkgPSBfdGhpcy5wcm9wcy5oZWxwZXJzLnJlZGlyZWN0QXdheTsKICAgICAgICAgICAgICBpbmRleCA9IGluZGV4UGF0dGVybi5maWVsZHMuZmluZEluZGV4KGZ1bmN0aW9uIChmKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZi5uYW1lID09PSBmaWVsZC5uYW1lOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuLmZpZWxkcy51cGRhdGUoZmllbGQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4uZmllbGRzLmFkZChmaWVsZCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIWZpZWxkRm9ybWF0SWQpIHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybi5maWVsZEZvcm1hdE1hcFtmaWVsZC5uYW1lXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuLmZpZWxkRm9ybWF0TWFwW2ZpZWxkLm5hbWVdID0gZmllbGQuZm9ybWF0OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgaW5kZXhQYXR0ZXJuLnNhdmUoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5kZWxldGVGaWVsZC5zYXZlZEhlYWRlcicsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTYXZlZCAne2ZpZWxkTmFtZX0nIiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgZmllbGROYW1lOiBmaWVsZC5uYW1lCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIF9ub3RpZnkudG9hc3ROb3RpZmljYXRpb25zLmFkZFN1Y2Nlc3MobWVzc2FnZSk7CgogICAgICAgICAgICAgICAgcmVkaXJlY3RBd2F5KCk7CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkpOwoKICAgIHZhciBfZmllbGQgPSBwcm9wcy5maWVsZCwKICAgICAgICBfaW5kZXhQYXR0ZXJuID0gcHJvcHMuaW5kZXhQYXR0ZXJuLAogICAgICAgIEZpZWxkID0gcHJvcHMuaGVscGVycy5GaWVsZDsKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpc1JlYWR5OiBmYWxzZSwKICAgICAgaXNDcmVhdGluZzogZmFsc2UsCiAgICAgIGlzRGVwcmVjYXRlZExhbmc6IGZhbHNlLAogICAgICBzY3JpcHRpbmdMYW5nczogW10sCiAgICAgIGZpZWxkVHlwZXM6IFtdLAogICAgICBmaWVsZFR5cGVGb3JtYXRzOiBbXSwKICAgICAgZXhpc3RpbmdGaWVsZE5hbWVzOiBfaW5kZXhQYXR0ZXJuLmZpZWxkcy5tYXAoZnVuY3Rpb24gKGYpIHsKICAgICAgICByZXR1cm4gZi5uYW1lOwogICAgICB9KSwKICAgICAgZmllbGQ6ICgwLCBfbGliLmNvcHlGaWVsZCkoX2ZpZWxkLCBfaW5kZXhQYXR0ZXJuLCBGaWVsZCksCiAgICAgIGZpZWxkRm9ybWF0SWQ6IHVuZGVmaW5lZCwKICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IHt9LAogICAgICBzaG93U2NyaXB0aW5nSGVscDogZmFsc2UsCiAgICAgIHNob3dEZWxldGVNb2RhbDogZmFsc2UsCiAgICAgIGhhc0Zvcm1hdEVycm9yOiBmYWxzZSwKICAgICAgaGFzU2NyaXB0RXJyb3I6IGZhbHNlLAogICAgICBpc1NhdmluZzogZmFsc2UKICAgIH07CiAgICBfdGhpcy5zdXBwb3J0ZWRMYW5ncyA9ICgwLCBfc2NyaXB0aW5nX2xhbmd1YWdlcy5nZXRTdXBwb3J0ZWRTY3JpcHRpbmdMYW5ndWFnZXMpKCk7CiAgICBfdGhpcy5kZXByZWNhdGVkTGFuZ3MgPSAoMCwgX3NjcmlwdGluZ19sYW5ndWFnZXMuZ2V0RGVwcmVjYXRlZFNjcmlwdGluZ0xhbmd1YWdlcykoKTsKCiAgICBfdGhpcy5pbml0KCk7CgogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEZpZWxkRWRpdG9yLCBbewogICAga2V5OiAiaW5pdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2luaXQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgJGh0dHAsIGZpZWxkLCBpbmRleFBhdHRlcm4sIGdldEVuYWJsZWRTY3JpcHRpbmdMYW5ndWFnZXMsIGVuYWJsZWRMYW5ncywgc2NyaXB0aW5nTGFuZ3MsIGZpZWxkVHlwZXMsIGZpZWxkRm9ybWF0cywgRGVmYXVsdEZpZWxkRm9ybWF0OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAkaHR0cCA9IHRoaXMucHJvcHMuaGVscGVycy4kaHR0cDsKICAgICAgICAgICAgICAgIGZpZWxkID0gdGhpcy5zdGF0ZS5maWVsZDsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybiA9IHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJuOwogICAgICAgICAgICAgICAgZ2V0RW5hYmxlZFNjcmlwdGluZ0xhbmd1YWdlcyA9IG5ldyBfc2NyaXB0aW5nX2xhbmd1YWdlcy5HZXRFbmFibGVkU2NyaXB0aW5nTGFuZ3VhZ2VzUHJvdmlkZXIoJGh0dHApOwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIGdldEVuYWJsZWRTY3JpcHRpbmdMYW5ndWFnZXMoKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgZW5hYmxlZExhbmdzID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBzY3JpcHRpbmdMYW5ncyA9ICgwLCBfbG9kYXNoLmludGVyc2VjdGlvbikoZW5hYmxlZExhbmdzLCAoMCwgX2xvZGFzaC51bmlvbikodGhpcy5zdXBwb3J0ZWRMYW5ncywgdGhpcy5kZXByZWNhdGVkTGFuZ3MpKTsKICAgICAgICAgICAgICAgIGZpZWxkLmxhbmcgPSBzY3JpcHRpbmdMYW5ncy5pbmNsdWRlcyhmaWVsZC5sYW5nKSA/IGZpZWxkLmxhbmcgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBmaWVsZFR5cGVzID0gKDAsIF9sb2Rhc2guZ2V0KShfY29uc3RhbnRzLkZJRUxEX1RZUEVTX0JZX0xBTkcsIGZpZWxkLmxhbmcsIF9jb25zdGFudHMuREVGQVVMVF9GSUVMRF9UWVBFUyk7CiAgICAgICAgICAgICAgICBmaWVsZC50eXBlID0gZmllbGRUeXBlcy5pbmNsdWRlcyhmaWVsZC50eXBlKSA/IGZpZWxkLnR5cGUgOiBmaWVsZFR5cGVzWzBdOwogICAgICAgICAgICAgICAgZmllbGRGb3JtYXRzID0gZ2V0RmllbGRGb3JtYXRzKCk7CiAgICAgICAgICAgICAgICBEZWZhdWx0RmllbGRGb3JtYXQgPSBmaWVsZEZvcm1hdHMuZ2V0RGVmYXVsdFR5cGUoZmllbGQudHlwZSwgZmllbGQuZXNUeXBlcyk7CiAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNSZWFkeTogdHJ1ZSwKICAgICAgICAgICAgICAgICAgaXNDcmVhdGluZzogIWluZGV4UGF0dGVybi5maWVsZHMuZ2V0QnlOYW1lKGZpZWxkLm5hbWUpLAogICAgICAgICAgICAgICAgICBpc0RlcHJlY2F0ZWRMYW5nOiB0aGlzLmRlcHJlY2F0ZWRMYW5ncy5pbmNsdWRlcyhmaWVsZC5sYW5nKSwKICAgICAgICAgICAgICAgICAgZXJyb3JzOiBbXSwKICAgICAgICAgICAgICAgICAgc2NyaXB0aW5nTGFuZ3M6IHNjcmlwdGluZ0xhbmdzLAogICAgICAgICAgICAgICAgICBmaWVsZFR5cGVzOiBmaWVsZFR5cGVzLAogICAgICAgICAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzOiBnZXRGaWVsZFR5cGVGb3JtYXRzTGlzdChmaWVsZCwgRGVmYXVsdEZpZWxkRm9ybWF0KSwKICAgICAgICAgICAgICAgICAgZmllbGRGb3JtYXRJZDogKDAsIF9sb2Rhc2guZ2V0KShpbmRleFBhdHRlcm4sIFsnZmllbGRGb3JtYXRNYXAnLCBmaWVsZC5uYW1lLCAndHlwZScsICdpZCddKSwKICAgICAgICAgICAgICAgICAgZmllbGRGb3JtYXRQYXJhbXM6IGZpZWxkLmZvcm1hdC5wYXJhbXMoKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHJldHVybiBfaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaW5pdDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImlzRHVwbGljYXRlTmFtZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNEdXBsaWNhdGVOYW1lKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUzID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzQ3JlYXRpbmcgPSBfdGhpcyRzdGF0ZTMuaXNDcmVhdGluZywKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUzLmZpZWxkLAogICAgICAgICAgZXhpc3RpbmdGaWVsZE5hbWVzID0gX3RoaXMkc3RhdGUzLmV4aXN0aW5nRmllbGROYW1lczsKICAgICAgcmV0dXJuIGlzQ3JlYXRpbmcgJiYgZXhpc3RpbmdGaWVsZE5hbWVzLmluY2x1ZGVzKGZpZWxkLm5hbWUpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlck5hbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlck5hbWUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpc0NyZWF0aW5nID0gX3RoaXMkc3RhdGU0LmlzQ3JlYXRpbmcsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlNC5maWVsZDsKICAgICAgdmFyIGlzSW52YWxpZCA9ICFmaWVsZC5uYW1lIHx8ICFmaWVsZC5uYW1lLnRyaW0oKTsKICAgICAgcmV0dXJuIGlzQ3JlYXRpbmcgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLm5hbWVMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnTmFtZScKICAgICAgICB9KSwKICAgICAgICBoZWxwVGV4dDogdGhpcy5pc0R1cGxpY2F0ZU5hbWUoKSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSWNvbiwgewogICAgICAgICAgdHlwZTogImFsZXJ0IiwKICAgICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgICBzaXplOiAicyIKICAgICAgICB9KSwgIlx4QTAiLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IubWFwcGluZ0NvbmZsaWN0TGFiZWwubWFwcGluZ0NvbmZsaWN0RGV0YWlsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAie21hcHBpbmdDb25mbGljdH0gWW91IGFscmVhZHkgaGF2ZSBhIGZpZWxkIHdpdGggdGhlIG5hbWUge2ZpZWxkTmFtZX0uIE5hbWluZyB5b3VyIHNjcmlwdGVkIGZpZWxkIHdpdGggdGhlIHNhbWUgbmFtZSBtZWFucyB5b3Ugd29uJ3QgYmUgYWJsZSB0byBxdWVyeSBib3RoIGZpZWxkcyBhdCB0aGUgc2FtZSB0aW1lLiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgbWFwcGluZ0NvbmZsaWN0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLm1hcHBpbmdDb25mbGljdExhYmVsLm1hcHBpbmdDb25mbGljdExhYmVsIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk1hcHBpbmcgQ29uZmxpY3Q6IgogICAgICAgICAgICB9KSksCiAgICAgICAgICAgIGZpZWxkTmFtZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGZpZWxkLm5hbWUpCiAgICAgICAgICB9CiAgICAgICAgfSkpIDogbnVsbCwKICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICBlcnJvcjogaXNJbnZhbGlkID8gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2NvbW1vbi51aS5maWVsZEVkaXRvci5uYW1lRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOYW1lIGlzIHJlcXVpcmVkJwogICAgICAgIH0pIDogbnVsbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLm5hbWUgfHwgJycsCiAgICAgICAgcGxhY2Vob2xkZXI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IubmFtZVBsYWNlaG9sZGVyJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdOZXcgc2NyaXB0ZWQgZmllbGQnCiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkTmFtZSIsCiAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgICAgIF90aGlzMi5vbkZpZWxkQ2hhbmdlKCduYW1lJywgZS50YXJnZXQudmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQKICAgICAgfSkpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJMYW5ndWFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTGFuZ3VhZ2UoKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlNS5maWVsZCwKICAgICAgICAgIHNjcmlwdGluZ0xhbmdzID0gX3RoaXMkc3RhdGU1LnNjcmlwdGluZ0xhbmdzLAogICAgICAgICAgaXNEZXByZWNhdGVkTGFuZyA9IF90aGlzJHN0YXRlNS5pc0RlcHJlY2F0ZWRMYW5nOwogICAgICByZXR1cm4gZmllbGQuc2NyaXB0ZWQgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLmxhbmd1YWdlTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0xhbmd1YWdlJwogICAgICAgIH0pLAogICAgICAgIGhlbHBUZXh0OiBpc0RlcHJlY2F0ZWRMYW5nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlJY29uLCB7CiAgICAgICAgICB0eXBlOiAiYWxlcnQiLAogICAgICAgICAgY29sb3I6ICJ3YXJuaW5nIiwKICAgICAgICAgIHNpemU6ICJzIgogICAgICAgIH0pLCAiXHhBMCIsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci53YXJuaW5nSGVhZGVyIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVwcmVjYXRpb24gV2FybmluZzoiCiAgICAgICAgfSkpLCAiXHhBMCIsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci53YXJuaW5nTGFiZWwud2FybmluZ0RldGFpbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIntsYW5ndWFnZX0gaXMgZGVwcmVjYXRlZCBhbmQgc3VwcG9ydCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIG5leHQgbWFqb3IgdmVyc2lvbiBvZiBLaWJhbmEgYW5kIEVsYXN0aWNzZWFyY2guIFdlIHJlY29tbWVuZCB1c2luZyB7cGFpbmxlc3NMaW5rfSBmb3IgbmV3IHNjcmlwdGVkIGZpZWxkcy4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGxhbmd1YWdlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29kZSwgbnVsbCwgZmllbGQubGFuZyksCiAgICAgICAgICAgIHBhaW5sZXNzTGluazogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgICB0YXJnZXQ6ICJfYmxhbmsiLAogICAgICAgICAgICAgIGhyZWY6ICgwLCBfZG9jdW1lbnRhdGlvbl9saW5rcy5nZXREb2NMaW5rKSgnc2NyaXB0ZWRGaWVsZHMucGFpbmxlc3MnKQogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLndhcm5pbmdMYWJlbC5wYWlubGVzc0xpbmtMYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQYWlubGVzcyIKICAgICAgICAgICAgfSkpCiAgICAgICAgICB9CiAgICAgICAgfSkpIDogbnVsbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkLmxhbmcsCiAgICAgICAgb3B0aW9uczogc2NyaXB0aW5nTGFuZ3MubWFwKGZ1bmN0aW9uIChsYW5nKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogbGFuZywKICAgICAgICAgICAgdGV4dDogbGFuZwogICAgICAgICAgfTsKICAgICAgICB9KSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZWRpdG9yRmllbGRMYW5nIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXMzLm9uTGFuZ0NoYW5nZShlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9KSkgOiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlclR5cGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclR5cGUoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlNiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmaWVsZCA9IF90aGlzJHN0YXRlNi5maWVsZCwKICAgICAgICAgIGZpZWxkVHlwZXMgPSBfdGhpcyRzdGF0ZTYuZmllbGRUeXBlczsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdjb21tb24udWkuZmllbGRFZGl0b3IudHlwZUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUeXBlJwogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTZWxlY3QsIHsKICAgICAgICB2YWx1ZTogZmllbGQudHlwZSwKICAgICAgICBkaXNhYmxlZDogIWZpZWxkLnNjcmlwdGVkLAogICAgICAgIG9wdGlvbnM6IGZpZWxkVHlwZXMubWFwKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB2YWx1ZTogdHlwZSwKICAgICAgICAgICAgdGV4dDogdHlwZQogICAgICAgICAgfTsKICAgICAgICB9KSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZWRpdG9yRmllbGRUeXBlIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXM0Lm9uVHlwZUNoYW5nZShlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9KSk7CiAgICB9CiAgICAvKioKICAgICAqIHJlbmRlcnMgYSB3YXJuaW5nIGFuZCBhIHRhYmxlIG9mIGNvbmZsaWN0aW5nIGluZGljZXMKICAgICAqIGluIGNhc2UgdGhlcmUgYXJlIGluZGljZXMgd2l0aCBkaWZmZXJlbnQgdHlwZXMKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW5kZXJUeXBlQ29uZmxpY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclR5cGVDb25mbGljdCgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlJGZpZWxkID0gdGhpcy5zdGF0ZS5maWVsZCwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUkZmllbGQgPT09IHZvaWQgMCA/IHt9IDogX3RoaXMkc3RhdGUkZmllbGQ7CgogICAgICBpZiAoIWZpZWxkLmNvbmZsaWN0RGVzY3JpcHRpb25zIHx8IF90eXBlb2YoZmllbGQuY29uZmxpY3REZXNjcmlwdGlvbnMpICE9PSAnb2JqZWN0JykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgY29sdW1ucyA9IFt7CiAgICAgICAgZmllbGQ6ICd0eXBlJywKICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnR5cGVMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVHlwZScKICAgICAgICB9KSwKICAgICAgICB3aWR0aDogJzEwMHB4JwogICAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdpbmRpY2VzJywKICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLmluZGV4TmFtZUxhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJbmRleCBuYW1lcycKICAgICAgICB9KQogICAgICB9XTsKICAgICAgdmFyIGl0ZW1zID0gT2JqZWN0LmVudHJpZXMoZmllbGQuY29uZmxpY3REZXNjcmlwdGlvbnMpLm1hcChmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgICB2YXIgX3JlZjQgPSBfc2xpY2VkVG9BcnJheShfcmVmMywgMiksCiAgICAgICAgICAgIHR5cGUgPSBfcmVmNFswXSwKICAgICAgICAgICAgaW5kaWNlcyA9IF9yZWY0WzFdOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgIGluZGljZXM6IEFycmF5LmlzQXJyYXkoaW5kaWNlcykgPyBpbmRpY2VzLmpvaW4oJywgJykgOiAnSW5kZXggbmFtZXMgdW5hdmFpbGFibGUnCiAgICAgICAgfTsKICAgICAgfSk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogIm0iCiAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgIGNvbG9yOiAid2FybmluZyIsCiAgICAgICAgaWNvblR5cGU6ICJhbGVydCIsCiAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5maWVsZFR5cGVDb25mbGljdCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZpZWxkIHR5cGUgY29uZmxpY3QiCiAgICAgICAgfSksCiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IubXVsdGlUeXBlTGFiZWxEZXNjIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZSB0eXBlIG9mIHRoaXMgZmllbGQgY2hhbmdlcyBhY3Jvc3MgaW5kaWNlcy4gSXQgaXMgdW5hdmFpbGFibGUgZm9yIG1hbnkgYW5hbHlzaXMgZnVuY3Rpb25zLiBUaGUgaW5kaWNlcyBwZXIgdHlwZSBhcmUgYXMgZm9sbG93czoiCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJhc2ljVGFibGUsIHsKICAgICAgICBpdGVtczogaXRlbXMsCiAgICAgICAgY29sdW1uczogY29sdW1ucwogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyRm9ybWF0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJGb3JtYXQoKSB7CiAgICAgIHZhciBfZmllbGRUeXBlRm9ybWF0cyQyLAogICAgICAgICAgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTcgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTcuZmllbGQsCiAgICAgICAgICBmaWVsZFR5cGVGb3JtYXRzID0gX3RoaXMkc3RhdGU3LmZpZWxkVHlwZUZvcm1hdHMsCiAgICAgICAgICBmaWVsZEZvcm1hdElkID0gX3RoaXMkc3RhdGU3LmZpZWxkRm9ybWF0SWQsCiAgICAgICAgICBmaWVsZEZvcm1hdFBhcmFtcyA9IF90aGlzJHN0YXRlNy5maWVsZEZvcm1hdFBhcmFtczsKICAgICAgdmFyIGZpZWxkRm9ybWF0RWRpdG9ycyA9IHRoaXMucHJvcHMuaGVscGVycy5maWVsZEZvcm1hdEVkaXRvcnM7CiAgICAgIHZhciBkZWZhdWx0Rm9ybWF0ID0gKF9maWVsZFR5cGVGb3JtYXRzJDIgPSBmaWVsZFR5cGVGb3JtYXRzWzBdKSA9PT0gbnVsbCB8fCBfZmllbGRUeXBlRm9ybWF0cyQyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZmllbGRUeXBlRm9ybWF0cyQyLmRlZmF1bHRGaWVsZEZvcm1hdC50aXRsZTsKICAgICAgdmFyIGxhYmVsID0gZGVmYXVsdEZvcm1hdCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuZGVmYXVsdEZvcm1hdEhlYWRlciIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJGb3JtYXQgKERlZmF1bHQ6IHtkZWZhdWx0Rm9ybWF0fSkiLAogICAgICAgIHZhbHVlczogewogICAgICAgICAgZGVmYXVsdEZvcm1hdDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvZGUsIG51bGwsIGRlZmF1bHRGb3JtYXQpCiAgICAgICAgfQogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuZm9ybWF0SGVhZGVyIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvcm1hdCIKICAgICAgfSk7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogbGFiZWwsCiAgICAgICAgaGVscFRleHQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5mb3JtYXRMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvcm1hdHRpbmcgYWxsb3dzIHlvdSB0byBjb250cm9sIHRoZSB3YXkgdGhhdCBzcGVjaWZpYyB2YWx1ZXMgYXJlIGRpc3BsYXllZC4gSXQgY2FuIGFsc28gY2F1c2UgdmFsdWVzIHRvIGJlIGNvbXBsZXRlbHkgY2hhbmdlZCBhbmQgcHJldmVudCBoaWdobGlnaHRpbmcgaW4gRGlzY292ZXIgZnJvbSB3b3JraW5nLiIKICAgICAgICB9KQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU2VsZWN0LCB7CiAgICAgICAgdmFsdWU6IGZpZWxkRm9ybWF0SWQsCiAgICAgICAgb3B0aW9uczogZmllbGRUeXBlRm9ybWF0cy5tYXAoZnVuY3Rpb24gKGZvcm1hdCkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdmFsdWU6IGZvcm1hdC5pZCB8fCAnJywKICAgICAgICAgICAgdGV4dDogZm9ybWF0LnRpdGxlCiAgICAgICAgICB9OwogICAgICAgIH0pLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJlZGl0b3JTZWxlY3RlZEZvcm1hdElkIiwKICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgX3RoaXM1Lm9uRm9ybWF0Q2hhbmdlKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICB9CiAgICAgIH0pKSwgZmllbGRGb3JtYXRJZCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2ZpZWxkX2Zvcm1hdF9lZGl0b3IuRmllbGRGb3JtYXRFZGl0b3IsIHsKICAgICAgICBmaWVsZFR5cGU6IGZpZWxkLnR5cGUsCiAgICAgICAgZmllbGRGb3JtYXQ6IGZpZWxkLmZvcm1hdCwKICAgICAgICBmaWVsZEZvcm1hdElkOiBmaWVsZEZvcm1hdElkLAogICAgICAgIGZpZWxkRm9ybWF0UGFyYW1zOiBmaWVsZEZvcm1hdFBhcmFtcywKICAgICAgICBmaWVsZEZvcm1hdEVkaXRvcnM6IGZpZWxkRm9ybWF0RWRpdG9ycywKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZvcm1hdFBhcmFtc0NoYW5nZSwKICAgICAgICBvbkVycm9yOiB0aGlzLm9uRm9ybWF0UGFyYW1zRXJyb3IKICAgICAgfSkgOiBudWxsKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJQb3B1bGFyaXR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJQb3B1bGFyaXR5KCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHZhciBmaWVsZCA9IHRoaXMuc3RhdGUuZmllbGQ7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnBvcHVsYXJpdHlMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUG9wdWxhcml0eScsCiAgICAgICAgICBkZXNjcmlwdGlvbjogJyJQb3B1bGFyaXR5IiByZWZlcnMgdG8gS2liYW5hXCdzIG1lYXN1cmVtZW50IGhvdyBwb3B1bGFyIGEgZmllbGQgaXMgKGkuZS4gaG93IGNvbW1vbmx5IGl0IGlzIHVzZWQpLicKICAgICAgICB9KQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGROdW1iZXIsIHsKICAgICAgICB2YWx1ZTogZmllbGQuY291bnQsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkQ291bnQiLAogICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICBfdGhpczYub25GaWVsZENoYW5nZSgnY291bnQnLCBlLnRhcmdldC52YWx1ZSA/IE51bWJlcihlLnRhcmdldC52YWx1ZSkgOiAnJyk7CiAgICAgICAgfQogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU2NyaXB0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJTY3JpcHQoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTggPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTguZmllbGQsCiAgICAgICAgICBoYXNTY3JpcHRFcnJvciA9IF90aGlzJHN0YXRlOC5oYXNTY3JpcHRFcnJvcjsKICAgICAgdmFyIGlzSW52YWxpZCA9ICFmaWVsZC5zY3JpcHQgfHwgIWZpZWxkLnNjcmlwdC50cmltKCkgfHwgaGFzU2NyaXB0RXJyb3I7CiAgICAgIHZhciBlcnJvck1zZyA9IGhhc1NjcmlwdEVycm9yID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiaW52YWxpZFNjcmlwdEVycm9yIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLnNjcmlwdEludmFsaWRFcnJvck1lc3NhZ2UiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2NyaXB0IGlzIGludmFsaWQuIFZpZXcgc2NyaXB0IHByZXZpZXcgZm9yIGRldGFpbHMiCiAgICAgIH0pKSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0UmVxdWlyZWRFcnJvck1lc3NhZ2UiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2NyaXB0IGlzIHJlcXVpcmVkIgogICAgICB9KTsKICAgICAgcmV0dXJuIGZpZWxkLnNjcmlwdGVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnY29tbW9uLnVpLmZpZWxkRWRpdG9yLnNjcmlwdExhYmVsJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTY3JpcHQnCiAgICAgICAgfSksCiAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgZXJyb3I6IGlzSW52YWxpZCA/IGVycm9yTXNnIDogbnVsbAogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29kZUVkaXRvciwgewogICAgICAgIHZhbHVlOiBmaWVsZC5zY3JpcHQsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImVkaXRvckZpZWxkU2NyaXB0IiwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vblNjcmlwdENoYW5nZSwKICAgICAgICBtb2RlOiAiZ3Jvb3Z5IiwKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjMwMHB4IgogICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRleHQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3Iuc2NyaXB0LmFjY2Vzc1dpdGhMYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJBY2Nlc3MgZmllbGRzIHdpdGgge2NvZGV9LiIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBjb2RlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgbnVsbCwgImRvY1snc29tZV9maWVsZCddLnZhbHVlIikKICAgICAgICB9CiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiYnIiLCBudWxsKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICBvbkNsaWNrOiB0aGlzLnNob3dTY3JpcHRpbmdIZWxwLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzY3JpcHRlZEZpZWxkc0hlbHBMaW5rIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiY29tbW9uLnVpLmZpZWxkRWRpdG9yLnNjcmlwdC5nZXRIZWxwTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiR2V0IGhlbHAgd2l0aCB0aGUgc3ludGF4IGFuZCBwcmV2aWV3IHRoZSByZXN1bHRzIG9mIHlvdXIgc2NyaXB0LiIKICAgICAgfSkpKSkpIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJBY3Rpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJBY3Rpb25zKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGU5ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIGlzQ3JlYXRpbmcgPSBfdGhpcyRzdGF0ZTkuaXNDcmVhdGluZywKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGU5LmZpZWxkLAogICAgICAgICAgaXNTYXZpbmcgPSBfdGhpcyRzdGF0ZTkuaXNTYXZpbmc7CiAgICAgIHZhciByZWRpcmVjdEF3YXkgPSB0aGlzLnByb3BzLmhlbHBlcnMucmVkaXJlY3RBd2F5OwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b24sIHsKICAgICAgICBmaWxsOiB0cnVlLAogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2F2ZUZpZWxkLAogICAgICAgIGlzRGlzYWJsZWQ6IHRoaXMuaXNTYXZpbmdEaXNhYmxlZCgpLAogICAgICAgIGlzTG9hZGluZzogaXNTYXZpbmcsCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImZpZWxkU2F2ZUJ1dHRvbiIKICAgICAgfSwgaXNDcmVhdGluZyA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuYWN0aW9ucy5jcmVhdGVCdXR0b24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ3JlYXRlIGZpZWxkIgogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuYWN0aW9ucy5zYXZlQnV0dG9uIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgZmllbGQiCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgIG9uQ2xpY2s6IHJlZGlyZWN0QXdheSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZmllbGRDYW5jZWxCdXR0b24iCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuYWN0aW9ucy5jYW5jZWxCdXR0b24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIgogICAgICB9KSkpLCAhaXNDcmVhdGluZyAmJiBmaWVsZC5zY3JpcHRlZCA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGp1c3RpZnlDb250ZW50OiAiZmxleEVuZCIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgY29sb3I6ICJkYW5nZXIiLAogICAgICAgIG9uQ2xpY2s6IHRoaXMuc2hvd0RlbGV0ZU1vZGFsCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuYWN0aW9ucy5kZWxldGVCdXR0b24iLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRGVsZXRlIgogICAgICB9KSkpKSkgOiBudWxsKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNTYXZpbmdEaXNhYmxlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNTYXZpbmdEaXNhYmxlZCgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMTAgPSB0aGlzLnN0YXRlLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTEwLmZpZWxkLAogICAgICAgICAgaGFzRm9ybWF0RXJyb3IgPSBfdGhpcyRzdGF0ZTEwLmhhc0Zvcm1hdEVycm9yLAogICAgICAgICAgaGFzU2NyaXB0RXJyb3IgPSBfdGhpcyRzdGF0ZTEwLmhhc1NjcmlwdEVycm9yOwoKICAgICAgaWYgKGhhc0Zvcm1hdEVycm9yIHx8IGhhc1NjcmlwdEVycm9yIHx8ICFmaWVsZC5uYW1lIHx8ICFmaWVsZC5uYW1lLnRyaW0oKSB8fCBmaWVsZC5zY3JpcHRlZCAmJiAoIWZpZWxkLnNjcmlwdCB8fCAhZmllbGQuc2NyaXB0LnRyaW0oKSkpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUxMSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpc1JlYWR5ID0gX3RoaXMkc3RhdGUxMS5pc1JlYWR5LAogICAgICAgICAgaXNDcmVhdGluZyA9IF90aGlzJHN0YXRlMTEuaXNDcmVhdGluZywKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUxMS5maWVsZDsKICAgICAgcmV0dXJuIGlzUmVhZHkgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDMiLCBudWxsLCBpc0NyZWF0aW5nID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImNvbW1vbi51aS5maWVsZEVkaXRvci5jcmVhdGVIZWFkZXIiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ3JlYXRlIHNjcmlwdGVkIGZpZWxkIgogICAgICB9KSA6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJjb21tb24udWkuZmllbGRFZGl0b3IuZWRpdEhlYWRlciIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJFZGl0IHtmaWVsZE5hbWV9IiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIGZpZWxkTmFtZTogZmllbGQubmFtZQogICAgICAgIH0KICAgICAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm0sIG51bGwsIHRoaXMucmVuZGVyU2NyaXB0aW5nUGFuZWxzKCksIHRoaXMucmVuZGVyTmFtZSgpLCB0aGlzLnJlbmRlckxhbmd1YWdlKCksIHRoaXMucmVuZGVyVHlwZSgpLCB0aGlzLnJlbmRlclR5cGVDb25mbGljdCgpLCB0aGlzLnJlbmRlckZvcm1hdCgpLCB0aGlzLnJlbmRlclBvcHVsYXJpdHkoKSwgdGhpcy5yZW5kZXJTY3JpcHQoKSwgdGhpcy5yZW5kZXJBY3Rpb25zKCksIHRoaXMucmVuZGVyRGVsZXRlTW9kYWwoKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibCIKICAgICAgfSkpIDogbnVsbDsKICAgIH0KICB9XSk7CgogIHJldHVybiBGaWVsZEVkaXRvcjsKfShfcmVhY3QuUHVyZUNvbXBvbmVudCk7CgpleHBvcnRzLkZpZWxkRWRpdG9yID0gRmllbGRFZGl0b3I7CgpfZGVmaW5lUHJvcGVydHkoRmllbGRFZGl0b3IsICJwcm9wVHlwZXMiLCB7CiAgaW5kZXhQYXR0ZXJuOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LmlzUmVxdWlyZWQsCiAgZmllbGQ6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICBoZWxwZXJzOiBfcHJvcFR5cGVzLmRlZmF1bHQuc2hhcGUoewogICAgRmllbGQ6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgICBnZXRDb25maWc6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgICAkaHR0cDogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICAgIGZpZWxkRm9ybWF0RWRpdG9yczogX3Byb3BUeXBlcy5kZWZhdWx0Lm9iamVjdC5pc1JlcXVpcmVkLAogICAgcmVkaXJlY3RBd2F5OiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkCiAgfSkKfSk7"},null]}