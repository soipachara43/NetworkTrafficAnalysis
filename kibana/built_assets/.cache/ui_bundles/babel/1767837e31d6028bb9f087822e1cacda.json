{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/index_patterns/create_index_pattern_wizard/components/step_index_pattern/step_index_pattern.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/index_patterns/create_index_pattern_wizard/components/step_index_pattern/step_index_pattern.js","mtime":1589249549810},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU3RlcEluZGV4UGF0dGVybiA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29uc3RhbnRzIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4uLy4uL2xpYiIpOwoKdmFyIF9sb2FkaW5nX2luZGljZXMgPSByZXF1aXJlKCIuL2NvbXBvbmVudHMvbG9hZGluZ19pbmRpY2VzIik7Cgp2YXIgX3N0YXR1c19tZXNzYWdlID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL3N0YXR1c19tZXNzYWdlIik7Cgp2YXIgX2luZGljZXNfbGlzdCA9IHJlcXVpcmUoIi4vY29tcG9uZW50cy9pbmRpY2VzX2xpc3QiKTsKCnZhciBfaGVhZGVyID0gcmVxdWlyZSgiLi9jb21wb25lbnRzL2hlYWRlciIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIFN0ZXBJbmRleFBhdHRlcm4gPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfQ29tcG9uZW50KSB7CiAgX2luaGVyaXRzKFN0ZXBJbmRleFBhdHRlcm4sIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBTdGVwSW5kZXhQYXR0ZXJuKHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN0ZXBJbmRleFBhdHRlcm4pOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFN0ZXBJbmRleFBhdHRlcm4pLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHsKICAgICAgcGFydGlhbE1hdGNoZWRJbmRpY2VzOiBbXSwKICAgICAgZXhhY3RNYXRjaGVkSW5kaWNlczogW10sCiAgICAgIGlzTG9hZGluZ0luZGljZXM6IGZhbHNlLAogICAgICBleGlzdGluZ0luZGV4UGF0dGVybnM6IFtdLAogICAgICBpbmRleFBhdHRlcm5FeGlzdHM6IGZhbHNlLAogICAgICBxdWVyeTogJycsCiAgICAgIGFwcGVuZGVkV2lsZGNhcmQ6IGZhbHNlLAogICAgICBzaG93aW5nSW5kZXhQYXR0ZXJuUXVlcnlFcnJvcnM6IGZhbHNlLAogICAgICBpbmRleFBhdHRlcm5OYW1lOiAnJwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiSUxMRUdBTF9DSEFSQUNURVJTIiwgX3RvQ29uc3VtYWJsZUFycmF5KF9wdWJsaWMuaW5kZXhQYXR0ZXJucy5JTExFR0FMX0NIQVJBQ1RFUlMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJsYXN0UXVlcnkiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZldGNoRXhpc3RpbmdJbmRleFBhdHRlcm5zIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIF9yZWYyLCBzYXZlZE9iamVjdHMsIGV4aXN0aW5nSW5kZXhQYXR0ZXJuczsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvcHMuc2F2ZWRPYmplY3RzQ2xpZW50LmZpbmQoewogICAgICAgICAgICAgICAgdHlwZTogJ2luZGV4LXBhdHRlcm4nLAogICAgICAgICAgICAgICAgZmllbGRzOiBbJ3RpdGxlJ10sCiAgICAgICAgICAgICAgICBwZXJQYWdlOiAxMDAwMAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIF9yZWYyID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICBzYXZlZE9iamVjdHMgPSBfcmVmMi5zYXZlZE9iamVjdHM7CiAgICAgICAgICAgICAgZXhpc3RpbmdJbmRleFBhdHRlcm5zID0gc2F2ZWRPYmplY3RzLm1hcChmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JqICYmIG9iai5hdHRyaWJ1dGVzID8gb2JqLmF0dHJpYnV0ZXMudGl0bGUgOiAnJzsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZXhpc3RpbmdJbmRleFBhdHRlcm5zOiBleGlzdGluZ0luZGV4UGF0dGVybnMKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZldGNoSW5kaWNlcyIsCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKHF1ZXJ5KSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzLCBlc1NlcnZpY2UsIGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZSwgZXhpc3RpbmdJbmRleFBhdHRlcm5zLCBfZXhhY3RNYXRjaGVkSW5kaWNlcywgX3JlZjQsIF9yZWY1LCBwYXJ0aWFsTWF0Y2hlZEluZGljZXMsIGV4YWN0TWF0Y2hlZEluZGljZXM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfdGhpcyRwcm9wcyA9IF90aGlzLnByb3BzLCBlc1NlcnZpY2UgPSBfdGhpcyRwcm9wcy5lc1NlcnZpY2UsIGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZSA9IF90aGlzJHByb3BzLmluZGV4UGF0dGVybkNyZWF0aW9uVHlwZTsKICAgICAgICAgICAgICAgIGV4aXN0aW5nSW5kZXhQYXR0ZXJucyA9IF90aGlzLnN0YXRlLmV4aXN0aW5nSW5kZXhQYXR0ZXJuczsKCiAgICAgICAgICAgICAgICBpZiAoIWV4aXN0aW5nSW5kZXhQYXR0ZXJucy5pbmNsdWRlcyhxdWVyeSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybkV4aXN0czogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGlzTG9hZGluZ0luZGljZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybkV4aXN0czogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghcXVlcnkuZW5kc1dpdGgoJyonKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIF9saWIuZW5zdXJlTWluaW11bVRpbWUpKCgwLCBfbGliLmdldEluZGljZXMpKGVzU2VydmljZSwgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLCBxdWVyeSwgX2NvbnN0YW50cy5NQVhfU0VBUkNIX1NJWkUpKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2V4YWN0TWF0Y2hlZEluZGljZXMgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShxdWVyeSAhPT0gX3RoaXMubGFzdFF1ZXJ5KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICAgIGV4YWN0TWF0Y2hlZEluZGljZXM6IF9leGFjdE1hdGNoZWRJbmRpY2VzLAogICAgICAgICAgICAgICAgICBpc0xvYWRpbmdJbmRpY2VzOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2xpYi5lbnN1cmVNaW5pbXVtVGltZSkoWygwLCBfbGliLmdldEluZGljZXMpKGVzU2VydmljZSwgaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLCAiIi5jb25jYXQocXVlcnksICIqIiksIF9jb25zdGFudHMuTUFYX1NFQVJDSF9TSVpFKSwgKDAsIF9saWIuZ2V0SW5kaWNlcykoZXNTZXJ2aWNlLCBpbmRleFBhdHRlcm5DcmVhdGlvblR5cGUsIHF1ZXJ5LCBfY29uc3RhbnRzLk1BWF9TRUFSQ0hfU0laRSldKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIF9yZWY0ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBfcmVmNSA9IF9zbGljZWRUb0FycmF5KF9yZWY0LCAyKTsKICAgICAgICAgICAgICAgIHBhcnRpYWxNYXRjaGVkSW5kaWNlcyA9IF9yZWY1WzBdOwogICAgICAgICAgICAgICAgZXhhY3RNYXRjaGVkSW5kaWNlcyA9IF9yZWY1WzFdOwoKICAgICAgICAgICAgICAgIGlmICghKHF1ZXJ5ICE9PSBfdGhpcy5sYXN0UXVlcnkpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgcGFydGlhbE1hdGNoZWRJbmRpY2VzOiBwYXJ0aWFsTWF0Y2hlZEluZGljZXMsCiAgICAgICAgICAgICAgICAgIGV4YWN0TWF0Y2hlZEluZGljZXM6IGV4YWN0TWF0Y2hlZEluZGljZXMsCiAgICAgICAgICAgICAgICAgIGlzTG9hZGluZ0luZGljZXM6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25RdWVyeUNoYW5nZWQiLCBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgYXBwZW5kZWRXaWxkY2FyZCA9IF90aGlzLnN0YXRlLmFwcGVuZGVkV2lsZGNhcmQ7CiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDsKICAgICAgdmFyIHF1ZXJ5ID0gdGFyZ2V0LnZhbHVlOwoKICAgICAgaWYgKHF1ZXJ5Lmxlbmd0aCA9PT0gMSAmJiAoMCwgX2xpYi5jYW5BcHBlbmRXaWxkY2FyZCkocXVlcnkpKSB7CiAgICAgICAgcXVlcnkgKz0gJyonOwoKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBhcHBlbmRlZFdpbGRjYXJkOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRhcmdldC5zZXRTZWxlY3Rpb25SYW5nZSgxLCAxKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocXVlcnkgPT09ICcqJyAmJiBhcHBlbmRlZFdpbGRjYXJkKSB7CiAgICAgICAgICBxdWVyeSA9ICcnOwoKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgYXBwZW5kZWRXaWxkY2FyZDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgX3RoaXMubGFzdFF1ZXJ5ID0gcXVlcnk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgIHNob3dpbmdJbmRleFBhdHRlcm5RdWVyeUVycm9yczogISFxdWVyeS5sZW5ndGgKICAgICAgfSk7CgogICAgICBfdGhpcy5mZXRjaEluZGljZXMocXVlcnkpOwogICAgfSk7CgogICAgdmFyIF90aGlzJHByb3BzMiA9IF90aGlzLnByb3BzLAogICAgICAgIF9pbmRleFBhdHRlcm5DcmVhdGlvblR5cGUgPSBfdGhpcyRwcm9wczIuaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlLAogICAgICAgIGluaXRpYWxRdWVyeSA9IF90aGlzJHByb3BzMi5pbml0aWFsUXVlcnk7CiAgICBfdGhpcy5zdGF0ZS5xdWVyeSA9IGluaXRpYWxRdWVyeSB8fCBwcm9wcy51aVNldHRpbmdzLmdldCgnaW5kZXhQYXR0ZXJuOnBsYWNlaG9sZGVyJyk7CiAgICBfdGhpcy5zdGF0ZS5pbmRleFBhdHRlcm5OYW1lID0gX2luZGV4UGF0dGVybkNyZWF0aW9uVHlwZS5nZXRJbmRleFBhdHRlcm5OYW1lKCk7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU3RlcEluZGV4UGF0dGVybiwgW3sKICAgIGtleTogIlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hFeGlzdGluZ0luZGV4UGF0dGVybnMoKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5xdWVyeSkgewogICAgICAgICAgICAgICAgICB0aGlzLmxhc3RRdWVyeSA9IHRoaXMuc3RhdGUucXVlcnk7CiAgICAgICAgICAgICAgICAgIHRoaXMuZmV0Y2hJbmRpY2VzKHRoaXMuc3RhdGUucXVlcnkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBVTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkgewogICAgICAgIHJldHVybiBfVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInJlbmRlckxvYWRpbmdTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTG9hZGluZ1N0YXRlKCkgewogICAgICB2YXIgaXNMb2FkaW5nSW5kaWNlcyA9IHRoaXMuc3RhdGUuaXNMb2FkaW5nSW5kaWNlczsKCiAgICAgIGlmICghaXNMb2FkaW5nSW5kaWNlcykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbG9hZGluZ19pbmRpY2VzLkxvYWRpbmdJbmRpY2VzLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZUluZGV4UGF0dGVyblN0ZXAxTG9hZGluZyIKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU3RhdHVzTWVzc2FnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyU3RhdHVzTWVzc2FnZShtYXRjaGVkSW5kaWNlcykgewogICAgICB2YXIgX3RoaXMkcHJvcHMzID0gdGhpcy5wcm9wcywKICAgICAgICAgIGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZSA9IF90aGlzJHByb3BzMy5pbmRleFBhdHRlcm5DcmVhdGlvblR5cGUsCiAgICAgICAgICBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXMgPSBfdGhpcyRwcm9wczMuaXNJbmNsdWRpbmdTeXN0ZW1JbmRpY2VzOwogICAgICB2YXIgX3RoaXMkc3RhdGUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgcXVlcnkgPSBfdGhpcyRzdGF0ZS5xdWVyeSwKICAgICAgICAgIGlzTG9hZGluZ0luZGljZXMgPSBfdGhpcyRzdGF0ZS5pc0xvYWRpbmdJbmRpY2VzLAogICAgICAgICAgaW5kZXhQYXR0ZXJuRXhpc3RzID0gX3RoaXMkc3RhdGUuaW5kZXhQYXR0ZXJuRXhpc3RzOwoKICAgICAgaWYgKGlzTG9hZGluZ0luZGljZXMgfHwgaW5kZXhQYXR0ZXJuRXhpc3RzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zdGF0dXNfbWVzc2FnZS5TdGF0dXNNZXNzYWdlLCB7CiAgICAgICAgbWF0Y2hlZEluZGljZXM6IG1hdGNoZWRJbmRpY2VzLAogICAgICAgIHNob3dTeXN0ZW1JbmRpY2VzOiBpbmRleFBhdHRlcm5DcmVhdGlvblR5cGUuZ2V0U2hvd1N5c3RlbUluZGljZXMoKSwKICAgICAgICBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXM6IGlzSW5jbHVkaW5nU3lzdGVtSW5kaWNlcywKICAgICAgICBxdWVyeTogcXVlcnkKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTGlzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTGlzdChfcmVmNikgewogICAgICB2YXIgdmlzaWJsZUluZGljZXMgPSBfcmVmNi52aXNpYmxlSW5kaWNlcywKICAgICAgICAgIGFsbEluZGljZXMgPSBfcmVmNi5hbGxJbmRpY2VzOwogICAgICB2YXIgX3RoaXMkc3RhdGUyID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIHF1ZXJ5ID0gX3RoaXMkc3RhdGUyLnF1ZXJ5LAogICAgICAgICAgaXNMb2FkaW5nSW5kaWNlcyA9IF90aGlzJHN0YXRlMi5pc0xvYWRpbmdJbmRpY2VzLAogICAgICAgICAgaW5kZXhQYXR0ZXJuRXhpc3RzID0gX3RoaXMkc3RhdGUyLmluZGV4UGF0dGVybkV4aXN0czsKCiAgICAgIGlmIChpc0xvYWRpbmdJbmRpY2VzIHx8IGluZGV4UGF0dGVybkV4aXN0cykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgaW5kaWNlc1RvTGlzdCA9IHF1ZXJ5Lmxlbmd0aCA/IHZpc2libGVJbmRpY2VzIDogYWxsSW5kaWNlczsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2luZGljZXNfbGlzdC5JbmRpY2VzTGlzdCwgewogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJjcmVhdGVJbmRleFBhdHRlcm5TdGVwMUluZGljZXNMaXN0IiwKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgaW5kaWNlczogaW5kaWNlc1RvTGlzdAogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJJbmRleFBhdHRlcm5FeGlzdHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckluZGV4UGF0dGVybkV4aXN0cygpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpbmRleFBhdHRlcm5FeGlzdHMgPSBfdGhpcyRzdGF0ZTMuaW5kZXhQYXR0ZXJuRXhpc3RzLAogICAgICAgICAgcXVlcnkgPSBfdGhpcyRzdGF0ZTMucXVlcnk7CgogICAgICBpZiAoIWluZGV4UGF0dGVybkV4aXN0cykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQuY3JlYXRlSW5kZXhQYXR0ZXJuLnN0ZXAud2FybmluZ0hlYWRlciIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZXJlJ3MgYWxyZWFkeSBhbiBpbmRleCBwYXR0ZXJuIGNhbGxlZCB7cXVlcnl9IiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBxdWVyeTogcXVlcnkKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICBpY29uVHlwZTogImhlbHAiLAogICAgICAgIGNvbG9yOiAid2FybmluZyIKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVySGVhZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJIZWFkZXIoX3JlZjcpIHsKICAgICAgdmFyIGluZGljZXMgPSBfcmVmNy5leGFjdE1hdGNoZWRJbmRpY2VzOwogICAgICB2YXIgX3RoaXMkcHJvcHM0ID0gdGhpcy5wcm9wcywKICAgICAgICAgIGdvVG9OZXh0U3RlcCA9IF90aGlzJHByb3BzNC5nb1RvTmV4dFN0ZXAsCiAgICAgICAgICBpbmRleFBhdHRlcm5DcmVhdGlvblR5cGUgPSBfdGhpcyRwcm9wczQuaW5kZXhQYXR0ZXJuQ3JlYXRpb25UeXBlOwogICAgICB2YXIgX3RoaXMkc3RhdGU0ID0gdGhpcy5zdGF0ZSwKICAgICAgICAgIHF1ZXJ5ID0gX3RoaXMkc3RhdGU0LnF1ZXJ5LAogICAgICAgICAgc2hvd2luZ0luZGV4UGF0dGVyblF1ZXJ5RXJyb3JzID0gX3RoaXMkc3RhdGU0LnNob3dpbmdJbmRleFBhdHRlcm5RdWVyeUVycm9ycywKICAgICAgICAgIGluZGV4UGF0dGVybkV4aXN0cyA9IF90aGlzJHN0YXRlNC5pbmRleFBhdHRlcm5FeGlzdHMsCiAgICAgICAgICBpbmRleFBhdHRlcm5OYW1lID0gX3RoaXMkc3RhdGU0LmluZGV4UGF0dGVybk5hbWU7CiAgICAgIHZhciBjb250YWluc0Vycm9ycyA9IGZhbHNlOwogICAgICB2YXIgZXJyb3JzID0gW107CiAgICAgIHZhciBjaGFyYWN0ZXJMaXN0ID0gdGhpcy5JTExFR0FMX0NIQVJBQ1RFUlMuc2xpY2UoMCwgdGhpcy5JTExFR0FMX0NIQVJBQ1RFUlMubGVuZ3RoIC0gMSkuam9pbignLCAnKTsKICAgICAgdmFyIGNoZWNrSW5kaWNlcyA9IGluZGV4UGF0dGVybkNyZWF0aW9uVHlwZS5jaGVja0luZGljZXNGb3JFcnJvcnMoaW5kaWNlcyk7CgogICAgICBpZiAoIXF1ZXJ5IHx8ICFxdWVyeS5sZW5ndGggfHwgcXVlcnkgPT09ICcuJyB8fCBxdWVyeSA9PT0gJy4uJykgewogICAgICAgIC8vIFRoaXMgaXMgYW4gZXJyb3Igc2NlbmFyaW8gYnV0IGRvIG5vdCByZXBvcnQgYW4gZXJyb3IKICAgICAgICBjb250YWluc0Vycm9ycyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoKDAsIF9saWIuY29udGFpbnNJbGxlZ2FsQ2hhcmFjdGVycykocXVlcnksIF9wdWJsaWMuaW5kZXhQYXR0ZXJucy5JTExFR0FMX0NIQVJBQ1RFUlMpKSB7CiAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5jcmVhdGVJbmRleFBhdHRlcm4uc3RlcC5pbnZhbGlkQ2hhcmFjdGVyc0Vycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQSB7aW5kZXhQYXR0ZXJuTmFtZX0gY2Fubm90IGNvbnRhaW4gc3BhY2VzIG9yIHRoZSBjaGFyYWN0ZXJzOiB7Y2hhcmFjdGVyTGlzdH0nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNoYXJhY3Rlckxpc3Q6IGNoYXJhY3Rlckxpc3QsCiAgICAgICAgICAgIGluZGV4UGF0dGVybk5hbWU6IGluZGV4UGF0dGVybk5hbWUKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZXJyb3JzLnB1c2goZXJyb3JNZXNzYWdlKTsKICAgICAgICBjb250YWluc0Vycm9ycyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoY2hlY2tJbmRpY2VzKSB7CiAgICAgICAgZXJyb3JzLnB1c2guYXBwbHkoZXJyb3JzLCBfdG9Db25zdW1hYmxlQXJyYXkoY2hlY2tJbmRpY2VzKSk7CiAgICAgICAgY29udGFpbnNFcnJvcnMgPSB0cnVlOwogICAgICB9CgogICAgICB2YXIgaXNJbnB1dEludmFsaWQgPSBzaG93aW5nSW5kZXhQYXR0ZXJuUXVlcnlFcnJvcnMgJiYgY29udGFpbnNFcnJvcnMgJiYgZXJyb3JzLmxlbmd0aCA+IDA7CiAgICAgIHZhciBpc05leHRTdGVwRGlzYWJsZWQgPSBjb250YWluc0Vycm9ycyB8fCBpbmRpY2VzLmxlbmd0aCA9PT0gMCB8fCBpbmRleFBhdHRlcm5FeGlzdHM7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9oZWFkZXIuSGVhZGVyLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNyZWF0ZUluZGV4UGF0dGVyblN0ZXAxSGVhZGVyIiwKICAgICAgICBpc0lucHV0SW52YWxpZDogaXNJbnB1dEludmFsaWQsCiAgICAgICAgZXJyb3JzOiBlcnJvcnMsCiAgICAgICAgY2hhcmFjdGVyTGlzdDogY2hhcmFjdGVyTGlzdCwKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgb25RdWVyeUNoYW5nZWQ6IHRoaXMub25RdWVyeUNoYW5nZWQsCiAgICAgICAgZ29Ub05leHRTdGVwOiBnb1RvTmV4dFN0ZXAsCiAgICAgICAgaXNOZXh0U3RlcERpc2FibGVkOiBpc05leHRTdGVwRGlzYWJsZWQKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wczUgPSB0aGlzLnByb3BzLAogICAgICAgICAgaXNJbmNsdWRpbmdTeXN0ZW1JbmRpY2VzID0gX3RoaXMkcHJvcHM1LmlzSW5jbHVkaW5nU3lzdGVtSW5kaWNlcywKICAgICAgICAgIGFsbEluZGljZXMgPSBfdGhpcyRwcm9wczUuYWxsSW5kaWNlczsKICAgICAgdmFyIF90aGlzJHN0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBwYXJ0aWFsTWF0Y2hlZEluZGljZXMgPSBfdGhpcyRzdGF0ZTUucGFydGlhbE1hdGNoZWRJbmRpY2VzLAogICAgICAgICAgZXhhY3RNYXRjaGVkSW5kaWNlcyA9IF90aGlzJHN0YXRlNS5leGFjdE1hdGNoZWRJbmRpY2VzOwogICAgICB2YXIgbWF0Y2hlZEluZGljZXMgPSAoMCwgX2xpYi5nZXRNYXRjaGVkSW5kaWNlcykoYWxsSW5kaWNlcywgcGFydGlhbE1hdGNoZWRJbmRpY2VzLCBleGFjdE1hdGNoZWRJbmRpY2VzLCBpc0luY2x1ZGluZ1N5c3RlbUluZGljZXMpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBhbmVsLCB7CiAgICAgICAgcGFkZGluZ1NpemU6ICJsIgogICAgICB9LCB0aGlzLnJlbmRlckhlYWRlcihtYXRjaGVkSW5kaWNlcyksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksIHRoaXMucmVuZGVyTG9hZGluZ1N0YXRlKCksIHRoaXMucmVuZGVySW5kZXhQYXR0ZXJuRXhpc3RzKCksIHRoaXMucmVuZGVyU3RhdHVzTWVzc2FnZShtYXRjaGVkSW5kaWNlcyksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksIHRoaXMucmVuZGVyTGlzdChtYXRjaGVkSW5kaWNlcykpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN0ZXBJbmRleFBhdHRlcm47Cn0oX3JlYWN0LkNvbXBvbmVudCk7CgpleHBvcnRzLlN0ZXBJbmRleFBhdHRlcm4gPSBTdGVwSW5kZXhQYXR0ZXJuOw=="},null]}