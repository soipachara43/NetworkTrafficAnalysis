{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/management/sections/objects/components/objects_table/components/flyout/flyout.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/management/sections/objects/components/objects_table/components/flyout/flyout.js","mtime":1589249549846},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZseW91dCA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2xpYiIpOwoKdmFyIF9wcm9jZXNzX2ltcG9ydF9yZXNwb25zZSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2xpYi9wcm9jZXNzX2ltcG9ydF9yZXNwb25zZSIpOwoKdmFyIF9yZXNvbHZlX3NhdmVkX29iamVjdHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9saWIvcmVzb2x2ZV9zYXZlZF9vYmplY3RzIik7Cgp2YXIgX29iamVjdHNfdGFibGUgPSByZXF1aXJlKCIuLi8uLi9vYmplY3RzX3RhYmxlIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsgfSk7IGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsgfSByZXR1cm4ga2V5czsgfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307IGlmIChpICUgMikgeyBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSB9IHJldHVybiB0YXJnZXQ7IH0KCmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkgeyByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsgdmFyIF9hcnIgPSBbXTsgdmFyIF9uID0gdHJ1ZTsgdmFyIF9kID0gZmFsc2U7IHZhciBfZSA9IHVuZGVmaW5lZDsgdHJ5IHsgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgeyBfYXJyLnB1c2goX3MudmFsdWUpOyBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7IH0gfSBjYXRjaCAoZXJyKSB7IF9kID0gdHJ1ZTsgX2UgPSBlcnI7IH0gZmluYWxseSB7IHRyeSB7IGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOyB9IGZpbmFsbHkgeyBpZiAoX2QpIHRocm93IF9lOyB9IH0gcmV0dXJuIF9hcnI7IH0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsgfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHNlbGYgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7IGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7IH0gX25leHQodW5kZWZpbmVkKTsgfSk7IH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsgcmV0dXJuIGNhbGw7IH0gcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7IH0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7IHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7IH07IHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7IH0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgeyBpZiAoc2VsZiA9PT0gdm9pZCAwKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7IH0gcmV0dXJuIHNlbGY7IH0KCmZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgeyBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpOyB9IHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7IH0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBvLl9fcHJvdG9fXyA9IHA7IHJldHVybiBvOyB9OyByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIEZseW91dCA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmx5b3V0LCBfQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRmx5b3V0KHByb3BzKSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEZseW91dCk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoRmx5b3V0KS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2hJbmRleFBhdHRlcm5zIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgdmFyIGluZGV4UGF0dGVybnM7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMucHJvcHMuaW5kZXhQYXR0ZXJucy5nZXRGaWVsZHMoWydpZCcsICd0aXRsZSddKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBpbmRleFBhdHRlcm5zID0gX2NvbnRleHQuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuczogaW5kZXhQYXR0ZXJucwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY2hhbmdlT3ZlcndyaXRlQWxsIiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgaXNPdmVyd3JpdGVBbGxDaGVja2VkOiAhc3RhdGUuaXNPdmVyd3JpdGVBbGxDaGVja2VkCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZXRJbXBvcnRGaWxlIiwgZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgIHZhciBfcmVmMyA9IF9zbGljZWRUb0FycmF5KF9yZWYyLCAxKSwKICAgICAgICAgIGZpbGUgPSBfcmVmM1swXTsKCiAgICAgIGlmICghZmlsZSkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGZpbGU6IHVuZGVmaW5lZCwKICAgICAgICAgIGlzTGVnYWN5RmlsZTogZmFsc2UKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgZmlsZTogZmlsZSwKICAgICAgICBpc0xlZ2FjeUZpbGU6IC9cLmpzb24kL2kudGVzdChmaWxlLm5hbWUpIHx8IGZpbGUudHlwZSA9PT0gJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW1wb3J0IiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSwgZmlsZSwgaXNPdmVyd3JpdGVBbGxDaGVja2VkLCByZXNwb25zZTsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwgZmlsZSA9IF90aGlzJHN0YXRlLmZpbGUsIGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCA9IF90aGlzJHN0YXRlLmlzT3ZlcndyaXRlQWxsQ2hlY2tlZDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnbG9hZGluZycsCiAgICAgICAgICAgICAgICBlcnJvcjogdW5kZWZpbmVkCiAgICAgICAgICAgICAgfSk7IC8vIEltcG9ydCB0aGUgZmlsZQoKCiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAyOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgICByZXR1cm4gKDAsIF9saWIuaW1wb3J0RmlsZSkoZmlsZSwgaXNPdmVyd3JpdGVBbGxDaGVja2VkKTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA4OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgyKTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICAgICAgZXJyb3I6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuaW1wb3J0RmlsZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgZmlsZSBjb3VsZCBub3QgYmUgcHJvY2Vzc2VkLicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoKDAsIF9wcm9jZXNzX2ltcG9ydF9yZXNwb25zZS5wcm9jZXNzSW1wb3J0UmVzcG9uc2UpKHJlc3BvbnNlKSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy8gUmVzb2x2ZSBpbXBvcnQgZXJyb3JzIHJpZ2h0IGF3YXkgaWYgdGhlcmUncyBubyBpbmRleCBwYXR0ZXJucyB0byBtYXRjaAogICAgICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGFzayBhYm91dCBvdmVyd3JpdGluZyBlYWNoIG9iamVjdCwgZXRjCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc3RhdGUudW5tYXRjaGVkUmVmZXJlbmNlcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgX3RoaXMucmVzb2x2ZUltcG9ydEVycm9ycygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzIsIDhdXSk7CiAgICB9KSkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImdldENvbmZsaWN0UmVzb2x1dGlvbnMiLAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhvYmplY3RzKSB7CiAgICAgICAgdmFyIHJlc29sdXRpb25zLCBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uLCBfZGlkSXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yRXJyb3IsIF9sb29wLCBfaXRlcmF0b3IsIF9zdGVwOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmVzb2x1dGlvbnMgPSB7fTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSA0OwogICAgICAgICAgICAgICAgX2xvb3AgPQogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2xvb3AoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfc3RlcCR2YWx1ZSwgdHlwZSwgaWQsIHRpdGxlLCBvdmVyd3JpdGU7CgogICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2xvb3AkKF9jb250ZXh0MykgewogICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgIF9zdGVwJHZhbHVlID0gX3N0ZXAudmFsdWUsIHR5cGUgPSBfc3RlcCR2YWx1ZS50eXBlLCBpZCA9IF9zdGVwJHZhbHVlLmlkLCB0aXRsZSA9IF9zdGVwJHZhbHVlLnRpdGxlOwogICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RpbmdSZWNvcmQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9uZTogcmVzb2x2ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVyd3JpdGUgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uc1siIi5jb25jYXQodHlwZSwgIjoiKS5jb25jYXQoaWQpXSA9IG92ZXJ3cml0ZTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmxpY3RpbmdSZWNvcmQ6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSwgX2xvb3ApOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3IgPSBvYmplY3RzW1N5bWJvbC5pdGVyYXRvcl0oKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgaWYgKF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSAoX3N0ZXAgPSBfaXRlcmF0b3IubmV4dCgpKS5kb25lKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuZGVsZWdhdGVZaWVsZChfbG9vcCgpLCAidDAiLCA5KTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDEgPSBfY29udGV4dDRbImNhdGNoIl0oNCk7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICBfaXRlcmF0b3JFcnJvciA9IF9jb250ZXh0NC50MTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTg7CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDE5OwoKICAgICAgICAgICAgICAgIGlmICghX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiAmJiBfaXRlcmF0b3IucmV0dXJuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSAyMTsKCiAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yOwoKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5maW5pc2goMjEpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5maW5pc2goMTgpOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHJlc29sdXRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSAyNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1s0LCAxNCwgMTgsIDI2XSwgWzE5LCwgMjEsIDI1XV0pOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94KSB7CiAgICAgICAgcmV0dXJuIF9yZWY1LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlc29sdmVJbXBvcnRFcnJvcnMiLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgdmFyIHVwZGF0ZWRTdGF0ZTsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDUpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBlcnJvcjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnbG9hZGluZycsCiAgICAgICAgICAgICAgICBsb2FkaW5nTWVzc2FnZTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0NS5wcmV2ID0gMTsKICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfbGliLnJlc29sdmVJbXBvcnRFcnJvcnMpKHsKICAgICAgICAgICAgICAgIHN0YXRlOiBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgICAgIGdldENvbmZsaWN0UmVzb2x1dGlvbnM6IF90aGlzLmdldENvbmZsaWN0UmVzb2x1dGlvbnMKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICB1cGRhdGVkU3RhdGUgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUodXBkYXRlZFN0YXRlKTsKCiAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDg7CiAgICAgICAgICAgICAgX2NvbnRleHQ1LnQwID0gX2NvbnRleHQ1WyJjYXRjaCJdKDEpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsCiAgICAgICAgICAgICAgICBlcnJvcjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5yZXNvbHZlSW1wb3J0RXJyb3JzRmlsZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgZmlsZSBjb3VsZCBub3QgYmUgcHJvY2Vzc2VkLicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTQsIG51bGwsIFtbMSwgOF1dKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAibGVnYWN5SW1wb3J0IiwKICAgIC8qI19fUFVSRV9fKi8KICAgIF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoKSB7CiAgICAgIHZhciBfdGhpcyRwcm9wcywgc2VydmljZXMsIGluZGV4UGF0dGVybnMsIGNvbmZpcm1Nb2RhbFByb21pc2UsIF90aGlzJHN0YXRlMiwgZmlsZSwgaXNPdmVyd3JpdGVBbGxDaGVja2VkLCBjb250ZW50cywgX3JlZjgsIGNvbmZsaWN0ZWRJbmRleFBhdHRlcm5zLCBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzLCBjb25mbGljdGVkU2VhcmNoRG9jcywgaW1wb3J0ZWRPYmplY3RDb3VudCwgZmFpbGVkSW1wb3J0cywgYnlJZCwgdW5tYXRjaGVkUmVmZXJlbmNlczsKCiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ2KSB7CiAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgX3RoaXMkcHJvcHMgPSBfdGhpcy5wcm9wcywgc2VydmljZXMgPSBfdGhpcyRwcm9wcy5zZXJ2aWNlcywgaW5kZXhQYXR0ZXJucyA9IF90aGlzJHByb3BzLmluZGV4UGF0dGVybnMsIGNvbmZpcm1Nb2RhbFByb21pc2UgPSBfdGhpcyRwcm9wcy5jb25maXJtTW9kYWxQcm9taXNlOwogICAgICAgICAgICAgIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLCBmaWxlID0gX3RoaXMkc3RhdGUyLmZpbGUsIGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCA9IF90aGlzJHN0YXRlMi5pc092ZXJ3cml0ZUFsbENoZWNrZWQ7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ2xvYWRpbmcnLAogICAgICAgICAgICAgICAgZXJyb3I6IHVuZGVmaW5lZAogICAgICAgICAgICAgIH0pOyAvLyBMb2cgd2FybmluZyBvbiBzZXJ2ZXIsIGRvbid0IHdhaXQgZm9yIHJlc3BvbnNlCgoKICAgICAgICAgICAgICAoMCwgX2xpYi5sb2dMZWdhY3lJbXBvcnQpKCk7CiAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSA0OwogICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNzsKICAgICAgICAgICAgICByZXR1cm4gKDAsIF9saWIuaW1wb3J0TGVnYWN5RmlsZSkoZmlsZSk7CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY29udGVudHMgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE0OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDEwOwogICAgICAgICAgICAgIF9jb250ZXh0Ni50MCA9IF9jb250ZXh0NlsiY2F0Y2giXSg0KTsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICAgICAgZXJyb3I6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuaW1wb3J0TGVnYWN5RmlsZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgZmlsZSBjb3VsZCBub3QgYmUgcHJvY2Vzc2VkLicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29udGVudHMpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsCiAgICAgICAgICAgICAgICBlcnJvcjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbnZhbGlkRm9ybWF0T2ZJbXBvcnRlZEZpbGVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2ZWQgb2JqZWN0cyBmaWxlIGZvcm1hdCBpcyBpbnZhbGlkIGFuZCBjYW5ub3QgYmUgaW1wb3J0ZWQuJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICBjb250ZW50cyA9IGNvbnRlbnRzLmZpbHRlcihmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RzX3RhYmxlLlBPU1NJQkxFX1RZUEVTLmluY2x1ZGVzKGNvbnRlbnQuX3R5cGUpOwogICAgICAgICAgICAgIH0pLm1hcChmdW5jdGlvbiAoZG9jKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgZG9jLCB7CiAgICAgICAgICAgICAgICAgIC8vIFRoZSBzZXJ2ZXIgYXNzdW1lcyB0aGF0IGRvY3VtZW50cyB3aXRoIG5vIG1pZ3JhdGlvblZlcnNpb24gYXJlIHVwIHRvIGRhdGUuCiAgICAgICAgICAgICAgICAgIC8vIFRoYXQgYXNzdW1wdGlvbiBlbmFibGVzIEtpYmFuYSBhbmQgb3RoZXIgQVBJIGNvbnN1bWVycyB0byBub3QgaGF2ZSB0byBidWlsZAogICAgICAgICAgICAgICAgICAvLyB1cCBtaWdyYXRpb25WZXJzaW9uIHByaW9yIHRvIGNyZWF0aW5nIG5ldyBvYmplY3RzLiBCdXQgaXQgbWVhbnMgdGhhdCBpbXBvcnRzCiAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gc2V0IG1pZ3JhdGlvblZlcnNpb24gdG8gc29tZXRoaW5nIG90aGVyIHRoYW4gdW5kZWZpbmVkLCBzbyB0aGF0IGltcG9ydGVkCiAgICAgICAgICAgICAgICAgIC8vIGRvY3MgYXJlIG5vdCBzZWVuIGFzIGF1dG9tYXRpY2FsbHkgdXAtdG8tZGF0ZS4KICAgICAgICAgICAgICAgICAgX21pZ3JhdGlvblZlcnNpb246IGRvYy5fbWlncmF0aW9uVmVyc2lvbiB8fCB7fQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAyMDsKICAgICAgICAgICAgICByZXR1cm4gKDAsIF9yZXNvbHZlX3NhdmVkX29iamVjdHMucmVzb2x2ZVNhdmVkT2JqZWN0cykoY29udGVudHMsIGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCwgc2VydmljZXMsIGluZGV4UGF0dGVybnMsIGNvbmZpcm1Nb2RhbFByb21pc2UpOwoKICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgICBfcmVmOCA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgIGNvbmZsaWN0ZWRJbmRleFBhdHRlcm5zID0gX3JlZjguY29uZmxpY3RlZEluZGV4UGF0dGVybnM7CiAgICAgICAgICAgICAgY29uZmxpY3RlZFNhdmVkT2JqZWN0c0xpbmtlZFRvU2F2ZWRTZWFyY2hlcyA9IF9yZWY4LmNvbmZsaWN0ZWRTYXZlZE9iamVjdHNMaW5rZWRUb1NhdmVkU2VhcmNoZXM7CiAgICAgICAgICAgICAgY29uZmxpY3RlZFNlYXJjaERvY3MgPSBfcmVmOC5jb25mbGljdGVkU2VhcmNoRG9jczsKICAgICAgICAgICAgICBpbXBvcnRlZE9iamVjdENvdW50ID0gX3JlZjguaW1wb3J0ZWRPYmplY3RDb3VudDsKICAgICAgICAgICAgICBmYWlsZWRJbXBvcnRzID0gX3JlZjguZmFpbGVkSW1wb3J0czsKICAgICAgICAgICAgICBieUlkID0ge307CiAgICAgICAgICAgICAgY29uZmxpY3RlZEluZGV4UGF0dGVybnMubWFwKGZ1bmN0aW9uIChfcmVmOSkgewogICAgICAgICAgICAgICAgdmFyIGRvYyA9IF9yZWY5LmRvYywKICAgICAgICAgICAgICAgICAgICBvYmogPSBfcmVmOS5vYmo7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBkb2M6IGRvYywKICAgICAgICAgICAgICAgICAgb2JqOiBvYmouX3NlcmlhbGl6ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKF9yZWYxMCkgewogICAgICAgICAgICAgICAgdmFyIGRvYyA9IF9yZWYxMC5kb2MsCiAgICAgICAgICAgICAgICAgICAgb2JqID0gX3JlZjEwLm9iajsKICAgICAgICAgICAgICAgIHJldHVybiBvYmoucmVmZXJlbmNlcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWYpIHsKICAgICAgICAgICAgICAgICAgYnlJZFtyZWYuaWRdID0gYnlJZFtyZWYuaWRdICE9IG51bGwgPyBieUlkW3JlZi5pZF0uY29uY2F0KHsKICAgICAgICAgICAgICAgICAgICBkb2M6IGRvYywKICAgICAgICAgICAgICAgICAgICBvYmo6IG9iagogICAgICAgICAgICAgICAgICB9KSA6IFt7CiAgICAgICAgICAgICAgICAgICAgZG9jOiBkb2MsCiAgICAgICAgICAgICAgICAgICAgb2JqOiBvYmoKICAgICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB1bm1hdGNoZWRSZWZlcmVuY2VzID0gT2JqZWN0LmVudHJpZXMoYnlJZCkucmVkdWNlKGZ1bmN0aW9uIChhY2N1bSwgX3JlZjExKSB7CiAgICAgICAgICAgICAgICB2YXIgX3JlZjEyID0gX3NsaWNlZFRvQXJyYXkoX3JlZjExLCAyKSwKICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0luZGV4UGF0dGVybklkID0gX3JlZjEyWzBdLAogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBfcmVmMTJbMV07CgogICAgICAgICAgICAgICAgYWNjdW0ucHVzaCh7CiAgICAgICAgICAgICAgICAgIGV4aXN0aW5nSW5kZXhQYXR0ZXJuSWQ6IGV4aXN0aW5nSW5kZXhQYXR0ZXJuSWQsCiAgICAgICAgICAgICAgICAgIG5ld0luZGV4UGF0dGVybklkOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGxpc3Q6IGxpc3QubWFwKGZ1bmN0aW9uIChfcmVmMTMpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZG9jID0gX3JlZjEzLmRvYzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgaWQ6IGV4aXN0aW5nSW5kZXhQYXR0ZXJuSWQsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBkb2MuX3R5cGUsCiAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogZG9jLl9zb3VyY2UudGl0bGUKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gYWNjdW07CiAgICAgICAgICAgICAgfSwgW10pOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBjb25mbGljdGVkSW5kZXhQYXR0ZXJuczogY29uZmxpY3RlZEluZGV4UGF0dGVybnMsCiAgICAgICAgICAgICAgICBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzOiBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzLAogICAgICAgICAgICAgICAgY29uZmxpY3RlZFNlYXJjaERvY3M6IGNvbmZsaWN0ZWRTZWFyY2hEb2NzLAogICAgICAgICAgICAgICAgZmFpbGVkSW1wb3J0czogZmFpbGVkSW1wb3J0cywKICAgICAgICAgICAgICAgIHVubWF0Y2hlZFJlZmVyZW5jZXM6IHVubWF0Y2hlZFJlZmVyZW5jZXMsCiAgICAgICAgICAgICAgICBpbXBvcnRDb3VudDogaW1wb3J0ZWRPYmplY3RDb3VudCwKICAgICAgICAgICAgICAgIHN0YXR1czogdW5tYXRjaGVkUmVmZXJlbmNlcy5sZW5ndGggPT09IDAgPyAnc3VjY2VzcycgOiAnaWRsZScKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlNSwgbnVsbCwgW1s0LCAxMF1dKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiY29uZmlybUxlZ2FjeUltcG9ydCIsCiAgICAvKiNfX1BVUkVfXyovCiAgICBfYXN5bmNUb0dlbmVyYXRvcigKICAgIC8qI19fUFVSRV9fKi8KICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICB2YXIgX3RoaXMkc3RhdGUzLCBjb25mbGljdGVkSW5kZXhQYXR0ZXJucywgaXNPdmVyd3JpdGVBbGxDaGVja2VkLCBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzLCBjb25mbGljdGVkU2VhcmNoRG9jcywgZmFpbGVkSW1wb3J0cywgX3RoaXMkcHJvcHMyLCBzZXJ2aWNlcywgaW5kZXhQYXR0ZXJucywgaW1wb3J0Q291bnQsIHJlc29sdXRpb25zOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDcpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBfdGhpcyRzdGF0ZTMgPSBfdGhpcy5zdGF0ZSwgY29uZmxpY3RlZEluZGV4UGF0dGVybnMgPSBfdGhpcyRzdGF0ZTMuY29uZmxpY3RlZEluZGV4UGF0dGVybnMsIGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCA9IF90aGlzJHN0YXRlMy5pc092ZXJ3cml0ZUFsbENoZWNrZWQsIGNvbmZsaWN0ZWRTYXZlZE9iamVjdHNMaW5rZWRUb1NhdmVkU2VhcmNoZXMgPSBfdGhpcyRzdGF0ZTMuY29uZmxpY3RlZFNhdmVkT2JqZWN0c0xpbmtlZFRvU2F2ZWRTZWFyY2hlcywgY29uZmxpY3RlZFNlYXJjaERvY3MgPSBfdGhpcyRzdGF0ZTMuY29uZmxpY3RlZFNlYXJjaERvY3MsIGZhaWxlZEltcG9ydHMgPSBfdGhpcyRzdGF0ZTMuZmFpbGVkSW1wb3J0czsKICAgICAgICAgICAgICBfdGhpcyRwcm9wczIgPSBfdGhpcy5wcm9wcywgc2VydmljZXMgPSBfdGhpcyRwcm9wczIuc2VydmljZXMsIGluZGV4UGF0dGVybnMgPSBfdGhpcyRwcm9wczIuaW5kZXhQYXR0ZXJuczsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgZXJyb3I6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHN0YXR1czogJ2xvYWRpbmcnLAogICAgICAgICAgICAgICAgbG9hZGluZ01lc3NhZ2U6IHVuZGVmaW5lZAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpbXBvcnRDb3VudCA9IF90aGlzLnN0YXRlLmltcG9ydENvdW50OwoKICAgICAgICAgICAgICBpZiAoIV90aGlzLmhhc1VubWF0Y2hlZFJlZmVyZW5jZXMpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gNTsKICAgICAgICAgICAgICByZXNvbHV0aW9ucyA9IF90aGlzLnJlc29sdXRpb25zOyAvLyBEbyBub3QgUHJvbWlzZS5hbGwgdGhlc2UgY2FsbHMgYXMgdGhlIG9yZGVyIG1hdHRlcnMKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgbG9hZGluZ01lc3NhZ2U6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuY29uZmlybUxlZ2FjeUltcG9ydC5yZXNvbHZpbmdDb25mbGljdHNMb2FkaW5nTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXNvbHZpbmcgY29uZmxpY3Rz4oCmJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFyZXNvbHV0aW9ucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIF9jb250ZXh0Ny50MCA9IGltcG9ydENvdW50OwogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTI7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfcmVzb2x2ZV9zYXZlZF9vYmplY3RzLnJlc29sdmVJbmRleFBhdHRlcm5Db25mbGljdHMpKHJlc29sdXRpb25zLCBjb25mbGljdGVkSW5kZXhQYXR0ZXJucywgaXNPdmVyd3JpdGVBbGxDaGVja2VkKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgaW1wb3J0Q291bnQgPSBfY29udGV4dDcudDAgKz0gX2NvbnRleHQ3LnNlbnQ7CgogICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGxvYWRpbmdNZXNzYWdlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmNvbmZpcm1MZWdhY3lJbXBvcnQuc2F2aW5nQ29uZmxpY3RzTG9hZGluZ01lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2F2aW5nIGNvbmZsaWN0c+KApicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0Ny50MSA9IGltcG9ydENvdW50OwogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfcmVzb2x2ZV9zYXZlZF9vYmplY3RzLnNhdmVPYmplY3RzKShjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzLCBpc092ZXJ3cml0ZUFsbENoZWNrZWQpOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICBpbXBvcnRDb3VudCA9IF9jb250ZXh0Ny50MSArPSBfY29udGV4dDcuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgbG9hZGluZ01lc3NhZ2U6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuY29uZmlybUxlZ2FjeUltcG9ydC5zYXZlZFNlYXJjaEFyZUxpbmtlZFByb3Blcmx5TG9hZGluZ01lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRW5zdXJlIHNhdmVkIHNlYXJjaGVzIGFyZSBsaW5rZWQgcHJvcGVybHnigKYnCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBfY29udGV4dDcudDIgPSBpbXBvcnRDb3VudDsKICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDIyOwogICAgICAgICAgICAgIHJldHVybiAoMCwgX3Jlc29sdmVfc2F2ZWRfb2JqZWN0cy5yZXNvbHZlU2F2ZWRTZWFyY2hlcykoY29uZmxpY3RlZFNlYXJjaERvY3MsIHNlcnZpY2VzLCBpbmRleFBhdHRlcm5zLCBpc092ZXJ3cml0ZUFsbENoZWNrZWQpOwoKICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICBpbXBvcnRDb3VudCA9IF9jb250ZXh0Ny50MiArPSBfY29udGV4dDcuc2VudDsKCiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgbG9hZGluZ01lc3NhZ2U6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuY29uZmlybUxlZ2FjeUltcG9ydC5yZXRyeWluZ0ZhaWxlZE9iamVjdHNMb2FkaW5nTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdSZXRyeWluZyBmYWlsZWQgb2JqZWN0c+KApicKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIF9jb250ZXh0Ny50MyA9IGltcG9ydENvdW50OwogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMjc7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfcmVzb2x2ZV9zYXZlZF9vYmplY3RzLnNhdmVPYmplY3RzKShmYWlsZWRJbXBvcnRzLm1hcChmdW5jdGlvbiAoX3JlZjE1KSB7CiAgICAgICAgICAgICAgICB2YXIgb2JqID0gX3JlZjE1Lm9iajsKICAgICAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgICAgICAgfSksIGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCk7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgIGltcG9ydENvdW50ID0gX2NvbnRleHQ3LnQzICs9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzQ7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gMzA7CiAgICAgICAgICAgICAgX2NvbnRleHQ3LnQ0ID0gX2NvbnRleHQ3WyJjYXRjaCJdKDUpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQ3LnQ0Lm1lc3NhZ2UsCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsCiAgICAgICAgICAgICAgICBsb2FkaW5nTWVzc2FnZTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMzQ6CiAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICBpbXBvcnRDb3VudDogaW1wb3J0Q291bnQKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgMzU6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlNiwgbnVsbCwgW1s1LCAzMF1dKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25JbmRleENoYW5nZWQiLCBmdW5jdGlvbiAoaWQsIGUpIHsKICAgICAgdmFyIHZhbHVlID0gZS50YXJnZXQudmFsdWU7CgogICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgICB2YXIgY29uZmxpY3RJbmRleCA9IHN0YXRlLnVubWF0Y2hlZFJlZmVyZW5jZXMuZmluZEluZGV4KGZ1bmN0aW9uIChjb25mbGljdCkgewogICAgICAgICAgcmV0dXJuIGNvbmZsaWN0LmV4aXN0aW5nSW5kZXhQYXR0ZXJuSWQgPT09IGlkOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY29uZmxpY3RJbmRleCA9PT0gLTEpIHsKICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICB1bm1hdGNoZWRSZWZlcmVuY2VzOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLnVubWF0Y2hlZFJlZmVyZW5jZXMuc2xpY2UoMCwgY29uZmxpY3RJbmRleCkpLCBbX29iamVjdFNwcmVhZCh7fSwgc3RhdGUudW5tYXRjaGVkUmVmZXJlbmNlc1tjb25mbGljdEluZGV4XSwgewogICAgICAgICAgICBuZXdJbmRleFBhdHRlcm5JZDogdmFsdWUKICAgICAgICAgIH0pXSwgX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLnVubWF0Y2hlZFJlZmVyZW5jZXMuc2xpY2UoY29uZmxpY3RJbmRleCArIDEpKSkKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF90aGlzLnN0YXRlID0gewogICAgICBjb25mbGljdGVkSW5kZXhQYXR0ZXJuczogdW5kZWZpbmVkLAogICAgICBjb25mbGljdGVkU2F2ZWRPYmplY3RzTGlua2VkVG9TYXZlZFNlYXJjaGVzOiB1bmRlZmluZWQsCiAgICAgIGNvbmZsaWN0ZWRTZWFyY2hEb2NzOiB1bmRlZmluZWQsCiAgICAgIHVubWF0Y2hlZFJlZmVyZW5jZXM6IHVuZGVmaW5lZCwKICAgICAgY29uZmxpY3RpbmdSZWNvcmQ6IHVuZGVmaW5lZCwKICAgICAgZXJyb3I6IHVuZGVmaW5lZCwKICAgICAgZmlsZTogdW5kZWZpbmVkLAogICAgICBpbXBvcnRDb3VudDogMCwKICAgICAgaW5kZXhQYXR0ZXJuczogdW5kZWZpbmVkLAogICAgICBpc092ZXJ3cml0ZUFsbENoZWNrZWQ6IHRydWUsCiAgICAgIGxvYWRpbmdNZXNzYWdlOiB1bmRlZmluZWQsCiAgICAgIGlzTGVnYWN5RmlsZTogZmFsc2UsCiAgICAgIHN0YXR1czogJ2lkbGUnCiAgICB9OwogICAgcmV0dXJuIF90aGlzOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEZseW91dCwgW3sKICAgIGtleTogImNvbXBvbmVudERpZE1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHsKICAgICAgdGhpcy5mZXRjaEluZGV4UGF0dGVybnMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJVbm1hdGNoZWRSZWZlcmVuY2VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJVbm1hdGNoZWRSZWZlcmVuY2VzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciB1bm1hdGNoZWRSZWZlcmVuY2VzID0gdGhpcy5zdGF0ZS51bm1hdGNoZWRSZWZlcmVuY2VzOwoKICAgICAgaWYgKCF1bm1hdGNoZWRSZWZlcmVuY2VzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBjb2x1bW5zID0gW3sKICAgICAgICBmaWVsZDogJ2V4aXN0aW5nSW5kZXhQYXR0ZXJuSWQnLAogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQucmVuZGVyQ29uZmxpY3RzLmNvbHVtbklkTmFtZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSUQnCiAgICAgICAgfSksCiAgICAgICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQucmVuZGVyQ29uZmxpY3RzLmNvbHVtbklkRGVzY3JpcHRpb24nLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0lEIG9mIHRoZSBpbmRleCBwYXR0ZXJuJwogICAgICAgIH0pLAogICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBmaWVsZDogJ2xpc3QnLAogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQucmVuZGVyQ29uZmxpY3RzLmNvbHVtbkNvdW50TmFtZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnQ291bnQnCiAgICAgICAgfSksCiAgICAgICAgZGVzY3JpcHRpb246IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQucmVuZGVyQ29uZmxpY3RzLmNvbHVtbkNvdW50RGVzY3JpcHRpb24nLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0hvdyBtYW55IGFmZmVjdGVkIG9iamVjdHMnCiAgICAgICAgfSksCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIobGlzdCkgewogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBsaXN0Lmxlbmd0aCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgZmllbGQ6ICdsaXN0JywKICAgICAgICBuYW1lOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LnJlbmRlckNvbmZsaWN0cy5jb2x1bW5TYW1wbGVPZkFmZmVjdGVkT2JqZWN0c05hbWUnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhbXBsZSBvZiBhZmZlY3RlZCBvYmplY3RzJwogICAgICAgIH0pLAogICAgICAgIGRlc2NyaXB0aW9uOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LnJlbmRlckNvbmZsaWN0cy5jb2x1bW5TYW1wbGVPZkFmZmVjdGVkT2JqZWN0c0Rlc2NyaXB0aW9uJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTYW1wbGUgb2YgYWZmZWN0ZWQgb2JqZWN0cycKICAgICAgICB9KSwKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihsaXN0KSB7CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgidWwiLCB7CiAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgbGlzdFN0eWxlOiAnbm9uZScKICAgICAgICAgICAgfQogICAgICAgICAgfSwgKDAsIF9sb2Rhc2gudGFrZSkobGlzdCwgMykubWFwKGZ1bmN0aW9uIChvYmosIGtleSkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgibGkiLCB7CiAgICAgICAgICAgICAga2V5OiBrZXkKICAgICAgICAgICAgfSwgb2JqLnRpdGxlKTsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBmaWVsZDogJ2V4aXN0aW5nSW5kZXhQYXR0ZXJuSWQnLAogICAgICAgIG5hbWU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQucmVuZGVyQ29uZmxpY3RzLmNvbHVtbk5ld0luZGV4UGF0dGVybk5hbWUnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ05ldyBpbmRleCBwYXR0ZXJuJwogICAgICAgIH0pLAogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGlkKSB7CiAgICAgICAgICB2YXIgb3B0aW9ucyA9IF90aGlzMi5zdGF0ZS5pbmRleFBhdHRlcm5zLm1hcChmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgIHJldHVybiBfZGVmaW5lUHJvcGVydHkoewogICAgICAgICAgICAgIHRleHQ6IGluZGV4UGF0dGVybi50aXRsZSwKICAgICAgICAgICAgICB2YWx1ZTogaW5kZXhQYXR0ZXJuLmlkCiAgICAgICAgICAgIH0sICdkYXRhLXRlc3Qtc3ViaicsICJpbmRleFBhdHRlcm5PcHRpb24tIi5jb25jYXQoaW5kZXhQYXR0ZXJuLnRpdGxlKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBvcHRpb25zLnVuc2hpZnQoewogICAgICAgICAgICB0ZXh0OiAnLS0gU2tpcCBJbXBvcnQgLS0nLAogICAgICAgICAgICB2YWx1ZTogJycKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTZWxlY3QsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogIm1hbmFnZW1lbnRDaGFuZ2VJbmRleFNlbGVjdGlvbi0iLmNvbmNhdChpZCksCiAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5vbkluZGV4Q2hhbmdlZChpZCwgZSk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfV07CiAgICAgIHZhciBwYWdpbmF0aW9uID0gewogICAgICAgIHBhZ2VTaXplT3B0aW9uczogWzUsIDEwLCAyNV0KICAgICAgfTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlJbk1lbW9yeVRhYmxlLCB7CiAgICAgICAgaXRlbXM6IHVubWF0Y2hlZFJlZmVyZW5jZXMsCiAgICAgICAgY29sdW1uczogY29sdW1ucywKICAgICAgICBwYWdpbmF0aW9uOiBwYWdpbmF0aW9uCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckVycm9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJFcnJvcigpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlNCA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBlcnJvciA9IF90aGlzJHN0YXRlNC5lcnJvciwKICAgICAgICAgIHN0YXR1cyA9IF90aGlzJHN0YXRlNC5zdGF0dXM7CgogICAgICBpZiAoc3RhdHVzICE9PSAnZXJyb3InKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmVycm9yQ2FsbG91dFRpdGxlIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU29ycnksIHRoZXJlIHdhcyBhbiBlcnJvciIKICAgICAgICB9KSwKICAgICAgICBjb2xvcjogImRhbmdlciIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIGVycm9yKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckJvZHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckJvZHkoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTUgPSB0aGlzLnN0YXRlLAogICAgICAgICAgc3RhdHVzID0gX3RoaXMkc3RhdGU1LnN0YXR1cywKICAgICAgICAgIGxvYWRpbmdNZXNzYWdlID0gX3RoaXMkc3RhdGU1LmxvYWRpbmdNZXNzYWdlLAogICAgICAgICAgaXNPdmVyd3JpdGVBbGxDaGVja2VkID0gX3RoaXMkc3RhdGU1LmlzT3ZlcndyaXRlQWxsQ2hlY2tlZCwKICAgICAgICAgIGltcG9ydENvdW50ID0gX3RoaXMkc3RhdGU1LmltcG9ydENvdW50LAogICAgICAgICAgX3RoaXMkc3RhdGU1JGZhaWxlZEltID0gX3RoaXMkc3RhdGU1LmZhaWxlZEltcG9ydHMsCiAgICAgICAgICBmYWlsZWRJbXBvcnRzID0gX3RoaXMkc3RhdGU1JGZhaWxlZEltID09PSB2b2lkIDAgPyBbXSA6IF90aGlzJHN0YXRlNSRmYWlsZWRJbSwKICAgICAgICAgIGlzTGVnYWN5RmlsZSA9IF90aGlzJHN0YXRlNS5pc0xlZ2FjeUZpbGU7CgogICAgICBpZiAoc3RhdHVzID09PSAnbG9hZGluZycpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJzcGFjZUFyb3VuZCIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxvYWRpbmdLaWJhbmEsIHsKICAgICAgICAgIHNpemU6ICJ4bCIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogIm0iCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgbG9hZGluZ01lc3NhZ2UpKSkpOwogICAgICB9IC8vIEtlcHQgYmFja3dhcmRzIGNvbXBhdGlibGUgbG9naWMKCgogICAgICBpZiAoZmFpbGVkSW1wb3J0cy5sZW5ndGggJiYgKCF0aGlzLmhhc1VubWF0Y2hlZFJlZmVyZW5jZXMgfHwgaXNMZWdhY3lGaWxlID09PSBmYWxzZSAmJiBzdGF0dXMgPT09ICdzdWNjZXNzJykpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbXBvcnRTYXZlZE9iamVjdHNGYWlsZWRXYXJuaW5nIiwKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbXBvcnRGYWlsZWRUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW1wb3J0IGZhaWxlZCIKICAgICAgICAgIH0pLAogICAgICAgICAgY29sb3I6ICJ3YXJuaW5nIiwKICAgICAgICAgIGljb25UeXBlOiAiaGVscCIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmltcG9ydEZhaWxlZERlc2NyaXB0aW9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRmFpbGVkIHRvIGltcG9ydCB7ZmFpbGVkSW1wb3J0Q291bnR9IG9mIHt0b3RhbEltcG9ydENvdW50fSBvYmplY3RzLiBJbXBvcnQgZmFpbGVkIiwKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBmYWlsZWRJbXBvcnRDb3VudDogZmFpbGVkSW1wb3J0cy5sZW5ndGgsCiAgICAgICAgICAgIHRvdGFsSW1wb3J0Q291bnQ6IGltcG9ydENvdW50ICsgZmFpbGVkSW1wb3J0cy5sZW5ndGgKICAgICAgICAgIH0KICAgICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBmYWlsZWRJbXBvcnRzLm1hcChmdW5jdGlvbiAoX3JlZjE3KSB7CiAgICAgICAgICB2YXIgZXJyb3IgPSBfcmVmMTcuZXJyb3IsCiAgICAgICAgICAgICAgb2JqID0gX3JlZjE3Lm9iajsKCiAgICAgICAgICBpZiAoZXJyb3IudHlwZSA9PT0gJ21pc3NpbmdfcmVmZXJlbmNlcycpIHsKICAgICAgICAgICAgcmV0dXJuIGVycm9yLnJlZmVyZW5jZXMubWFwKGZ1bmN0aW9uIChyZWZlcmVuY2UpIHsKICAgICAgICAgICAgICByZXR1cm4gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbXBvcnRGYWlsZWRNaXNzaW5nUmVmZXJlbmNlJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7dHlwZX0gW2lkPXtpZH1dIGNvdWxkIG5vdCBsb2NhdGUge3JlZlR5cGV9IFtpZD17cmVmSWR9XScsCiAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgaWQ6IG9iai5pZCwKICAgICAgICAgICAgICAgICAgdHlwZTogb2JqLnR5cGUsCiAgICAgICAgICAgICAgICAgIHJlZklkOiByZWZlcmVuY2UuaWQsCiAgICAgICAgICAgICAgICAgIHJlZlR5cGU6IHJlZmVyZW5jZS50eXBlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChlcnJvci50eXBlID09PSAndW5zdXBwb3J0ZWRfdHlwZScpIHsKICAgICAgICAgICAgcmV0dXJuIF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuaW1wb3J0RmFpbGVkVW5zdXBwb3J0ZWRUeXBlJywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne3R5cGV9IFtpZD17aWR9XSB1bnN1cHBvcnRlZCB0eXBlJywKICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgIGlkOiBvYmouaWQsCiAgICAgICAgICAgICAgICB0eXBlOiBvYmoudHlwZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICgwLCBfbG9kYXNoLmdldCkoZXJyb3IsICdib2R5Lm1lc3NhZ2UnLCBlcnJvci5tZXNzYWdlIHx8ICcnKTsKICAgICAgICB9KS5qb2luKCcgJykpKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXR1cyA9PT0gJ3N1Y2Nlc3MnKSB7CiAgICAgICAgaWYgKGltcG9ydENvdW50ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImltcG9ydFNhdmVkT2JqZWN0c1N1Y2Nlc3NOb25lSW1wb3J0ZWQiLAogICAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbXBvcnRTdWNjZXNzZnVsQ2FsbG91dC5ub09iamVjdHNJbXBvcnRlZFRpdGxlIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5vIG9iamVjdHMgaW1wb3J0ZWQiCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBjb2xvcjogInByaW1hcnkiCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImltcG9ydFNhdmVkT2JqZWN0c1N1Y2Nlc3MiLAogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmltcG9ydFN1Y2Nlc3NmdWxUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW1wb3J0IHN1Y2Nlc3NmdWwiCiAgICAgICAgICB9KSwKICAgICAgICAgIGNvbG9yOiAic3VjY2VzcyIsCiAgICAgICAgICBpY29uVHlwZTogImNoZWNrIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuaW1wb3J0U3VjY2Vzc2Z1bERlc2NyaXB0aW9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU3VjY2Vzc2Z1bGx5IGltcG9ydGVkIHtpbXBvcnRDb3VudH0gb2JqZWN0cy4iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGltcG9ydENvdW50OiBpbXBvcnRDb3VudAogICAgICAgICAgfQogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmhhc1VubWF0Y2hlZFJlZmVyZW5jZXMpIHsKICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXJVbm1hdGNoZWRSZWZlcmVuY2VzKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybSwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LnNlbGVjdEZpbGVUb0ltcG9ydEZvcm1Sb3dMYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlBsZWFzZSBzZWxlY3QgYSBmaWxlIHRvIGltcG9ydCIKICAgICAgICB9KQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmlsZVBpY2tlciwgewogICAgICAgIGluaXRpYWxQcm9tcHRUZXh0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuaW1wb3J0UHJvbXB0VGV4dCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkltcG9ydCIKICAgICAgICB9KSwKICAgICAgICBvbkNoYW5nZTogdGhpcy5zZXRJbXBvcnRGaWxlCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgICAgICBuYW1lOiAib3ZlcndyaXRlQWxsIiwKICAgICAgICBsYWJlbDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0Lm92ZXJ3cml0ZVNhdmVkT2JqZWN0c0xhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQXV0b21hdGljYWxseSBvdmVyd3JpdGUgYWxsIHNhdmVkIG9iamVjdHM/IgogICAgICAgIH0pLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbXBvcnRTYXZlZE9iamVjdHNPdmVyd3JpdGVUb2dnbGUiLAogICAgICAgIGNoZWNrZWQ6IGlzT3ZlcndyaXRlQWxsQ2hlY2tlZCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5jaGFuZ2VPdmVyd3JpdGVBbGwKICAgICAgfSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJGb290ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckZvb3RlcigpIHsKICAgICAgdmFyIHN0YXR1cyA9IHRoaXMuc3RhdGUuc3RhdHVzOwogICAgICB2YXIgX3RoaXMkcHJvcHMzID0gdGhpcy5wcm9wcywKICAgICAgICAgIGRvbmUgPSBfdGhpcyRwcm9wczMuZG9uZSwKICAgICAgICAgIGNsb3NlID0gX3RoaXMkcHJvcHMzLmNsb3NlOwogICAgICB2YXIgY29uZmlybUJ1dHRvbjsKCiAgICAgIGlmIChzdGF0dXMgPT09ICdzdWNjZXNzJykgewogICAgICAgIGNvbmZpcm1CdXR0b24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBvbkNsaWNrOiBkb25lLAogICAgICAgICAgc2l6ZTogInMiLAogICAgICAgICAgZmlsbDogdHJ1ZSwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbXBvcnRTYXZlZE9iamVjdHNEb25lQnRuIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbXBvcnRTdWNjZXNzZnVsLmNvbmZpcm1CdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRvbmUiCiAgICAgICAgfSkpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzVW5tYXRjaGVkUmVmZXJlbmNlcykgewogICAgICAgIGNvbmZpcm1CdXR0b24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBvbkNsaWNrOiB0aGlzLnN0YXRlLmlzTGVnYWN5RmlsZSA/IHRoaXMuY29uZmlybUxlZ2FjeUltcG9ydCA6IHRoaXMucmVzb2x2ZUltcG9ydEVycm9ycywKICAgICAgICAgIHNpemU6ICJzIiwKICAgICAgICAgIGZpbGw6IHRydWUsCiAgICAgICAgICBpc0xvYWRpbmc6IHN0YXR1cyA9PT0gJ2xvYWRpbmcnLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImltcG9ydFNhdmVkT2JqZWN0c0NvbmZpcm1CdG4iCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmltcG9ydFN1Y2Nlc3NmdWwuY29uZmlybUFsbENoYW5nZXNCdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNvbmZpcm0gYWxsIGNoYW5nZXMiCiAgICAgICAgfSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbmZpcm1CdXR0b24gPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBvbkNsaWNrOiB0aGlzLnN0YXRlLmlzTGVnYWN5RmlsZSA/IHRoaXMubGVnYWN5SW1wb3J0IDogdGhpcy5pbXBvcnQsCiAgICAgICAgICBzaXplOiAicyIsCiAgICAgICAgICBmaWxsOiB0cnVlLAogICAgICAgICAgaXNMb2FkaW5nOiBzdGF0dXMgPT09ICdsb2FkaW5nJywKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJpbXBvcnRTYXZlZE9iamVjdHNJbXBvcnRCdG4iCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmltcG9ydC5jb25maXJtQnV0dG9uTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbXBvcnQiCiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgIGp1c3RpZnlDb250ZW50OiAic3BhY2VCZXR3ZWVuIgogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICBvbkNsaWNrOiBjbG9zZSwKICAgICAgICBzaXplOiAicyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5pbXBvcnQuY2FuY2VsQnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIgogICAgICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBjb25maXJtQnV0dG9uKSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyU3ViaGVhZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJTdWJoZWFkZXIoKSB7CiAgICAgIGlmICh0aGlzLnN0YXRlLnN0YXR1cyA9PT0gJ2xvYWRpbmcnIHx8IHRoaXMuc3RhdGUuc3RhdHVzID09PSAnc3VjY2VzcycpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGxlZ2FjeUZpbGVXYXJuaW5nOwoKICAgICAgaWYgKHRoaXMuc3RhdGUuaXNMZWdhY3lGaWxlKSB7CiAgICAgICAgbGVnYWN5RmlsZVdhcm5pbmcgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImltcG9ydFNhdmVkT2JqZWN0c0xlZ2FjeVdhcm5pbmciLAogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmxlZ2FjeUZpbGVVc2VkVGl0bGUiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlN1cHBvcnQgZm9yIEpTT04gZmlsZXMgaXMgZ29pbmcgYXdheSIKICAgICAgICAgIH0pLAogICAgICAgICAgY29sb3I6ICJ3YXJuaW5nIiwKICAgICAgICAgIGljb25UeXBlOiAiaGVscCIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmxlZ2FjeUZpbGVVc2VkQm9keSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlVzZSBvdXIgdXBkYXRlZCBleHBvcnQgdG8gZ2VuZXJhdGUgTkRKU09OIGZpbGVzLCBhbmQgeW91J2xsIGJlIGFsbCBzZXQuIgogICAgICAgIH0pKSk7CiAgICAgIH0KCiAgICAgIHZhciBpbmRleFBhdHRlcm5Db25mbGljdHNXYXJuaW5nOwoKICAgICAgaWYgKHRoaXMuaGFzVW5tYXRjaGVkUmVmZXJlbmNlcykgewogICAgICAgIGluZGV4UGF0dGVybkNvbmZsaWN0c1dhcm5pbmcgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImltcG9ydFNhdmVkT2JqZWN0c0NvbmZsaWN0c1dhcm5pbmciLAogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmluZGV4UGF0dGVybkNvbmZsaWN0c1RpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJJbmRleCBQYXR0ZXJuIENvbmZsaWN0cyIKICAgICAgICAgIH0pLAogICAgICAgICAgY29sb3I6ICJ3YXJuaW5nIiwKICAgICAgICAgIGljb25UeXBlOiAiaGVscCIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmluZGV4UGF0dGVybkNvbmZsaWN0c0Rlc2NyaXB0aW9uIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhlIGZvbGxvd2luZyBzYXZlZCBvYmplY3RzIHVzZSBpbmRleCBwYXR0ZXJucyB0aGF0IGRvIG5vdCBleGlzdC4gUGxlYXNlIHNlbGVjdCB0aGUgaW5kZXggcGF0dGVybnMgeW91J2QgbGlrZSByZS1hc3NvY2lhdGVkIHdpdGggdGhlbS4gWW91IGNhbiB7aW5kZXhQYXR0ZXJuTGlua30gaWYgbmVjZXNzYXJ5LiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuTGluazogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxpbmssIHsKICAgICAgICAgICAgICBocmVmOiB0aGlzLnByb3BzLm5ld0luZGV4UGF0dGVyblVybAogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmluZGV4UGF0dGVybkNvbmZsaWN0c0NhbGxvdXRMaW5rVGV4dCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJjcmVhdGUgYSBuZXcgaW5kZXggcGF0dGVybiIKICAgICAgICAgICAgfSkpCiAgICAgICAgICB9CiAgICAgICAgfSkpKTsKICAgICAgfQoKICAgICAgaWYgKCFsZWdhY3lGaWxlV2FybmluZyAmJiAhaW5kZXhQYXR0ZXJuQ29uZmxpY3RzV2FybmluZykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIGxlZ2FjeUZpbGVXYXJuaW5nICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0pLCBsZWdhY3lGaWxlV2FybmluZyksIGluZGV4UGF0dGVybkNvbmZsaWN0c1dhcm5pbmcgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3BhbiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksIGluZGV4UGF0dGVybkNvbmZsaWN0c1dhcm5pbmcpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvdmVyd3JpdGVDb25maXJtZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG92ZXJ3cml0ZUNvbmZpcm1lZCgpIHsKICAgICAgdGhpcy5zdGF0ZS5jb25mbGljdGluZ1JlY29yZC5kb25lKHRydWUpOwogICAgfQogIH0sIHsKICAgIGtleTogIm92ZXJ3cml0ZVNraXBwZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG92ZXJ3cml0ZVNraXBwZWQoKSB7CiAgICAgIHRoaXMuc3RhdGUuY29uZmxpY3RpbmdSZWNvcmQuZG9uZShmYWxzZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBjbG9zZSA9IHRoaXMucHJvcHMuY2xvc2U7CiAgICAgIHZhciBjb25maXJtT3ZlcndyaXRlTW9kYWw7CgogICAgICBpZiAodGhpcy5zdGF0ZS5jb25mbGljdGluZ1JlY29yZCkgewogICAgICAgIGNvbmZpcm1PdmVyd3JpdGVNb2RhbCA9IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlPdmVybGF5TWFzaywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvbmZpcm1Nb2RhbCwgewogICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4ubWFuYWdlbWVudC5vYmplY3RzLm9iamVjdHNUYWJsZS5mbHlvdXQuY29uZmlybU92ZXJ3cml0ZVRpdGxlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ092ZXJ3cml0ZSB7dHlwZX0/JywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgdHlwZTogdGhpcy5zdGF0ZS5jb25mbGljdGluZ1JlY29yZC50eXBlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5jb25maXJtT3ZlcndyaXRlQ2FuY2VsQnV0dG9uVGV4dCcsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDYW5jZWwnCiAgICAgICAgICB9KSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmNvbmZpcm1PdmVyd3JpdGVPdmVyd3JpdGVCdXR0b25UZXh0JywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ092ZXJ3cml0ZScKICAgICAgICAgIH0pLAogICAgICAgICAgYnV0dG9uQ29sb3I6ICJkYW5nZXIiLAogICAgICAgICAgb25DYW5jZWw6IHRoaXMub3ZlcndyaXRlU2tpcHBlZC5iaW5kKHRoaXMpLAogICAgICAgICAgb25Db25maXJtOiB0aGlzLm92ZXJ3cml0ZUNvbmZpcm1lZC5iaW5kKHRoaXMpLAogICAgICAgICAgZGVmYXVsdEZvY3VzZWRCdXR0b246IF9ldWkuRVVJX01PREFMX0NPTkZJUk1fQlVUVE9OCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICBpZDogImtibi5tYW5hZ2VtZW50Lm9iamVjdHMub2JqZWN0c1RhYmxlLmZseW91dC5jb25maXJtT3ZlcndyaXRlQm9keSIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBvdmVyd3JpdGUge3RpdGxlfT8iLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIHRpdGxlOiB0aGlzLnN0YXRlLmNvbmZsaWN0aW5nUmVjb3JkLnRpdGxlIHx8ICgwLCBfbGliLmdldERlZmF1bHRUaXRsZSkodGhpcy5zdGF0ZS5jb25mbGljdGluZ1JlY29yZCkKICAgICAgICAgIH0KICAgICAgICB9KSkpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbHlvdXQsIHsKICAgICAgICBvbkNsb3NlOiBjbG9zZSwKICAgICAgICBzaXplOiAicyIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZseW91dEhlYWRlciwgewogICAgICAgIGhhc0JvcmRlcjogdHJ1ZQogICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAia2JuLm1hbmFnZW1lbnQub2JqZWN0cy5vYmplY3RzVGFibGUuZmx5b3V0LmltcG9ydFNhdmVkT2JqZWN0VGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW1wb3J0IHNhdmVkIG9iamVjdHMiCiAgICAgIH0pKSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmx5b3V0Qm9keSwgbnVsbCwgdGhpcy5yZW5kZXJTdWJoZWFkZXIoKSwgdGhpcy5yZW5kZXJFcnJvcigpLCB0aGlzLnJlbmRlckJvZHkoKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbHlvdXRGb290ZXIsIG51bGwsIHRoaXMucmVuZGVyRm9vdGVyKCkpLCBjb25maXJtT3ZlcndyaXRlTW9kYWwpOwogICAgfQogIH0sIHsKICAgIGtleTogImhhc1VubWF0Y2hlZFJlZmVyZW5jZXMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnVubWF0Y2hlZFJlZmVyZW5jZXMgJiYgdGhpcy5zdGF0ZS51bm1hdGNoZWRSZWZlcmVuY2VzLmxlbmd0aCA+IDA7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVzb2x1dGlvbnMiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnVubWF0Y2hlZFJlZmVyZW5jZXMucmVkdWNlKGZ1bmN0aW9uIChhY2N1bSwgX3JlZjE4KSB7CiAgICAgICAgdmFyIGV4aXN0aW5nSW5kZXhQYXR0ZXJuSWQgPSBfcmVmMTguZXhpc3RpbmdJbmRleFBhdHRlcm5JZCwKICAgICAgICAgICAgbmV3SW5kZXhQYXR0ZXJuSWQgPSBfcmVmMTgubmV3SW5kZXhQYXR0ZXJuSWQ7CgogICAgICAgIGlmIChuZXdJbmRleFBhdHRlcm5JZCkgewogICAgICAgICAgYWNjdW0ucHVzaCh7CiAgICAgICAgICAgIG9sZElkOiBleGlzdGluZ0luZGV4UGF0dGVybklkLAogICAgICAgICAgICBuZXdJZDogbmV3SW5kZXhQYXR0ZXJuSWQKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFjY3VtOwogICAgICB9LCBbXSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRmx5b3V0Owp9KF9yZWFjdC5Db21wb25lbnQpOwoKZXhwb3J0cy5GbHlvdXQgPSBGbHlvdXQ7CgpfZGVmaW5lUHJvcGVydHkoRmx5b3V0LCAicHJvcFR5cGVzIiwgewogIGNsb3NlOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogIGRvbmU6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgc2VydmljZXM6IF9wcm9wVHlwZXMuZGVmYXVsdC5hcnJheS5pc1JlcXVpcmVkLAogIG5ld0luZGV4UGF0dGVyblVybDogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZy5pc1JlcXVpcmVkLAogIGluZGV4UGF0dGVybnM6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QuaXNSZXF1aXJlZCwKICBjb25maXJtTW9kYWxQcm9taXNlOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkCn0pOw=="},null]}