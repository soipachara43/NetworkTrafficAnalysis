{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/cross_cluster_replication/public/np_ready/app/components/follower_index_form/follower_index_form.js","dependencies":[{"path":"x-pack/legacy/plugins/cross_cluster_replication/public/np_ready/app/components/follower_index_form/follower_index_form.js","mtime":1589249552187},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkZvbGxvd2VySW5kZXhGb3JtID0gZXhwb3J0cy51cGRhdGVGb3JtRXJyb3JzID0gZXhwb3J0cy51cGRhdGVGaWVsZHMgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfbG9kYXNoID0gcmVxdWlyZSgibG9kYXNoIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9lc191aV9zaGFyZWQvcHVibGljIik7Cgp2YXIgX2lucHV0X3ZhbGlkYXRpb24gPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9pbnB1dF92YWxpZGF0aW9uIik7Cgp2YXIgX3JvdXRpbmcgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4uLy4uL3NlcnZpY2VzL3JvdXRpbmciKSk7Cgp2YXIgX25vdGlmaWNhdGlvbnMgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9ub3RpZmljYXRpb25zIik7Cgp2YXIgX2FwaSA9IHJlcXVpcmUoIi4uLy4uL3NlcnZpY2VzL2FwaSIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi9jb25zdGFudHMiKTsKCnZhciBfc2VjdGlvbl9lcnJvciA9IHJlcXVpcmUoIi4uL3NlY3Rpb25fZXJyb3IiKTsKCnZhciBfZm9ybV9lbnRyeV9yb3cgPSByZXF1aXJlKCIuLi9mb3JtX2VudHJ5X3JvdyIpOwoKdmFyIF9hZHZhbmNlZF9zZXR0aW5nc19maWVsZHMgPSByZXF1aXJlKCIuL2FkdmFuY2VkX3NldHRpbmdzX2ZpZWxkcyIpOwoKdmFyIF9xdWVyeV9wYXJhbXMgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9xdWVyeV9wYXJhbXMiKTsKCnZhciBfZ2V0X3JlbW90ZV9jbHVzdGVyX25hbWUgPSByZXF1aXJlKCIuLi8uLi9zZXJ2aWNlcy9nZXRfcmVtb3RlX2NsdXN0ZXJfbmFtZSIpOwoKdmFyIF9yZW1vdGVfY2x1c3RlcnNfZm9ybV9maWVsZCA9IHJlcXVpcmUoIi4uL3JlbW90ZV9jbHVzdGVyc19mb3JtX2ZpZWxkIik7Cgp2YXIgX2ZvbGxvd2VyX2luZGV4X3JlcXVlc3RfZmx5b3V0ID0gcmVxdWlyZSgiLi9mb2xsb3dlcl9pbmRleF9yZXF1ZXN0X2ZseW91dCIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsgdmFyIGtleSwgaTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7IGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OyB2YXIgdGFyZ2V0ID0ge307IHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgdmFyIGtleSwgaTsgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsga2V5ID0gc291cmNlS2V5c1tpXTsgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBpbmRleE5hbWVJbGxlZ2FsQ2hhcmFjdGVycyA9IF9wdWJsaWMuaW5kaWNlcy5JTkRFWF9JTExFR0FMX0NIQVJBQ1RFUlNfVklTSUJMRS5qb2luKCcgJyk7Cgp2YXIgZmllbGRUb1ZhbGlkYXRvck1hcCA9IF9hZHZhbmNlZF9zZXR0aW5nc19maWVsZHMuYWR2YW5jZWRTZXR0aW5nc0ZpZWxkcy5yZWR1Y2UoZnVuY3Rpb24gKG1hcCwgYWR2YW5jZWRTZXR0aW5nKSB7CiAgdmFyIGZpZWxkID0gYWR2YW5jZWRTZXR0aW5nLmZpZWxkLAogICAgICB2YWxpZGF0b3IgPSBhZHZhbmNlZFNldHRpbmcudmFsaWRhdG9yOwogIG1hcFtmaWVsZF0gPSB2YWxpZGF0b3I7CiAgcmV0dXJuIG1hcDsKfSwgewogIG5hbWU6IF9pbnB1dF92YWxpZGF0aW9uLmluZGV4TmFtZVZhbGlkYXRvciwKICBsZWFkZXJJbmRleDogX2lucHV0X3ZhbGlkYXRpb24ubGVhZGVySW5kZXhWYWxpZGF0b3IKfSk7Cgp2YXIgZ2V0RW1wdHlGb2xsb3dlckluZGV4ID0gZnVuY3Rpb24gZ2V0RW1wdHlGb2xsb3dlckluZGV4KCkgewogIHZhciByZW1vdGVDbHVzdGVyTmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoewogICAgbmFtZTogJycsCiAgICByZW1vdGVDbHVzdGVyOiByZW1vdGVDbHVzdGVyTmFtZSwKICAgIGxlYWRlckluZGV4OiAnJwogIH0sIF9hZHZhbmNlZF9zZXR0aW5nc19maWVsZHMuZW1wdHlBZHZhbmNlZFNldHRpbmdzKTsKfTsKLyoqCiAqIFN0YXRlIHRyYW5zaXRpb25zOiBmaWVsZHMgdXBkYXRlCiAqLwoKCnZhciB1cGRhdGVGaWVsZHMgPSBmdW5jdGlvbiB1cGRhdGVGaWVsZHMoZmllbGRzKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmKSB7CiAgICB2YXIgZm9sbG93ZXJJbmRleCA9IF9yZWYuZm9sbG93ZXJJbmRleDsKICAgIHJldHVybiB7CiAgICAgIGZvbGxvd2VySW5kZXg6IF9vYmplY3RTcHJlYWQoe30sIGZvbGxvd2VySW5kZXgsIHt9LCBmaWVsZHMpCiAgICB9OwogIH07Cn07Ci8qKgogKiBTdGF0ZSB0cmFuc2l0aW9uczogZXJyb3JzIHVwZGF0ZQogKi8KCgpleHBvcnRzLnVwZGF0ZUZpZWxkcyA9IHVwZGF0ZUZpZWxkczsKCnZhciB1cGRhdGVGb3JtRXJyb3JzID0gZnVuY3Rpb24gdXBkYXRlRm9ybUVycm9ycyhlcnJvcnMpIHsKICByZXR1cm4gZnVuY3Rpb24gKF9yZWYyKSB7CiAgICB2YXIgZmllbGRzRXJyb3JzID0gX3JlZjIuZmllbGRzRXJyb3JzOwogICAgcmV0dXJuIHsKICAgICAgZmllbGRzRXJyb3JzOiBfb2JqZWN0U3ByZWFkKHt9LCBmaWVsZHNFcnJvcnMsIHt9LCBlcnJvcnMpCiAgICB9OwogIH07Cn07CgpleHBvcnRzLnVwZGF0ZUZvcm1FcnJvcnMgPSB1cGRhdGVGb3JtRXJyb3JzOwoKdmFyIEZvbGxvd2VySW5kZXhGb3JtID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoRm9sbG93ZXJJbmRleEZvcm0sIF9QdXJlQ29tcG9uZW50KTsKCiAgZnVuY3Rpb24gRm9sbG93ZXJJbmRleEZvcm0ocHJvcHMpIHsKICAgIHZhciBfdGhpczsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRm9sbG93ZXJJbmRleEZvcm0pOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEZvbGxvd2VySW5kZXhGb3JtKS5jYWxsKHRoaXMsIHByb3BzKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidG9nZ2xlUmVxdWVzdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgdmFyIGlzUmVxdWVzdFZpc2libGUgPSBfcmVmMy5pc1JlcXVlc3RWaXNpYmxlOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlOiAhaXNSZXF1ZXN0VmlzaWJsZQogICAgICAgIH07CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZHNDaGFuZ2UiLCBmdW5jdGlvbiAoZmllbGRzKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHVwZGF0ZUZpZWxkcyhmaWVsZHMpKTsKCiAgICAgIHZhciBuZXdGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBfdGhpcy5zdGF0ZS5maWVsZHMsIHt9LCBmaWVsZHMpOwoKICAgICAgX3RoaXMuc2V0U3RhdGUodXBkYXRlRm9ybUVycm9ycyhfdGhpcy5nZXRGaWVsZHNFcnJvcnMobmV3RmllbGRzKSkpOwoKICAgICAgaWYgKF90aGlzLnByb3BzLmFwaUVycm9yKSB7CiAgICAgICAgX3RoaXMucHJvcHMuY2xlYXJBcGlFcnJvcigpOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRGaWVsZHNFcnJvcnMiLCBmdW5jdGlvbiAobmV3RmllbGRzKSB7CiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhuZXdGaWVsZHMpLnJlZHVjZShmdW5jdGlvbiAoZXJyb3JzLCBmaWVsZCkgewogICAgICAgIHZhciB2YWxpZGF0b3IgPSBmaWVsZFRvVmFsaWRhdG9yTWFwW2ZpZWxkXTsKICAgICAgICB2YXIgdmFsdWUgPSBuZXdGaWVsZHNbZmllbGRdOwoKICAgICAgICBpZiAodmFsaWRhdG9yKSB7CiAgICAgICAgICB2YXIgZXJyb3IgPSB2YWxpZGF0b3IodmFsdWUpOwogICAgICAgICAgZXJyb3JzW2ZpZWxkXSA9IGVycm9yOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGVycm9yczsKICAgICAgfSwge30pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25JbmRleE5hbWVDaGFuZ2UiLCBmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgdmFyIG5hbWUgPSBfcmVmNC5uYW1lOwoKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgIG5hbWU6IG5hbWUKICAgICAgfSk7CgogICAgICB2YXIgZXJyb3IgPSAoMCwgX2lucHV0X3ZhbGlkYXRpb24uaW5kZXhOYW1lVmFsaWRhdG9yKShuYW1lKTsKCiAgICAgIGlmIChlcnJvcikgewogICAgICAgIC8vIElmIHRoZXJlIGlzIGEgY2xpZW50IHNpZGUgZXJyb3IKICAgICAgICAvLyB0aGVyZSBpcyBubyBuZWVkIHRvIHZhbGlkYXRlIHRoZSBuYW1lCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoIW5hbWUgfHwgIW5hbWUudHJpbSgpKSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgaXNWYWxpZGF0aW5nSW5kZXhOYW1lOiBmYWxzZQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleE5hbWU6IHRydWUKICAgICAgfSk7CgogICAgICBfdGhpcy52YWxpZGF0ZUluZGV4TmFtZShuYW1lKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInZhbGlkYXRlSW5kZXhOYW1lIiwKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWY1ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShuYW1lKSB7CiAgICAgICAgdmFyIF9pbmRpY2VzLCBkb2VzRXhpc3QsIGVycm9yOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXBpLmxvYWRJbmRpY2VzKSgpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfaW5kaWNlcyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICBkb2VzRXhpc3QgPSBfaW5kaWNlcy5zb21lKGZ1bmN0aW9uIChpbmRleCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXgubmFtZSA9PT0gbmFtZTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChkb2VzRXhpc3QpIHsKICAgICAgICAgICAgICAgICAgZXJyb3IgPSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uaW5kZXhBbHJlYWR5RXhpc3RFcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkFuIGluZGV4IHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cy4iCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgICAgYWx3YXlzVmlzaWJsZTogdHJ1ZQogICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUodXBkYXRlRm9ybUVycm9ycyh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogZXJyb3IKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgaXNWYWxpZGF0aW5nSW5kZXhOYW1lOiBmYWxzZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE3OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA5OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgICBpZiAoIV9jb250ZXh0LnQwKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQudDAubmFtZSA9PT0gJ0Fib3J0RXJyb3InKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgaWYgKCFfY29udGV4dC50MC5ib2R5KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleE5hbWU6IGZhbHNlCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzbid0IGFuIEhUVFAgZXJyb3IsIHNvIGxldCB0aGUgZmF0YWwgZXJyb3Igc2NyZWVuIHRlbGwgdGhlIHVzZXIgc29tZXRoaW5nCiAgICAgICAgICAgICAgICAvLyB1bmV4cGVjdGVkIGhhcHBlbmVkLgogICAgICAgICAgICAgICAgKDAsIF9ub3RpZmljYXRpb25zLmdldEZhdGFsRXJyb3JzKSgpLmFkZChfY29udGV4dC50MCwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmluZGV4TmFtZVZhbGlkYXRpb25GYXRhbEVycm9yVGl0bGUnLCB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRm9sbG93ZXIgSW5kZXggRm9ybSBpbmRleCBuYW1lIHZhbGlkYXRpb24nCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzAsIDldXSk7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gpIHsKICAgICAgICByZXR1cm4gX3JlZjUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DbHVzdGVyQ2hhbmdlIiwgZnVuY3Rpb24gKHJlbW90ZUNsdXN0ZXIpIHsKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgIHJlbW90ZUNsdXN0ZXI6IHJlbW90ZUNsdXN0ZXIKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRGaWVsZHMiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5zdGF0ZS5mb2xsb3dlckluZGV4OwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAidG9nZ2xlQWR2YW5jZWRTZXR0aW5ncyIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICAvLyBJZiB0aGUgdXNlciBlZGl0cyB0aGUgYWR2YW5jZWQgc2V0dGluZ3MgYnV0IHRoZW4gaGlkZXMgdGhlbSwgd2UgbmVlZCB0byBtYWtlIHN1cmUgdGhlCiAgICAgIC8vIGVkaXRlZCB2YWx1ZXMgZG9uJ3QgZ2V0IHNlbnQgdG8gdGhlIEFQSSB3aGVuIHRoZSB1c2VyIHNhdmVzLCBidXQgd2UgKmRvKiB3YW50IHRvIHJlc3RvcmUKICAgICAgLy8gdGhlc2UgdmFsdWVzIHRvIHRoZSBmb3JtIHdoZW4gdGhlIHVzZXIgcmUtb3BlbnMgdGhlIGFkdmFuY2VkIHNldHRpbmdzLgogICAgICBpZiAoZXZlbnQudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAvLyBBcHBseSB0aGUgY2FjaGVkIGFkdmFuY2VkIHNldHRpbmdzIHRvIHRoZSBhZHZhbmNlZCBzZXR0aW5ncyBmb3JtLgogICAgICAgIF90aGlzLm9uRmllbGRzQ2hhbmdlKF90aGlzLmNhY2hlZEFkdmFuY2VkU2V0dGluZ3MpOyAvLyBSZXNldCB0aGUgY2FjaGUgb2YgdGhlIGFkdmFuY2VkIHNldHRpbmdzLgoKCiAgICAgICAgX3RoaXMuY2FjaGVkQWR2YW5jZWRTZXR0aW5ncyA9IHt9OyAvLyBTaG93IHRoZSBhZHZhbmNlZCBzZXR0aW5ncy4KCiAgICAgICAgcmV0dXJuIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGFyZUFkdmFuY2VkU2V0dGluZ3NWaXNpYmxlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0gLy8gQ2xlYXIgdGhlIGFkdmFuY2VkIHNldHRpbmdzIGZvcm0uCgoKICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoX2FkdmFuY2VkX3NldHRpbmdzX2ZpZWxkcy5lbXB0eUFkdmFuY2VkU2V0dGluZ3MpOyAvLyBTYXZlIGEgY2FjaGUgb2YgdGhlIGFkdmFuY2VkIHNldHRpbmdzLgoKCiAgICAgIHZhciBmaWVsZHMgPSBfdGhpcy5nZXRGaWVsZHMoKTsKCiAgICAgIF90aGlzLmNhY2hlZEFkdmFuY2VkU2V0dGluZ3MgPSBfYWR2YW5jZWRfc2V0dGluZ3NfZmllbGRzLmFkdmFuY2VkU2V0dGluZ3NGaWVsZHMucmVkdWNlKGZ1bmN0aW9uIChjYWNoZSwgX3JlZjYpIHsKICAgICAgICB2YXIgZmllbGQgPSBfcmVmNi5maWVsZDsKICAgICAgICB2YXIgdmFsdWUgPSBmaWVsZHNbZmllbGRdOwoKICAgICAgICBpZiAodmFsdWUgIT09ICcnKSB7CiAgICAgICAgICBjYWNoZVtmaWVsZF0gPSB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjYWNoZTsKICAgICAgfSwge30pOyAvLyBIaWRlIHRoZSBhZHZhbmNlZCBzZXR0aW5ncy4KCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBhcmVBZHZhbmNlZFNldHRpbmdzVmlzaWJsZTogZmFsc2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzZW5kRm9ybSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzRm9ybVZhbGlkID0gX3RoaXMuaXNGb3JtVmFsaWQoKTsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiAhaXNGb3JtVmFsaWQKICAgICAgfSk7CgogICAgICBpZiAoIWlzRm9ybVZhbGlkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgX3RoaXMkZ2V0RmllbGRzID0gX3RoaXMuZ2V0RmllbGRzKCksCiAgICAgICAgICBuYW1lID0gX3RoaXMkZ2V0RmllbGRzLm5hbWUsCiAgICAgICAgICBmb2xsb3dlckluZGV4ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF90aGlzJGdldEZpZWxkcywgWyJuYW1lIl0pOwoKICAgICAgX3RoaXMucHJvcHMuc2F2ZUZvbGxvd2VySW5kZXgobmFtZSwgZm9sbG93ZXJJbmRleCk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjYW5jZWxGb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICBfcm91dGluZy5kZWZhdWx0Lm5hdmlnYXRlKCcvZm9sbG93ZXJfaW5kaWNlcycpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyRm9ybSIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBmb2xsb3dlckluZGV4ID0gX3RoaXMkc3RhdGUuZm9sbG93ZXJJbmRleCwKICAgICAgICAgIGlzTmV3ID0gX3RoaXMkc3RhdGUuaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlID0gX3RoaXMkc3RhdGUuYXJlRXJyb3JzVmlzaWJsZSwKICAgICAgICAgIGFyZUFkdmFuY2VkU2V0dGluZ3NWaXNpYmxlID0gX3RoaXMkc3RhdGUuYXJlQWR2YW5jZWRTZXR0aW5nc1Zpc2libGUsCiAgICAgICAgICBmaWVsZHNFcnJvcnMgPSBfdGhpcyRzdGF0ZS5maWVsZHNFcnJvcnMsCiAgICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleE5hbWUgPSBfdGhpcyRzdGF0ZS5pc1ZhbGlkYXRpbmdJbmRleE5hbWU7CiAgICAgIC8qKgogICAgICAgKiBGb2xsb3dlciBpbmRleCBuYW1lCiAgICAgICAqLwoKICAgICAgdmFyIGluZGV4TmFtZUhlbHBUZXh0ID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIGlzVmFsaWRhdGluZ0luZGV4TmFtZSAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmluZGV4TmFtZVZhbGlkYXRpbmdMYWJlbCIsCiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDaGVja2luZyBhdmFpbGFiaWxpdHlcdTIwMjYiCiAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5pbmRleE5hbWVIZWxwTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU3BhY2VzIGFuZCB0aGUgY2hhcmFjdGVycyB7Y2hhcmFjdGVyTGlzdH0gYXJlIG5vdCBhbGxvd2VkLiIsCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBjaGFyYWN0ZXJMaXN0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBpbmRleE5hbWVJbGxlZ2FsQ2hhcmFjdGVycykKICAgICAgICB9CiAgICAgIH0pKSk7CgogICAgICB2YXIgaW5kZXhOYW1lTGFiZWwgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uc2VjdGlvbkZvbGxvd2VySW5kZXhOYW1lVGl0bGUnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdGb2xsb3dlciBpbmRleCcKICAgICAgfSk7CgogICAgICB2YXIgcmVuZGVyRm9sbG93ZXJJbmRleE5hbWUgPSBmdW5jdGlvbiByZW5kZXJGb2xsb3dlckluZGV4TmFtZSgpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZm9ybV9lbnRyeV9yb3cuRm9ybUVudHJ5Um93LCB7CiAgICAgICAgICBmaWVsZDogIm5hbWUiLAogICAgICAgICAgdmFsdWU6IGZvbGxvd2VySW5kZXgubmFtZSwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMubmFtZSwKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGl0bGUsIHsKICAgICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMiIsIG51bGwsIGluZGV4TmFtZUxhYmVsKSksCiAgICAgICAgICBsYWJlbDogaW5kZXhOYW1lTGFiZWwsCiAgICAgICAgICBkZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLnNlY3Rpb25Gb2xsb3dlckluZGV4TmFtZURlc2NyaXB0aW9uJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0EgdW5pcXVlIG5hbWUgZm9yIHlvdXIgaW5kZXguJwogICAgICAgICAgfSksCiAgICAgICAgICBoZWxwVGV4dDogaW5kZXhOYW1lSGVscFRleHQsCiAgICAgICAgICBpc0xvYWRpbmc6IGlzVmFsaWRhdGluZ0luZGV4TmFtZSwKICAgICAgICAgIGRpc2FibGVkOiAhaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiBhcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgb25WYWx1ZVVwZGF0ZTogX3RoaXMub25JbmRleE5hbWVDaGFuZ2UsCiAgICAgICAgICB0ZXN0U3ViajogImZvbGxvd2VySW5kZXhJbnB1dCIKICAgICAgICB9KTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIFJlbW90ZSBDbHVzdGVyCiAgICAgICAqLwoKCiAgICAgIHZhciByZW5kZXJSZW1vdGVDbHVzdGVyRmllbGQgPSBmdW5jdGlvbiByZW5kZXJSZW1vdGVDbHVzdGVyRmllbGQoKSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzID0gX3RoaXMucHJvcHMsCiAgICAgICAgICAgIHJlbW90ZUNsdXN0ZXJzID0gX3RoaXMkcHJvcHMucmVtb3RlQ2x1c3RlcnMsCiAgICAgICAgICAgIGN1cnJlbnRVcmwgPSBfdGhpcyRwcm9wcy5jdXJyZW50VXJsOwogICAgICAgIHZhciBlcnJvck1lc3NhZ2VzID0gewogICAgICAgICAgbm9DbHVzdGVyRm91bmQ6IGZ1bmN0aW9uIG5vQ2x1c3RlckZvdW5kKCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmVtcHR5UmVtb3RlQ2x1c3RlcnNDYWxsT3V0RGVzY3JpcHRpb24iLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiUmVwbGljYXRpb24gcmVxdWlyZXMgYSBsZWFkZXIgaW5kZXggb24gYSByZW1vdGUgY2x1c3Rlci4iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIHJlbW90ZUNsdXN0ZXJOb3RDb25uZWN0ZWROb3RFZGl0YWJsZTogZnVuY3Rpb24gcmVtb3RlQ2x1c3Rlck5vdENvbm5lY3RlZE5vdEVkaXRhYmxlKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uY3VycmVudFJlbW90ZUNsdXN0ZXJOb3RDb25uZWN0ZWRDYWxsT3V0VGl0bGUiLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW4ndCBlZGl0IGZvbGxvd2VyIGluZGV4IGJlY2F1c2UgcmVtb3RlIGNsdXN0ZXIgJ3tuYW1lfScgaXMgbm90IGNvbm5lY3RlZCIsCiAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5jdXJyZW50UmVtb3RlQ2x1c3Rlck5vdENvbm5lY3RlZENhbGxPdXREZXNjcmlwdGlvbiIsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIllvdSBjYW4gYWRkcmVzcyB0aGlzIGJ5IGVkaXRpbmcgdGhlIHJlbW90ZSBjbHVzdGVyLiIKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9OwogICAgICAgICAgfSwKICAgICAgICAgIHJlbW90ZUNsdXN0ZXJEb2VzTm90RXhpc3Q6IGZ1bmN0aW9uIHJlbW90ZUNsdXN0ZXJEb2VzTm90RXhpc3QobmFtZSkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmN1cnJlbnRSZW1vdGVDbHVzdGVyTm90Rm91bmRDYWxsT3V0RGVzY3JpcHRpb24iLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVG8gZWRpdCB0aGlzIGZvbGxvd2VyIGluZGV4LCB5b3UgbXVzdCBhZGQgYSByZW1vdGUgY2x1c3RlciBuYW1lZCAne25hbWV9Jy4iLAogICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgbmFtZTogbmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgICBzaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5zZWN0aW9uUmVtb3RlQ2x1c3RlclRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZW1vdGUgY2x1c3RlciIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5zZWN0aW9uUmVtb3RlQ2x1c3RlckRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJUaGUgY2x1c3RlciB0aGF0IGNvbnRhaW5zIHRoZSBpbmRleCB0byByZXBsaWNhdGUuIgogICAgICAgICAgfSksCiAgICAgICAgICBmdWxsV2lkdGg6IHRydWUKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZW1vdGVfY2x1c3RlcnNfZm9ybV9maWVsZC5SZW1vdGVDbHVzdGVyc0Zvcm1GaWVsZCwgewogICAgICAgICAgc2VsZWN0ZWQ6IGZvbGxvd2VySW5kZXgucmVtb3RlQ2x1c3RlciA/IGZvbGxvd2VySW5kZXgucmVtb3RlQ2x1c3RlciA6IG51bGwsCiAgICAgICAgICByZW1vdGVDbHVzdGVyczogcmVtb3RlQ2x1c3RlcnMgfHwgW10sCiAgICAgICAgICBjdXJyZW50VXJsOiBjdXJyZW50VXJsLAogICAgICAgICAgaXNFZGl0YWJsZTogaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiBhcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgb25DaGFuZ2U6IF90aGlzLm9uQ2x1c3RlckNoYW5nZSwKICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIG9uRXJyb3IoZXJyb3IpIHsKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUodXBkYXRlRm9ybUVycm9ycyh7CiAgICAgICAgICAgICAgcmVtb3RlQ2x1c3RlcjogZXJyb3IKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSwKICAgICAgICAgIGVycm9yTWVzc2FnZXM6IGVycm9yTWVzc2FnZXMKICAgICAgICB9KSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBMZWFkZXIgaW5kZXgKICAgICAgICovCgoKICAgICAgdmFyIGxlYWRlckluZGV4TGFiZWwgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uc2VjdGlvbkxlYWRlckluZGV4VGl0bGUnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMZWFkZXIgaW5kZXgnCiAgICAgIH0pOwoKICAgICAgdmFyIHJlbmRlckxlYWRlckluZGV4ID0gZnVuY3Rpb24gcmVuZGVyTGVhZGVySW5kZXgoKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2Zvcm1fZW50cnlfcm93LkZvcm1FbnRyeVJvdywgewogICAgICAgICAgZmllbGQ6ICJsZWFkZXJJbmRleCIsCiAgICAgICAgICB2YWx1ZTogZm9sbG93ZXJJbmRleC5sZWFkZXJJbmRleCwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMubGVhZGVySW5kZXgsCiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCBsZWFkZXJJbmRleExhYmVsKSksCiAgICAgICAgICBsYWJlbDogbGVhZGVySW5kZXhMYWJlbCwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uc2VjdGlvbkxlYWRlckluZGV4RGVzY3JpcHRpb24iLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZSBpbmRleCBvbiB0aGUgcmVtb3RlIGNsdXN0ZXIgdG8gcmVwbGljYXRlIHRvIHRoZSBmb2xsb3dlciBpbmRleC4iCiAgICAgICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLnNlY3Rpb25MZWFkZXJJbmRleERlc2NyaXB0aW9uMiIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAie25vdGV9IFRoZSBsZWFkZXIgaW5kZXggbXVzdCBhbHJlYWR5IGV4aXN0LiIsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIG5vdGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLnNlY3Rpb25MZWFkZXJJbmRleERlc2NyaXB0aW9uMi5ub3RlTGFiZWwiLAogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOb3RlOiIKICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfQogICAgICAgICAgfSkpKSwKICAgICAgICAgIGhlbHBUZXh0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmluZGV4TmFtZUhlbHBMYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU3BhY2VzIGFuZCB0aGUgY2hhcmFjdGVycyB7Y2hhcmFjdGVyTGlzdH0gYXJlIG5vdCBhbGxvd2VkLiIsCiAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgIGNoYXJhY3Rlckxpc3Q6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInN0cm9uZyIsIG51bGwsIGluZGV4TmFtZUlsbGVnYWxDaGFyYWN0ZXJzKQogICAgICAgICAgICB9CiAgICAgICAgICB9KSwKICAgICAgICAgIGRpc2FibGVkOiAhaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiBhcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgb25WYWx1ZVVwZGF0ZTogX3RoaXMub25GaWVsZHNDaGFuZ2UsCiAgICAgICAgICB0ZXN0U3ViajogImxlYWRlckluZGV4SW5wdXQiCiAgICAgICAgfSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBBZHZhbmNlZCBzZXR0aW5ncwogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyQWR2YW5jZWRTZXR0aW5ncyA9IGZ1bmN0aW9uIHJlbmRlckFkdmFuY2VkU2V0dGluZ3MoKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpSG9yaXpvbnRhbFJ1bGUsIG51bGwpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRGVzY3JpYmVkRm9ybUdyb3VwLCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmFkdmFuY2VkU2V0dGluZ3NUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQWR2YW5jZWQgc2V0dGluZ3MgKG9wdGlvbmFsKSIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLmFkdmFuY2VkU2V0dGluZ3NEZXNjcmlwdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQWR2YW5jZWQgc2V0dGluZ3MgY29udHJvbCB0aGUgcmF0ZSBvZiByZXBsaWNhdGlvbi4gWW91IGNhbiBjdXN0b21pemUgdGhlc2Ugc2V0dGluZ3Mgb3IgdXNlIHRoZSBkZWZhdWx0IHZhbHVlcy4iCiAgICAgICAgICB9KSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgICAgICAgICAgbGFiZWw6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4LmFkdmFuY2VkU2V0dGluZ3NGb3JtLnNob3dTd2l0Y2hMYWJlbCIsCiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDdXN0b21pemUgYWR2YW5jZWQgc2V0dGluZ3MiCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICBjaGVja2VkOiBhcmVBZHZhbmNlZFNldHRpbmdzVmlzaWJsZSwKICAgICAgICAgICAgb25DaGFuZ2U6IF90aGlzLnRvZ2dsZUFkdmFuY2VkU2V0dGluZ3MsCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJhZHZhbmNlZFNldHRpbmdzVG9nZ2xlIgogICAgICAgICAgfSkpLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwpLCAiICIpLCBhcmVBZHZhbmNlZFNldHRpbmdzVmlzaWJsZSAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogInMiCiAgICAgICAgfSksIF9hZHZhbmNlZF9zZXR0aW5nc19maWVsZHMuYWR2YW5jZWRTZXR0aW5nc0ZpZWxkcy5tYXAoZnVuY3Rpb24gKGFkdmFuY2VkU2V0dGluZykgewogICAgICAgICAgdmFyIGZpZWxkID0gYWR2YW5jZWRTZXR0aW5nLmZpZWxkLAogICAgICAgICAgICAgIHRlc3RTdWJqZWN0ID0gYWR2YW5jZWRTZXR0aW5nLnRlc3RTdWJqZWN0LAogICAgICAgICAgICAgIHRpdGxlID0gYWR2YW5jZWRTZXR0aW5nLnRpdGxlLAogICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gYWR2YW5jZWRTZXR0aW5nLmRlc2NyaXB0aW9uLAogICAgICAgICAgICAgIGxhYmVsID0gYWR2YW5jZWRTZXR0aW5nLmxhYmVsLAogICAgICAgICAgICAgIGhlbHBUZXh0ID0gYWR2YW5jZWRTZXR0aW5nLmhlbHBUZXh0LAogICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9IGFkdmFuY2VkU2V0dGluZy5kZWZhdWx0VmFsdWUsCiAgICAgICAgICAgICAgdHlwZSA9IGFkdmFuY2VkU2V0dGluZy50eXBlOwogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2Zvcm1fZW50cnlfcm93LkZvcm1FbnRyeVJvdywgewogICAgICAgICAgICBrZXk6IGZpZWxkLAogICAgICAgICAgICBmaWVsZDogZmllbGQsCiAgICAgICAgICAgIHZhbHVlOiBmb2xsb3dlckluZGV4W2ZpZWxkXSwKICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBkZWZhdWx0VmFsdWUsCiAgICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnNbZmllbGRdLAogICAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICAgICAgc2l6ZTogInhzIgogICAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJoMyIsIG51bGwsIHRpdGxlKSksCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiwKICAgICAgICAgICAgbGFiZWw6IGxhYmVsLAogICAgICAgICAgICBoZWxwVGV4dDogaGVscFRleHQsCiAgICAgICAgICAgIHR5cGU6IHR5cGUsCiAgICAgICAgICAgIGFyZUVycm9yc1Zpc2libGU6IGFyZUVycm9yc1Zpc2libGUsCiAgICAgICAgICAgIG9uVmFsdWVVcGRhdGU6IF90aGlzLm9uRmllbGRzQ2hhbmdlLAogICAgICAgICAgICB0ZXN0U3ViajogdGVzdFN1YmplY3QKICAgICAgICAgIH0pOwogICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUhvcml6b250YWxSdWxlLCBudWxsKSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBGb3JtIEVycm9yIHdhcm5pbmcgbWVzc2FnZQogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyRm9ybUVycm9yV2FybmluZyA9IGZ1bmN0aW9uIHJlbmRlckZvcm1FcnJvcldhcm5pbmcoKSB7CiAgICAgICAgdmFyIGFyZUVycm9yc1Zpc2libGUgPSBfdGhpcy5zdGF0ZS5hcmVFcnJvcnNWaXNpYmxlOwoKICAgICAgICB2YXIgaXNGb3JtVmFsaWQgPSBfdGhpcy5pc0Zvcm1WYWxpZCgpOwoKICAgICAgICBpZiAoIWFyZUVycm9yc1Zpc2libGUgfHwgaXNGb3JtVmFsaWQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ2FsbE91dCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0udmFsaWRhdGlvbkVycm9yVGl0bGUiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZpeCBlcnJvcnMgYmVmb3JlIGNvbnRpbnVpbmcuIgogICAgICAgICAgfSksCiAgICAgICAgICBjb2xvcjogImRhbmdlciIsCiAgICAgICAgICBpY29uVHlwZTogImNyb3NzIiwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmb3JtRXJyb3IiCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJsIgogICAgICAgIH0pKTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIEZvcm0gQWN0aW9ucwogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyQWN0aW9ucyA9IGZ1bmN0aW9uIHJlbmRlckFjdGlvbnMoKSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzMiA9IF90aGlzLnByb3BzLAogICAgICAgICAgICBhcGlTdGF0dXMgPSBfdGhpcyRwcm9wczIuYXBpU3RhdHVzLAogICAgICAgICAgICBzYXZlQnV0dG9uTGFiZWwgPSBfdGhpcyRwcm9wczIuc2F2ZUJ1dHRvbkxhYmVsOwogICAgICAgIHZhciBfdGhpcyRzdGF0ZTIgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgYXJlRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlMi5hcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlID0gX3RoaXMkc3RhdGUyLmlzUmVxdWVzdFZpc2libGU7CgogICAgICAgIGlmIChhcGlTdGF0dXMgPT09IF9jb25zdGFudHMuQVBJX1NUQVRVUy5TQVZJTkcpIHsKICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAiZmxleFN0YXJ0IiwKICAgICAgICAgICAgZ3V0dGVyU2l6ZTogIm0iCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMb2FkaW5nU3Bpbm5lciwgewogICAgICAgICAgICBzaXplOiAibCIKICAgICAgICAgIH0pKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgIGdyb3c6IGZhbHNlCiAgICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpVGV4dCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5hY3Rpb25zLnNhdmluZ1RleHQiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmluZyIKICAgICAgICAgIH0pKSkpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGlzU2F2ZURpc2FibGVkID0gYXJlRXJyb3JzVmlzaWJsZSAmJiAhX3RoaXMuaXNGb3JtVmFsaWQoKTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJzcGFjZUJldHdlZW4iLAogICAgICAgICAgYWxpZ25JdGVtczogImNlbnRlciIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICBndXR0ZXJTaXplOiAibSIsCiAgICAgICAgICBhbGlnbkl0ZW1zOiAiY2VudGVyIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBjb2xvcjogInNlY29uZGFyeSIsCiAgICAgICAgICBpY29uVHlwZTogImNoZWNrIiwKICAgICAgICAgIG9uQ2xpY2s6IF90aGlzLnNlbmRGb3JtLAogICAgICAgICAgZmlsbDogdHJ1ZSwKICAgICAgICAgIGRpc2FibGVkOiBpc1NhdmVEaXNhYmxlZCwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzdWJtaXRCdXR0b24iCiAgICAgICAgfSwgc2F2ZUJ1dHRvbkxhYmVsKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICAgIGNvbG9yOiAicHJpbWFyeSIsCiAgICAgICAgICBvbkNsaWNrOiBfdGhpcy5jYW5jZWxGb3JtLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImNhbmNlbEJ1dHRvbiIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5jYW5jZWxCdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbmNlbCIKICAgICAgICB9KSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICBncm93OiBmYWxzZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlCdXR0b25FbXB0eSwgewogICAgICAgICAgb25DbGljazogX3RoaXMudG9nZ2xlUmVxdWVzdAogICAgICAgIH0sIGlzUmVxdWVzdFZpc2libGUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5mb2xsb3dlckluZGV4Rm9ybS5oaWRlUmVxdWVzdEJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSGlkZSByZXF1ZXN0IgogICAgICAgIH0pIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0uc2hvd1JlcXVlc3RCdXR0b25MYWJlbCIsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNob3cgcmVxdWVzdCIKICAgICAgICB9KSkpKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm0sIHsKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZm9sbG93ZXJJbmRleEZvcm0iCiAgICAgIH0sIHJlbmRlclJlbW90ZUNsdXN0ZXJGaWVsZCgpLCByZW5kZXJMZWFkZXJJbmRleCgpLCByZW5kZXJGb2xsb3dlckluZGV4TmFtZSgpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgc2l6ZTogInMiCiAgICAgIH0pLCByZW5kZXJBZHZhbmNlZFNldHRpbmdzKCkpLCByZW5kZXJGb3JtRXJyb3JXYXJuaW5nKCksIF90aGlzLnJlbmRlckFwaUVycm9ycygpLCByZW5kZXJBY3Rpb25zKCkpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicmVuZGVyTG9hZGluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGFwaVN0YXR1cyA9IF90aGlzLnByb3BzLmFwaVN0YXR1czsKCiAgICAgIGlmIChhcGlTdGF0dXMgPT09IF9jb25zdGFudHMuQVBJX1NUQVRVUy5TQVZJTkcpIHsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU92ZXJsYXlNYXNrLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTG9hZGluZ0tpYmFuYSwgewogICAgICAgICAgc2l6ZTogInhsIgogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9KTsKCiAgICB2YXIgc2VhcmNoID0gX3JvdXRpbmcuZGVmYXVsdC5yZWFjdFJvdXRlci5yb3V0ZS5sb2NhdGlvbi5zZWFyY2g7CiAgICB2YXIgcXVlcnlQYXJhbXMgPSAoMCwgX3F1ZXJ5X3BhcmFtcy5leHRyYWN0UXVlcnlQYXJhbXMpKHNlYXJjaCk7CgogICAgdmFyIF9pc05ldyA9IF90aGlzLnByb3BzLmZvbGxvd2VySW5kZXggPT09IHVuZGVmaW5lZDsKCiAgICB2YXIgcmVtb3RlQ2x1c3Rlck5hbWUgPSAoMCwgX2dldF9yZW1vdGVfY2x1c3Rlcl9uYW1lLmdldFJlbW90ZUNsdXN0ZXJOYW1lKShfdGhpcy5wcm9wcy5yZW1vdGVDbHVzdGVycywgcXVlcnlQYXJhbXMuY2x1c3Rlcik7CgogICAgdmFyIF9mb2xsb3dlckluZGV4ID0gX2lzTmV3ID8gZ2V0RW1wdHlGb2xsb3dlckluZGV4KHJlbW90ZUNsdXN0ZXJOYW1lKSA6IF9vYmplY3RTcHJlYWQoe30sIGdldEVtcHR5Rm9sbG93ZXJJbmRleCgpLCB7fSwgX3RoaXMucHJvcHMuZm9sbG93ZXJJbmRleCk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXN0ZWQtdGVybmFyeQoKCiAgICB2YXIgX2FyZUFkdmFuY2VkU2V0dGluZ3NWaXNpYmxlID0gX2lzTmV3ID8gZmFsc2UgOiAoMCwgX2FkdmFuY2VkX3NldHRpbmdzX2ZpZWxkcy5hcmVBZHZhbmNlZFNldHRpbmdzRWRpdGVkKShfZm9sbG93ZXJJbmRleCkgPyB0cnVlIDogZmFsc2U7CgogICAgdmFyIF9maWVsZHNFcnJvcnMgPSBfdGhpcy5nZXRGaWVsZHNFcnJvcnMoX2ZvbGxvd2VySW5kZXgpOwoKICAgIF90aGlzLnN0YXRlID0gewogICAgICBpc05ldzogX2lzTmV3LAogICAgICBmb2xsb3dlckluZGV4OiBfZm9sbG93ZXJJbmRleCwKICAgICAgZmllbGRzRXJyb3JzOiBfZmllbGRzRXJyb3JzLAogICAgICBhcmVFcnJvcnNWaXNpYmxlOiBmYWxzZSwKICAgICAgYXJlQWR2YW5jZWRTZXR0aW5nc1Zpc2libGU6IF9hcmVBZHZhbmNlZFNldHRpbmdzVmlzaWJsZSwKICAgICAgaXNWYWxpZGF0aW5nSW5kZXhOYW1lOiBmYWxzZSwKICAgICAgaXNSZXF1ZXN0VmlzaWJsZTogZmFsc2UKICAgIH07CiAgICBfdGhpcy5jYWNoZWRBZHZhbmNlZFNldHRpbmdzID0ge307CiAgICBfdGhpcy52YWxpZGF0ZUluZGV4TmFtZSA9ICgwLCBfbG9kYXNoLmRlYm91bmNlKShfdGhpcy52YWxpZGF0ZUluZGV4TmFtZSwgNTAwLCB7CiAgICAgIHRyYWlsaW5nOiB0cnVlCiAgICB9KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhGb2xsb3dlckluZGV4Rm9ybSwgW3sKICAgIGtleTogImlzRm9ybVZhbGlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0Zvcm1WYWxpZCgpIHsKICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5zdGF0ZS5maWVsZHNFcnJvcnMpLmV2ZXJ5KGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHJldHVybiBlcnJvciA9PT0gdW5kZWZpbmVkIHx8IGVycm9yID09PSBudWxsOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJBcGlFcnJvcnMiLAoKICAgIC8qKgogICAgICogU2VjdGlvbnMgUmVuZGVycwogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQXBpRXJyb3JzKCkgewogICAgICB2YXIgYXBpRXJyb3IgPSB0aGlzLnByb3BzLmFwaUVycm9yOwoKICAgICAgaWYgKGFwaUVycm9yKSB7CiAgICAgICAgdmFyIHRpdGxlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmZvbGxvd2VySW5kZXhGb3JtLnNhdmluZ0Vycm9yVGl0bGUnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbid0IGNyZWF0ZSBmb2xsb3dlciBpbmRleCIKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGxlYWRlckluZGV4ID0gdGhpcy5zdGF0ZS5mb2xsb3dlckluZGV4LmxlYWRlckluZGV4OwogICAgICAgIHZhciBlcnJvciA9IGFwaUVycm9yLnN0YXR1cyA9PT0gNDA0ID8gewogICAgICAgICAgZGF0YTogewogICAgICAgICAgICBtZXNzYWdlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uZm9sbG93ZXJJbmRleEZvcm0ubGVhZGVySW5kZXhOb3RGb3VuZEVycm9yJywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhlIGxlYWRlciBpbmRleCAne2xlYWRlckluZGV4fScgZG9lcyBub3QgZXhpc3QuIiwKICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgIGxlYWRlckluZGV4OiBsZWFkZXJJbmRleAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgIH0KICAgICAgICB9IDogYXBpRXJyb3I7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zZWN0aW9uX2Vycm9yLlNlY3Rpb25FcnJvciwgewogICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgZXJyb3I6IGVycm9yCiAgICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICAgIHNpemU6ICJsIgogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBmb2xsb3dlckluZGV4ID0gX3RoaXMkc3RhdGUzLmZvbGxvd2VySW5kZXgsCiAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlID0gX3RoaXMkc3RhdGUzLmlzUmVxdWVzdFZpc2libGU7CiAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgdGhpcy5yZW5kZXJGb3JtKCksIHRoaXMucmVuZGVyTG9hZGluZygpLCBpc1JlcXVlc3RWaXNpYmxlID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZm9sbG93ZXJfaW5kZXhfcmVxdWVzdF9mbHlvdXQuRm9sbG93ZXJJbmRleFJlcXVlc3RGbHlvdXQsIHsKICAgICAgICBuYW1lOiBmb2xsb3dlckluZGV4Lm5hbWUsCiAgICAgICAgZm9sbG93ZXJJbmRleDogdGhpcy5nZXRGaWVsZHMoKSwKICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLnNldFN0YXRlKHsKICAgICAgICAgICAgaXNSZXF1ZXN0VmlzaWJsZTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSkgOiBudWxsKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBGb2xsb3dlckluZGV4Rm9ybTsKfShfcmVhY3QuUHVyZUNvbXBvbmVudCk7CgpleHBvcnRzLkZvbGxvd2VySW5kZXhGb3JtID0gRm9sbG93ZXJJbmRleEZvcm07CgpfZGVmaW5lUHJvcGVydHkoRm9sbG93ZXJJbmRleEZvcm0sICJwcm9wVHlwZXMiLCB7CiAgc2F2ZUZvbGxvd2VySW5kZXg6IF9wcm9wVHlwZXMuZGVmYXVsdC5mdW5jLmlzUmVxdWlyZWQsCiAgY2xlYXJBcGlFcnJvcjogX3Byb3BUeXBlcy5kZWZhdWx0LmZ1bmMuaXNSZXF1aXJlZCwKICBmb2xsb3dlckluZGV4OiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIGFwaUVycm9yOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIGFwaVN0YXR1czogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZy5pc1JlcXVpcmVkLAogIHJlbW90ZUNsdXN0ZXJzOiBfcHJvcFR5cGVzLmRlZmF1bHQuYXJyYXksCiAgc2F2ZUJ1dHRvbkxhYmVsOiBfcHJvcFR5cGVzLmRlZmF1bHQubm9kZQp9KTs="},null]}