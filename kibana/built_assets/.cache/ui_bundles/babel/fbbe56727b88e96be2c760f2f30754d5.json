{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/ui/filter_bar/filter_editor/index.js","dependencies":[{"path":"src/plugins/data/public/ui/filter_bar/filter_editor/index.js","mtime":1589249550687},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuRmlsdGVyRWRpdG9yID0gdm9pZCAwOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9yZWFjdCA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfcmVhY3QyID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX2dlbmVyaWNfY29tYm9fYm94ID0gcmVxdWlyZSgiLi9nZW5lcmljX2NvbWJvX2JveCIpOwoKdmFyIF9maWx0ZXJfZWRpdG9yX3V0aWxzID0gcmVxdWlyZSgiLi9saWIvZmlsdGVyX2VkaXRvcl91dGlscyIpOwoKdmFyIF9waHJhc2VfdmFsdWVfaW5wdXQgPSByZXF1aXJlKCIuL3BocmFzZV92YWx1ZV9pbnB1dCIpOwoKdmFyIF9waHJhc2VzX3ZhbHVlc19pbnB1dCA9IHJlcXVpcmUoIi4vcGhyYXNlc192YWx1ZXNfaW5wdXQiKTsKCnZhciBfcmFuZ2VfdmFsdWVfaW5wdXQgPSByZXF1aXJlKCIuL3JhbmdlX3ZhbHVlX2lucHV0Iik7Cgp2YXIgX2NvbW1vbiA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uL2NvbW1vbiIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogICAgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKICB9OwogIHJldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBGaWx0ZXJFZGl0b3JVSSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoRmlsdGVyRWRpdG9yVUksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBGaWx0ZXJFZGl0b3JVSShwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBGaWx0ZXJFZGl0b3JVSSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoRmlsdGVyRWRpdG9yVUkpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJ0b2dnbGVDdXN0b21FZGl0b3IiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpc0N1c3RvbUVkaXRvck9wZW4gPSAhX3RoaXMuc3RhdGUuaXNDdXN0b21FZGl0b3JPcGVuOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGlzQ3VzdG9tRWRpdG9yT3BlbjogaXNDdXN0b21FZGl0b3JPcGVuCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25JbmRleFBhdHRlcm5DaGFuZ2UiLCBmdW5jdGlvbiAoX3JlZikgewogICAgICB2YXIgX3JlZjIgPSBfc2xpY2VkVG9BcnJheShfcmVmLCAxKSwKICAgICAgICAgIHNlbGVjdGVkSW5kZXhQYXR0ZXJuID0gX3JlZjJbMF07CgogICAgICB2YXIgc2VsZWN0ZWRGaWVsZCA9IHVuZGVmaW5lZDsKICAgICAgdmFyIHNlbGVjdGVkT3BlcmF0b3IgPSB1bmRlZmluZWQ7CiAgICAgIHZhciBwYXJhbXMgPSB1bmRlZmluZWQ7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2VsZWN0ZWRJbmRleFBhdHRlcm46IHNlbGVjdGVkSW5kZXhQYXR0ZXJuLAogICAgICAgIHNlbGVjdGVkRmllbGQ6IHNlbGVjdGVkRmllbGQsCiAgICAgICAgc2VsZWN0ZWRPcGVyYXRvcjogc2VsZWN0ZWRPcGVyYXRvciwKICAgICAgICBwYXJhbXM6IHBhcmFtcwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uRmllbGRDaGFuZ2UiLCBmdW5jdGlvbiAoX3JlZjMpIHsKICAgICAgdmFyIF9yZWY0ID0gX3NsaWNlZFRvQXJyYXkoX3JlZjMsIDEpLAogICAgICAgICAgc2VsZWN0ZWRGaWVsZCA9IF9yZWY0WzBdOwoKICAgICAgdmFyIHNlbGVjdGVkT3BlcmF0b3IgPSB1bmRlZmluZWQ7CiAgICAgIHZhciBwYXJhbXMgPSB1bmRlZmluZWQ7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2VsZWN0ZWRGaWVsZDogc2VsZWN0ZWRGaWVsZCwKICAgICAgICBzZWxlY3RlZE9wZXJhdG9yOiBzZWxlY3RlZE9wZXJhdG9yLAogICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25PcGVyYXRvckNoYW5nZSIsIGZ1bmN0aW9uIChfcmVmNSkgewogICAgICB2YXIgX3JlZjYgPSBfc2xpY2VkVG9BcnJheShfcmVmNSwgMSksCiAgICAgICAgICBzZWxlY3RlZE9wZXJhdG9yID0gX3JlZjZbMF07IC8vIE9ubHkgcmVzZXQgcGFyYW1zIHdoZW4gdGhlIG9wZXJhdG9yIHR5cGUgY2hhbmdlcwoKCiAgICAgIHZhciBwYXJhbXMgPSAoMCwgX2xvZGFzaC5nZXQpKF90aGlzLnN0YXRlLnNlbGVjdGVkT3BlcmF0b3IsICd0eXBlJykgPT09ICgwLCBfbG9kYXNoLmdldCkoc2VsZWN0ZWRPcGVyYXRvciwgJ3R5cGUnKSA/IF90aGlzLnN0YXRlLnBhcmFtcyA6IHVuZGVmaW5lZDsKCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBzZWxlY3RlZE9wZXJhdG9yOiBzZWxlY3RlZE9wZXJhdG9yLAogICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DdXN0b21MYWJlbFN3aXRjaENoYW5nZSIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgdXNlQ3VzdG9tTGFiZWwgPSBldmVudC50YXJnZXQuY2hlY2tlZDsKICAgICAgdmFyIGN1c3RvbUxhYmVsID0gZXZlbnQudGFyZ2V0LmNoZWNrZWQgPyAnJyA6IG51bGw7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgdXNlQ3VzdG9tTGFiZWw6IHVzZUN1c3RvbUxhYmVsLAogICAgICAgIGN1c3RvbUxhYmVsOiBjdXN0b21MYWJlbAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ3VzdG9tTGFiZWxDaGFuZ2UiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgdmFyIGN1c3RvbUxhYmVsID0gZXZlbnQudGFyZ2V0LnZhbHVlOwoKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIGN1c3RvbUxhYmVsOiBjdXN0b21MYWJlbAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uUGFyYW1zQ2hhbmdlIiwgZnVuY3Rpb24gKHBhcmFtcykgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgcGFyYW1zOiBwYXJhbXMKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5RHNsQ2hhbmdlIiwgZnVuY3Rpb24gKHF1ZXJ5RHNsKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBxdWVyeURzbDogcXVlcnlEc2wKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblN1Ym1pdCIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlID0gX3RoaXMuc3RhdGUsCiAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfdGhpcyRzdGF0ZS5zZWxlY3RlZEluZGV4UGF0dGVybiwKICAgICAgICAgIGZpZWxkID0gX3RoaXMkc3RhdGUuc2VsZWN0ZWRGaWVsZCwKICAgICAgICAgIG9wZXJhdG9yID0gX3RoaXMkc3RhdGUuc2VsZWN0ZWRPcGVyYXRvciwKICAgICAgICAgIHBhcmFtcyA9IF90aGlzJHN0YXRlLnBhcmFtcywKICAgICAgICAgIHVzZUN1c3RvbUxhYmVsID0gX3RoaXMkc3RhdGUudXNlQ3VzdG9tTGFiZWwsCiAgICAgICAgICBjdXN0b21MYWJlbCA9IF90aGlzJHN0YXRlLmN1c3RvbUxhYmVsLAogICAgICAgICAgaXNDdXN0b21FZGl0b3JPcGVuID0gX3RoaXMkc3RhdGUuaXNDdXN0b21FZGl0b3JPcGVuLAogICAgICAgICAgcXVlcnlEc2wgPSBfdGhpcyRzdGF0ZS5xdWVyeURzbDsKICAgICAgdmFyICRzdGF0ZSA9IF90aGlzLnByb3BzLmZpbHRlci4kc3RhdGU7CgogICAgICBpZiAoISRzdGF0ZSB8fCAhJHN0YXRlLnN0b3JlKSB7CiAgICAgICAgcmV0dXJuOyAvLyB0eXBlc2NyaXB0IHZhbGlkYXRpb24KICAgICAgfQoKICAgICAgdmFyIGFsaWFzID0gdXNlQ3VzdG9tTGFiZWwgPyBjdXN0b21MYWJlbCA6IG51bGw7CgogICAgICBpZiAoaXNDdXN0b21FZGl0b3JPcGVuKSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzJGZpbHRlciRtZSA9IF90aGlzLnByb3BzLmZpbHRlci5tZXRhLAogICAgICAgICAgICBpbmRleCA9IF90aGlzJHByb3BzJGZpbHRlciRtZS5pbmRleCwKICAgICAgICAgICAgZGlzYWJsZWQgPSBfdGhpcyRwcm9wcyRmaWx0ZXIkbWUuZGlzYWJsZWQsCiAgICAgICAgICAgIG5lZ2F0ZSA9IF90aGlzJHByb3BzJGZpbHRlciRtZS5uZWdhdGU7CiAgICAgICAgdmFyIG5ld0luZGV4ID0gaW5kZXggfHwgX3RoaXMucHJvcHMuaW5kZXhQYXR0ZXJuc1swXS5pZDsKICAgICAgICB2YXIgYm9keSA9IEpTT04ucGFyc2UocXVlcnlEc2wpOwoKICAgICAgICB2YXIgX2ZpbHRlciA9ICgwLCBfY29tbW9uLmJ1aWxkQ3VzdG9tRmlsdGVyKShuZXdJbmRleCwgYm9keSwgZGlzYWJsZWQsIG5lZ2F0ZSwgYWxpYXMsICRzdGF0ZS5zdG9yZSk7CgogICAgICAgIF90aGlzLnByb3BzLm9uU3VibWl0KF9maWx0ZXIpOwogICAgICB9IGVsc2UgaWYgKGluZGV4UGF0dGVybiAmJiBmaWVsZCAmJiBvcGVyYXRvcikgewogICAgICAgIHZhciBfZmlsdGVyMiA9ICgwLCBfY29tbW9uLmJ1aWxkRmlsdGVyKShpbmRleFBhdHRlcm4sIGZpZWxkLCBvcGVyYXRvci50eXBlLCBvcGVyYXRvci5uZWdhdGUsIF90aGlzLnByb3BzLmZpbHRlci5tZXRhLmRpc2FibGVkLCBwYXJhbXMgIT09IG51bGwgJiYgcGFyYW1zICE9PSB2b2lkIDAgPyBwYXJhbXMgOiAnJywgYWxpYXMsICRzdGF0ZS5zdG9yZSk7CgogICAgICAgIF90aGlzLnByb3BzLm9uU3VibWl0KF9maWx0ZXIyKTsKICAgICAgfQogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIHNlbGVjdGVkSW5kZXhQYXR0ZXJuOiBfdGhpcy5nZXRJbmRleFBhdHRlcm5Gcm9tRmlsdGVyKCksCiAgICAgIHNlbGVjdGVkRmllbGQ6IF90aGlzLmdldEZpZWxkRnJvbUZpbHRlcigpLAogICAgICBzZWxlY3RlZE9wZXJhdG9yOiBfdGhpcy5nZXRTZWxlY3RlZE9wZXJhdG9yKCksCiAgICAgIHBhcmFtczogKDAsIF9jb21tb24uZ2V0RmlsdGVyUGFyYW1zKShwcm9wcy5maWx0ZXIpLAogICAgICB1c2VDdXN0b21MYWJlbDogcHJvcHMuZmlsdGVyLm1ldGEuYWxpYXMgIT09IG51bGwsCiAgICAgIGN1c3RvbUxhYmVsOiBwcm9wcy5maWx0ZXIubWV0YS5hbGlhcywKICAgICAgcXVlcnlEc2w6IEpTT04uc3RyaW5naWZ5KCgwLCBfY29tbW9uLmNsZWFuRmlsdGVyKShwcm9wcy5maWx0ZXIpLCBudWxsLCAyKSwKICAgICAgaXNDdXN0b21FZGl0b3JPcGVuOiBfdGhpcy5pc1Vua25vd25GaWx0ZXJUeXBlKCkKICAgIH07CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRmlsdGVyRWRpdG9yVUksIFt7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVBvcG92ZXJUaXRsZSwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICBhbGlnbkl0ZW1zOiAiYmFzZWxpbmUiLAogICAgICAgIHJlc3BvbnNpdmU6IGZhbHNlCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJkYXRhLmZpbHRlci5maWx0ZXJFZGl0b3IuZWRpdEZpbHRlclBvcHVwVGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRWRpdCBmaWx0ZXIiCiAgICAgIH0pKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlLAogICAgICAgIGNsYXNzTmFtZTogImZpbHRlckVkaXRvcl9faGlkZGVuSXRlbSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiBmYWxzZQogICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbkVtcHR5LCB7CiAgICAgICAgc2l6ZTogInhzIiwKICAgICAgICBvbkNsaWNrOiB0aGlzLnRvZ2dsZUN1c3RvbUVkaXRvcgogICAgICB9LCB0aGlzLnN0YXRlLmlzQ3VzdG9tRWRpdG9yT3BlbiA/IF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgaWQ6ICJkYXRhLmZpbHRlci5maWx0ZXJFZGl0b3IuZWRpdEZpbHRlclZhbHVlc0J1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQgZmlsdGVyIHZhbHVlcyIKICAgICAgfSkgOiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiZGF0YS5maWx0ZXIuZmlsdGVyRWRpdG9yLmVkaXRRdWVyeURzbEJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkVkaXQgYXMgUXVlcnkgRFNMIgogICAgICB9KSkpKSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgY2xhc3NOYW1lOiAiZ2xvYmFsRmlsdGVySXRlbV9fZWRpdG9yRm9ybSIKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtLCBudWxsLCB0aGlzLnJlbmRlckluZGV4UGF0dGVybklucHV0KCksIHRoaXMuc3RhdGUuaXNDdXN0b21FZGl0b3JPcGVuID8gdGhpcy5yZW5kZXJDdXN0b21FZGl0b3IoKSA6IHRoaXMucmVuZGVyUmVndWxhckVkaXRvcigpLCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgIHNpemU6ICJtIgogICAgICB9KSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTd2l0Y2gsIHsKICAgICAgICBpZDogImZpbHRlckVkaXRvckN1c3RvbUxhYmVsU3dpdGNoIiwKICAgICAgICBsYWJlbDogdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdkYXRhLmZpbHRlci5maWx0ZXJFZGl0b3IuY3JlYXRlQ3VzdG9tTGFiZWxTd2l0Y2hMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0NyZWF0ZSBjdXN0b20gbGFiZWw/JwogICAgICAgIH0pLAogICAgICAgIGNoZWNrZWQ6IHRoaXMuc3RhdGUudXNlQ3VzdG9tTGFiZWwsCiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25DdXN0b21MYWJlbFN3aXRjaENoYW5nZQogICAgICB9KSwgdGhpcy5zdGF0ZS51c2VDdXN0b21MYWJlbCAmJiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2RhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5jcmVhdGVDdXN0b21MYWJlbElucHV0TGFiZWwnLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDdXN0b20gbGFiZWwnCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIHsKICAgICAgICB2YWx1ZTogIiIuY29uY2F0KHRoaXMuc3RhdGUuY3VzdG9tTGFiZWwpLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uQ3VzdG9tTGFiZWxDaGFuZ2UKICAgICAgfSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibSIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgZGlyZWN0aW9uOiAicm93UmV2ZXJzZSIsCiAgICAgICAgYWxpZ25JdGVtczogImNlbnRlciIsCiAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgZmlsbDogdHJ1ZSwKICAgICAgICBvbkNsaWNrOiB0aGlzLm9uU3VibWl0LAogICAgICAgIGlzRGlzYWJsZWQ6ICF0aGlzLmlzRmlsdGVyVmFsaWQoKSwKICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAic2F2ZUZpbHRlciIKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogImRhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5zYXZlQnV0dG9uTGFiZWwiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU2F2ZSIKICAgICAgfSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICBmbHVzaDogInJpZ2h0IiwKICAgICAgICBvbkNsaWNrOiB0aGlzLnByb3BzLm9uQ2FuY2VsLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJjYW5jZWxTYXZlRmlsdGVyIgogICAgICB9LCBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgIGlkOiAiZGF0YS5maWx0ZXIuZmlsdGVyRWRpdG9yLmNhbmNlbEJ1dHRvbkxhYmVsIiwKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbmNlbCIKICAgICAgfSkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgbnVsbCkpKSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckluZGV4UGF0dGVybklucHV0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJJbmRleFBhdHRlcm5JbnB1dCgpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICBpZiAodGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmxlbmd0aCA8PSAxICYmIHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJucy5maW5kKGZ1bmN0aW9uIChpbmRleFBhdHRlcm4pIHsKICAgICAgICByZXR1cm4gaW5kZXhQYXR0ZXJuID09PSBfdGhpczIuc3RhdGUuc2VsZWN0ZWRJbmRleFBhdHRlcm47CiAgICAgIH0pKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICB2YXIgc2VsZWN0ZWRJbmRleFBhdHRlcm4gPSB0aGlzLnN0YXRlLnNlbGVjdGVkSW5kZXhQYXR0ZXJuOwogICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2RhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5pbmRleFBhdHRlcm5TZWxlY3RMYWJlbCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0luZGV4IFBhdHRlcm4nCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoSW5kZXhQYXR0ZXJuQ29tYm9Cb3gsIHsKICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdkYXRhLmZpbHRlci5maWx0ZXJCYXIuaW5kZXhQYXR0ZXJuU2VsZWN0UGxhY2Vob2xkZXInLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTZWxlY3QgYW4gaW5kZXggcGF0dGVybicKICAgICAgICB9KSwKICAgICAgICBvcHRpb25zOiB0aGlzLnByb3BzLmluZGV4UGF0dGVybnMsCiAgICAgICAgc2VsZWN0ZWRPcHRpb25zOiBzZWxlY3RlZEluZGV4UGF0dGVybiA/IFtzZWxlY3RlZEluZGV4UGF0dGVybl0gOiBbXSwKICAgICAgICBnZXRMYWJlbDogZnVuY3Rpb24gZ2V0TGFiZWwoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICByZXR1cm4gaW5kZXhQYXR0ZXJuLnRpdGxlOwogICAgICAgIH0sCiAgICAgICAgb25DaGFuZ2U6IHRoaXMub25JbmRleFBhdHRlcm5DaGFuZ2UsCiAgICAgICAgc2luZ2xlU2VsZWN0aW9uOiB7CiAgICAgICAgICBhc1BsYWluVGV4dDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgaXNDbGVhcmFibGU6IGZhbHNlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWx0ZXJJbmRleFBhdHRlcm5zU2VsZWN0IgogICAgICB9KSkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJSZWd1bGFyRWRpdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJSZWd1bGFyRWRpdG9yKCkgewogICAgICByZXR1cm4gX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgcmVzcG9uc2l2ZTogZmFsc2UsCiAgICAgICAgZ3V0dGVyU2l6ZTogInMiCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICBncm93OiAyCiAgICAgIH0sIHRoaXMucmVuZGVyRmllbGRJbnB1dCgpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgIGdyb3c6IGZhbHNlLAogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBmbGV4QmFzaXM6IDE2MAogICAgICAgIH0KICAgICAgfSwgdGhpcy5yZW5kZXJPcGVyYXRvcklucHV0KCkpKSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAicyIKICAgICAgfSksIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImZpbHRlclBhcmFtcyIKICAgICAgfSwgdGhpcy5yZW5kZXJQYXJhbXNFZGl0b3IoKSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckZpZWxkSW5wdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckZpZWxkSW5wdXQoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTIgPSB0aGlzLnN0YXRlLAogICAgICAgICAgc2VsZWN0ZWRJbmRleFBhdHRlcm4gPSBfdGhpcyRzdGF0ZTIuc2VsZWN0ZWRJbmRleFBhdHRlcm4sCiAgICAgICAgICBzZWxlY3RlZEZpZWxkID0gX3RoaXMkc3RhdGUyLnNlbGVjdGVkRmllbGQ7CiAgICAgIHZhciBmaWVsZHMgPSBzZWxlY3RlZEluZGV4UGF0dGVybiA/ICgwLCBfZmlsdGVyX2VkaXRvcl91dGlscy5nZXRGaWx0ZXJhYmxlRmllbGRzKShzZWxlY3RlZEluZGV4UGF0dGVybikgOiBbXTsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2RhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5maWVsZFNlbGVjdExhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRmllbGQnCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoRmllbGRDb21ib0JveCwgewogICAgICAgIGlkOiAiZmllbGRJbnB1dCIsCiAgICAgICAgaXNEaXNhYmxlZDogIXNlbGVjdGVkSW5kZXhQYXR0ZXJuLAogICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2RhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5maWVsZFNlbGVjdFBsYWNlaG9sZGVyJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VsZWN0IGEgZmllbGQgZmlyc3QnCiAgICAgICAgfSksCiAgICAgICAgb3B0aW9uczogZmllbGRzLAogICAgICAgIHNlbGVjdGVkT3B0aW9uczogc2VsZWN0ZWRGaWVsZCA/IFtzZWxlY3RlZEZpZWxkXSA6IFtdLAogICAgICAgIGdldExhYmVsOiBmdW5jdGlvbiBnZXRMYWJlbChmaWVsZCkgewogICAgICAgICAgcmV0dXJuIGZpZWxkLm5hbWU7CiAgICAgICAgfSwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbkZpZWxkQ2hhbmdlLAogICAgICAgIHNpbmdsZVNlbGVjdGlvbjogewogICAgICAgICAgYXNQbGFpblRleHQ6IHRydWUKICAgICAgICB9LAogICAgICAgIGlzQ2xlYXJhYmxlOiBmYWxzZSwKICAgICAgICBjbGFzc05hbWU6ICJnbG9iYWxGaWx0ZXJFZGl0b3JfX2ZpZWxkSW5wdXQiLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWx0ZXJGaWVsZFN1Z2dlc3Rpb25MaXN0IgogICAgICB9KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyT3BlcmF0b3JJbnB1dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyT3BlcmF0b3JJbnB1dCgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBzZWxlY3RlZEZpZWxkID0gX3RoaXMkc3RhdGUzLnNlbGVjdGVkRmllbGQsCiAgICAgICAgICBzZWxlY3RlZE9wZXJhdG9yID0gX3RoaXMkc3RhdGUzLnNlbGVjdGVkT3BlcmF0b3I7CiAgICAgIHZhciBvcGVyYXRvcnMgPSBzZWxlY3RlZEZpZWxkID8gKDAsIF9maWx0ZXJfZWRpdG9yX3V0aWxzLmdldE9wZXJhdG9yT3B0aW9ucykoc2VsZWN0ZWRGaWVsZCkgOiBbXTsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiB0aGlzLnByb3BzLmludGwuZm9ybWF0TWVzc2FnZSh7CiAgICAgICAgICBpZDogJ2RhdGEuZmlsdGVyLmZpbHRlckVkaXRvci5vcGVyYXRvclNlbGVjdExhYmVsJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnT3BlcmF0b3InCiAgICAgICAgfSkKICAgICAgfSwgX3JlYWN0Mi5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoT3BlcmF0b3JDb21ib0JveCwgewogICAgICAgIGlzRGlzYWJsZWQ6ICFzZWxlY3RlZEZpZWxkLAogICAgICAgIHBsYWNlaG9sZGVyOiBzZWxlY3RlZEZpZWxkID8gdGhpcy5wcm9wcy5pbnRsLmZvcm1hdE1lc3NhZ2UoewogICAgICAgICAgaWQ6ICdkYXRhLmZpbHRlci5maWx0ZXJFZGl0b3Iub3BlcmF0b3JTZWxlY3RQbGFjZWhvbGRlclNlbGVjdCcsCiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NlbGVjdCcKICAgICAgICB9KSA6IHRoaXMucHJvcHMuaW50bC5mb3JtYXRNZXNzYWdlKHsKICAgICAgICAgIGlkOiAnZGF0YS5maWx0ZXIuZmlsdGVyRWRpdG9yLm9wZXJhdG9yU2VsZWN0UGxhY2Vob2xkZXJXYWl0aW5nJywKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnV2FpdGluZycKICAgICAgICB9KSwKICAgICAgICBvcHRpb25zOiBvcGVyYXRvcnMsCiAgICAgICAgc2VsZWN0ZWRPcHRpb25zOiBzZWxlY3RlZE9wZXJhdG9yID8gW3NlbGVjdGVkT3BlcmF0b3JdIDogW10sCiAgICAgICAgZ2V0TGFiZWw6IGZ1bmN0aW9uIGdldExhYmVsKF9yZWY3KSB7CiAgICAgICAgICB2YXIgbWVzc2FnZSA9IF9yZWY3Lm1lc3NhZ2U7CiAgICAgICAgICByZXR1cm4gbWVzc2FnZTsKICAgICAgICB9LAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uT3BlcmF0b3JDaGFuZ2UsCiAgICAgICAgc2luZ2xlU2VsZWN0aW9uOiB7CiAgICAgICAgICBhc1BsYWluVGV4dDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgaXNDbGVhcmFibGU6IGZhbHNlLAogICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJmaWx0ZXJPcGVyYXRvckxpc3QiCiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJDdXN0b21FZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckN1c3RvbUVkaXRvcigpIHsKICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5maWx0ZXIuZmlsdGVyRWRpdG9yLnF1ZXJ5RHNsTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0VsYXN0aWNzZWFyY2ggUXVlcnkgRFNMJwogICAgICAgIH0pCiAgICAgIH0sIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQ29kZUVkaXRvciwgewogICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnF1ZXJ5RHNsLAogICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUXVlcnlEc2xDaGFuZ2UsCiAgICAgICAgbW9kZTogImpzb24iLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMjUwcHgiCiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJQYXJhbXNFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclBhcmFtc0VkaXRvcigpIHsKICAgICAgdmFyIGluZGV4UGF0dGVybiA9IHRoaXMuc3RhdGUuc2VsZWN0ZWRJbmRleFBhdHRlcm47CgogICAgICBpZiAoIWluZGV4UGF0dGVybiB8fCAhdGhpcy5zdGF0ZS5zZWxlY3RlZE9wZXJhdG9yKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CgogICAgICBzd2l0Y2ggKHRoaXMuc3RhdGUuc2VsZWN0ZWRPcGVyYXRvci50eXBlKSB7CiAgICAgICAgY2FzZSAnZXhpc3RzJzoKICAgICAgICAgIHJldHVybiAnJzsKCiAgICAgICAgY2FzZSAncGhyYXNlJzoKICAgICAgICAgIHJldHVybiBfcmVhY3QyLmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcGhyYXNlX3ZhbHVlX2lucHV0LlBocmFzZVZhbHVlSW5wdXQsIHsKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuOiBpbmRleFBhdHRlcm4sCiAgICAgICAgICAgIGZpZWxkOiB0aGlzLnN0YXRlLnNlbGVjdGVkRmllbGQsCiAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLnBhcmFtcywKICAgICAgICAgICAgb25DaGFuZ2U6IHRoaXMub25QYXJhbXNDaGFuZ2UsCiAgICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJwaHJhc2VWYWx1ZUlucHV0IgogICAgICAgICAgfSk7CgogICAgICAgIGNhc2UgJ3BocmFzZXMnOgogICAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9waHJhc2VzX3ZhbHVlc19pbnB1dC5QaHJhc2VzVmFsdWVzSW5wdXQsIHsKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuOiBpbmRleFBhdHRlcm4sCiAgICAgICAgICAgIGZpZWxkOiB0aGlzLnN0YXRlLnNlbGVjdGVkRmllbGQsCiAgICAgICAgICAgIHZhbHVlczogdGhpcy5zdGF0ZS5wYXJhbXMsCiAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLm9uUGFyYW1zQ2hhbmdlCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSAncmFuZ2UnOgogICAgICAgICAgcmV0dXJuIF9yZWFjdDIuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yYW5nZV92YWx1ZV9pbnB1dC5SYW5nZVZhbHVlSW5wdXQsIHsKICAgICAgICAgICAgZmllbGQ6IHRoaXMuc3RhdGUuc2VsZWN0ZWRGaWVsZCwKICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUucGFyYW1zLAogICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5vblBhcmFtc0NoYW5nZQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc1Vua25vd25GaWx0ZXJUeXBlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1Vua25vd25GaWx0ZXJUeXBlKCkgewogICAgICB2YXIgdHlwZSA9IHRoaXMucHJvcHMuZmlsdGVyLm1ldGEudHlwZTsKICAgICAgcmV0dXJuICEhdHlwZSAmJiAhWydwaHJhc2UnLCAncGhyYXNlcycsICdyYW5nZScsICdleGlzdHMnXS5pbmNsdWRlcyh0eXBlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJbmRleFBhdHRlcm5Gcm9tRmlsdGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleFBhdHRlcm5Gcm9tRmlsdGVyKCkgewogICAgICByZXR1cm4gKDAsIF9jb21tb24uZ2V0SW5kZXhQYXR0ZXJuRnJvbUZpbHRlcikodGhpcy5wcm9wcy5maWx0ZXIsIHRoaXMucHJvcHMuaW5kZXhQYXR0ZXJucyk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRGcm9tRmlsdGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZEZyb21GaWx0ZXIoKSB7CiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSB0aGlzLmdldEluZGV4UGF0dGVybkZyb21GaWx0ZXIoKTsKICAgICAgcmV0dXJuIGluZGV4UGF0dGVybiAmJiAoMCwgX2ZpbHRlcl9lZGl0b3JfdXRpbHMuZ2V0RmllbGRGcm9tRmlsdGVyKSh0aGlzLnByb3BzLmZpbHRlciwgaW5kZXhQYXR0ZXJuKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTZWxlY3RlZE9wZXJhdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTZWxlY3RlZE9wZXJhdG9yKCkgewogICAgICByZXR1cm4gKDAsIF9maWx0ZXJfZWRpdG9yX3V0aWxzLmdldE9wZXJhdG9yRnJvbUZpbHRlcikodGhpcy5wcm9wcy5maWx0ZXIpOwogICAgfQogIH0sIHsKICAgIGtleTogImlzRmlsdGVyVmFsaWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRmlsdGVyVmFsaWQoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgaXNDdXN0b21FZGl0b3JPcGVuID0gX3RoaXMkc3RhdGU0LmlzQ3VzdG9tRWRpdG9yT3BlbiwKICAgICAgICAgIHF1ZXJ5RHNsID0gX3RoaXMkc3RhdGU0LnF1ZXJ5RHNsLAogICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX3RoaXMkc3RhdGU0LnNlbGVjdGVkSW5kZXhQYXR0ZXJuLAogICAgICAgICAgZmllbGQgPSBfdGhpcyRzdGF0ZTQuc2VsZWN0ZWRGaWVsZCwKICAgICAgICAgIG9wZXJhdG9yID0gX3RoaXMkc3RhdGU0LnNlbGVjdGVkT3BlcmF0b3IsCiAgICAgICAgICBwYXJhbXMgPSBfdGhpcyRzdGF0ZTQucGFyYW1zOwoKICAgICAgaWYgKGlzQ3VzdG9tRWRpdG9yT3BlbikgewogICAgICAgIHRyeSB7CiAgICAgICAgICByZXR1cm4gQm9vbGVhbihKU09OLnBhcnNlKHF1ZXJ5RHNsKSk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuICgwLCBfZmlsdGVyX2VkaXRvcl91dGlscy5pc0ZpbHRlclZhbGlkKShpbmRleFBhdHRlcm4sIGZpZWxkLCBvcGVyYXRvciwgcGFyYW1zKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBGaWx0ZXJFZGl0b3JVSTsKfShfcmVhY3QyLkNvbXBvbmVudCk7CgpmdW5jdGlvbiBJbmRleFBhdHRlcm5Db21ib0JveChwcm9wcykgewogIHJldHVybiAoMCwgX2dlbmVyaWNfY29tYm9fYm94LkdlbmVyaWNDb21ib0JveCkocHJvcHMpOwp9CgpmdW5jdGlvbiBGaWVsZENvbWJvQm94KHByb3BzKSB7CiAgcmV0dXJuICgwLCBfZ2VuZXJpY19jb21ib19ib3guR2VuZXJpY0NvbWJvQm94KShwcm9wcyk7Cn0KCmZ1bmN0aW9uIE9wZXJhdG9yQ29tYm9Cb3gocHJvcHMpIHsKICByZXR1cm4gKDAsIF9nZW5lcmljX2NvbWJvX2JveC5HZW5lcmljQ29tYm9Cb3gpKHByb3BzKTsKfQoKdmFyIEZpbHRlckVkaXRvciA9ICgwLCBfcmVhY3QuaW5qZWN0STE4bikoRmlsdGVyRWRpdG9yVUkpOwpleHBvcnRzLkZpbHRlckVkaXRvciA9IEZpbHRlckVkaXRvcjs="},null]}