{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/canvas/public/state/actions/elements.js","dependencies":[{"path":"x-pack/legacy/plugins/canvas/public/state/actions/elements.js","mtime":1589249552063},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldFNpYmxpbmdDb250ZXh0ID0gZ2V0U2libGluZ0NvbnRleHQ7CmV4cG9ydHMuYWRkRWxlbWVudCA9IGV4cG9ydHMuZGVsZXRlQXJndW1lbnRBdEluZGV4ID0gZXhwb3J0cy5hZGRBcmd1bWVudFZhbHVlQXRJbmRleCA9IGV4cG9ydHMuc2V0QXJndW1lbnRBdEluZGV4ID0gZXhwb3J0cy5zZXRBc3RBdEluZGV4ID0gZXhwb3J0cy5zZXRFeHByZXNzaW9uID0gZXhwb3J0cy5zZXRGaWx0ZXIgPSBleHBvcnRzLnJlbW92ZUVsZW1lbnRzID0gZXhwb3J0cy5pbnNlcnROb2RlcyA9IGV4cG9ydHMuZmV0Y2hBbGxSZW5kZXJhYmxlcyA9IGV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlID0gZXhwb3J0cy5mZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dCA9IGV4cG9ydHMuZmV0Y2hDb250ZXh0ID0gZXhwb3J0cy5mbHVzaENvbnRleHRBZnRlckluZGV4ID0gZXhwb3J0cy5mbHVzaENvbnRleHQgPSBleHBvcnRzLnNldE11bHRpcGxlUG9zaXRpb25zID0gZXhwb3J0cy5lbGVtZW50TGF5ZXIgPSB2b2lkIDA7Cgp2YXIgX3JlZHV4QWN0aW9ucyA9IHJlcXVpcmUoInJlZHV4LWFjdGlvbnMiKTsKCnZhciBfcmVkdXhUaHVua3MgPSByZXF1aXJlKCJyZWR1eC10aHVua3MiKTsKCnZhciBfb2JqZWN0UGF0aEltbXV0YWJsZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgib2JqZWN0LXBhdGgtaW1tdXRhYmxlIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCnZhciBfY29tbW9uID0gcmVxdWlyZSgiQGtibi9pbnRlcnByZXRlci9jb21tb24iKTsKCnZhciBfd29ya3BhZCA9IHJlcXVpcmUoIi4uL3NlbGVjdG9ycy93b3JrcGFkIik7Cgp2YXIgX3Jlc29sdmVkX2FyZ3MgPSByZXF1aXJlKCIuLi9zZWxlY3RvcnMvcmVzb2x2ZWRfYXJncyIpOwoKdmFyIF9kZWZhdWx0cyA9IHJlcXVpcmUoIi4uL2RlZmF1bHRzIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCIuLi8uLi8uLi9pMThuIik7Cgp2YXIgX25vdGlmeSA9IHJlcXVpcmUoIi4uLy4uL2xpYi9ub3RpZnkiKTsKCnZhciBfcnVuX2ludGVycHJldGVyID0gcmVxdWlyZSgiLi4vLi4vbGliL3J1bl9pbnRlcnByZXRlciIpOwoKdmFyIF9mdW5jdGlvbmFsID0gcmVxdWlyZSgiLi4vLi4vbGliL2Flcm9lbGFzdGljL2Z1bmN0aW9uYWwiKTsKCnZhciBfdHJhbnNpZW50ID0gcmVxdWlyZSgiLi90cmFuc2llbnQiKTsKCnZhciBhcmdzID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi9yZXNvbHZlZF9hcmdzIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgeyBpZiAoa2V5IGluIG9iaikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pOyB9IGVsc2UgeyBvYmpba2V5XSA9IHZhbHVlOyB9IHJldHVybiBvYmo7IH0KCnZhciBzdHJpbmdzID0gX2kxOG4uRXJyb3JTdHJpbmdzLmFjdGlvbnNFbGVtZW50czsKdmFyIHNldCA9IF9vYmplY3RQYXRoSW1tdXRhYmxlLmRlZmF1bHQuc2V0LAogICAgZGVsID0gX29iamVjdFBhdGhJbW11dGFibGUuZGVmYXVsdC5kZWw7CgpmdW5jdGlvbiBnZXRTaWJsaW5nQ29udGV4dChzdGF0ZSwgZWxlbWVudElkLCBjaGVja0luZGV4KSB7CiAgdmFyIHByZXZDb250ZXh0UGF0aCA9IFtlbGVtZW50SWQsICdleHByZXNzaW9uQ29udGV4dCcsIGNoZWNrSW5kZXhdOwogIHZhciBwcmV2Q29udGV4dFZhbHVlID0gKDAsIF9yZXNvbHZlZF9hcmdzLmdldFZhbHVlKShzdGF0ZSwgcHJldkNvbnRleHRQYXRoKTsgLy8gaWYgYSB2YWx1ZSBpcyBmb3VuZCwgcmV0dXJuIGl0LCBhbG9uZyB3aXRoIHRoZSBpbmRleCBpdCB3YXMgZm91bmQgYXQKCiAgaWYgKHByZXZDb250ZXh0VmFsdWUgIT0gbnVsbCkgewogICAgcmV0dXJuIHsKICAgICAgaW5kZXg6IGNoZWNrSW5kZXgsCiAgICAgIGNvbnRleHQ6IHByZXZDb250ZXh0VmFsdWUKICAgIH07CiAgfSAvLyBjaGVjayBwcmV2aW91cyBpbmRleCB3aGlsZSB3ZSdyZSBzdGlsbCBhYm92ZSAwCgoKICB2YXIgcHJldkNvbnRleHRJbmRleCA9IGNoZWNrSW5kZXggLSAxOwoKICBpZiAocHJldkNvbnRleHRJbmRleCA8IDApIHsKICAgIHJldHVybiB7fTsKICB9IC8vIHdhbGsgYmFjayB1cCB0byBmaW5kIHRoZSBjbG9zZXN0IGNhY2hlZCBjb250ZXh0IGF2YWlsYWJsZQoKCiAgcmV0dXJuIGdldFNpYmxpbmdDb250ZXh0KHN0YXRlLCBlbGVtZW50SWQsIHByZXZDb250ZXh0SW5kZXgpOwp9CgpmdW5jdGlvbiBnZXRCYXJlRWxlbWVudChlbCkgewogIHZhciBpbmNsdWRlSWQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogIHZhciBwcm9wcyA9IFsncG9zaXRpb24nLCAnZXhwcmVzc2lvbicsICdmaWx0ZXInXTsKCiAgaWYgKGluY2x1ZGVJZCkgewogICAgcmV0dXJuICgwLCBfbG9kYXNoLnBpY2spKGVsLCBwcm9wcy5jb25jYXQoJ2lkJykpOwogIH0KCiAgcmV0dXJuICgwLCBfbG9kYXNoLmNsb25lRGVlcCkoKDAsIF9sb2Rhc2gucGljaykoZWwsIHByb3BzKSk7Cn0KCnZhciBlbGVtZW50TGF5ZXIgPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdlbGVtZW50TGF5ZXInKTsKZXhwb3J0cy5lbGVtZW50TGF5ZXIgPSBlbGVtZW50TGF5ZXI7CnZhciBzZXRNdWx0aXBsZVBvc2l0aW9ucyA9ICgwLCBfcmVkdXhBY3Rpb25zLmNyZWF0ZUFjdGlvbikoJ3NldE11bHRpcGxlUG9zaXRpb24nLCBmdW5jdGlvbiAocmVwb3NpdGlvbmVkRWxlbWVudHMpIHsKICByZXR1cm4gewogICAgcmVwb3NpdGlvbmVkRWxlbWVudHM6IHJlcG9zaXRpb25lZEVsZW1lbnRzCiAgfTsKfSk7CmV4cG9ydHMuc2V0TXVsdGlwbGVQb3NpdGlvbnMgPSBzZXRNdWx0aXBsZVBvc2l0aW9uczsKdmFyIGZsdXNoQ29udGV4dCA9ICgwLCBfcmVkdXhBY3Rpb25zLmNyZWF0ZUFjdGlvbikoJ2ZsdXNoQ29udGV4dCcpOwpleHBvcnRzLmZsdXNoQ29udGV4dCA9IGZsdXNoQ29udGV4dDsKdmFyIGZsdXNoQ29udGV4dEFmdGVySW5kZXggPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdmbHVzaENvbnRleHRBZnRlckluZGV4Jyk7CmV4cG9ydHMuZmx1c2hDb250ZXh0QWZ0ZXJJbmRleCA9IGZsdXNoQ29udGV4dEFmdGVySW5kZXg7CnZhciBmZXRjaENvbnRleHQgPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnZmV0Y2hDb250ZXh0JywgZnVuY3Rpb24gKF9yZWYsIGluZGV4LCBlbGVtZW50KSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZi5kaXNwYXRjaCwKICAgICAgZ2V0U3RhdGUgPSBfcmVmLmdldFN0YXRlOwogIHZhciBmdWxsUmVmcmVzaCA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogZmFsc2U7CiAgdmFyIGNoYWluID0gKDAsIF9sb2Rhc2guZ2V0KShlbGVtZW50LCAnYXN0LmNoYWluJyk7CiAgdmFyIGludmFsaWRJbmRleCA9IGNoYWluID8gaW5kZXggPj0gY2hhaW4ubGVuZ3RoIDogdHJ1ZTsKCiAgaWYgKCFlbGVtZW50IHx8ICFjaGFpbiB8fCBpbnZhbGlkSW5kZXgpIHsKICAgIHRocm93IG5ldyBFcnJvcihzdHJpbmdzLmdldEludmFsaWRBcmdJbmRleEVycm9yTWVzc2FnZShpbmRleCkpOwogIH0gLy8gY2FjaGUgY29udGV4dCBhcyB0aGUgcHJldmlvdXMgaW5kZXgKCgogIHZhciBjb250ZXh0SW5kZXggPSBpbmRleCAtIDE7CiAgdmFyIGNvbnRleHRQYXRoID0gW2VsZW1lbnQuaWQsICdleHByZXNzaW9uQ29udGV4dCcsIGNvbnRleHRJbmRleF07IC8vIHNldCBjb250ZXh0IHN0YXRlIHRvIGxvYWRpbmcKCiAgZGlzcGF0Y2goYXJncy5zZXRMb2FkaW5nKHsKICAgIHBhdGg6IGNvbnRleHRQYXRoCiAgfSkpOyAvLyBmdW5jdGlvbiB0byB3YWxrIGJhY2sgdXAgdG8gZmluZCB0aGUgY2xvc2VzdCBjb250ZXh0IGF2YWlsYWJsZQoKICB2YXIgZ2V0Q29udGV4dCA9IGZ1bmN0aW9uIGdldENvbnRleHQoKSB7CiAgICByZXR1cm4gZ2V0U2libGluZ0NvbnRleHQoZ2V0U3RhdGUoKSwgZWxlbWVudC5pZCwgY29udGV4dEluZGV4IC0gMSk7CiAgfTsKCiAgdmFyIF9yZWYyID0gZnVsbFJlZnJlc2ggIT09IHRydWUgPyBnZXRDb250ZXh0KCkgOiB7fSwKICAgICAgcHJldkNvbnRleHRJbmRleCA9IF9yZWYyLmluZGV4LAogICAgICBwcmV2Q29udGV4dFZhbHVlID0gX3JlZjIuY29udGV4dDsgLy8gbW9kaWZ5IHRoZSBhc3QgY2hhaW4gcGFzc2VkIHRvIHRoZSBpbnRlcnByZXRlcgoKCiAgdmFyIGFzdENoYWluID0gZWxlbWVudC5hc3QuY2hhaW4uZmlsdGVyKGZ1bmN0aW9uIChleHAsIGkpIHsKICAgIGlmIChwcmV2Q29udGV4dFZhbHVlICE9IG51bGwpIHsKICAgICAgcmV0dXJuIGkgPiBwcmV2Q29udGV4dEluZGV4ICYmIGkgPCBpbmRleDsKICAgIH0KCiAgICByZXR1cm4gaSA8IGluZGV4OwogIH0pOyAvLyBnZXQgY29udGV4dCBkYXRhIGZyb20gYSBwYXJ0aWFsIEFTVAoKICByZXR1cm4gKDAsIF9ydW5faW50ZXJwcmV0ZXIuaW50ZXJwcmV0QXN0KShfb2JqZWN0U3ByZWFkKHt9LCBlbGVtZW50LmFzdCwgewogICAgY2hhaW46IGFzdENoYWluCiAgfSksIHByZXZDb250ZXh0VmFsdWUpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7CiAgICBkaXNwYXRjaChhcmdzLnNldFZhbHVlKHsKICAgICAgcGF0aDogY29udGV4dFBhdGgsCiAgICAgIHZhbHVlOiB2YWx1ZQogICAgfSkpOwogIH0pOwp9KTsKZXhwb3J0cy5mZXRjaENvbnRleHQgPSBmZXRjaENvbnRleHQ7Cgp2YXIgZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHRGbiA9IGZ1bmN0aW9uIGZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0Rm4oX3JlZjMsIGVsZW1lbnQsIGFzdCwgY29udGV4dCkgewogIHZhciBkaXNwYXRjaCA9IF9yZWYzLmRpc3BhdGNoOwogIHZhciBhcmd1bWVudFBhdGggPSBbZWxlbWVudC5pZCwgJ2V4cHJlc3Npb25SZW5kZXJhYmxlJ107CiAgZGlzcGF0Y2goYXJncy5zZXRMb2FkaW5nKHsKICAgIHBhdGg6IGFyZ3VtZW50UGF0aAogIH0pKTsKCiAgdmFyIGdldEFjdGlvbiA9IGZ1bmN0aW9uIGdldEFjdGlvbihyZW5kZXJhYmxlKSB7CiAgICByZXR1cm4gYXJncy5zZXRWYWx1ZSh7CiAgICAgIHBhdGg6IGFyZ3VtZW50UGF0aCwKICAgICAgdmFsdWU6IHJlbmRlcmFibGUKICAgIH0pOwogIH07CgogIHJldHVybiAoMCwgX3J1bl9pbnRlcnByZXRlci5ydW5JbnRlcnByZXRlcikoYXN0LCBjb250ZXh0LCB7CiAgICBjYXN0VG9SZW5kZXI6IHRydWUKICB9KS50aGVuKGZ1bmN0aW9uIChyZW5kZXJhYmxlKSB7CiAgICBkaXNwYXRjaChnZXRBY3Rpb24ocmVuZGVyYWJsZSkpOwogIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7CgogICAgZGlzcGF0Y2goZ2V0QWN0aW9uKGVycikpOwogIH0pOwp9OwoKdmFyIGZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2ZldGNoUmVuZGVyYWJsZVdpdGhDb250ZXh0JywgZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHRGbik7CmV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlV2l0aENvbnRleHQgPSBmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dDsKdmFyIGZldGNoUmVuZGVyYWJsZSA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdmZXRjaFJlbmRlcmFibGUnLCBmdW5jdGlvbiAoX3JlZjQsIGVsZW1lbnQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmNC5kaXNwYXRjaDsKICB2YXIgYXN0ID0gZWxlbWVudC5hc3QgfHwgKDAsIF9jb21tb24uc2FmZUVsZW1lbnRGcm9tRXhwcmVzc2lvbikoZWxlbWVudC5leHByZXNzaW9uKTsKICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dChlbGVtZW50LCBhc3QsIG51bGwpKTsKfSk7CmV4cG9ydHMuZmV0Y2hSZW5kZXJhYmxlID0gZmV0Y2hSZW5kZXJhYmxlOwp2YXIgZmV0Y2hBbGxSZW5kZXJhYmxlcyA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdmZXRjaEFsbFJlbmRlcmFibGVzJywgZnVuY3Rpb24gKF9yZWY1KSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjUuZGlzcGF0Y2gsCiAgICAgIGdldFN0YXRlID0gX3JlZjUuZ2V0U3RhdGU7CgogIHZhciBfcmVmNiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge30sCiAgICAgIF9yZWY2JG9ubHlBY3RpdmVQYWdlID0gX3JlZjYub25seUFjdGl2ZVBhZ2UsCiAgICAgIG9ubHlBY3RpdmVQYWdlID0gX3JlZjYkb25seUFjdGl2ZVBhZ2UgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjYkb25seUFjdGl2ZVBhZ2U7CgogIHZhciB3b3JrcGFkUGFnZXMgPSAoMCwgX3dvcmtwYWQuZ2V0UGFnZXMpKGdldFN0YXRlKCkpOwogIHZhciBjdXJyZW50UGFnZUluZGV4ID0gKDAsIF93b3JrcGFkLmdldFNlbGVjdGVkUGFnZUluZGV4KShnZXRTdGF0ZSgpKTsKICB2YXIgY3VycmVudFBhZ2UgPSB3b3JrcGFkUGFnZXNbY3VycmVudFBhZ2VJbmRleF07CiAgdmFyIG90aGVyUGFnZXMgPSAoMCwgX2xvZGFzaC53aXRob3V0KSh3b3JrcGFkUGFnZXMsIGN1cnJlbnRQYWdlKTsKICBkaXNwYXRjaChhcmdzLmluRmxpZ2h0QWN0aXZlKCkpOwoKICBmdW5jdGlvbiBmZXRjaEVsZW1lbnRzT25QYWdlcyhwYWdlcykgewogICAgdmFyIGVsZW1lbnRzID0gW107CiAgICBwYWdlcy5mb3JFYWNoKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgIHBhZ2UuZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgIGVsZW1lbnRzLnB1c2goZWxlbWVudCk7CiAgICAgIH0pOwogICAgfSk7CiAgICB2YXIgcmVuZGVyYWJsZVByb21pc2VzID0gZWxlbWVudHMubWFwKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgIHZhciBhc3QgPSBlbGVtZW50LmFzdCB8fCAoMCwgX2NvbW1vbi5zYWZlRWxlbWVudEZyb21FeHByZXNzaW9uKShlbGVtZW50LmV4cHJlc3Npb24pOwogICAgICB2YXIgYXJndW1lbnRQYXRoID0gW2VsZW1lbnQuaWQsICdleHByZXNzaW9uUmVuZGVyYWJsZSddOwogICAgICByZXR1cm4gKDAsIF9ydW5faW50ZXJwcmV0ZXIucnVuSW50ZXJwcmV0ZXIpKGFzdCwgbnVsbCwgewogICAgICAgIGNhc3RUb1JlbmRlcjogdHJ1ZQogICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZW5kZXJhYmxlKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBhdGg6IGFyZ3VtZW50UGF0aCwKICAgICAgICAgIHZhbHVlOiByZW5kZXJhYmxlCiAgICAgICAgfTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwYXRoOiBhcmd1bWVudFBhdGgsCiAgICAgICAgICB2YWx1ZTogZXJyCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBQcm9taXNlLmFsbChyZW5kZXJhYmxlUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKHJlbmRlcmFibGVzKSB7CiAgICAgIGRpc3BhdGNoKGFyZ3Muc2V0VmFsdWVzKHJlbmRlcmFibGVzKSk7CiAgICB9KTsKICB9CgogIGlmIChvbmx5QWN0aXZlUGFnZSkgewogICAgZmV0Y2hFbGVtZW50c09uUGFnZXMoW2N1cnJlbnRQYWdlXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBkaXNwYXRjaChhcmdzLmluRmxpZ2h0Q29tcGxldGUoKSk7CiAgICB9KTsKICB9IGVsc2UgewogICAgZmV0Y2hFbGVtZW50c09uUGFnZXMoW2N1cnJlbnRQYWdlXSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBvdGhlclBhZ2VzLnJlZHVjZShmdW5jdGlvbiAoY2hhaW4sIHBhZ2UpIHsKICAgICAgICByZXR1cm4gY2hhaW4udGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gZmV0Y2hFbGVtZW50c09uUGFnZXMoW3BhZ2VdKTsKICAgICAgICB9KTsKICAgICAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpOwogICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBkaXNwYXRjaChhcmdzLmluRmxpZ2h0Q29tcGxldGUoKSk7CiAgICB9KTsKICB9Cn0pOwpleHBvcnRzLmZldGNoQWxsUmVuZGVyYWJsZXMgPSBmZXRjaEFsbFJlbmRlcmFibGVzOwp2YXIgaW5zZXJ0Tm9kZXMgPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnaW5zZXJ0Tm9kZXMnLCBmdW5jdGlvbiAoX3JlZjcsIGVsZW1lbnRzLCBwYWdlSWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmNy5kaXNwYXRjaCwKICAgICAgdHlwZSA9IF9yZWY3LnR5cGU7CgogIHZhciBfaW5zZXJ0Tm9kZXMgPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKHR5cGUpOwoKICB2YXIgbmV3RWxlbWVudHMgPSBlbGVtZW50cy5tYXAoX2xvZGFzaC5jbG9uZURlZXApOyAvLyBtb3ZlIHRoZSByb290IGVsZW1lbnQgc28gdXNlcnMgY2FuIHNlZSB0aGF0IGl0IHdhcyBhZGRlZAoKICBuZXdFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChuZXdFbGVtZW50KSB7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLnRvcCA9IG5ld0VsZW1lbnQucG9zaXRpb24udG9wICsgMTA7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLmxlZnQgPSBuZXdFbGVtZW50LnBvc2l0aW9uLmxlZnQgKyAxMDsKICB9KTsKICBkaXNwYXRjaChfaW5zZXJ0Tm9kZXMoewogICAgcGFnZUlkOiBwYWdlSWQsCiAgICBlbGVtZW50czogbmV3RWxlbWVudHMKICB9KSk7IC8vIHJlZnJlc2ggYWxsIGVsZW1lbnRzIGp1c3Qgb25jZSBwZXIgYGluc2VydE5vZGVzIGNhbGxgIGlmIHRoZXJlJ3MgYSBmaWx0ZXIgb24gYW55LCBvdGhlcndpc2UganVzdCByZW5kZXIgdGhlIG5ldyBlbGVtZW50CgogIGlmIChlbGVtZW50cy5zb21lKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICByZXR1cm4gZWxlbWVudC5maWx0ZXI7CiAgfSkpIHsKICAgIGRpc3BhdGNoKGZldGNoQWxsUmVuZGVyYWJsZXMoKSk7CiAgfSBlbHNlIHsKICAgIG5ld0VsZW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKG5ld0VsZW1lbnQpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKGZldGNoUmVuZGVyYWJsZShuZXdFbGVtZW50KSk7CiAgICB9KTsKICB9Cn0pOwpleHBvcnRzLmluc2VydE5vZGVzID0gaW5zZXJ0Tm9kZXM7CnZhciByZW1vdmVFbGVtZW50cyA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdyZW1vdmVFbGVtZW50cycsIGZ1bmN0aW9uIChfcmVmOCwgcm9vdEVsZW1lbnRJZHMsIHBhZ2VJZCkgewogIHZhciBkaXNwYXRjaCA9IF9yZWY4LmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWY4LmdldFN0YXRlOwogIHZhciBzdGF0ZSA9IGdldFN0YXRlKCk7IC8vIHRvZG8gY29uc2lkZXIgZG9pbmcgdGhlIGdyb3VwIG1lbWJlcnNoaXAgY29sbGF0aW9uIGluIGFlcm9lbGFzdGljLCBvciB0aGUgUmVkdXggcmVkdWNlciwgd2hlbiBhZGRpbmcgdGVtcGxhdGVzCgogIHZhciBhbGxFbGVtZW50cyA9ICgwLCBfd29ya3BhZC5nZXROb2Rlcykoc3RhdGUsIHBhZ2VJZCk7CiAgdmFyIGFsbFJvb3RzID0gcm9vdEVsZW1lbnRJZHMubWFwKGZ1bmN0aW9uIChpZCkgewogICAgcmV0dXJuIGFsbEVsZW1lbnRzLmZpbmQoZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIGlkID09PSBlLmlkOwogICAgfSk7CiAgfSkuZmlsdGVyKGZ1bmN0aW9uIChkKSB7CiAgICByZXR1cm4gZDsKICB9KTsKICB2YXIgZWxlbWVudElkcyA9ICgwLCBfZnVuY3Rpb25hbC5zdWJNdWx0aXRyZWUpKGZ1bmN0aW9uIChlKSB7CiAgICByZXR1cm4gZS5pZDsKICB9LCBmdW5jdGlvbiAoZSkgewogICAgcmV0dXJuIGUucG9zaXRpb24ucGFyZW50OwogIH0sIGFsbEVsZW1lbnRzLCBhbGxSb290cykubWFwKGZ1bmN0aW9uIChlKSB7CiAgICByZXR1cm4gZS5pZDsKICB9KTsKICB2YXIgc2hvdWxkUmVmcmVzaCA9IGVsZW1lbnRJZHMuc29tZShmdW5jdGlvbiAoZWxlbWVudElkKSB7CiAgICB2YXIgZWxlbWVudCA9ICgwLCBfd29ya3BhZC5nZXROb2RlQnlJZCkoc3RhdGUsIGVsZW1lbnRJZCwgcGFnZUlkKTsKICAgIHZhciBmaWx0ZXJJc0FwcGxpZWQgPSBlbGVtZW50LmZpbHRlciAmJiBlbGVtZW50LmZpbHRlci5sZW5ndGggPiAwOwogICAgcmV0dXJuIGZpbHRlcklzQXBwbGllZDsKICB9KTsKCiAgdmFyIF9yZW1vdmVFbGVtZW50cyA9ICgwLCBfcmVkdXhBY3Rpb25zLmNyZWF0ZUFjdGlvbikoJ3JlbW92ZUVsZW1lbnRzJywgZnVuY3Rpb24gKGVsZW1lbnRJZHMsIHBhZ2VJZCkgewogICAgcmV0dXJuIHsKICAgICAgZWxlbWVudElkczogZWxlbWVudElkcywKICAgICAgcGFnZUlkOiBwYWdlSWQKICAgIH07CiAgfSk7CgogIGRpc3BhdGNoKF9yZW1vdmVFbGVtZW50cyhlbGVtZW50SWRzLCBwYWdlSWQpKTsKCiAgaWYgKHNob3VsZFJlZnJlc2gpIHsKICAgIGRpc3BhdGNoKGZldGNoQWxsUmVuZGVyYWJsZXMoKSk7CiAgfQp9KTsKZXhwb3J0cy5yZW1vdmVFbGVtZW50cyA9IHJlbW92ZUVsZW1lbnRzOwp2YXIgc2V0RmlsdGVyID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ3NldEZpbHRlcicsIGZ1bmN0aW9uIChfcmVmOSwgZmlsdGVyLCBlbGVtZW50SWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmOS5kaXNwYXRjaDsKICB2YXIgZG9SZW5kZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IHRydWU7CgogIHZhciBfc2V0RmlsdGVyID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnc2V0RmlsdGVyJyk7CgogIGRpc3BhdGNoKF9zZXRGaWx0ZXIoewogICAgZmlsdGVyOiBmaWx0ZXIsCiAgICBlbGVtZW50SWQ6IGVsZW1lbnRJZAogIH0pKTsKCiAgaWYgKGRvUmVuZGVyID09PSB0cnVlKSB7CiAgICBkaXNwYXRjaChmZXRjaEFsbFJlbmRlcmFibGVzKCkpOwogIH0KfSk7CmV4cG9ydHMuc2V0RmlsdGVyID0gc2V0RmlsdGVyOwp2YXIgc2V0RXhwcmVzc2lvbiA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdzZXRFeHByZXNzaW9uJywgc2V0RXhwcmVzc2lvbkZuKTsKZXhwb3J0cy5zZXRFeHByZXNzaW9uID0gc2V0RXhwcmVzc2lvbjsKCmZ1bmN0aW9uIHNldEV4cHJlc3Npb25GbihfcmVmMTAsIGV4cHJlc3Npb24sIGVsZW1lbnRJZCwgcGFnZUlkKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjEwLmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWYxMC5nZXRTdGF0ZTsKICB2YXIgZG9SZW5kZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6IHRydWU7CgogIC8vIGRpc3BhdGNoIGFjdGlvbiB0byB1cGRhdGUgdGhlIGVsZW1lbnQgaW4gc3RhdGUKICB2YXIgX3NldEV4cHJlc3Npb24gPSAoMCwgX3JlZHV4QWN0aW9ucy5jcmVhdGVBY3Rpb24pKCdzZXRFeHByZXNzaW9uJyk7CgogIGRpc3BhdGNoKF9zZXRFeHByZXNzaW9uKHsKICAgIGV4cHJlc3Npb246IGV4cHJlc3Npb24sCiAgICBlbGVtZW50SWQ6IGVsZW1lbnRJZCwKICAgIHBhZ2VJZDogcGFnZUlkCiAgfSkpOyAvLyByZWFkIHVwZGF0ZWQgZWxlbWVudCBmcm9tIHN0YXRlIGFuZCBmZXRjaCByZW5kZXJhYmxlCgogIHZhciB1cGRhdGVkRWxlbWVudCA9ICgwLCBfd29ya3BhZC5nZXROb2RlQnlJZCkoZ2V0U3RhdGUoKSwgZWxlbWVudElkLCBwYWdlSWQpOyAvLyByZXNldCBlbGVtZW50LmZpbHRlciBpZiBlbGVtZW50IGlzIG5vIGxvbmdlciBhIGZpbHRlcgogIC8vIFRPRE86IGZpbmQgYSB3YXkgdG8gZXh0cmFjdCBhIGxpc3Qgb2YgZmlsdGVyIHJlbmRlcmVycyBmcm9tIHRoZSBmdW5jdGlvbnMgcmVnaXN0cnkKCiAgaWYgKHVwZGF0ZWRFbGVtZW50LmZpbHRlciAmJiAhWydkcm9wZG93bkNvbnRyb2wnLCAndGltZWZpbHRlckNvbnRyb2wnLCAnZXhhY3RseSddLnNvbWUoZnVuY3Rpb24gKGZpbHRlcikgewogICAgcmV0dXJuIHVwZGF0ZWRFbGVtZW50LmV4cHJlc3Npb24uaW5jbHVkZXMoZmlsdGVyKTsKICB9KSkgewogICAgdmFyIGZpbHRlciA9ICcnOwogICAgZGlzcGF0Y2goc2V0RmlsdGVyKGZpbHRlciwgZWxlbWVudElkLCBwYWdlSWQsIGRvUmVuZGVyKSk7IC8vIHNldEZpbHRlciB3aWxsIHRyaWdnZXIgYSByZS1yZW5kZXIgc28gd2UgY2FuIHNraXAgdGhlIGZldGNoIGhlcmUKICB9IGVsc2UgaWYgKGRvUmVuZGVyID09PSB0cnVlKSB7CiAgICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGUodXBkYXRlZEVsZW1lbnQpKTsKICB9Cn0KCnZhciBzZXRBc3QgPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnc2V0QXN0JywgZnVuY3Rpb24gKF9yZWYxMSwgYXN0LCBlbGVtZW50LCBwYWdlSWQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTEuZGlzcGF0Y2g7CiAgdmFyIGRvUmVuZGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgJiYgYXJndW1lbnRzWzRdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNF0gOiB0cnVlOwoKICB0cnkgewogICAgdmFyIGV4cHJlc3Npb24gPSAoMCwgX2NvbW1vbi50b0V4cHJlc3Npb24pKGFzdCk7CiAgICBkaXNwYXRjaChzZXRFeHByZXNzaW9uKGV4cHJlc3Npb24sIGVsZW1lbnQuaWQsIHBhZ2VJZCwgZG9SZW5kZXIpKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIF9ub3RpZnkubm90aWZ5LmVycm9yKGVycik7IC8vIFRPRE86IHJlbW92ZSB0aGlzLCBtYXkgaGF2ZSBiZWVuIGFkZGVkIGp1c3QgdG8gY2F1c2UgYSByZS1yZW5kZXIsIGJ1dCB3aHk/CgoKICAgIGRpc3BhdGNoKHNldEV4cHJlc3Npb24oZWxlbWVudC5leHByZXNzaW9uLCBlbGVtZW50LmlkLCBwYWdlSWQsIGRvUmVuZGVyKSk7CiAgfQp9KTsgLy8gaW5kZXggaGVyZSBpcyB0aGUgdG9wLWxldmVsIGFyZ3VtZW50IGluIHRoZSBleHByZXNzaW9uLiBmb3IgZXhhbXBsZSBpbiB0aGUgZXhwcmVzc2lvbgovLyBkZW1vZGF0YSgpLnBvaW50c2VyaWVzKCkucGxvdCgpLCBkZW1vZGF0YSBpcyAwLCBwb2ludHNlcmllcyBpcyAxLCBhbmQgcGxvdCBpcyAyCgp2YXIgc2V0QXN0QXRJbmRleCA9ICgwLCBfcmVkdXhUaHVua3MuY3JlYXRlVGh1bmspKCdzZXRBc3RBdEluZGV4JywgZnVuY3Rpb24gKF9yZWYxMiwgaW5kZXgsIGFzdCwgZWxlbWVudCwgcGFnZUlkKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjEyLmRpc3BhdGNoLAogICAgICBnZXRTdGF0ZSA9IF9yZWYxMi5nZXRTdGF0ZTsKICAvLyBpbnZhbGlkYXRlIGNhY2hlZCBjb250ZXh0IGZvciBlbGVtZW50cyBhZnRlciB0aGlzIGluZGV4CiAgZGlzcGF0Y2goZmx1c2hDb250ZXh0QWZ0ZXJJbmRleCh7CiAgICBlbGVtZW50SWQ6IGVsZW1lbnQuaWQsCiAgICBpbmRleDogaW5kZXgKICB9KSk7CiAgdmFyIG5ld0VsZW1lbnQgPSBzZXQoZWxlbWVudCwgImFzdC5jaGFpbi4iLmNvbmNhdChpbmRleCksIGFzdCk7CiAgdmFyIG5ld0FzdCA9ICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgJ2FzdCcpOyAvLyBmZXRjaCByZW5kZXJhYmxlIHVzaW5nIGV4aXN0aW5nIGNvbnRleHQsIGlmIGF2YWlsYWJsZSAodmFsdWUgaXMgbnVsbCBpZiBub3QgY2FjaGVkKQoKICB2YXIgX2dldFNpYmxpbmdDb250ZXh0ID0gZ2V0U2libGluZ0NvbnRleHQoZ2V0U3RhdGUoKSwgZWxlbWVudC5pZCwgaW5kZXggLSAxKSwKICAgICAgY29udGV4dEluZGV4ID0gX2dldFNpYmxpbmdDb250ZXh0LmluZGV4LAogICAgICBjb250ZXh0VmFsdWUgPSBfZ2V0U2libGluZ0NvbnRleHQuY29udGV4dDsgLy8gaWYgd2UgaGF2ZSBhIGNhY2hlZCBjb250ZXh0LCB1cGRhdGUgdGhlIGV4cHJlc3Npb24sIGJ1dCB1c2UgY2FjaGUgd2hlbiB1cGRhdGluZyB0aGUgcmVuZGVyYWJsZQoKCiAgaWYgKGNvbnRleHRWYWx1ZSkgewogICAgLy8gc2V0IHRoZSBleHByZXNzaW9uLCBidXQgc2tpcCB0aGUgZmV0Y2hSZW5kZXJhYmxlIHN0ZXAKICAgIGRpc3BhdGNoKHNldEFzdChuZXdBc3QsIGVsZW1lbnQsIHBhZ2VJZCwgZmFsc2UpKTsgLy8gdXNlIGNvbnRleHQgd2hlbiB1cGRhdGluZyB0aGUgZXhwcmVzc2lvbiwgaXQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGludGVwcmV0ZXIKCiAgICB2YXIgcGFydGlhbEFzdCA9IF9vYmplY3RTcHJlYWQoe30sIG5ld0FzdCwgewogICAgICBjaGFpbjogbmV3QXN0LmNoYWluLmZpbHRlcihmdW5jdGlvbiAoZXhwLCBpKSB7CiAgICAgICAgaWYgKGNvbnRleHRWYWx1ZSkgewogICAgICAgICAgcmV0dXJuIGkgPiBjb250ZXh0SW5kZXg7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaSA+PSBpbmRleDsKICAgICAgfSkKICAgIH0pOwoKICAgIHJldHVybiBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGVXaXRoQ29udGV4dChuZXdFbGVtZW50LCBwYXJ0aWFsQXN0LCBjb250ZXh0VmFsdWUpKTsKICB9IC8vIGlmIG5vIGNhY2hlZCBjb250ZXh0LCB1cGRhdGUgdGhlIGFzdCBsaWtlIG5vcm1hbAoKCiAgZGlzcGF0Y2goc2V0QXN0KG5ld0FzdCwgZWxlbWVudCwgcGFnZUlkKSk7Cn0pOyAvLyBpbmRleCBoZXJlIGlzIHRoZSB0b3AtbGV2ZWwgYXJndW1lbnQgaW4gdGhlIGV4cHJlc3Npb24uIGZvciBleGFtcGxlIGluIHRoZSBleHByZXNzaW9uCi8vIGRlbW9kYXRhKCkucG9pbnRzZXJpZXMoKS5wbG90KCksIGRlbW9kYXRhIGlzIDAsIHBvaW50c2VyaWVzIGlzIDEsIGFuZCBwbG90IGlzIDIKLy8gYXJnSW5kZXggaXMgdGhlIGluZGV4IGluIG11bHRpLXZhbHVlIGFyZ3VtZW50cywgYW5kIGlzIG9wdGlvbmFsLiBleGNsdWRpbmcgaXQgd2lsbCBjYXVzZQovLyB0aGUgZW50aXJlIGFyZ3VtZW50IGZyb20gYmUgc2V0IHRvIHRoZSBwYXNzZWQgdmFsdWUKCmV4cG9ydHMuc2V0QXN0QXRJbmRleCA9IHNldEFzdEF0SW5kZXg7CnZhciBzZXRBcmd1bWVudEF0SW5kZXggPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnc2V0QXJndW1lbnRBdEluZGV4JywgZnVuY3Rpb24gKF9yZWYxMywgYXJncykgewogIHZhciBkaXNwYXRjaCA9IF9yZWYxMy5kaXNwYXRjaDsKICB2YXIgaW5kZXggPSBhcmdzLmluZGV4LAogICAgICBhcmdOYW1lID0gYXJncy5hcmdOYW1lLAogICAgICB2YWx1ZSA9IGFyZ3MudmFsdWUsCiAgICAgIHZhbHVlSW5kZXggPSBhcmdzLnZhbHVlSW5kZXgsCiAgICAgIGVsZW1lbnQgPSBhcmdzLmVsZW1lbnQsCiAgICAgIHBhZ2VJZCA9IGFyZ3MucGFnZUlkOwogIHZhciBzZWxlY3RvciA9ICJhc3QuY2hhaW4uIi5jb25jYXQoaW5kZXgsICIuYXJndW1lbnRzLiIpLmNvbmNhdChhcmdOYW1lKTsKCiAgaWYgKHZhbHVlSW5kZXggIT0gbnVsbCkgewogICAgc2VsZWN0b3IgKz0gJy4nICsgdmFsdWVJbmRleDsKICB9CgogIHZhciBuZXdFbGVtZW50ID0gc2V0KGVsZW1lbnQsIHNlbGVjdG9yLCB2YWx1ZSk7CiAgdmFyIG5ld0FzdCA9ICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgWydhc3QnLCAnY2hhaW4nLCBpbmRleF0pOwogIGRpc3BhdGNoKHNldEFzdEF0SW5kZXgoaW5kZXgsIG5ld0FzdCwgZWxlbWVudCwgcGFnZUlkKSk7Cn0pOyAvLyBpbmRleCBoZXJlIGlzIHRoZSB0b3AtbGV2ZWwgYXJndW1lbnQgaW4gdGhlIGV4cHJlc3Npb24uIGZvciBleGFtcGxlIGluIHRoZSBleHByZXNzaW9uCi8vIGRlbW9kYXRhKCkucG9pbnRzZXJpZXMoKS5wbG90KCksIGRlbW9kYXRhIGlzIDAsIHBvaW50c2VyaWVzIGlzIDEsIGFuZCBwbG90IGlzIDIKCmV4cG9ydHMuc2V0QXJndW1lbnRBdEluZGV4ID0gc2V0QXJndW1lbnRBdEluZGV4Owp2YXIgYWRkQXJndW1lbnRWYWx1ZUF0SW5kZXggPSAoMCwgX3JlZHV4VGh1bmtzLmNyZWF0ZVRodW5rKSgnYWRkQXJndW1lbnRWYWx1ZUF0SW5kZXgnLCBmdW5jdGlvbiAoX3JlZjE0LCBhcmdzKSB7CiAgdmFyIGRpc3BhdGNoID0gX3JlZjE0LmRpc3BhdGNoOwogIHZhciBpbmRleCA9IGFyZ3MuaW5kZXgsCiAgICAgIGFyZ05hbWUgPSBhcmdzLmFyZ05hbWUsCiAgICAgIHZhbHVlID0gYXJncy52YWx1ZSwKICAgICAgZWxlbWVudCA9IGFyZ3MuZWxlbWVudDsKICB2YXIgdmFsdWVzID0gKDAsIF9sb2Rhc2guZ2V0KShlbGVtZW50LCBbJ2FzdCcsICdjaGFpbicsIGluZGV4LCAnYXJndW1lbnRzJywgYXJnTmFtZV0sIFtdKTsKICB2YXIgbmV3VmFsdWUgPSB2YWx1ZXMuY29uY2F0KHZhbHVlKTsKICBkaXNwYXRjaChzZXRBcmd1bWVudEF0SW5kZXgoX29iamVjdFNwcmVhZCh7fSwgYXJncywgewogICAgdmFsdWU6IG5ld1ZhbHVlCiAgfSkpKTsKfSk7IC8vIGluZGV4IGhlcmUgaXMgdGhlIHRvcC1sZXZlbCBhcmd1bWVudCBpbiB0aGUgZXhwcmVzc2lvbi4gZm9yIGV4YW1wbGUgaW4gdGhlIGV4cHJlc3Npb24KLy8gZGVtb2RhdGEoKS5wb2ludHNlcmllcygpLnBsb3QoKSwgZGVtb2RhdGEgaXMgMCwgcG9pbnRzZXJpZXMgaXMgMSwgYW5kIHBsb3QgaXMgMgovLyBhcmdJbmRleCBpcyB0aGUgaW5kZXggaW4gbXVsdGktdmFsdWUgYXJndW1lbnRzLCBhbmQgaXMgb3B0aW9uYWwuIGV4Y2x1ZGluZyBpdCB3aWxsIHJlbW92ZQovLyB0aGUgZW50aXJlIGFyZ3VtZW50IGZyb20gdGhlIGV4cHJlc2lvbgoKZXhwb3J0cy5hZGRBcmd1bWVudFZhbHVlQXRJbmRleCA9IGFkZEFyZ3VtZW50VmFsdWVBdEluZGV4Owp2YXIgZGVsZXRlQXJndW1lbnRBdEluZGV4ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2RlbGV0ZUFyZ3VtZW50QXRJbmRleCcsIGZ1bmN0aW9uIChfcmVmMTUsIGFyZ3MpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTUuZGlzcGF0Y2g7CiAgdmFyIGluZGV4ID0gYXJncy5pbmRleCwKICAgICAgZWxlbWVudCA9IGFyZ3MuZWxlbWVudCwKICAgICAgcGFnZUlkID0gYXJncy5wYWdlSWQsCiAgICAgIGFyZ05hbWUgPSBhcmdzLmFyZ05hbWUsCiAgICAgIGFyZ0luZGV4ID0gYXJncy5hcmdJbmRleDsKICB2YXIgY3VyVmFsID0gKDAsIF9sb2Rhc2guZ2V0KShlbGVtZW50LCBbJ2FzdCcsICdjaGFpbicsIGluZGV4LCAnYXJndW1lbnRzJywgYXJnTmFtZV0pOwogIHZhciBuZXdFbGVtZW50ID0gYXJnSW5kZXggIT0gbnVsbCAmJiBjdXJWYWwubGVuZ3RoID4gMSA/IC8vIGlmIG1vcmUgdGhhbiBvbmUgdmFsLCByZW1vdmUgdGhlIHNwZWNpZmllZCB2YWwKICBkZWwoZWxlbWVudCwgImFzdC5jaGFpbi4iLmNvbmNhdChpbmRleCwgIi5hcmd1bWVudHMuIikuY29uY2F0KGFyZ05hbWUsICIuIikuY29uY2F0KGFyZ0luZGV4KSkgOiAvLyBvdGhlcndpc2UsIHJlbW92ZSB0aGUgZW50aXJlIGtleQogIGRlbChlbGVtZW50LCAiYXN0LmNoYWluLiIuY29uY2F0KGluZGV4LCAiLmFyZ3VtZW50cy4iKS5jb25jYXQoYXJnTmFtZSkpOwogIGRpc3BhdGNoKHNldEFzdEF0SW5kZXgoaW5kZXgsICgwLCBfbG9kYXNoLmdldCkobmV3RWxlbWVudCwgWydhc3QnLCAnY2hhaW4nLCBpbmRleF0pLCBlbGVtZW50LCBwYWdlSWQpKTsKfSk7Ci8qCiAgcGF5bG9hZDogZWxlbWVudCBkZWZhdWx0cy4gRWcge2V4cHJlc3Npb246ICdmb28nfQoqLwoKZXhwb3J0cy5kZWxldGVBcmd1bWVudEF0SW5kZXggPSBkZWxldGVBcmd1bWVudEF0SW5kZXg7CnZhciBhZGRFbGVtZW50ID0gKDAsIF9yZWR1eFRodW5rcy5jcmVhdGVUaHVuaykoJ2FkZEVsZW1lbnQnLCBmdW5jdGlvbiAoX3JlZjE2LCBwYWdlSWQsIGVsZW1lbnQpIHsKICB2YXIgZGlzcGF0Y2ggPSBfcmVmMTYuZGlzcGF0Y2g7CgogIHZhciBuZXdFbGVtZW50ID0gX29iamVjdFNwcmVhZCh7fSwgKDAsIF9kZWZhdWx0cy5nZXREZWZhdWx0RWxlbWVudCkoKSwge30sIGdldEJhcmVFbGVtZW50KGVsZW1lbnQsIHRydWUpKTsKCiAgaWYgKGVsZW1lbnQud2lkdGgpIHsKICAgIG5ld0VsZW1lbnQucG9zaXRpb24ud2lkdGggPSBlbGVtZW50LndpZHRoOwogIH0KCiAgaWYgKGVsZW1lbnQuaGVpZ2h0KSB7CiAgICBuZXdFbGVtZW50LnBvc2l0aW9uLmhlaWdodCA9IGVsZW1lbnQuaGVpZ2h0OwogIH0KCiAgdmFyIF9hZGRFbGVtZW50ID0gKDAsIF9yZWR1eEFjdGlvbnMuY3JlYXRlQWN0aW9uKSgnYWRkRWxlbWVudCcpOwoKICBkaXNwYXRjaChfYWRkRWxlbWVudCh7CiAgICBwYWdlSWQ6IHBhZ2VJZCwKICAgIGVsZW1lbnQ6IG5ld0VsZW1lbnQKICB9KSk7IC8vIHJlZnJlc2ggYWxsIGVsZW1lbnRzIGlmIHRoZXJlJ3MgYSBmaWx0ZXIsIG90aGVyd2lzZSBqdXN0IHJlbmRlciB0aGUgbmV3IGVsZW1lbnQKCiAgaWYgKGVsZW1lbnQuZmlsdGVyKSB7CiAgICBkaXNwYXRjaChmZXRjaEFsbFJlbmRlcmFibGVzKCkpOwogIH0gZWxzZSB7CiAgICBkaXNwYXRjaChmZXRjaFJlbmRlcmFibGUobmV3RWxlbWVudCkpOwogIH0gLy8gc2VsZWN0IHRoZSBuZXcgZWxlbWVudAoKCiAgZGlzcGF0Y2goKDAsIF90cmFuc2llbnQuc2VsZWN0VG9wbGV2ZWxOb2RlcykoW25ld0VsZW1lbnQuaWRdKSk7Cn0pOwpleHBvcnRzLmFkZEVsZW1lbnQgPSBhZGRFbGVtZW50Ow=="},null]}