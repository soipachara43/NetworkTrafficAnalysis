{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/layers/sources/es_geo_grid_source/es_geo_grid_source.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/layers/sources/es_geo_grid_source/es_geo_grid_source.js","mtime":1589249552448},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkVTR2VvR3JpZFNvdXJjZSA9IGV4cG9ydHMuTUFYX0dFT1RJTEVfTEVWRUwgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfdiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidXVpZC92NCIpKTsKCnZhciBfdmVjdG9yX2ZlYXR1cmVfdHlwZXMgPSByZXF1aXJlKCIuLi92ZWN0b3JfZmVhdHVyZV90eXBlcyIpOwoKdmFyIF9oZWF0bWFwX2xheWVyID0gcmVxdWlyZSgiLi4vLi4vaGVhdG1hcF9sYXllciIpOwoKdmFyIF92ZWN0b3JfbGF5ZXIgPSByZXF1aXJlKCIuLi8uLi92ZWN0b3JfbGF5ZXIiKTsKCnZhciBfY29udmVydF90b19nZW9qc29uID0gcmVxdWlyZSgiLi9jb252ZXJ0X3RvX2dlb2pzb24iKTsKCnZhciBfdmVjdG9yX3N0eWxlID0gcmVxdWlyZSgiLi4vLi4vc3R5bGVzL3ZlY3Rvci92ZWN0b3Jfc3R5bGUiKTsKCnZhciBfdmVjdG9yX3N0eWxlX2RlZmF1bHRzID0gcmVxdWlyZSgiLi4vLi4vc3R5bGVzL3ZlY3Rvci92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMiKTsKCnZhciBfY29sb3JfdXRpbHMgPSByZXF1aXJlKCIuLi8uLi9zdHlsZXMvY29sb3JfdXRpbHMiKTsKCnZhciBfY3JlYXRlX3NvdXJjZV9lZGl0b3IgPSByZXF1aXJlKCIuL2NyZWF0ZV9zb3VyY2VfZWRpdG9yIik7Cgp2YXIgX3VwZGF0ZV9zb3VyY2VfZWRpdG9yID0gcmVxdWlyZSgiLi91cGRhdGVfc291cmNlX2VkaXRvciIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vY29uc3RhbnRzIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfaTE4bl9nZXR0ZXJzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL2kxOG5fZ2V0dGVycyIpOwoKdmFyIF9lc19hZ2dfc291cmNlID0gcmVxdWlyZSgiLi4vZXNfYWdnX3NvdXJjZSIpOwoKdmFyIF9keW5hbWljX3N0eWxlX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi4vLi4vc3R5bGVzL3ZlY3Rvci9wcm9wZXJ0aWVzL2R5bmFtaWNfc3R5bGVfcHJvcGVydHkiKTsKCnZhciBfc3RhdGljX3N0eWxlX3Byb3BlcnR5ID0gcmVxdWlyZSgiLi4vLi4vc3R5bGVzL3ZlY3Rvci9wcm9wZXJ0aWVzL3N0YXRpY19zdHlsZV9wcm9wZXJ0eSIpOwoKdmFyIF9kYXRhX3JlcXVlc3QgPSByZXF1aXJlKCIuLi8uLi91dGlsL2RhdGFfcmVxdWVzdCIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgTUFYX0dFT1RJTEVfTEVWRUwgPSAyOTsKZXhwb3J0cy5NQVhfR0VPVElMRV9MRVZFTCA9IE1BWF9HRU9USUxFX0xFVkVMOwoKdmFyIEVTR2VvR3JpZFNvdXJjZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9BYnN0cmFjdEVTQWdnU291cmNlKSB7CiAgX2luaGVyaXRzKEVTR2VvR3JpZFNvdXJjZSwgX0Fic3RyYWN0RVNBZ2dTb3VyY2UpOwoKICBmdW5jdGlvbiBFU0dlb0dyaWRTb3VyY2UoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRVNHZW9HcmlkU291cmNlKTsKCiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEVTR2VvR3JpZFNvdXJjZSkuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRVNHZW9HcmlkU291cmNlLCBbewogICAga2V5OiAicmVuZGVyU291cmNlU2V0dGluZ3NFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlclNvdXJjZVNldHRpbmdzRWRpdG9yKF9yZWYpIHsKICAgICAgdmFyIG9uQ2hhbmdlID0gX3JlZi5vbkNoYW5nZTsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3VwZGF0ZV9zb3VyY2VfZWRpdG9yLlVwZGF0ZVNvdXJjZUVkaXRvciwgewogICAgICAgIGluZGV4UGF0dGVybklkOiB0aGlzLmdldEluZGV4UGF0dGVybklkKCksCiAgICAgICAgb25DaGFuZ2U6IG9uQ2hhbmdlLAogICAgICAgIG1ldHJpY3M6IHRoaXMuX2Rlc2NyaXB0b3IubWV0cmljcywKICAgICAgICByZW5kZXJBczogdGhpcy5fZGVzY3JpcHRvci5yZXF1ZXN0VHlwZSwKICAgICAgICByZXNvbHV0aW9uOiB0aGlzLl9kZXNjcmlwdG9yLnJlc29sdXRpb24KICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SW1tdXRhYmxlUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEltbXV0YWJsZVByb3BlcnRpZXMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBpbmRleFBhdHRlcm5UaXRsZSwgaW5kZXhQYXR0ZXJuOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVyblRpdGxlID0gdGhpcy5nZXRJbmRleFBhdHRlcm5JZCgpOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm4gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGl0bGUgPSBpbmRleFBhdHRlcm4udGl0bGU7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDg7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDEpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgW3sKICAgICAgICAgICAgICAgICAgbGFiZWw6ICgwLCBfaTE4bl9nZXR0ZXJzLmdldERhdGFTb3VyY2VMYWJlbCkoKSwKICAgICAgICAgICAgICAgICAgdmFsdWU6IEVTR2VvR3JpZFNvdXJjZS50aXRsZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBsYWJlbDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzR3JpZC5pbmRleFBhdHRlcm5MYWJlbCcsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0luZGV4IHBhdHRlcm4nCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICB2YWx1ZTogaW5kZXhQYXR0ZXJuVGl0bGUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc0dyaWQuZ2Vvc3BhdGlhbEZpZWxkTGFiZWwnLCB7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdHZW9zcGF0aWFsIGZpZWxkJwogICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuX2Rlc2NyaXB0b3IuZ2VvRmllbGQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgbGFiZWw6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc0dyaWQuc2hvd2FzRmllbGRMYWJlbCcsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1Nob3cgYXMnCiAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5fZGVzY3JpcHRvci5yZXF1ZXN0VHlwZQogICAgICAgICAgICAgICAgfV0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcywgW1sxLCA4XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRJbW11dGFibGVQcm9wZXJ0aWVzKCkgewogICAgICAgIHJldHVybiBfZ2V0SW1tdXRhYmxlUHJvcGVydGllcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0SW1tdXRhYmxlUHJvcGVydGllczsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldEZpZWxkTmFtZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkTmFtZXMoKSB7CiAgICAgIHJldHVybiB0aGlzLmdldE1ldHJpY0ZpZWxkcygpLm1hcChmdW5jdGlvbiAoZXNBZ2dNZXRyaWNGaWVsZCkgewogICAgICAgIHJldHVybiBlc0FnZ01ldHJpY0ZpZWxkLmdldE5hbWUoKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNHZW9HcmlkUHJlY2lzaW9uQXdhcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzR2VvR3JpZFByZWNpc2lvbkF3YXJlKCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc0pvaW5hYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0pvaW5hYmxlKCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0R3JpZFJlc29sdXRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdyaWRSZXNvbHV0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRvci5yZXNvbHV0aW9uOwogICAgfQogIH0sIHsKICAgIGtleTogImdldEdlb0dyaWRQcmVjaXNpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEdlb0dyaWRQcmVjaXNpb24oem9vbSkgewogICAgICB2YXIgdGFyZ2V0R2VvdGlsZUxldmVsID0gTWF0aC5jZWlsKHpvb20pICsgdGhpcy5fZ2V0R2VvR3JpZFByZWNpc2lvblJlc29sdXRpb25EZWx0YSgpOwoKICAgICAgcmV0dXJuIE1hdGgubWluKHRhcmdldEdlb3RpbGVMZXZlbCwgTUFYX0dFT1RJTEVfTEVWRUwpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9nZXRHZW9HcmlkUHJlY2lzaW9uUmVzb2x1dGlvbkRlbHRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0R2VvR3JpZFByZWNpc2lvblJlc29sdXRpb25EZWx0YSgpIHsKICAgICAgaWYgKHRoaXMuX2Rlc2NyaXB0b3IucmVzb2x1dGlvbiA9PT0gX2NvbnN0YW50cy5HUklEX1JFU09MVVRJT04uQ09BUlNFKSB7CiAgICAgICAgcmV0dXJuIDI7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLl9kZXNjcmlwdG9yLnJlc29sdXRpb24gPT09IF9jb25zdGFudHMuR1JJRF9SRVNPTFVUSU9OLkZJTkUpIHsKICAgICAgICByZXR1cm4gMzsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuX2Rlc2NyaXB0b3IucmVzb2x1dGlvbiA9PT0gX2NvbnN0YW50cy5HUklEX1JFU09MVVRJT04uTU9TVF9GSU5FKSB7CiAgICAgICAgcmV0dXJuIDQ7CiAgICAgIH0KCiAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNHcmlkLnJlc29sdXRpb25QYXJhbUVycm9yTWVzc2FnZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkdyaWQgcmVzb2x1dGlvbiBwYXJhbSBub3QgcmVjb2duaXplZDoge3Jlc29sdXRpb259IiwKICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgIHJlc29sdXRpb246IHRoaXMuX2Rlc2NyaXB0b3IucmVzb2x1dGlvbgogICAgICAgIH0KICAgICAgfSkpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9jb21wb3NpdGVBZ2dSZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY29tcG9zaXRlQWdnUmVxdWVzdDIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihfcmVmMikgewogICAgICAgIHZhciBzZWFyY2hTb3VyY2UsIGluZGV4UGF0dGVybiwgcHJlY2lzaW9uLCBsYXllck5hbWUsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssIGJ1Y2tldHNQZXJHcmlkLCBpc1JlcXVlc3RTdGlsbEFjdGl2ZSwgZ3JpZHNQZXJSZXF1ZXN0LCBhZ2dzLCBmZWF0dXJlcywgcmVxdWVzdENvdW50LCBhZnRlcktleSwgcmVxdWVzdElkLCBlc1Jlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBfcmVmMi5zZWFyY2hTb3VyY2UsIGluZGV4UGF0dGVybiA9IF9yZWYyLmluZGV4UGF0dGVybiwgcHJlY2lzaW9uID0gX3JlZjIucHJlY2lzaW9uLCBsYXllck5hbWUgPSBfcmVmMi5sYXllck5hbWUsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2sgPSBfcmVmMi5yZWdpc3RlckNhbmNlbENhbGxiYWNrLCBidWNrZXRzUGVyR3JpZCA9IF9yZWYyLmJ1Y2tldHNQZXJHcmlkLCBpc1JlcXVlc3RTdGlsbEFjdGl2ZSA9IF9yZWYyLmlzUmVxdWVzdFN0aWxsQWN0aXZlOwogICAgICAgICAgICAgICAgZ3JpZHNQZXJSZXF1ZXN0ID0gTWF0aC5mbG9vcihfY29uc3RhbnRzLkRFRkFVTFRfTUFYX0JVQ0tFVFNfTElNSVQgLyBidWNrZXRzUGVyR3JpZCk7CiAgICAgICAgICAgICAgICBhZ2dzID0gewogICAgICAgICAgICAgICAgICBjb21wb3NpdGVTcGxpdDogewogICAgICAgICAgICAgICAgICAgIGNvbXBvc2l0ZTogewogICAgICAgICAgICAgICAgICAgICAgc2l6ZTogZ3JpZHNQZXJSZXF1ZXN0LAogICAgICAgICAgICAgICAgICAgICAgc291cmNlczogW3sKICAgICAgICAgICAgICAgICAgICAgICAgZ3JpZFNwbGl0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VvdGlsZV9ncmlkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZDogdGhpcy5fZGVzY3JpcHRvci5nZW9GaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWNpc2lvbjogcHJlY2lzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYWdnczogX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgICAgICAgICAgICBncmlkQ2VudHJvaWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2VvX2NlbnRyb2lkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMuX2Rlc2NyaXB0b3IuZ2VvRmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZ2V0VmFsdWVBZ2dzRHNsKGluZGV4UGF0dGVybikpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IFtdOwogICAgICAgICAgICAgICAgcmVxdWVzdENvdW50ID0gMDsKICAgICAgICAgICAgICAgIGFmdGVyS2V5ID0gbnVsbDsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaWYgKCF0cnVlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChpc1JlcXVlc3RTdGlsbEFjdGl2ZSgpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9kYXRhX3JlcXVlc3QuRGF0YVJlcXVlc3RBYm9ydEVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIHJlcXVlc3RDb3VudCsrOyAvLyBjaXJjdWl0IGJyZWFrZXIgdG8gZW5zdXJlIHJlYXNvbmFibGUgbnVtYmVyIG9mIHJlcXVlc3RzCgogICAgICAgICAgICAgICAgaWYgKCEocmVxdWVzdENvdW50ID4gNSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5tYXBzLnNvdXJjZS5lc0dyaWQuY29tcG9zaXRlUGFnaW5hdGlvbkVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJ7bGF5ZXJOYW1lfSBpcyBjYXVzaW5nIHRvbyBtYW55IHJlcXVlc3RzLiBSZWR1Y2UgXCJHcmlkIHJlc29sdXRpb25cIiBhbmQvb3IgcmVkdWNlIHRoZSBudW1iZXIgb2YgdG9wIHRlcm0gXCJNZXRyaWNzXCIuIiwKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgbGF5ZXJOYW1lOiBsYXllck5hbWUKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgaWYgKGFmdGVyS2V5KSB7CiAgICAgICAgICAgICAgICAgIGFnZ3MuY29tcG9zaXRlU3BsaXQuY29tcG9zaXRlLmFmdGVyID0gYWZ0ZXJLZXk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdhZ2dzJywgYWdncyk7CiAgICAgICAgICAgICAgICByZXF1ZXN0SWQgPSBhZnRlcktleSA/ICIiLmNvbmNhdCh0aGlzLmdldElkKCksICIgYWZ0ZXJLZXkgIikuY29uY2F0KGFmdGVyS2V5Lmdlb1NwbGl0KSA6IHRoaXMuZ2V0SWQoKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcnVuRXNRdWVyeSh7CiAgICAgICAgICAgICAgICAgIHJlcXVlc3RJZDogcmVxdWVzdElkLAogICAgICAgICAgICAgICAgICByZXF1ZXN0TmFtZTogIiIuY29uY2F0KGxheWVyTmFtZSwgIiAoIikuY29uY2F0KHJlcXVlc3RDb3VudCwgIikiKSwKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlOiBzZWFyY2hTb3VyY2UsCiAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2s6IHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgIHJlcXVlc3REZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzR3JpZC5jb21wb3NpdGVJbnNwZWN0b3JEZXNjcmlwdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0VsYXN0aWNzZWFyY2ggZ2VvIGdyaWQgYWdncmVnYXRpb24gcmVxdWVzdDoge3JlcXVlc3RJZH0nLAogICAgICAgICAgICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdElkOiByZXF1ZXN0SWQKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGVzUmVzcG9uc2UgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGZlYXR1cmVzLnB1c2guYXBwbHkoZmVhdHVyZXMsIF90b0NvbnN1bWFibGVBcnJheSgoMCwgX2NvbnZlcnRfdG9fZ2VvanNvbi5jb252ZXJ0Q29tcG9zaXRlUmVzcFRvR2VvSnNvbikoZXNSZXNwb25zZSwgdGhpcy5fZGVzY3JpcHRvci5yZXF1ZXN0VHlwZSkpKTsKICAgICAgICAgICAgICAgIGFmdGVyS2V5ID0gZXNSZXNwb25zZS5hZ2dyZWdhdGlvbnMuY29tcG9zaXRlU3BsaXQuYWZ0ZXJfa2V5OwoKICAgICAgICAgICAgICAgIGlmICghKGVzUmVzcG9uc2UuYWdncmVnYXRpb25zLmNvbXBvc2l0ZVNwbGl0LmJ1Y2tldHMubGVuZ3RoIDwgZ3JpZHNQZXJSZXF1ZXN0KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgiYnJlYWsiLCAyNCk7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBmZWF0dXJlcyk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBfY29tcG9zaXRlQWdnUmVxdWVzdChfeCkgewogICAgICAgIHJldHVybiBfY29tcG9zaXRlQWdnUmVxdWVzdDIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9jb21wb3NpdGVBZ2dSZXF1ZXN0OwogICAgfSgpIC8vIERvIG5vdCB1c2UgY29tcG9zaXRlIGFnZ3JlZ2F0aW9uIHdoZW4gdGhlcmUgYXJlIG5vIHRlcm1zIHN1Yi1hZ2dyZWdhdGlvbnMKICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvcHVsbC81Nzg3NSNpc3N1ZWNvbW1lbnQtNTkwNTE1NDgyIGZvciBleHBsYW5hdGlvbiBvbiB1c2luZyBzZXBhcmF0ZSBjb2RlIHBhdGhzCgogIH0sIHsKICAgIGtleTogIl9ub25Db21wb3NpdGVBZ2dSZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfbm9uQ29tcG9zaXRlQWdnUmVxdWVzdDIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhfcmVmMykgewogICAgICAgIHZhciBzZWFyY2hTb3VyY2UsIGluZGV4UGF0dGVybiwgcHJlY2lzaW9uLCBsYXllck5hbWUsIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssIGVzUmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZSA9IF9yZWYzLnNlYXJjaFNvdXJjZSwgaW5kZXhQYXR0ZXJuID0gX3JlZjMuaW5kZXhQYXR0ZXJuLCBwcmVjaXNpb24gPSBfcmVmMy5wcmVjaXNpb24sIGxheWVyTmFtZSA9IF9yZWYzLmxheWVyTmFtZSwgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjayA9IF9yZWYzLnJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2s7CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ2FnZ3MnLCB7CiAgICAgICAgICAgICAgICAgIGdyaWRTcGxpdDogewogICAgICAgICAgICAgICAgICAgIGdlb3RpbGVfZ3JpZDogewogICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMuX2Rlc2NyaXB0b3IuZ2VvRmllbGQsCiAgICAgICAgICAgICAgICAgICAgICBwcmVjaXNpb246IHByZWNpc2lvbgogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgYWdnczogX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgICAgICAgICAgICBncmlkQ2VudHJvaWQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2VvX2NlbnRyb2lkOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmllbGQ6IHRoaXMuX2Rlc2NyaXB0b3IuZ2VvRmllbGQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHRoaXMuZ2V0VmFsdWVBZ2dzRHNsKGluZGV4UGF0dGVybikpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3J1bkVzUXVlcnkoewogICAgICAgICAgICAgICAgICByZXF1ZXN0SWQ6IHRoaXMuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgcmVxdWVzdE5hbWU6IGxheWVyTmFtZSwKICAgICAgICAgICAgICAgICAgc2VhcmNoU291cmNlOiBzZWFyY2hTb3VyY2UsCiAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2s6IHJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgIHJlcXVlc3REZXNjcmlwdGlvbjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLm1hcHMuc291cmNlLmVzR3JpZC5pbnNwZWN0b3JEZXNjcmlwdGlvbicsIHsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0VsYXN0aWNzZWFyY2ggZ2VvIGdyaWQgYWdncmVnYXRpb24gcmVxdWVzdCcKICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBlc1Jlc3BvbnNlID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgKDAsIF9jb252ZXJ0X3RvX2dlb2pzb24uY29udmVydFJlZ3VsYXJSZXNwVG9HZW9Kc29uKShlc1Jlc3BvbnNlLCB0aGlzLl9kZXNjcmlwdG9yLnJlcXVlc3RUeXBlKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9ub25Db21wb3NpdGVBZ2dSZXF1ZXN0KF94MikgewogICAgICAgIHJldHVybiBfbm9uQ29tcG9zaXRlQWdnUmVxdWVzdDIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9ub25Db21wb3NpdGVBZ2dSZXF1ZXN0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAiZ2V0R2VvSnNvbldpdGhNZXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0R2VvSnNvbldpdGhNZXRhID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQobGF5ZXJOYW1lLCBzZWFyY2hGaWx0ZXJzLCByZWdpc3RlckNhbmNlbENhbGxiYWNrLCBpc1JlcXVlc3RTdGlsbEFjdGl2ZSkgewogICAgICAgIHZhciBpbmRleFBhdHRlcm4sIHNlYXJjaFNvdXJjZSwgYnVja2V0c1BlckdyaWQsIGZlYXR1cmVzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tYWtlU2VhcmNoU291cmNlKHNlYXJjaEZpbHRlcnMsIDApOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIGJ1Y2tldHNQZXJHcmlkID0gMTsKICAgICAgICAgICAgICAgIHRoaXMuZ2V0TWV0cmljRmllbGRzKCkuZm9yRWFjaChmdW5jdGlvbiAobWV0cmljRmllbGQpIHsKICAgICAgICAgICAgICAgICAgYnVja2V0c1BlckdyaWQgKz0gbWV0cmljRmllbGQuZ2V0QnVja2V0Q291bnQoKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmICghKGJ1Y2tldHNQZXJHcmlkID09PSAxKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX25vbkNvbXBvc2l0ZUFnZ1JlcXVlc3QoewogICAgICAgICAgICAgICAgICBzZWFyY2hTb3VyY2U6IHNlYXJjaFNvdXJjZSwKICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuOiBpbmRleFBhdHRlcm4sCiAgICAgICAgICAgICAgICAgIHByZWNpc2lvbjogc2VhcmNoRmlsdGVycy5nZW9ncmlkUHJlY2lzaW9uLAogICAgICAgICAgICAgICAgICBsYXllck5hbWU6IGxheWVyTmFtZSwKICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjazogcmVnaXN0ZXJDYW5jZWxDYWxsYmFjawogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTc7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tcG9zaXRlQWdnUmVxdWVzdCh7CiAgICAgICAgICAgICAgICAgIHNlYXJjaFNvdXJjZTogc2VhcmNoU291cmNlLAogICAgICAgICAgICAgICAgICBpbmRleFBhdHRlcm46IGluZGV4UGF0dGVybiwKICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uOiBzZWFyY2hGaWx0ZXJzLmdlb2dyaWRQcmVjaXNpb24sCiAgICAgICAgICAgICAgICAgIGxheWVyTmFtZTogbGF5ZXJOYW1lLAogICAgICAgICAgICAgICAgICByZWdpc3RlckNhbmNlbENhbGxiYWNrOiByZWdpc3RlckNhbmNlbENhbGxiYWNrLAogICAgICAgICAgICAgICAgICBidWNrZXRzUGVyR3JpZDogYnVja2V0c1BlckdyaWQsCiAgICAgICAgICAgICAgICAgIGlzUmVxdWVzdFN0aWxsQWN0aXZlOiBpc1JlcXVlc3RTdGlsbEFjdGl2ZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDQuc2VudDsKCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gX2NvbnRleHQ0LnQwOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdGZWF0dXJlQ29sbGVjdGlvbicsCiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZXM6IGZlYXR1cmVzCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIG1ldGE6IHsKICAgICAgICAgICAgICAgICAgICBhcmVSZXN1bHRzVHJpbW1lZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgc291cmNlVHlwZTogX2NvbnN0YW50cy5FU19HRU9fR1JJRAogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEdlb0pzb25XaXRoTWV0YShfeDMsIF94NCwgX3g1LCBfeDYpIHsKICAgICAgICByZXR1cm4gX2dldEdlb0pzb25XaXRoTWV0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0R2VvSnNvbldpdGhNZXRhOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiaXNGaWx0ZXJCeU1hcEJvdW5kcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNGaWx0ZXJCeU1hcEJvdW5kcygpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSwgewogICAga2V5OiAiX2NyZWF0ZUhlYXRtYXBMYXllckRlc2NyaXB0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVIZWF0bWFwTGF5ZXJEZXNjcmlwdG9yKG9wdGlvbnMpIHsKICAgICAgcmV0dXJuIF9oZWF0bWFwX2xheWVyLkhlYXRtYXBMYXllci5jcmVhdGVEZXNjcmlwdG9yKF9vYmplY3RTcHJlYWQoewogICAgICAgIHNvdXJjZURlc2NyaXB0b3I6IHRoaXMuX2Rlc2NyaXB0b3IKICAgICAgfSwgb3B0aW9ucykpOwogICAgfQogIH0sIHsKICAgIGtleTogIl9jcmVhdGVWZWN0b3JMYXllckRlc2NyaXB0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9jcmVhdGVWZWN0b3JMYXllckRlc2NyaXB0b3Iob3B0aW9ucykgewogICAgICB2YXIgX1ZlY3RvclN0eWxlJGNyZWF0ZURlOwoKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBfdmVjdG9yX2xheWVyLlZlY3RvckxheWVyLmNyZWF0ZURlc2NyaXB0b3IoX29iamVjdFNwcmVhZCh7CiAgICAgICAgc291cmNlRGVzY3JpcHRvcjogdGhpcy5fZGVzY3JpcHRvcgogICAgICB9LCBvcHRpb25zKSk7CgogICAgICB2YXIgZGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzID0gKDAsIF92ZWN0b3Jfc3R5bGVfZGVmYXVsdHMuZ2V0RGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzKSgpOwogICAgICBkZXNjcmlwdG9yLnN0eWxlID0gX3ZlY3Rvcl9zdHlsZS5WZWN0b3JTdHlsZS5jcmVhdGVEZXNjcmlwdG9yKChfVmVjdG9yU3R5bGUkY3JlYXRlRGUgPSB7fSwgX2RlZmluZVByb3BlcnR5KF9WZWN0b3JTdHlsZSRjcmVhdGVEZSwgX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkZJTExfQ09MT1IsIHsKICAgICAgICB0eXBlOiBfZHluYW1pY19zdHlsZV9wcm9wZXJ0eS5EeW5hbWljU3R5bGVQcm9wZXJ0eS50eXBlLAogICAgICAgIG9wdGlvbnM6IF9vYmplY3RTcHJlYWQoe30sIGRlZmF1bHREeW5hbWljUHJvcGVydGllc1tfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuRklMTF9DT0xPUl0ub3B0aW9ucywgewogICAgICAgICAgZmllbGQ6IHsKICAgICAgICAgICAgbmFtZTogX2NvbnN0YW50cy5DT1VOVF9QUk9QX05BTUUsCiAgICAgICAgICAgIG9yaWdpbjogX2NvbnN0YW50cy5GSUVMRF9PUklHSU4uU09VUkNFCiAgICAgICAgICB9LAogICAgICAgICAgY29sb3I6IF9jb2xvcl91dGlscy5DT0xPUl9HUkFESUVOVFNbMF0udmFsdWUsCiAgICAgICAgICB0eXBlOiBfY29uc3RhbnRzLkNPTE9SX01BUF9UWVBFLk9SRElOQUwKICAgICAgICB9KQogICAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9WZWN0b3JTdHlsZSRjcmVhdGVEZSwgX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxJTkVfQ09MT1IsIHsKICAgICAgICB0eXBlOiBfc3RhdGljX3N0eWxlX3Byb3BlcnR5LlN0YXRpY1N0eWxlUHJvcGVydHkudHlwZSwKICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICBjb2xvcjogJyNGRkYnCiAgICAgICAgfQogICAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9WZWN0b3JTdHlsZSRjcmVhdGVEZSwgX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLkxJTkVfV0lEVEgsIHsKICAgICAgICB0eXBlOiBfc3RhdGljX3N0eWxlX3Byb3BlcnR5LlN0YXRpY1N0eWxlUHJvcGVydHkudHlwZSwKICAgICAgICBvcHRpb25zOiB7CiAgICAgICAgICBzaXplOiAwCiAgICAgICAgfQogICAgICB9KSwgX2RlZmluZVByb3BlcnR5KF9WZWN0b3JTdHlsZSRjcmVhdGVEZSwgX2NvbnN0YW50cy5WRUNUT1JfU1RZTEVTLklDT05fU0laRSwgewogICAgICAgIHR5cGU6IF9keW5hbWljX3N0eWxlX3Byb3BlcnR5LkR5bmFtaWNTdHlsZVByb3BlcnR5LnR5cGUsCiAgICAgICAgb3B0aW9uczogX29iamVjdFNwcmVhZCh7fSwgZGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5JQ09OX1NJWkVdLm9wdGlvbnMsIHsKICAgICAgICAgIGZpZWxkOiB7CiAgICAgICAgICAgIG5hbWU6IF9jb25zdGFudHMuQ09VTlRfUFJPUF9OQU1FLAogICAgICAgICAgICBvcmlnaW46IF9jb25zdGFudHMuRklFTERfT1JJR0lOLlNPVVJDRQogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pLCBfZGVmaW5lUHJvcGVydHkoX1ZlY3RvclN0eWxlJGNyZWF0ZURlLCBfY29uc3RhbnRzLlZFQ1RPUl9TVFlMRVMuTEFCRUxfVEVYVCwgewogICAgICAgIHR5cGU6IF9keW5hbWljX3N0eWxlX3Byb3BlcnR5LkR5bmFtaWNTdHlsZVByb3BlcnR5LnR5cGUsCiAgICAgICAgb3B0aW9uczogX29iamVjdFNwcmVhZCh7fSwgZGVmYXVsdER5bmFtaWNQcm9wZXJ0aWVzW19jb25zdGFudHMuVkVDVE9SX1NUWUxFUy5MQUJFTF9URVhUXS5vcHRpb25zLCB7CiAgICAgICAgICBmaWVsZDogewogICAgICAgICAgICBuYW1lOiBfY29uc3RhbnRzLkNPVU5UX1BST1BfTkFNRSwKICAgICAgICAgICAgb3JpZ2luOiBfY29uc3RhbnRzLkZJRUxEX09SSUdJTi5TT1VSQ0UKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICB9KSwgX1ZlY3RvclN0eWxlJGNyZWF0ZURlKSk7CiAgICAgIHJldHVybiBkZXNjcmlwdG9yOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZURlZmF1bHRMYXllciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlRGVmYXVsdExheWVyKG9wdGlvbnMpIHsKICAgICAgaWYgKHRoaXMuX2Rlc2NyaXB0b3IucmVxdWVzdFR5cGUgPT09IF9jb25zdGFudHMuUkVOREVSX0FTLkhFQVRNQVApIHsKICAgICAgICByZXR1cm4gbmV3IF9oZWF0bWFwX2xheWVyLkhlYXRtYXBMYXllcih7CiAgICAgICAgICBsYXllckRlc2NyaXB0b3I6IHRoaXMuX2NyZWF0ZUhlYXRtYXBMYXllckRlc2NyaXB0b3Iob3B0aW9ucyksCiAgICAgICAgICBzb3VyY2U6IHRoaXMKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIGxheWVyRGVzY3JpcHRvciA9IHRoaXMuX2NyZWF0ZVZlY3RvckxheWVyRGVzY3JpcHRvcihvcHRpb25zKTsKCiAgICAgIHZhciBzdHlsZSA9IG5ldyBfdmVjdG9yX3N0eWxlLlZlY3RvclN0eWxlKGxheWVyRGVzY3JpcHRvci5zdHlsZSwgdGhpcyk7CiAgICAgIHJldHVybiBuZXcgX3ZlY3Rvcl9sYXllci5WZWN0b3JMYXllcih7CiAgICAgICAgbGF5ZXJEZXNjcmlwdG9yOiBsYXllckRlc2NyaXB0b3IsCiAgICAgICAgc291cmNlOiB0aGlzLAogICAgICAgIHN0eWxlOiBzdHlsZQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYW5Gb3JtYXRGZWF0dXJlUHJvcGVydGllcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuRm9ybWF0RmVhdHVyZVByb3BlcnRpZXMoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogImZpbHRlckFuZEZvcm1hdFByb3BlcnRpZXNUb0h0bWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9maWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUocHJvcGVydGllcykgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sRm9yTWV0cmljRmllbGRzKHByb3BlcnRpZXMpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ1LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmaWx0ZXJBbmRGb3JtYXRQcm9wZXJ0aWVzVG9IdG1sKF94NykgewogICAgICAgIHJldHVybiBfZmlsdGVyQW5kRm9ybWF0UHJvcGVydGllc1RvSHRtbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZmlsdGVyQW5kRm9ybWF0UHJvcGVydGllc1RvSHRtbDsKICAgIH0oKQogIH0sIHsKICAgIGtleTogImdldFN1cHBvcnRlZFNoYXBlVHlwZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRTdXBwb3J0ZWRTaGFwZVR5cGVzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuX2Rlc2NyaXB0b3IucmVxdWVzdFR5cGUgPT09IF9jb25zdGFudHMuUkVOREVSX0FTLkdSSUQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPTFlHT05dKTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIFtfdmVjdG9yX2ZlYXR1cmVfdHlwZXMuVkVDVE9SX1NIQVBFX1RZUEVTLlBPSU5UXSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFN1cHBvcnRlZFNoYXBlVHlwZXMoKSB7CiAgICAgICAgcmV0dXJuIF9nZXRTdXBwb3J0ZWRTaGFwZVR5cGVzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRTdXBwb3J0ZWRTaGFwZVR5cGVzOwogICAgfSgpCiAgfV0sIFt7CiAgICBrZXk6ICJjcmVhdGVEZXNjcmlwdG9yIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVEZXNjcmlwdG9yKF9yZWY0KSB7CiAgICAgIHZhciBpbmRleFBhdHRlcm5JZCA9IF9yZWY0LmluZGV4UGF0dGVybklkLAogICAgICAgICAgZ2VvRmllbGQgPSBfcmVmNC5nZW9GaWVsZCwKICAgICAgICAgIHJlcXVlc3RUeXBlID0gX3JlZjQucmVxdWVzdFR5cGUsCiAgICAgICAgICByZXNvbHV0aW9uID0gX3JlZjQucmVzb2x1dGlvbjsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBFU0dlb0dyaWRTb3VyY2UudHlwZSwKICAgICAgICBpZDogKDAsIF92LmRlZmF1bHQpKCksCiAgICAgICAgaW5kZXhQYXR0ZXJuSWQ6IGluZGV4UGF0dGVybklkLAogICAgICAgIGdlb0ZpZWxkOiBnZW9GaWVsZCwKICAgICAgICByZXF1ZXN0VHlwZTogcmVxdWVzdFR5cGUsCiAgICAgICAgcmVzb2x1dGlvbjogcmVzb2x1dGlvbiA/IHJlc29sdXRpb24gOiBfY29uc3RhbnRzLkdSSURfUkVTT0xVVElPTi5DT0FSU0UKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXJFZGl0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckVkaXRvcihfcmVmNSkgewogICAgICB2YXIgb25QcmV2aWV3U291cmNlID0gX3JlZjUub25QcmV2aWV3U291cmNlLAogICAgICAgICAgaW5zcGVjdG9yQWRhcHRlcnMgPSBfcmVmNS5pbnNwZWN0b3JBZGFwdGVyczsKCiAgICAgIHZhciBvblNvdXJjZUNvbmZpZ0NoYW5nZSA9IGZ1bmN0aW9uIG9uU291cmNlQ29uZmlnQ2hhbmdlKHNvdXJjZUNvbmZpZykgewogICAgICAgIGlmICghc291cmNlQ29uZmlnKSB7CiAgICAgICAgICBvblByZXZpZXdTb3VyY2UobnVsbCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgc291cmNlRGVzY3JpcHRvciA9IEVTR2VvR3JpZFNvdXJjZS5jcmVhdGVEZXNjcmlwdG9yKHNvdXJjZUNvbmZpZyk7CiAgICAgICAgdmFyIHNvdXJjZSA9IG5ldyBFU0dlb0dyaWRTb3VyY2Uoc291cmNlRGVzY3JpcHRvciwgaW5zcGVjdG9yQWRhcHRlcnMpOwogICAgICAgIG9uUHJldmlld1NvdXJjZShzb3VyY2UpOwogICAgICB9OwoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2NyZWF0ZV9zb3VyY2VfZWRpdG9yLkNyZWF0ZVNvdXJjZUVkaXRvciwgewogICAgICAgIG9uU291cmNlQ29uZmlnQ2hhbmdlOiBvblNvdXJjZUNvbmZpZ0NoYW5nZQogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBFU0dlb0dyaWRTb3VyY2U7Cn0oX2VzX2FnZ19zb3VyY2UuQWJzdHJhY3RFU0FnZ1NvdXJjZSk7CgpleHBvcnRzLkVTR2VvR3JpZFNvdXJjZSA9IEVTR2VvR3JpZFNvdXJjZTsKCl9kZWZpbmVQcm9wZXJ0eShFU0dlb0dyaWRTb3VyY2UsICJ0eXBlIiwgX2NvbnN0YW50cy5FU19HRU9fR1JJRCk7CgpfZGVmaW5lUHJvcGVydHkoRVNHZW9HcmlkU291cmNlLCAidGl0bGUiLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNHcmlkVGl0bGUnLCB7CiAgZGVmYXVsdE1lc3NhZ2U6ICdHcmlkIGFnZ3JlZ2F0aW9uJwp9KSk7CgpfZGVmaW5lUHJvcGVydHkoRVNHZW9HcmlkU291cmNlLCAiZGVzY3JpcHRpb24iLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subWFwcy5zb3VyY2UuZXNHcmlkRGVzY3JpcHRpb24nLCB7CiAgZGVmYXVsdE1lc3NhZ2U6ICdHZW9zcGF0aWFsIGRhdGEgZ3JvdXBlZCBpbiBncmlkcyB3aXRoIG1ldHJpY3MgZm9yIGVhY2ggZ3JpZGRlZCBjZWxsJwp9KSk7"},null]}