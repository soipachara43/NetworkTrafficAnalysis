{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/maps/public/actions/map_actions.js","dependencies":[{"path":"x-pack/legacy/plugins/maps/public/actions/map_actions.js","mtime":1589249552384},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwp2YXIgX2V4cG9ydE5hbWVzID0gewogIGNhbmNlbEFsbEluRmxpZ2h0UmVxdWVzdHM6IHRydWUsCiAgc2V0TWFwSW5pdEVycm9yOiB0cnVlLAogIHRyYWNrQ3VycmVudExheWVyU3RhdGU6IHRydWUsCiAgcm9sbGJhY2tUb1RyYWNrZWRMYXllclN0YXRlRm9yU2VsZWN0ZWRMYXllcjogdHJ1ZSwKICByZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZUZvclNlbGVjdGVkTGF5ZXI6IHRydWUsCiAgcmVwbGFjZUxheWVyTGlzdDogdHJ1ZSwKICBjbG9uZUxheWVyOiB0cnVlLAogIGFkZExheWVyOiB0cnVlLAogIGFkZExheWVyV2l0aG91dERhdGFTeW5jOiB0cnVlLAogIGNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXI6IHRydWUsCiAgc2V0TGF5ZXJWaXNpYmlsaXR5OiB0cnVlLAogIHRvZ2dsZUxheWVyVmlzaWJsZTogdHJ1ZSwKICBzZXRTZWxlY3RlZExheWVyOiB0cnVlLAogIHJlbW92ZVRyYW5zaWVudExheWVyOiB0cnVlLAogIHNldFRyYW5zaWVudExheWVyOiB0cnVlLAogIGNsZWFyVHJhbnNpZW50TGF5ZXJTdGF0ZUFuZENsb3NlRmx5b3V0OiB0cnVlLAogIHVwZGF0ZUxheWVyT3JkZXI6IHRydWUsCiAgbWFwUmVhZHk6IHRydWUsCiAgbWFwRGVzdHJveWVkOiB0cnVlLAogIG1hcEV4dGVudENoYW5nZWQ6IHRydWUsCiAgY2xvc2VPbkNsaWNrVG9vbHRpcDogdHJ1ZSwKICBvcGVuT25DbGlja1Rvb2x0aXA6IHRydWUsCiAgY2xvc2VPbkhvdmVyVG9vbHRpcDogdHJ1ZSwKICBvcGVuT25Ib3ZlclRvb2x0aXA6IHRydWUsCiAgc2V0TW91c2VDb29yZGluYXRlczogdHJ1ZSwKICBjbGVhck1vdXNlQ29vcmRpbmF0ZXM6IHRydWUsCiAgZGlzYWJsZVNjcm9sbFpvb206IHRydWUsCiAgZml0VG9MYXllckV4dGVudDogdHJ1ZSwKICBzZXRHb3RvV2l0aEJvdW5kczogdHJ1ZSwKICBzZXRHb3RvV2l0aENlbnRlcjogdHJ1ZSwKICBjbGVhckdvdG86IHRydWUsCiAgc3RhcnREYXRhTG9hZDogdHJ1ZSwKICB1cGRhdGVTb3VyY2VEYXRhUmVxdWVzdDogdHJ1ZSwKICBlbmREYXRhTG9hZDogdHJ1ZSwKICBvbkRhdGFMb2FkRXJyb3I6IHRydWUsCiAgdXBkYXRlU291cmNlUHJvcDogdHJ1ZSwKICBzeW5jRGF0YUZvckxheWVyOiB0cnVlLAogIHVwZGF0ZUxheWVyTGFiZWw6IHRydWUsCiAgdXBkYXRlTGF5ZXJNaW5ab29tOiB0cnVlLAogIHVwZGF0ZUxheWVyTWF4Wm9vbTogdHJ1ZSwKICB1cGRhdGVMYXllckFscGhhOiB0cnVlLAogIHNldExheWVyUXVlcnk6IHRydWUsCiAgcmVtb3ZlU2VsZWN0ZWRMYXllcjogdHJ1ZSwKICByZW1vdmVMYXllcjogdHJ1ZSwKICBzZXRRdWVyeTogdHJ1ZSwKICBzZXRSZWZyZXNoQ29uZmlnOiB0cnVlLAogIHRyaWdnZXJSZWZyZXNoVGltZXI6IHRydWUsCiAgY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzOiB0cnVlLAogIHVwZGF0ZUxheWVyU3R5bGU6IHRydWUsCiAgdXBkYXRlU3R5bGVNZXRhOiB0cnVlLAogIHVwZGF0ZUxheWVyU3R5bGVGb3JTZWxlY3RlZExheWVyOiB0cnVlLAogIHNldEpvaW5zRm9yTGF5ZXI6IHRydWUsCiAgdXBkYXRlRHJhd1N0YXRlOiB0cnVlLAogIGRpc2FibGVJbnRlcmFjdGl2ZTogdHJ1ZSwKICBkaXNhYmxlVG9vbHRpcENvbnRyb2w6IHRydWUsCiAgaGlkZVRvb2xiYXJPdmVybGF5OiB0cnVlLAogIGhpZGVMYXllckNvbnRyb2w6IHRydWUsCiAgaGlkZVZpZXdDb250cm9sOiB0cnVlLAogIHNldEhpZGRlbkxheWVyczogdHJ1ZQp9OwpleHBvcnRzLmNhbmNlbEFsbEluRmxpZ2h0UmVxdWVzdHMgPSBjYW5jZWxBbGxJbkZsaWdodFJlcXVlc3RzOwpleHBvcnRzLnNldE1hcEluaXRFcnJvciA9IHNldE1hcEluaXRFcnJvcjsKZXhwb3J0cy50cmFja0N1cnJlbnRMYXllclN0YXRlID0gdHJhY2tDdXJyZW50TGF5ZXJTdGF0ZTsKZXhwb3J0cy5yb2xsYmFja1RvVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyID0gcm9sbGJhY2tUb1RyYWNrZWRMYXllclN0YXRlRm9yU2VsZWN0ZWRMYXllcjsKZXhwb3J0cy5yZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZUZvclNlbGVjdGVkTGF5ZXIgPSByZW1vdmVUcmFja2VkTGF5ZXJTdGF0ZUZvclNlbGVjdGVkTGF5ZXI7CmV4cG9ydHMucmVwbGFjZUxheWVyTGlzdCA9IHJlcGxhY2VMYXllckxpc3Q7CmV4cG9ydHMuY2xvbmVMYXllciA9IGNsb25lTGF5ZXI7CmV4cG9ydHMuYWRkTGF5ZXIgPSBhZGRMYXllcjsKZXhwb3J0cy5hZGRMYXllcldpdGhvdXREYXRhU3luYyA9IGFkZExheWVyV2l0aG91dERhdGFTeW5jOwpleHBvcnRzLmNsZWFuVG9vbHRpcFN0YXRlRm9yTGF5ZXIgPSBjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyOwpleHBvcnRzLnNldExheWVyVmlzaWJpbGl0eSA9IHNldExheWVyVmlzaWJpbGl0eTsKZXhwb3J0cy50b2dnbGVMYXllclZpc2libGUgPSB0b2dnbGVMYXllclZpc2libGU7CmV4cG9ydHMuc2V0U2VsZWN0ZWRMYXllciA9IHNldFNlbGVjdGVkTGF5ZXI7CmV4cG9ydHMucmVtb3ZlVHJhbnNpZW50TGF5ZXIgPSByZW1vdmVUcmFuc2llbnRMYXllcjsKZXhwb3J0cy5zZXRUcmFuc2llbnRMYXllciA9IHNldFRyYW5zaWVudExheWVyOwpleHBvcnRzLmNsZWFyVHJhbnNpZW50TGF5ZXJTdGF0ZUFuZENsb3NlRmx5b3V0ID0gY2xlYXJUcmFuc2llbnRMYXllclN0YXRlQW5kQ2xvc2VGbHlvdXQ7CmV4cG9ydHMudXBkYXRlTGF5ZXJPcmRlciA9IHVwZGF0ZUxheWVyT3JkZXI7CmV4cG9ydHMubWFwUmVhZHkgPSBtYXBSZWFkeTsKZXhwb3J0cy5tYXBEZXN0cm95ZWQgPSBtYXBEZXN0cm95ZWQ7CmV4cG9ydHMubWFwRXh0ZW50Q2hhbmdlZCA9IG1hcEV4dGVudENoYW5nZWQ7CmV4cG9ydHMuY2xvc2VPbkNsaWNrVG9vbHRpcCA9IGNsb3NlT25DbGlja1Rvb2x0aXA7CmV4cG9ydHMub3Blbk9uQ2xpY2tUb29sdGlwID0gb3Blbk9uQ2xpY2tUb29sdGlwOwpleHBvcnRzLmNsb3NlT25Ib3ZlclRvb2x0aXAgPSBjbG9zZU9uSG92ZXJUb29sdGlwOwpleHBvcnRzLm9wZW5PbkhvdmVyVG9vbHRpcCA9IG9wZW5PbkhvdmVyVG9vbHRpcDsKZXhwb3J0cy5zZXRNb3VzZUNvb3JkaW5hdGVzID0gc2V0TW91c2VDb29yZGluYXRlczsKZXhwb3J0cy5jbGVhck1vdXNlQ29vcmRpbmF0ZXMgPSBjbGVhck1vdXNlQ29vcmRpbmF0ZXM7CmV4cG9ydHMuZGlzYWJsZVNjcm9sbFpvb20gPSBkaXNhYmxlU2Nyb2xsWm9vbTsKZXhwb3J0cy5maXRUb0xheWVyRXh0ZW50ID0gZml0VG9MYXllckV4dGVudDsKZXhwb3J0cy5zZXRHb3RvV2l0aEJvdW5kcyA9IHNldEdvdG9XaXRoQm91bmRzOwpleHBvcnRzLnNldEdvdG9XaXRoQ2VudGVyID0gc2V0R290b1dpdGhDZW50ZXI7CmV4cG9ydHMuY2xlYXJHb3RvID0gY2xlYXJHb3RvOwpleHBvcnRzLnN0YXJ0RGF0YUxvYWQgPSBzdGFydERhdGFMb2FkOwpleHBvcnRzLnVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0ID0gdXBkYXRlU291cmNlRGF0YVJlcXVlc3Q7CmV4cG9ydHMuZW5kRGF0YUxvYWQgPSBlbmREYXRhTG9hZDsKZXhwb3J0cy5vbkRhdGFMb2FkRXJyb3IgPSBvbkRhdGFMb2FkRXJyb3I7CmV4cG9ydHMudXBkYXRlU291cmNlUHJvcCA9IHVwZGF0ZVNvdXJjZVByb3A7CmV4cG9ydHMuc3luY0RhdGFGb3JMYXllciA9IHN5bmNEYXRhRm9yTGF5ZXI7CmV4cG9ydHMudXBkYXRlTGF5ZXJMYWJlbCA9IHVwZGF0ZUxheWVyTGFiZWw7CmV4cG9ydHMudXBkYXRlTGF5ZXJNaW5ab29tID0gdXBkYXRlTGF5ZXJNaW5ab29tOwpleHBvcnRzLnVwZGF0ZUxheWVyTWF4Wm9vbSA9IHVwZGF0ZUxheWVyTWF4Wm9vbTsKZXhwb3J0cy51cGRhdGVMYXllckFscGhhID0gdXBkYXRlTGF5ZXJBbHBoYTsKZXhwb3J0cy5zZXRMYXllclF1ZXJ5ID0gc2V0TGF5ZXJRdWVyeTsKZXhwb3J0cy5yZW1vdmVTZWxlY3RlZExheWVyID0gcmVtb3ZlU2VsZWN0ZWRMYXllcjsKZXhwb3J0cy5yZW1vdmVMYXllciA9IHJlbW92ZUxheWVyOwpleHBvcnRzLnNldFF1ZXJ5ID0gc2V0UXVlcnk7CmV4cG9ydHMuc2V0UmVmcmVzaENvbmZpZyA9IHNldFJlZnJlc2hDb25maWc7CmV4cG9ydHMudHJpZ2dlclJlZnJlc2hUaW1lciA9IHRyaWdnZXJSZWZyZXNoVGltZXI7CmV4cG9ydHMuY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzID0gY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzOwpleHBvcnRzLnVwZGF0ZUxheWVyU3R5bGUgPSB1cGRhdGVMYXllclN0eWxlOwpleHBvcnRzLnVwZGF0ZVN0eWxlTWV0YSA9IHVwZGF0ZVN0eWxlTWV0YTsKZXhwb3J0cy51cGRhdGVMYXllclN0eWxlRm9yU2VsZWN0ZWRMYXllciA9IHVwZGF0ZUxheWVyU3R5bGVGb3JTZWxlY3RlZExheWVyOwpleHBvcnRzLnNldEpvaW5zRm9yTGF5ZXIgPSBzZXRKb2luc0ZvckxheWVyOwpleHBvcnRzLnVwZGF0ZURyYXdTdGF0ZSA9IHVwZGF0ZURyYXdTdGF0ZTsKZXhwb3J0cy5kaXNhYmxlSW50ZXJhY3RpdmUgPSBkaXNhYmxlSW50ZXJhY3RpdmU7CmV4cG9ydHMuZGlzYWJsZVRvb2x0aXBDb250cm9sID0gZGlzYWJsZVRvb2x0aXBDb250cm9sOwpleHBvcnRzLmhpZGVUb29sYmFyT3ZlcmxheSA9IGhpZGVUb29sYmFyT3ZlcmxheTsKZXhwb3J0cy5oaWRlTGF5ZXJDb250cm9sID0gaGlkZUxheWVyQ29udHJvbDsKZXhwb3J0cy5oaWRlVmlld0NvbnRyb2wgPSBoaWRlVmlld0NvbnRyb2w7CmV4cG9ydHMuc2V0SGlkZGVuTGF5ZXJzID0gc2V0SGlkZGVuTGF5ZXJzOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfdHVyZiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidHVyZiIpKTsKCnZhciBfYm9vbGVhbkNvbnRhaW5zID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAdHVyZi9ib29sZWFuLWNvbnRhaW5zIikpOwoKdmFyIF92ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1dWlkL3Y0IikpOwoKdmFyIF9tYXBfc2VsZWN0b3JzID0gcmVxdWlyZSgiLi4vc2VsZWN0b3JzL21hcF9zZWxlY3RvcnMiKTsKCnZhciBfdWkgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9wbHVnaW5zL21hcHMvcHVibGljL3JlZHVjZXJzL3VpIik7Cgp2YXIgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9tYXBzL3B1YmxpYy9yZWR1Y2Vycy9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcyIpOwoKdmFyIF91aV9hY3Rpb25zID0gcmVxdWlyZSgiLi4vYWN0aW9ucy91aV9hY3Rpb25zIik7Cgp2YXIgX2NvbnN0YW50cyA9IHJlcXVpcmUoIi4uLy4uL2NvbW1vbi9jb25zdGFudHMiKTsKCnZhciBfbWFwX2FjdGlvbnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9wbHVnaW5zL21hcHMvcHVibGljL2FjdGlvbnMvbWFwX2FjdGlvbnMiKTsKCk9iamVjdC5rZXlzKF9tYXBfYWN0aW9ucykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgaWYgKGtleSA9PT0gImRlZmF1bHQiIHx8IGtleSA9PT0gIl9fZXNNb2R1bGUiKSByZXR1cm47CiAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChfZXhwb3J0TmFtZXMsIGtleSkpIHJldHVybjsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7CiAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiBfbWFwX2FjdGlvbnNba2V5XTsKICAgIH0KICB9KTsKfSk7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHNlbGYgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7IGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7IH0gX25leHQodW5kZWZpbmVkKTsgfSk7IH07IH0KCmZ1bmN0aW9uIGdldExheWVyTG9hZGluZ0NhbGxiYWNrcyhkaXNwYXRjaCwgZ2V0U3RhdGUsIGxheWVySWQpIHsKICByZXR1cm4gewogICAgc3RhcnRMb2FkaW5nOiBmdW5jdGlvbiBzdGFydExvYWRpbmcoZGF0YUlkLCByZXF1ZXN0VG9rZW4sIG1ldGEpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKHN0YXJ0RGF0YUxvYWQobGF5ZXJJZCwgZGF0YUlkLCByZXF1ZXN0VG9rZW4sIG1ldGEpKTsKICAgIH0sCiAgICBzdG9wTG9hZGluZzogZnVuY3Rpb24gc3RvcExvYWRpbmcoZGF0YUlkLCByZXF1ZXN0VG9rZW4sIGRhdGEsIG1ldGEpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKGVuZERhdGFMb2FkKGxheWVySWQsIGRhdGFJZCwgcmVxdWVzdFRva2VuLCBkYXRhLCBtZXRhKSk7CiAgICB9LAogICAgb25Mb2FkRXJyb3I6IGZ1bmN0aW9uIG9uTG9hZEVycm9yKGRhdGFJZCwgcmVxdWVzdFRva2VuLCBlcnJvck1lc3NhZ2UpIHsKICAgICAgcmV0dXJuIGRpc3BhdGNoKG9uRGF0YUxvYWRFcnJvcihsYXllcklkLCBkYXRhSWQsIHJlcXVlc3RUb2tlbiwgZXJyb3JNZXNzYWdlKSk7CiAgICB9LAogICAgdXBkYXRlU291cmNlRGF0YTogZnVuY3Rpb24gdXBkYXRlU291cmNlRGF0YShuZXdEYXRhKSB7CiAgICAgIGRpc3BhdGNoKHVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0KGxheWVySWQsIG5ld0RhdGEpKTsKICAgIH0sCiAgICBpc1JlcXVlc3RTdGlsbEFjdGl2ZTogZnVuY3Rpb24gaXNSZXF1ZXN0U3RpbGxBY3RpdmUoZGF0YUlkLCByZXF1ZXN0VG9rZW4pIHsKICAgICAgdmFyIGRhdGFSZXF1ZXN0ID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFSZXF1ZXN0RGVzY3JpcHRvcikoZ2V0U3RhdGUoKSwgbGF5ZXJJZCwgZGF0YUlkKTsKCiAgICAgIGlmICghZGF0YVJlcXVlc3QpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRhUmVxdWVzdC5kYXRhUmVxdWVzdFRva2VuID09PSByZXF1ZXN0VG9rZW47CiAgICB9LAogICAgcmVnaXN0ZXJDYW5jZWxDYWxsYmFjazogZnVuY3Rpb24gcmVnaXN0ZXJDYW5jZWxDYWxsYmFjayhyZXF1ZXN0VG9rZW4sIGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiBkaXNwYXRjaCgoMCwgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzLnJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2spKHJlcXVlc3RUb2tlbiwgY2FsbGJhY2spKTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBnZXRMYXllckJ5SWQobGF5ZXJJZCwgc3RhdGUpIHsKICByZXR1cm4gKDAsIF9tYXBfc2VsZWN0b3JzLmdldExheWVyTGlzdCkoc3RhdGUpLmZpbmQoZnVuY3Rpb24gKGxheWVyKSB7CiAgICByZXR1cm4gbGF5ZXJJZCA9PT0gbGF5ZXIuZ2V0SWQoKTsKICB9KTsKfQoKZnVuY3Rpb24gc3luY0RhdGFGb3JBbGxMYXllcnMoX3gsIF94MiwgX3gzKSB7CiAgcmV0dXJuIF9zeW5jRGF0YUZvckFsbExheWVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfc3luY0RhdGFGb3JBbGxMYXllcnMoKSB7CiAgX3N5bmNEYXRhRm9yQWxsTGF5ZXJzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMChkaXNwYXRjaCwgZ2V0U3RhdGUsIGRhdGFGaWx0ZXJzKSB7CiAgICB2YXIgc3RhdGUsIGxheWVyTGlzdCwgc3luY3M7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIwJChfY29udGV4dDIwKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgICAgICAgICBsYXllckxpc3QgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0KShzdGF0ZSk7CiAgICAgICAgICAgIHN5bmNzID0gbGF5ZXJMaXN0Lm1hcChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICAgICAgICB2YXIgbG9hZGluZ0Z1bmN0aW9ucyA9IGdldExheWVyTG9hZGluZ0NhbGxiYWNrcyhkaXNwYXRjaCwgZ2V0U3RhdGUsIGxheWVyLmdldElkKCkpOwogICAgICAgICAgICAgIHJldHVybiBsYXllci5zeW5jRGF0YShfb2JqZWN0U3ByZWFkKHt9LCBsb2FkaW5nRnVuY3Rpb25zLCB7CiAgICAgICAgICAgICAgICBkYXRhRmlsdGVyczogZGF0YUZpbHRlcnMKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBfY29udGV4dDIwLm5leHQgPSA1OwogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoc3luY3MpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIwLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyMCk7CiAgfSkpOwogIHJldHVybiBfc3luY0RhdGFGb3JBbGxMYXllcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gY2FuY2VsQWxsSW5GbGlnaHRSZXF1ZXN0cygpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgKDAsIF9tYXBfc2VsZWN0b3JzLmdldExheWVyTGlzdCkoZ2V0U3RhdGUoKSkuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgbGF5ZXIuZ2V0SW5GbGlnaHRSZXF1ZXN0VG9rZW5zKCkuZm9yRWFjaChmdW5jdGlvbiAocmVxdWVzdFRva2VuKSB7CiAgICAgICAgZGlzcGF0Y2goKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5jYW5jZWxSZXF1ZXN0KShyZXF1ZXN0VG9rZW4pKTsKICAgICAgfSk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBzZXRNYXBJbml0RXJyb3IoZXJyb3JNZXNzYWdlKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfTUFQX0lOSVRfRVJST1IsCiAgICBlcnJvck1lc3NhZ2U6IGVycm9yTWVzc2FnZQogIH07Cn0KCmZ1bmN0aW9uIHRyYWNrQ3VycmVudExheWVyU3RhdGUobGF5ZXJJZCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuVFJBQ0tfQ1VSUkVOVF9MQVlFUl9TVEFURSwKICAgIGxheWVySWQ6IGxheWVySWQKICB9Owp9CgpmdW5jdGlvbiByb2xsYmFja1RvVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyKCkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgICAgICB2YXIgbGF5ZXJJZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBsYXllcklkID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFNlbGVjdGVkTGF5ZXJJZCkoZ2V0U3RhdGUoKSk7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5ST0xMQkFDS19UT19UUkFDS0VEX0xBWUVSX1NUQVRFLAogICAgICAgICAgICAgICAgICBsYXllcklkOiBsYXllcklkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgLy8gRW5zdXJlIHVwZGF0ZVN0eWxlTWV0YSBpcyB0cmlnZ2VyZWQKICAgICAgICAgICAgICAgIC8vIHN5bmNEYXRhRm9yTGF5ZXIgbWF5IG5vdCB0cmlnZ2VyIGVuZERhdGFMb2FkIGlmIG5vIHJlLWZldGNoIGlzIHJlcXVpcmVkCiAgICAgICAgICAgICAgICBkaXNwYXRjaCh1cGRhdGVTdHlsZU1ldGEobGF5ZXJJZCkpOwogICAgICAgICAgICAgICAgZGlzcGF0Y2goc3luY0RhdGFGb3JMYXllcihsYXllcklkKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94NCwgX3g1KSB7CiAgICAgICAgcmV0dXJuIF9yZWYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKQogICk7Cn0KCmZ1bmN0aW9uIHJlbW92ZVRyYWNrZWRMYXllclN0YXRlRm9yU2VsZWN0ZWRMYXllcigpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGxheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0U2VsZWN0ZWRMYXllcklkKShnZXRTdGF0ZSgpKTsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlJFTU9WRV9UUkFDS0VEX0xBWUVSX1NUQVRFLAogICAgICBsYXllcklkOiBsYXllcklkCiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiByZXBsYWNlTGF5ZXJMaXN0KG5ld0xheWVyTGlzdCkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0UmF3KShnZXRTdGF0ZSgpKS5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmMikgewogICAgICB2YXIgaWQgPSBfcmVmMi5pZDsKICAgICAgZGlzcGF0Y2gocmVtb3ZlTGF5ZXJGcm9tTGF5ZXJMaXN0KGlkKSk7CiAgICB9KTsKICAgIG5ld0xheWVyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChsYXllckRlc2NyaXB0b3IpIHsKICAgICAgZGlzcGF0Y2goYWRkTGF5ZXIobGF5ZXJEZXNjcmlwdG9yKSk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBjbG9uZUxheWVyKGxheWVySWQpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgICAgICB2YXIgbGF5ZXIsIGNsb25lZERlc2NyaXB0b3I7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGxheWVyID0gZ2V0TGF5ZXJCeUlkKGxheWVySWQsIGdldFN0YXRlKCkpOwoKICAgICAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyLmNsb25lRGVzY3JpcHRvcigpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBjbG9uZWREZXNjcmlwdG9yID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBkaXNwYXRjaChhZGRMYXllcihjbG9uZWREZXNjcmlwdG9yKSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3g2LCBfeDcpIHsKICAgICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKQogICk7Cn0KCmZ1bmN0aW9uIGFkZExheWVyKGxheWVyRGVzY3JpcHRvcikgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgaXNNYXBSZWFkeSA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRNYXBSZWFkeSkoZ2V0U3RhdGUoKSk7CgogICAgaWYgKCFpc01hcFJlYWR5KSB7CiAgICAgIGRpc3BhdGNoKHsKICAgICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuQUREX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUiwKICAgICAgICBsYXllcjogbGF5ZXJEZXNjcmlwdG9yCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuQUREX0xBWUVSLAogICAgICBsYXllcjogbGF5ZXJEZXNjcmlwdG9yCiAgICB9KTsKICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJEZXNjcmlwdG9yLmlkKSk7CiAgfTsKfSAvLyBEbyBub3QgdXNlIHdoZW4gcmVuZGVyaW5nIGEgbWFwLiBNZXRob2QgZXhpc3RzIHRvIGVuYWJsZSBzZWxlY3RvcnMgZm9yIGdldExheWVyTGlzdCB3aGVuCi8vIHJlbmRlcmluZyBpcyBub3QgbmVlZGVkLgoKCmZ1bmN0aW9uIGFkZExheWVyV2l0aG91dERhdGFTeW5jKGxheWVyRGVzY3JpcHRvcikgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuQUREX0xBWUVSLAogICAgbGF5ZXI6IGxheWVyRGVzY3JpcHRvcgogIH07Cn0KCmZ1bmN0aW9uIHNldExheWVyRGF0YUxvYWRFcnJvclN0YXR1cyhsYXllcklkLCBlcnJvck1lc3NhZ2UpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoKSB7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfTEFZRVJfRVJST1JfU1RBVFVTLAogICAgICBpc0luRXJyb3JTdGF0ZTogZXJyb3JNZXNzYWdlICE9PSBudWxsLAogICAgICBsYXllcklkOiBsYXllcklkLAogICAgICBlcnJvck1lc3NhZ2U6IGVycm9yTWVzc2FnZQogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gY2xlYW5Ub29sdGlwU3RhdGVGb3JMYXllcihsYXllcklkKSB7CiAgdmFyIGxheWVyRmVhdHVyZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IFtdOwogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgZmVhdHVyZXNSZW1vdmVkID0gZmFsc2U7CiAgICB2YXIgb3BlblRvb2x0aXBzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldE9wZW5Ub29sdGlwcykoZ2V0U3RhdGUoKSkubWFwKGZ1bmN0aW9uICh0b29sdGlwU3RhdGUpIHsKICAgICAgdmFyIG5leHRGZWF0dXJlcyA9IHRvb2x0aXBTdGF0ZS5mZWF0dXJlcy5maWx0ZXIoZnVuY3Rpb24gKHRvb2x0aXBGZWF0dXJlKSB7CiAgICAgICAgaWYgKHRvb2x0aXBGZWF0dXJlLmxheWVySWQgIT09IGxheWVySWQpIHsKICAgICAgICAgIC8vIGZlYXR1cmUgZnJvbSBhbm90aGVyIGxheWVyLCBrZWVwIGl0CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IC8vIEtlZXAgZmVhdHVyZSBpZiBpdCBpcyBzdGlsbCBpbiBsYXllcgoKCiAgICAgICAgcmV0dXJuIGxheWVyRmVhdHVyZXMuc29tZShmdW5jdGlvbiAobGF5ZXJGZWF0dXJlKSB7CiAgICAgICAgICByZXR1cm4gbGF5ZXJGZWF0dXJlLnByb3BlcnRpZXNbX2NvbnN0YW50cy5GRUFUVVJFX0lEX1BST1BFUlRZX05BTUVdID09PSB0b29sdGlwRmVhdHVyZS5pZDsKICAgICAgICB9KTsKICAgICAgfSk7CgogICAgICBpZiAodG9vbHRpcFN0YXRlLmZlYXR1cmVzLmxlbmd0aCAhPT0gbmV4dEZlYXR1cmVzLmxlbmd0aCkgewogICAgICAgIGZlYXR1cmVzUmVtb3ZlZCA9IHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0b29sdGlwU3RhdGUsIHsKICAgICAgICBmZWF0dXJlczogbmV4dEZlYXR1cmVzCiAgICAgIH0pOwogICAgfSkuZmlsdGVyKGZ1bmN0aW9uICh0b29sdGlwU3RhdGUpIHsKICAgICAgcmV0dXJuIHRvb2x0aXBTdGF0ZS5mZWF0dXJlcy5sZW5ndGggPiAwOwogICAgfSk7CgogICAgaWYgKGZlYXR1cmVzUmVtb3ZlZCkgewogICAgICBkaXNwYXRjaCh7CiAgICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9PUEVOX1RPT0xUSVBTLAogICAgICAgIG9wZW5Ub29sdGlwczogb3BlblRvb2x0aXBzCiAgICAgIH0pOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIHNldExheWVyVmlzaWJpbGl0eShsYXllcklkLCBtYWtlVmlzaWJsZSkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmNCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgICAgIHZhciBsYXllcjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgLy9pZiB0aGUgY3VycmVudC1zdGF0ZSBpcyBpbnZpc2libGUsIHdlIGFsc28gd2FudCB0byBzeW5jIGRhdGEKICAgICAgICAgICAgICAgIC8vZS5nLiBpZiBhIGxheWVyIHdhcyBpbnZpc2libGUgYXQgc3RhcnQtdXAsIGl0IHdvbid0IGhhdmUgYW55IGRhdGEgbG9hZGVkCiAgICAgICAgICAgICAgICBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsgLy8gSWYgdGhlIGxheWVyIHZpc2liaWxpdHkgaXMgYWxyZWFkeSB3aGF0IHdlIHdhbnQgaXQgdG8gYmUsIGRvIG5vdGhpbmcKCiAgICAgICAgICAgICAgICBpZiAoISghbGF5ZXIgfHwgbGF5ZXIuaXNWaXNpYmxlKCkgPT09IG1ha2VWaXNpYmxlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgaWYgKCFtYWtlVmlzaWJsZSkgewogICAgICAgICAgICAgICAgICBkaXNwYXRjaChjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyKGxheWVySWQpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goewogICAgICAgICAgICAgICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX0xBWUVSX1ZJU0lCSUxJVFksCiAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgIHZpc2liaWxpdHk6IG1ha2VWaXNpYmxlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgaWYgKG1ha2VWaXNpYmxlKSB7CiAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIobGF5ZXJJZCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94OCwgX3g5KSB7CiAgICAgICAgcmV0dXJuIF9yZWY0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkKICApOwp9CgpmdW5jdGlvbiB0b2dnbGVMYXllclZpc2libGUobGF5ZXJJZCkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmNSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgICAgIHZhciBsYXllciwgbWFrZVZpc2libGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGxheWVyID0gZ2V0TGF5ZXJCeUlkKGxheWVySWQsIGdldFN0YXRlKCkpOwoKICAgICAgICAgICAgICAgIGlmIChsYXllcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgbWFrZVZpc2libGUgPSAhbGF5ZXIuaXNWaXNpYmxlKCk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaChzZXRMYXllclZpc2liaWxpdHkobGF5ZXJJZCwgbWFrZVZpc2libGUpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDEwLCBfeDExKSB7CiAgICAgICAgcmV0dXJuIF9yZWY1LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkKICApOwp9CgpmdW5jdGlvbiBzZXRTZWxlY3RlZExheWVyKGxheWVySWQpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgICAgICB2YXIgb2xkU2VsZWN0ZWRMYXllcjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgb2xkU2VsZWN0ZWRMYXllciA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXRTZWxlY3RlZExheWVySWQpKGdldFN0YXRlKCkpOwoKICAgICAgICAgICAgICAgIGlmICghb2xkU2VsZWN0ZWRMYXllcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaChyb2xsYmFja1RvVHJhY2tlZExheWVyU3RhdGVGb3JTZWxlY3RlZExheWVyKCkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBpZiAobGF5ZXJJZCkgewogICAgICAgICAgICAgICAgICBkaXNwYXRjaCh0cmFja0N1cnJlbnRMYXllclN0YXRlKGxheWVySWQpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfU0VMRUNURURfTEFZRVIsCiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkTGF5ZXJJZDogbGF5ZXJJZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gxMiwgX3gxMykgewogICAgICAgIHJldHVybiBfcmVmNi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gcmVtb3ZlVHJhbnNpZW50TGF5ZXIoKSB7CiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWY3ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIHRyYW5zaWVudExheWVySWQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRyYW5zaWVudExheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0VHJhbnNpZW50TGF5ZXJJZCkoZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICAgICAgaWYgKCF0cmFuc2llbnRMYXllcklkKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKHJlbW92ZUxheWVyRnJvbUxheWVyTGlzdCh0cmFuc2llbnRMYXllcklkKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaChzZXRUcmFuc2llbnRMYXllcihudWxsKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gxNCwgX3gxNSkgewogICAgICAgIHJldHVybiBfcmVmNy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gc2V0VHJhbnNpZW50TGF5ZXIobGF5ZXJJZCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX1RSQU5TSUVOVF9MQVlFUiwKICAgIHRyYW5zaWVudExheWVySWQ6IGxheWVySWQKICB9Owp9CgpmdW5jdGlvbiBjbGVhclRyYW5zaWVudExheWVyU3RhdGVBbmRDbG9zZUZseW91dCgpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjggPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhkaXNwYXRjaCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goKDAsIF91aV9hY3Rpb25zLnVwZGF0ZUZseW91dCkoX3VpLkZMWU9VVF9TVEFURS5OT05FKSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaChzZXRTZWxlY3RlZExheWVyKG51bGwpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKHJlbW92ZVRyYW5zaWVudExheWVyKCkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94MTYpIHsKICAgICAgICByZXR1cm4gX3JlZjguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfTsKICAgIH0oKQogICk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyT3JkZXIobmV3TGF5ZXJPcmRlcikgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuVVBEQVRFX0xBWUVSX09SREVSLAogICAgbmV3TGF5ZXJPcmRlcjogbmV3TGF5ZXJPcmRlcgogIH07Cn0KCmZ1bmN0aW9uIG1hcFJlYWR5KCkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5NQVBfUkVBRFkKICAgIH0pOwogICAgKDAsIF9tYXBfc2VsZWN0b3JzLmdldFdhaXRpbmdGb3JNYXBSZWFkeUxheWVyTGlzdFJhdykoZ2V0U3RhdGUoKSkuZm9yRWFjaChmdW5jdGlvbiAobGF5ZXJEZXNjcmlwdG9yKSB7CiAgICAgIGRpc3BhdGNoKGFkZExheWVyKGxheWVyRGVzY3JpcHRvcikpOwogICAgfSk7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5DTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVAogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gbWFwRGVzdHJveWVkKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuTUFQX0RFU1RST1lFRAogIH07Cn0KCmZ1bmN0aW9uIG1hcEV4dGVudENoYW5nZWQobmV3TWFwQ29uc3RhbnRzKSB7CiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWY5ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIHN0YXRlLCBkYXRhRmlsdGVycywgZXh0ZW50LCBuZXdab29tLCBidWZmZXIsIGN1cnJlbnRab29tLCBkb2VzQnVmZmVyQ29udGFpbkV4dGVudCwgYnVmZmVyR2VvbWV0cnksIGV4dGVudEdlb21ldHJ5LCBzY2FsZUZhY3Rvciwgd2lkdGgsIGhlaWdodCwgbmV3RGF0YUZpbHRlcnM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHN0YXRlID0gZ2V0U3RhdGUoKTsKICAgICAgICAgICAgICAgIGRhdGFGaWx0ZXJzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShzdGF0ZSk7CiAgICAgICAgICAgICAgICBleHRlbnQgPSBuZXdNYXBDb25zdGFudHMuZXh0ZW50LCBuZXdab29tID0gbmV3TWFwQ29uc3RhbnRzLnpvb207CiAgICAgICAgICAgICAgICBidWZmZXIgPSBkYXRhRmlsdGVycy5idWZmZXIsIGN1cnJlbnRab29tID0gZGF0YUZpbHRlcnMuem9vbTsKCiAgICAgICAgICAgICAgICBpZiAoZXh0ZW50KSB7CiAgICAgICAgICAgICAgICAgIGRvZXNCdWZmZXJDb250YWluRXh0ZW50ID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICBpZiAoYnVmZmVyKSB7CiAgICAgICAgICAgICAgICAgICAgYnVmZmVyR2VvbWV0cnkgPSBfdHVyZi5kZWZhdWx0LmJib3hQb2x5Z29uKFtidWZmZXIubWluTG9uLCBidWZmZXIubWluTGF0LCBidWZmZXIubWF4TG9uLCBidWZmZXIubWF4TGF0XSk7CiAgICAgICAgICAgICAgICAgICAgZXh0ZW50R2VvbWV0cnkgPSBfdHVyZi5kZWZhdWx0LmJib3hQb2x5Z29uKFtleHRlbnQubWluTG9uLCBleHRlbnQubWluTGF0LCBleHRlbnQubWF4TG9uLCBleHRlbnQubWF4TGF0XSk7CiAgICAgICAgICAgICAgICAgICAgZG9lc0J1ZmZlckNvbnRhaW5FeHRlbnQgPSAoMCwgX2Jvb2xlYW5Db250YWlucy5kZWZhdWx0KShidWZmZXJHZW9tZXRyeSwgZXh0ZW50R2VvbWV0cnkpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoIWRvZXNCdWZmZXJDb250YWluRXh0ZW50IHx8IGN1cnJlbnRab29tICE9PSBuZXdab29tKSB7CiAgICAgICAgICAgICAgICAgICAgc2NhbGVGYWN0b3IgPSAwLjU7IC8vIFRPRE8gcHV0IHNjYWxlIGZhY3RvciBpbiBzdG9yZSBhbmQgZmV0Y2ggd2l0aCBzZWxlY3RvcgoKICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IGV4dGVudC5tYXhMb24gLSBleHRlbnQubWluTG9uOwogICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IGV4dGVudC5tYXhMYXQgLSBleHRlbnQubWluTGF0OwogICAgICAgICAgICAgICAgICAgIGRhdGFGaWx0ZXJzLmJ1ZmZlciA9IHsKICAgICAgICAgICAgICAgICAgICAgIG1pbkxvbjogZXh0ZW50Lm1pbkxvbiAtIHdpZHRoICogc2NhbGVGYWN0b3IsCiAgICAgICAgICAgICAgICAgICAgICBtaW5MYXQ6IGV4dGVudC5taW5MYXQgLSBoZWlnaHQgKiBzY2FsZUZhY3RvciwKICAgICAgICAgICAgICAgICAgICAgIG1heExvbjogZXh0ZW50Lm1heExvbiArIHdpZHRoICogc2NhbGVGYWN0b3IsCiAgICAgICAgICAgICAgICAgICAgICBtYXhMYXQ6IGV4dGVudC5tYXhMYXQgKyBoZWlnaHQgKiBzY2FsZUZhY3RvcgogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5NQVBfRVhURU5UX0NIQU5HRUQsCiAgICAgICAgICAgICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBkYXRhRmlsdGVycywge30sIG5ld01hcENvbnN0YW50cykKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbmV3RGF0YUZpbHRlcnMgPSBfb2JqZWN0U3ByZWFkKHt9LCBkYXRhRmlsdGVycywge30sIG5ld01hcENvbnN0YW50cyk7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3luY0RhdGFGb3JBbGxMYXllcnMoZGlzcGF0Y2gsIGdldFN0YXRlLCBuZXdEYXRhRmlsdGVycyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gxNywgX3gxOCkgewogICAgICAgIHJldHVybiBfcmVmOS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gY2xvc2VPbkNsaWNrVG9vbHRpcCh0b29sdGlwSWQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX09QRU5fVE9PTFRJUFMsCiAgICAgIG9wZW5Ub29sdGlwczogKDAsIF9tYXBfc2VsZWN0b3JzLmdldE9wZW5Ub29sdGlwcykoZ2V0U3RhdGUoKSkuZmlsdGVyKGZ1bmN0aW9uIChfcmVmMTApIHsKICAgICAgICB2YXIgaWQgPSBfcmVmMTAuaWQ7CiAgICAgICAgcmV0dXJuIHRvb2x0aXBJZCAhPT0gaWQ7CiAgICAgIH0pCiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvcGVuT25DbGlja1Rvb2x0aXAodG9vbHRpcFN0YXRlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBvcGVuVG9vbHRpcHMgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0T3BlblRvb2x0aXBzKShnZXRTdGF0ZSgpKS5maWx0ZXIoZnVuY3Rpb24gKF9yZWYxMSkgewogICAgICB2YXIgZmVhdHVyZXMgPSBfcmVmMTEuZmVhdHVyZXMsCiAgICAgICAgICBsb2NhdGlvbiA9IF9yZWYxMS5sb2NhdGlvbiwKICAgICAgICAgIGlzTG9ja2VkID0gX3JlZjExLmlzTG9ja2VkOwogICAgICByZXR1cm4gaXNMb2NrZWQgJiYgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGxvY2F0aW9uLCB0b29sdGlwU3RhdGUubG9jYXRpb24pICYmICFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChmZWF0dXJlcywgdG9vbHRpcFN0YXRlLmZlYXR1cmVzKTsKICAgIH0pOwogICAgb3BlblRvb2x0aXBzLnB1c2goX29iamVjdFNwcmVhZCh7fSwgdG9vbHRpcFN0YXRlLCB7CiAgICAgIGlzTG9ja2VkOiB0cnVlLAogICAgICBpZDogKDAsIF92LmRlZmF1bHQpKCkKICAgIH0pKTsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9PUEVOX1RPT0xUSVBTLAogICAgICBvcGVuVG9vbHRpcHM6IG9wZW5Ub29sdGlwcwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gY2xvc2VPbkhvdmVyVG9vbHRpcCgpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgaWYgKCgwLCBfbWFwX3NlbGVjdG9ycy5nZXRPcGVuVG9vbHRpcHMpKGdldFN0YXRlKCkpLmxlbmd0aCkgewogICAgICBkaXNwYXRjaCh7CiAgICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9PUEVOX1RPT0xUSVBTLAogICAgICAgIG9wZW5Ub29sdGlwczogW10KICAgICAgfSk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gb3Blbk9uSG92ZXJUb29sdGlwKHRvb2x0aXBTdGF0ZSkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX09QRU5fVE9PTFRJUFMsCiAgICBvcGVuVG9vbHRpcHM6IFtfb2JqZWN0U3ByZWFkKHt9LCB0b29sdGlwU3RhdGUsIHsKICAgICAgaXNMb2NrZWQ6IGZhbHNlLAogICAgICBpZDogKDAsIF92LmRlZmF1bHQpKCkKICAgIH0pXQogIH07Cn0KCmZ1bmN0aW9uIHNldE1vdXNlQ29vcmRpbmF0ZXMoX3JlZjEyKSB7CiAgdmFyIGxhdCA9IF9yZWYxMi5sYXQsCiAgICAgIGxvbiA9IF9yZWYxMi5sb247CiAgdmFyIHNhZmVMb24gPSBsb247CgogIGlmIChsb24gPiAxODApIHsKICAgIHZhciBvdmVybGFwV2VzdE9mRGF0ZUxpbmUgPSBsb24gLSAxODA7CiAgICBzYWZlTG9uID0gLTE4MCArIG92ZXJsYXBXZXN0T2ZEYXRlTGluZTsKICB9IGVsc2UgaWYgKGxvbiA8IC0xODApIHsKICAgIHZhciBvdmVybGFwRWFzdE9mRGF0ZUxpbmUgPSBNYXRoLmFicyhsb24pIC0gMTgwOwogICAgc2FmZUxvbiA9IDE4MCAtIG92ZXJsYXBFYXN0T2ZEYXRlTGluZTsKICB9CgogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX01PVVNFX0NPT1JESU5BVEVTLAogICAgbGF0OiBsYXQsCiAgICBsb246IHNhZmVMb24KICB9Owp9CgpmdW5jdGlvbiBjbGVhck1vdXNlQ29vcmRpbmF0ZXMoKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5DTEVBUl9NT1VTRV9DT09SRElOQVRFUwogIH07Cn0KCmZ1bmN0aW9uIGRpc2FibGVTY3JvbGxab29tKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX1NDUk9MTF9aT09NLAogICAgc2Nyb2xsWm9vbTogZmFsc2UKICB9Owp9CgpmdW5jdGlvbiBmaXRUb0xheWVyRXh0ZW50KGxheWVySWQpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjEzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIHRhcmdldExheWVyLCBkYXRhRmlsdGVycywgYm91bmRzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0YXJnZXRMYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgICAgICBpZiAoIXRhcmdldExheWVyKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGF0YUZpbHRlcnMgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0RGF0YUZpbHRlcnMpKGdldFN0YXRlKCkpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldExheWVyLmdldEJvdW5kcyhkYXRhRmlsdGVycyk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIGJvdW5kcyA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghYm91bmRzKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIGRpc3BhdGNoKHNldEdvdG9XaXRoQm91bmRzKGJvdW5kcykpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94MTksIF94MjApIHsKICAgICAgICByZXR1cm4gX3JlZjEzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkKICApOwp9CgpmdW5jdGlvbiBzZXRHb3RvV2l0aEJvdW5kcyhib3VuZHMpIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9HT1RPLAogICAgYm91bmRzOiBib3VuZHMKICB9Owp9CgpmdW5jdGlvbiBzZXRHb3RvV2l0aENlbnRlcihfcmVmMTQpIHsKICB2YXIgbGF0ID0gX3JlZjE0LmxhdCwKICAgICAgbG9uID0gX3JlZjE0LmxvbiwKICAgICAgem9vbSA9IF9yZWYxNC56b29tOwogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX0dPVE8sCiAgICBjZW50ZXI6IHsKICAgICAgbGF0OiBsYXQsCiAgICAgIGxvbjogbG9uLAogICAgICB6b29tOiB6b29tCiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gY2xlYXJHb3RvKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuQ0xFQVJfR09UTwogIH07Cn0KCmZ1bmN0aW9uIHN0YXJ0RGF0YUxvYWQobGF5ZXJJZCwgZGF0YUlkLCByZXF1ZXN0VG9rZW4pIHsKICB2YXIgbWV0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDoge307CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICBpZiAobGF5ZXIpIHsKICAgICAgZGlzcGF0Y2goKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy5jYW5jZWxSZXF1ZXN0KShsYXllci5nZXRQcmV2UmVxdWVzdFRva2VuKGRhdGFJZCkpKTsKICAgIH0KCiAgICB2YXIgZXZlbnRIYW5kbGVycyA9ICgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMuZ2V0RXZlbnRIYW5kbGVycykoZ2V0U3RhdGUoKSk7CgogICAgaWYgKGV2ZW50SGFuZGxlcnMgJiYgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkKSB7CiAgICAgIGV2ZW50SGFuZGxlcnMub25EYXRhTG9hZCh7CiAgICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgICBkYXRhSWQ6IGRhdGFJZAogICAgICB9KTsKICAgIH0KCiAgICBkaXNwYXRjaCh7CiAgICAgIG1ldGE6IG1ldGEsCiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5MQVlFUl9EQVRBX0xPQURfU1RBUlRFRCwKICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgZGF0YUlkOiBkYXRhSWQsCiAgICAgIHJlcXVlc3RUb2tlbjogcmVxdWVzdFRva2VuCiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiB1cGRhdGVTb3VyY2VEYXRhUmVxdWVzdChsYXllcklkLCBuZXdEYXRhKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCkgewogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuVVBEQVRFX1NPVVJDRV9EQVRBX1JFUVVFU1QsCiAgICAgIGRhdGFJZDogX2NvbnN0YW50cy5TT1VSQ0VfREFUQV9JRF9PUklHSU4sCiAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgIG5ld0RhdGE6IG5ld0RhdGEKICAgIH0pOwogICAgZGlzcGF0Y2godXBkYXRlU3R5bGVNZXRhKGxheWVySWQpKTsKICB9Owp9CgpmdW5jdGlvbiBlbmREYXRhTG9hZChsYXllcklkLCBkYXRhSWQsIHJlcXVlc3RUb2tlbiwgZGF0YSwgbWV0YSkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMTUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIGZlYXR1cmVzLCBldmVudEhhbmRsZXJzLCBsYXllciwgcmVzdWx0TWV0YTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGRpc3BhdGNoKCgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMudW5yZWdpc3RlckNhbmNlbENhbGxiYWNrKShyZXF1ZXN0VG9rZW4pKTsKICAgICAgICAgICAgICAgIGZlYXR1cmVzID0gZGF0YSAmJiBkYXRhLmZlYXR1cmVzID8gZGF0YS5mZWF0dXJlcyA6IFtdOwogICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycyA9ICgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMuZ2V0RXZlbnRIYW5kbGVycykoZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICAgICAgaWYgKGV2ZW50SGFuZGxlcnMgJiYgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkRW5kKSB7CiAgICAgICAgICAgICAgICAgIGxheWVyID0gZ2V0TGF5ZXJCeUlkKGxheWVySWQsIGdldFN0YXRlKCkpOwogICAgICAgICAgICAgICAgICByZXN1bHRNZXRhID0ge307CgogICAgICAgICAgICAgICAgICBpZiAobGF5ZXIgJiYgbGF5ZXIuZ2V0VHlwZSgpID09PSBfY29uc3RhbnRzLkxBWUVSX1RZUEUuVkVDVE9SKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWV0YS5mZWF0dXJlc0NvdW50ID0gZmVhdHVyZXMubGVuZ3RoOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBldmVudEhhbmRsZXJzLm9uRGF0YUxvYWRFbmQoewogICAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgICAgZGF0YUlkOiBkYXRhSWQsCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWV0YTogcmVzdWx0TWV0YQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwYXRjaChjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyKGxheWVySWQsIGZlYXR1cmVzKSk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5MQVlFUl9EQVRBX0xPQURfRU5ERUQsCiAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgIGRhdGFJZDogZGF0YUlkLAogICAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgICBtZXRhOiBtZXRhLAogICAgICAgICAgICAgICAgICByZXF1ZXN0VG9rZW46IHJlcXVlc3RUb2tlbgogICAgICAgICAgICAgICAgfSk7IC8vQ2xlYXIgYW55IGRhdGEtbG9hZCBlcnJvcnMgd2hlbiB0aGVyZSBpcyBhIHN1Y2Nlc2Z1bCBkYXRhIHJldHVybi4KICAgICAgICAgICAgICAgIC8vQ28gdGhpcyBvbiBlbmQtZGF0YS1sb2FkIGlzbyBhdCBzdGFydC1kYXRhLWxvYWQgdG8gYXZvaWQgYmxpcHBpbmcgdGhlIGVycm9yIHN0YXR1cyBiZXR3ZWVuIHRydWUvZmFsc2UuCiAgICAgICAgICAgICAgICAvL1RoaXMgYXZvaWRzIGppdHRlciBpbiB0aGUgd2FybmluZyBpY29uIG9mIHRoZSBUT0Mgd2hlbiB0aGUgcmVxdWVzdHMgY29udGludWVzIHRvIHJldHVybiBlcnJvcnMuCgogICAgICAgICAgICAgICAgZGlzcGF0Y2goc2V0TGF5ZXJEYXRhTG9hZEVycm9yU3RhdHVzKGxheWVySWQsIG51bGwpKTsKICAgICAgICAgICAgICAgIGRpc3BhdGNoKHVwZGF0ZVN0eWxlTWV0YShsYXllcklkKSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDIxLCBfeDIyKSB7CiAgICAgICAgcmV0dXJuIF9yZWYxNS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gb25EYXRhTG9hZEVycm9yKGxheWVySWQsIGRhdGFJZCwgcmVxdWVzdFRva2VuLCBlcnJvck1lc3NhZ2UpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjE2ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgICAgIHZhciBldmVudEhhbmRsZXJzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZGlzcGF0Y2goKDAsIF9ub25fc2VyaWFsaXphYmxlX2luc3RhbmNlcy51bnJlZ2lzdGVyQ2FuY2VsQ2FsbGJhY2spKHJlcXVlc3RUb2tlbikpOwogICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycyA9ICgwLCBfbm9uX3NlcmlhbGl6YWJsZV9pbnN0YW5jZXMuZ2V0RXZlbnRIYW5kbGVycykoZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICAgICAgaWYgKGV2ZW50SGFuZGxlcnMgJiYgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycy5vbkRhdGFMb2FkRXJyb3IoewogICAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgICAgZGF0YUlkOiBkYXRhSWQsCiAgICAgICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvck1lc3NhZ2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZGlzcGF0Y2goY2xlYW5Ub29sdGlwU3RhdGVGb3JMYXllcihsYXllcklkKSk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5MQVlFUl9EQVRBX0xPQURfRVJST1IsCiAgICAgICAgICAgICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgIGRhdGFJZDogZGF0YUlkLAogICAgICAgICAgICAgICAgICByZXF1ZXN0VG9rZW46IHJlcXVlc3RUb2tlbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaChzZXRMYXllckRhdGFMb2FkRXJyb3JTdGF0dXMobGF5ZXJJZCwgZXJyb3JNZXNzYWdlKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTExKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDIzLCBfeDI0KSB7CiAgICAgICAgcmV0dXJuIF9yZWYxNi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gdXBkYXRlU291cmNlUHJvcChsYXllcklkLCBwcm9wTmFtZSwgdmFsdWUsIG5ld0xheWVyVHlwZSkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMTcgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoZGlzcGF0Y2gpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGRpc3BhdGNoKHsKICAgICAgICAgICAgICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlVQREFURV9TT1VSQ0VfUFJPUCwKICAgICAgICAgICAgICAgICAgbGF5ZXJJZDogbGF5ZXJJZCwKICAgICAgICAgICAgICAgICAgcHJvcE5hbWU6IHByb3BOYW1lLAogICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgIG5ld0xheWVyVHlwZTogbmV3TGF5ZXJUeXBlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzKGxheWVySWQpKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgZGlzcGF0Y2goc3luY0RhdGFGb3JMYXllcihsYXllcklkKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDI1KSB7CiAgICAgICAgcmV0dXJuIF9yZWYxNy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gc3luY0RhdGFGb3JMYXllcihsYXllcklkKSB7CiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYxOCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMyhkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgICAgICB2YXIgdGFyZ2V0TGF5ZXIsIGRhdGFGaWx0ZXJzLCBsb2FkaW5nRnVuY3Rpb25zOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGFyZ2V0TGF5ZXIgPSBnZXRMYXllckJ5SWQobGF5ZXJJZCwgZ2V0U3RhdGUoKSk7CgogICAgICAgICAgICAgICAgaWYgKCF0YXJnZXRMYXllcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkYXRhRmlsdGVycyA9ICgwLCBfbWFwX3NlbGVjdG9ycy5nZXREYXRhRmlsdGVycykoZ2V0U3RhdGUoKSk7CiAgICAgICAgICAgICAgICBsb2FkaW5nRnVuY3Rpb25zID0gZ2V0TGF5ZXJMb2FkaW5nQ2FsbGJhY2tzKGRpc3BhdGNoLCBnZXRTdGF0ZSwgbGF5ZXJJZCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldExheWVyLnN5bmNEYXRhKF9vYmplY3RTcHJlYWQoe30sIGxvYWRpbmdGdW5jdGlvbnMsIHsKICAgICAgICAgICAgICAgICAgZGF0YUZpbHRlcnM6IGRhdGFGaWx0ZXJzCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzKTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDI2LCBfeDI3KSB7CiAgICAgICAgcmV0dXJuIF9yZWYxOC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gdXBkYXRlTGF5ZXJMYWJlbChpZCwgbmV3TGFiZWwpIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLlVQREFURV9MQVlFUl9QUk9QLAogICAgaWQ6IGlkLAogICAgcHJvcE5hbWU6ICdsYWJlbCcsCiAgICBuZXdWYWx1ZTogbmV3TGFiZWwKICB9Owp9CgpmdW5jdGlvbiB1cGRhdGVMYXllck1pblpvb20oaWQsIG1pblpvb20pIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLlVQREFURV9MQVlFUl9QUk9QLAogICAgaWQ6IGlkLAogICAgcHJvcE5hbWU6ICdtaW5ab29tJywKICAgIG5ld1ZhbHVlOiBtaW5ab29tCiAgfTsKfQoKZnVuY3Rpb24gdXBkYXRlTGF5ZXJNYXhab29tKGlkLCBtYXhab29tKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfUFJPUCwKICAgIGlkOiBpZCwKICAgIHByb3BOYW1lOiAnbWF4Wm9vbScsCiAgICBuZXdWYWx1ZTogbWF4Wm9vbQogIH07Cn0KCmZ1bmN0aW9uIHVwZGF0ZUxheWVyQWxwaGEoaWQsIGFscGhhKSB7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfUFJPUCwKICAgIGlkOiBpZCwKICAgIHByb3BOYW1lOiAnYWxwaGEnLAogICAgbmV3VmFsdWU6IGFscGhhCiAgfTsKfQoKZnVuY3Rpb24gc2V0TGF5ZXJRdWVyeShpZCwgcXVlcnkpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoKSB7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfUFJPUCwKICAgICAgaWQ6IGlkLAogICAgICBwcm9wTmFtZTogJ3F1ZXJ5JywKICAgICAgbmV3VmFsdWU6IHF1ZXJ5CiAgICB9KTsKICAgIGRpc3BhdGNoKHN5bmNEYXRhRm9yTGF5ZXIoaWQpKTsKICB9Owp9CgpmdW5jdGlvbiByZW1vdmVTZWxlY3RlZExheWVyKCkgewogIHJldHVybiBmdW5jdGlvbiAoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICB2YXIgc3RhdGUgPSBnZXRTdGF0ZSgpOwogICAgdmFyIGxheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0U2VsZWN0ZWRMYXllcklkKShzdGF0ZSk7CiAgICBkaXNwYXRjaChyZW1vdmVMYXllcihsYXllcklkKSk7CiAgfTsKfQoKZnVuY3Rpb24gcmVtb3ZlTGF5ZXIobGF5ZXJJZCkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMTkgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIHN0YXRlLCBzZWxlY3RlZExheWVySWQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBzdGF0ZSA9IGdldFN0YXRlKCk7CiAgICAgICAgICAgICAgICBzZWxlY3RlZExheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0U2VsZWN0ZWRMYXllcklkKShzdGF0ZSk7CgogICAgICAgICAgICAgICAgaWYgKCEobGF5ZXJJZCA9PT0gc2VsZWN0ZWRMYXllcklkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDE0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBkaXNwYXRjaCgoMCwgX3VpX2FjdGlvbnMudXBkYXRlRmx5b3V0KShfdWkuRkxZT1VUX1NUQVRFLk5PTkUpKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTQubmV4dCA9IDY7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlzcGF0Y2goc2V0U2VsZWN0ZWRMYXllcihudWxsKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIGRpc3BhdGNoKHJlbW92ZUxheWVyRnJvbUxheWVyTGlzdChsYXllcklkKSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE0KTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDI4LCBfeDI5KSB7CiAgICAgICAgcmV0dXJuIF9yZWYxOS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gcmVtb3ZlTGF5ZXJGcm9tTGF5ZXJMaXN0KGxheWVySWQpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgdmFyIGxheWVyR2V0dGluZ1JlbW92ZWQgPSBnZXRMYXllckJ5SWQobGF5ZXJJZCwgZ2V0U3RhdGUoKSk7CgogICAgaWYgKCFsYXllckdldHRpbmdSZW1vdmVkKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBsYXllckdldHRpbmdSZW1vdmVkLmdldEluRmxpZ2h0UmVxdWVzdFRva2VucygpLmZvckVhY2goZnVuY3Rpb24gKHJlcXVlc3RUb2tlbikgewogICAgICBkaXNwYXRjaCgoMCwgX25vbl9zZXJpYWxpemFibGVfaW5zdGFuY2VzLmNhbmNlbFJlcXVlc3QpKHJlcXVlc3RUb2tlbikpOwogICAgfSk7CiAgICBkaXNwYXRjaChjbGVhblRvb2x0aXBTdGF0ZUZvckxheWVyKGxheWVySWQpKTsKICAgIGxheWVyR2V0dGluZ1JlbW92ZWQuZGVzdHJveSgpOwogICAgZGlzcGF0Y2goewogICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuUkVNT1ZFX0xBWUVSLAogICAgICBpZDogbGF5ZXJJZAogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gc2V0UXVlcnkoX3JlZjIwKSB7CiAgdmFyIHF1ZXJ5ID0gX3JlZjIwLnF1ZXJ5LAogICAgICB0aW1lRmlsdGVycyA9IF9yZWYyMC50aW1lRmlsdGVycywKICAgICAgX3JlZjIwJGZpbHRlcnMgPSBfcmVmMjAuZmlsdGVycywKICAgICAgZmlsdGVycyA9IF9yZWYyMCRmaWx0ZXJzID09PSB2b2lkIDAgPyBbXSA6IF9yZWYyMCRmaWx0ZXJzLAogICAgICBfcmVmMjAkcmVmcmVzaCA9IF9yZWYyMC5yZWZyZXNoLAogICAgICByZWZyZXNoID0gX3JlZjIwJHJlZnJlc2ggPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjIwJHJlZnJlc2g7CgogIGZ1bmN0aW9uIGdlbmVyYXRlUXVlcnlUaW1lc3RhbXAoKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS50b0lTT1N0cmluZygpOwogIH0KCiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYyMSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgICAgICB2YXIgcHJldlF1ZXJ5LCBwcmV2VHJpZ2dlcmVkQXQsIGRhdGFGaWx0ZXJzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcHJldlF1ZXJ5ID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldFF1ZXJ5KShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgICAgIHByZXZUcmlnZ2VyZWRBdCA9IHByZXZRdWVyeSAmJiBwcmV2UXVlcnkucXVlcnlMYXN0VHJpZ2dlcmVkQXQgPyBwcmV2UXVlcnkucXVlcnlMYXN0VHJpZ2dlcmVkQXQgOiBnZW5lcmF0ZVF1ZXJ5VGltZXN0YW1wKCk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfUVVFUlksCiAgICAgICAgICAgICAgICAgIHRpbWVGaWx0ZXJzOiB0aW1lRmlsdGVycywKICAgICAgICAgICAgICAgICAgcXVlcnk6IF9vYmplY3RTcHJlYWQoe30sIHF1ZXJ5LCB7CiAgICAgICAgICAgICAgICAgICAgLy8gZW5zdXJlIHF1ZXJ5IGNoYW5nZXMgdG8gdHJpZ2dlciByZS1mZXRjaCB3aGVuICJSZWZyZXNoIiBjbGlja2VkCiAgICAgICAgICAgICAgICAgICAgcXVlcnlMYXN0VHJpZ2dlcmVkQXQ6IHJlZnJlc2ggPyBnZW5lcmF0ZVF1ZXJ5VGltZXN0YW1wKCkgOiBwcmV2VHJpZ2dlcmVkQXQKICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnMKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgZGF0YUZpbHRlcnMgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0RGF0YUZpbHRlcnMpKGdldFN0YXRlKCkpOwogICAgICAgICAgICAgICAgX2NvbnRleHQxNS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBzeW5jRGF0YUZvckFsbExheWVycyhkaXNwYXRjaCwgZ2V0U3RhdGUsIGRhdGFGaWx0ZXJzKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTUpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94MzAsIF94MzEpIHsKICAgICAgICByZXR1cm4gX3JlZjIxLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkKICApOwp9CgpmdW5jdGlvbiBzZXRSZWZyZXNoQ29uZmlnKF9yZWYyMikgewogIHZhciBpc1BhdXNlZCA9IF9yZWYyMi5pc1BhdXNlZCwKICAgICAgaW50ZXJ2YWwgPSBfcmVmMjIuaW50ZXJ2YWw7CiAgcmV0dXJuIHsKICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfUkVGUkVTSF9DT05GSUcsCiAgICBpc1BhdXNlZDogaXNQYXVzZWQsCiAgICBpbnRlcnZhbDogaW50ZXJ2YWwKICB9Owp9CgpmdW5jdGlvbiB0cmlnZ2VyUmVmcmVzaFRpbWVyKCkgewogIHJldHVybiAoCiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMjMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTYoZGlzcGF0Y2gsIGdldFN0YXRlKSB7CiAgICAgICAgdmFyIGRhdGFGaWx0ZXJzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTYkKF9jb250ZXh0MTYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuVFJJR0dFUl9SRUZSRVNIX1RJTUVSCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGRhdGFGaWx0ZXJzID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldERhdGFGaWx0ZXJzKShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTYubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gc3luY0RhdGFGb3JBbGxMYXllcnMoZGlzcGF0Y2gsIGdldFN0YXRlLCBkYXRhRmlsdGVycyk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE2KTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDMyLCBfeDMzKSB7CiAgICAgICAgcmV0dXJuIF9yZWYyMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gY2xlYXJNaXNzaW5nU3R5bGVQcm9wZXJ0aWVzKGxheWVySWQpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjI0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgICAgIHZhciB0YXJnZXRMYXllciwgc3R5bGUsIG5leHRGaWVsZHMsIF9zdHlsZSRnZXREZXNjcmlwdG9yVywgaGFzQ2hhbmdlcywgbmV4dFN0eWxlRGVzY3JpcHRvcjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxNykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0YXJnZXRMYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0TGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgc3R5bGUgPSB0YXJnZXRMYXllci5nZXRDdXJyZW50U3R5bGUoKTsKCiAgICAgICAgICAgICAgICBpZiAoc3R5bGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgX2NvbnRleHQxNy5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXRMYXllci5nZXRGaWVsZHMoKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgbmV4dEZpZWxkcyA9IF9jb250ZXh0MTcuc2VudDsKICAgICAgICAgICAgICAgIC8vdGFrZSBpbnRvIGFjY291bnQgYWxsIGZpZWxkcywgc2luY2UgbGFiZWxzIGNhbiBiZSBkcml2ZW4gYnkgYW55IGZpZWxkIChzb3VyY2Ugb3Igam9pbikKICAgICAgICAgICAgICAgIF9zdHlsZSRnZXREZXNjcmlwdG9yVyA9IHN0eWxlLmdldERlc2NyaXB0b3JXaXRoTWlzc2luZ1N0eWxlUHJvcHNSZW1vdmVkKG5leHRGaWVsZHMpLCBoYXNDaGFuZ2VzID0gX3N0eWxlJGdldERlc2NyaXB0b3JXLmhhc0NoYW5nZXMsIG5leHRTdHlsZURlc2NyaXB0b3IgPSBfc3R5bGUkZ2V0RGVzY3JpcHRvclcubmV4dFN0eWxlRGVzY3JpcHRvcjsKCiAgICAgICAgICAgICAgICBpZiAoaGFzQ2hhbmdlcykgewogICAgICAgICAgICAgICAgICBkaXNwYXRjaCh1cGRhdGVMYXllclN0eWxlKGxheWVySWQsIG5leHRTdHlsZURlc2NyaXB0b3IpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE3KTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDM0LCBfeDM1KSB7CiAgICAgICAgcmV0dXJuIF9yZWYyNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gdXBkYXRlTGF5ZXJTdHlsZShsYXllcklkLCBzdHlsZURlc2NyaXB0b3IpIHsKICByZXR1cm4gZnVuY3Rpb24gKGRpc3BhdGNoKSB7CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfU1RZTEUsCiAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgIHN0eWxlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdHlsZURlc2NyaXB0b3IpCiAgICB9KTsgLy8gRW5zdXJlIHVwZGF0ZVN0eWxlTWV0YSBpcyB0cmlnZ2VyZWQKICAgIC8vIHN5bmNEYXRhRm9yTGF5ZXIgbWF5IG5vdCB0cmlnZ2VyIGVuZERhdGFMb2FkIGlmIG5vIHJlLWZldGNoIGlzIHJlcXVpcmVkCgogICAgZGlzcGF0Y2godXBkYXRlU3R5bGVNZXRhKGxheWVySWQpKTsgLy8gU3R5bGUgdXBkYXRlIG1heSByZXF1aXJlIHJlLWZldGNoLCBmb3IgZXhhbXBsZSBFUyBzZWFyY2ggbWF5IG5lZWQgdG8gcmV0cmlldmUgZmllbGQgdXNlZCBmb3IgZHluYW1pYyBzdHlsaW5nCgogICAgZGlzcGF0Y2goc3luY0RhdGFGb3JMYXllcihsYXllcklkKSk7CiAgfTsKfQoKZnVuY3Rpb24gdXBkYXRlU3R5bGVNZXRhKGxheWVySWQpIHsKICByZXR1cm4gKAogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjI1ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE4KGRpc3BhdGNoLCBnZXRTdGF0ZSkgewogICAgICAgIHZhciBsYXllciwgc291cmNlRGF0YVJlcXVlc3QsIHN0eWxlLCBzdHlsZU1ldGE7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQxOCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBsYXllciA9IGdldExheWVyQnlJZChsYXllcklkLCBnZXRTdGF0ZSgpKTsKCiAgICAgICAgICAgICAgICBpZiAobGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxOC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgc291cmNlRGF0YVJlcXVlc3QgPSBsYXllci5nZXRTb3VyY2VEYXRhUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgc3R5bGUgPSBsYXllci5nZXRDdXJyZW50U3R5bGUoKTsKCiAgICAgICAgICAgICAgICBpZiAoISghc3R5bGUgfHwgIXNvdXJjZURhdGFSZXF1ZXN0KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDE4Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHN0eWxlLnBsdWNrU3R5bGVNZXRhRnJvbVNvdXJjZURhdGFSZXF1ZXN0KHNvdXJjZURhdGFSZXF1ZXN0KTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgc3R5bGVNZXRhID0gX2NvbnRleHQxOC5zZW50OwogICAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgICB0eXBlOiBfbWFwX2FjdGlvbnMuU0VUX0xBWUVSX1NUWUxFX01FVEEsCiAgICAgICAgICAgICAgICAgIGxheWVySWQ6IGxheWVySWQsCiAgICAgICAgICAgICAgICAgIHN0eWxlTWV0YTogc3R5bGVNZXRhCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTE4KTsKICAgICAgfSkpOwoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeDM2LCBfeDM3KSB7CiAgICAgICAgcmV0dXJuIF9yZWYyNS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpCiAgKTsKfQoKZnVuY3Rpb24gdXBkYXRlTGF5ZXJTdHlsZUZvclNlbGVjdGVkTGF5ZXIoc3R5bGVEZXNjcmlwdG9yKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBzZWxlY3RlZExheWVySWQgPSAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0U2VsZWN0ZWRMYXllcklkKShnZXRTdGF0ZSgpKTsKCiAgICBpZiAoIXNlbGVjdGVkTGF5ZXJJZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgZGlzcGF0Y2godXBkYXRlTGF5ZXJTdHlsZShzZWxlY3RlZExheWVySWQsIHN0eWxlRGVzY3JpcHRvcikpOwogIH07Cn0KCmZ1bmN0aW9uIHNldEpvaW5zRm9yTGF5ZXIobGF5ZXIsIGpvaW5zKSB7CiAgcmV0dXJuICgKICAgIC8qI19fUFVSRV9fKi8KICAgIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZWYyNiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOShkaXNwYXRjaCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTkkKF9jb250ZXh0MTkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfSk9JTlMsCiAgICAgICAgICAgICAgICAgIGxheWVyOiBsYXllciwKICAgICAgICAgICAgICAgICAgam9pbnM6IGpvaW5zCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX2NvbnRleHQxOS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBkaXNwYXRjaChjbGVhck1pc3NpbmdTdHlsZVByb3BlcnRpZXMobGF5ZXIuZ2V0SWQoKSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBkaXNwYXRjaChzeW5jRGF0YUZvckxheWVyKGxheWVyLmdldElkKCkpKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTkpOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gKF94MzgpIHsKICAgICAgICByZXR1cm4gX3JlZjI2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCkKICApOwp9CgpmdW5jdGlvbiB1cGRhdGVEcmF3U3RhdGUoZHJhd1N0YXRlKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCkgewogICAgaWYgKGRyYXdTdGF0ZSAhPT0gbnVsbCkgewogICAgICBkaXNwYXRjaCh7CiAgICAgICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9PUEVOX1RPT0xUSVBTLAogICAgICAgIG9wZW5Ub29sdGlwczogW10KICAgICAgfSk7IC8vIHRvb2x0aXBzIGp1c3QgZ2V0IGluIHRoZSB3YXkKICAgIH0KCiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5VUERBVEVfRFJBV19TVEFURSwKICAgICAgZHJhd1N0YXRlOiBkcmF3U3RhdGUKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIGRpc2FibGVJbnRlcmFjdGl2ZSgpIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLlNFVF9JTlRFUkFDVElWRSwKICAgIGRpc2FibGVJbnRlcmFjdGl2ZTogdHJ1ZQogIH07Cn0KCmZ1bmN0aW9uIGRpc2FibGVUb29sdGlwQ29udHJvbCgpIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLkRJU0FCTEVfVE9PTFRJUF9DT05UUk9MLAogICAgZGlzYWJsZVRvb2x0aXBDb250cm9sOiB0cnVlCiAgfTsKfQoKZnVuY3Rpb24gaGlkZVRvb2xiYXJPdmVybGF5KCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuSElERV9UT09MQkFSX09WRVJMQVksCiAgICBoaWRlVG9vbGJhck92ZXJsYXk6IHRydWUKICB9Owp9CgpmdW5jdGlvbiBoaWRlTGF5ZXJDb250cm9sKCkgewogIHJldHVybiB7CiAgICB0eXBlOiBfbWFwX2FjdGlvbnMuSElERV9MQVlFUl9DT05UUk9MLAogICAgaGlkZUxheWVyQ29udHJvbDogdHJ1ZQogIH07Cn0KCmZ1bmN0aW9uIGhpZGVWaWV3Q29udHJvbCgpIHsKICByZXR1cm4gewogICAgdHlwZTogX21hcF9hY3Rpb25zLkhJREVfVklFV19DT05UUk9MLAogICAgaGlkZVZpZXdDb250cm9sOiB0cnVlCiAgfTsKfQoKZnVuY3Rpb24gc2V0SGlkZGVuTGF5ZXJzKGhpZGRlbkxheWVySWRzKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChkaXNwYXRjaCwgZ2V0U3RhdGUpIHsKICAgIHZhciBpc01hcFJlYWR5ID0gKDAsIF9tYXBfc2VsZWN0b3JzLmdldE1hcFJlYWR5KShnZXRTdGF0ZSgpKTsKCiAgICBpZiAoIWlzTWFwUmVhZHkpIHsKICAgICAgZGlzcGF0Y2goewogICAgICAgIHR5cGU6IF9tYXBfYWN0aW9ucy5TRVRfV0FJVElOR19GT1JfUkVBRFlfSElEREVOX0xBWUVSUywKICAgICAgICBoaWRkZW5MYXllcklkczogaGlkZGVuTGF5ZXJJZHMKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAoMCwgX21hcF9zZWxlY3RvcnMuZ2V0TGF5ZXJMaXN0UmF3KShnZXRTdGF0ZSgpKS5mb3JFYWNoKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgIHJldHVybiBkaXNwYXRjaChzZXRMYXllclZpc2liaWxpdHkobGF5ZXIuaWQsICFoaWRkZW5MYXllcklkcy5pbmNsdWRlcyhsYXllci5pZCkpKTsKICAgICAgfSk7CiAgICB9CiAgfTsKfQ=="},null]}