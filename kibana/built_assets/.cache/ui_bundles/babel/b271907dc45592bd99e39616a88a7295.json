{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/cross_cluster_replication/public/np_ready/app/components/auto_follow_pattern_form.js","dependencies":[{"path":"x-pack/legacy/plugins/cross_cluster_replication/public/np_ready/app/components/auto_follow_pattern_form.js","mtime":1589249552183},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSA9IGV4cG9ydHMudXBkYXRlRm9ybUVycm9ycyA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJwcm9wLXR5cGVzIikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMvZXNfdWlfc2hhcmVkL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCnZhciBfcm91dGluZyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi4vc2VydmljZXMvcm91dGluZyIpKTsKCnZhciBfcXVlcnlfcGFyYW1zID0gcmVxdWlyZSgiLi4vc2VydmljZXMvcXVlcnlfcGFyYW1zIik7Cgp2YXIgX2dldF9yZW1vdGVfY2x1c3Rlcl9uYW1lID0gcmVxdWlyZSgiLi4vc2VydmljZXMvZ2V0X3JlbW90ZV9jbHVzdGVyX25hbWUiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vY29uc3RhbnRzIik7Cgp2YXIgX3NlY3Rpb25fZXJyb3IgPSByZXF1aXJlKCIuL3NlY3Rpb25fZXJyb3IiKTsKCnZhciBfYXV0b19mb2xsb3dfcGF0dGVybl9pbmRpY2VzX3ByZXZpZXcgPSByZXF1aXJlKCIuL2F1dG9fZm9sbG93X3BhdHRlcm5faW5kaWNlc19wcmV2aWV3Iik7Cgp2YXIgX3JlbW90ZV9jbHVzdGVyc19mb3JtX2ZpZWxkID0gcmVxdWlyZSgiLi9yZW1vdGVfY2x1c3RlcnNfZm9ybV9maWVsZCIpOwoKdmFyIF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMgPSByZXF1aXJlKCIuLi9zZXJ2aWNlcy9hdXRvX2ZvbGxvd19wYXR0ZXJuX3ZhbGlkYXRvcnMiKTsKCnZhciBfYXV0b19mb2xsb3dfcGF0dGVybl9yZXF1ZXN0X2ZseW91dCA9IHJlcXVpcmUoIi4vYXV0b19mb2xsb3dfcGF0dGVybl9yZXF1ZXN0X2ZseW91dCIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNvdXJjZSwgZXhjbHVkZWQpIHsgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307IHZhciB0YXJnZXQgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKTsgdmFyIGtleSwgaTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHNvdXJjZVN5bWJvbEtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHNvdXJjZSk7IGZvciAoaSA9IDA7IGkgPCBzb3VyY2VTeW1ib2xLZXlzLmxlbmd0aDsgaSsrKSB7IGtleSA9IHNvdXJjZVN5bWJvbEtleXNbaV07IGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7IGlmICghT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHNvdXJjZSwga2V5KSkgY29udGludWU7IHRhcmdldFtrZXldID0gc291cmNlW2tleV07IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7IGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OyB2YXIgdGFyZ2V0ID0ge307IHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsgdmFyIGtleSwgaTsgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsga2V5ID0gc291cmNlS2V5c1tpXTsgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsgfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsgYXJyMltpXSA9IGFycltpXTsgfSByZXR1cm4gYXJyMjsgfSB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIGluZGV4UGF0dGVybklsbGVnYWxDaGFyYWN0ZXJzID0gX3B1YmxpYzIuaW5kZXhQYXR0ZXJucy5JTExFR0FMX0NIQVJBQ1RFUlNfVklTSUJMRS5qb2luKCcgJyk7Cgp2YXIgaW5kZXhOYW1lSWxsZWdhbENoYXJhY3RlcnMgPSBfcHVibGljLmluZGljZXMuSU5ERVhfSUxMRUdBTF9DSEFSQUNURVJTX1ZJU0lCTEUuam9pbignICcpOwoKdmFyIGdldEVtcHR5QXV0b0ZvbGxvd1BhdHRlcm4gPSBmdW5jdGlvbiBnZXRFbXB0eUF1dG9Gb2xsb3dQYXR0ZXJuKCkgewogIHZhciByZW1vdGVDbHVzdGVyTmFtZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CiAgcmV0dXJuIHsKICAgIG5hbWU6ICcnLAogICAgcmVtb3RlQ2x1c3RlcjogcmVtb3RlQ2x1c3Rlck5hbWUsCiAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiBbXSwKICAgIGZvbGxvd0luZGV4UGF0dGVyblByZWZpeDogJycsCiAgICBmb2xsb3dJbmRleFBhdHRlcm5TdWZmaXg6ICcnCiAgfTsKfTsKCnZhciB1cGRhdGVGb3JtRXJyb3JzID0gZnVuY3Rpb24gdXBkYXRlRm9ybUVycm9ycyhlcnJvcnMsIGV4aXN0aW5nRXJyb3JzKSB7CiAgcmV0dXJuIHsKICAgIGZpZWxkc0Vycm9yczogX29iamVjdFNwcmVhZCh7fSwgZXhpc3RpbmdFcnJvcnMsIHt9LCBlcnJvcnMpCiAgfTsKfTsKCmV4cG9ydHMudXBkYXRlRm9ybUVycm9ycyA9IHVwZGF0ZUZvcm1FcnJvcnM7Cgp2YXIgQXV0b0ZvbGxvd1BhdHRlcm5Gb3JtID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX1B1cmVDb21wb25lbnQpIHsKICBfaW5oZXJpdHMoQXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLCBfUHVyZUNvbXBvbmVudCk7CgogIGZ1bmN0aW9uIEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybShwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBdXRvRm9sbG93UGF0dGVybkZvcm0pOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSkuY2FsbCh0aGlzLCBwcm9wcykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInRvZ2dsZVJlcXVlc3QiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIGlzUmVxdWVzdFZpc2libGUgPSBfcmVmLmlzUmVxdWVzdFZpc2libGU7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGlzUmVxdWVzdFZpc2libGU6ICFpc1JlcXVlc3RWaXNpYmxlCiAgICAgICAgfTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkZpZWxkc0NoYW5nZSIsIGZ1bmN0aW9uIChmaWVsZHMpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWYyKSB7CiAgICAgICAgdmFyIGF1dG9Gb2xsb3dQYXR0ZXJuID0gX3JlZjIuYXV0b0ZvbGxvd1BhdHRlcm47CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGF1dG9Gb2xsb3dQYXR0ZXJuOiBfb2JqZWN0U3ByZWFkKHt9LCBhdXRvRm9sbG93UGF0dGVybiwge30sIGZpZWxkcykKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIHZhciBlcnJvcnMgPSAoMCwgX2F1dG9fZm9sbG93X3BhdHRlcm5fdmFsaWRhdG9ycy52YWxpZGF0ZUF1dG9Gb2xsb3dQYXR0ZXJuKShmaWVsZHMpOwoKICAgICAgX3RoaXMub25GaWVsZHNFcnJvckNoYW5nZShlcnJvcnMpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZHNFcnJvckNoYW5nZSIsIGZ1bmN0aW9uIChlcnJvcnMpIHsKICAgICAgcmV0dXJuIF90aGlzLnNldFN0YXRlKGZ1bmN0aW9uIChfcmVmMykgewogICAgICAgIHZhciBmaWVsZHNFcnJvcnMgPSBfcmVmMy5maWVsZHNFcnJvcnM7CiAgICAgICAgcmV0dXJuIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzLCBmaWVsZHNFcnJvcnMpOwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2x1c3RlckNoYW5nZSIsIGZ1bmN0aW9uIChyZW1vdGVDbHVzdGVyKSB7CiAgICAgIF90aGlzLm9uRmllbGRzQ2hhbmdlKHsKICAgICAgICByZW1vdGVDbHVzdGVyOiByZW1vdGVDbHVzdGVyCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25DcmVhdGVMZWFkZXJJbmRleFBhdHRlcm4iLCBmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgIHZhciBlcnJvciA9ICgwLCBfYXV0b19mb2xsb3dfcGF0dGVybl92YWxpZGF0b3JzLnZhbGlkYXRlTGVhZGVySW5kZXhQYXR0ZXJuKShpbmRleFBhdHRlcm4pOwoKICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgdmFyIGVycm9ycyA9IHsKICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IF9vYmplY3RTcHJlYWQoe30sIGVycm9yLCB7CiAgICAgICAgICAgIGFsd2F5c1Zpc2libGU6IHRydWUKICAgICAgICAgIH0pCiAgICAgICAgfTsKCiAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWY0KSB7CiAgICAgICAgICB2YXIgZmllbGRzRXJyb3JzID0gX3JlZjQuZmllbGRzRXJyb3JzOwogICAgICAgICAgcmV0dXJuIHVwZGF0ZUZvcm1FcnJvcnMoZXJyb3JzLCBmaWVsZHNFcnJvcnMpOwogICAgICAgIH0pOyAvLyBSZXR1cm4gZmFsc2UgdG8gZXhwbGljaXRseSByZWplY3QgdGhlIHVzZXIncyBpbnB1dC4KCgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGxlYWRlckluZGV4UGF0dGVybnMgPSBfdGhpcy5zdGF0ZS5hdXRvRm9sbG93UGF0dGVybi5sZWFkZXJJbmRleFBhdHRlcm5zOwogICAgICB2YXIgbmV3TGVhZGVySW5kZXhQYXR0ZXJucyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobGVhZGVySW5kZXhQYXR0ZXJucyksIFtpbmRleFBhdHRlcm5dKTsKCiAgICAgIF90aGlzLm9uRmllbGRzQ2hhbmdlKHsKICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zOiBuZXdMZWFkZXJJbmRleFBhdHRlcm5zCiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25MZWFkZXJJbmRleFBhdHRlcm5DaGFuZ2UiLCBmdW5jdGlvbiAoaW5kZXhQYXR0ZXJucykgewogICAgICBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgbGVhZGVySW5kZXhQYXR0ZXJuczogaW5kZXhQYXR0ZXJucy5tYXAoZnVuY3Rpb24gKF9yZWY1KSB7CiAgICAgICAgICB2YXIgbGFiZWwgPSBfcmVmNS5sYWJlbDsKICAgICAgICAgIHJldHVybiBsYWJlbDsKICAgICAgICB9KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uTGVhZGVySW5kZXhQYXR0ZXJuSW5wdXRDaGFuZ2UiLCBmdW5jdGlvbiAobGVhZGVySW5kZXhQYXR0ZXJuKSB7CiAgICAgIHZhciBpc0VtcHR5ID0gIWxlYWRlckluZGV4UGF0dGVybiB8fCAhbGVhZGVySW5kZXhQYXR0ZXJuLnRyaW0oKTsKICAgICAgdmFyIGxlYWRlckluZGV4UGF0dGVybnMgPSBfdGhpcy5zdGF0ZS5hdXRvRm9sbG93UGF0dGVybi5sZWFkZXJJbmRleFBhdHRlcm5zOwoKICAgICAgaWYgKCFpc0VtcHR5ICYmIGxlYWRlckluZGV4UGF0dGVybnMuaW5jbHVkZXMobGVhZGVySW5kZXhQYXR0ZXJuKSkgewogICAgICAgIHZhciBlcnJvck1zZyA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0ubGVhZGVySW5kZXhQYXR0ZXJuRXJyb3IuZHVwbGljYXRlTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRHVwbGljYXRlIGxlYWRlciBpbmRleCBwYXR0ZXJuIGFyZW4ndCBhbGxvd2VkLiIKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGVycm9ycyA9IHsKICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IHsKICAgICAgICAgICAgbWVzc2FnZTogZXJyb3JNc2csCiAgICAgICAgICAgIGFsd2F5c1Zpc2libGU6IHRydWUKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBfdGhpcy5zZXRTdGF0ZShmdW5jdGlvbiAoX3JlZjYpIHsKICAgICAgICAgIHZhciBmaWVsZHNFcnJvcnMgPSBfcmVmNi5maWVsZHNFcnJvcnM7CiAgICAgICAgICByZXR1cm4gdXBkYXRlRm9ybUVycm9ycyhlcnJvcnMsIGZpZWxkc0Vycm9ycyk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoZnVuY3Rpb24gKF9yZWY3KSB7CiAgICAgICAgICB2YXIgZmllbGRzRXJyb3JzID0gX3JlZjcuZmllbGRzRXJyb3JzLAogICAgICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnMgPSBfcmVmNy5hdXRvRm9sbG93UGF0dGVybi5sZWFkZXJJbmRleFBhdHRlcm5zOwogICAgICAgICAgdmFyIGVycm9ycyA9IEJvb2xlYW4obGVhZGVySW5kZXhQYXR0ZXJucy5sZW5ndGgpID8gLy8gVmFsaWRhdGUgZXhpc3RpbmcgcGF0dGVybnMsIHNvIHdlIGNhbiBzdXJmYWNlIGFuIGVycm9yIGlmIHRoaXMgcmVxdWlyZWQgaW5wdXQgaXMgbWlzc2luZy4KICAgICAgICAgICgwLCBfYXV0b19mb2xsb3dfcGF0dGVybl92YWxpZGF0b3JzLnZhbGlkYXRlQXV0b0ZvbGxvd1BhdHRlcm4pKHsKICAgICAgICAgICAgbGVhZGVySW5kZXhQYXR0ZXJuczogbGVhZGVySW5kZXhQYXR0ZXJucwogICAgICAgICAgfSkgOiAvLyBWYWxpZGF0ZSB0aGUgaW5wdXQgYXMgdGhlIHVzZXIgdHlwZXMgc28gdGhleSBoYXZlIGltbWVkaWF0ZSBmZWVkYmFjayBhYm91dCBlcnJvcnMuCiAgICAgICAgICAoMCwgX2F1dG9fZm9sbG93X3BhdHRlcm5fdmFsaWRhdG9ycy52YWxpZGF0ZUF1dG9Gb2xsb3dQYXR0ZXJuKSh7CiAgICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IFtsZWFkZXJJbmRleFBhdHRlcm5dCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiB1cGRhdGVGb3JtRXJyb3JzKGVycm9ycywgZmllbGRzRXJyb3JzKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0RmllbGRzIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgc3RhdGVGaWVsZHMgPSBfdGhpcy5zdGF0ZS5hdXRvRm9sbG93UGF0dGVybjsKCiAgICAgIHZhciBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXggPSBzdGF0ZUZpZWxkcy5mb2xsb3dJbmRleFBhdHRlcm5QcmVmaXgsCiAgICAgICAgICBmb2xsb3dJbmRleFBhdHRlcm5TdWZmaXggPSBzdGF0ZUZpZWxkcy5mb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgsCiAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHN0YXRlRmllbGRzLCBbImZvbGxvd0luZGV4UGF0dGVyblByZWZpeCIsICJmb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgiXSk7CgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcmVzdCwgewogICAgICAgIGZvbGxvd0luZGV4UGF0dGVybjogIiIuY29uY2F0KGZvbGxvd0luZGV4UGF0dGVyblByZWZpeCwgInt7bGVhZGVyX2luZGV4fX0iKS5jb25jYXQoZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4KQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlbmRGb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXNGb3JtVmFsaWQgPSBfdGhpcy5pc0Zvcm1WYWxpZCgpOwoKICAgICAgaWYgKCFpc0Zvcm1WYWxpZCkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGFyZUVycm9yc1Zpc2libGU6IHRydWUKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgYXJlRXJyb3JzVmlzaWJsZTogZmFsc2UKICAgICAgfSk7CgogICAgICB2YXIgX3RoaXMkZ2V0RmllbGRzID0gX3RoaXMuZ2V0RmllbGRzKCksCiAgICAgICAgICBuYW1lID0gX3RoaXMkZ2V0RmllbGRzLm5hbWUsCiAgICAgICAgICBhdXRvRm9sbG93UGF0dGVybiA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfdGhpcyRnZXRGaWVsZHMsIFsibmFtZSJdKTsKCiAgICAgIF90aGlzLnByb3BzLnNhdmVBdXRvRm9sbG93UGF0dGVybihuYW1lLCBhdXRvRm9sbG93UGF0dGVybik7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjYW5jZWxGb3JtIiwgZnVuY3Rpb24gKCkgewogICAgICBfcm91dGluZy5kZWZhdWx0Lm5hdmlnYXRlKCcvYXV0b19mb2xsb3dfcGF0dGVybnMnKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlckZvcm0iLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgX3RoaXMkc3RhdGUkYXV0b0ZvbGxvID0gX3RoaXMkc3RhdGUuYXV0b0ZvbGxvd1BhdHRlcm4sCiAgICAgICAgICBuYW1lID0gX3RoaXMkc3RhdGUkYXV0b0ZvbGxvLm5hbWUsCiAgICAgICAgICByZW1vdGVDbHVzdGVyID0gX3RoaXMkc3RhdGUkYXV0b0ZvbGxvLnJlbW90ZUNsdXN0ZXIsCiAgICAgICAgICBsZWFkZXJJbmRleFBhdHRlcm5zID0gX3RoaXMkc3RhdGUkYXV0b0ZvbGxvLmxlYWRlckluZGV4UGF0dGVybnMsCiAgICAgICAgICBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXggPSBfdGhpcyRzdGF0ZSRhdXRvRm9sbG8uZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4LAogICAgICAgICAgZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4ID0gX3RoaXMkc3RhdGUkYXV0b0ZvbGxvLmZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeCwKICAgICAgICAgIGlzTmV3ID0gX3RoaXMkc3RhdGUuaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlID0gX3RoaXMkc3RhdGUuYXJlRXJyb3JzVmlzaWJsZSwKICAgICAgICAgIGZpZWxkc0Vycm9ycyA9IF90aGlzJHN0YXRlLmZpZWxkc0Vycm9yczsKICAgICAgLyoqCiAgICAgICAqIEF1dG8tZm9sbG93IHBhdHRlcm4gTmFtZQogICAgICAgKi8KCiAgICAgIHZhciByZW5kZXJBdXRvRm9sbG93UGF0dGVybk5hbWUgPSBmdW5jdGlvbiByZW5kZXJBdXRvRm9sbG93UGF0dGVybk5hbWUoKSB7CiAgICAgICAgdmFyIGlzSW52YWxpZCA9IGFyZUVycm9yc1Zpc2libGUgJiYgISFmaWVsZHNFcnJvcnMubmFtZTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgICBzaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImg0IiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkF1dG9Gb2xsb3dQYXR0ZXJuTmFtZVRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJOYW1lIgogICAgICAgICAgfSkpKSwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zZWN0aW9uQXV0b0ZvbGxvd1BhdHRlcm5OYW1lRGVzY3JpcHRpb24iLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkEgdW5pcXVlIG5hbWUgZm9yIHRoZSBhdXRvLWZvbGxvdyBwYXR0ZXJuLiIKICAgICAgICAgIH0pLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5hdXRvRm9sbG93UGF0dGVybk5hbWUuZmllbGROYW1lTGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5hbWUiCiAgICAgICAgICB9KSwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMubmFtZSwKICAgICAgICAgIGlzSW52YWxpZDogaXNJbnZhbGlkLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZpZWxkVGV4dCwgewogICAgICAgICAgaXNJbnZhbGlkOiBpc0ludmFsaWQsCiAgICAgICAgICB2YWx1ZTogbmFtZSwKICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgICAgICAgbmFtZTogZS50YXJnZXQudmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgICAgZGlzYWJsZWQ6ICFpc05ldywKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJuYW1lSW5wdXQiCiAgICAgICAgfSkpKTsKICAgICAgfTsKICAgICAgLyoqCiAgICAgICAqIFJlbW90ZSBDbHVzdGVyCiAgICAgICAqLwoKCiAgICAgIHZhciByZW5kZXJSZW1vdGVDbHVzdGVyRmllbGQgPSBmdW5jdGlvbiByZW5kZXJSZW1vdGVDbHVzdGVyRmllbGQoKSB7CiAgICAgICAgdmFyIF90aGlzJHByb3BzID0gX3RoaXMucHJvcHMsCiAgICAgICAgICAgIHJlbW90ZUNsdXN0ZXJzID0gX3RoaXMkcHJvcHMucmVtb3RlQ2x1c3RlcnMsCiAgICAgICAgICAgIGN1cnJlbnRVcmwgPSBfdGhpcyRwcm9wcy5jdXJyZW50VXJsOwogICAgICAgIHZhciBlcnJvck1lc3NhZ2VzID0gewogICAgICAgICAgbm9DbHVzdGVyRm91bmQ6IGZ1bmN0aW9uIG5vQ2x1c3RlckZvdW5kKCkgewogICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5lbXB0eVJlbW90ZUNsdXN0ZXJzQ2FsbE91dERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkF1dG8tZm9sbG93IHBhdHRlcm5zIGNhcHR1cmUgaW5kaWNlcyBvbiByZW1vdGUgY2x1c3RlcnMuIgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICByZW1vdGVDbHVzdGVyTm90Q29ubmVjdGVkTm90RWRpdGFibGU6IGZ1bmN0aW9uIHJlbW90ZUNsdXN0ZXJOb3RDb25uZWN0ZWROb3RFZGl0YWJsZShuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5jdXJyZW50UmVtb3RlQ2x1c3Rlck5vdENvbm5lY3RlZENhbGxPdXRUaXRsZSIsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkNhbid0IGVkaXQgYXV0by1mb2xsb3cgcGF0dGVybiBiZWNhdXNlIHJlbW90ZSBjbHVzdGVyICd7bmFtZX0nIGlzIG5vdCBjb25uZWN0ZWQiLAogICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmN1cnJlbnRSZW1vdGVDbHVzdGVyTm90Q29ubmVjdGVkQ2FsbE91dERlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiWW91IGNhbiBhZGRyZXNzIHRoaXMgYnkgZWRpdGluZyB0aGUgcmVtb3RlIGNsdXN0ZXIuIgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH07CiAgICAgICAgICB9LAogICAgICAgICAgcmVtb3RlQ2x1c3RlckRvZXNOb3RFeGlzdDogZnVuY3Rpb24gcmVtb3RlQ2x1c3RlckRvZXNOb3RFeGlzdChuYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmN1cnJlbnRSZW1vdGVDbHVzdGVyTm90Rm91bmRDYWxsT3V0RGVzY3JpcHRpb24iLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVG8gZWRpdCB0aGlzIGF1dG8tZm9sbG93IHBhdHRlcm4sIHlvdSBtdXN0IGFkZCBhIHJlbW90ZSBjbHVzdGVyIG5hbWVkICd7bmFtZX0nLiIsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRGVzY3JpYmVkRm9ybUdyb3VwLCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDQiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zZWN0aW9uUmVtb3RlQ2x1c3RlclRpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJSZW1vdGUgY2x1c3RlciIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvblJlbW90ZUNsdXN0ZXJEZXNjcmlwdGlvbiIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiVGhlIHJlbW90ZSBjbHVzdGVyIHRvIHJlcGxpY2F0ZSBsZWFkZXIgaW5kaWNlcyBmcm9tLiIKICAgICAgICAgIH0pLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVtb3RlX2NsdXN0ZXJzX2Zvcm1fZmllbGQuUmVtb3RlQ2x1c3RlcnNGb3JtRmllbGQsIHsKICAgICAgICAgIHNlbGVjdGVkOiByZW1vdGVDbHVzdGVyID8gcmVtb3RlQ2x1c3RlciA6IG51bGwsCiAgICAgICAgICByZW1vdGVDbHVzdGVyczogcmVtb3RlQ2x1c3RlcnMsCiAgICAgICAgICBjdXJyZW50VXJsOiBjdXJyZW50VXJsLAogICAgICAgICAgaXNFZGl0YWJsZTogaXNOZXcsCiAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlOiBhcmVFcnJvcnNWaXNpYmxlLAogICAgICAgICAgb25DaGFuZ2U6IF90aGlzLm9uQ2x1c3RlckNoYW5nZSwKICAgICAgICAgIG9uRXJyb3I6IGZ1bmN0aW9uIG9uRXJyb3IoZXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzLm9uRmllbGRzRXJyb3JDaGFuZ2UoewogICAgICAgICAgICAgIHJlbW90ZUNsdXN0ZXI6IGVycm9yCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSwKICAgICAgICAgIGVycm9yTWVzc2FnZXM6IGVycm9yTWVzc2FnZXMKICAgICAgICB9KSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBMZWFkZXIgaW5kZXggcGF0dGVybihzKQogICAgICAgKi8KCgogICAgICB2YXIgcmVuZGVyTGVhZGVySW5kZXhQYXR0ZXJucyA9IGZ1bmN0aW9uIHJlbmRlckxlYWRlckluZGV4UGF0dGVybnMoKSB7CiAgICAgICAgdmFyIGhhc0Vycm9yID0gISEoZmllbGRzRXJyb3JzLmxlYWRlckluZGV4UGF0dGVybnMgJiYgZmllbGRzRXJyb3JzLmxlYWRlckluZGV4UGF0dGVybnMubWVzc2FnZSk7CiAgICAgICAgdmFyIGlzSW52YWxpZCA9IGhhc0Vycm9yICYmIChmaWVsZHNFcnJvcnMubGVhZGVySW5kZXhQYXR0ZXJucy5hbHdheXNWaXNpYmxlIHx8IGFyZUVycm9yc1Zpc2libGUpOwogICAgICAgIHZhciBmb3JtYXR0ZWRMZWFkZXJJbmRleFBhdHRlcm5zID0gbGVhZGVySW5kZXhQYXR0ZXJucy5tYXAoZnVuY3Rpb24gKHBhdHRlcm4pIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGxhYmVsOiBwYXR0ZXJuCiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRGVzY3JpYmVkRm9ybUdyb3VwLCB7CiAgICAgICAgICB0aXRsZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgICAgIHNpemU6ICJzIgogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiaDQiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zZWN0aW9uTGVhZGVySW5kZXhQYXR0ZXJuc1RpdGxlIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJMZWFkZXIgaW5kaWNlcyIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zZWN0aW9uTGVhZGVySW5kZXhQYXR0ZXJuc0Rlc2NyaXB0aW9uMSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiT25lIG9yIG1vcmUgaW5kZXggcGF0dGVybnMgdGhhdCBpZGVudGlmeSB0aGUgaW5kaWNlcyB5b3Ugd2FudCB0byByZXBsaWNhdGUgZnJvbSB0aGUgcmVtb3RlIGNsdXN0ZXIuIEFzIG5ldyBpbmRpY2VzIG1hdGNoaW5nIHRoZXNlIHBhdHRlcm5zIGFyZSBjcmVhdGVkLCB0aGV5IGFyZSByZXBsaWNhdGVkIHRvIGZvbGxvd2VyIGluZGljZXMgb24gdGhlIGxvY2FsIGNsdXN0ZXIuIgogICAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkxlYWRlckluZGV4UGF0dGVybnNEZXNjcmlwdGlvbjIiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIntub3RlfSBJbmRpY2VzIHRoYXQgYWxyZWFkeSBleGlzdCBhcmUgbm90IHJlcGxpY2F0ZWQuIiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgbm90ZTogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLnNlY3Rpb25MZWFkZXJJbmRleFBhdHRlcm5zRGVzY3JpcHRpb24yLm5vdGVMYWJlbCIsCiAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIk5vdGU6IgogICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9CiAgICAgICAgICB9KSkpLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5maWVsZExlYWRlckluZGV4UGF0dGVybnNMYWJlbCIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW5kZXggcGF0dGVybnMiCiAgICAgICAgICB9KSwKICAgICAgICAgIGhlbHBUZXh0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5maWVsZExlYWRlckluZGV4UGF0dGVybnNIZWxwTGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNwYWNlcyBhbmQgdGhlIGNoYXJhY3RlcnMge2NoYXJhY3Rlckxpc3R9IGFyZSBub3QgYWxsb3dlZC4iLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBjaGFyYWN0ZXJMaXN0OiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJzdHJvbmciLCBudWxsLCBpbmRleFBhdHRlcm5JbGxlZ2FsQ2hhcmFjdGVycykKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMubGVhZGVySW5kZXhQYXR0ZXJucyAmJiBmaWVsZHNFcnJvcnMubGVhZGVySW5kZXhQYXR0ZXJucy5tZXNzYWdlLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNvbWJvQm94LCB7CiAgICAgICAgICBub1N1Z2dlc3Rpb25zOiB0cnVlLAogICAgICAgICAgcGxhY2Vob2xkZXI6IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uZmllbGRMZWFkZXJJbmRleFBhdHRlcm5zUGxhY2Vob2xkZXInLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVHlwZSBhbmQgdGhlbiBoaXQgRU5URVInCiAgICAgICAgICB9KSwKICAgICAgICAgIHNlbGVjdGVkT3B0aW9uczogZm9ybWF0dGVkTGVhZGVySW5kZXhQYXR0ZXJucywKICAgICAgICAgIG9uQ3JlYXRlT3B0aW9uOiBfdGhpcy5vbkNyZWF0ZUxlYWRlckluZGV4UGF0dGVybiwKICAgICAgICAgIG9uQ2hhbmdlOiBfdGhpcy5vbkxlYWRlckluZGV4UGF0dGVybkNoYW5nZSwKICAgICAgICAgIG9uU2VhcmNoQ2hhbmdlOiBfdGhpcy5vbkxlYWRlckluZGV4UGF0dGVybklucHV0Q2hhbmdlLAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImluZGV4UGF0dGVybklucHV0IgogICAgICAgIH0pKSk7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBBdXRvLWZvbGxvdyBwYXR0ZXJuIHByZWZpeC9zdWZmaXgKICAgICAgICovCgoKICAgICAgdmFyIHJlbmRlckF1dG9Gb2xsb3dQYXR0ZXJuUHJlZml4U3VmZml4ID0gZnVuY3Rpb24gcmVuZGVyQXV0b0ZvbGxvd1BhdHRlcm5QcmVmaXhTdWZmaXgoKSB7CiAgICAgICAgdmFyIGlzUHJlZml4SW52YWxpZCA9IGFyZUVycm9yc1Zpc2libGUgJiYgISFmaWVsZHNFcnJvcnMuZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4OwogICAgICAgIHZhciBpc1N1ZmZpeEludmFsaWQgPSBhcmVFcnJvcnNWaXNpYmxlICYmICEhZmllbGRzRXJyb3JzLmZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeDsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aURlc2NyaWJlZEZvcm1Hcm91cCwgewogICAgICAgICAgdGl0bGU6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUaXRsZSwgewogICAgICAgICAgICBzaXplOiAicyIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImg0IiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkF1dG9Gb2xsb3dQYXR0ZXJuVGl0bGUiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkZvbGxvd2VyIGluZGljZXMgKG9wdGlvbmFsKSIKICAgICAgICAgIH0pKSksCiAgICAgICAgICBkZXNjcmlwdGlvbjogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm0uc2VjdGlvbkF1dG9Gb2xsb3dQYXR0ZXJuRGVzY3JpcHRpb24iLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkEgY3VzdG9tIHByZWZpeCBvciBzdWZmaXggdG8gYXBwbHkgdG8gdGhlIG5hbWVzIG9mIHRoZSBmb2xsb3dlciBpbmRpY2VzIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkgaWRlbnRpZnkgcmVwbGljYXRlZCBpbmRpY2VzLiBCeSBkZWZhdWx0LCBhIGZvbGxvd2VyIGluZGV4IGhhcyB0aGUgc2FtZSBuYW1lIGFzIHRoZSBsZWFkZXIgaW5kZXguIgogICAgICAgICAgfSksCiAgICAgICAgICBmdWxsV2lkdGg6IHRydWUKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICBndXR0ZXJTaXplOiAicyIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtUm93LCB7CiAgICAgICAgICBjbGFzc05hbWU6ICJjY3JGb2xsb3dlckluZGljZXNGb3JtUm93IiwKICAgICAgICAgIGxhYmVsOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5hdXRvRm9sbG93UGF0dGVybi5maWVsZFByZWZpeExhYmVsIiwKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJQcmVmaXgiCiAgICAgICAgICB9KSwKICAgICAgICAgIGVycm9yOiBmaWVsZHNFcnJvcnMuZm9sbG93SW5kZXhQYXR0ZXJuUHJlZml4LAogICAgICAgICAgaXNJbnZhbGlkOiBpc1ByZWZpeEludmFsaWQsCiAgICAgICAgICBmdWxsV2lkdGg6IHRydWUKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmllbGRUZXh0LCB7CiAgICAgICAgICBpc0ludmFsaWQ6IGlzUHJlZml4SW52YWxpZCwKICAgICAgICAgIHZhbHVlOiBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXgsCiAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgICAgICAgIGZvbGxvd0luZGV4UGF0dGVyblByZWZpeDogZS50YXJnZXQudmFsdWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9LAogICAgICAgICAgZnVsbFdpZHRoOiB0cnVlLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogInByZWZpeElucHV0IgogICAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgICAgICAgIGNsYXNzTmFtZTogImNjckZvbGxvd2VySW5kaWNlc0Zvcm1Sb3ciLAogICAgICAgICAgbGFiZWw6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmF1dG9Gb2xsb3dQYXR0ZXJuLmZpZWxkU3VmZml4TGFiZWwiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlN1ZmZpeCIKICAgICAgICAgIH0pLAogICAgICAgICAgZXJyb3I6IGZpZWxkc0Vycm9ycy5mb2xsb3dJbmRleFBhdHRlcm5TdWZmaXgsCiAgICAgICAgICBpc0ludmFsaWQ6IGlzU3VmZml4SW52YWxpZCwKICAgICAgICAgIGZ1bGxXaWR0aDogdHJ1ZQogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIHsKICAgICAgICAgIGlzSW52YWxpZDogaXNTdWZmaXhJbnZhbGlkLAogICAgICAgICAgdmFsdWU6IGZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeCwKICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5vbkZpZWxkc0NoYW5nZSh7CiAgICAgICAgICAgICAgZm9sbG93SW5kZXhQYXR0ZXJuU3VmZml4OiBlLnRhcmdldC52YWx1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgICAiZGF0YS10ZXN0LXN1YmoiOiAic3VmZml4SW5wdXQiCiAgICAgICAgfSkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtSGVscFRleHQsIHsKICAgICAgICAgIGNsYXNzTmFtZTogaXNQcmVmaXhJbnZhbGlkIHx8IGlzU3VmZml4SW52YWxpZCA/IG51bGwgOiAnY2NyRm9sbG93ZXJJbmRpY2VzSGVscFRleHQnCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmZpZWxkRm9sbG93ZXJJbmRpY2VzSGVscExhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiU3BhY2VzIGFuZCB0aGUgY2hhcmFjdGVycyB7Y2hhcmFjdGVyTGlzdH0gYXJlIG5vdCBhbGxvd2VkLiIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgY2hhcmFjdGVyTGlzdDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgic3Ryb25nIiwgbnVsbCwgaW5kZXhOYW1lSWxsZWdhbENoYXJhY3RlcnMpCiAgICAgICAgICB9CiAgICAgICAgfSkpLCAhIWxlYWRlckluZGV4UGF0dGVybnMubGVuZ3RoICYmIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICBzaXplOiAibSIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfYXV0b19mb2xsb3dfcGF0dGVybl9pbmRpY2VzX3ByZXZpZXcuQXV0b0ZvbGxvd1BhdHRlcm5JbmRpY2VzUHJldmlldywgewogICAgICAgICAgcHJlZml4OiBmb2xsb3dJbmRleFBhdHRlcm5QcmVmaXgsCiAgICAgICAgICBzdWZmaXg6IGZvbGxvd0luZGV4UGF0dGVyblN1ZmZpeCwKICAgICAgICAgIGxlYWRlckluZGV4UGF0dGVybnM6IGxlYWRlckluZGV4UGF0dGVybnMKICAgICAgICB9KSkpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogRm9ybSBFcnJvciB3YXJuaW5nIG1lc3NhZ2UKICAgICAgICovCgoKICAgICAgdmFyIHJlbmRlckZvcm1FcnJvcldhcm5pbmcgPSBmdW5jdGlvbiByZW5kZXJGb3JtRXJyb3JXYXJuaW5nKCkgewogICAgICAgIHZhciBhcmVFcnJvcnNWaXNpYmxlID0gX3RoaXMuc3RhdGUuYXJlRXJyb3JzVmlzaWJsZTsKCiAgICAgICAgdmFyIGlzRm9ybVZhbGlkID0gX3RoaXMuaXNGb3JtVmFsaWQoKTsKCiAgICAgICAgaWYgKCFhcmVFcnJvcnNWaXNpYmxlIHx8IGlzRm9ybVZhbGlkKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIHRpdGxlOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS52YWxpZGF0aW9uRXJyb3JUaXRsZSIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRml4IGVycm9ycyBiZWZvcmUgY29udGludWluZy4iCiAgICAgICAgICB9KSwKICAgICAgICAgIGNvbG9yOiAiZGFuZ2VyIiwKICAgICAgICAgIGljb25UeXBlOiAiY3Jvc3MiLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImZvcm1FcnJvciIKICAgICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVNwYWNlciwgewogICAgICAgICAgc2l6ZTogImwiCiAgICAgICAgfSkpOwogICAgICB9OwogICAgICAvKioKICAgICAgICogRm9ybSBBY3Rpb25zCiAgICAgICAqLwoKCiAgICAgIHZhciByZW5kZXJBY3Rpb25zID0gZnVuY3Rpb24gcmVuZGVyQWN0aW9ucygpIHsKICAgICAgICB2YXIgX3RoaXMkcHJvcHMyID0gX3RoaXMucHJvcHMsCiAgICAgICAgICAgIGFwaVN0YXR1cyA9IF90aGlzJHByb3BzMi5hcGlTdGF0dXMsCiAgICAgICAgICAgIHNhdmVCdXR0b25MYWJlbCA9IF90aGlzJHByb3BzMi5zYXZlQnV0dG9uTGFiZWw7CiAgICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IF90aGlzLnN0YXRlLAogICAgICAgICAgICBhcmVFcnJvcnNWaXNpYmxlID0gX3RoaXMkc3RhdGUyLmFyZUVycm9yc1Zpc2libGUsCiAgICAgICAgICAgIGlzUmVxdWVzdFZpc2libGUgPSBfdGhpcyRzdGF0ZTIuaXNSZXF1ZXN0VmlzaWJsZTsKCiAgICAgICAgaWYgKGFwaVN0YXR1cyA9PT0gX2NvbnN0YW50cy5BUElfU1RBVFVTLlNBVklORykgewogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4R3JvdXAsIHsKICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJmbGV4U3RhcnQiLAogICAgICAgICAgICBndXR0ZXJTaXplOiAibSIKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgICBncm93OiBmYWxzZQogICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxvYWRpbmdTcGlubmVyLCB7CiAgICAgICAgICAgIHNpemU6ICJsIgogICAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEl0ZW0sIHsKICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlUZXh0LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5hY3Rpb25zLnNhdmluZ1RleHQiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmluZyIKICAgICAgICAgIH0pKSkpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGlzU2F2ZURpc2FibGVkID0gYXJlRXJyb3JzVmlzaWJsZSAmJiAhX3RoaXMuaXNGb3JtVmFsaWQoKTsKICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhHcm91cCwgewogICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJzcGFjZUJldHdlZW4iLAogICAgICAgICAgYWxpZ25JdGVtczogImNlbnRlciIKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICBndXR0ZXJTaXplOiAibSIsCiAgICAgICAgICBhbGlnbkl0ZW1zOiAiY2VudGVyIgogICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uLCB7CiAgICAgICAgICBjb2xvcjogInNlY29uZGFyeSIsCiAgICAgICAgICBpY29uVHlwZTogImNoZWNrIiwKICAgICAgICAgIG9uQ2xpY2s6IF90aGlzLnNlbmRGb3JtLAogICAgICAgICAgZmlsbDogdHJ1ZSwKICAgICAgICAgIGRpc2FibGVkOiBpc1NhdmVEaXNhYmxlZCwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzdWJtaXRCdXR0b24iCiAgICAgICAgfSwgc2F2ZUJ1dHRvbkxhYmVsKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICAgIGNvbG9yOiAicHJpbWFyeSIsCiAgICAgICAgICBvbkNsaWNrOiBfdGhpcy5jYW5jZWxGb3JtCiAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmNhbmNlbEJ1dHRvbkxhYmVsIiwKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ2FuY2VsIiwKICAgICAgICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJjYW5jZWxCdXR0b24iCiAgICAgICAgfSkpKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGbGV4SXRlbSwgewogICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpQnV0dG9uRW1wdHksIHsKICAgICAgICAgIG9uQ2xpY2s6IF90aGlzLnRvZ2dsZVJlcXVlc3QKICAgICAgICB9LCBpc1JlcXVlc3RWaXNpYmxlID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgIGlkOiAieHBhY2suY3Jvc3NDbHVzdGVyUmVwbGljYXRpb24uYXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLmhpZGVSZXF1ZXN0QnV0dG9uTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJIaWRlIHJlcXVlc3QiCiAgICAgICAgfSkgOiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgaWQ6ICJ4cGFjay5jcm9zc0NsdXN0ZXJSZXBsaWNhdGlvbi5hdXRvRm9sbG93UGF0dGVybkZvcm1tLnNob3dSZXF1ZXN0QnV0dG9uTGFiZWwiLAogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJTaG93IHJlcXVlc3QiCiAgICAgICAgfSkpKSk7CiAgICAgIH07CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGb3JtLCB7CiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSIKICAgICAgfSwgcmVuZGVyQXV0b0ZvbGxvd1BhdHRlcm5OYW1lKCksIHJlbmRlclJlbW90ZUNsdXN0ZXJGaWVsZCgpLCByZW5kZXJMZWFkZXJJbmRleFBhdHRlcm5zKCksIHJlbmRlckF1dG9Gb2xsb3dQYXR0ZXJuUHJlZml4U3VmZml4KCkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCBudWxsKSwgcmVuZGVyRm9ybUVycm9yV2FybmluZygpLCBfdGhpcy5yZW5kZXJBcGlFcnJvcnMoKSwgcmVuZGVyQWN0aW9ucygpKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInJlbmRlckxvYWRpbmciLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhcGlTdGF0dXMgPSBfdGhpcy5wcm9wcy5hcGlTdGF0dXM7CgogICAgICBpZiAoYXBpU3RhdHVzID09PSBfY29uc3RhbnRzLkFQSV9TVEFUVVMuU0FWSU5HKSB7CiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlPdmVybGF5TWFzaywgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUxvYWRpbmdLaWJhbmEsIHsKICAgICAgICAgIHNpemU6ICJ4bCIKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CgogICAgdmFyIF9pc05ldyA9IF90aGlzLnByb3BzLmF1dG9Gb2xsb3dQYXR0ZXJuID09PSB1bmRlZmluZWQ7CgogICAgdmFyIHNlYXJjaCA9IF9yb3V0aW5nLmRlZmF1bHQucmVhY3RSb3V0ZXIucm91dGUubG9jYXRpb24uc2VhcmNoOwogICAgdmFyIHF1ZXJ5UGFyYW1zID0gKDAsIF9xdWVyeV9wYXJhbXMuZXh0cmFjdFF1ZXJ5UGFyYW1zKShzZWFyY2gpOwogICAgdmFyIHJlbW90ZUNsdXN0ZXJOYW1lID0gKDAsIF9nZXRfcmVtb3RlX2NsdXN0ZXJfbmFtZS5nZXRSZW1vdGVDbHVzdGVyTmFtZSkoX3RoaXMucHJvcHMucmVtb3RlQ2x1c3RlcnMsIHF1ZXJ5UGFyYW1zLmNsdXN0ZXIpOwoKICAgIHZhciBfYXV0b0ZvbGxvd1BhdHRlcm4gPSBfaXNOZXcgPyBnZXRFbXB0eUF1dG9Gb2xsb3dQYXR0ZXJuKHJlbW90ZUNsdXN0ZXJOYW1lKSA6IF9vYmplY3RTcHJlYWQoe30sIF90aGlzLnByb3BzLmF1dG9Gb2xsb3dQYXR0ZXJuKTsKCiAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgYXV0b0ZvbGxvd1BhdHRlcm46IF9hdXRvRm9sbG93UGF0dGVybiwKICAgICAgZmllbGRzRXJyb3JzOiAoMCwgX2F1dG9fZm9sbG93X3BhdHRlcm5fdmFsaWRhdG9ycy52YWxpZGF0ZUF1dG9Gb2xsb3dQYXR0ZXJuKShfYXV0b0ZvbGxvd1BhdHRlcm4pLAogICAgICBhcmVFcnJvcnNWaXNpYmxlOiBmYWxzZSwKICAgICAgaXNOZXc6IF9pc05ldywKICAgICAgaXNSZXF1ZXN0VmlzaWJsZTogZmFsc2UKICAgIH07CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQXV0b0ZvbGxvd1BhdHRlcm5Gb3JtLCBbewogICAga2V5OiAiaXNGb3JtVmFsaWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzRm9ybVZhbGlkKCkgewogICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aGlzLnN0YXRlLmZpZWxkc0Vycm9ycykuZXZlcnkoZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgcmV0dXJuIGVycm9yID09PSB1bmRlZmluZWQgfHwgZXJyb3IgPT09IG51bGw7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckFwaUVycm9ycyIsCgogICAgLyoqCiAgICAgKiBTZWNjdGlvbnMgUmVuZGVycwogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyQXBpRXJyb3JzKCkgewogICAgICB2YXIgYXBpRXJyb3IgPSB0aGlzLnByb3BzLmFwaUVycm9yOwoKICAgICAgaWYgKGFwaUVycm9yKSB7CiAgICAgICAgdmFyIHRpdGxlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmNyb3NzQ2x1c3RlclJlcGxpY2F0aW9uLmF1dG9Gb2xsb3dQYXR0ZXJuRm9ybS5zYXZpbmdFcnJvclRpdGxlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJDYW4ndCBjcmVhdGUgYXV0by1mb2xsb3cgcGF0dGVybiIKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zZWN0aW9uX2Vycm9yLlNlY3Rpb25FcnJvciwgewogICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgZXJyb3I6IGFwaUVycm9yLAogICAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogImFwaUVycm9yIgogICAgICAgIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpU3BhY2VyLCB7CiAgICAgICAgICBzaXplOiAibCIKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBfdGhpcyRzdGF0ZTMgPSB0aGlzLnN0YXRlLAogICAgICAgICAgYXV0b0ZvbGxvd1BhdHRlcm4gPSBfdGhpcyRzdGF0ZTMuYXV0b0ZvbGxvd1BhdHRlcm4sCiAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlID0gX3RoaXMkc3RhdGUzLmlzUmVxdWVzdFZpc2libGUsCiAgICAgICAgICBpc05ldyA9IF90aGlzJHN0YXRlMy5pc05ldzsKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCB0aGlzLnJlbmRlckZvcm0oKSwgdGhpcy5yZW5kZXJMb2FkaW5nKCksIGlzUmVxdWVzdFZpc2libGUgPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9hdXRvX2ZvbGxvd19wYXR0ZXJuX3JlcXVlc3RfZmx5b3V0LkF1dG9Gb2xsb3dQYXR0ZXJuUmVxdWVzdEZseW91dCwgewogICAgICAgIG5hbWU6IGF1dG9Gb2xsb3dQYXR0ZXJuLm5hbWUsCiAgICAgICAgYXV0b0ZvbGxvd1BhdHRlcm46IHRoaXMuZ2V0RmllbGRzKCksCiAgICAgICAgaXNOZXc6IGlzTmV3LAogICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczIuc2V0U3RhdGUoewogICAgICAgICAgICBpc1JlcXVlc3RWaXNpYmxlOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KSA6IG51bGwpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybTsKfShfcmVhY3QuUHVyZUNvbXBvbmVudCk7CgpleHBvcnRzLkF1dG9Gb2xsb3dQYXR0ZXJuRm9ybSA9IEF1dG9Gb2xsb3dQYXR0ZXJuRm9ybTsKCl9kZWZpbmVQcm9wZXJ0eShBdXRvRm9sbG93UGF0dGVybkZvcm0sICJwcm9wVHlwZXMiLCB7CiAgc2F2ZUF1dG9Gb2xsb3dQYXR0ZXJuOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYy5pc1JlcXVpcmVkLAogIGF1dG9Gb2xsb3dQYXR0ZXJuOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIGFwaUVycm9yOiBfcHJvcFR5cGVzLmRlZmF1bHQub2JqZWN0LAogIGFwaVN0YXR1czogX3Byb3BUeXBlcy5kZWZhdWx0LnN0cmluZy5pc1JlcXVpcmVkLAogIGN1cnJlbnRVcmw6IF9wcm9wVHlwZXMuZGVmYXVsdC5zdHJpbmcuaXNSZXF1aXJlZCwKICByZW1vdGVDbHVzdGVyczogX3Byb3BUeXBlcy5kZWZhdWx0LmFycmF5LAogIHNhdmVCdXR0b25MYWJlbDogX3Byb3BUeXBlcy5kZWZhdWx0Lm5vZGUKfSk7"},null]}