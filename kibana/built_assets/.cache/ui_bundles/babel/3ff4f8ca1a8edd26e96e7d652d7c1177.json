{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/use_pre_packaged_rules.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/use_pre_packaged_rules.js","mtime":1589249553224},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLnVzZVByZVBhY2thZ2VkUnVsZXMgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gcmVxdWlyZSgicmVhY3QiKTsKCnZhciBfdG9hc3RlcnMgPSByZXF1aXJlKCIuLi8uLi8uLi9jb21wb25lbnRzL3RvYXN0ZXJzIik7Cgp2YXIgX2FwaSA9IHJlcXVpcmUoIi4vYXBpIik7Cgp2YXIgaTE4biA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIi4vdHJhbnNsYXRpb25zIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQovKioKICogSG9vayBmb3IgdXNpbmcgdG8gZ2V0IHN0YXR1cyBhYm91dCBwcmUtcGFja2FnZWQgUnVsZXMgZnJvbSB0aGUgRGV0ZWN0aW9uIEVuZ2luZSBBUEkKICoKICogQHBhcmFtIGhhc0luZGV4V3JpdGUgYm9vbGVhbgogKiBAcGFyYW0gaXNBdXRoZW50aWNhdGVkIGJvb2xlYW4KICogQHBhcmFtIGhhc0VuY3J5cHRpb25LZXkgYm9vbGVhbgogKiBAcGFyYW0gaXNTaWduYWxJbmRleEV4aXN0cyBib29sZWFuCiAqCiAqLwoKCnZhciB1c2VQcmVQYWNrYWdlZFJ1bGVzID0gZnVuY3Rpb24gdXNlUHJlUGFja2FnZWRSdWxlcyhfcmVmKSB7CiAgdmFyIGNhblVzZXJDUlVEID0gX3JlZi5jYW5Vc2VyQ1JVRCwKICAgICAgaGFzSW5kZXhXcml0ZSA9IF9yZWYuaGFzSW5kZXhXcml0ZSwKICAgICAgaXNBdXRoZW50aWNhdGVkID0gX3JlZi5pc0F1dGhlbnRpY2F0ZWQsCiAgICAgIGhhc0VuY3J5cHRpb25LZXkgPSBfcmVmLmhhc0VuY3J5cHRpb25LZXksCiAgICAgIGlzU2lnbmFsSW5kZXhFeGlzdHMgPSBfcmVmLmlzU2lnbmFsSW5kZXhFeGlzdHM7CgogIHZhciBfdXNlU3RhdGUgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKSh7CiAgICBjcmVhdGVQcmVQYWNrYWdlZFJ1bGVzOiBudWxsLAogICAgcmVmZXRjaFByZVBhY2thZ2VkUnVsZXNTdGF0dXM6IG51bGwsCiAgICBydWxlc0N1c3RvbUluc3RhbGxlZDogbnVsbCwKICAgIHJ1bGVzSW5zdGFsbGVkOiBudWxsLAogICAgcnVsZXNOb3RJbnN0YWxsZWQ6IG51bGwsCiAgICBydWxlc05vdFVwZGF0ZWQ6IG51bGwKICB9KSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIHJ1bGVzU3RhdHVzID0gX3VzZVN0YXRlMlswXSwKICAgICAgc2V0UnVsZVN0YXR1cyA9IF91c2VTdGF0ZTJbMV07CgogIHZhciBfdXNlU3RhdGUzID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoZmFsc2UpLAogICAgICBfdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMywgMiksCiAgICAgIGxvYWRpbmdDcmVhdGVQcmVQYWNrYWdlZFJ1bGVzID0gX3VzZVN0YXRlNFswXSwKICAgICAgc2V0TG9hZGluZ0NyZWF0ZVByZVBhY2thZ2VkUnVsZXMgPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgX3VzZVN0YXRlNSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKHRydWUpLAogICAgICBfdXNlU3RhdGU2ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNSwgMiksCiAgICAgIGxvYWRpbmcgPSBfdXNlU3RhdGU2WzBdLAogICAgICBzZXRMb2FkaW5nID0gX3VzZVN0YXRlNlsxXTsKCiAgdmFyIF91c2VTdGF0ZVRvYXN0ZXIgPSAoMCwgX3RvYXN0ZXJzLnVzZVN0YXRlVG9hc3RlcikoKSwKICAgICAgX3VzZVN0YXRlVG9hc3RlcjIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGVUb2FzdGVyLCAyKSwKICAgICAgZGlzcGF0Y2hUb2FzdGVyID0gX3VzZVN0YXRlVG9hc3RlcjJbMV07CgogICgwLCBfcmVhY3QudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICB2YXIgaXNTdWJzY3JpYmVkID0gdHJ1ZTsKICAgIHZhciBhYm9ydEN0cmwgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CgogICAgdmFyIGZldGNoUHJlUGFja2FnZWRSdWxlcyA9CiAgICAvKiNfX1BVUkVfXyovCiAgICBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVmMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgICAgc2V0TG9hZGluZyh0cnVlKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXBpLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMpKHsKICAgICAgICAgICAgICAgICAgc2lnbmFsOiBhYm9ydEN0cmwuc2lnbmFsCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgcHJlUGFja2FnZWRSdWxlU3RhdHVzUmVzcG9uc2UgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChpc1N1YnNjcmliZWQpIHsKICAgICAgICAgICAgICAgICAgc2V0UnVsZVN0YXR1cyh7CiAgICAgICAgICAgICAgICAgICAgY3JlYXRlUHJlUGFja2FnZWRSdWxlczogY3JlYXRlRWxhc3RpY1J1bGVzLAogICAgICAgICAgICAgICAgICAgIHJlZmV0Y2hQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzOiBmZXRjaFByZVBhY2thZ2VkUnVsZXMsCiAgICAgICAgICAgICAgICAgICAgcnVsZXNDdXN0b21JbnN0YWxsZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX2N1c3RvbV9pbnN0YWxsZWQsCiAgICAgICAgICAgICAgICAgICAgcnVsZXNJbnN0YWxsZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX2luc3RhbGxlZCwKICAgICAgICAgICAgICAgICAgICBydWxlc05vdEluc3RhbGxlZDogcHJlUGFja2FnZWRSdWxlU3RhdHVzUmVzcG9uc2UucnVsZXNfbm90X2luc3RhbGxlZCwKICAgICAgICAgICAgICAgICAgICBydWxlc05vdFVwZGF0ZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX25vdF91cGRhdGVkCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gODsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CgogICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlZCkgewogICAgICAgICAgICAgICAgICBzZXRSdWxlU3RhdHVzKHsKICAgICAgICAgICAgICAgICAgICBjcmVhdGVQcmVQYWNrYWdlZFJ1bGVzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJlZmV0Y2hQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJ1bGVzQ3VzdG9tSW5zdGFsbGVkOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJ1bGVzSW5zdGFsbGVkOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJ1bGVzTm90SW5zdGFsbGVkOiBudWxsLAogICAgICAgICAgICAgICAgICAgIHJ1bGVzTm90VXBkYXRlZDogbnVsbAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgKDAsIF90b2FzdGVycy5lcnJvclRvVG9hc3RlcikoewogICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLlJVTEVfRkVUQ0hfRkFJTFVSRSwKICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQudDAsCiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hUb2FzdGVyOiBkaXNwYXRjaFRvYXN0ZXIKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBpZiAoaXNTdWJzY3JpYmVkKSB7CiAgICAgICAgICAgICAgICAgIHNldExvYWRpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1swLCA4XV0pOwogICAgICB9KSk7CgogICAgICByZXR1cm4gZnVuY3Rpb24gZmV0Y2hQcmVQYWNrYWdlZFJ1bGVzKCkgewogICAgICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfSgpOwoKICAgIHZhciBjcmVhdGVFbGFzdGljUnVsZXMgPQogICAgLyojX19QVVJFX18qLwogICAgZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3JlZjMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5ldyBQcm9taXNlKAogICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjQgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblRyeU9mRmV0Y2hpbmdQcmVQYWNrYWdlZENvdW50LCB0aW1lb3V0SWQsIHN0b3BUaW1lT3V0LCByZUZldGNoOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoY2FuVXNlckNSVUQgJiYgaGFzSW5kZXhXcml0ZSAmJiBpc0F1dGhlbnRpY2F0ZWQgJiYgaGFzRW5jcnlwdGlvbktleSAmJiBpc1NpZ25hbEluZGV4RXhpc3RzKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldExvYWRpbmdDcmVhdGVQcmVQYWNrYWdlZFJ1bGVzKHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXBpLmNyZWF0ZVByZXBhY2thZ2VkUnVsZXMpKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsOiBhYm9ydEN0cmwuc2lnbmFsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVyYXRpb25UcnlPZkZldGNoaW5nUHJlUGFja2FnZWRDb3VudCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXRJZCA9IC0xOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFRpbWVPdXQgPSBmdW5jdGlvbiBzdG9wVGltZU91dCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGltZW91dElkICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0SWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlRmV0Y2ggPSBmdW5jdGlvbiByZUZldGNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3aW5kb3cuc2V0VGltZW91dCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlcmF0aW9uVHJ5T2ZGZXRjaGluZ1ByZVBhY2thZ2VkQ291bnQgPSBpdGVyYXRpb25UcnlPZkZldGNoaW5nUHJlUGFja2FnZWRDb3VudCArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgwLCBfYXBpLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMpKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaWduYWw6IGFib3J0Q3RybC5zaWduYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVQYWNrYWdlZFJ1bGVTdGF0dXNSZXNwb25zZSA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlZCAmJiAocHJlUGFja2FnZWRSdWxlU3RhdHVzUmVzcG9uc2UucnVsZXNfbm90X2luc3RhbGxlZCA9PT0gMCAmJiBwcmVQYWNrYWdlZFJ1bGVTdGF0dXNSZXNwb25zZS5ydWxlc19ub3RfdXBkYXRlZCA9PT0gMCB8fCBpdGVyYXRpb25UcnlPZkZldGNoaW5nUHJlUGFja2FnZWRDb3VudCA+IDEwMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRMb2FkaW5nQ3JlYXRlUHJlUGFja2FnZWRSdWxlcyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UnVsZVN0YXR1cyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVQcmVQYWNrYWdlZFJ1bGVzOiBjcmVhdGVFbGFzdGljUnVsZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZldGNoUHJlUGFja2FnZWRSdWxlc1N0YXR1czogZmV0Y2hQcmVQYWNrYWdlZFJ1bGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZXNDdXN0b21JbnN0YWxsZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX2N1c3RvbV9pbnN0YWxsZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlc0luc3RhbGxlZDogcHJlUGFja2FnZWRSdWxlU3RhdHVzUmVzcG9uc2UucnVsZXNfaW5zdGFsbGVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVsZXNOb3RJbnN0YWxsZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX25vdF9pbnN0YWxsZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlc05vdFVwZGF0ZWQ6IHByZVBhY2thZ2VkUnVsZVN0YXR1c1Jlc3BvbnNlLnJ1bGVzX25vdF91cGRhdGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDAsIF90b2FzdGVycy5kaXNwbGF5U3VjY2Vzc1RvYXN0KShpMThuLlJVTEVfUFJFUEFDS0FHRURfU1VDQ0VTUywgZGlzcGF0Y2hUb2FzdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wVGltZU91dCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dElkID0gcmVGZXRjaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpLCAzMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dElkID0gcmVGZXRjaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gOTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAxMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0My50MCA9IF9jb250ZXh0M1siY2F0Y2giXSgwKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTdWJzY3JpYmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldExvYWRpbmdDcmVhdGVQcmVQYWNrYWdlZFJ1bGVzKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKDAsIF90b2FzdGVycy5lcnJvclRvVG9hc3RlcikoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBpMThuLlJVTEVfUFJFUEFDS0FHRURfRkFJTFVSRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQzLnQwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoVG9hc3RlcjogZGlzcGF0Y2hUb2FzdGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlMywgbnVsbCwgW1swLCAxMV1dKTsKICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSgpKSk7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKTsKCiAgICAgIHJldHVybiBmdW5jdGlvbiBjcmVhdGVFbGFzdGljUnVsZXMoKSB7CiAgICAgICAgcmV0dXJuIF9yZWYzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9KCk7CgogICAgZmV0Y2hQcmVQYWNrYWdlZFJ1bGVzKCk7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBpc1N1YnNjcmliZWQgPSBmYWxzZTsKICAgICAgYWJvcnRDdHJsLmFib3J0KCk7CiAgICB9OwogIH0sIFtjYW5Vc2VyQ1JVRCwgaGFzSW5kZXhXcml0ZSwgaXNBdXRoZW50aWNhdGVkLCBoYXNFbmNyeXB0aW9uS2V5LCBpc1NpZ25hbEluZGV4RXhpc3RzXSk7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoewogICAgbG9hZGluZzogbG9hZGluZywKICAgIGxvYWRpbmdDcmVhdGVQcmVQYWNrYWdlZFJ1bGVzOiBsb2FkaW5nQ3JlYXRlUHJlUGFja2FnZWRSdWxlcwogIH0sIHJ1bGVzU3RhdHVzKTsKfTsKCmV4cG9ydHMudXNlUHJlUGFja2FnZWRSdWxlcyA9IHVzZVByZVBhY2thZ2VkUnVsZXM7"},null]}