{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/vis_type_vega/public/vega_view/vega_base_view.js","dependencies":[{"path":"src/legacy/core_plugins/vis_type_vega/public/vega_view/vega_base_view.js","mtime":1589249550086},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmJ5cGFzc0V4dGVybmFsVXJsQ2hlY2sgPSBieXBhc3NFeHRlcm5hbFVybENoZWNrOwpleHBvcnRzLlZlZ2FCYXNlVmlldyA9IHZvaWQgMDsKCnZhciBfanF1ZXJ5ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJqcXVlcnkiKSk7Cgp2YXIgX21vbWVudCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibW9tZW50IikpOwoKdmFyIF9kYXRlbWF0aCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiQGVsYXN0aWMvZGF0ZW1hdGgiKSk7Cgp2YXIgdmVnYSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInZlZ2EtbGliIikpOwoKdmFyIHZlZ2FMaXRlID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgidmVnYS1saXRlIikpOwoKdmFyIF91dGlscyA9IHJlcXVpcmUoIi4uL2RhdGFfbW9kZWwvdXRpbHMiKTsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfdmVnYV90b29sdGlwID0gcmVxdWlyZSgiLi92ZWdhX3Rvb2x0aXAiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9kYXRhL3B1YmxpYyIpOwoKdmFyIF9zZXJ2aWNlcyA9IHJlcXVpcmUoIi4uL3NlcnZpY2VzIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsgcmV0dXJuIGZ1bmN0aW9uICgpIHsgdmFyIHNlbGYgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzOyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgeyB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7IGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7IH0gZnVuY3Rpb24gX3Rocm93KGVycikgeyBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7IH0gX25leHQodW5kZWZpbmVkKTsgfSk7IH07IH0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9Cgp2ZWdhLnNjaGVtZSgnZWxhc3RpYycsIF9ldWkuVklTVUFMSVpBVElPTl9DT0xPUlMpOyAvLyBWZWdhJ3MgZXh0ZW5zaW9uIGZ1bmN0aW9ucyBhcmUgZ2xvYmFsLiBXaGVuIGNhbGxlZCwKLy8gd2UgZm9yd2FyZCBleGVjdXRpb24gdG8gdGhlIGluc3RhbmNlLXNwZWNpZmljIGhhbmRsZXIKLy8gVGhpcyBmdW5jdGlvbnMgbXVzdCBiZSBkZWNsYXJlZCBpbiB0aGUgVmVnYUJhc2VWaWV3IGNsYXNzCgp2YXIgdmVnYUZ1bmN0aW9ucyA9IHsKICBraWJhbmFBZGRGaWx0ZXI6ICdhZGRGaWx0ZXJIYW5kbGVyJywKICBraWJhbmFSZW1vdmVGaWx0ZXI6ICdyZW1vdmVGaWx0ZXJIYW5kbGVyJywKICBraWJhbmFSZW1vdmVBbGxGaWx0ZXJzOiAncmVtb3ZlQWxsRmlsdGVyc0hhbmRsZXInLAogIGtpYmFuYVNldFRpbWVGaWx0ZXI6ICdzZXRUaW1lRmlsdGVySGFuZGxlcicKfTsKCnZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkgewogIHZhciBmdW5jTmFtZSA9IF9PYmplY3Qka2V5c1tfaV07CgogIGlmICghdmVnYS5leHByZXNzaW9uRnVuY3Rpb24oZnVuY05hbWUpKSB7CiAgICB2ZWdhLmV4cHJlc3Npb25GdW5jdGlvbihmdW5jTmFtZSwgZnVuY3Rpb24gaGFuZGxlckZ3ZCgpIHsKICAgICAgZm9yICh2YXIgX2xlbjIgPSBhcmd1bWVudHMubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4yKSwgX2tleTIgPSAwOyBfa2V5MiA8IF9sZW4yOyBfa2V5MisrKSB7CiAgICAgICAgYXJnc1tfa2V5Ml0gPSBhcmd1bWVudHNbX2tleTJdOwogICAgICB9CgogICAgICB2YXIgdmlldyA9IHRoaXMuY29udGV4dC5kYXRhZmxvdzsKICAgICAgdmlldy5ydW5BZnRlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF92aWV3JF9raWJhbmFWaWV3OwoKICAgICAgICByZXR1cm4gKF92aWV3JF9raWJhbmFWaWV3ID0gdmlldy5fa2liYW5hVmlldykudmVnYUZ1bmN0aW9uc0hhbmRsZXIuYXBwbHkoX3ZpZXckX2tpYmFuYVZpZXcsIFtmdW5jTmFtZV0uY29uY2F0KGFyZ3MpKTsKICAgICAgfSk7CiAgICB9KTsKICB9Cn07Cgpmb3IgKHZhciBfaSA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKHZlZ2FGdW5jdGlvbnMpOyBfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pKyspIHsKICBfbG9vcCgpOwp9Cgp2YXIgYnlwYXNzVG9rZW4gPSBTeW1ib2woKTsKCmZ1bmN0aW9uIGJ5cGFzc0V4dGVybmFsVXJsQ2hlY2sodXJsKSB7CiAgLy8gcHJvY2Vzc2VkIGluIHRoZSAgbG9hZGVyLnNhbml0aXplICBiZWxvdwogIHJldHVybiB7CiAgICB1cmw6IHVybCwKICAgIGJ5cGFzc1Rva2VuOiBieXBhc3NUb2tlbgogIH07Cn0KCnZhciBWZWdhQmFzZVZpZXcgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBWZWdhQmFzZVZpZXcob3B0cykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZlZ2FCYXNlVmlldyk7CgogICAgdGhpcy5fJHBhcmVudEVsID0gKDAsIF9qcXVlcnkuZGVmYXVsdCkob3B0cy5wYXJlbnRFbCk7CiAgICB0aGlzLl9wYXJzZXIgPSBvcHRzLnZlZ2FQYXJzZXI7CiAgICB0aGlzLl9zZXJ2aWNlU2V0dGluZ3MgPSBvcHRzLnNlcnZpY2VTZXR0aW5nczsKICAgIHRoaXMuX2ZpbHRlck1hbmFnZXIgPSBvcHRzLmZpbHRlck1hbmFnZXI7CiAgICB0aGlzLl90aW1lZmlsdGVyID0gb3B0cy50aW1lZmlsdGVyOwogICAgdGhpcy5fZmluZEluZGV4ID0gb3B0cy5maW5kSW5kZXg7CiAgICB0aGlzLl92aWV3ID0gbnVsbDsKICAgIHRoaXMuX3ZlZ2FWaWV3Q29uZmlnID0gbnVsbDsKICAgIHRoaXMuXyRtZXNzYWdlcyA9IG51bGw7CiAgICB0aGlzLl9kZXN0cm95SGFuZGxlcnMgPSBbXTsKICAgIHRoaXMuX2luaXRpYWxpemVkID0gZmFsc2U7CiAgICB0aGlzLl9lbmFibGVFeHRlcm5hbFVybHMgPSAoMCwgX3NlcnZpY2VzLmdldEVuYWJsZUV4dGVybmFsVXJscykoKTsKICB9CgogIF9jcmVhdGVDbGFzcyhWZWdhQmFzZVZpZXcsIFt7CiAgICBrZXk6ICJpbml0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaW5pdCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24sIF9kaWRJdGVyYXRvckVycm9yLCBfaXRlcmF0b3JFcnJvciwgX2l0ZXJhdG9yLCBfc3RlcCwgd2FybjsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pbml0aWFsaXplZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIC8vIHNhZmV0eQogICAgICAgICAgICAgICAgdGhpcy5faW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDM7CgogICAgICAgICAgICAgICAgdGhpcy5fJHBhcmVudEVsLmVtcHR5KCkuYWRkQ2xhc3MoInZnYVZpcyIpLmNzcygnZmxleC1kaXJlY3Rpb24nLCB0aGlzLl9wYXJzZXIuY29udGFpbmVyRGlyKTsgLy8gYnlwYXNzIHRoZSBvbldhcm4gd2FybmluZyBjaGVja3MgLSBpbiBzb21lIGNhc2VzIHdhcm5pbmdzIG1heSBzdGlsbCBuZWVkIHRvIGJlIHNob3duIGRlc3BpdGUgYmVpbmcgZGlzYWJsZWQKCgogICAgICAgICAgICAgICAgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IGZhbHNlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gODsKCiAgICAgICAgICAgICAgICBmb3IgKF9pdGVyYXRvciA9IHRoaXMuX3BhcnNlci53YXJuaW5nc1tTeW1ib2wuaXRlcmF0b3JdKCk7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICB3YXJuID0gX3N0ZXAudmFsdWU7CgogICAgICAgICAgICAgICAgICB0aGlzLl9hZGRNZXNzYWdlKCd3YXJuJywgd2Fybik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDgpOwogICAgICAgICAgICAgICAgX2RpZEl0ZXJhdG9yRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgX2l0ZXJhdG9yRXJyb3IgPSBfY29udGV4dC50MDsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxNzsKCiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxOTsKCiAgICAgICAgICAgICAgICBpZiAoIV9kaWRJdGVyYXRvckVycm9yKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuZmluaXNoKDE5KTsKCiAgICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5maW5pc2goMTYpOwoKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9wYXJzZXIuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLl9hZGRNZXNzYWdlKCdlcnInLCB0aGlzLl9wYXJzZXIuZXJyb3IpOwoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICAgdGhpcy5fJGNvbnRhaW5lciA9ICgwLCBfanF1ZXJ5LmRlZmF1bHQpKCc8ZGl2IGNsYXNzPSJ2Z2FWaXNfX3ZpZXciPicpIC8vIEZvcmNlIGEgaGVpZ2h0IGhlcmUgYmVjYXVzZSBjc3MgaXMgbm90IGxvYWRlZCBpbiBtb2NoYSB0ZXN0CiAgICAgICAgICAgICAgICAuY3NzKCdoZWlnaHQnLCAnMTAwJScpLmFwcGVuZFRvKHRoaXMuXyRwYXJlbnRFbCk7CiAgICAgICAgICAgICAgICB0aGlzLl8kY29udHJvbHMgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgiPGRpdiBjbGFzcz1cInZnYVZpc19fY29udHJvbHMgdmdhVmlzX19jb250cm9scy0tIi5jb25jYXQodGhpcy5fcGFyc2VyLmNvbnRyb2xzRGlyLCAiXCI+IikpLmFwcGVuZFRvKHRoaXMuXyRwYXJlbnRFbCk7CgogICAgICAgICAgICAgICAgdGhpcy5fYWRkRGVzdHJveUhhbmRsZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuXyRjb250YWluZXIpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5fJGNvbnRhaW5lci5yZW1vdmUoKTsKCiAgICAgICAgICAgICAgICAgICAgX3RoaXMuXyRjb250YWluZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuXyRjb250cm9scykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLl8kY29udHJvbHMucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAgICAgIF90aGlzLl8kY29udHJvbHMgPSBudWxsOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuXyRtZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgIF90aGlzLl8kbWVzc2FnZXMucmVtb3ZlKCk7CgogICAgICAgICAgICAgICAgICAgIF90aGlzLl8kbWVzc2FnZXMgPSBudWxsOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX3ZpZXcpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5fdmlldy5maW5hbGl6ZSgpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBfdGhpcy5fdmlldyA9IG51bGw7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICB0aGlzLl92ZWdhVmlld0NvbmZpZyA9IHRoaXMuY3JlYXRlVmlld0NvbmZpZygpOyAvLyBUaGUgZGVyaXZlZCBjbGFzcyBzaG91bGQgY3JlYXRlIHRoaXMgbWV0aG9kCgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2luaXRWaWV3Q3VzdG9taXphdGlvbnMoKTsKCiAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzODsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM1OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDM1OwogICAgICAgICAgICAgICAgX2NvbnRleHQudDEgPSBfY29udGV4dFsiY2F0Y2giXSgzKTsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihfY29udGV4dC50MSk7CgogICAgICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzLCBbWzMsIDM1XSwgWzgsIDEyLCAxNiwgMjRdLCBbMTcsLCAxOSwgMjNdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgcmV0dXJuIF9pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpbml0OwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY3JlYXRlVmlld0NvbmZpZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlVmlld0NvbmZpZygpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgY29uZmlnID0gewogICAgICAgIGxvZ0xldmVsOiB2ZWdhLldhcm4sCiAgICAgICAgcmVuZGVyZXI6IHRoaXMuX3BhcnNlci5yZW5kZXJlcgogICAgICB9OyAvLyBPdmVycmlkZSBVUkwgc2FuaXRpemVyIHRvIHByZXZlbnQgZXh0ZXJuYWwgZGF0YSBsb2FkaW5nIChpZiBkaXNhYmxlZCkKCiAgICAgIHZhciBsb2FkZXIgPSB2ZWdhLmxvYWRlcigpOwogICAgICB2YXIgb3JpZ2luYWxTYW5pdGl6ZSA9IGxvYWRlci5zYW5pdGl6ZS5iaW5kKGxvYWRlcik7CgogICAgICBsb2FkZXIuc2FuaXRpemUgPSBmdW5jdGlvbiAodXJpLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKHVyaS5ieXBhc3NUb2tlbiA9PT0gYnlwYXNzVG9rZW4pIHsKICAgICAgICAgIC8vIElmIHVyaSBoYXMgYSBieXBhc3MgdG9rZW4sIHRoZSB1cmkgd2FzIGVuY29kZWQgYnkgYnlwYXNzRXh0ZXJuYWxVcmxDaGVjaygpIGFib3ZlLgogICAgICAgICAgLy8gYmVjYXVzZSB1c2VyIGNhbiBvbmx5IHN1cHBseSBwdXJlIEpTT04gZGF0YSBzdHJ1Y3R1cmUuCiAgICAgICAgICB1cmkgPSB1cmkudXJsOwogICAgICAgIH0gZWxzZSBpZiAoIV90aGlzMi5fZW5hYmxlRXh0ZXJuYWxVcmxzKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuYmFzZVZpZXcuZXh0ZXJuYWxVcmxzQXJlTm90RW5hYmxlZEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFeHRlcm5hbCBVUkxzIGFyZSBub3QgZW5hYmxlZC4gQWRkICAge2VuYWJsZUV4dGVybmFsVXJsc30gICB0byB7a2liYW5hQ29uZmlnRmlsZU5hbWV9JywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgZW5hYmxlRXh0ZXJuYWxVcmxzOiAndmVnYS5lbmFibGVFeHRlcm5hbFVybHM6IHRydWUnLAogICAgICAgICAgICAgIGtpYmFuYUNvbmZpZ0ZpbGVOYW1lOiAna2liYW5hLnltbCcKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG9yaWdpbmFsU2FuaXRpemUodXJpLCBvcHRpb25zKTsKICAgICAgfTsKCiAgICAgIGNvbmZpZy5sb2FkZXIgPSBsb2FkZXI7CiAgICAgIHJldHVybiBjb25maWc7CiAgICB9CiAgfSwgewogICAga2V5OiAib25FcnJvciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25FcnJvcigpIHsKICAgICAgdGhpcy5fYWRkTWVzc2FnZSgnZXJyJywgX3V0aWxzLlV0aWxzLmZvcm1hdEVycm9yVG9TdHIuYXBwbHkoX3V0aWxzLlV0aWxzLCBhcmd1bWVudHMpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJvbldhcm4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uV2FybigpIHsKICAgICAgaWYgKCF0aGlzLl9wYXJzZXIgfHwgIXRoaXMuX3BhcnNlci5oaWRlV2FybmluZ3MpIHsKICAgICAgICB0aGlzLl9hZGRNZXNzYWdlKCd3YXJuJywgX3V0aWxzLlV0aWxzLmZvcm1hdFdhcm5pbmdUb1N0ci5hcHBseShfdXRpbHMuVXRpbHMsIGFyZ3VtZW50cykpOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiX2FkZE1lc3NhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9hZGRNZXNzYWdlKHR5cGUsIHRleHQpIHsKICAgICAgaWYgKCF0aGlzLl8kbWVzc2FnZXMpIHsKICAgICAgICB0aGlzLl8kbWVzc2FnZXMgPSAoMCwgX2pxdWVyeS5kZWZhdWx0KSgiPHVsIGNsYXNzPVwidmdhVmlzX19tZXNzYWdlc1wiPiIpLmFwcGVuZFRvKHRoaXMuXyRwYXJlbnRFbCk7CiAgICAgIH0KCiAgICAgIHRoaXMuXyRtZXNzYWdlcy5hcHBlbmQoKDAsIF9qcXVlcnkuZGVmYXVsdCkoIjxsaSBjbGFzcz1cInZnYVZpc19fbWVzc2FnZSB2Z2FWaXNfX21lc3NhZ2UtLSIuY29uY2F0KHR5cGUsICJcIj4iKSkuYXBwZW5kKCgwLCBfanF1ZXJ5LmRlZmF1bHQpKCI8cHJlIGNsYXNzPVwidmdhVmlzX19tZXNzYWdlQ29kZVwiPiIpLnRleHQodGV4dCkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZXNpemUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlc2l6ZSgpIHsKICAgICAgaWYgKHRoaXMuX3BhcnNlci51c2VSZXNpemUgJiYgdGhpcy5fdmlldyAmJiB0aGlzLnVwZGF0ZVZlZ2FTaXplKHRoaXMuX3ZpZXcpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX3ZpZXcucnVuQXN5bmMoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVZlZ2FTaXplIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVWZWdhU2l6ZSh2aWV3KSB7CiAgICAgIC8vIEZvciBzb21lIHJlYXNvbiB0aGUgb2JqZWN0IGlzIHNsaWdodGx5IHNjcm9sbGFibGUgd2l0aG91dCB0aGUgZXh0cmEgcGFkZGluZy4KICAgICAgLy8gVGhpcyBtaWdodCBiZSBkdWUgdG8gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvaXNzdWVzLzM4MDgKICAgICAgLy8gV2hpY2ggaXMgYmVpbmcgZml4ZWQgYXMgcGFydCBvZiBqUXVlcnkgMy4zLjAKICAgICAgdmFyIGhlaWdodEV4dHJhUGFkZGluZyA9IDY7CiAgICAgIHZhciB3aWR0aCA9IE1hdGgubWF4KDAsIHRoaXMuXyRjb250YWluZXIud2lkdGgoKSAtIHRoaXMuX3BhcnNlci5wYWRkaW5nV2lkdGgpOwogICAgICB2YXIgaGVpZ2h0ID0gTWF0aC5tYXgoMCwgdGhpcy5fJGNvbnRhaW5lci5oZWlnaHQoKSAtIHRoaXMuX3BhcnNlci5wYWRkaW5nSGVpZ2h0KSAtIGhlaWdodEV4dHJhUGFkZGluZzsgLy8gU29tZWhvdyB0aGUgYGhlaWdodGAgc2lnbmFsIGluIHZlZ2EgYmVjb21lcyB6ZXJvIGlmIHRoZSBoZWlnaHQgaXMgc2V0IGV4YWN0bHkgdG8KICAgICAgLy8gYW4gZXZlbiBudW1iZXIuIFRoaXMgaXMgYSBkaXJ0eSB3b3JrYXJvdW5kIGZvciB0aGlzLgogICAgICAvLyB3aGVuIHZlZ2EgaXRzZWxmIGlzIHVwZGF0ZWQgYWdhaW4sIGl0IHNob3VsZCBiZSBjaGVja2VkIHdoZXRoZXIgdGhpcyBpcyBzdGlsbAogICAgICAvLyBuZWNlc3NhcnkuCgogICAgICB2YXIgYWRqdXN0ZWRIZWlnaHQgPSBoZWlnaHQgKyAwLjAwMDAwMDAxOwoKICAgICAgaWYgKHZpZXcud2lkdGgoKSAhPT0gd2lkdGggfHwgdmlldy5oZWlnaHQoKSAhPT0gYWRqdXN0ZWRIZWlnaHQpIHsKICAgICAgICB2aWV3LndpZHRoKHdpZHRoKS5oZWlnaHQoYWRqdXN0ZWRIZWlnaHQpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Vmlldyh2aWV3KSB7CiAgICAgIGlmICh0aGlzLl92aWV3ID09PSB2aWV3KSByZXR1cm47CgogICAgICBpZiAodGhpcy5fdmlldykgewogICAgICAgIHRoaXMuX3ZpZXcuZmluYWxpemUoKTsKICAgICAgfQoKICAgICAgdGhpcy5fdmlldyA9IHZpZXc7CgogICAgICBpZiAodmlldykgewogICAgICAgIC8vIEdsb2JhbCB2ZWdhIGV4cHJlc3Npb24gaGFuZGxlciB1c2VzIGl0IHRvIGNhbGwgY3VzdG9tIGZ1bmN0aW9ucwogICAgICAgIHZpZXcuX2tpYmFuYVZpZXcgPSB0aGlzOwoKICAgICAgICBpZiAodGhpcy5fcGFyc2VyLnRvb2x0aXBzKSB7CiAgICAgICAgICAvLyBwb3NpdGlvbiBhbmQgcGFkZGluZyBjYW4gYmUgc3BlY2lmaWVkIHdpdGgKICAgICAgICAgIC8vIHtjb25maWc6e2tpYmFuYTp7dG9vbHRpcHM6IHtwb3NpdGlvbjogJ3RvcCcsIHBhZGRpbmc6IDE1IH0gfX19CiAgICAgICAgICB2YXIgdHRoYW5kbGVyID0gbmV3IF92ZWdhX3Rvb2x0aXAuVG9vbHRpcEhhbmRsZXIodGhpcy5fJGNvbnRhaW5lclswXSwgdmlldywgdGhpcy5fcGFyc2VyLnRvb2x0aXBzKTsgLy8gVmVnYSBidWcgd29ya2Fyb3VuZCAtIG5lZWQgdG8gZGVzdHJveSB0b29sdGlwIGJ5IGhhbmQKCiAgICAgICAgICB0aGlzLl9hZGREZXN0cm95SGFuZGxlcihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0dGhhbmRsZXIuaGlkZVRvb2x0aXAoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHZpZXcucnVuQXN5bmMoKTsgLy8gQWxsb3dzIGNhbGxlcnMgdG8gYXdhaXQgcmVuZGVyaW5nCiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSGFuZGxlCiAgICAgKiBAcGFyYW0gZnVuY05hbWUKICAgICAqIEBwYXJhbSBhcmdzCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJ2ZWdhRnVuY3Rpb25zSGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3ZlZ2FGdW5jdGlvbnNIYW5kbGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoZnVuY05hbWUpIHsKICAgICAgICB2YXIgaGFuZGxlckZ1bmMsCiAgICAgICAgICAgIF9sZW4sCiAgICAgICAgICAgIGFyZ3MsCiAgICAgICAgICAgIF9rZXksCiAgICAgICAgICAgIF9hcmdzMiA9IGFyZ3VtZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gMDsKICAgICAgICAgICAgICAgIGhhbmRsZXJGdW5jID0gdmVnYUZ1bmN0aW9uc1tmdW5jTmFtZV07CgogICAgICAgICAgICAgICAgaWYgKCEoIWhhbmRsZXJGdW5jIHx8ICF0aGlzW2hhbmRsZXJGdW5jXSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuYmFzZVZpZXcuZnVuY3Rpb25Jc05vdERlZmluZWRGb3JHcmFwaEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7ZnVuY05hbWV9IGlzIG5vdCBkZWZpbmVkIGZvciB0aGlzIGdyYXBoJywKICAgICAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICAgICAgZnVuY05hbWU6ICIiLmNvbmNhdChmdW5jTmFtZSwgIigpIikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBmb3IgKF9sZW4gPSBfYXJnczIubGVuZ3RoLCBhcmdzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgICAgICAgICAgYXJnc1tfa2V5IC0gMV0gPSBfYXJnczJbX2tleV07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNbaGFuZGxlckZ1bmNdLmFwcGx5KHRoaXMsIGFyZ3MpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gOTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihfY29udGV4dDIudDApOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzLCBbWzAsIDldXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHZlZ2FGdW5jdGlvbnNIYW5kbGVyKF94KSB7CiAgICAgICAgcmV0dXJuIF92ZWdhRnVuY3Rpb25zSGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gdmVnYUZ1bmN0aW9uc0hhbmRsZXI7CiAgICB9KCkKICAgIC8qKgogICAgICogQHBhcmFtIHtvYmplY3R9IHF1ZXJ5IEVsYXN0aWMgUXVlcnkgRFNMIHNuaXBwZXQsIGFzIHVzZWQgaW4gdGhlIHF1ZXJ5IERTTCBlZGl0b3IKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbaW5kZXhdIGFzIGRlZmluZWQgaW4gS2liYW5hLCBvciBkZWZhdWx0IGlmIG1pc3NpbmcKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJhZGRGaWx0ZXJIYW5kbGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfYWRkRmlsdGVySGFuZGxlciA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHF1ZXJ5LCBpbmRleCkgewogICAgICAgIHZhciBpbmRleElkLCBmaWx0ZXI7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kSW5kZXgoaW5kZXgpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleElkID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBmaWx0ZXIgPSBfcHVibGljLmVzRmlsdGVycy5idWlsZFF1ZXJ5RmlsdGVyKHF1ZXJ5LCBpbmRleElkKTsKCiAgICAgICAgICAgICAgICB0aGlzLl9maWx0ZXJNYW5hZ2VyLmFkZEZpbHRlcnMoZmlsdGVyKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gYWRkRmlsdGVySGFuZGxlcihfeDIsIF94MykgewogICAgICAgIHJldHVybiBfYWRkRmlsdGVySGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gYWRkRmlsdGVySGFuZGxlcjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBAcGFyYW0ge29iamVjdH0gcXVlcnkgRWxhc3RpYyBRdWVyeSBEU0wgc25pcHBldCwgYXMgdXNlZCBpbiB0aGUgcXVlcnkgRFNMIGVkaXRvcgogICAgICogQHBhcmFtIHtzdHJpbmd9IFtpbmRleF0gYXMgZGVmaW5lZCBpbiBLaWJhbmEsIG9yIGRlZmF1bHQgaWYgbWlzc2luZwogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUZpbHRlckhhbmRsZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9yZW1vdmVGaWx0ZXJIYW5kbGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQocXVlcnksIGluZGV4KSB7CiAgICAgICAgdmFyIGluZGV4SWQsIGZpbHRlclRvUmVtb3ZlLCBjdXJyZW50RmlsdGVycywgZXhpc3RpbmdGaWx0ZXI7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kSW5kZXgoaW5kZXgpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpbmRleElkID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBmaWx0ZXJUb1JlbW92ZSA9IF9wdWJsaWMuZXNGaWx0ZXJzLmJ1aWxkUXVlcnlGaWx0ZXIocXVlcnksIGluZGV4SWQpOwogICAgICAgICAgICAgICAgY3VycmVudEZpbHRlcnMgPSB0aGlzLl9maWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKTsKICAgICAgICAgICAgICAgIGV4aXN0aW5nRmlsdGVyID0gY3VycmVudEZpbHRlcnMuZmluZChmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfcHVibGljLmVzRmlsdGVycy5jb21wYXJlRmlsdGVycyhmaWx0ZXIsIGZpbHRlclRvUmVtb3ZlKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ0ZpbHRlcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgdGhpcy5fZmlsdGVyTWFuYWdlci5yZW1vdmVGaWx0ZXIoZXhpc3RpbmdGaWx0ZXIpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihlcnIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiByZW1vdmVGaWx0ZXJIYW5kbGVyKF94NCwgX3g1KSB7CiAgICAgICAgcmV0dXJuIF9yZW1vdmVGaWx0ZXJIYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZW1vdmVGaWx0ZXJIYW5kbGVyOwogICAgfSgpCiAgfSwgewogICAga2V5OiAicmVtb3ZlQWxsRmlsdGVyc0hhbmRsZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUFsbEZpbHRlcnNIYW5kbGVyKCkgewogICAgICB0aGlzLl9maWx0ZXJNYW5hZ2VyLnJlbW92ZUFsbCgpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgZGFzaGJvYXJkIHRpbWUgZmlsdGVyIHRvIHRoZSBuZXcgdmFsdWVzCiAgICAgKiBAcGFyYW0ge251bWJlcnxzdHJpbmd8RGF0ZX0gc3RhcnQKICAgICAqIEBwYXJhbSB7bnVtYmVyfHN0cmluZ3xEYXRlfSBlbmQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRUaW1lRmlsdGVySGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0VGltZUZpbHRlckhhbmRsZXIoc3RhcnQsIGVuZCkgewogICAgICB0aGlzLl90aW1lZmlsdGVyLnNldFRpbWUoVmVnYUJhc2VWaWV3Ll9wYXJzZVRpbWVSYW5nZShzdGFydCwgZW5kKSk7CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIHN0YXJ0IGFuZCBlbmQgdmFsdWVzLCBkZXRlcm1pbmluZyB0aGUgbW9kZSwgYW5kIGlmIG9yZGVyIHNob3VsZCBiZSByZXZlcnNlZAogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXREZWJ1Z1ZhbHVlcyIsCgogICAgLyoqCiAgICAgKiBTZXQgZ2xvYmFsIGRlYnVnIHZhcmlhYmxlIHRvIHNpbXBsaWZ5IHZlZ2EgZGVidWdnaW5nIGluIGNvbnNvbGUuIFNob3cgaW5mbyBtZXNzYWdlIGZpcnN0IHRpbWUKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHNldERlYnVnVmFsdWVzKHZpZXcsIHNwZWMsIHZsc3BlYykgewogICAgICBpZiAod2luZG93KSB7CiAgICAgICAgaWYgKHdpbmRvdy5WRUdBX0RFQlVHID09PSB1bmRlZmluZWQgJiYgY29uc29sZSkgewogICAgICAgICAgY29uc29sZS5sb2coJyVjV2VsY29tZSB0byBLaWJhbmEgVmVnYSBQbHVnaW4hJywgJ2ZvbnQtc2l6ZTogMTZweDsgZm9udC13ZWlnaHQ6IGJvbGQ7Jyk7CiAgICAgICAgICBjb25zb2xlLmxvZygnWW91IGNhbiBhY2Nlc3MgdGhlIFZlZ2EgdmlldyB3aXRoIFZFR0FfREVCVUcuICcgKyAnTGVhcm4gbW9yZSBhdCBodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3ZlZ2EvZG9jcy9hcGkvZGVidWdnaW5nLy4nKTsKICAgICAgICB9CgogICAgICAgIHZhciBkZWJ1Z09iaiA9IHt9OwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHID0gZGVidWdPYmo7CiAgICAgICAgd2luZG93LlZFR0FfREVCVUcuVkVHQV9WRVJTSU9OID0gdmVnYS52ZXJzaW9uOwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHLlZFR0FfTElURV9WRVJTSU9OID0gdmVnYUxpdGUudmVyc2lvbjsKICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRy52aWV3ID0gdmlldzsKICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRy52ZWdhX3NwZWMgPSBzcGVjOwogICAgICAgIHdpbmRvdy5WRUdBX0RFQlVHLnZlZ2FsaXRlX3NwZWMgPSB2bHNwZWM7IC8vIE9uIGRpc3Bvc2UsIGNsZWFuIHVwLCBidXQgZG9uJ3QgdXNlIHVuZGVmaW5lZCB0byBwcmV2ZW50IHJlcGVhdGVkIGRlYnVnIHN0YXRlbWVudHMKCiAgICAgICAgdGhpcy5fYWRkRGVzdHJveUhhbmRsZXIoZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKGRlYnVnT2JqID09PSB3aW5kb3cuVkVHQV9ERUJVRykgewogICAgICAgICAgICB3aW5kb3cuVkVHQV9ERUJVRyA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICAvLyBwcm9wZXJseSBoYW5kbGUgbXVsdGlwbGUgZGVzdHJveSgpIGNhbGxzIGJ5IGNvbnZlcnRpbmcgdGhpcy5fZGVzdHJveUhhbmRsZXJzCiAgICAgIC8vIGludG8gdGhlIF9vbmdvaW5nRGVzdHJveSBwcm9taXNlLCB3aGlsZSBoYW5kbGVycyBhcmUgYmVpbmcgZGlzcG9zZWQKICAgICAgaWYgKHRoaXMuX2Rlc3Ryb3lIYW5kbGVycykgewogICAgICAgIC8vIElmIG5vIGRlc3Ryb3kgaXMgeWV0IHJ1bm5pbmcsIGV4ZWN1dGUgYWxsIGhhbmRsZXJzIGFuZCB3YWl0IGZvciBhbGwgb2YgdGhlbSB0byByZXNvbHZlLgogICAgICAgIHRoaXMuX29uZ29pbmdEZXN0cm95ID0gUHJvbWlzZS5hbGwodGhpcy5fZGVzdHJveUhhbmRsZXJzLm1hcChmdW5jdGlvbiAodikgewogICAgICAgICAgcmV0dXJuIHYoKTsKICAgICAgICB9KSk7CiAgICAgICAgdGhpcy5fZGVzdHJveUhhbmRsZXJzID0gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuX29uZ29pbmdEZXN0cm95OwogICAgfQogIH0sIHsKICAgIGtleTogIl9hZGREZXN0cm95SGFuZGxlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2FkZERlc3Ryb3lIYW5kbGVyKGhhbmRsZXIpIHsKICAgICAgLy8gSWYgZGlzcG9zaW5nIGhhc24ndCBzdGFydGVkIHlldCwgZW5xdWV1ZSBpdCwgb3RoZXJ3aXNlIGRpc3Bvc2UgcmlnaHQgYXdheQogICAgICAvLyBUaGlzIGNyZWF0ZXMgYSBtaW5vciBpc3N1ZSAtIGlmIGRpc3Bvc2luZyBoYXMgc3RhcnRlZCBidXQgbm90IHlldCBmaW5pc2hlZCwKICAgICAgLy8gYW5kIHdlIGRpc3Bvc2UgdGhlIG5ldyBoYW5kbGVyIHJpZ2h0IGF3YXksIHRoZSBkZXN0cm95KCkgZG9lcyBub3Qgd2FpdCBmb3IgaXQuCiAgICAgIC8vIFRoaXMgYmVoYXZpb3IgaXMgbm8gZGlmZmVyZW50IGZyb20gdGhlIGNhc2Ugd2hlbiBkaXNwb3NpbmcgaGFzIGFscmVhZHkgY29tcGxldGVkLAogICAgICAvLyBzbyBpdCBzaG91bGRuJ3QgY3JlYXRlIGFueSBpc3N1ZXMuCiAgICAgIGlmICh0aGlzLl9kZXN0cm95SGFuZGxlcnMpIHsKICAgICAgICB0aGlzLl9kZXN0cm95SGFuZGxlcnMucHVzaChoYW5kbGVyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBoYW5kbGVyKCk7CiAgICAgIH0KICAgIH0KICB9XSwgW3sKICAgIGtleTogIl9wYXJzZVRpbWVSYW5nZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlVGltZVJhbmdlKHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIGFic1N0YXJ0ID0gKDAsIF9tb21lbnQuZGVmYXVsdCkoc3RhcnQpOwogICAgICB2YXIgYWJzRW5kID0gKDAsIF9tb21lbnQuZGVmYXVsdCkoZW5kKTsKICAgICAgdmFyIGlzVmFsaWRBYnNTdGFydCA9IGFic1N0YXJ0LmlzVmFsaWQoKTsKICAgICAgdmFyIGlzVmFsaWRBYnNFbmQgPSBhYnNFbmQuaXNWYWxpZCgpOwogICAgICB2YXIgbW9kZSA9ICdhYnNvbHV0ZSc7CiAgICAgIHZhciBmcm9tOwogICAgICB2YXIgdG87CiAgICAgIHZhciByZXZlcnNlOwoKICAgICAgaWYgKGlzVmFsaWRBYnNTdGFydCAmJiBpc1ZhbGlkQWJzRW5kKSB7CiAgICAgICAgLy8gQm90aCBhcmUgdmFsaWQgYWJzb2x1dGUgZGF0ZXMuCiAgICAgICAgZnJvbSA9IGFic1N0YXJ0OwogICAgICAgIHRvID0gYWJzRW5kOwogICAgICAgIHJldmVyc2UgPSBhYnNTdGFydC5pc0FmdGVyKGFic0VuZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFzIHJlbGF0aXZlIGRhdGVzIHRvbyAoYWJzb2x1dGUgZGF0ZXMgd2lsbCBhbHNvIGJlIGFjY2VwdGVkKQogICAgICAgIHZhciBzdGFydERhdGUgPSBfZGF0ZW1hdGguZGVmYXVsdC5wYXJzZShzdGFydCk7CgogICAgICAgIHZhciBlbmREYXRlID0gX2RhdGVtYXRoLmRlZmF1bHQucGFyc2UoZW5kKTsKCiAgICAgICAgaWYgKCFzdGFydERhdGUgfHwgIWVuZERhdGUgfHwgIXN0YXJ0RGF0ZS5pc1ZhbGlkKCkgfHwgIWVuZERhdGUuaXNWYWxpZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuYmFzZVZpZXcudGltZVZhbHVlc1R5cGVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3Igc2V0dGluZyB0aW1lIGZpbHRlcjogYm90aCB0aW1lIHZhbHVlcyBtdXN0IGJlIGVpdGhlciByZWxhdGl2ZSBvciBhYnNvbHV0ZSBkYXRlcy4ge3N0YXJ0fSwge2VuZH0nLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBzdGFydDogInN0YXJ0PSIuY29uY2F0KEpTT04uc3RyaW5naWZ5KHN0YXJ0KSksCiAgICAgICAgICAgICAgZW5kOiAiZW5kPSIuY29uY2F0KEpTT04uc3RyaW5naWZ5KGVuZCkpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CgogICAgICAgIHJldmVyc2UgPSBzdGFydERhdGUuaXNBZnRlcihlbmREYXRlKTsKCiAgICAgICAgaWYgKGlzVmFsaWRBYnNTdGFydCB8fCBpc1ZhbGlkQWJzRW5kKSB7CiAgICAgICAgICAvLyBNaXhpbmcgcmVsYXRpdmUgYW5kIGFic29sdXRlIC0gdHJlYXQgdGhlbSBhcyBhYnNvbHV0ZQogICAgICAgICAgZnJvbSA9IHN0YXJ0RGF0ZTsKICAgICAgICAgIHRvID0gZW5kRGF0ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gQm90aCBkYXRlcyBhcmUgcmVsYXRpdmUKICAgICAgICAgIG1vZGUgPSAncmVsYXRpdmUnOwogICAgICAgICAgZnJvbSA9IHN0YXJ0OwogICAgICAgICAgdG8gPSBlbmQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgIHZhciBfcmVmID0gW3RvLCBmcm9tXTsKICAgICAgICBmcm9tID0gX3JlZlswXTsKICAgICAgICB0byA9IF9yZWZbMV07CiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICB0bzogdG8sCiAgICAgICAgbW9kZTogbW9kZQogICAgICB9OwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFZlZ2FCYXNlVmlldzsKfSgpOwoKZXhwb3J0cy5WZWdhQmFzZVZpZXcgPSBWZWdhQmFzZVZpZXc7"},null]}