{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/discover/np_ready/embeddable/search_embeddable.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/discover/np_ready/embeddable/search_embeddable.js","mtime":1589249549714},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuU2VhcmNoRW1iZWRkYWJsZSA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgUnggPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyeGpzIikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy9wbHVnaW5zL3VpX2FjdGlvbnMvcHVibGljIik7Cgp2YXIgX3B1YmxpYzIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wbHVnaW5zL2luc3BlY3Rvci9wdWJsaWMiKTsKCnZhciBfcHVibGljMyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCnZhciBfcHVibGljNCA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL2VtYmVkZGFibGVfYXBpL3B1YmxpYy9ucF9yZWFkeS9wdWJsaWMiKTsKCnZhciBjb2x1bW5BY3Rpb25zID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgiLi4vYW5ndWxhci9kb2NfdGFibGUvYWN0aW9ucy9jb2x1bW5zIikpOwoKdmFyIF9zZWFyY2hfdGVtcGxhdGUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vc2VhcmNoX3RlbXBsYXRlLmh0bWwiKSk7Cgp2YXIgX2dldF9zb3J0X2Zvcl9zZWFyY2hfc291cmNlID0gcmVxdWlyZSgiLi4vYW5ndWxhci9kb2NfdGFibGUvbGliL2dldF9zb3J0X2Zvcl9zZWFyY2hfc291cmNlIik7Cgp2YXIgX2tpYmFuYV9zZXJ2aWNlcyA9IHJlcXVpcmUoIi4uLy4uL2tpYmFuYV9zZXJ2aWNlcyIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7CiAgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgewogICAgcmV0dXJuIGNhbGw7CiAgfQoKICByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyKSB7CiAgaWYgKHR5cGVvZiBSZWZsZWN0ICE9PSAidW5kZWZpbmVkIiAmJiBSZWZsZWN0LmdldCkgewogICAgX2dldCA9IFJlZmxlY3QuZ2V0OwogIH0gZWxzZSB7CiAgICBfZ2V0ID0gZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogICAgICB2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldCwgcHJvcGVydHkpOwoKICAgICAgaWYgKCFiYXNlKSByZXR1cm47CiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihiYXNlLCBwcm9wZXJ0eSk7CgogICAgICBpZiAoZGVzYy5nZXQpIHsKICAgICAgICByZXR1cm4gZGVzYy5nZXQuY2FsbChyZWNlaXZlcik7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXNjLnZhbHVlOwogICAgfTsKICB9CgogIHJldHVybiBfZ2V0KHRhcmdldCwgcHJvcGVydHksIHJlY2VpdmVyIHx8IHRhcmdldCk7Cn0KCmZ1bmN0aW9uIF9zdXBlclByb3BCYXNlKG9iamVjdCwgcHJvcGVydHkpIHsKICB3aGlsZSAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KSkgewogICAgb2JqZWN0ID0gX2dldFByb3RvdHlwZU9mKG9iamVjdCk7CiAgICBpZiAob2JqZWN0ID09PSBudWxsKSBicmVhazsKICB9CgogIHJldHVybiBvYmplY3Q7Cn0KCmZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsKICAgIHJldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7CiAgfTsKICByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIFNlYXJjaEVtYmVkZGFibGUgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uIChfRW1iZWRkYWJsZSkgewogIF9pbmhlcml0cyhTZWFyY2hFbWJlZGRhYmxlLCBfRW1iZWRkYWJsZSk7CgogIGZ1bmN0aW9uIFNlYXJjaEVtYmVkZGFibGUoX3JlZiwgaW5pdGlhbElucHV0LCBleGVjdXRlVHJpZ2dlckFjdGlvbnMsIHBhcmVudCkgewogICAgdmFyIF90aGlzOwoKICAgIHZhciAkcm9vdFNjb3BlID0gX3JlZi4kcm9vdFNjb3BlLAogICAgICAgICRjb21waWxlID0gX3JlZi4kY29tcGlsZSwKICAgICAgICBzYXZlZFNlYXJjaCA9IF9yZWYuc2F2ZWRTZWFyY2gsCiAgICAgICAgZWRpdFVybCA9IF9yZWYuZWRpdFVybCwKICAgICAgICBpbmRleFBhdHRlcm5zID0gX3JlZi5pbmRleFBhdHRlcm5zLAogICAgICAgIGVkaXRhYmxlID0gX3JlZi5lZGl0YWJsZSwKICAgICAgICBmaWx0ZXJNYW5hZ2VyID0gX3JlZi5maWx0ZXJNYW5hZ2VyOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTZWFyY2hFbWJlZGRhYmxlKTsKCiAgICBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9nZXRQcm90b3R5cGVPZihTZWFyY2hFbWJlZGRhYmxlKS5jYWxsKHRoaXMsIGluaXRpYWxJbnB1dCwgewogICAgICBkZWZhdWx0VGl0bGU6IHNhdmVkU2VhcmNoLnRpdGxlLAogICAgICBlZGl0VXJsOiBlZGl0VXJsLAogICAgICBpbmRleFBhdHRlcm5zOiBpbmRleFBhdHRlcm5zLAogICAgICBlZGl0YWJsZTogZWRpdGFibGUKICAgIH0sIHBhcmVudCkpOwogICAgX3RoaXMuZXhlY3V0ZVRyaWdnZXJBY3Rpb25zID0gZXhlY3V0ZVRyaWdnZXJBY3Rpb25zOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmVkU2VhcmNoIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICIkcm9vdFNjb3BlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICIkY29tcGlsZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5zcGVjdG9yQWRhcHRvcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaFNjb3BlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwYW5lbFRpdGxlIiwgJycpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZpbHRlcnNTZWFyY2hTb3VyY2UiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNlYXJjaEluc3RhbmNlIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJhdXRvUmVmcmVzaEZldGNoU3Vic2NyaXB0aW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInR5cGUiLCBfY29uc3RhbnRzLlNFQVJDSF9FTUJFRERBQkxFX1RZUEUpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImZpbHRlck1hbmFnZXIiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFib3J0Q29udHJvbGxlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicHJldlRpbWVSYW5nZSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAicHJldkZpbHRlcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInByZXZRdWVyeSIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZmV0Y2giLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgc2VhcmNoU291cmNlLCB0aXRsZSwgZGVzY3JpcHRpb24sIGluc3BlY3RvclJlcXVlc3QsIHJlc3A7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoX3RoaXMuc2VhcmNoU2NvcGUpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBzZWFyY2hTb3VyY2UgPSBfdGhpcy5zYXZlZFNlYXJjaC5zZWFyY2hTb3VyY2U7IC8vIEFib3J0IGFueSBpbi1wcm9ncmVzcyByZXF1ZXN0cwoKICAgICAgICAgICAgICBpZiAoX3RoaXMuYWJvcnRDb250cm9sbGVyKSBfdGhpcy5hYm9ydENvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBfdGhpcy5hYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdzaXplJywgKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0U2VydmljZXMpKCkudWlTZXR0aW5ncy5nZXQoJ2Rpc2NvdmVyOnNhbXBsZVNpemUnKSk7CiAgICAgICAgICAgICAgc2VhcmNoU291cmNlLnNldEZpZWxkKCdzb3J0JywgKDAsIF9nZXRfc29ydF9mb3Jfc2VhcmNoX3NvdXJjZS5nZXRTb3J0Rm9yU2VhcmNoU291cmNlKShfdGhpcy5zZWFyY2hTY29wZS5zb3J0LCBfdGhpcy5zZWFyY2hTY29wZS5pbmRleFBhdHRlcm4sICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldFNlcnZpY2VzKSgpLnVpU2V0dGluZ3MuZ2V0KCdkaXNjb3Zlcjpzb3J0OmRlZmF1bHRPcmRlcicpKSk7IC8vIExvZyByZXF1ZXN0IHRvIGluc3BlY3RvcgoKICAgICAgICAgICAgICBfdGhpcy5pbnNwZWN0b3JBZGFwdG9ycy5yZXF1ZXN0cy5yZXNldCgpOwoKICAgICAgICAgICAgICB0aXRsZSA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZW1iZWRkYWJsZS5pbnNwZWN0b3JSZXF1ZXN0RGF0YVRpdGxlJywgewogICAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEYXRhJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5lbWJlZGRhYmxlLmluc3BlY3RvclJlcXVlc3REZXNjcmlwdGlvbicsIHsKICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVGhpcyByZXF1ZXN0IHF1ZXJpZXMgRWxhc3RpY3NlYXJjaCB0byBmZXRjaCB0aGUgZGF0YSBmb3IgdGhlIHNlYXJjaC4nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaW5zcGVjdG9yUmVxdWVzdCA9IF90aGlzLmluc3BlY3RvckFkYXB0b3JzLnJlcXVlc3RzLnN0YXJ0KHRpdGxlLCB7CiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpbnNwZWN0b3JSZXF1ZXN0LnN0YXRzKCgwLCBfa2liYW5hX3NlcnZpY2VzLmdldFJlcXVlc3RJbnNwZWN0b3JTdGF0cykoc2VhcmNoU291cmNlKSk7CiAgICAgICAgICAgICAgc2VhcmNoU291cmNlLmdldFNlYXJjaFJlcXVlc3RCb2R5KCkudGhlbihmdW5jdGlvbiAoYm9keSkgewogICAgICAgICAgICAgICAgaW5zcGVjdG9yUmVxdWVzdC5qc29uKGJvZHkpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF90aGlzLnNlYXJjaFNjb3BlLmlzTG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE0OwogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgICByZXR1cm4gc2VhcmNoU291cmNlLmZldGNoKHsKICAgICAgICAgICAgICAgIGFib3J0U2lnbmFsOiBfdGhpcy5hYm9ydENvbnRyb2xsZXIuc2lnbmFsCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgIHJlc3AgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgIF90aGlzLnNlYXJjaFNjb3BlLmlzTG9hZGluZyA9IGZhbHNlOyAvLyBMb2cgcmVzcG9uc2UgdG8gaW5zcGVjdG9yCgogICAgICAgICAgICAgIGluc3BlY3RvclJlcXVlc3Quc3RhdHMoKDAsIF9raWJhbmFfc2VydmljZXMuZ2V0UmVzcG9uc2VJbnNwZWN0b3JTdGF0cykoc2VhcmNoU291cmNlLCByZXNwKSkub2soewogICAgICAgICAgICAgICAganNvbjogcmVzcAogICAgICAgICAgICAgIH0pOyAvLyBBcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgYW5ndWxhciBzY29wZQoKICAgICAgICAgICAgICBfdGhpcy5zZWFyY2hTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoU2NvcGUuaGl0cyA9IHJlc3AuaGl0cy5oaXRzOwogICAgICAgICAgICAgICAgX3RoaXMuc2VhcmNoU2NvcGUudG90YWxIaXRDb3VudCA9IHJlc3AuaGl0cy50b3RhbDsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI4OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAyMzoKICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMjM7CiAgICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgxNCk7CgogICAgICAgICAgICAgIGlmICghKF9jb250ZXh0LnQwLm5hbWUgPT09ICdBYm9ydEVycm9yJykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI3OgogICAgICAgICAgICAgICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldFNlcnZpY2VzKSgpLnRvYXN0Tm90aWZpY2F0aW9ucy5hZGRFcnJvcihfY29udGV4dC50MCwgewogICAgICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZW1iZWRkYWJsZS5lcnJvclRpdGxlJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIGZldGNoaW5nIGRhdGEnCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxNCwgMjNdXSk7CiAgICB9KSkpOwoKICAgIF90aGlzLmZpbHRlck1hbmFnZXIgPSBmaWx0ZXJNYW5hZ2VyOwogICAgX3RoaXMuc2F2ZWRTZWFyY2ggPSBzYXZlZFNlYXJjaDsKICAgIF90aGlzLiRyb290U2NvcGUgPSAkcm9vdFNjb3BlOwogICAgX3RoaXMuJGNvbXBpbGUgPSAkY29tcGlsZTsKICAgIF90aGlzLmluc3BlY3RvckFkYXB0b3JzID0gewogICAgICByZXF1ZXN0czogbmV3IF9wdWJsaWMyLlJlcXVlc3RBZGFwdGVyKCkKICAgIH07CgogICAgX3RoaXMuaW5pdGlhbGl6ZVNlYXJjaFNjb3BlKCk7CgogICAgX3RoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbiA9ICgwLCBfa2liYW5hX3NlcnZpY2VzLmdldFNlcnZpY2VzKSgpLnRpbWVmaWx0ZXIuZ2V0QXV0b1JlZnJlc2hGZXRjaCQoKS5zdWJzY3JpYmUoX3RoaXMuZmV0Y2gpOwogICAgX3RoaXMuc3Vic2NyaXB0aW9uID0gUngubWVyZ2UoX3RoaXMuZ2V0T3V0cHV0JCgpLCBfdGhpcy5nZXRJbnB1dCQoKSkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMucGFuZWxUaXRsZSA9IF90aGlzLm91dHB1dC50aXRsZSB8fCAnJzsKCiAgICAgIGlmIChfdGhpcy5zZWFyY2hTY29wZSkgewogICAgICAgIF90aGlzLnB1c2hDb250YWluZXJTdGF0ZVBhcmFtc1RvU2NvcGUoX3RoaXMuc2VhcmNoU2NvcGUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhTZWFyY2hFbWJlZGRhYmxlLCBbewogICAga2V5OiAiZ2V0SW5zcGVjdG9yQWRhcHRlcnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEluc3BlY3RvckFkYXB0ZXJzKCkgewogICAgICByZXR1cm4gdGhpcy5pbnNwZWN0b3JBZGFwdG9yczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTYXZlZFNlYXJjaCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U2F2ZWRTZWFyY2goKSB7CiAgICAgIHJldHVybiB0aGlzLnNhdmVkU2VhcmNoOwogICAgfQogICAgLyoqCiAgICAgKgogICAgICogQHBhcmFtIHtFbGVtZW50fSBkb21Ob2RlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVuZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXIoZG9tTm9kZSkgewogICAgICBpZiAoIXRoaXMuc2VhcmNoU2NvcGUpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlYXJjaCBzY29wZSBub3QgZGVmaW5lZCcpOwogICAgICB9CgogICAgICB0aGlzLnNlYXJjaEluc3RhbmNlID0gdGhpcy4kY29tcGlsZShfc2VhcmNoX3RlbXBsYXRlLmRlZmF1bHQpKHRoaXMuc2VhcmNoU2NvcGUpOwoKICAgICAgdmFyIHJvb3ROb2RlID0gX2tpYmFuYV9zZXJ2aWNlcy5hbmd1bGFyLmVsZW1lbnQoZG9tTm9kZSk7CgogICAgICByb290Tm9kZS5hcHBlbmQodGhpcy5zZWFyY2hJbnN0YW5jZSk7CiAgICAgIHRoaXMucHVzaENvbnRhaW5lclN0YXRlUGFyYW1zVG9TY29wZSh0aGlzLnNlYXJjaFNjb3BlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihTZWFyY2hFbWJlZGRhYmxlLnByb3RvdHlwZSksICJkZXN0cm95IiwgdGhpcykuY2FsbCh0aGlzKTsKCiAgICAgIHRoaXMuc2F2ZWRTZWFyY2guZGVzdHJveSgpOwoKICAgICAgaWYgKHRoaXMuc2VhcmNoSW5zdGFuY2UpIHsKICAgICAgICB0aGlzLnNlYXJjaEluc3RhbmNlLnJlbW92ZSgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5zZWFyY2hTY29wZSkgewogICAgICAgIHRoaXMuc2VhcmNoU2NvcGUuJGRlc3Ryb3koKTsKICAgICAgICBkZWxldGUgdGhpcy5zZWFyY2hTY29wZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9uKSB7CiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbikgewogICAgICAgIHRoaXMuYXV0b1JlZnJlc2hGZXRjaFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgICB9CgogICAgICBpZiAodGhpcy5hYm9ydENvbnRyb2xsZXIpIHRoaXMuYWJvcnRDb250cm9sbGVyLmFib3J0KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaW5pdGlhbGl6ZVNlYXJjaFNjb3BlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplU2VhcmNoU2NvcGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIHNlYXJjaFNjb3BlID0gdGhpcy5zZWFyY2hTY29wZSA9IHRoaXMuJHJvb3RTY29wZS4kbmV3KCk7CiAgICAgIHNlYXJjaFNjb3BlLmRlc2NyaXB0aW9uID0gdGhpcy5zYXZlZFNlYXJjaC5kZXNjcmlwdGlvbjsKICAgICAgc2VhcmNoU2NvcGUuaW5zcGVjdG9yQWRhcHRlcnMgPSB0aGlzLmluc3BlY3RvckFkYXB0b3JzOwogICAgICB2YXIgc2VhcmNoU291cmNlID0gdGhpcy5zYXZlZFNlYXJjaC5zZWFyY2hTb3VyY2U7CiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSBzZWFyY2hTY29wZS5pbmRleFBhdHRlcm4gPSBzZWFyY2hTb3VyY2UuZ2V0RmllbGQoJ2luZGV4Jyk7CiAgICAgIHZhciB0aW1lUmFuZ2VTZWFyY2hTb3VyY2UgPSBzZWFyY2hTb3VyY2UuY3JlYXRlKCk7CiAgICAgIHRpbWVSYW5nZVNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnZmlsdGVyJywgZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghX3RoaXMyLnNlYXJjaFNjb3BlIHx8ICFfdGhpczIuaW5wdXQudGltZVJhbmdlKSByZXR1cm47CiAgICAgICAgcmV0dXJuICgwLCBfcHVibGljMy5nZXRUaW1lKShpbmRleFBhdHRlcm4sIF90aGlzMi5pbnB1dC50aW1lUmFuZ2UpOwogICAgICB9KTsKICAgICAgdGhpcy5maWx0ZXJzU2VhcmNoU291cmNlID0gc2VhcmNoU291cmNlLmNyZWF0ZSgpOwogICAgICB0aGlzLmZpbHRlcnNTZWFyY2hTb3VyY2Uuc2V0UGFyZW50KHRpbWVSYW5nZVNlYXJjaFNvdXJjZSk7CiAgICAgIHNlYXJjaFNvdXJjZS5zZXRQYXJlbnQodGhpcy5maWx0ZXJzU2VhcmNoU291cmNlKTsKICAgICAgdGhpcy5wdXNoQ29udGFpbmVyU3RhdGVQYXJhbXNUb1Njb3BlKHNlYXJjaFNjb3BlKTsKCiAgICAgIHNlYXJjaFNjb3BlLnNldFNvcnRPcmRlciA9IGZ1bmN0aW9uIChzb3J0KSB7CiAgICAgICAgX3RoaXMyLnVwZGF0ZUlucHV0KHsKICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHNlYXJjaFNjb3BlLmFkZENvbHVtbiA9IGZ1bmN0aW9uIChjb2x1bW5OYW1lKSB7CiAgICAgICAgaWYgKCFzZWFyY2hTY29wZS5jb2x1bW5zKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpbmRleFBhdHRlcm4ucG9wdWxhcml6ZUZpZWxkKGNvbHVtbk5hbWUsIDEpOwogICAgICAgIHZhciBjb2x1bW5zID0gY29sdW1uQWN0aW9ucy5hZGRDb2x1bW4oc2VhcmNoU2NvcGUuY29sdW1ucywgY29sdW1uTmFtZSk7CgogICAgICAgIF90aGlzMi51cGRhdGVJbnB1dCh7CiAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zCiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBzZWFyY2hTY29wZS5yZW1vdmVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uTmFtZSkgewogICAgICAgIGlmICghc2VhcmNoU2NvcGUuY29sdW1ucykgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbHVtbnMgPSBjb2x1bW5BY3Rpb25zLnJlbW92ZUNvbHVtbihzZWFyY2hTY29wZS5jb2x1bW5zLCBjb2x1bW5OYW1lKTsKCiAgICAgICAgX3RoaXMyLnVwZGF0ZUlucHV0KHsKICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnMKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHNlYXJjaFNjb3BlLm1vdmVDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uTmFtZSwgbmV3SW5kZXgpIHsKICAgICAgICBpZiAoIXNlYXJjaFNjb3BlLmNvbHVtbnMpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBjb2x1bW5zID0gY29sdW1uQWN0aW9ucy5tb3ZlQ29sdW1uKHNlYXJjaFNjb3BlLmNvbHVtbnMsIGNvbHVtbk5hbWUsIG5ld0luZGV4KTsKCiAgICAgICAgX3RoaXMyLnVwZGF0ZUlucHV0KHsKICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnMKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHNlYXJjaFNjb3BlLmZpbHRlciA9CiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihmaWVsZCwgdmFsdWUsIG9wZXJhdG9yKSB7CiAgICAgICAgICB2YXIgZmlsdGVyczsKICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgIGZpbHRlcnMgPSBfcHVibGljMy5lc0ZpbHRlcnMuZ2VuZXJhdGVGaWx0ZXJzKF90aGlzMi5maWx0ZXJNYW5hZ2VyLCBmaWVsZCwgdmFsdWUsIG9wZXJhdG9yLCBpbmRleFBhdHRlcm4uaWQpOwogICAgICAgICAgICAgICAgICBmaWx0ZXJzID0gZmlsdGVycy5tYXAoZnVuY3Rpb24gKGZpbHRlcikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBmaWx0ZXIsIHsKICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZTogewogICAgICAgICAgICAgICAgICAgICAgICBzdG9yZTogX3B1YmxpYzMuZXNGaWx0ZXJzLkZpbHRlclN0YXRlU3RvcmUuQVBQX1NUQVRFCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZXhlY3V0ZVRyaWdnZXJBY3Rpb25zKF9wdWJsaWMuQVBQTFlfRklMVEVSX1RSSUdHRVIsIHsKICAgICAgICAgICAgICAgICAgICBlbWJlZGRhYmxlOiBfdGhpczIsCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogZmlsdGVycwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgICB9KSk7CgogICAgICAgIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICAgICAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICB9OwogICAgICB9KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIHRoaXMuZmV0Y2goKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwdXNoQ29udGFpbmVyU3RhdGVQYXJhbXNUb1Njb3BlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwdXNoQ29udGFpbmVyU3RhdGVQYXJhbXNUb1Njb3BlKHNlYXJjaFNjb3BlKSB7CiAgICAgIHZhciBpc0ZldGNoUmVxdWlyZWQgPSAhX3B1YmxpYzMuZXNGaWx0ZXJzLm9ubHlEaXNhYmxlZEZpbHRlcnNDaGFuZ2VkKHRoaXMuaW5wdXQuZmlsdGVycywgdGhpcy5wcmV2RmlsdGVycykgfHwgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHRoaXMucHJldlF1ZXJ5LCB0aGlzLmlucHV0LnF1ZXJ5KSB8fCAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwodGhpcy5wcmV2VGltZVJhbmdlLCB0aGlzLmlucHV0LnRpbWVSYW5nZSkgfHwgIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKHNlYXJjaFNjb3BlLnNvcnQsIHRoaXMuaW5wdXQuc29ydCB8fCB0aGlzLnNhdmVkU2VhcmNoLnNvcnQpOyAvLyBJZiB0aGVyZSBpcyBjb2x1bW4gb3Igc29ydCBkYXRhIG9uIHRoZSBwYW5lbCwgdGhhdCBtZWFucyB0aGUgb3JpZ2luYWwgY29sdW1ucyBvciBzb3J0IHNldHRpbmdzIGhhdmUKICAgICAgLy8gYmVlbiBvdmVycmlkZGVuIGluIGEgZGFzaGJvYXJkLgoKICAgICAgc2VhcmNoU2NvcGUuY29sdW1ucyA9IHRoaXMuaW5wdXQuY29sdW1ucyB8fCB0aGlzLnNhdmVkU2VhcmNoLmNvbHVtbnM7CiAgICAgIHNlYXJjaFNjb3BlLnNvcnQgPSB0aGlzLmlucHV0LnNvcnQgfHwgdGhpcy5zYXZlZFNlYXJjaC5zb3J0OwogICAgICBzZWFyY2hTY29wZS5zaGFyZWRJdGVtVGl0bGUgPSB0aGlzLnBhbmVsVGl0bGU7CgogICAgICBpZiAoaXNGZXRjaFJlcXVpcmVkKSB7CiAgICAgICAgdGhpcy5maWx0ZXJzU2VhcmNoU291cmNlLnNldEZpZWxkKCdmaWx0ZXInLCB0aGlzLmlucHV0LmZpbHRlcnMpOwogICAgICAgIHRoaXMuZmlsdGVyc1NlYXJjaFNvdXJjZS5zZXRGaWVsZCgncXVlcnknLCB0aGlzLmlucHV0LnF1ZXJ5KTsKICAgICAgICB0aGlzLmZldGNoKCk7CiAgICAgICAgdGhpcy5wcmV2RmlsdGVycyA9IHRoaXMuaW5wdXQuZmlsdGVyczsKICAgICAgICB0aGlzLnByZXZRdWVyeSA9IHRoaXMuaW5wdXQucXVlcnk7CiAgICAgICAgdGhpcy5wcmV2VGltZVJhbmdlID0gdGhpcy5pbnB1dC50aW1lUmFuZ2U7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBTZWFyY2hFbWJlZGRhYmxlOwp9KF9wdWJsaWM0LkVtYmVkZGFibGUpOwoKZXhwb3J0cy5TZWFyY2hFbWJlZGRhYmxlID0gU2VhcmNoRW1iZWRkYWJsZTs="},null]}