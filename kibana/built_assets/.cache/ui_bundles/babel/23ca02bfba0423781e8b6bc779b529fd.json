{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/search/search_source/search_source.js","dependencies":[{"path":"src/plugins/data/public/search/search_source/search_source.js","mtime":1589249550679},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlNlYXJjaFNvdXJjZSA9IHZvaWQgMDsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgX25vcm1hbGl6ZV9zb3J0X3JlcXVlc3QgPSByZXF1aXJlKCIuL25vcm1hbGl6ZV9zb3J0X3JlcXVlc3QiKTsKCnZhciBfZmlsdGVyX2RvY3ZhbHVlX2ZpZWxkcyA9IHJlcXVpcmUoIi4vZmlsdGVyX2RvY3ZhbHVlX2ZpZWxkcyIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9raWJhbmFfdXRpbHMvcHVibGljIik7Cgp2YXIgX2ZldGNoMiA9IHJlcXVpcmUoIi4uL2ZldGNoIik7Cgp2YXIgX3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vLi4vc2VydmljZXMiKTsKCnZhciBfY29tbW9uID0gcmVxdWlyZSgiLi4vLi4vLi4vY29tbW9uIik7Cgp2YXIgX2ZpZWxkX2Zvcm1hdHMgPSByZXF1aXJlKCIuLi8uLi8uLi9jb21tb24vZmllbGRfZm9ybWF0cyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogIH0KfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7CiAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsKICB9Cn0KCmZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgcmV0dXJuIENvbnN0cnVjdG9yOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIFNlYXJjaFNvdXJjZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFNlYXJjaFNvdXJjZSgpIHsKICAgIHZhciBmaWVsZHMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTZWFyY2hTb3VyY2UpOwoKICAgIHRoaXMuZmllbGRzID0gZmllbGRzOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaWQiLCBfbG9kYXNoLmRlZmF1bHQudW5pcXVlSWQoJ2RhdGFfc291cmNlJykpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2VhcmNoU3RyYXRlZ3lJZCIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJwYXJlbnQiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicmVxdWVzdFN0YXJ0SGFuZGxlcnMiLCBbXSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJpbmhlcml0T3B0aW9ucyIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImhpc3RvcnkiLCBbXSk7CiAgfQogIC8qKiAqKioKICAgKiBQVUJMSUMgQVBJCiAgICoqKioqLwoKCiAgX2NyZWF0ZUNsYXNzKFNlYXJjaFNvdXJjZSwgW3sKICAgIGtleTogInNldFByZWZlcnJlZFNlYXJjaFN0cmF0ZWd5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFByZWZlcnJlZFNlYXJjaFN0cmF0ZWd5SWQoc2VhcmNoU3RyYXRlZ3lJZCkgewogICAgICB0aGlzLnNlYXJjaFN0cmF0ZWd5SWQgPSBzZWFyY2hTdHJhdGVneUlkOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEZpZWxkcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RmllbGRzKG5ld0ZpZWxkcykgewogICAgICB0aGlzLmZpZWxkcyA9IG5ld0ZpZWxkczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldEZpZWxkKGZpZWxkLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgIGRlbGV0ZSB0aGlzLmZpZWxkc1tmaWVsZF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWVsZHNbZmllbGRdID0gdmFsdWU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldElkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuaWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWVsZHMoKSB7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmZpZWxkcyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmaWVsZHMgZnJvbSB0aGUgZmllbGRzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RmllbGQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpZWxkKGZpZWxkKSB7CiAgICAgIHZhciByZWN1cnNlID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwoKICAgICAgaWYgKCFyZWN1cnNlIHx8IHRoaXMuZmllbGRzW2ZpZWxkXSAhPT0gdm9pZCAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmllbGRzW2ZpZWxkXTsKICAgICAgfQoKICAgICAgdmFyIHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50KCk7CiAgICAgIHJldHVybiBwYXJlbnQgJiYgcGFyZW50LmdldEZpZWxkKGZpZWxkKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBmaWVsZCBmcm9tIG91ciBvd24gZmllbGRzLCBkb24ndCB0cmF2ZXJzZSB1cCB0aGUgY2hhaW4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRPd25GaWVsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3duRmllbGQoZmllbGQpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGQoZmllbGQsIGZhbHNlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZSgpIHsKICAgICAgcmV0dXJuIG5ldyBTZWFyY2hTb3VyY2UoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjcmVhdGVDb3B5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDb3B5KCkgewogICAgICB2YXIgbmV3U2VhcmNoU291cmNlID0gbmV3IFNlYXJjaFNvdXJjZSgpOwogICAgICBuZXdTZWFyY2hTb3VyY2Uuc2V0RmllbGRzKF9vYmplY3RTcHJlYWQoe30sIHRoaXMuZmllbGRzKSk7IC8vIHdoZW4gc2VyaWFsaXppbmcgdGhlIGludGVybmFsIGZpZWxkcyB3ZSBsb3NlIHRoZSBpbnRlcm5hbCBjbGFzc2VzIHVzZWQgaW4gdGhlIGluZGV4CiAgICAgIC8vIHBhdHRlcm4sIHNvIHdlIGhhdmUgdG8gc2V0IGl0IGFnYWluIHRvIHdvcmthcm91bmQgdGhpcyBiZWhhdmlvcgoKICAgICAgbmV3U2VhcmNoU291cmNlLnNldEZpZWxkKCdpbmRleCcsIHRoaXMuZ2V0RmllbGQoJ2luZGV4JykpOwogICAgICBuZXdTZWFyY2hTb3VyY2Uuc2V0UGFyZW50KHRoaXMuZ2V0UGFyZW50KCkpOwogICAgICByZXR1cm4gbmV3U2VhcmNoU291cmNlOwogICAgfQogIH0sIHsKICAgIGtleTogImNyZWF0ZUNoaWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVDaGlsZCgpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgICB2YXIgY2hpbGRTZWFyY2hTb3VyY2UgPSBuZXcgU2VhcmNoU291cmNlKCk7CiAgICAgIGNoaWxkU2VhcmNoU291cmNlLnNldFBhcmVudCh0aGlzLCBvcHRpb25zKTsKICAgICAgcmV0dXJuIGNoaWxkU2VhcmNoU291cmNlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYSBzZWFyY2hTb3VyY2UgdGhhdCB0aGlzIHNvdXJjZSBzaG91bGQgaW5oZXJpdCBmcm9tCiAgICAgKiBAcGFyYW0gIHtTZWFyY2hTb3VyY2V9IHBhcmVudCAtIHRoZSBwYXJlbnQgc2VhcmNoU291cmNlCiAgICAgKiBAcGFyYW0gIHtTZWFyY2hTb3VyY2VPcHRpb25zfSBvcHRpb25zIC0gdGhlIGluaGVyaXQgb3B0aW9ucwogICAgICogQHJldHVybiB7dGhpc30gLSBjaGFpbmFibGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRQYXJlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFBhcmVudChwYXJlbnQpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDsKICAgICAgdGhpcy5pbmhlcml0T3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHBhcmVudCBvZiB0aGlzIFNlYXJjaFNvdXJjZQogICAgICogQHJldHVybiB7dW5kZWZpbmVkfHNlYXJjaFNvdXJjZX0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRQYXJlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhcmVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFyZW50OwogICAgfQogICAgLyoqCiAgICAgKiBGZXRjaCB0aGlzIHNvdXJjZSBhbmQgcmVqZWN0IHRoZSByZXR1cm5lZCBQcm9taXNlIG9uIGVycm9yCiAgICAgKgogICAgICogQGFzeW5jCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmV0Y2giLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9mZXRjaCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIG9wdGlvbnMsCiAgICAgICAgICAgIHNlYXJjaFJlcXVlc3QsCiAgICAgICAgICAgIGVzU2hhcmRUaW1lb3V0LAogICAgICAgICAgICByZXNwb25zZSwKICAgICAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgb3B0aW9ucyA9IF9hcmdzLmxlbmd0aCA+IDAgJiYgX2FyZ3NbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzBdIDoge307CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlcXVlc3RJc1N0YXJ0aW5nKG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmZsYXR0ZW4oKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgc2VhcmNoUmVxdWVzdCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICB0aGlzLmhpc3RvcnkgPSBbc2VhcmNoUmVxdWVzdF07CiAgICAgICAgICAgICAgICBlc1NoYXJkVGltZW91dCA9ICgwLCBfc2VydmljZXMuZ2V0SW5qZWN0ZWRNZXRhZGF0YSkoKS5nZXRJbmplY3RlZFZhcignZXNTaGFyZFRpbWVvdXQnKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiAoMCwgX2ZldGNoMi5mZXRjaFNvb24pKHNlYXJjaFJlcXVlc3QsIF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc2VhcmNoU3RyYXRlZ3lJZCAmJiB7CiAgICAgICAgICAgICAgICAgIHNlYXJjaFN0cmF0ZWd5SWQ6IHRoaXMuc2VhcmNoU3RyYXRlZ3lJZAogICAgICAgICAgICAgICAgfSwge30sIG9wdGlvbnMpLCB7CiAgICAgICAgICAgICAgICAgIHNlYXJjaFNlcnZpY2U6ICgwLCBfc2VydmljZXMuZ2V0U2VhcmNoU2VydmljZSkoKSwKICAgICAgICAgICAgICAgICAgY29uZmlnOiAoMCwgX3NlcnZpY2VzLmdldFVpU2V0dGluZ3MpKCksCiAgICAgICAgICAgICAgICAgIGVzU2hhcmRUaW1lb3V0OiBlc1NoYXJkVGltZW91dAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfZmV0Y2gyLlJlcXVlc3RGYWlsdXJlKG51bGwsIHJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBmZXRjaCgpIHsKICAgICAgICByZXR1cm4gX2ZldGNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBmZXRjaDsKICAgIH0oKQogICAgLyoqCiAgICAgKiAgQWRkIGEgaGFuZGxlciB0aGF0IHdpbGwgYmUgbm90aWZpZWQgd2hlbmV2ZXIgcmVxdWVzdHMgc3RhcnQKICAgICAqICBAcGFyYW0gIHtGdW5jdGlvbn0gaGFuZGxlcgogICAgICogIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJvblJlcXVlc3RTdGFydCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gb25SZXF1ZXN0U3RhcnQoaGFuZGxlcikgewogICAgICB0aGlzLnJlcXVlc3RTdGFydEhhbmRsZXJzLnB1c2goaGFuZGxlcik7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0U2VhcmNoUmVxdWVzdEJvZHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRTZWFyY2hSZXF1ZXN0Qm9keSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBzZWFyY2hSZXF1ZXN0OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5mbGF0dGVuKCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIHNlYXJjaFJlcXVlc3QgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBzZWFyY2hSZXF1ZXN0LmJvZHkpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRTZWFyY2hSZXF1ZXN0Qm9keSgpIHsKICAgICAgICByZXR1cm4gX2dldFNlYXJjaFJlcXVlc3RCb2R5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRTZWFyY2hSZXF1ZXN0Qm9keTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDb21wbGV0ZWx5IGRlc3Ryb3kgdGhlIFNlYXJjaFNvdXJjZS4KICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICB0aGlzLnJlcXVlc3RTdGFydEhhbmRsZXJzLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKiogKioqKgogICAgICogUFJJVkFURSBBUElTCiAgICAgKioqKioqLwoKICAgIC8qKgogICAgICogIENhbGxlZCBieSByZXF1ZXN0cyBvZiB0aGlzIHNlYXJjaCBzb3VyY2Ugd2hlbiB0aGV5IGFyZSBzdGFydGVkCiAgICAgKiAgQHBhcmFtICB7Q291cmllci5SZXF1ZXN0fSByZXF1ZXN0CiAgICAgKiAgQHBhcmFtIG9wdGlvbnMKICAgICAqICBAcmV0dXJuIHtQcm9taXNlPHVuZGVmaW5lZD59CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVxdWVzdElzU3RhcnRpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RJc1N0YXJ0aW5nKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwoKICAgICAgdmFyIGhhbmRsZXJzID0gX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMucmVxdWVzdFN0YXJ0SGFuZGxlcnMpOyAvLyBJZiBjYWxsUGFyZW50U3RhcnRIYW5kbGVycyBoYXMgYmVlbiBzZXQgdG8gdHJ1ZSwgd2UgYWxzbyBjYWxsIGFsbAogICAgICAvLyBoYW5kbGVycyBvZiBwYXJlbnQgc2VhcmNoIHNvdXJjZXMuCgoKICAgICAgaWYgKHRoaXMuaW5oZXJpdE9wdGlvbnMuY2FsbFBhcmVudFN0YXJ0SGFuZGxlcnMpIHsKICAgICAgICB2YXIgX3NlYXJjaFNvdXJjZSA9IHRoaXMuZ2V0UGFyZW50KCk7CgogICAgICAgIHdoaWxlIChfc2VhcmNoU291cmNlKSB7CiAgICAgICAgICBoYW5kbGVycy5wdXNoLmFwcGx5KGhhbmRsZXJzLCBfdG9Db25zdW1hYmxlQXJyYXkoX3NlYXJjaFNvdXJjZS5yZXF1ZXN0U3RhcnRIYW5kbGVycykpOwogICAgICAgICAgX3NlYXJjaFNvdXJjZSA9IF9zZWFyY2hTb3VyY2UuZ2V0UGFyZW50KCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gUHJvbWlzZS5hbGwoaGFuZGxlcnMubWFwKGZ1bmN0aW9uIChmbikgewogICAgICAgIHJldHVybiBmbihfdGhpcywgb3B0aW9ucyk7CiAgICAgIH0pKTsKICAgIH0KICAgIC8qKgogICAgICogVXNlZCB0byBtZXJnZSBwcm9wZXJ0aWVzIGludG8gdGhlIGRhdGEgd2l0aGluIC5fZmxhdHRlbigpLgogICAgICogVGhlIGRhdGEgaXMgcGFzc2VkIGluIGFuZCBtb2RpZmllZCBieSB0aGUgZnVuY3Rpb24KICAgICAqCiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IGRhdGEgLSB0aGUgY3VycmVudCBtZXJnZWQgZGF0YQogICAgICogQHBhcmFtICB7Kn0gdmFsIC0gdGhlIHZhbHVlIGF0IGBrZXlgCiAgICAgKiBAcGFyYW0gIHsqfSBrZXkgLSBUaGUga2V5IG9mIGB2YWxgCiAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibWVyZ2VQcm9wIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtZXJnZVByb3AoZGF0YSwgdmFsLCBrZXkpIHsKICAgICAgdmFsID0gdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJyA/IHZhbCh0aGlzKSA6IHZhbDsKICAgICAgaWYgKHZhbCA9PSBudWxsIHx8ICFrZXkpIHJldHVybjsKCiAgICAgIHZhciBhZGRUb1Jvb3QgPSBmdW5jdGlvbiBhZGRUb1Jvb3Qocm9vdEtleSwgdmFsdWUpIHsKICAgICAgICBkYXRhW3Jvb3RLZXldID0gdmFsdWU7CiAgICAgIH07CiAgICAgIC8qKgogICAgICAgKiBBZGQgdGhlIGtleSBhbmQgdmFsIHRvIHRoZSBib2R5IG9mIHRoZSByZXF1ZXN0CiAgICAgICAqLwoKCiAgICAgIHZhciBhZGRUb0JvZHkgPSBmdW5jdGlvbiBhZGRUb0JvZHkoYm9keUtleSwgdmFsdWUpIHsKICAgICAgICAvLyBpZ25vcmUgaWYgd2UgYWxyZWFkeSBoYXZlIGEgdmFsdWUKICAgICAgICBpZiAoZGF0YS5ib2R5W2JvZHlLZXldID09IG51bGwpIHsKICAgICAgICAgIGRhdGEuYm9keVtib2R5S2V5XSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgY2FzZSAnZmlsdGVyJzoKICAgICAgICAgIHJldHVybiBhZGRUb1Jvb3QoJ2ZpbHRlcnMnLCAoZGF0YS5maWx0ZXJzIHx8IFtdKS5jb25jYXQodmFsKSk7CgogICAgICAgIGNhc2UgJ3F1ZXJ5JzoKICAgICAgICAgIHJldHVybiBhZGRUb1Jvb3Qoa2V5LCAoZGF0YVtrZXldIHx8IFtdKS5jb25jYXQodmFsKSk7CgogICAgICAgIGNhc2UgJ2ZpZWxkcyc6CiAgICAgICAgICB2YXIgX2ZpZWxkcyA9IF9sb2Rhc2guZGVmYXVsdC51bmlxKChkYXRhW2tleV0gfHwgW10pLmNvbmNhdCh2YWwpKTsKCiAgICAgICAgICByZXR1cm4gYWRkVG9Sb290KGtleSwgX2ZpZWxkcyk7CgogICAgICAgIGNhc2UgJ2luZGV4JzoKICAgICAgICBjYXNlICd0eXBlJzoKICAgICAgICBjYXNlICdoaWdobGlnaHRBbGwnOgogICAgICAgICAgcmV0dXJuIGtleSAmJiBkYXRhW2tleV0gPT0gbnVsbCAmJiBhZGRUb1Jvb3Qoa2V5LCB2YWwpOwoKICAgICAgICBjYXNlICdzZWFyY2hBZnRlcic6CiAgICAgICAgICByZXR1cm4gYWRkVG9Cb2R5KCdzZWFyY2hfYWZ0ZXInLCB2YWwpOwoKICAgICAgICBjYXNlICdzb3VyY2UnOgogICAgICAgICAgcmV0dXJuIGFkZFRvQm9keSgnX3NvdXJjZScsIHZhbCk7CgogICAgICAgIGNhc2UgJ3NvcnQnOgogICAgICAgICAgdmFyIHNvcnQgPSAoMCwgX25vcm1hbGl6ZV9zb3J0X3JlcXVlc3Qubm9ybWFsaXplU29ydFJlcXVlc3QpKHZhbCwgdGhpcy5nZXRGaWVsZCgnaW5kZXgnKSwgKDAsIF9zZXJ2aWNlcy5nZXRVaVNldHRpbmdzKSgpLmdldCgnc29ydDpvcHRpb25zJykpOwogICAgICAgICAgcmV0dXJuIGFkZFRvQm9keShrZXksIHNvcnQpOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIGFkZFRvQm9keShrZXksIHZhbCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogV2FsayB0aGUgaW5oZXJpdGFuY2UgY2hhaW4gb2YgYSBzb3VyY2UgYW5kIHJldHVybiBpdHMKICAgICAqIGZsYXQgcmVwcmVzZW50YXRpb24gKHRha2luZyBpbnRvIGFjY291bnQgbWVyZ2luZyBydWxlcykKICAgICAqIEByZXR1cm5zIHtQcm9taXNlfQogICAgICogQHJlc29sdmVkIHtPYmplY3R8bnVsbH0gLSB0aGUgZmxhdCBkYXRhIG9mIHRoZSBTZWFyY2hTb3VyY2UKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJtZXJnZVByb3BzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtZXJnZVByb3BzKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciByb290ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0aGlzOwogICAgICB2YXIgc2VhcmNoUmVxdWVzdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogewogICAgICAgIGJvZHk6IHt9CiAgICAgIH07CiAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMuZmllbGRzKS5mb3JFYWNoKGZ1bmN0aW9uIChfcmVmKSB7CiAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMiksCiAgICAgICAgICAgIGtleSA9IF9yZWYyWzBdLAogICAgICAgICAgICB2YWx1ZSA9IF9yZWYyWzFdOwoKICAgICAgICBfdGhpczIubWVyZ2VQcm9wKHNlYXJjaFJlcXVlc3QsIHZhbHVlLCBrZXkpOwogICAgICB9KTsKCiAgICAgIGlmICh0aGlzLnBhcmVudCkgewogICAgICAgIHRoaXMucGFyZW50Lm1lcmdlUHJvcHMocm9vdCwgc2VhcmNoUmVxdWVzdCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZWFyY2hSZXF1ZXN0OwogICAgfQogIH0sIHsKICAgIGtleTogImdldEluZGV4VHlwZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5kZXhUeXBlKGluZGV4KSB7CiAgICAgIGlmICh0aGlzLnNlYXJjaFN0cmF0ZWd5SWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hTdHJhdGVneUlkID09PSAnZGVmYXVsdCcgPyB1bmRlZmluZWQgOiB0aGlzLnNlYXJjaFN0cmF0ZWd5SWQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGluZGV4ID09PSBudWxsIHx8IGluZGV4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbmRleC50eXBlOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiZmxhdHRlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmxhdHRlbigpIHsKICAgICAgdmFyIHNlYXJjaFJlcXVlc3QgPSB0aGlzLm1lcmdlUHJvcHMoKTsKICAgICAgc2VhcmNoUmVxdWVzdC5ib2R5ID0gc2VhcmNoUmVxdWVzdC5ib2R5IHx8IHt9OwogICAgICB2YXIgYm9keSA9IHNlYXJjaFJlcXVlc3QuYm9keSwKICAgICAgICAgIGluZGV4ID0gc2VhcmNoUmVxdWVzdC5pbmRleCwKICAgICAgICAgIGZpZWxkcyA9IHNlYXJjaFJlcXVlc3QuZmllbGRzLAogICAgICAgICAgcXVlcnkgPSBzZWFyY2hSZXF1ZXN0LnF1ZXJ5LAogICAgICAgICAgZmlsdGVycyA9IHNlYXJjaFJlcXVlc3QuZmlsdGVycywKICAgICAgICAgIGhpZ2hsaWdodEFsbCA9IHNlYXJjaFJlcXVlc3QuaGlnaGxpZ2h0QWxsOwogICAgICBzZWFyY2hSZXF1ZXN0LmluZGV4VHlwZSA9IHRoaXMuZ2V0SW5kZXhUeXBlKGluZGV4KTsKICAgICAgdmFyIGNvbXB1dGVkRmllbGRzID0gaW5kZXggPyBpbmRleC5nZXRDb21wdXRlZEZpZWxkcygpIDoge307CiAgICAgIGJvZHkuc3RvcmVkX2ZpZWxkcyA9IGNvbXB1dGVkRmllbGRzLnN0b3JlZEZpZWxkczsKICAgICAgYm9keS5zY3JpcHRfZmllbGRzID0gYm9keS5zY3JpcHRfZmllbGRzIHx8IHt9OwoKICAgICAgX2xvZGFzaC5kZWZhdWx0LmV4dGVuZChib2R5LnNjcmlwdF9maWVsZHMsIGNvbXB1dGVkRmllbGRzLnNjcmlwdEZpZWxkcyk7CgogICAgICB2YXIgZGVmYXVsdERvY1ZhbHVlRmllbGRzID0gY29tcHV0ZWRGaWVsZHMuZG9jdmFsdWVGaWVsZHMgPyBjb21wdXRlZEZpZWxkcy5kb2N2YWx1ZUZpZWxkcyA6IFtdOwogICAgICBib2R5LmRvY3ZhbHVlX2ZpZWxkcyA9IGJvZHkuZG9jdmFsdWVfZmllbGRzIHx8IGRlZmF1bHREb2NWYWx1ZUZpZWxkczsKCiAgICAgIGlmICghYm9keS5oYXNPd25Qcm9wZXJ0eSgnX3NvdXJjZScpICYmIGluZGV4KSB7CiAgICAgICAgYm9keS5fc291cmNlID0gaW5kZXguZ2V0U291cmNlRmlsdGVyaW5nKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Ll9zb3VyY2UpIHsKICAgICAgICAvLyBleGNsdWRlIHNvdXJjZSBmaWVsZHMgZm9yIHRoaXMgaW5kZXggcGF0dGVybiBzcGVjaWZpZWQgYnkgdGhlIHVzZXIKICAgICAgICB2YXIgZmlsdGVyID0gKDAsIF9wdWJsaWMuZmllbGRXaWxkY2FyZEZpbHRlcikoYm9keS5fc291cmNlLmV4Y2x1ZGVzLCAoMCwgX3NlcnZpY2VzLmdldFVpU2V0dGluZ3MpKCkuZ2V0KCdtZXRhRmllbGRzJykpOwogICAgICAgIGJvZHkuZG9jdmFsdWVfZmllbGRzID0gYm9keS5kb2N2YWx1ZV9maWVsZHMuZmlsdGVyKGZ1bmN0aW9uIChkb2N2YWx1ZUZpZWxkKSB7CiAgICAgICAgICByZXR1cm4gZmlsdGVyKGRvY3ZhbHVlRmllbGQuZmllbGQpOwogICAgICAgIH0pOwogICAgICB9IC8vIGlmIHdlIG9ubHkgd2FudCB0byBzZWFyY2ggZm9yIGNlcnRhaW4gZmllbGRzCgoKICAgICAgaWYgKGZpZWxkcykgewogICAgICAgIC8vIGZpbHRlciBvdXQgdGhlIGRvY3ZhbHVlX2ZpZWxkcywgYW5kIHNjcmlwdF9maWVsZHMgdG8gb25seSBpbmNsdWRlIHRob3NlIHRoYXQgd2UgYXJlIGNvbmNlcm5lZCB3aXRoCiAgICAgICAgYm9keS5kb2N2YWx1ZV9maWVsZHMgPSAoMCwgX2ZpbHRlcl9kb2N2YWx1ZV9maWVsZHMuZmlsdGVyRG9jdmFsdWVGaWVsZHMpKGJvZHkuZG9jdmFsdWVfZmllbGRzLCBmaWVsZHMpOwogICAgICAgIGJvZHkuc2NyaXB0X2ZpZWxkcyA9IF9sb2Rhc2guZGVmYXVsdC5waWNrKGJvZHkuc2NyaXB0X2ZpZWxkcywgZmllbGRzKTsgLy8gcmVxdWVzdCB0aGUgcmVtYWluaW5nIGZpZWxkcyBmcm9tIGJvdGggc3RvcmVkX2ZpZWxkcyBhbmQgX3NvdXJjZQoKICAgICAgICB2YXIgcmVtYWluaW5nRmllbGRzID0gX2xvZGFzaC5kZWZhdWx0LmRpZmZlcmVuY2UoZmllbGRzLCBfbG9kYXNoLmRlZmF1bHQua2V5cyhib2R5LnNjcmlwdF9maWVsZHMpKTsKCiAgICAgICAgYm9keS5zdG9yZWRfZmllbGRzID0gcmVtYWluaW5nRmllbGRzOwoKICAgICAgICBfbG9kYXNoLmRlZmF1bHQuc2V0KGJvZHksICdfc291cmNlLmluY2x1ZGVzJywgcmVtYWluaW5nRmllbGRzKTsKICAgICAgfQoKICAgICAgdmFyIGVzUXVlcnlDb25maWdzID0gKDAsIF9jb21tb24uZ2V0RXNRdWVyeUNvbmZpZykoKDAsIF9zZXJ2aWNlcy5nZXRVaVNldHRpbmdzKSgpKTsKICAgICAgYm9keS5xdWVyeSA9ICgwLCBfY29tbW9uLmJ1aWxkRXNRdWVyeSkoaW5kZXgsIHF1ZXJ5LCBmaWx0ZXJzLCBlc1F1ZXJ5Q29uZmlncyk7CgogICAgICBpZiAoaGlnaGxpZ2h0QWxsICYmIGJvZHkucXVlcnkpIHsKICAgICAgICBib2R5LmhpZ2hsaWdodCA9ICgwLCBfZmllbGRfZm9ybWF0cy5nZXRIaWdobGlnaHRSZXF1ZXN0KShib2R5LnF1ZXJ5LCAoMCwgX3NlcnZpY2VzLmdldFVpU2V0dGluZ3MpKCkuZ2V0KCdkb2NfdGFibGU6aGlnaGxpZ2h0JykpOwogICAgICAgIGRlbGV0ZSBzZWFyY2hSZXF1ZXN0LmhpZ2hsaWdodEFsbDsKICAgICAgfQoKICAgICAgdmFyIHRyYW5zbGF0ZVRvUXVlcnkgPSBmdW5jdGlvbiB0cmFuc2xhdGVUb1F1ZXJ5KGZpbHRlcikgewogICAgICAgIHJldHVybiBmaWx0ZXIgJiYgKGZpbHRlci5xdWVyeSB8fCBmaWx0ZXIpOwogICAgICB9OyAvLyByZS13cml0ZSBmaWx0ZXJzIHdpdGhpbiBmaWx0ZXIgYWdncmVnYXRpb25zCgoKICAgICAgKGZ1bmN0aW9uIHJlY3Vyc2UoYWdnQnJhbmNoKSB7CiAgICAgICAgaWYgKCFhZ2dCcmFuY2gpIHJldHVybjsKICAgICAgICBPYmplY3Qua2V5cyhhZ2dCcmFuY2gpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICB2YXIgYWdnID0gYWdnQnJhbmNoW2lkXTsKCiAgICAgICAgICBpZiAoYWdnLmZpbHRlcnMpIHsKICAgICAgICAgICAgLy8gdHJhbnNsYXRlIGZpbHRlcnMgYWdncmVnYXRpb25zCiAgICAgICAgICAgIHZhciBhZ2dGaWx0ZXJzID0gYWdnLmZpbHRlcnMuZmlsdGVyczsKICAgICAgICAgICAgT2JqZWN0LmtleXMoYWdnRmlsdGVycykuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVySWQpIHsKICAgICAgICAgICAgICBhZ2dGaWx0ZXJzW2ZpbHRlcklkXSA9IHRyYW5zbGF0ZVRvUXVlcnkoYWdnRmlsdGVyc1tmaWx0ZXJJZF0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICByZWN1cnNlKGFnZy5hZ2dzIHx8IGFnZy5hZ2dyZWdhdGlvbnMpOwogICAgICAgIH0pOwogICAgICB9KShib2R5LmFnZ3MgfHwgYm9keS5hZ2dyZWdhdGlvbnMpOwoKICAgICAgcmV0dXJuIHNlYXJjaFJlcXVlc3Q7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gU2VhcmNoU291cmNlOwp9KCk7CgpleHBvcnRzLlNlYXJjaFNvdXJjZSA9IFNlYXJjaFNvdXJjZTs="},null]}