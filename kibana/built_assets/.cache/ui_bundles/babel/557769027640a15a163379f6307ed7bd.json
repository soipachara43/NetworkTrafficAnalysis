{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/plugins/infra/public/containers/logs/log_entries/index.js","dependencies":[{"path":"x-pack/plugins/infra/public/containers/logs/log_entries/index.js","mtime":1589249554277},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkxvZ0VudHJpZXNTdGF0ZSA9IGV4cG9ydHMudXNlTG9nRW50cmllc1N0YXRlID0gZXhwb3J0cy5sb2dFbnRyaWVzSW5pdGlhbFN0YXRlID0gZXhwb3J0cy5sb2dFbnRyaWVzSW5pdGlhbENhbGxiYWNrcyA9IHZvaWQgMDsKCnZhciBfcmVhY3QgPSByZXF1aXJlKCJyZWFjdCIpOwoKdmFyIF9jb25zdGF0ZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiY29uc3RhdGUiKSk7Cgp2YXIgX2xvZGFzaCA9IHJlcXVpcmUoImxvZGFzaCIpOwoKdmFyIF90aW1lID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vY29tbW9uL3RpbWUiKTsKCnZhciBfZmV0Y2hfbG9nX2VudHJpZXMgPSByZXF1aXJlKCIuL2FwaS9mZXRjaF9sb2dfZW50cmllcyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKdmFyIERFU0lSRURfQlVGRkVSX1BBR0VTID0gMjsKdmFyIExJVkVfU1RSRUFNX0lOVEVSVkFMID0gNTAwMDsKdmFyIEFjdGlvbjsKCihmdW5jdGlvbiAoQWN0aW9uKSB7CiAgQWN0aW9uW0FjdGlvblsiRmV0Y2hpbmdOZXdFbnRyaWVzIl0gPSAwXSA9ICJGZXRjaGluZ05ld0VudHJpZXMiOwogIEFjdGlvbltBY3Rpb25bIkZldGNoaW5nTW9yZUVudHJpZXMiXSA9IDFdID0gIkZldGNoaW5nTW9yZUVudHJpZXMiOwogIEFjdGlvbltBY3Rpb25bIlJlY2VpdmVOZXdFbnRyaWVzIl0gPSAyXSA9ICJSZWNlaXZlTmV3RW50cmllcyI7CiAgQWN0aW9uW0FjdGlvblsiUmVjZWl2ZUVudHJpZXNCZWZvcmUiXSA9IDNdID0gIlJlY2VpdmVFbnRyaWVzQmVmb3JlIjsKICBBY3Rpb25bQWN0aW9uWyJSZWNlaXZlRW50cmllc0FmdGVyIl0gPSA0XSA9ICJSZWNlaXZlRW50cmllc0FmdGVyIjsKICBBY3Rpb25bQWN0aW9uWyJFcnJvck9uTmV3RW50cmllcyJdID0gNV0gPSAiRXJyb3JPbk5ld0VudHJpZXMiOwogIEFjdGlvbltBY3Rpb25bIkVycm9yT25Nb3JlRW50cmllcyJdID0gNl0gPSAiRXJyb3JPbk1vcmVFbnRyaWVzIjsKICBBY3Rpb25bQWN0aW9uWyJFeHBhbmRSYW5nZSJdID0gN10gPSAiRXhwYW5kUmFuZ2UiOwp9KShBY3Rpb24gfHwgKEFjdGlvbiA9IHt9KSk7Cgp2YXIgbG9nRW50cmllc0luaXRpYWxDYWxsYmFja3MgPSB7CiAgZmV0Y2hOZXdlckVudHJpZXM6IGZ1bmN0aW9uICgpIHsKICAgIHZhciBfZmV0Y2hOZXdlckVudHJpZXMgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgIC8qI19fUFVSRV9fKi8KICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CgogICAgZnVuY3Rpb24gZmV0Y2hOZXdlckVudHJpZXMoKSB7CiAgICAgIHJldHVybiBfZmV0Y2hOZXdlckVudHJpZXMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICByZXR1cm4gZmV0Y2hOZXdlckVudHJpZXM7CiAgfSgpCn07CmV4cG9ydHMubG9nRW50cmllc0luaXRpYWxDYWxsYmFja3MgPSBsb2dFbnRyaWVzSW5pdGlhbENhbGxiYWNrczsKdmFyIGxvZ0VudHJpZXNJbml0aWFsU3RhdGUgPSB7CiAgZW50cmllczogW10sCiAgdG9wQ3Vyc29yOiBudWxsLAogIGJvdHRvbUN1cnNvcjogbnVsbCwKICBjZW50ZXJDdXJzb3I6IG51bGwsCiAgaXNSZWxvYWRpbmc6IHRydWUsCiAgaXNMb2FkaW5nTW9yZTogZmFsc2UsCiAgbGFzdExvYWRlZFRpbWU6IG51bGwsCiAgaGFzTW9yZUJlZm9yZVN0YXJ0OiBmYWxzZSwKICBoYXNNb3JlQWZ0ZXJFbmQ6IGZhbHNlCn07CmV4cG9ydHMubG9nRW50cmllc0luaXRpYWxTdGF0ZSA9IGxvZ0VudHJpZXNJbml0aWFsU3RhdGU7Cgp2YXIgY2xlYW5EdXBsaWNhdGVJdGVtcyA9IGZ1bmN0aW9uIGNsZWFuRHVwbGljYXRlSXRlbXMoZW50cmllc0EsIGVudHJpZXNCKSB7CiAgdmFyIGlkcyA9IG5ldyBTZXQoZW50cmllc0IubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICByZXR1cm4gaXRlbS5pZDsKICB9KSk7CiAgcmV0dXJuIGVudHJpZXNBLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuICFpZHMuaGFzKGl0ZW0uaWQpOwogIH0pOwp9OwoKdmFyIHNob3VsZEZldGNoTmV3RW50cmllcyA9IGZ1bmN0aW9uIHNob3VsZEZldGNoTmV3RW50cmllcyhfcmVmKSB7CiAgdmFyIHByZXZQYXJhbXMgPSBfcmVmLnByZXZQYXJhbXMsCiAgICAgIHRpbWVLZXkgPSBfcmVmLnRpbWVLZXksCiAgICAgIGZpbHRlclF1ZXJ5ID0gX3JlZi5maWx0ZXJRdWVyeSwKICAgICAgdG9wQ3Vyc29yID0gX3JlZi50b3BDdXJzb3IsCiAgICAgIGJvdHRvbUN1cnNvciA9IF9yZWYuYm90dG9tQ3Vyc29yLAogICAgICBzdGFydFRpbWVzdGFtcCA9IF9yZWYuc3RhcnRUaW1lc3RhbXAsCiAgICAgIGVuZFRpbWVzdGFtcCA9IF9yZWYuZW5kVGltZXN0YW1wOwogIHZhciBzaG91bGRMb2FkV2l0aE5ld0RhdGVzID0gcHJldlBhcmFtcyA/IHN0YXJ0VGltZXN0YW1wICE9PSBwcmV2UGFyYW1zLnN0YXJ0VGltZXN0YW1wICYmIHN0YXJ0VGltZXN0YW1wID4gcHJldlBhcmFtcy5zdGFydFRpbWVzdGFtcCB8fCBlbmRUaW1lc3RhbXAgIT09IHByZXZQYXJhbXMuZW5kVGltZXN0YW1wICYmIGVuZFRpbWVzdGFtcCA8IHByZXZQYXJhbXMuZW5kVGltZXN0YW1wIDogdHJ1ZTsKICB2YXIgc2hvdWxkTG9hZFdpdGhOZXdGaWx0ZXIgPSBwcmV2UGFyYW1zID8gZmlsdGVyUXVlcnkgIT09IHByZXZQYXJhbXMuZmlsdGVyUXVlcnkgOiB0cnVlOwogIHZhciBzaG91bGRMb2FkQXJvdW5kTmV3UG9zaXRpb24gPSB0aW1lS2V5ICYmICghdG9wQ3Vyc29yIHx8ICFib3R0b21DdXJzb3IgfHwgISgwLCBfdGltZS50aW1lS2V5SXNCZXR3ZWVuKSh0b3BDdXJzb3IsIGJvdHRvbUN1cnNvciwgdGltZUtleSkpOwogIHJldHVybiBzaG91bGRMb2FkV2l0aE5ld0RhdGVzIHx8IHNob3VsZExvYWRXaXRoTmV3RmlsdGVyIHx8IHNob3VsZExvYWRBcm91bmROZXdQb3NpdGlvbjsKfTsKCnZhciBTaG91bGRGZXRjaE1vcmVFbnRyaWVzOwoKKGZ1bmN0aW9uIChTaG91bGRGZXRjaE1vcmVFbnRyaWVzKSB7CiAgU2hvdWxkRmV0Y2hNb3JlRW50cmllc1tTaG91bGRGZXRjaE1vcmVFbnRyaWVzWyJCZWZvcmUiXSA9IDBdID0gIkJlZm9yZSI7CiAgU2hvdWxkRmV0Y2hNb3JlRW50cmllc1tTaG91bGRGZXRjaE1vcmVFbnRyaWVzWyJBZnRlciJdID0gMV0gPSAiQWZ0ZXIiOwp9KShTaG91bGRGZXRjaE1vcmVFbnRyaWVzIHx8IChTaG91bGRGZXRjaE1vcmVFbnRyaWVzID0ge30pKTsKCnZhciBzaG91bGRGZXRjaE1vcmVFbnRyaWVzID0gZnVuY3Rpb24gc2hvdWxkRmV0Y2hNb3JlRW50cmllcyhfcmVmMiwgX3JlZjMpIHsKICB2YXIgcGFnZXNBZnRlckVuZCA9IF9yZWYyLnBhZ2VzQWZ0ZXJFbmQsCiAgICAgIHBhZ2VzQmVmb3JlU3RhcnQgPSBfcmVmMi5wYWdlc0JlZm9yZVN0YXJ0OwogIHZhciBoYXNNb3JlQmVmb3JlU3RhcnQgPSBfcmVmMy5oYXNNb3JlQmVmb3JlU3RhcnQsCiAgICAgIGhhc01vcmVBZnRlckVuZCA9IF9yZWYzLmhhc01vcmVBZnRlckVuZDsKICBpZiAocGFnZXNCZWZvcmVTdGFydCA9PT0gbnVsbCB8fCBwYWdlc0FmdGVyRW5kID09PSBudWxsKSByZXR1cm4gZmFsc2U7CiAgaWYgKHBhZ2VzQmVmb3JlU3RhcnQgPCBERVNJUkVEX0JVRkZFUl9QQUdFUyAmJiBoYXNNb3JlQmVmb3JlU3RhcnQpIHJldHVybiBTaG91bGRGZXRjaE1vcmVFbnRyaWVzLkJlZm9yZTsKICBpZiAocGFnZXNBZnRlckVuZCA8IERFU0lSRURfQlVGRkVSX1BBR0VTICYmIGhhc01vcmVBZnRlckVuZCkgcmV0dXJuIFNob3VsZEZldGNoTW9yZUVudHJpZXMuQWZ0ZXI7CiAgcmV0dXJuIGZhbHNlOwp9OwoKdmFyIHVzZUZldGNoRW50cmllc0VmZmVjdCA9IGZ1bmN0aW9uIHVzZUZldGNoRW50cmllc0VmZmVjdChzdGF0ZSwgZGlzcGF0Y2gsIHByb3BzKSB7CiAgdmFyIF91c2VTdGF0ZSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKCksCiAgICAgIF91c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLAogICAgICBwcmV2UGFyYW1zID0gX3VzZVN0YXRlMlswXSwKICAgICAgY2FjaGVQcmV2UGFyYW1zID0gX3VzZVN0YXRlMlsxXTsKCiAgdmFyIF91c2VTdGF0ZTMgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKShmYWxzZSksCiAgICAgIF91c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUzLCAyKSwKICAgICAgc3RhcnRlZFN0cmVhbWluZyA9IF91c2VTdGF0ZTRbMF0sCiAgICAgIHNldFN0YXJ0ZWRTdHJlYW1pbmcgPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgcnVuRmV0Y2hOZXdFbnRyaWVzUmVxdWVzdCA9CiAgLyojX19QVVJFX18qLwogIGZ1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmNCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBvdmVycmlkZXMsCiAgICAgICAgICBjb21tb25GZXRjaEFyZ3MsCiAgICAgICAgICBmZXRjaEFyZ3MsCiAgICAgICAgICBfcmVmNSwKICAgICAgICAgIHBheWxvYWQsCiAgICAgICAgICBfYXJnczIgPSBhcmd1bWVudHM7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIG92ZXJyaWRlcyA9IF9hcmdzMi5sZW5ndGggPiAwICYmIF9hcmdzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MyWzBdIDoge307CgogICAgICAgICAgICAgIGlmICghKCFwcm9wcy5zdGFydFRpbWVzdGFtcCB8fCAhcHJvcHMuZW5kVGltZXN0YW1wKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uLkZldGNoaW5nTmV3RW50cmllcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF9jb250ZXh0Mi5wcmV2ID0gNDsKICAgICAgICAgICAgICBjb21tb25GZXRjaEFyZ3MgPSB7CiAgICAgICAgICAgICAgICBzb3VyY2VJZDogb3ZlcnJpZGVzLnNvdXJjZUlkIHx8IHByb3BzLnNvdXJjZUlkLAogICAgICAgICAgICAgICAgc3RhcnRUaW1lc3RhbXA6IG92ZXJyaWRlcy5zdGFydFRpbWVzdGFtcCB8fCBwcm9wcy5zdGFydFRpbWVzdGFtcCwKICAgICAgICAgICAgICAgIGVuZFRpbWVzdGFtcDogb3ZlcnJpZGVzLmVuZFRpbWVzdGFtcCB8fCBwcm9wcy5lbmRUaW1lc3RhbXAsCiAgICAgICAgICAgICAgICBxdWVyeTogb3ZlcnJpZGVzLmZpbHRlclF1ZXJ5IHx8IHByb3BzLmZpbHRlclF1ZXJ5CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBmZXRjaEFyZ3MgPSBwcm9wcy50aW1lS2V5ID8gX29iamVjdFNwcmVhZCh7fSwgY29tbW9uRmV0Y2hBcmdzLCB7CiAgICAgICAgICAgICAgICBjZW50ZXI6IHByb3BzLnRpbWVLZXkKICAgICAgICAgICAgICB9KSA6IF9vYmplY3RTcHJlYWQoe30sIGNvbW1vbkZldGNoQXJncywgewogICAgICAgICAgICAgICAgYmVmb3JlOiAnbGFzdCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDk7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfZmV0Y2hfbG9nX2VudHJpZXMuZmV0Y2hMb2dFbnRyaWVzKShmZXRjaEFyZ3MpOwoKICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIF9yZWY1ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgcGF5bG9hZCA9IF9yZWY1LmRhdGE7CiAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uLlJlY2VpdmVOZXdFbnRyaWVzLAogICAgICAgICAgICAgICAgcGF5bG9hZDogcGF5bG9hZAogICAgICAgICAgICAgIH0pOyAvLyBNb3ZlIHBvc2l0aW9uIHRvIHRoZSBib3R0b20gaWYgaXQncyB0aGUgZmlyc3QgbG9hZC4KICAgICAgICAgICAgICAvLyBEbyBpdCBpbiB0aGUgbmV4dCB0aWNrIHRvIGFsbG93IHRoZSBgZGlzcGF0Y2hgIHRvIGZpcmUKCiAgICAgICAgICAgICAgaWYgKCFwcm9wcy50aW1lS2V5ICYmIHBheWxvYWQuYm90dG9tQ3Vyc29yKSB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcHJvcHMuanVtcFRvVGFyZ2V0UG9zaXRpb24ocGF5bG9hZC5ib3R0b21DdXJzb3IpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wcy50aW1lS2V5ICYmIHBheWxvYWQudG9wQ3Vyc29yICYmIHBheWxvYWQuYm90dG9tQ3Vyc29yICYmICEoMCwgX3RpbWUudGltZUtleUlzQmV0d2VlbikocGF5bG9hZC50b3BDdXJzb3IsIHBheWxvYWQuYm90dG9tQ3Vyc29yLCBwcm9wcy50aW1lS2V5KSkgewogICAgICAgICAgICAgICAgcHJvcHMuanVtcFRvVGFyZ2V0UG9zaXRpb24ocGF5bG9hZC50b3BDdXJzb3IpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxODsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxNTsKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDJbImNhdGNoIl0oNCk7CiAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uLkVycm9yT25OZXdFbnRyaWVzCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTIsIG51bGwsIFtbNCwgMTVdXSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIHJ1bkZldGNoTmV3RW50cmllc1JlcXVlc3QoKSB7CiAgICAgIHJldHVybiBfcmVmNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCk7CgogIHZhciBydW5GZXRjaE1vcmVFbnRyaWVzUmVxdWVzdCA9CiAgLyojX19QVVJFX18qLwogIGZ1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmNiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgLyojX19QVVJFX18qLwogICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoZGlyZWN0aW9uKSB7CiAgICAgIHZhciBnZXRFbnRyaWVzQmVmb3JlLCBjb21tb25GZXRjaEFyZ3MsIGZldGNoQXJncywgX3JlZjcsIHBheWxvYWQ7CgogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGlmICghKCFwcm9wcy5zdGFydFRpbWVzdGFtcCB8fCAhcHJvcHMuZW5kVGltZXN0YW1wKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgZ2V0RW50cmllc0JlZm9yZSA9IGRpcmVjdGlvbiA9PT0gU2hvdWxkRmV0Y2hNb3JlRW50cmllcy5CZWZvcmU7IC8vIENvbnRyb2wgdGhhdCBjdXJzb3JzIGFyZSBjb3JyZWN0CgogICAgICAgICAgICAgIGlmICghKGdldEVudHJpZXNCZWZvcmUgJiYgIXN0YXRlLnRvcEN1cnNvciB8fCAhc3RhdGUuYm90dG9tQ3Vyc29yKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uLkZldGNoaW5nTW9yZUVudHJpZXMKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDY7CiAgICAgICAgICAgICAgY29tbW9uRmV0Y2hBcmdzID0gewogICAgICAgICAgICAgICAgc291cmNlSWQ6IHByb3BzLnNvdXJjZUlkLAogICAgICAgICAgICAgICAgc3RhcnRUaW1lc3RhbXA6IHByb3BzLnN0YXJ0VGltZXN0YW1wLAogICAgICAgICAgICAgICAgZW5kVGltZXN0YW1wOiBwcm9wcy5lbmRUaW1lc3RhbXAsCiAgICAgICAgICAgICAgICBxdWVyeTogcHJvcHMuZmlsdGVyUXVlcnkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIGZldGNoQXJncyA9IGdldEVudHJpZXNCZWZvcmUgPyBfb2JqZWN0U3ByZWFkKHt9LCBjb21tb25GZXRjaEFyZ3MsIHsKICAgICAgICAgICAgICAgIGJlZm9yZTogc3RhdGUudG9wQ3Vyc29yIC8vIFdlIGFscmVhZHkgY2hlY2sgZm9yIG51bGxpdHkgYWJvdmUKCiAgICAgICAgICAgICAgfSkgOiBfb2JqZWN0U3ByZWFkKHt9LCBjb21tb25GZXRjaEFyZ3MsIHsKICAgICAgICAgICAgICAgIGFmdGVyOiBzdGF0ZS5ib3R0b21DdXJzb3IKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDExOwogICAgICAgICAgICAgIHJldHVybiAoMCwgX2ZldGNoX2xvZ19lbnRyaWVzLmZldGNoTG9nRW50cmllcykoZmV0Y2hBcmdzKTsKCiAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgX3JlZjcgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICBwYXlsb2FkID0gX3JlZjcuZGF0YTsKICAgICAgICAgICAgICBkaXNwYXRjaCh7CiAgICAgICAgICAgICAgICB0eXBlOiBnZXRFbnRyaWVzQmVmb3JlID8gQWN0aW9uLlJlY2VpdmVFbnRyaWVzQmVmb3JlIDogQWN0aW9uLlJlY2VpdmVFbnRyaWVzQWZ0ZXIsCiAgICAgICAgICAgICAgICBwYXlsb2FkOiBwYXlsb2FkCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHBheWxvYWQuYm90dG9tQ3Vyc29yKTsKCiAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgX2NvbnRleHQzLnByZXYgPSAxNzsKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oNik7CiAgICAgICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICAgICAgdHlwZTogQWN0aW9uLkVycm9yT25Nb3JlRW50cmllcwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAyMDoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzLCBudWxsLCBbWzYsIDE3XV0pOwogICAgfSkpOwoKICAgIHJldHVybiBmdW5jdGlvbiBydW5GZXRjaE1vcmVFbnRyaWVzUmVxdWVzdChfeCkgewogICAgICByZXR1cm4gX3JlZjYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH07CiAgfSgpOwoKICB2YXIgZmV0Y2hOZXdFbnRyaWVzRWZmZWN0RGVwZW5kZW5jaWVzID0gT2JqZWN0LnZhbHVlcygoMCwgX2xvZGFzaC5waWNrKShwcm9wcywgWydzb3VyY2VJZCcsICdmaWx0ZXJRdWVyeScsICd0aW1lS2V5JywgJ3N0YXJ0VGltZXN0YW1wJywgJ2VuZFRpbWVzdGFtcCddKSk7CgogIHZhciBmZXRjaE5ld0VudHJpZXNFZmZlY3QgPSBmdW5jdGlvbiBmZXRjaE5ld0VudHJpZXNFZmZlY3QoKSB7CiAgICBpZiAocHJvcHMuaXNTdHJlYW1pbmcgJiYgcHJldlBhcmFtcykgcmV0dXJuOwoKICAgIGlmIChzaG91bGRGZXRjaE5ld0VudHJpZXMoX29iamVjdFNwcmVhZCh7fSwgcHJvcHMsIHt9LCBzdGF0ZSwgewogICAgICBwcmV2UGFyYW1zOiBwcmV2UGFyYW1zCiAgICB9KSkpIHsKICAgICAgcnVuRmV0Y2hOZXdFbnRyaWVzUmVxdWVzdCgpOwogICAgfQoKICAgIGNhY2hlUHJldlBhcmFtcyhwcm9wcyk7CiAgfTsKCiAgdmFyIGZldGNoTW9yZUVudHJpZXNFZmZlY3REZXBlbmRlbmNpZXMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KE9iamVjdC52YWx1ZXMoKDAsIF9sb2Rhc2gucGljaykocHJvcHMsIFsncGFnZXNBZnRlckVuZCcsICdwYWdlc0JlZm9yZVN0YXJ0J10pKSksIFtPYmplY3QudmFsdWVzKCgwLCBfbG9kYXNoLnBpY2spKHN0YXRlLCBbJ2hhc01vcmVCZWZvcmVTdGFydCcsICdoYXNNb3JlQWZ0ZXJFbmQnXSkpXSk7CgogIHZhciBmZXRjaE1vcmVFbnRyaWVzRWZmZWN0ID0gZnVuY3Rpb24gZmV0Y2hNb3JlRW50cmllc0VmZmVjdCgpIHsKICAgIGlmIChzdGF0ZS5pc0xvYWRpbmdNb3JlIHx8IHByb3BzLmlzU3RyZWFtaW5nKSByZXR1cm47CiAgICB2YXIgZGlyZWN0aW9uID0gc2hvdWxkRmV0Y2hNb3JlRW50cmllcyhwcm9wcywgc3RhdGUpOwoKICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7CiAgICAgIGNhc2UgU2hvdWxkRmV0Y2hNb3JlRW50cmllcy5CZWZvcmU6CiAgICAgIGNhc2UgU2hvdWxkRmV0Y2hNb3JlRW50cmllcy5BZnRlcjoKICAgICAgICBydW5GZXRjaE1vcmVFbnRyaWVzUmVxdWVzdChkaXJlY3Rpb24pOwogICAgICAgIGJyZWFrOwoKICAgICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KICB9OwoKICB2YXIgZmV0Y2hOZXdlckVudHJpZXMgPSAoMCwgX3JlYWN0LnVzZUNhbGxiYWNrKSgoMCwgX2xvZGFzaC50aHJvdHRsZSkoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHJ1bkZldGNoTW9yZUVudHJpZXNSZXF1ZXN0KFNob3VsZEZldGNoTW9yZUVudHJpZXMuQWZ0ZXIpOwogIH0sIDUwMCksIFtwcm9wcywgc3RhdGUuYm90dG9tQ3Vyc29yXSk7CiAgdmFyIHN0cmVhbUVudHJpZXNFZmZlY3REZXBlbmRlbmNpZXMgPSBbcHJvcHMuaXNTdHJlYW1pbmcsIHN0YXRlLmlzTG9hZGluZ01vcmUsIHN0YXRlLmlzUmVsb2FkaW5nXTsKCiAgdmFyIHN0cmVhbUVudHJpZXNFZmZlY3QgPSBmdW5jdGlvbiBzdHJlYW1FbnRyaWVzRWZmZWN0KCkgewogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgdmFyIGVuZFRpbWVzdGFtcCwgbmV3RW50cmllc0VuZDsKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoIShwcm9wcy5pc1N0cmVhbWluZyAmJiAhc3RhdGUuaXNMb2FkaW5nTW9yZSAmJiAhc3RhdGUuaXNSZWxvYWRpbmcpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE4OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoIXN0YXJ0ZWRTdHJlYW1pbmcpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0OwogICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc2V0VGltZW91dChyZXMsIExJVkVfU1RSRUFNX0lOVEVSVkFMKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEyOwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGVuZFRpbWVzdGFtcCA9IERhdGUubm93KCk7CiAgICAgICAgICAgICAgcHJvcHMuanVtcFRvVGFyZ2V0UG9zaXRpb24oewogICAgICAgICAgICAgICAgdGllYnJlYWtlcjogMCwKICAgICAgICAgICAgICAgIHRpbWU6IGVuZFRpbWVzdGFtcAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHNldFN0YXJ0ZWRTdHJlYW1pbmcodHJ1ZSk7CgogICAgICAgICAgICAgIGlmICghc3RhdGUuaGFzTW9yZUFmdGVyRW5kKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBydW5GZXRjaE5ld0VudHJpZXNSZXF1ZXN0KHsKICAgICAgICAgICAgICAgIGVuZFRpbWVzdGFtcDogZW5kVGltZXN0YW1wCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE0OwogICAgICAgICAgICAgIHJldHVybiBydW5GZXRjaE1vcmVFbnRyaWVzUmVxdWVzdChTaG91bGRGZXRjaE1vcmVFbnRyaWVzLkFmdGVyKTsKCiAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgbmV3RW50cmllc0VuZCA9IF9jb250ZXh0NC5zZW50OwoKICAgICAgICAgICAgICBpZiAobmV3RW50cmllc0VuZCkgewogICAgICAgICAgICAgICAgcHJvcHMuanVtcFRvVGFyZ2V0UG9zaXRpb24obmV3RW50cmllc0VuZCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE5OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICBpZiAoIXByb3BzLmlzU3RyZWFtaW5nKSB7CiAgICAgICAgICAgICAgICBzZXRTdGFydGVkU3RyZWFtaW5nKGZhbHNlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZTQpOwogICAgfSkpKCk7CiAgfTsKCiAgdmFyIGV4cGFuZFJhbmdlRWZmZWN0ID0gZnVuY3Rpb24gZXhwYW5kUmFuZ2VFZmZlY3QoKSB7CiAgICBpZiAoIXByZXZQYXJhbXMgfHwgIXByZXZQYXJhbXMuc3RhcnRUaW1lc3RhbXAgfHwgIXByZXZQYXJhbXMuZW5kVGltZXN0YW1wKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAocHJvcHMudGltZXN0YW1wc0xhc3RVcGRhdGUgPT09IHByZXZQYXJhbXMudGltZXN0YW1wc0xhc3RVcGRhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBzaG91bGRFeHBhbmQgPSB7CiAgICAgIGJlZm9yZTogcHJvcHMuc3RhcnRUaW1lc3RhbXAgPCBwcmV2UGFyYW1zLnN0YXJ0VGltZXN0YW1wLAogICAgICBhZnRlcjogcHJvcHMuZW5kVGltZXN0YW1wID4gcHJldlBhcmFtcy5lbmRUaW1lc3RhbXAKICAgIH07CiAgICBkaXNwYXRjaCh7CiAgICAgIHR5cGU6IEFjdGlvbi5FeHBhbmRSYW5nZSwKICAgICAgcGF5bG9hZDogc2hvdWxkRXhwYW5kCiAgICB9KTsKICB9OwoKICB2YXIgZXhwYW5kUmFuZ2VFZmZlY3REZXBlbmRlbmNpZXMgPSBbcHJldlBhcmFtcyA9PT0gbnVsbCB8fCBwcmV2UGFyYW1zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcmV2UGFyYW1zLnN0YXJ0VGltZXN0YW1wLCBwcmV2UGFyYW1zID09PSBudWxsIHx8IHByZXZQYXJhbXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByZXZQYXJhbXMuZW5kVGltZXN0YW1wLCBwcm9wcy5zdGFydFRpbWVzdGFtcCwgcHJvcHMuZW5kVGltZXN0YW1wLCBwcm9wcy50aW1lc3RhbXBzTGFzdFVwZGF0ZV07CiAgKDAsIF9yZWFjdC51c2VFZmZlY3QpKGZldGNoTmV3RW50cmllc0VmZmVjdCwgZmV0Y2hOZXdFbnRyaWVzRWZmZWN0RGVwZW5kZW5jaWVzKTsKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZmV0Y2hNb3JlRW50cmllc0VmZmVjdCwgZmV0Y2hNb3JlRW50cmllc0VmZmVjdERlcGVuZGVuY2llcyk7CiAgKDAsIF9yZWFjdC51c2VFZmZlY3QpKHN0cmVhbUVudHJpZXNFZmZlY3QsIHN0cmVhbUVudHJpZXNFZmZlY3REZXBlbmRlbmNpZXMpOwogICgwLCBfcmVhY3QudXNlRWZmZWN0KShleHBhbmRSYW5nZUVmZmVjdCwgZXhwYW5kUmFuZ2VFZmZlY3REZXBlbmRlbmNpZXMpOwogIHJldHVybiB7CiAgICBmZXRjaE5ld2VyRW50cmllczogZmV0Y2hOZXdlckVudHJpZXMsCiAgICBjaGVja0Zvck5ld0VudHJpZXM6IHJ1bkZldGNoTmV3RW50cmllc1JlcXVlc3QKICB9Owp9OwoKdmFyIHVzZUxvZ0VudHJpZXNTdGF0ZSA9IGZ1bmN0aW9uIHVzZUxvZ0VudHJpZXNTdGF0ZShwcm9wcykgewogIHZhciBfdXNlUmVkdWNlciA9ICgwLCBfcmVhY3QudXNlUmVkdWNlcikobG9nRW50cmllc1N0YXRlUmVkdWNlciwgbG9nRW50cmllc0luaXRpYWxTdGF0ZSksCiAgICAgIF91c2VSZWR1Y2VyMiA9IF9zbGljZWRUb0FycmF5KF91c2VSZWR1Y2VyLCAyKSwKICAgICAgc3RhdGUgPSBfdXNlUmVkdWNlcjJbMF0sCiAgICAgIGRpc3BhdGNoID0gX3VzZVJlZHVjZXIyWzFdOwoKICB2YXIgX3VzZUZldGNoRW50cmllc0VmZmVjID0gdXNlRmV0Y2hFbnRyaWVzRWZmZWN0KHN0YXRlLCBkaXNwYXRjaCwgcHJvcHMpLAogICAgICBmZXRjaE5ld2VyRW50cmllcyA9IF91c2VGZXRjaEVudHJpZXNFZmZlYy5mZXRjaE5ld2VyRW50cmllcywKICAgICAgY2hlY2tGb3JOZXdFbnRyaWVzID0gX3VzZUZldGNoRW50cmllc0VmZmVjLmNoZWNrRm9yTmV3RW50cmllczsKCiAgdmFyIGNhbGxiYWNrcyA9IHsKICAgIGZldGNoTmV3ZXJFbnRyaWVzOiBmZXRjaE5ld2VyRW50cmllcywKICAgIGNoZWNrRm9yTmV3RW50cmllczogY2hlY2tGb3JOZXdFbnRyaWVzCiAgfTsKICByZXR1cm4gW3N0YXRlLCBjYWxsYmFja3NdOwp9OwoKZXhwb3J0cy51c2VMb2dFbnRyaWVzU3RhdGUgPSB1c2VMb2dFbnRyaWVzU3RhdGU7Cgp2YXIgbG9nRW50cmllc1N0YXRlUmVkdWNlciA9IGZ1bmN0aW9uIGxvZ0VudHJpZXNTdGF0ZVJlZHVjZXIocHJldlN0YXRlLCBhY3Rpb24pIHsKICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7CiAgICBjYXNlIEFjdGlvbi5SZWNlaXZlTmV3RW50cmllczoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZSwge30sIGFjdGlvbi5wYXlsb2FkLCB7CiAgICAgICAgY2VudGVyQ3Vyc29yOiBnZXRDZW50ZXJDdXJzb3IoYWN0aW9uLnBheWxvYWQuZW50cmllcyksCiAgICAgICAgbGFzdExvYWRlZFRpbWU6IG5ldyBEYXRlKCksCiAgICAgICAgaXNSZWxvYWRpbmc6IGZhbHNlLAogICAgICAgIC8vIEJlIG9wdGltaXN0aWMuIElmIGFueSBvZiB0aGUgYmVmb3JlL2FmdGVyIHJlcXVlc3RzIGNvbWVzIGVtcHR5LCBzZXQKICAgICAgICAvLyB0aGUgY29ycmVzcG9uZGluZyBmbGFnIHRvIGBmYWxzZWAKICAgICAgICBoYXNNb3JlQmVmb3JlU3RhcnQ6IHRydWUsCiAgICAgICAgaGFzTW9yZUFmdGVyRW5kOiB0cnVlCiAgICAgIH0pOwoKICAgIGNhc2UgQWN0aW9uLlJlY2VpdmVFbnRyaWVzQmVmb3JlOgogICAgICB7CiAgICAgICAgdmFyIG5ld0VudHJpZXMgPSBhY3Rpb24ucGF5bG9hZC5lbnRyaWVzOwogICAgICAgIHZhciBwcmV2RW50cmllcyA9IGNsZWFuRHVwbGljYXRlSXRlbXMocHJldlN0YXRlLmVudHJpZXMsIG5ld0VudHJpZXMpOwogICAgICAgIHZhciBlbnRyaWVzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShuZXdFbnRyaWVzKSwgX3RvQ29uc3VtYWJsZUFycmF5KHByZXZFbnRyaWVzKSk7CiAgICAgICAgdmFyIHVwZGF0ZSA9IHsKICAgICAgICAgIGVudHJpZXM6IGVudHJpZXMsCiAgICAgICAgICBpc0xvYWRpbmdNb3JlOiBmYWxzZSwKICAgICAgICAgIGhhc01vcmVCZWZvcmVTdGFydDogbmV3RW50cmllcy5sZW5ndGggPiAwLAogICAgICAgICAgLy8gS2VlcCB0aGUgcHJldmlvdXMgY3Vyc29yIGlmIHJlcXVlc3QgY29tZXMgZW1wdHksIHRvIGVhc2lseSBleHRlbmQgdGhlIHJhbmdlLgogICAgICAgICAgdG9wQ3Vyc29yOiBuZXdFbnRyaWVzLmxlbmd0aCA+IDAgPyBhY3Rpb24ucGF5bG9hZC50b3BDdXJzb3IgOiBwcmV2U3RhdGUudG9wQ3Vyc29yLAogICAgICAgICAgY2VudGVyQ3Vyc29yOiBnZXRDZW50ZXJDdXJzb3IoZW50cmllcyksCiAgICAgICAgICBsYXN0TG9hZGVkVGltZTogbmV3IERhdGUoKQogICAgICAgIH07CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZSwge30sIHVwZGF0ZSk7CiAgICAgIH0KCiAgICBjYXNlIEFjdGlvbi5SZWNlaXZlRW50cmllc0FmdGVyOgogICAgICB7CiAgICAgICAgdmFyIF9uZXdFbnRyaWVzID0gYWN0aW9uLnBheWxvYWQuZW50cmllczsKCiAgICAgICAgdmFyIF9wcmV2RW50cmllcyA9IGNsZWFuRHVwbGljYXRlSXRlbXMocHJldlN0YXRlLmVudHJpZXMsIF9uZXdFbnRyaWVzKTsKCiAgICAgICAgdmFyIF9lbnRyaWVzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfcHJldkVudHJpZXMpLCBfdG9Db25zdW1hYmxlQXJyYXkoX25ld0VudHJpZXMpKTsKCiAgICAgICAgdmFyIF91cGRhdGUgPSB7CiAgICAgICAgICBlbnRyaWVzOiBfZW50cmllcywKICAgICAgICAgIGlzTG9hZGluZ01vcmU6IGZhbHNlLAogICAgICAgICAgaGFzTW9yZUFmdGVyRW5kOiBfbmV3RW50cmllcy5sZW5ndGggPiAwLAogICAgICAgICAgLy8gS2VlcCB0aGUgcHJldmlvdXMgY3Vyc29yIGlmIHJlcXVlc3QgY29tZXMgZW1wdHksIHRvIGVhc2lseSBleHRlbmQgdGhlIHJhbmdlLgogICAgICAgICAgYm90dG9tQ3Vyc29yOiBfbmV3RW50cmllcy5sZW5ndGggPiAwID8gYWN0aW9uLnBheWxvYWQuYm90dG9tQ3Vyc29yIDogcHJldlN0YXRlLmJvdHRvbUN1cnNvciwKICAgICAgICAgIGNlbnRlckN1cnNvcjogZ2V0Q2VudGVyQ3Vyc29yKF9lbnRyaWVzKSwKICAgICAgICAgIGxhc3RMb2FkZWRUaW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgfTsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLCB7fSwgX3VwZGF0ZSk7CiAgICAgIH0KCiAgICBjYXNlIEFjdGlvbi5GZXRjaGluZ05ld0VudHJpZXM6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2U3RhdGUsIHsKICAgICAgICBpc1JlbG9hZGluZzogdHJ1ZSwKICAgICAgICBlbnRyaWVzOiBbXSwKICAgICAgICB0b3BDdXJzb3I6IG51bGwsCiAgICAgICAgYm90dG9tQ3Vyc29yOiBudWxsLAogICAgICAgIGNlbnRlckN1cnNvcjogbnVsbCwKICAgICAgICBoYXNNb3JlQmVmb3JlU3RhcnQ6IHRydWUsCiAgICAgICAgaGFzTW9yZUFmdGVyRW5kOiB0cnVlCiAgICAgIH0pOwoKICAgIGNhc2UgQWN0aW9uLkZldGNoaW5nTW9yZUVudHJpZXM6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2U3RhdGUsIHsKICAgICAgICBpc0xvYWRpbmdNb3JlOiB0cnVlCiAgICAgIH0pOwoKICAgIGNhc2UgQWN0aW9uLkVycm9yT25OZXdFbnRyaWVzOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcHJldlN0YXRlLCB7CiAgICAgICAgaXNSZWxvYWRpbmc6IGZhbHNlCiAgICAgIH0pOwoKICAgIGNhc2UgQWN0aW9uLkVycm9yT25Nb3JlRW50cmllczoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHByZXZTdGF0ZSwgewogICAgICAgIGlzTG9hZGluZ01vcmU6IGZhbHNlCiAgICAgIH0pOwoKICAgIGNhc2UgQWN0aW9uLkV4cGFuZFJhbmdlOgogICAgICB7CiAgICAgICAgdmFyIGhhc01vcmVCZWZvcmVTdGFydCA9IGFjdGlvbi5wYXlsb2FkLmJlZm9yZSA/IHRydWUgOiBwcmV2U3RhdGUuaGFzTW9yZUJlZm9yZVN0YXJ0OwogICAgICAgIHZhciBoYXNNb3JlQWZ0ZXJFbmQgPSBhY3Rpb24ucGF5bG9hZC5hZnRlciA/IHRydWUgOiBwcmV2U3RhdGUuaGFzTW9yZUFmdGVyRW5kOwogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2U3RhdGUsIHsKICAgICAgICAgIGhhc01vcmVCZWZvcmVTdGFydDogaGFzTW9yZUJlZm9yZVN0YXJ0LAogICAgICAgICAgaGFzTW9yZUFmdGVyRW5kOiBoYXNNb3JlQWZ0ZXJFbmQKICAgICAgICB9KTsKICAgICAgfQoKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBFcnJvcigpOwogIH0KfTsKCmZ1bmN0aW9uIGdldENlbnRlckN1cnNvcihlbnRyaWVzKSB7CiAgcmV0dXJuIGVudHJpZXMubGVuZ3RoID4gMCA/IGVudHJpZXNbTWF0aC5mbG9vcihlbnRyaWVzLmxlbmd0aCAvIDIpXS5jdXJzb3IgOiBudWxsOwp9Cgp2YXIgTG9nRW50cmllc1N0YXRlID0gKDAsIF9jb25zdGF0ZS5kZWZhdWx0KSh1c2VMb2dFbnRyaWVzU3RhdGUpOwpleHBvcnRzLkxvZ0VudHJpZXNTdGF0ZSA9IExvZ0VudHJpZXNTdGF0ZTs="},null]}