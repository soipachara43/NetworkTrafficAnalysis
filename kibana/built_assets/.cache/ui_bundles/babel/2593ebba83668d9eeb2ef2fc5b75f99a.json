{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/data/public/ui/query_string_input/query_string_input.js","dependencies":[{"path":"src/plugins/data/public/ui/query_string_input/query_string_input.js","mtime":1589249550691},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dCA9IGV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dFVJID0gdm9pZCAwOwoKdmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9yZWFjdDIgPSByZXF1aXJlKCJAa2JuL2kxOG4vcmVhY3QiKTsKCnZhciBfbG9kYXNoID0gcmVxdWlyZSgibG9kYXNoIik7Cgp2YXIgX2F1dG9jb21wbGV0ZSA9IHJlcXVpcmUoIi4uLy4uL2F1dG9jb21wbGV0ZSIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9raWJhbmFfcmVhY3QvcHVibGljIik7Cgp2YXIgX2ZldGNoX2luZGV4X3BhdHRlcm5zID0gcmVxdWlyZSgiLi9mZXRjaF9pbmRleF9wYXR0ZXJucyIpOwoKdmFyIF9sYW5ndWFnZV9zd2l0Y2hlciA9IHJlcXVpcmUoIi4vbGFuZ3VhZ2Vfc3dpdGNoZXIiKTsKCnZhciBfcXVlcnkgPSByZXF1aXJlKCIuLi8uLi9xdWVyeSIpOwoKdmFyIF8gPSByZXF1aXJlKCIuLiIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gKHRhcmdldCkgewogICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdGFyZ2V0OwogIH07CgogIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdHlwZW9mKG9iaikgewogIGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YyKFN5bWJvbC5pdGVyYXRvcikgPT09ICJzeW1ib2wiKSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0gZWxzZSB7CiAgICBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICAgICAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogX3R5cGVvZjIob2JqKTsKICAgIH07CiAgfQoKICByZXR1cm4gX3R5cGVvZihvYmopOwp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICB0cnkgewogICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVqZWN0KGVycm9yKTsKICAgIHJldHVybjsKICB9CgogIGlmIChpbmZvLmRvbmUpIHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0gZWxzZSB7CiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgfQp9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgfQoKICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsKICBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7CiAgICByZXR1cm4gY2FsbDsKICB9CgogIHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOwp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7CiAgaWYgKHNlbGYgPT09IHZvaWQgMCkgewogICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsKICB9CgogIHJldHVybiBzZWxmOwp9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsKICB9CgogIHN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICB3cml0YWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9CiAgfSk7CiAgaWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7Cn0KCmZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CiAgICBvLl9fcHJvdG9fXyA9IHA7CiAgICByZXR1cm4gbzsKICB9OwoKICByZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApOwp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIEtFWV9DT0RFUyA9IHsKICBMRUZUOiAzNywKICBVUDogMzgsCiAgUklHSFQ6IDM5LAogIERPV046IDQwLAogIEVOVEVSOiAxMywKICBFU0M6IDI3LAogIFRBQjogOSwKICBIT01FOiAzNiwKICBFTkQ6IDM1Cn07Cgp2YXIgUXVlcnlTdHJpbmdJbnB1dFVJID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoX0NvbXBvbmVudCkgewogIF9pbmhlcml0cyhRdWVyeVN0cmluZ0lucHV0VUksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBRdWVyeVN0cmluZ0lucHV0VUkoKSB7CiAgICB2YXIgX2dldFByb3RvdHlwZU9mMjsKCiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFF1ZXJ5U3RyaW5nSW5wdXRVSSk7CgogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBuZXcgQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7CiAgICAgIGFyZ3NbX2tleV0gPSBhcmd1bWVudHNbX2tleV07CiAgICB9CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCAoX2dldFByb3RvdHlwZU9mMiA9IF9nZXRQcm90b3R5cGVPZihRdWVyeVN0cmluZ0lucHV0VUkpKS5jYWxsLmFwcGx5KF9nZXRQcm90b3R5cGVPZjIsIFt0aGlzXS5jb25jYXQoYXJncykpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdGF0ZSIsIHsKICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICBpbmRleDogbnVsbCwKICAgICAgc3VnZ2VzdGlvbnM6IFtdLAogICAgICBzdWdnZXN0aW9uTGltaXQ6IDUwLAogICAgICBzZWxlY3Rpb25TdGFydDogbnVsbCwKICAgICAgc2VsZWN0aW9uRW5kOiBudWxsLAogICAgICBpbmRleFBhdHRlcm5zOiBbXQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5wdXRSZWYiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJwZXJzaXN0ZWRMb2ciLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImFib3J0Q29udHJvbGxlciIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2VydmljZXMiLCBfdGhpcy5wcm9wcy5raWJhbmEuc2VydmljZXMpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImNvbXBvbmVudElzVW5tb3VudGluZyIsIGZhbHNlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRRdWVyeVN0cmluZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuICgwLCBfcXVlcnkudG9Vc2VyKShfdGhpcy5wcm9wcy5xdWVyeS5xdWVyeSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJmZXRjaEluZGV4UGF0dGVybnMiLAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICB2YXIgc3RyaW5nUGF0dGVybnMsIG9iamVjdFBhdHRlcm5zLCBvYmplY3RQYXR0ZXJuc0Zyb21TdHJpbmdzOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgc3RyaW5nUGF0dGVybnMgPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmZpbHRlcihmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGluZGV4UGF0dGVybiA9PT0gJ3N0cmluZyc7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgb2JqZWN0UGF0dGVybnMgPSBfdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zLmZpbHRlcihmdW5jdGlvbiAoaW5kZXhQYXR0ZXJuKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIGluZGV4UGF0dGVybiAhPT0gJ3N0cmluZyc7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgcmV0dXJuICgwLCBfZmV0Y2hfaW5kZXhfcGF0dGVybnMuZmV0Y2hJbmRleFBhdHRlcm5zKShfdGhpcy5zZXJ2aWNlcy5zYXZlZE9iamVjdHMuY2xpZW50LCBzdHJpbmdQYXR0ZXJucywgX3RoaXMuc2VydmljZXMudWlTZXR0aW5ncyk7CgogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgb2JqZWN0UGF0dGVybnNGcm9tU3RyaW5ncyA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybnM6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkob2JqZWN0UGF0dGVybnMpLCBfdG9Db25zdW1hYmxlQXJyYXkob2JqZWN0UGF0dGVybnNGcm9tU3RyaW5ncykpCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUpOwogICAgfSkpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnZXRTdWdnZXN0aW9ucyIsCiAgICAvKiNfX1BVUkVfXyovCiAgICBfYXN5bmNUb0dlbmVyYXRvcigKICAgIC8qI19fUFVSRV9fKi8KICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICB2YXIgbGFuZ3VhZ2UsIHF1ZXJ5U3RyaW5nLCByZWNlbnRTZWFyY2hTdWdnZXN0aW9ucywgaGFzUXVlcnlTdWdnZXN0aW9ucywgaW5kZXhQYXR0ZXJucywgX3RoaXMkaW5wdXRSZWYsIHNlbGVjdGlvblN0YXJ0LCBzZWxlY3Rpb25FbmQsIHN1Z2dlc3Rpb25zOwoKICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBpZiAoX3RoaXMuaW5wdXRSZWYpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGxhbmd1YWdlID0gX3RoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2U7CiAgICAgICAgICAgICAgcXVlcnlTdHJpbmcgPSBfdGhpcy5nZXRRdWVyeVN0cmluZygpOwogICAgICAgICAgICAgIHJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zID0gX3RoaXMuZ2V0UmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMocXVlcnlTdHJpbmcpOwogICAgICAgICAgICAgIGhhc1F1ZXJ5U3VnZ2VzdGlvbnMgPSBfdGhpcy5zZXJ2aWNlcy5kYXRhLmF1dG9jb21wbGV0ZS5oYXNRdWVyeVN1Z2dlc3Rpb25zKGxhbmd1YWdlKTsKCiAgICAgICAgICAgICAgaWYgKCEoIWhhc1F1ZXJ5U3VnZ2VzdGlvbnMgfHwgIUFycmF5LmlzQXJyYXkoX3RoaXMuc3RhdGUuaW5kZXhQYXR0ZXJucykgfHwgKDAsIF9sb2Rhc2guY29tcGFjdCkoX3RoaXMuc3RhdGUuaW5kZXhQYXR0ZXJucykubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA4OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgcmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMpOwoKICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGluZGV4UGF0dGVybnMgPSBfdGhpcy5zdGF0ZS5pbmRleFBhdHRlcm5zOwogICAgICAgICAgICAgIF90aGlzJGlucHV0UmVmID0gX3RoaXMuaW5wdXRSZWYsIHNlbGVjdGlvblN0YXJ0ID0gX3RoaXMkaW5wdXRSZWYuc2VsZWN0aW9uU3RhcnQsIHNlbGVjdGlvbkVuZCA9IF90aGlzJGlucHV0UmVmLnNlbGVjdGlvbkVuZDsKCiAgICAgICAgICAgICAgaWYgKCEoc2VsZWN0aW9uU3RhcnQgPT09IG51bGwgfHwgc2VsZWN0aW9uRW5kID09PSBudWxsKSkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDEyOwogICAgICAgICAgICAgIGlmIChfdGhpcy5hYm9ydENvbnRyb2xsZXIpIF90aGlzLmFib3J0Q29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgIF90aGlzLmFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE3OwogICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zZXJ2aWNlcy5kYXRhLmF1dG9jb21wbGV0ZS5nZXRRdWVyeVN1Z2dlc3Rpb25zKHsKICAgICAgICAgICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSwKICAgICAgICAgICAgICAgIGluZGV4UGF0dGVybnM6IGluZGV4UGF0dGVybnMsCiAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnlTdHJpbmcsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25TdGFydDogc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgICAgICBzZWxlY3Rpb25FbmQ6IHNlbGVjdGlvbkVuZCwKICAgICAgICAgICAgICAgIHNpZ25hbDogX3RoaXMuYWJvcnRDb250cm9sbGVyLnNpZ25hbAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICBfY29udGV4dDIudDAgPSBfY29udGV4dDIuc2VudDsKCiAgICAgICAgICAgICAgaWYgKF9jb250ZXh0Mi50MCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAyMDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgX2NvbnRleHQyLnQwID0gW107CgogICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgIHN1Z2dlc3Rpb25zID0gX2NvbnRleHQyLnQwOwogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN1Z2dlc3Rpb25zKSwgX3RvQ29uc3VtYWJsZUFycmF5KHJlY2VudFNlYXJjaFN1Z2dlc3Rpb25zKSkpOwoKICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICBfY29udGV4dDIucHJldiA9IDI0OwogICAgICAgICAgICAgIF9jb250ZXh0Mi50MSA9IF9jb250ZXh0MlsiY2F0Y2giXSgxMik7CgogICAgICAgICAgICAgIGlmICghKF9jb250ZXh0Mi50MS5tZXNzYWdlID09PSAnVGhlIHVzZXIgYWJvcnRlZCBhIHJlcXVlc3QuJykpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQyLnQxOwoKICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyLCBudWxsLCBbWzEyLCAyNF1dKTsKICAgIH0pKSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ2V0UmVjZW50U2VhcmNoU3VnZ2VzdGlvbnMiLCBmdW5jdGlvbiAocXVlcnkpIHsKICAgICAgaWYgKCFfdGhpcy5wZXJzaXN0ZWRMb2cpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIHZhciByZWNlbnRTZWFyY2hlcyA9IF90aGlzLnBlcnNpc3RlZExvZy5nZXQoKTsKCiAgICAgIHZhciBtYXRjaGluZ1JlY2VudFNlYXJjaGVzID0gcmVjZW50U2VhcmNoZXMuZmlsdGVyKGZ1bmN0aW9uIChyZWNlbnRRdWVyeSkgewogICAgICAgIHZhciByZWNlbnRRdWVyeVN0cmluZyA9IF90eXBlb2YocmVjZW50UXVlcnkpID09PSAnb2JqZWN0JyA/ICgwLCBfcXVlcnkudG9Vc2VyKShyZWNlbnRRdWVyeSkgOiByZWNlbnRRdWVyeTsKICAgICAgICByZXR1cm4gcmVjZW50UXVlcnlTdHJpbmcuaW5jbHVkZXMocXVlcnkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIG1hdGNoaW5nUmVjZW50U2VhcmNoZXMubWFwKGZ1bmN0aW9uIChyZWNlbnRTZWFyY2gpIHsKICAgICAgICB2YXIgdGV4dCA9ICgwLCBfcXVlcnkudG9Vc2VyKShyZWNlbnRTZWFyY2gpOwogICAgICAgIHZhciBzdGFydCA9IDA7CiAgICAgICAgdmFyIGVuZCA9IHF1ZXJ5Lmxlbmd0aDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdHlwZTogX2F1dG9jb21wbGV0ZS5RdWVyeVN1Z2dlc3Rpb25UeXBlcy5SZWNlbnRTZWFyY2gsCiAgICAgICAgICB0ZXh0OiB0ZXh0LAogICAgICAgICAgc3RhcnQ6IHN0YXJ0LAogICAgICAgICAgZW5kOiBlbmQKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInVwZGF0ZVN1Z2dlc3Rpb25zIiwgKDAsIF9sb2Rhc2guZGVib3VuY2UpKAogICAgLyojX19QVVJFX18qLwogICAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAvKiNfX1BVUkVfXyovCiAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgdmFyIHN1Z2dlc3Rpb25zOwogICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuZ2V0U3VnZ2VzdGlvbnMoKTsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDMuc2VudDsKCiAgICAgICAgICAgICAgaWYgKF9jb250ZXh0My50MCkgewogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBbXTsKCiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBzdWdnZXN0aW9ucyA9IF9jb250ZXh0My50MDsKCiAgICAgICAgICAgICAgaWYgKCFfdGhpcy5jb21wb25lbnRJc1VubW91bnRpbmcpIHsKICAgICAgICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnM6IHN1Z2dlc3Rpb25zCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlMyk7CiAgICB9KSksIDEwMCkpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uU3VibWl0IiwgZnVuY3Rpb24gKHF1ZXJ5KSB7CiAgICAgIGlmIChfdGhpcy5wcm9wcy5vblN1Ym1pdCkgewogICAgICAgIGlmIChfdGhpcy5wZXJzaXN0ZWRMb2cpIHsKICAgICAgICAgIF90aGlzLnBlcnNpc3RlZExvZy5hZGQocXVlcnkucXVlcnkpOwogICAgICAgIH0KCiAgICAgICAgX3RoaXMucHJvcHMub25TdWJtaXQoewogICAgICAgICAgcXVlcnk6ICgwLCBfcXVlcnkuZnJvbVVzZXIpKHF1ZXJ5LnF1ZXJ5KSwKICAgICAgICAgIGxhbmd1YWdlOiBxdWVyeS5sYW5ndWFnZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNoYW5nZSIsIGZ1bmN0aW9uIChxdWVyeSkgewogICAgICBfdGhpcy51cGRhdGVTdWdnZXN0aW9ucygpOwoKICAgICAgaWYgKF90aGlzLnByb3BzLm9uQ2hhbmdlKSB7CiAgICAgICAgX3RoaXMucHJvcHMub25DaGFuZ2UoewogICAgICAgICAgcXVlcnk6ICgwLCBfcXVlcnkuZnJvbVVzZXIpKHF1ZXJ5LnF1ZXJ5KSwKICAgICAgICAgIGxhbmd1YWdlOiBxdWVyeS5sYW5ndWFnZQogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvblF1ZXJ5U3RyaW5nQ2hhbmdlIiwgZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogdHJ1ZSwKICAgICAgICBpbmRleDogbnVsbCwKICAgICAgICBzdWdnZXN0aW9uTGltaXQ6IDUwCiAgICAgIH0pOwoKICAgICAgX3RoaXMub25DaGFuZ2UoewogICAgICAgIHF1ZXJ5OiB2YWx1ZSwKICAgICAgICBsYW5ndWFnZTogX3RoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UKICAgICAgfSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbklucHV0Q2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uQ2xpY2tJbnB1dCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoZXZlbnQudGFyZ2V0IGluc3RhbmNlb2YgSFRNTElucHV0RWxlbWVudCkgewogICAgICAgIF90aGlzLm9uUXVlcnlTdHJpbmdDaGFuZ2UoZXZlbnQudGFyZ2V0LnZhbHVlKTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25LZXlVcCIsIGZ1bmN0aW9uIChldmVudCkgewogICAgICBpZiAoW0tFWV9DT0RFUy5MRUZULCBLRVlfQ09ERVMuUklHSFQsIEtFWV9DT0RFUy5IT01FLCBLRVlfQ09ERVMuRU5EXS5pbmNsdWRlcyhldmVudC5rZXlDb2RlKSkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiB0cnVlCiAgICAgICAgfSk7CgogICAgICAgIGlmIChldmVudC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSB7CiAgICAgICAgICBfdGhpcy5vblF1ZXJ5U3RyaW5nQ2hhbmdlKGV2ZW50LnRhcmdldC52YWx1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbktleURvd24iLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgaWYgKGV2ZW50LnRhcmdldCBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKICAgICAgICB2YXIgX3RoaXMkc3RhdGUgPSBfdGhpcy5zdGF0ZSwKICAgICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGUgPSBfdGhpcyRzdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZSwKICAgICAgICAgICAgaW5kZXggPSBfdGhpcyRzdGF0ZS5pbmRleDsKICAgICAgICB2YXIgcHJldmVudERlZmF1bHQgPSBldmVudC5wcmV2ZW50RGVmYXVsdC5iaW5kKGV2ZW50KTsKICAgICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0LAogICAgICAgICAgICBrZXkgPSBldmVudC5rZXksCiAgICAgICAgICAgIG1ldGFLZXkgPSBldmVudC5tZXRhS2V5OwogICAgICAgIHZhciB2YWx1ZSA9IHRhcmdldC52YWx1ZSwKICAgICAgICAgICAgc2VsZWN0aW9uU3RhcnQgPSB0YXJnZXQuc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICAgIHNlbGVjdGlvbkVuZCA9IHRhcmdldC5zZWxlY3Rpb25FbmQ7CgogICAgICAgIHZhciB1cGRhdGVRdWVyeSA9IGZ1bmN0aW9uIHVwZGF0ZVF1ZXJ5KHF1ZXJ5LCBuZXdTZWxlY3Rpb25TdGFydCwgbmV3U2VsZWN0aW9uRW5kKSB7CiAgICAgICAgICBfdGhpcy5vblF1ZXJ5U3RyaW5nQ2hhbmdlKHF1ZXJ5KTsKCiAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0OiBuZXdTZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgc2VsZWN0aW9uRW5kOiBuZXdTZWxlY3Rpb25FbmQKICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgewogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuRE9XTjoKICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIGlmIChpc1N1Z2dlc3Rpb25zVmlzaWJsZSAmJiBpbmRleCAhPT0gbnVsbCkgewogICAgICAgICAgICAgIF90aGlzLmluY3JlbWVudEluZGV4KGluZGV4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGluZGV4OiAwCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgS0VZX0NPREVTLlVQOgogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKGlzU3VnZ2VzdGlvbnNWaXNpYmxlICYmIGluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgX3RoaXMuZGVjcmVtZW50SW5kZXgoaW5kZXgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIEtFWV9DT0RFUy5FTlRFUjoKICAgICAgICAgICAgaWYgKCFfdGhpcy5wcm9wcy5idWJibGVTdWJtaXRFdmVudCkgewogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc1N1Z2dlc3Rpb25zVmlzaWJsZSAmJiBpbmRleCAhPT0gbnVsbCAmJiBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9uc1tpbmRleF0pIHsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RTdWdnZXN0aW9uKF90aGlzLnN0YXRlLnN1Z2dlc3Rpb25zW2luZGV4XSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMub25TdWJtaXQoX3RoaXMucHJvcHMucXVlcnkpOwoKICAgICAgICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBLRVlfQ09ERVMuRVNDOgogICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgS0VZX0NPREVTLlRBQjoKICAgICAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgICAgIGlzU3VnZ2VzdGlvbnNWaXNpYmxlOiBmYWxzZSwKICAgICAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlmIChzZWxlY3Rpb25TdGFydCAhPT0gbnVsbCAmJiBzZWxlY3Rpb25FbmQgIT09IG51bGwpIHsKICAgICAgICAgICAgICAoMCwgX3F1ZXJ5Lm1hdGNoUGFpcnMpKHsKICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgIHNlbGVjdGlvblN0YXJ0OiBzZWxlY3Rpb25TdGFydCwKICAgICAgICAgICAgICAgIHNlbGVjdGlvbkVuZDogc2VsZWN0aW9uRW5kLAogICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICBtZXRhS2V5OiBtZXRhS2V5LAogICAgICAgICAgICAgICAgdXBkYXRlUXVlcnk6IHVwZGF0ZVF1ZXJ5LAogICAgICAgICAgICAgICAgcHJldmVudERlZmF1bHQ6IHByZXZlbnREZWZhdWx0CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAic2VsZWN0U3VnZ2VzdGlvbiIsIGZ1bmN0aW9uIChzdWdnZXN0aW9uKSB7CiAgICAgIGlmICghX3RoaXMuaW5wdXRSZWYpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciB0eXBlID0gc3VnZ2VzdGlvbi50eXBlLAogICAgICAgICAgdGV4dCA9IHN1Z2dlc3Rpb24udGV4dCwKICAgICAgICAgIHN0YXJ0ID0gc3VnZ2VzdGlvbi5zdGFydCwKICAgICAgICAgIGVuZCA9IHN1Z2dlc3Rpb24uZW5kLAogICAgICAgICAgY3Vyc29ySW5kZXggPSBzdWdnZXN0aW9uLmN1cnNvckluZGV4OwoKICAgICAgX3RoaXMuaGFuZGxlTmVzdGVkRmllbGRTeW50YXhOb3RpZmljYXRpb24oc3VnZ2VzdGlvbik7CgogICAgICB2YXIgcXVlcnkgPSBfdGhpcy5nZXRRdWVyeVN0cmluZygpOwoKICAgICAgdmFyIF90aGlzJGlucHV0UmVmMiA9IF90aGlzLmlucHV0UmVmLAogICAgICAgICAgc2VsZWN0aW9uU3RhcnQgPSBfdGhpcyRpbnB1dFJlZjIuc2VsZWN0aW9uU3RhcnQsCiAgICAgICAgICBzZWxlY3Rpb25FbmQgPSBfdGhpcyRpbnB1dFJlZjIuc2VsZWN0aW9uRW5kOwoKICAgICAgaWYgKHNlbGVjdGlvblN0YXJ0ID09PSBudWxsIHx8IHNlbGVjdGlvbkVuZCA9PT0gbnVsbCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHZhbHVlID0gcXVlcnkuc3Vic3RyKDAsIHNlbGVjdGlvblN0YXJ0KSArIHF1ZXJ5LnN1YnN0cihzZWxlY3Rpb25FbmQpOwogICAgICB2YXIgbmV3UXVlcnlTdHJpbmcgPSB2YWx1ZS5zdWJzdHIoMCwgc3RhcnQpICsgdGV4dCArIHZhbHVlLnN1YnN0cihlbmQpOwoKICAgICAgX3RoaXMub25RdWVyeVN0cmluZ0NoYW5nZShuZXdRdWVyeVN0cmluZyk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc2VsZWN0aW9uU3RhcnQ6IHN0YXJ0ICsgKGN1cnNvckluZGV4ID8gY3Vyc29ySW5kZXggOiB0ZXh0Lmxlbmd0aCksCiAgICAgICAgc2VsZWN0aW9uRW5kOiBzdGFydCArIChjdXJzb3JJbmRleCA/IGN1cnNvckluZGV4IDogdGV4dC5sZW5ndGgpCiAgICAgIH0pOwoKICAgICAgaWYgKHR5cGUgPT09IF9hdXRvY29tcGxldGUuUXVlcnlTdWdnZXN0aW9uVHlwZXMuUmVjZW50U2VhcmNoKSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgaXNTdWdnZXN0aW9uc1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgaW5kZXg6IG51bGwKICAgICAgICB9KTsKCiAgICAgICAgX3RoaXMub25TdWJtaXQoewogICAgICAgICAgcXVlcnk6IG5ld1F1ZXJ5U3RyaW5nLAogICAgICAgICAgbGFuZ3VhZ2U6IF90aGlzLnByb3BzLnF1ZXJ5Lmxhbmd1YWdlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImhhbmRsZU5lc3RlZEZpZWxkU3ludGF4Tm90aWZpY2F0aW9uIiwgZnVuY3Rpb24gKHN1Z2dlc3Rpb24pIHsKICAgICAgaWYgKCdmaWVsZCcgaW4gc3VnZ2VzdGlvbiAmJiBzdWdnZXN0aW9uLmZpZWxkLnN1YlR5cGUgJiYgc3VnZ2VzdGlvbi5maWVsZC5zdWJUeXBlLm5lc3RlZCAmJiAhX3RoaXMuc2VydmljZXMuc3RvcmFnZS5nZXQoJ2tpYmFuYS5LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9PcHRPdXQnKSkgewogICAgICAgIHZhciBfdGhpcyRzZXJ2aWNlcyA9IF90aGlzLnNlcnZpY2VzLAogICAgICAgICAgICBub3RpZmljYXRpb25zID0gX3RoaXMkc2VydmljZXMubm90aWZpY2F0aW9ucywKICAgICAgICAgICAgZG9jTGlua3MgPSBfdGhpcyRzZXJ2aWNlcy5kb2NMaW5rczsKCiAgICAgICAgdmFyIG9uS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvT3B0T3V0ID0gZnVuY3Rpb24gb25LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9PcHRPdXQodG9hc3QpIHsKICAgICAgICAgIGlmICghX3RoaXMuc2VydmljZXMuc3RvcmFnZSkgcmV0dXJuOwoKICAgICAgICAgIF90aGlzLnNlcnZpY2VzLnN0b3JhZ2Uuc2V0KCdraWJhbmEuS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvT3B0T3V0JywgdHJ1ZSk7CgogICAgICAgICAgbm90aWZpY2F0aW9ucy50b2FzdHMucmVtb3ZlKHRvYXN0KTsKICAgICAgICB9OwoKICAgICAgICBpZiAobm90aWZpY2F0aW9ucyAmJiBkb2NMaW5rcykgewogICAgICAgICAgdmFyIHRvYXN0ID0gbm90aWZpY2F0aW9ucy50b2FzdHMuYWRkKHsKICAgICAgICAgICAgdGl0bGU6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdkYXRhLnF1ZXJ5LnF1ZXJ5QmFyLktRTE5lc3RlZFF1ZXJ5U3ludGF4SW5mb1RpdGxlJywgewogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnS1FMIG5lc3RlZCBxdWVyeSBzeW50YXgnCiAgICAgICAgICAgIH0pLAogICAgICAgICAgICB0ZXh0OiAoMCwgX3B1YmxpYy50b01vdW50UG9pbnQpKF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICAgIGlkOiAiZGF0YS5xdWVyeS5xdWVyeUJhci5LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9UZXh0IiwKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkl0IGxvb2tzIGxpa2UgeW91J3JlIHF1ZXJ5aW5nIG9uIGEgbmVzdGVkIGZpZWxkLiBZb3UgY2FuIGNvbnN0cnVjdCBLUUwgc3ludGF4IGZvciBuZXN0ZWQgcXVlcmllcyBpbiBkaWZmZXJlbnQgd2F5cywgZGVwZW5kaW5nIG9uIHRoZSByZXN1bHRzIHlvdSB3YW50LiBMZWFybiBtb3JlIGluIG91ciB7bGlua30uIiwKICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgIGxpbms6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlMaW5rLCB7CiAgICAgICAgICAgICAgICAgIGhyZWY6IGRvY0xpbmtzLmxpbmtzLnF1ZXJ5Lmt1ZXJ5UXVlcnlTeW50YXgsCiAgICAgICAgICAgICAgICAgIHRhcmdldDogIl9ibGFuayIKICAgICAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiAiZGF0YS5xdWVyeS5xdWVyeUJhci5LUUxOZXN0ZWRRdWVyeVN5bnRheEluZm9Eb2NMaW5rVGV4dCIsCiAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiZG9jcyIKICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRmxleEdyb3VwLCB7CiAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ6ICJmbGV4RW5kIiwKICAgICAgICAgICAgICBndXR0ZXJTaXplOiAicyIKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZsZXhJdGVtLCB7CiAgICAgICAgICAgICAgZ3JvdzogZmFsc2UKICAgICAgICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUJ1dHRvbiwgewogICAgICAgICAgICAgIHNpemU6ICJzIiwKICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9uS1FMTmVzdGVkUXVlcnlTeW50YXhJbmZvT3B0T3V0KHRvYXN0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgICAgaWQ6ICJkYXRhLnF1ZXJ5LnF1ZXJ5QmFyLktRTE5lc3RlZFF1ZXJ5U3ludGF4SW5mb09wdE91dFRleHQiLAogICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiRG9uJ3Qgc2hvdyBhZ2FpbiIKICAgICAgICAgICAgfSkpKSkpKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJpbmNyZWFzZUxpbWl0IiwgZnVuY3Rpb24gKCkgewogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc3VnZ2VzdGlvbkxpbWl0OiBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9uTGltaXQgKyA1MAogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgImluY3JlbWVudEluZGV4IiwgZnVuY3Rpb24gKGN1cnJlbnRJbmRleCkgewogICAgICB2YXIgbmV4dEluZGV4ID0gY3VycmVudEluZGV4ICsgMTsKCiAgICAgIGlmIChjdXJyZW50SW5kZXggPT09IG51bGwgfHwgbmV4dEluZGV4ID49IF90aGlzLnN0YXRlLnN1Z2dlc3Rpb25zLmxlbmd0aCkgewogICAgICAgIG5leHRJbmRleCA9IDA7CiAgICAgIH0KCiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpbmRleDogbmV4dEluZGV4CiAgICAgIH0pOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZGVjcmVtZW50SW5kZXgiLCBmdW5jdGlvbiAoY3VycmVudEluZGV4KSB7CiAgICAgIHZhciBwcmV2aW91c0luZGV4ID0gY3VycmVudEluZGV4IC0gMTsKCiAgICAgIGlmIChwcmV2aW91c0luZGV4IDwgMCkgewogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGluZGV4OiBfdGhpcy5zdGF0ZS5zdWdnZXN0aW9ucy5sZW5ndGggLSAxCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgICAgaW5kZXg6IHByZXZpb3VzSW5kZXgKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25TZWxlY3RMYW5ndWFnZSIsIGZ1bmN0aW9uIChsYW5ndWFnZSkgewogICAgICAvLyBTZW5kIHRlbGVtZXRyeSBpbmZvIGV2ZXJ5IHRpbWUgdGhlIHVzZXIgb3B0cyBpbiBvciBvdXQgb2Yga3VlcnkKICAgICAgLy8gQXMgYSByZXN1bHQgaXQgaXMgaW1wb3J0YW50IHRoaXMgZnVuY3Rpb24gb25seSBldmVyIGdldHMgY2FsbGVkIGluIHRoZQogICAgICAvLyBVSSBjb21wb25lbnQncyBjaGFuZ2UgaGFuZGxlci4KICAgICAgX3RoaXMuc2VydmljZXMuaHR0cC5wb3N0KCcvYXBpL2tpYmFuYS9rcWxfb3B0X2luX3RlbGVtZXRyeScsIHsKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICBvcHRfaW46IGxhbmd1YWdlID09PSAna3VlcnknCiAgICAgICAgfSkKICAgICAgfSk7CgogICAgICBfdGhpcy5zZXJ2aWNlcy5zdG9yYWdlLnNldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJywgbGFuZ3VhZ2UpOwoKICAgICAgdmFyIG5ld1F1ZXJ5ID0gewogICAgICAgIHF1ZXJ5OiAnJywKICAgICAgICBsYW5ndWFnZTogbGFuZ3VhZ2UKICAgICAgfTsKCiAgICAgIF90aGlzLm9uQ2hhbmdlKG5ld1F1ZXJ5KTsKCiAgICAgIF90aGlzLm9uU3VibWl0KG5ld1F1ZXJ5KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uT3V0c2lkZUNsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICBpZiAoX3RoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUpIHsKICAgICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBpc1N1Z2dlc3Rpb25zVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICBpbmRleDogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbkNsaWNrU3VnZ2VzdGlvbiIsIGZ1bmN0aW9uIChzdWdnZXN0aW9uKSB7CiAgICAgIGlmICghX3RoaXMuaW5wdXRSZWYpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIF90aGlzLnNlbGVjdFN1Z2dlc3Rpb24oc3VnZ2VzdGlvbik7CgogICAgICBfdGhpcy5pbnB1dFJlZi5mb2N1cygpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaW5pdFBlcnNpc3RlZExvZyIsIGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF90aGlzJHNlcnZpY2VzMiA9IF90aGlzLnNlcnZpY2VzLAogICAgICAgICAgdWlTZXR0aW5ncyA9IF90aGlzJHNlcnZpY2VzMi51aVNldHRpbmdzLAogICAgICAgICAgc3RvcmFnZSA9IF90aGlzJHNlcnZpY2VzMi5zdG9yYWdlLAogICAgICAgICAgYXBwTmFtZSA9IF90aGlzJHNlcnZpY2VzMi5hcHBOYW1lOwogICAgICBfdGhpcy5wZXJzaXN0ZWRMb2cgPSBfdGhpcy5wcm9wcy5wZXJzaXN0ZWRMb2cgPyBfdGhpcy5wcm9wcy5wZXJzaXN0ZWRMb2cgOiAoMCwgX3F1ZXJ5LmdldFF1ZXJ5TG9nKSh1aVNldHRpbmdzLCBzdG9yYWdlLCBhcHBOYW1lLCBfdGhpcy5wcm9wcy5xdWVyeS5sYW5ndWFnZSk7CiAgICB9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJvbk1vdXNlRW50ZXJTdWdnZXN0aW9uIiwgZnVuY3Rpb24gKGluZGV4KSB7CiAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICBpbmRleDogaW5kZXgKICAgICAgfSk7CiAgICB9KTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUXVlcnlTdHJpbmdJbnB1dFVJLCBbewogICAga2V5OiAiY29tcG9uZW50RGlkTW91bnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZE1vdW50KCkgewogICAgICB2YXIgcGFyc2VkUXVlcnkgPSAoMCwgX3F1ZXJ5LmZyb21Vc2VyKSgoMCwgX3F1ZXJ5LnRvVXNlcikodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSkpOwoKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKSh0aGlzLnByb3BzLnF1ZXJ5LnF1ZXJ5LCBwYXJzZWRRdWVyeSkpIHsKICAgICAgICB0aGlzLm9uQ2hhbmdlKF9vYmplY3RTcHJlYWQoe30sIHRoaXMucHJvcHMucXVlcnksIHsKICAgICAgICAgIHF1ZXJ5OiBwYXJzZWRRdWVyeQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0UGVyc2lzdGVkTG9nKCk7CiAgICAgIHRoaXMuZmV0Y2hJbmRleFBhdHRlcm5zKCkudGhlbih0aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMpIHsKICAgICAgdmFyIHBhcnNlZFF1ZXJ5ID0gKDAsIF9xdWVyeS5mcm9tVXNlcikoKDAsIF9xdWVyeS50b1VzZXIpKHRoaXMucHJvcHMucXVlcnkucXVlcnkpKTsKCiAgICAgIGlmICghKDAsIF9sb2Rhc2guaXNFcXVhbCkodGhpcy5wcm9wcy5xdWVyeS5xdWVyeSwgcGFyc2VkUXVlcnkpKSB7CiAgICAgICAgdGhpcy5vbkNoYW5nZShfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLnByb3BzLnF1ZXJ5LCB7CiAgICAgICAgICBxdWVyeTogcGFyc2VkUXVlcnkKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFBlcnNpc3RlZExvZygpOwoKICAgICAgaWYgKCEoMCwgX2xvZGFzaC5pc0VxdWFsKShwcmV2UHJvcHMuaW5kZXhQYXR0ZXJucywgdGhpcy5wcm9wcy5pbmRleFBhdHRlcm5zKSkgewogICAgICAgIHRoaXMuZmV0Y2hJbmRleFBhdHRlcm5zKCkudGhlbih0aGlzLnVwZGF0ZVN1Z2dlc3Rpb25zKTsKICAgICAgfSBlbHNlIGlmICghKDAsIF9sb2Rhc2guaXNFcXVhbCkocHJldlByb3BzLnF1ZXJ5LCB0aGlzLnByb3BzLnF1ZXJ5KSkgewogICAgICAgIHRoaXMudXBkYXRlU3VnZ2VzdGlvbnMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc3RhdGUuc2VsZWN0aW9uU3RhcnQgIT09IG51bGwgJiYgdGhpcy5zdGF0ZS5zZWxlY3Rpb25FbmQgIT09IG51bGwpIHsKICAgICAgICBpZiAodGhpcy5pbnB1dFJlZikgewogICAgICAgICAgLy8gRm9yIHNvbWUgcmVhc29uIHRoZSB0eXBlIGd1YXJkIGFib3ZlIGRvZXMgbm90IG1ha2UgdGhlIGNvbXBpbGVyIGhhcHB5CiAgICAgICAgICAvLyBAdHMtaWdub3JlCiAgICAgICAgICB0aGlzLmlucHV0UmVmLnNldFNlbGVjdGlvblJhbmdlKHRoaXMuc3RhdGUuc2VsZWN0aW9uU3RhcnQsIHRoaXMuc3RhdGUuc2VsZWN0aW9uRW5kKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgc2VsZWN0aW9uU3RhcnQ6IG51bGwsCiAgICAgICAgICBzZWxlY3Rpb25FbmQ6IG51bGwKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy51cGRhdGVTdWdnZXN0aW9ucy5jYW5jZWwoKTsKICAgICAgdGhpcy5jb21wb25lbnRJc1VubW91bnRpbmcgPSB0cnVlOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBpc1N1Z2dlc3Rpb25zVmlzaWJsZSA9IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgJiYgewogICAgICAgICdhcmlhLWNvbnRyb2xzJzogJ2tiblR5cGVhaGVhZF9faXRlbXMnLAogICAgICAgICdhcmlhLW93bnMnOiAna2JuVHlwZWFoZWFkX19pdGVtcycKICAgICAgfTsKCiAgICAgIHZhciBhcmlhQ29tYm9ib3ggPSBfb2JqZWN0U3ByZWFkKHt9LCBpc1N1Z2dlc3Rpb25zVmlzaWJsZSwgewogICAgICAgIHJvbGU6ICdjb21ib2JveCcKICAgICAgfSk7CgogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU91dHNpZGVDbGlja0RldGVjdG9yLCB7CiAgICAgICAgb25PdXRzaWRlQ2xpY2s6IHRoaXMub25PdXRzaWRlQ2xpY2sKICAgICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgX2V4dGVuZHMoe30sIGFyaWFDb21ib2JveCwgewogICAgICAgIHN0eWxlOiB7CiAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJwogICAgICAgIH0sCiAgICAgICAgImFyaWEtbGFiZWwiOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5xdWVyeS5xdWVyeUJhci5jb21ib2JveEFyaWFMYWJlbCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnU2VhcmNoIGFuZCBmaWx0ZXIgdGhlIHtwYWdlVHlwZX0gcGFnZScsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgcGFnZVR5cGU6IHRoaXMuc2VydmljZXMuYXBwTmFtZQogICAgICAgICAgfQogICAgICAgIH0pLAogICAgICAgICJhcmlhLWhhc3BvcHVwIjogInRydWUiLAogICAgICAgICJhcmlhLWV4cGFuZGVkIjogdGhpcy5zdGF0ZS5pc1N1Z2dlc3Rpb25zVmlzaWJsZQogICAgICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgIHJvbGU6ICJzZWFyY2giCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICBjbGFzc05hbWU6ICJrdWlMb2NhbFNlYXJjaEFzc2lzdGVkSW5wdXQiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlGaWVsZFRleHQsIHsKICAgICAgICBwbGFjZWhvbGRlcjogdGhpcy5wcm9wcy5wbGFjZWhvbGRlciB8fCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgnZGF0YS5xdWVyeS5xdWVyeUJhci5zZWFyY2hJbnB1dFBsYWNlaG9sZGVyJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdTZWFyY2gnCiAgICAgICAgfSksCiAgICAgICAgdmFsdWU6IHRoaXMuZ2V0UXVlcnlTdHJpbmcoKSwKICAgICAgICBvbktleURvd246IHRoaXMub25LZXlEb3duLAogICAgICAgIG9uS2V5VXA6IHRoaXMub25LZXlVcCwKICAgICAgICBvbkNoYW5nZTogdGhpcy5vbklucHV0Q2hhbmdlLAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja0lucHV0LAogICAgICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICAgICBhdXRvRm9jdXM6ICF0aGlzLnByb3BzLmRpc2FibGVBdXRvRm9jdXMsCiAgICAgICAgaW5wdXRSZWY6IGZ1bmN0aW9uIGlucHV0UmVmKG5vZGUpIHsKICAgICAgICAgIGlmIChub2RlKSB7CiAgICAgICAgICAgIF90aGlzMi5pbnB1dFJlZiA9IG5vZGU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBhdXRvQ29tcGxldGU6ICJvZmYiLAogICAgICAgIHNwZWxsQ2hlY2s6IGZhbHNlLAogICAgICAgICJhcmlhLWxhYmVsIjogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2RhdGEucXVlcnkucXVlcnlCYXIuc2VhcmNoSW5wdXRBcmlhTGFiZWwnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1N0YXJ0IHR5cGluZyB0byBzZWFyY2ggYW5kIGZpbHRlciB0aGUge3BhZ2VUeXBlfSBwYWdlJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBwYWdlVHlwZTogdGhpcy5zZXJ2aWNlcy5hcHBOYW1lCiAgICAgICAgICB9CiAgICAgICAgfSksCiAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgICJhcmlhLWF1dG9jb21wbGV0ZSI6ICJsaXN0IiwKICAgICAgICAiYXJpYS1jb250cm9scyI6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgPyAna2JuVHlwZWFoZWFkX19pdGVtcycgOiB1bmRlZmluZWQsCiAgICAgICAgImFyaWEtYWN0aXZlZGVzY2VuZGFudCI6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUgJiYgdHlwZW9mIHRoaXMuc3RhdGUuaW5kZXggPT09ICdudW1iZXInID8gInN1Z2dlc3Rpb24tIi5jb25jYXQodGhpcy5zdGF0ZS5pbmRleCkgOiB1bmRlZmluZWQsCiAgICAgICAgcm9sZTogInRleHRib3giLAogICAgICAgIHByZXBlbmQ6IHRoaXMucHJvcHMucHJlcGVuZCwKICAgICAgICBhcHBlbmQ6IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2xhbmd1YWdlX3N3aXRjaGVyLlF1ZXJ5TGFuZ3VhZ2VTd2l0Y2hlciwgewogICAgICAgICAgbGFuZ3VhZ2U6IHRoaXMucHJvcHMucXVlcnkubGFuZ3VhZ2UsCiAgICAgICAgICBhbmNob3JQb3NpdGlvbjogdGhpcy5wcm9wcy5sYW5ndWFnZVN3aXRjaGVyUG9wb3ZlckFuY2hvclBvc2l0aW9uLAogICAgICAgICAgb25TZWxlY3RMYW5ndWFnZTogdGhpcy5vblNlbGVjdExhbmd1YWdlCiAgICAgICAgfSksCiAgICAgICAgImRhdGEtdGVzdC1zdWJqIjogdGhpcy5wcm9wcy5kYXRhVGVzdFN1YmogfHwgJ3F1ZXJ5SW5wdXQnCiAgICAgIH0pKSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoXy5TdWdnZXN0aW9uc0NvbXBvbmVudCwgewogICAgICAgIHNob3c6IHRoaXMuc3RhdGUuaXNTdWdnZXN0aW9uc1Zpc2libGUsCiAgICAgICAgc3VnZ2VzdGlvbnM6IHRoaXMuc3RhdGUuc3VnZ2VzdGlvbnMuc2xpY2UoMCwgdGhpcy5zdGF0ZS5zdWdnZXN0aW9uTGltaXQpLAogICAgICAgIGluZGV4OiB0aGlzLnN0YXRlLmluZGV4LAogICAgICAgIG9uQ2xpY2s6IHRoaXMub25DbGlja1N1Z2dlc3Rpb24sCiAgICAgICAgb25Nb3VzZUVudGVyOiB0aGlzLm9uTW91c2VFbnRlclN1Z2dlc3Rpb24sCiAgICAgICAgbG9hZE1vcmU6IHRoaXMuaW5jcmVhc2VMaW1pdAogICAgICB9KSkpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFF1ZXJ5U3RyaW5nSW5wdXRVSTsKfShfcmVhY3QuQ29tcG9uZW50KTsKCmV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dFVJID0gUXVlcnlTdHJpbmdJbnB1dFVJOwp2YXIgUXVlcnlTdHJpbmdJbnB1dCA9ICgwLCBfcHVibGljLndpdGhLaWJhbmEpKFF1ZXJ5U3RyaW5nSW5wdXRVSSk7CmV4cG9ydHMuUXVlcnlTdHJpbmdJbnB1dCA9IFF1ZXJ5U3RyaW5nSW5wdXQ7"},null]}