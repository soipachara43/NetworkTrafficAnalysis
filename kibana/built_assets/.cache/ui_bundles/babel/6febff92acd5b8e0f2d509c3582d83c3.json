{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/plugins/embeddable/public/lib/containers/container.js","dependencies":[{"path":"src/plugins/embeddable/public/lib/containers/container.js","mtime":1589249550755},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YyID0gZnVuY3Rpb24gX3R5cGVvZjIob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mMiA9IGZ1bmN0aW9uIF90eXBlb2YyKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OyB9IHJldHVybiBfdHlwZW9mMihvYmopOyB9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7CmV4cG9ydHMuQ29udGFpbmVyID0gdm9pZCAwOwoKdmFyIF91dWlkID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJ1dWlkIikpOwoKdmFyIF9yeGpzID0gcmVxdWlyZSgicnhqcyIpOwoKdmFyIF9lbWJlZGRhYmxlcyA9IHJlcXVpcmUoIi4uL2VtYmVkZGFibGVzIik7Cgp2YXIgX2Vycm9ycyA9IHJlcXVpcmUoIi4uL2Vycm9ycyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsKICBpZiAodHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBfdHlwZW9mMihTeW1ib2wuaXRlcmF0b3IpID09PSAic3ltYm9sIikgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBfdHlwZW9mMihvYmopOwogICAgfTsKICB9IGVsc2UgewogICAgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7CiAgICAgIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IF90eXBlb2YyKG9iaik7CiAgICB9OwogIH0KCiAgcmV0dXJuIF90eXBlb2Yob2JqKTsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICB9Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgfQp9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgaWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogIHJldHVybiBDb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewogIGlmIChjYWxsICYmIChfdHlwZW9mKGNhbGwpID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHsKICAgIHJldHVybiBjYWxsOwogIH0KCiAgcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7Cn0KCmZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewogIGlmIChzZWxmID09PSB2b2lkIDApIHsKICAgIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7CiAgfQoKICByZXR1cm4gc2VsZjsKfQoKZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmICh0eXBlb2YgUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgUmVmbGVjdC5nZXQpIHsKICAgIF9nZXQgPSBSZWZsZWN0LmdldDsKICB9IGVsc2UgewogICAgX2dldCA9IGZ1bmN0aW9uIF9nZXQodGFyZ2V0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHsKICAgICAgdmFyIGJhc2UgPSBfc3VwZXJQcm9wQmFzZSh0YXJnZXQsIHByb3BlcnR5KTsKCiAgICAgIGlmICghYmFzZSkgcmV0dXJuOwogICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYmFzZSwgcHJvcGVydHkpOwoKICAgICAgaWYgKGRlc2MuZ2V0KSB7CiAgICAgICAgcmV0dXJuIGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpOwogICAgICB9CgogICAgICByZXR1cm4gZGVzYy52YWx1ZTsKICAgIH07CiAgfQoKICByZXR1cm4gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlciB8fCB0YXJnZXQpOwp9CgpmdW5jdGlvbiBfc3VwZXJQcm9wQmFzZShvYmplY3QsIHByb3BlcnR5KSB7CiAgd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKICAgIG9iamVjdCA9IF9nZXRQcm90b3R5cGVPZihvYmplY3QpOwogICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgYnJlYWs7CiAgfQoKICByZXR1cm4gb2JqZWN0Owp9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewogIF9nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZiA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CiAgICByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOwogIH07CiAgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsKfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7CiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsKICAgIGNvbnN0cnVjdG9yOiB7CiAgICAgIHZhbHVlOiBzdWJDbGFzcywKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwp9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogIF9zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewogICAgby5fX3Byb3RvX18gPSBwOwogICAgcmV0dXJuIG87CiAgfTsKCiAgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBnZXRLZXlzID0gZnVuY3Rpb24gZ2V0S2V5cyhvKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKG8pOwp9OwoKdmFyIENvbnRhaW5lciA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FbWJlZGRhYmxlKSB7CiAgX2luaGVyaXRzKENvbnRhaW5lciwgX0VtYmVkZGFibGUpOwoKICBmdW5jdGlvbiBDb250YWluZXIoaW5wdXQsIG91dHB1dCwgZ2V0RmFjdG9yeSwgcGFyZW50KSB7CiAgICB2YXIgX3RoaXM7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbnRhaW5lcik7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoQ29udGFpbmVyKS5jYWxsKHRoaXMsIGlucHV0LCBvdXRwdXQsIHBhcmVudCkpOwogICAgX3RoaXMuZ2V0RmFjdG9yeSA9IGdldEZhY3Rvcnk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiaXNDb250YWluZXIiLCB0cnVlKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJjaGlsZHJlbiIsIHt9KTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJzdWJzY3JpcHRpb24iLCB2b2lkIDApOwoKICAgIF90aGlzLnN1YnNjcmlwdGlvbiA9IF90aGlzLmdldElucHV0JCgpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBfdGhpcy5tYXliZVVwZGF0ZUNoaWxkcmVuKCk7CiAgICB9KTsKICAgIHJldHVybiBfdGhpczsKICB9CgogIF9jcmVhdGVDbGFzcyhDb250YWluZXIsIFt7CiAgICBrZXk6ICJ1cGRhdGVJbnB1dEZvckNoaWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVJbnB1dEZvckNoaWxkKGlkLCBjaGFuZ2VzKSB7CiAgICAgIGlmICghdGhpcy5pbnB1dC5wYW5lbHNbaWRdKSB7CiAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuUGFuZWxOb3RGb3VuZEVycm9yKCk7CiAgICAgIH0KCiAgICAgIHZhciBwYW5lbHMgPSB7CiAgICAgICAgcGFuZWxzOiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVscywgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHNbaWRdLCB7CiAgICAgICAgICBleHBsaWNpdElucHV0OiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVsc1tpZF0uZXhwbGljaXRJbnB1dCwge30sIGNoYW5nZXMpCiAgICAgICAgfSkpKQogICAgICB9OwogICAgICB0aGlzLnVwZGF0ZUlucHV0KHBhbmVscyk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVsb2FkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWxvYWQoKSB7CiAgICAgIE9iamVjdC52YWx1ZXModGhpcy5jaGlsZHJlbikuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICByZXR1cm4gY2hpbGQucmVsb2FkKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImFkZE5ld0VtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9hZGROZXdFbWJlZGRhYmxlID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0eXBlLCBleHBsaWNpdElucHV0KSB7CiAgICAgICAgdmFyIGZhY3RvcnksIHBhbmVsU3RhdGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgZmFjdG9yeSA9IHRoaXMuZ2V0RmFjdG9yeSh0eXBlKTsKCiAgICAgICAgICAgICAgICBpZiAoZmFjdG9yeSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuRW1iZWRkYWJsZUZhY3RvcnlOb3RGb3VuZEVycm9yKHR5cGUpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBwYW5lbFN0YXRlID0gdGhpcy5jcmVhdGVOZXdQYW5lbFN0YXRlKGZhY3RvcnksIGV4cGxpY2l0SW5wdXQpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgdGhpcy5jcmVhdGVBbmRTYXZlRW1iZWRkYWJsZSh0eXBlLCBwYW5lbFN0YXRlKSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBhZGROZXdFbWJlZGRhYmxlKF94LCBfeDIpIHsKICAgICAgICByZXR1cm4gX2FkZE5ld0VtYmVkZGFibGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFkZE5ld0VtYmVkZGFibGU7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJhZGRTYXZlZE9iamVjdEVtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9hZGRTYXZlZE9iamVjdEVtYmVkZGFibGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMih0eXBlLCBzYXZlZE9iamVjdElkKSB7CiAgICAgICAgdmFyIGZhY3RvcnksIHBhbmVsU3RhdGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGZhY3RvcnkgPSB0aGlzLmdldEZhY3RvcnkodHlwZSk7CiAgICAgICAgICAgICAgICBwYW5lbFN0YXRlID0gdGhpcy5jcmVhdGVOZXdQYW5lbFN0YXRlKGZhY3RvcnkpOwogICAgICAgICAgICAgICAgcGFuZWxTdGF0ZS5zYXZlZE9iamVjdElkID0gc2F2ZWRPYmplY3RJZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmNyZWF0ZUFuZFNhdmVFbWJlZGRhYmxlKHR5cGUsIHBhbmVsU3RhdGUpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gYWRkU2F2ZWRPYmplY3RFbWJlZGRhYmxlKF94MywgX3g0KSB7CiAgICAgICAgcmV0dXJuIF9hZGRTYXZlZE9iamVjdEVtYmVkZGFibGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGFkZFNhdmVkT2JqZWN0RW1iZWRkYWJsZTsKICAgIH0oKQogIH0sIHsKICAgIGtleTogInJlbW92ZUVtYmVkZGFibGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUVtYmVkZGFibGUoZW1iZWRkYWJsZUlkKSB7CiAgICAgIC8vIEp1c3QgYSBzaG9ydGN1dCBmb3IgcmVtb3ZpbmcgdGhlIHBhbmVsIGZyb20gaW5wdXQgc3RhdGUsIGFsbCBpbnRlcm5hbCBzdGF0ZSB3aWxsIGdldCBjbGVhbmVkIHVwIG5hdHVyYWxseQogICAgICAvLyBieSB0aGUgbGlzdGVuZXIuCiAgICAgIHZhciBwYW5lbHMgPSBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVscyk7CgogICAgICBkZWxldGUgcGFuZWxzW2VtYmVkZGFibGVJZF07CiAgICAgIHRoaXMudXBkYXRlSW5wdXQoewogICAgICAgIHBhbmVsczogcGFuZWxzCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldENoaWxkSWRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGlsZElkcygpIHsKICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuY2hpbGRyZW4pOwogICAgfQogIH0sIHsKICAgIGtleTogImdldENoaWxkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDaGlsZChpZCkgewogICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltpZF07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SW5wdXRGb3JDaGlsZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SW5wdXRGb3JDaGlsZChlbWJlZGRhYmxlSWQpIHsKICAgICAgdmFyIGNvbnRhaW5lcklucHV0ID0gdGhpcy5nZXRJbmhlcml0ZWRJbnB1dChlbWJlZGRhYmxlSWQpOwogICAgICB2YXIgcGFuZWxTdGF0ZSA9IHRoaXMuZ2V0UGFuZWxTdGF0ZShlbWJlZGRhYmxlSWQpOwogICAgICB2YXIgZXhwbGljaXRJbnB1dCA9IHBhbmVsU3RhdGUuZXhwbGljaXRJbnB1dDsKICAgICAgdmFyIGV4cGxpY2l0RmlsdGVyZWQgPSB7fTsKICAgICAgdmFyIGtleXMgPSBnZXRLZXlzKHBhbmVsU3RhdGUuZXhwbGljaXRJbnB1dCk7IC8vIElmIGV4cGxpY2l0IGlucHV0IGZvciBhIHBhcnRpY3VsYXIgdmFsdWUgaXMgdW5kZWZpbmVkLCBhbmQgY29udGFpbmVyIGhhcyB0aGF0IGlucHV0IGRlZmluZWQsCiAgICAgIC8vIHdlIHdpbGwgdXNlIHRoZSBpbmhlcml0ZWQgY29udGFpbmVyIGlucHV0LiBUaGlzIHdheSBjaGlsZHJlbiBjYW4gc2V0IGEgdmFsdWUgdG8gdW5kZWZpbmVkIGluIG9yZGVyCiAgICAgIC8vIHRvIGRlZmF1bHQgYmFjayB0byBpbmhlcml0ZWQgaW5wdXQuIEhvd2V2ZXIsIGlmIHRoZSBwYXJ0aWN1bGFyIHZhbHVlIGlzIG5vdCBwYXJ0IG9mIHRoZSBjb250YWluZXIsIHRoZW4KICAgICAgLy8gdGhlIGNhbGxlciBtYXkgYmUgdHJ5aW5nIHRvIGV4cGxpY2l0bHkgdGVsbCB0aGUgY2hpbGQgdG8gY2xlYXIgb3V0IGEgZ2l2ZW4gdmFsdWUsIHNvIGluIHRoYXQgY2FzZSwgd2Ugd2FudAogICAgICAvLyB0byBwYXNzIGl0IGFsb25nLgoKICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBpZiAoZXhwbGljaXRJbnB1dFtrZXldID09PSB1bmRlZmluZWQgJiYgY29udGFpbmVySW5wdXRba2V5XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBleHBsaWNpdEZpbHRlcmVkW2tleV0gPSBleHBsaWNpdElucHV0W2tleV07CiAgICAgIH0pOwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgY29udGFpbmVySW5wdXQsIHt9LCBleHBsaWNpdEZpbHRlcmVkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXN0cm95IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KCkgewogICAgICBfZ2V0KF9nZXRQcm90b3R5cGVPZihDb250YWluZXIucHJvdG90eXBlKSwgImRlc3Ryb3kiLCB0aGlzKS5jYWxsKHRoaXMpOwoKICAgICAgT2JqZWN0LnZhbHVlcyh0aGlzLmNoaWxkcmVuKS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgIHJldHVybiBjaGlsZC5kZXN0cm95KCk7CiAgICAgIH0pOwogICAgICB0aGlzLnN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgfQogIH0sIHsKICAgIGtleTogInVudGlsRW1iZWRkYWJsZUxvYWRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3VudGlsRW1iZWRkYWJsZUxvYWRlZCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKGlkKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnB1dC5wYW5lbHNbaWRdKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuUGFuZWxOb3RGb3VuZEVycm9yKCk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgIGlmICghdGhpcy5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZFtpZF0pIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgdGhpcy5jaGlsZHJlbltpZF0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gKDAsIF9yeGpzLm1lcmdlKShfdGhpczIuZ2V0T3V0cHV0JCgpLCBfdGhpczIuZ2V0SW5wdXQkKCkpLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzMi5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZFtpZF0pIHsKICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpczIuY2hpbGRyZW5baWRdKTsKICAgICAgICAgICAgICAgICAgICB9IC8vIElmIHdlIGhpdCB0aGlzLCB0aGUgcGFuZWwgd2FzIHJlbW92ZWQgYmVmb3JlIHRoZSBlbWJlZGRhYmxlIGZpbmlzaGVkIGxvYWRpbmcuCgoKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLmlucHV0LnBhbmVsc1tpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHVuZGVmaW5lZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gdW50aWxFbWJlZGRhYmxlTG9hZGVkKF94NSkgewogICAgICAgIHJldHVybiBfdW50aWxFbWJlZGRhYmxlTG9hZGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB1bnRpbEVtYmVkZGFibGVMb2FkZWQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjcmVhdGVOZXdQYW5lbFN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGVOZXdQYW5lbFN0YXRlKGZhY3RvcnkpIHsKICAgICAgdmFyIHBhcnRpYWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwoKICAgICAgdmFyIGVtYmVkZGFibGVJZCA9IHBhcnRpYWwuaWQgfHwgX3V1aWQuZGVmYXVsdC52NCgpOwoKICAgICAgdmFyIGV4cGxpY2l0SW5wdXQgPSB0aGlzLmNyZWF0ZU5ld0V4cGxpY2l0RW1iZWRkYWJsZUlucHV0KGVtYmVkZGFibGVJZCwgZmFjdG9yeSwgcGFydGlhbCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgdHlwZTogZmFjdG9yeS50eXBlLAogICAgICAgIGV4cGxpY2l0SW5wdXQ6IF9vYmplY3RTcHJlYWQoewogICAgICAgICAgaWQ6IGVtYmVkZGFibGVJZAogICAgICAgIH0sIGV4cGxpY2l0SW5wdXQpCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0UGFuZWxTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UGFuZWxTdGF0ZShlbWJlZGRhYmxlSWQpIHsKICAgICAgaWYgKHRoaXMuaW5wdXQucGFuZWxzW2VtYmVkZGFibGVJZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRocm93IG5ldyBfZXJyb3JzLlBhbmVsTm90Rm91bmRFcnJvcigpOwogICAgICB9CgogICAgICB2YXIgcGFuZWxTdGF0ZSA9IHRoaXMuaW5wdXQucGFuZWxzW2VtYmVkZGFibGVJZF07CiAgICAgIHJldHVybiBwYW5lbFN0YXRlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm4gc3RhdGUgdGhhdCBjb21lcyBmcm9tIHRoZSBjb250YWluZXIgYW5kIGlzIHBhc3NlZCBkb3duIHRvIHRoZSBjaGlsZC4gRm9yIGluc3RhbmNlLCB0aW1lIHJhbmdlIGFuZAogICAgICogZmlsdGVycyBhcmUgY29tbW9uIGluaGVyaXRlZCBpbnB1dCBzdGF0ZS4gTm90ZSB0aGF0IGFueSBzdGF0ZSBzdG9yZWQgaW4gYHRoaXMuaW5wdXQucGFuZWxzW2VtYmVkZGFibGVJZF0uZXhwbGljaXRJbnB1dGAKICAgICAqIHdpbGwgb3ZlcnJpZGUgaW5oZXJpdGVkIGlucHV0LgogICAgICovCgogIH0sIHsKICAgIGtleTogImNyZWF0ZUFuZFNhdmVFbWJlZGRhYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY3JlYXRlQW5kU2F2ZUVtYmVkZGFibGUgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCh0eXBlLCBwYW5lbFN0YXRlKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlSW5wdXQoewogICAgICAgICAgICAgICAgICBwYW5lbHM6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuaW5wdXQucGFuZWxzLCBfZGVmaW5lUHJvcGVydHkoe30sIHBhbmVsU3RhdGUuZXhwbGljaXRJbnB1dC5pZCwgcGFuZWxTdGF0ZSkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVudGlsRW1iZWRkYWJsZUxvYWRlZChwYW5lbFN0YXRlLmV4cGxpY2l0SW5wdXQuaWQpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ0LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBjcmVhdGVBbmRTYXZlRW1iZWRkYWJsZShfeDYsIF94NykgewogICAgICAgIHJldHVybiBfY3JlYXRlQW5kU2F2ZUVtYmVkZGFibGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNyZWF0ZUFuZFNhdmVFbWJlZGRhYmxlOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiY3JlYXRlTmV3RXhwbGljaXRFbWJlZGRhYmxlSW5wdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZU5ld0V4cGxpY2l0RW1iZWRkYWJsZUlucHV0KGlkLCBmYWN0b3J5KSB7CiAgICAgIHZhciBwYXJ0aWFsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAgICAgdmFyIGluaGVyaXRlZElucHV0ID0gdGhpcy5nZXRJbmhlcml0ZWRJbnB1dChpZCk7CiAgICAgIHZhciBkZWZhdWx0cyA9IGZhY3RvcnkuZ2V0RGVmYXVsdElucHV0KHBhcnRpYWwpOyAvLyBDb250YWluZXIgaW5wdXQgb3ZlcnJpZGVzIGRlZmF1bHRzLgoKICAgICAgdmFyIGV4cGxpY2l0SW5wdXQgPSBwYXJ0aWFsOwogICAgICBnZXRLZXlzKGRlZmF1bHRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAvLyBAdHMtaWdub3JlIFdlIGtub3cgdGhpcyBrZXkgbWlnaHQgbm90IGV4aXN0IG9uIGluaGVyaXRlZElucHV0LgogICAgICAgIHZhciBpbmhlcml0ZWRWYWx1ZSA9IGluaGVyaXRlZElucHV0W2tleV07CgogICAgICAgIGlmIChpbmhlcml0ZWRWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIGV4cGxpY2l0SW5wdXRba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBleHBsaWNpdElucHV0W2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBleHBsaWNpdElucHV0OwogICAgfQogIH0sIHsKICAgIGtleTogIm9uUGFuZWxSZW1vdmVkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvblBhbmVsUmVtb3ZlZChpZCkgewogICAgICAvLyBDbGVhbiB1cAogICAgICB2YXIgZW1iZWRkYWJsZSA9IHRoaXMuZ2V0Q2hpbGQoaWQpOwoKICAgICAgaWYgKGVtYmVkZGFibGUpIHsKICAgICAgICBlbWJlZGRhYmxlLmRlc3Ryb3koKTsgLy8gUmVtb3ZlIHJlZmVyZW5jZXMuCgogICAgICAgIGRlbGV0ZSB0aGlzLmNoaWxkcmVuW2lkXTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVPdXRwdXQoewogICAgICAgIGVtYmVkZGFibGVMb2FkZWQ6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMub3V0cHV0LmVtYmVkZGFibGVMb2FkZWQsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIHVuZGVmaW5lZCkpCiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogIm9uUGFuZWxBZGRlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX29uUGFuZWxBZGRlZCA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KHBhbmVsKSB7CiAgICAgICAgdmFyIGVtYmVkZGFibGUsIGlucHV0Rm9yQ2hpbGQsIGZhY3Rvcnk7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3V0cHV0KHsKICAgICAgICAgICAgICAgICAgZW1iZWRkYWJsZUxvYWRlZDogX29iamVjdFNwcmVhZCh7fSwgdGhpcy5vdXRwdXQuZW1iZWRkYWJsZUxvYWRlZCwgX2RlZmluZVByb3BlcnR5KHt9LCBwYW5lbC5leHBsaWNpdElucHV0LmlkLCBmYWxzZSkpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlucHV0Rm9yQ2hpbGQgPSB0aGlzLmdldElucHV0Rm9yQ2hpbGQocGFuZWwuZXhwbGljaXRJbnB1dC5pZCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDI7CiAgICAgICAgICAgICAgICBmYWN0b3J5ID0gdGhpcy5nZXRGYWN0b3J5KHBhbmVsLnR5cGUpOwoKICAgICAgICAgICAgICAgIGlmIChmYWN0b3J5KSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF9lcnJvcnMuRW1iZWRkYWJsZUZhY3RvcnlOb3RGb3VuZEVycm9yKHBhbmVsLnR5cGUpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBpZiAoIXBhbmVsLnNhdmVkT2JqZWN0SWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIGZhY3RvcnkuY3JlYXRlRnJvbVNhdmVkT2JqZWN0KHBhbmVsLnNhdmVkT2JqZWN0SWQsIGlucHV0Rm9yQ2hpbGQsIHRoaXMpOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoaW5wdXRGb3JDaGlsZCwgdGhpcyk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICBfY29udGV4dDUudDAgPSBfY29udGV4dDUuc2VudDsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGVtYmVkZGFibGUgPSBfY29udGV4dDUudDA7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBfY29udGV4dDUucHJldiA9IDE4OwogICAgICAgICAgICAgICAgX2NvbnRleHQ1LnQxID0gX2NvbnRleHQ1WyJjYXRjaCJdKDIpOwogICAgICAgICAgICAgICAgZW1iZWRkYWJsZSA9IG5ldyBfZW1iZWRkYWJsZXMuRXJyb3JFbWJlZGRhYmxlKF9jb250ZXh0NS50MSwgewogICAgICAgICAgICAgICAgICBpZDogcGFuZWwuZXhwbGljaXRJbnB1dC5pZAogICAgICAgICAgICAgICAgfSwgdGhpcyk7CgogICAgICAgICAgICAgIGNhc2UgMjE6CiAgICAgICAgICAgICAgICBpZiAoIWVtYmVkZGFibGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSAzMDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5wdXQucGFuZWxzW3BhbmVsLmV4cGxpY2l0SW5wdXQuaWRdKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVtYmVkZGFibGUuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgaWYgKGVtYmVkZGFibGUuZ2V0T3V0cHV0KCkuc2F2ZWRPYmplY3RJZCkgewogICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUlucHV0KHsKICAgICAgICAgICAgICAgICAgICBwYW5lbHM6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuaW5wdXQucGFuZWxzLCBfZGVmaW5lUHJvcGVydHkoe30sIHBhbmVsLmV4cGxpY2l0SW5wdXQuaWQsIF9vYmplY3RTcHJlYWQoe30sIHRoaXMuaW5wdXQucGFuZWxzW3BhbmVsLmV4cGxpY2l0SW5wdXQuaWRdLCB7fSwgZW1iZWRkYWJsZS5nZXRPdXRwdXQoKS5zYXZlZE9iamVjdElkID8gewogICAgICAgICAgICAgICAgICAgICAgc2F2ZWRPYmplY3RJZDogZW1iZWRkYWJsZS5nZXRPdXRwdXQoKS5zYXZlZE9iamVjdElkCiAgICAgICAgICAgICAgICAgICAgfSA6IHVuZGVmaW5lZCwgewogICAgICAgICAgICAgICAgICAgICAgZXhwbGljaXRJbnB1dDogX29iamVjdFNwcmVhZCh7fSwgdGhpcy5pbnB1dC5wYW5lbHNbcGFuZWwuZXhwbGljaXRJbnB1dC5pZF0uZXhwbGljaXRJbnB1dCkKICAgICAgICAgICAgICAgICAgICB9KSkpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5bZW1iZWRkYWJsZS5pZF0gPSBlbWJlZGRhYmxlOwogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVPdXRwdXQoewogICAgICAgICAgICAgICAgICBlbWJlZGRhYmxlTG9hZGVkOiBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLm91dHB1dC5lbWJlZGRhYmxlTG9hZGVkLCBfZGVmaW5lUHJvcGVydHkoe30sIHBhbmVsLmV4cGxpY2l0SW5wdXQuaWQsIHRydWUpKQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDMxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzA6CiAgICAgICAgICAgICAgICBpZiAoZW1iZWRkYWJsZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRW1iZWRkYWJsZShwYW5lbC5leHBsaWNpdElucHV0LmlkKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBlbWJlZGRhYmxlKTsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcywgW1syLCAxOF1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gb25QYW5lbEFkZGVkKF94OCkgewogICAgICAgIHJldHVybiBfb25QYW5lbEFkZGVkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvblBhbmVsQWRkZWQ7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJtYXliZVVwZGF0ZUNoaWxkcmVuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXliZVVwZGF0ZUNoaWxkcmVuKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBhbGxJZHMgPSBPYmplY3Qua2V5cyhfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmlucHV0LnBhbmVscywge30sIHRoaXMub3V0cHV0LmVtYmVkZGFibGVMb2FkZWQpKTsKICAgICAgYWxsSWRzLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgaWYgKF90aGlzMy5pbnB1dC5wYW5lbHNbaWRdICE9PSB1bmRlZmluZWQgJiYgX3RoaXMzLm91dHB1dC5lbWJlZGRhYmxlTG9hZGVkW2lkXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfdGhpczMub25QYW5lbEFkZGVkKF90aGlzMy5pbnB1dC5wYW5lbHNbaWRdKTsKICAgICAgICB9IGVsc2UgaWYgKF90aGlzMy5pbnB1dC5wYW5lbHNbaWRdID09PSB1bmRlZmluZWQgJiYgX3RoaXMzLm91dHB1dC5lbWJlZGRhYmxlTG9hZGVkW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBfdGhpczMub25QYW5lbFJlbW92ZWQoaWQpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQ29udGFpbmVyOwp9KF9lbWJlZGRhYmxlcy5FbWJlZGRhYmxlKTsKCmV4cG9ydHMuQ29udGFpbmVyID0gQ29udGFpbmVyOw=="},null]}