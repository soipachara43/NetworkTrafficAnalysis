{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/apm/public/components/app/TransactionDetails/WaterfallWithSummmary/WaterfallContainer/Waterfall/waterfall_helpers/waterfall_helpers.js","dependencies":[{"path":"x-pack/legacy/plugins/apm/public/components/app/TransactionDetails/WaterfallWithSummmary/WaterfallContainer/Waterfall/waterfall_helpers/waterfall_helpers.js","mtime":1589249551611},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldENsb2NrU2tldyA9IGdldENsb2NrU2tldzsKZXhwb3J0cy5nZXRPcmRlcmVkV2F0ZXJmYWxsSXRlbXMgPSBnZXRPcmRlcmVkV2F0ZXJmYWxsSXRlbXM7CmV4cG9ydHMuZ2V0V2F0ZXJmYWxsID0gZ2V0V2F0ZXJmYWxsOwoKdmFyIF9ldWlfdGhlbWVfbGlnaHQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkBlbGFzdGljL2V1aS9kaXN0L2V1aV90aGVtZV9saWdodC5qc29uIikpOwoKdmFyIF9sb2Rhc2ggPSByZXF1aXJlKCJsb2Rhc2giKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgIGRlZmF1bHQ6IG9iagogIH07Cn0KCmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHsKICByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7CiAgdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7CiAgaWYgKFN5bWJvbC5pdGVyYXRvciBpbiBPYmplY3QoaXRlcikgfHwgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGl0ZXIpID09PSAiW29iamVjdCBBcmd1bWVudHNdIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBhcnIyW2ldID0gYXJyW2ldOwogICAgfQoKICAgIHJldHVybiBhcnIyOwogIH0KfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7CiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvYmplY3QpOwoKICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgewogICAgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7CiAgICBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7CiAgICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOwogICAgfSk7CiAgICBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7CiAgfQoKICByZXR1cm4ga2V5czsKfQoKZnVuY3Rpb24gX29iamVjdFNwcmVhZCh0YXJnZXQpIHsKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXSAhPSBudWxsID8gYXJndW1lbnRzW2ldIDoge307CgogICAgaWYgKGkgJSAyKSB7CiAgICAgIG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7CiAgICB9IGVsc2UgewogICAgICBvd25LZXlzKHNvdXJjZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCnZhciBST09UX0lEID0gJ3Jvb3QnOwoKZnVuY3Rpb24gZ2V0VHJhbnNhY3Rpb25JdGVtKHRyYW5zYWN0aW9uKSB7CiAgdmFyIF90cmFuc2FjdGlvbiRwYXJlbnQ7CgogIHJldHVybiB7CiAgICBkb2NUeXBlOiAndHJhbnNhY3Rpb24nLAogICAgZG9jOiB0cmFuc2FjdGlvbiwKICAgIGlkOiB0cmFuc2FjdGlvbi50cmFuc2FjdGlvbi5pZCwKICAgIHBhcmVudElkOiAoX3RyYW5zYWN0aW9uJHBhcmVudCA9IHRyYW5zYWN0aW9uLnBhcmVudCkgPT09IG51bGwgfHwgX3RyYW5zYWN0aW9uJHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RyYW5zYWN0aW9uJHBhcmVudC5pZCwKICAgIGR1cmF0aW9uOiB0cmFuc2FjdGlvbi50cmFuc2FjdGlvbi5kdXJhdGlvbi51cywKICAgIG9mZnNldDogMCwKICAgIHNrZXc6IDAKICB9Owp9CgpmdW5jdGlvbiBnZXRTcGFuSXRlbShzcGFuKSB7CiAgdmFyIF9zcGFuJHBhcmVudDsKCiAgcmV0dXJuIHsKICAgIGRvY1R5cGU6ICdzcGFuJywKICAgIGRvYzogc3BhbiwKICAgIGlkOiBzcGFuLnNwYW4uaWQsCiAgICBwYXJlbnRJZDogKF9zcGFuJHBhcmVudCA9IHNwYW4ucGFyZW50KSA9PT0gbnVsbCB8fCBfc3BhbiRwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zcGFuJHBhcmVudC5pZCwKICAgIGR1cmF0aW9uOiBzcGFuLnNwYW4uZHVyYXRpb24udXMsCiAgICBvZmZzZXQ6IDAsCiAgICBza2V3OiAwCiAgfTsKfQoKZnVuY3Rpb24gZ2V0RXJyb3JJdGVtKGVycm9yLCBpdGVtcywgZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbikgewogIHZhciBfcmVmOwoKICB2YXIgZW50cnlUaW1lc3RhbXAgPSAoX3JlZiA9IGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24gPT09IG51bGwgfHwgZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbi5kb2MudGltZXN0YW1wLnVzKSAhPT0gbnVsbCAmJiBfcmVmICE9PSB2b2lkIDAgPyBfcmVmIDogMDsKICB2YXIgcGFyZW50ID0gaXRlbXMuZmluZChmdW5jdGlvbiAod2F0ZXJmYWxsSXRlbSkgewogICAgdmFyIF9lcnJvciRwYXJlbnQ7CgogICAgcmV0dXJuIHdhdGVyZmFsbEl0ZW0uaWQgPT09ICgoX2Vycm9yJHBhcmVudCA9IGVycm9yLnBhcmVudCkgPT09IG51bGwgfHwgX2Vycm9yJHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Vycm9yJHBhcmVudC5pZCk7CiAgfSk7CiAgdmFyIGVycm9ySXRlbSA9IHsKICAgIGRvY1R5cGU6ICdlcnJvcicsCiAgICBkb2M6IGVycm9yLAogICAgaWQ6IGVycm9yLmVycm9yLmlkLAogICAgcGFyZW50OiBwYXJlbnQsCiAgICBwYXJlbnRJZDogcGFyZW50ID09PSBudWxsIHx8IHBhcmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGFyZW50LmlkLAogICAgb2Zmc2V0OiBlcnJvci50aW1lc3RhbXAudXMgLSBlbnRyeVRpbWVzdGFtcCwKICAgIHNrZXc6IDAsCiAgICBkdXJhdGlvbjogMAogIH07CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGVycm9ySXRlbSwgewogICAgc2tldzogZ2V0Q2xvY2tTa2V3KGVycm9ySXRlbSwgcGFyZW50KQogIH0pOwp9CgpmdW5jdGlvbiBnZXRDbG9ja1NrZXcoaXRlbSwgcGFyZW50SXRlbSkgewogIGlmICghcGFyZW50SXRlbSkgewogICAgcmV0dXJuIDA7CiAgfQoKICBzd2l0Y2ggKGl0ZW0uZG9jVHlwZSkgewogICAgLy8gZG9uJ3QgY2FsY3VsYXRlIHNrZXcgZm9yIHNwYW5zIGFuZCBlcnJvcnMuIEp1c3QgdXNlIHBhcmVudCdzIHNrZXcKICAgIGNhc2UgJ2Vycm9yJzoKICAgIGNhc2UgJ3NwYW4nOgogICAgICByZXR1cm4gcGFyZW50SXRlbS5za2V3OwogICAgLy8gdHJhbnNhY3Rpb24gaXMgdGhlIGluaXRhbCBlbnRyeSBpbiBhIHNlcnZpY2UuIENhbGN1bGF0ZSBza2V3IGZvciB0aGlzLCBhbmQgaXQgd2lsbCBiZSBwcm9wb2dhdGVkIHRvIGFsbCBjaGlsZCBzcGFucwoKICAgIGNhc2UgJ3RyYW5zYWN0aW9uJzoKICAgICAgewogICAgICAgIHZhciBwYXJlbnRTdGFydCA9IHBhcmVudEl0ZW0uZG9jLnRpbWVzdGFtcC51cyArIHBhcmVudEl0ZW0uc2tldzsgLy8gZGV0ZXJtaW5lIGlmIGNoaWxkIHN0YXJ0cyBiZWZvcmUgdGhlIHBhcmVudAoKICAgICAgICB2YXIgb2Zmc2V0U3RhcnQgPSBwYXJlbnRTdGFydCAtIGl0ZW0uZG9jLnRpbWVzdGFtcC51czsKCiAgICAgICAgaWYgKG9mZnNldFN0YXJ0ID4gMCkgewogICAgICAgICAgdmFyIGxhdGVuY3kgPSBNYXRoLm1heChwYXJlbnRJdGVtLmR1cmF0aW9uIC0gaXRlbS5kdXJhdGlvbiwgMCkgLyAyOwogICAgICAgICAgcmV0dXJuIG9mZnNldFN0YXJ0ICsgbGF0ZW5jeTsKICAgICAgICB9IC8vIGNoaWxkIHRyYW5zYWN0aW9uIHN0YXJ0cyBhZnRlciBwYXJlbnQgdGh1cyBubyBhZGp1c3RtZW50IGlzIG5lZWRlZAoKCiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGdldE9yZGVyZWRXYXRlcmZhbGxJdGVtcyhjaGlsZHJlbkJ5UGFyZW50SWQsIGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24pIHsKICBpZiAoIWVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24pIHsKICAgIHJldHVybiBbXTsKICB9CgogIHZhciBlbnRyeVRpbWVzdGFtcCA9IGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24uZG9jLnRpbWVzdGFtcC51czsKICB2YXIgdmlzaXRlZFdhdGVyZmFsbEl0ZW1TZXQgPSBuZXcgU2V0KCk7CgogIGZ1bmN0aW9uIGdldFNvcnRlZENoaWxkcmVuKGl0ZW0sIHBhcmVudEl0ZW0pIHsKICAgIGlmICh2aXNpdGVkV2F0ZXJmYWxsSXRlbVNldC5oYXMoaXRlbSkpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIHZpc2l0ZWRXYXRlcmZhbGxJdGVtU2V0LmFkZChpdGVtKTsKICAgIHZhciBjaGlsZHJlbiA9ICgwLCBfbG9kYXNoLnNvcnRCeSkoY2hpbGRyZW5CeVBhcmVudElkW2l0ZW0uaWRdIHx8IFtdLCAnZG9jLnRpbWVzdGFtcC51cycpOwogICAgaXRlbS5wYXJlbnQgPSBwYXJlbnRJdGVtOyAvLyBnZXQgb2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZyBvZiB0cmFjZQoKICAgIGl0ZW0ub2Zmc2V0ID0gaXRlbS5kb2MudGltZXN0YW1wLnVzIC0gZW50cnlUaW1lc3RhbXA7IC8vIG1vdmUgdGhlIGl0ZW0gdG8gdGhlIHJpZ2h0IGlmIGl0IHN0YXJ0cyBiZWZvcmUgaXRzIHBhcmVudAoKICAgIGl0ZW0uc2tldyA9IGdldENsb2NrU2tldyhpdGVtLCBwYXJlbnRJdGVtKTsKICAgIHZhciBkZWVwQ2hpbGRyZW4gPSAoMCwgX2xvZGFzaC5mbGF0dGVuKShjaGlsZHJlbi5tYXAoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgIHJldHVybiBnZXRTb3J0ZWRDaGlsZHJlbihjaGlsZCwgaXRlbSk7CiAgICB9KSk7CiAgICByZXR1cm4gW2l0ZW1dLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZGVlcENoaWxkcmVuKSk7CiAgfQoKICByZXR1cm4gZ2V0U29ydGVkQ2hpbGRyZW4oZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbik7Cn0KCmZ1bmN0aW9uIGdldFJvb3RUcmFuc2FjdGlvbihjaGlsZHJlbkJ5UGFyZW50SWQpIHsKICB2YXIgaXRlbSA9ICgwLCBfbG9kYXNoLmZpcnN0KShjaGlsZHJlbkJ5UGFyZW50SWQucm9vdCk7CgogIGlmIChpdGVtICYmIGl0ZW0uZG9jVHlwZSA9PT0gJ3RyYW5zYWN0aW9uJykgewogICAgcmV0dXJuIGl0ZW0uZG9jOwogIH0KfQoKZnVuY3Rpb24gZ2V0U2VydmljZUNvbG9ycyh3YXRlcmZhbGxJdGVtcykgewogIHZhciBzZXJ2aWNlcyA9ICgwLCBfbG9kYXNoLnVuaXEpKHdhdGVyZmFsbEl0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0uZG9jLnNlcnZpY2UubmFtZTsKICB9KSk7CiAgdmFyIGFzc2lnbmVkQ29sb3JzID0gW19ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczEsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczAsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczMsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczIsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczYsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczcsIF9ldWlfdGhlbWVfbGlnaHQuZGVmYXVsdC5ldWlDb2xvclZpczVdOwogIHJldHVybiAoMCwgX2xvZGFzaC56aXBPYmplY3QpKHNlcnZpY2VzLCBhc3NpZ25lZENvbG9ycyk7Cn0KCnZhciBnZXRXYXRlcmZhbGxEdXJhdGlvbiA9IGZ1bmN0aW9uIGdldFdhdGVyZmFsbER1cmF0aW9uKHdhdGVyZmFsbEl0ZW1zKSB7CiAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsIF90b0NvbnN1bWFibGVBcnJheSh3YXRlcmZhbGxJdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgIHJldHVybiBpdGVtLm9mZnNldCArIGl0ZW0uc2tldyArIGl0ZW0uZHVyYXRpb247CiAgfSkpLmNvbmNhdChbMF0pKTsKfTsKCnZhciBnZXRXYXRlcmZhbGxJdGVtcyA9IGZ1bmN0aW9uIGdldFdhdGVyZmFsbEl0ZW1zKGl0ZW1zKSB7CiAgcmV0dXJuIGl0ZW1zLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgdmFyIGRvY1R5cGUgPSBpdGVtLnByb2Nlc3Nvci5ldmVudDsKCiAgICBzd2l0Y2ggKGRvY1R5cGUpIHsKICAgICAgY2FzZSAnc3Bhbic6CiAgICAgICAgcmV0dXJuIGdldFNwYW5JdGVtKGl0ZW0pOwoKICAgICAgY2FzZSAndHJhbnNhY3Rpb24nOgogICAgICAgIHJldHVybiBnZXRUcmFuc2FjdGlvbkl0ZW0oaXRlbSk7CiAgICB9CiAgfSk7Cn07Cgp2YXIgZ2V0Q2hpbGRyZW5Hcm91cGVkQnlQYXJlbnRJZCA9IGZ1bmN0aW9uIGdldENoaWxkcmVuR3JvdXBlZEJ5UGFyZW50SWQod2F0ZXJmYWxsSXRlbXMpIHsKICByZXR1cm4gKDAsIF9sb2Rhc2guZ3JvdXBCeSkod2F0ZXJmYWxsSXRlbXMsIGZ1bmN0aW9uIChpdGVtKSB7CiAgICByZXR1cm4gaXRlbS5wYXJlbnRJZCA/IGl0ZW0ucGFyZW50SWQgOiBST09UX0lEOwogIH0pOwp9OwoKdmFyIGdldEVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24gPSBmdW5jdGlvbiBnZXRFbnRyeVdhdGVyZmFsbFRyYW5zYWN0aW9uKGVudHJ5VHJhbnNhY3Rpb25JZCwgd2F0ZXJmYWxsSXRlbXMpIHsKICByZXR1cm4gd2F0ZXJmYWxsSXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgcmV0dXJuIGl0ZW0uZG9jVHlwZSA9PT0gJ3RyYW5zYWN0aW9uJyAmJiBpdGVtLmlkID09PSBlbnRyeVRyYW5zYWN0aW9uSWQ7CiAgfSk7Cn07CgpmdW5jdGlvbiBpc0luRW50cnlUcmFuc2FjdGlvbihwYXJlbnRJZExvb2t1cCwgZW50cnlUcmFuc2FjdGlvbklkLCBjdXJyZW50SWQpIHsKICBpZiAoY3VycmVudElkID09PSBlbnRyeVRyYW5zYWN0aW9uSWQpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgdmFyIHBhcmVudElkID0gcGFyZW50SWRMb29rdXAuZ2V0KGN1cnJlbnRJZCk7CgogIGlmIChwYXJlbnRJZCkgewogICAgcmV0dXJuIGlzSW5FbnRyeVRyYW5zYWN0aW9uKHBhcmVudElkTG9va3VwLCBlbnRyeVRyYW5zYWN0aW9uSWQsIHBhcmVudElkKTsKICB9CgogIHJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gZ2V0V2F0ZXJmYWxsRXJyb3JzKGVycm9yRG9jcywgaXRlbXMsIGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24pIHsKICB2YXIgZXJyb3JJdGVtcyA9IGVycm9yRG9jcy5tYXAoZnVuY3Rpb24gKGVycm9yRG9jKSB7CiAgICByZXR1cm4gZ2V0RXJyb3JJdGVtKGVycm9yRG9jLCBpdGVtcywgZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbik7CiAgfSk7CgogIGlmICghZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbikgewogICAgcmV0dXJuIGVycm9ySXRlbXM7CiAgfQoKICB2YXIgcGFyZW50SWRMb29rdXAgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGl0ZW1zKSwgX3RvQ29uc3VtYWJsZUFycmF5KGVycm9ySXRlbXMpKS5yZWR1Y2UoZnVuY3Rpb24gKG1hcCwgX3JlZjIpIHsKICAgIHZhciBpZCA9IF9yZWYyLmlkLAogICAgICAgIHBhcmVudElkID0gX3JlZjIucGFyZW50SWQ7CiAgICBtYXAuc2V0KGlkLCBwYXJlbnRJZCAhPT0gbnVsbCAmJiBwYXJlbnRJZCAhPT0gdm9pZCAwID8gcGFyZW50SWQgOiBST09UX0lEKTsKICAgIHJldHVybiBtYXA7CiAgfSwgbmV3IE1hcCgpKTsKICByZXR1cm4gZXJyb3JJdGVtcy5maWx0ZXIoZnVuY3Rpb24gKGVycm9ySXRlbSkgewogICAgcmV0dXJuIGlzSW5FbnRyeVRyYW5zYWN0aW9uKHBhcmVudElkTG9va3VwLCBlbnRyeVdhdGVyZmFsbFRyYW5zYWN0aW9uID09PSBudWxsIHx8IGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24gPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24uaWQsIGVycm9ySXRlbS5pZCk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGdldFdhdGVyZmFsbChfcmVmMywgZW50cnlUcmFuc2FjdGlvbklkKSB7CiAgdmFyIHRyYWNlID0gX3JlZjMudHJhY2UsCiAgICAgIGVycm9yc1BlclRyYW5zYWN0aW9uID0gX3JlZjMuZXJyb3JzUGVyVHJhbnNhY3Rpb247CgogIGlmICgoMCwgX2xvZGFzaC5pc0VtcHR5KSh0cmFjZS5pdGVtcykgfHwgIWVudHJ5VHJhbnNhY3Rpb25JZCkgewogICAgcmV0dXJuIHsKICAgICAgZHVyYXRpb246IDAsCiAgICAgIGl0ZW1zOiBbXSwKICAgICAgZXJyb3JzUGVyVHJhbnNhY3Rpb246IGVycm9yc1BlclRyYW5zYWN0aW9uLAogICAgICBlcnJvcnNDb3VudDogKDAsIF9sb2Rhc2guc3VtKShPYmplY3QudmFsdWVzKGVycm9yc1BlclRyYW5zYWN0aW9uKSksCiAgICAgIHNlcnZpY2VDb2xvcnM6IHt9LAogICAgICBlcnJvckl0ZW1zOiBbXQogICAgfTsKICB9CgogIHZhciB3YXRlcmZhbGxJdGVtcyA9IGdldFdhdGVyZmFsbEl0ZW1zKHRyYWNlLml0ZW1zKTsKICB2YXIgY2hpbGRyZW5CeVBhcmVudElkID0gZ2V0Q2hpbGRyZW5Hcm91cGVkQnlQYXJlbnRJZCh3YXRlcmZhbGxJdGVtcyk7CiAgdmFyIGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24gPSBnZXRFbnRyeVdhdGVyZmFsbFRyYW5zYWN0aW9uKGVudHJ5VHJhbnNhY3Rpb25JZCwgd2F0ZXJmYWxsSXRlbXMpOwogIHZhciBpdGVtcyA9IGdldE9yZGVyZWRXYXRlcmZhbGxJdGVtcyhjaGlsZHJlbkJ5UGFyZW50SWQsIGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24pOwogIHZhciBlcnJvckl0ZW1zID0gZ2V0V2F0ZXJmYWxsRXJyb3JzKHRyYWNlLmVycm9yRG9jcywgaXRlbXMsIGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24pOwogIHZhciByb290VHJhbnNhY3Rpb24gPSBnZXRSb290VHJhbnNhY3Rpb24oY2hpbGRyZW5CeVBhcmVudElkKTsKICB2YXIgZHVyYXRpb24gPSBnZXRXYXRlcmZhbGxEdXJhdGlvbihpdGVtcyk7CiAgdmFyIHNlcnZpY2VDb2xvcnMgPSBnZXRTZXJ2aWNlQ29sb3JzKGl0ZW1zKTsKICB2YXIgZW50cnlUcmFuc2FjdGlvbiA9IGVudHJ5V2F0ZXJmYWxsVHJhbnNhY3Rpb24gPT09IG51bGwgfHwgZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbiA9PT0gdm9pZCAwID8gdm9pZCAwIDogZW50cnlXYXRlcmZhbGxUcmFuc2FjdGlvbi5kb2M7CiAgcmV0dXJuIHsKICAgIGVudHJ5VHJhbnNhY3Rpb246IGVudHJ5VHJhbnNhY3Rpb24sCiAgICByb290VHJhbnNhY3Rpb246IHJvb3RUcmFuc2FjdGlvbiwKICAgIGR1cmF0aW9uOiBkdXJhdGlvbiwKICAgIGl0ZW1zOiBpdGVtcywKICAgIGVycm9yc1BlclRyYW5zYWN0aW9uOiBlcnJvcnNQZXJUcmFuc2FjdGlvbiwKICAgIGVycm9yc0NvdW50OiBlcnJvckl0ZW1zLmxlbmd0aCwKICAgIHNlcnZpY2VDb2xvcnM6IHNlcnZpY2VDb2xvcnMsCiAgICBlcnJvckl0ZW1zOiBlcnJvckl0ZW1zCiAgfTsKfQ=="},null]}