{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/lens/public/app_plugin/app.js","dependencies":[{"path":"x-pack/legacy/plugins/lens/public/app_plugin/app.js","mtime":1589249552280},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkFwcCA9IEFwcDsKZXhwb3J0cy5nZXRBbGxJbmRleFBhdHRlcm5zID0gZ2V0QWxsSW5kZXhQYXR0ZXJuczsKCnZhciBfbG9kYXNoID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2giKSk7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3JlYWN0MiA9IHJlcXVpcmUoIkBrYm4vaTE4bi9yZWFjdCIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7Cgp2YXIgX25ld19wbGF0Zm9ybSA9IHJlcXVpcmUoInVpL25ld19wbGF0Zm9ybSIpOwoKdmFyIF9wdWJsaWMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9raWJhbmFfcmVhY3QvcHVibGljIik7Cgp2YXIgX3B1YmxpYzIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9zYXZlZF9vYmplY3RzL3B1YmxpYyIpOwoKdmFyIF9uYXRpdmVfcmVuZGVyZXIgPSByZXF1aXJlKCIuLi9uYXRpdmVfcmVuZGVyZXIiKTsKCnZhciBfbGVuc191aV90ZWxlbWV0cnkgPSByZXF1aXJlKCIuLi9sZW5zX3VpX3RlbGVtZXRyeSIpOwoKdmFyIF9wdWJsaWMzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL3BsdWdpbnMvZGF0YS9wdWJsaWMiKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewogIHRyeSB7CiAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CiAgICB2YXIgdmFsdWUgPSBpbmZvLnZhbHVlOwogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZWplY3QoZXJyb3IpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKGluZm8uZG9uZSkgewogICAgcmVzb2x2ZSh2YWx1ZSk7CiAgfSBlbHNlIHsKICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKICB9Cn0KCmZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOwoKICAgICAgZnVuY3Rpb24gX25leHQodmFsdWUpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBfdGhyb3coZXJyKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpOwogICAgICB9CgogICAgICBfbmV4dCh1bmRlZmluZWQpOwogICAgfSk7CiAgfTsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKZnVuY3Rpb24gQXBwKF9yZWYpIHsKICB2YXIgZWRpdG9yRnJhbWUgPSBfcmVmLmVkaXRvckZyYW1lLAogICAgICBkYXRhID0gX3JlZi5kYXRhLAogICAgICBjb3JlID0gX3JlZi5jb3JlLAogICAgICBzdG9yYWdlID0gX3JlZi5zdG9yYWdlLAogICAgICBkb2NJZCA9IF9yZWYuZG9jSWQsCiAgICAgIGRvY1N0b3JhZ2UgPSBfcmVmLmRvY1N0b3JhZ2UsCiAgICAgIHJlZGlyZWN0VG8gPSBfcmVmLnJlZGlyZWN0VG8sCiAgICAgIGFkZFRvRGFzaGJvYXJkTW9kZSA9IF9yZWYuYWRkVG9EYXNoYm9hcmRNb2RlOwogIHZhciBsYW5ndWFnZSA9IHN0b3JhZ2UuZ2V0KCdraWJhbmEudXNlclF1ZXJ5TGFuZ3VhZ2UnKSB8fCBjb3JlLnVpU2V0dGluZ3MuZ2V0KCdzZWFyY2g6cXVlcnlMYW5ndWFnZScpOwoKICB2YXIgX3VzZVN0YXRlID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoZnVuY3Rpb24gKCkgewogICAgdmFyIGN1cnJlbnRSYW5nZSA9IGRhdGEucXVlcnkudGltZWZpbHRlci50aW1lZmlsdGVyLmdldFRpbWUoKTsKICAgIHJldHVybiB7CiAgICAgIGlzTG9hZGluZzogISFkb2NJZCwKICAgICAgaXNTYXZlTW9kYWxWaXNpYmxlOiBmYWxzZSwKICAgICAgaW5kZXhQYXR0ZXJuc0ZvclRvcE5hdjogW10sCiAgICAgIHF1ZXJ5OiB7CiAgICAgICAgcXVlcnk6ICcnLAogICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZQogICAgICB9LAogICAgICBkYXRlUmFuZ2U6IHsKICAgICAgICBmcm9tRGF0ZTogY3VycmVudFJhbmdlLmZyb20sCiAgICAgICAgdG9EYXRlOiBjdXJyZW50UmFuZ2UudG8KICAgICAgfSwKICAgICAgZmlsdGVyczogW10KICAgIH07CiAgfSksCiAgICAgIF91c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLAogICAgICBzdGF0ZSA9IF91c2VTdGF0ZTJbMF0sCiAgICAgIHNldFN0YXRlID0gX3VzZVN0YXRlMlsxXTsKCiAgdmFyIGxhc3RLbm93bkRvYyA9IHN0YXRlLmxhc3RLbm93bkRvYzsKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkgewogICAgLy8gQ2xlYXIgYXBwLXNwZWNpZmljIGZpbHRlcnMgd2hlbiBuYXZpZ2F0aW5nIHRvIExlbnMuIE5lY2Vzc2FyeSBiZWNhdXNlIExlbnMKICAgIC8vIGNhbiBiZSBsb2FkZWQgd2l0aG91dCBhIGZ1bGwgcGFnZSByZWZyZXNoCiAgICBkYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXIuc2V0QXBwRmlsdGVycyhbXSk7CiAgICB2YXIgZmlsdGVyU3Vic2NyaXB0aW9uID0gZGF0YS5xdWVyeS5maWx0ZXJNYW5hZ2VyLmdldFVwZGF0ZXMkKCkuc3Vic2NyaWJlKHsKICAgICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgICAgZmlsdGVyczogZGF0YS5xdWVyeS5maWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgKDAsIF9sZW5zX3VpX3RlbGVtZXRyeS50cmFja1VpRXZlbnQpKCdhcHBfZmlsdGVyc191cGRhdGVkJyk7CiAgICAgIH0KICAgIH0pOwogICAgdmFyIHRpbWVTdWJzY3JpcHRpb24gPSBkYXRhLnF1ZXJ5LnRpbWVmaWx0ZXIudGltZWZpbHRlci5nZXRUaW1lVXBkYXRlJCgpLnN1YnNjcmliZSh7CiAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgdmFyIGN1cnJlbnRSYW5nZSA9IGRhdGEucXVlcnkudGltZWZpbHRlci50aW1lZmlsdGVyLmdldFRpbWUoKTsKICAgICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgICAgZGF0ZVJhbmdlOiB7CiAgICAgICAgICAgICAgZnJvbURhdGU6IGN1cnJlbnRSYW5nZS5mcm9tLAogICAgICAgICAgICAgIHRvRGF0ZTogY3VycmVudFJhbmdlLnRvCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIGZpbHRlclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgICB0aW1lU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICB9OwogIH0sIFtdKTsgLy8gU3luYyBLaWJhbmEgYnJlYWRjcnVtYnMgYW55IHRpbWUgdGhlIHNhdmVkIGRvY3VtZW50J3MgdGl0bGUgY2hhbmdlcwoKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkgewogICAgY29yZS5jaHJvbWUuc2V0QnJlYWRjcnVtYnMoW3sKICAgICAgaHJlZjogY29yZS5odHRwLmJhc2VQYXRoLnByZXBlbmQoIi9hcHAva2liYW5hIy92aXN1YWxpemUiKSwKICAgICAgdGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuYnJlYWRjcnVtYnNUaXRsZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1Zpc3VhbGl6ZScKICAgICAgfSkKICAgIH0sIHsKICAgICAgdGV4dDogc3RhdGUucGVyc2lzdGVkRG9jID8gc3RhdGUucGVyc2lzdGVkRG9jLnRpdGxlIDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuYnJlYWRjcnVtYnNDcmVhdGUnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDcmVhdGUnCiAgICAgIH0pCiAgICB9XSk7CiAgfSwgW3N0YXRlLnBlcnNpc3RlZERvYyAmJiBzdGF0ZS5wZXJzaXN0ZWREb2MudGl0bGVdKTsKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkgewogICAgaWYgKGRvY0lkICYmICghc3RhdGUucGVyc2lzdGVkRG9jIHx8IHN0YXRlLnBlcnNpc3RlZERvYy5pZCAhPT0gZG9jSWQpKSB7CiAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgIGlzTG9hZGluZzogdHJ1ZQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgZG9jU3RvcmFnZS5sb2FkKGRvY0lkKS50aGVuKGZ1bmN0aW9uIChkb2MpIHsKICAgICAgICBnZXRBbGxJbmRleFBhdHRlcm5zKGRvYy5zdGF0ZS5kYXRhc291cmNlTWV0YURhdGEuZmlsdGVyYWJsZUluZGV4UGF0dGVybnMsIGRhdGEuaW5kZXhQYXR0ZXJucywgY29yZS5ub3RpZmljYXRpb25zKS50aGVuKGZ1bmN0aW9uIChpbmRleFBhdHRlcm5zKSB7CiAgICAgICAgICAvLyBEb24ndCBvdmVyd3JpdGUgYW55IHBpbm5lZCBmaWx0ZXJzCiAgICAgICAgICBkYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXIuc2V0QXBwRmlsdGVycyhkb2Muc3RhdGUuZmlsdGVycyk7CiAgICAgICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsCiAgICAgICAgICAgICAgcGVyc2lzdGVkRG9jOiBkb2MsCiAgICAgICAgICAgICAgbGFzdEtub3duRG9jOiBkb2MsCiAgICAgICAgICAgICAgcXVlcnk6IGRvYy5zdGF0ZS5xdWVyeSwKICAgICAgICAgICAgICBpbmRleFBhdHRlcm5zRm9yVG9wTmF2OiBpbmRleFBhdHRlcm5zCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkgewogICAgICAgICAgc2V0U3RhdGUoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgICAgICBpc0xvYWRpbmc6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICByZWRpcmVjdFRvKCk7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgICAgaXNMb2FkaW5nOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgY29yZS5ub3RpZmljYXRpb25zLnRvYXN0cy5hZGREYW5nZXIoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLmxlbnMuYXBwLmRvY0xvYWRpbmdFcnJvcicsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRXJyb3IgbG9hZGluZyBzYXZlZCBkb2N1bWVudCcKICAgICAgICB9KSk7CiAgICAgICAgcmVkaXJlY3RUbygpOwogICAgICB9KTsKICAgIH0KICB9LCBbZG9jSWRdKTsKICB2YXIgaXNTYXZlYWJsZSA9IGxhc3RLbm93bkRvYyAmJiBsYXN0S25vd25Eb2MuZXhwcmVzc2lvbiAmJiBsYXN0S25vd25Eb2MuZXhwcmVzc2lvbi5sZW5ndGggPiAwICYmIGNvcmUuYXBwbGljYXRpb24uY2FwYWJpbGl0aWVzLnZpc3VhbGl6ZS5zYXZlOwogIHZhciBvbkVycm9yID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKGUpIHsKICAgIHJldHVybiBjb3JlLm5vdGlmaWNhdGlvbnMudG9hc3RzLmFkZERhbmdlcih7CiAgICAgIHRpdGxlOiBlLm1lc3NhZ2UKICAgIH0pOwogIH0sIFtdKTsKICB2YXIgVG9wTmF2TWVudSA9IF9uZXdfcGxhdGZvcm0ubnBTdGFydC5wbHVnaW5zLm5hdmlnYXRpb24udWkuVG9wTmF2TWVudTsKICB2YXIgY29uZmlybUJ1dHRvbiA9IGFkZFRvRGFzaGJvYXJkTW9kZSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICBpZDogInhwYWNrLmxlbnMuYXBwLnNhdmVBZGRUb0Rhc2hib2FyZCIsCiAgICBkZWZhdWx0TWVzc2FnZTogIlNhdmUgYW5kIGFkZCB0byBkYXNoYm9hcmQiCiAgfSkgOiBudWxsOwogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuSTE4blByb3ZpZGVyLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9wdWJsaWMuS2liYW5hQ29udGV4dFByb3ZpZGVyLCB7CiAgICBzZXJ2aWNlczogX29iamVjdFNwcmVhZCh7CiAgICAgIGFwcE5hbWU6ICdsZW5zJywKICAgICAgZGF0YTogZGF0YSwKICAgICAgc3RvcmFnZTogc3RvcmFnZQogICAgfSwgY29yZSkKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICBjbGFzc05hbWU6ICJsbnNBcHAiCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgY2xhc3NOYW1lOiAibG5zQXBwX19oZWFkZXIiCiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChUb3BOYXZNZW51LCB7CiAgICBjb25maWc6IFt7CiAgICAgIGxhYmVsOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5hcHAuc2F2ZScsIHsKICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1NhdmUnCiAgICAgIH0pLAogICAgICBydW46IGZ1bmN0aW9uIHJ1bigpIHsKICAgICAgICBpZiAoaXNTYXZlYWJsZSAmJiBsYXN0S25vd25Eb2MpIHsKICAgICAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICAgICAgaXNTYXZlTW9kYWxWaXNpYmxlOiB0cnVlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB0ZXN0SWQ6ICdsbnNBcHBfc2F2ZUJ1dHRvbicsCiAgICAgIGRpc2FibGVCdXR0b246ICFpc1NhdmVhYmxlCiAgICB9XSwKICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJsbnNBcHBfdG9wTmF2IiwKICAgIHNjcmVlblRpdGxlOiAnbGVucycsCiAgICBvblF1ZXJ5U3VibWl0OiBmdW5jdGlvbiBvblF1ZXJ5U3VibWl0KHBheWxvYWQpIHsKICAgICAgdmFyIGRhdGVSYW5nZSA9IHBheWxvYWQuZGF0ZVJhbmdlLAogICAgICAgICAgcXVlcnkgPSBwYXlsb2FkLnF1ZXJ5OwoKICAgICAgaWYgKGRhdGVSYW5nZS5mcm9tICE9PSBzdGF0ZS5kYXRlUmFuZ2UuZnJvbURhdGUgfHwgZGF0ZVJhbmdlLnRvICE9PSBzdGF0ZS5kYXRlUmFuZ2UudG9EYXRlKSB7CiAgICAgICAgZGF0YS5xdWVyeS50aW1lZmlsdGVyLnRpbWVmaWx0ZXIuc2V0VGltZShkYXRlUmFuZ2UpOwogICAgICAgICgwLCBfbGVuc191aV90ZWxlbWV0cnkudHJhY2tVaUV2ZW50KSgnYXBwX2RhdGVfY2hhbmdlJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKDAsIF9sZW5zX3VpX3RlbGVtZXRyeS50cmFja1VpRXZlbnQpKCdhcHBfcXVlcnlfY2hhbmdlJyk7CiAgICAgIH0KCiAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgIGRhdGVSYW5nZTogewogICAgICAgICAgICBmcm9tRGF0ZTogZGF0ZVJhbmdlLmZyb20sCiAgICAgICAgICAgIHRvRGF0ZTogZGF0ZVJhbmdlLnRvCiAgICAgICAgICB9LAogICAgICAgICAgcXVlcnk6IHF1ZXJ5IHx8IHMucXVlcnkKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgYXBwTmFtZTogJ2xlbnMnLAogICAgaW5kZXhQYXR0ZXJuczogc3RhdGUuaW5kZXhQYXR0ZXJuc0ZvclRvcE5hdiwKICAgIHNob3dTZWFyY2hCYXI6IHRydWUsCiAgICBzaG93RGF0ZVBpY2tlcjogdHJ1ZSwKICAgIHNob3dRdWVyeUJhcjogdHJ1ZSwKICAgIHNob3dGaWx0ZXJCYXI6IHRydWUsCiAgICBzaG93U2F2ZVF1ZXJ5OiBjb3JlLmFwcGxpY2F0aW9uLmNhcGFiaWxpdGllcy52aXN1YWxpemUuc2F2ZVF1ZXJ5LAogICAgc2F2ZWRRdWVyeTogc3RhdGUuc2F2ZWRRdWVyeSwKICAgIG9uU2F2ZWQ6IGZ1bmN0aW9uIG9uU2F2ZWQoc2F2ZWRRdWVyeSkgewogICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICBzYXZlZFF1ZXJ5OiBzYXZlZFF1ZXJ5CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIG9uU2F2ZWRRdWVyeVVwZGF0ZWQ6IGZ1bmN0aW9uIG9uU2F2ZWRRdWVyeVVwZGF0ZWQoc2F2ZWRRdWVyeSkgewogICAgICB2YXIgc2F2ZWRRdWVyeUZpbHRlcnMgPSBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMuZmlsdGVycyB8fCBbXTsKICAgICAgdmFyIGdsb2JhbEZpbHRlcnMgPSBkYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXIuZ2V0R2xvYmFsRmlsdGVycygpOwogICAgICBkYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXIuc2V0RmlsdGVycyhbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGdsb2JhbEZpbHRlcnMpLCBfdG9Db25zdW1hYmxlQXJyYXkoc2F2ZWRRdWVyeUZpbHRlcnMpKSk7CiAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgIHNhdmVkUXVlcnk6IF9vYmplY3RTcHJlYWQoe30sIHNhdmVkUXVlcnkpLAogICAgICAgICAgLy8gU2hhbGxvdyBxdWVyeSBmb3IgcmVmZXJlbmNlIGlzc3VlcwogICAgICAgICAgZGF0ZVJhbmdlOiBzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlciA/IHsKICAgICAgICAgICAgZnJvbURhdGU6IHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLmZyb20sCiAgICAgICAgICAgIHRvRGF0ZTogc2F2ZWRRdWVyeS5hdHRyaWJ1dGVzLnRpbWVmaWx0ZXIudG8KICAgICAgICAgIH0gOiBzLmRhdGVSYW5nZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBvbkNsZWFyU2F2ZWRRdWVyeTogZnVuY3Rpb24gb25DbGVhclNhdmVkUXVlcnkoKSB7CiAgICAgIGRhdGEucXVlcnkuZmlsdGVyTWFuYWdlci5zZXRGaWx0ZXJzKGRhdGEucXVlcnkuZmlsdGVyTWFuYWdlci5nZXRHbG9iYWxGaWx0ZXJzKCkpOwogICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICBzYXZlZFF1ZXJ5OiB1bmRlZmluZWQsCiAgICAgICAgICBmaWx0ZXJzOiBkYXRhLnF1ZXJ5LmZpbHRlck1hbmFnZXIuZ2V0R2xvYmFsRmlsdGVycygpLAogICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgcXVlcnk6ICcnLAogICAgICAgICAgICBsYW5ndWFnZTogc3RvcmFnZS5nZXQoJ2tpYmFuYS51c2VyUXVlcnlMYW5ndWFnZScpIHx8IGNvcmUudWlTZXR0aW5ncy5nZXQoJ3NlYXJjaDpxdWVyeUxhbmd1YWdlJykKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcXVlcnk6IHN0YXRlLnF1ZXJ5LAogICAgZGF0ZVJhbmdlRnJvbTogc3RhdGUuZGF0ZVJhbmdlLmZyb21EYXRlLAogICAgZGF0ZVJhbmdlVG86IHN0YXRlLmRhdGVSYW5nZS50b0RhdGUKICB9KSksICghc3RhdGUuaXNMb2FkaW5nIHx8IHN0YXRlLnBlcnNpc3RlZERvYykgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbmF0aXZlX3JlbmRlcmVyLk5hdGl2ZVJlbmRlcmVyLCB7CiAgICBjbGFzc05hbWU6ICJsbnNBcHBfX2ZyYW1lIiwKICAgIHJlbmRlcjogZWRpdG9yRnJhbWUubW91bnQsCiAgICBuYXRpdmVQcm9wczogewogICAgICBkYXRlUmFuZ2U6IHN0YXRlLmRhdGVSYW5nZSwKICAgICAgcXVlcnk6IHN0YXRlLnF1ZXJ5LAogICAgICBmaWx0ZXJzOiBzdGF0ZS5maWx0ZXJzLAogICAgICBzYXZlZFF1ZXJ5OiBzdGF0ZS5zYXZlZFF1ZXJ5LAogICAgICBkb2M6IHN0YXRlLnBlcnNpc3RlZERvYywKICAgICAgb25FcnJvcjogb25FcnJvciwKICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKF9yZWYyKSB7CiAgICAgICAgdmFyIGZpbHRlcmFibGVJbmRleFBhdHRlcm5zID0gX3JlZjIuZmlsdGVyYWJsZUluZGV4UGF0dGVybnMsCiAgICAgICAgICAgIGRvYyA9IF9yZWYyLmRvYzsKCiAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChzdGF0ZS5wZXJzaXN0ZWREb2MsIGRvYykpIHsKICAgICAgICAgIHNldFN0YXRlKGZ1bmN0aW9uIChzKSB7CiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICAgICAgbGFzdEtub3duRG9jOiBkb2MKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IC8vIFVwZGF0ZSB0aGUgY2FjaGVkIGluZGV4IHBhdHRlcm5zIGlmIHRoZSB1c2VyIG1hZGUgYSBjaGFuZ2UgdG8gYW55IG9mIHRoZW0KCgogICAgICAgIGlmIChzdGF0ZS5pbmRleFBhdHRlcm5zRm9yVG9wTmF2Lmxlbmd0aCAhPT0gZmlsdGVyYWJsZUluZGV4UGF0dGVybnMubGVuZ3RoIHx8IGZpbHRlcmFibGVJbmRleFBhdHRlcm5zLmZpbmQoZnVuY3Rpb24gKF9yZWYzKSB7CiAgICAgICAgICB2YXIgaWQgPSBfcmVmMy5pZDsKICAgICAgICAgIHJldHVybiAhc3RhdGUuaW5kZXhQYXR0ZXJuc0ZvclRvcE5hdi5maW5kKGZ1bmN0aW9uIChpbmRleFBhdHRlcm4pIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4UGF0dGVybi5pZCA9PT0gaWQ7CiAgICAgICAgICB9KTsKICAgICAgICB9KSkgewogICAgICAgICAgZ2V0QWxsSW5kZXhQYXR0ZXJucyhmaWx0ZXJhYmxlSW5kZXhQYXR0ZXJucywgZGF0YS5pbmRleFBhdHRlcm5zLCBjb3JlLm5vdGlmaWNhdGlvbnMpLnRoZW4oZnVuY3Rpb24gKGluZGV4UGF0dGVybnMpIHsKICAgICAgICAgICAgaWYgKGluZGV4UGF0dGVybnMpIHsKICAgICAgICAgICAgICBzZXRTdGF0ZShmdW5jdGlvbiAocykgewogICAgICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHMsIHsKICAgICAgICAgICAgICAgICAgaW5kZXhQYXR0ZXJuc0ZvclRvcE5hdjogaW5kZXhQYXR0ZXJucwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0pKSwgbGFzdEtub3duRG9jICYmIHN0YXRlLmlzU2F2ZU1vZGFsVmlzaWJsZSAmJiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9wdWJsaWMyLlNhdmVkT2JqZWN0U2F2ZU1vZGFsLCB7CiAgICBvblNhdmU6IGZ1bmN0aW9uIG9uU2F2ZShwcm9wcykgewogICAgICB2YXIgX2xhc3RLbm93bkRvYyRzdGF0ZTsKCiAgICAgIHZhciBfJHBhcnRpdGlvbiA9IF9sb2Rhc2guZGVmYXVsdC5wYXJ0aXRpb24oKF9sYXN0S25vd25Eb2Mkc3RhdGUgPSBsYXN0S25vd25Eb2Muc3RhdGUpID09PSBudWxsIHx8IF9sYXN0S25vd25Eb2Mkc3RhdGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9sYXN0S25vd25Eb2Mkc3RhdGUuZmlsdGVycywgX3B1YmxpYzMuZXNGaWx0ZXJzLmlzRmlsdGVyUGlubmVkKSwKICAgICAgICAgIF8kcGFydGl0aW9uMiA9IF9zbGljZWRUb0FycmF5KF8kcGFydGl0aW9uLCAyKSwKICAgICAgICAgIHBpbm5lZEZpbHRlcnMgPSBfJHBhcnRpdGlvbjJbMF0sCiAgICAgICAgICBhcHBGaWx0ZXJzID0gXyRwYXJ0aXRpb24yWzFdOwoKICAgICAgdmFyIGxhc3REb2NXaXRob3V0UGlubmVkID0gKHBpbm5lZEZpbHRlcnMgPT09IG51bGwgfHwgcGlubmVkRmlsdGVycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcGlubmVkRmlsdGVycy5sZW5ndGgpID8gX29iamVjdFNwcmVhZCh7fSwgbGFzdEtub3duRG9jLCB7CiAgICAgICAgc3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIGxhc3RLbm93bkRvYy5zdGF0ZSwgewogICAgICAgICAgZmlsdGVyczogYXBwRmlsdGVycwogICAgICAgIH0pCiAgICAgIH0pIDogbGFzdEtub3duRG9jOwoKICAgICAgdmFyIGRvYyA9IF9vYmplY3RTcHJlYWQoe30sIGxhc3REb2NXaXRob3V0UGlubmVkLCB7CiAgICAgICAgaWQ6IHByb3BzLm5ld0NvcHlPblNhdmUgPyB1bmRlZmluZWQgOiBsYXN0S25vd25Eb2MuaWQsCiAgICAgICAgdGl0bGU6IHByb3BzLm5ld1RpdGxlCiAgICAgIH0pOwoKICAgICAgZG9jU3RvcmFnZS5zYXZlKGRvYykudGhlbihmdW5jdGlvbiAoX3JlZjQpIHsKICAgICAgICB2YXIgaWQgPSBfcmVmNC5pZDsgLy8gUHJldmVudHMgdW5uZWNlc3NhcnkgbmV0d29yayByZXF1ZXN0IGFuZCBkaXNhYmxlcyBzYXZlIGJ1dHRvbgoKICAgICAgICB2YXIgbmV3RG9jID0gX29iamVjdFNwcmVhZCh7fSwgZG9jLCB7CiAgICAgICAgICBpZDogaWQKICAgICAgICB9KTsKCiAgICAgICAgc2V0U3RhdGUoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICAgIGlzU2F2ZU1vZGFsVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgIHBlcnNpc3RlZERvYzogbmV3RG9jLAogICAgICAgICAgICBsYXN0S25vd25Eb2M6IG5ld0RvYwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChkb2NJZCAhPT0gaWQpIHsKICAgICAgICAgIHJlZGlyZWN0VG8oaWQpOwogICAgICAgIH0KICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgIGNvbnNvbGUuZGlyKGUpOwogICAgICAgICgwLCBfbGVuc191aV90ZWxlbWV0cnkudHJhY2tVaUV2ZW50KSgnc2F2ZV9mYWlsZWQnKTsKICAgICAgICBjb3JlLm5vdGlmaWNhdGlvbnMudG9hc3RzLmFkZERhbmdlcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5hcHAuZG9jU2F2aW5nRXJyb3InLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0Vycm9yIHNhdmluZyBkb2N1bWVudCcKICAgICAgICB9KSk7CiAgICAgICAgc2V0U3RhdGUoZnVuY3Rpb24gKHMpIHsKICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzLCB7CiAgICAgICAgICAgIGlzU2F2ZU1vZGFsVmlzaWJsZTogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBvbkNsb3NlOiBmdW5jdGlvbiBvbkNsb3NlKCkgewogICAgICByZXR1cm4gc2V0U3RhdGUoZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcywgewogICAgICAgICAgaXNTYXZlTW9kYWxWaXNpYmxlOiBmYWxzZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICB0aXRsZTogbGFzdEtub3duRG9jLnRpdGxlIHx8ICcnLAogICAgc2hvd0NvcHlPblNhdmU6ICFhZGRUb0Rhc2hib2FyZE1vZGUsCiAgICBvYmplY3RUeXBlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2subGVucy5hcHAuc2F2ZU1vZGFsVHlwZScsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdMZW5zIHZpc3VhbGl6YXRpb24nCiAgICB9KSwKICAgIHNob3dEZXNjcmlwdGlvbjogZmFsc2UsCiAgICBjb25maXJtQnV0dG9uTGFiZWw6IGNvbmZpcm1CdXR0b24KICB9KSkpOwp9CgpmdW5jdGlvbiBnZXRBbGxJbmRleFBhdHRlcm5zKF94LCBfeDIsIF94MykgewogIHJldHVybiBfZ2V0QWxsSW5kZXhQYXR0ZXJucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9CgpmdW5jdGlvbiBfZ2V0QWxsSW5kZXhQYXR0ZXJucygpIHsKICBfZ2V0QWxsSW5kZXhQYXR0ZXJucyA9IF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGlkcywgaW5kZXhQYXR0ZXJuc1NlcnZpY2UsIG5vdGlmaWNhdGlvbnMpIHsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDA7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoaWRzLm1hcChmdW5jdGlvbiAoX3JlZjUpIHsKICAgICAgICAgICAgICB2YXIgaWQgPSBfcmVmNS5pZDsKICAgICAgICAgICAgICByZXR1cm4gaW5kZXhQYXR0ZXJuc1NlcnZpY2UuZ2V0KGlkKTsKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQuc2VudCk7CgogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNjsKICAgICAgICAgICAgX2NvbnRleHQudDAgPSBfY29udGV4dFsiY2F0Y2giXSgwKTsKICAgICAgICAgICAgbm90aWZpY2F0aW9ucy50b2FzdHMuYWRkRGFuZ2VyKF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5sZW5zLmFwcC5pbmRleFBhdHRlcm5Mb2FkaW5nRXJyb3InLCB7CiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdFcnJvciBsb2FkaW5nIGluZGV4IHBhdHRlcm5zJwogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfY29udGV4dC50MCk7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzAsIDZdXSk7CiAgfSkpOwogIHJldHVybiBfZ2V0QWxsSW5kZXhQYXR0ZXJucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwp9"},null]}