{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/components/query_bar/index.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/components/query_bar/index.js","mtime":1589249553308},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlF1ZXJ5QmFyRGVmaW5lUnVsZSA9IHZvaWQgMDsKCnZhciBfZXVpID0gcmVxdWlyZSgiQGVsYXN0aWMvZXVpIik7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3J4anMgPSByZXF1aXJlKCJyeGpzIik7Cgp2YXIgX3N0eWxlZENvbXBvbmVudHMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInN0eWxlZC1jb21wb25lbnRzIikpOwoKdmFyIF9mYXN0RGVlcEVxdWFsID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJmYXN0LWRlZXAtZXF1YWwiKSk7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2RhdGEvcHVibGljIik7Cgp2YXIgX29wZW5fdGltZWxpbmVfbW9kYWwgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb21wb25lbnRzL29wZW5fdGltZWxpbmUvb3Blbl90aW1lbGluZV9tb2RhbCIpOwoKdmFyIF9xdWVyeV9iYXIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb21wb25lbnRzL3F1ZXJ5X2JhciIpOwoKdmFyIF9oZWxwZXJzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vY29tcG9uZW50cy90aW1lbGluZS9oZWxwZXJzIik7Cgp2YXIgX3F1ZXJ5X2JhcjIgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb21wb25lbnRzL3RpbWVsaW5lL3F1ZXJ5X2JhciIpOwoKdmFyIF9rZXVyeSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uL2xpYi9rZXVyeSIpOwoKdmFyIF9raWJhbmEgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9saWIva2liYW5hIik7Cgp2YXIgX3NhdmVkX3F1ZXJ5X3NlcnZpY2VzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vdXRpbHMvc2F2ZWRfcXVlcnlfc2VydmljZXMiKTsKCnZhciBfc2hhcmVkX2ltcG9ydHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9zaGFyZWRfaW1wb3J0cyIpOwoKdmFyIGkxOG4gPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuL3RyYW5zbGF0aW9ucyIpKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsKICAgIGRlZmF1bHQ6IG9iagogIH07Cn0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgewogIGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIHsKICAgIHZhciBuZXdPYmogPSB7fTsKCiAgICBpZiAob2JqICE9IG51bGwpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7CiAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsKCiAgICAgICAgICBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld09ialtrZXldID0gb2JqW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgbmV3T2JqLmRlZmF1bHQgPSBvYmo7CiAgICByZXR1cm4gbmV3T2JqOwogIH0KfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHsKICB2YXIgX2FyciA9IFtdOwogIHZhciBfbiA9IHRydWU7CiAgdmFyIF9kID0gZmFsc2U7CiAgdmFyIF9lID0gdW5kZWZpbmVkOwoKICB0cnkgewogICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoKICAgICAgaWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrOwogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2QgPSB0cnVlOwogICAgX2UgPSBlcnI7CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgIH0KICB9CgogIHJldHVybiBfYXJyOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjsKfQoKdmFyIFN0eWxlZEV1aUZvcm1Sb3cgPSAoMCwgX3N0eWxlZENvbXBvbmVudHMuZGVmYXVsdCkoX2V1aS5FdWlGb3JtUm93KS53aXRoQ29uZmlnKHsKICBkaXNwbGF5TmFtZTogIlN0eWxlZEV1aUZvcm1Sb3ciLAogIGNvbXBvbmVudElkOiAieDNmemczLTAiCn0pKFsiLmtiblR5cGVhaGVhZF9faXRlbXN7bWF4LWhlaWdodDo0NXZoICFpbXBvcnRhbnQ7fS5nbG9iYWxRdWVyeUJhcntwYWRkaW5nOjRweCAwcHggMHB4IDBweDsua2JuUXVlcnlCYXJ7JiA+IGRpdjpmaXJzdC1jaGlsZHttYXJnaW46MHB4IDBweCAwcHggNHB4O319fSJdKTsgLy8gVE9ETyBuZWVkIHRvIGFkZCBkaXNhYmxlZCBpbiB0aGUgU2VhcmNoQmFyCgp2YXIgUXVlcnlCYXJEZWZpbmVSdWxlID0gZnVuY3Rpb24gUXVlcnlCYXJEZWZpbmVSdWxlKF9yZWYpIHsKICB2YXIgYnJvd3NlckZpZWxkcyA9IF9yZWYuYnJvd3NlckZpZWxkcywKICAgICAgZGF0YVRlc3RTdWJqID0gX3JlZi5kYXRhVGVzdFN1YmosCiAgICAgIGZpZWxkID0gX3JlZi5maWVsZCwKICAgICAgaWRBcmlhID0gX3JlZi5pZEFyaWEsCiAgICAgIGluZGV4UGF0dGVybiA9IF9yZWYuaW5kZXhQYXR0ZXJuLAogICAgICBfcmVmJGlzTG9hZGluZyA9IF9yZWYuaXNMb2FkaW5nLAogICAgICBpc0xvYWRpbmcgPSBfcmVmJGlzTG9hZGluZyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJGlzTG9hZGluZywKICAgICAgb25DbG9zZVRpbWVsaW5lU2VhcmNoID0gX3JlZi5vbkNsb3NlVGltZWxpbmVTZWFyY2gsCiAgICAgIF9yZWYkb3BlblRpbWVsaW5lU2VhciA9IF9yZWYub3BlblRpbWVsaW5lU2VhcmNoLAogICAgICBvcGVuVGltZWxpbmVTZWFyY2ggPSBfcmVmJG9wZW5UaW1lbGluZVNlYXIgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRvcGVuVGltZWxpbmVTZWFyLAogICAgICByZXNpemVQYXJlbnRDb250YWluZXIgPSBfcmVmLnJlc2l6ZVBhcmVudENvbnRhaW5lcjsKCiAgdmFyIF91c2VTdGF0ZSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKC0xKSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIG9yaWdpbmFsSGVpZ2h0ID0gX3VzZVN0YXRlMlswXSwKICAgICAgc2V0T3JpZ2luYWxIZWlnaHQgPSBfdXNlU3RhdGUyWzFdOwoKICB2YXIgX3VzZVN0YXRlMyA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKGZhbHNlKSwKICAgICAgX3VzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTMsIDIpLAogICAgICBsb2FkaW5nVGltZWxpbmUgPSBfdXNlU3RhdGU0WzBdLAogICAgICBzZXRMb2FkaW5nVGltZWxpbmUgPSBfdXNlU3RhdGU0WzFdOwoKICB2YXIgX3VzZVN0YXRlNSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKG51bGwpLAogICAgICBfdXNlU3RhdGU2ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNSwgMiksCiAgICAgIHNhdmVkUXVlcnkgPSBfdXNlU3RhdGU2WzBdLAogICAgICBzZXRTYXZlZFF1ZXJ5ID0gX3VzZVN0YXRlNlsxXTsKCiAgdmFyIF91c2VTdGF0ZTcgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKSh7CiAgICBxdWVyeTogJycsCiAgICBsYW5ndWFnZTogJ2t1ZXJ5JwogIH0pLAogICAgICBfdXNlU3RhdGU4ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNywgMiksCiAgICAgIHF1ZXJ5RHJhZnQgPSBfdXNlU3RhdGU4WzBdLAogICAgICBzZXRRdWVyeURyYWZ0ID0gX3VzZVN0YXRlOFsxXTsKCiAgdmFyIF9nZXRGaWVsZFZhbGlkaXR5QW5kRSA9ICgwLCBfc2hhcmVkX2ltcG9ydHMuZ2V0RmllbGRWYWxpZGl0eUFuZEVycm9yTWVzc2FnZSkoZmllbGQpLAogICAgICBpc0ludmFsaWQgPSBfZ2V0RmllbGRWYWxpZGl0eUFuZEUuaXNJbnZhbGlkLAogICAgICBlcnJvck1lc3NhZ2UgPSBfZ2V0RmllbGRWYWxpZGl0eUFuZEUuZXJyb3JNZXNzYWdlOwoKICB2YXIga2liYW5hID0gKDAsIF9raWJhbmEudXNlS2liYW5hKSgpOwoKICB2YXIgX3VzZVN0YXRlOSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKG5ldyBfcHVibGljLkZpbHRlck1hbmFnZXIoa2liYW5hLnNlcnZpY2VzLnVpU2V0dGluZ3MpKSwKICAgICAgX3VzZVN0YXRlMTAgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU5LCAxKSwKICAgICAgZmlsdGVyTWFuYWdlciA9IF91c2VTdGF0ZTEwWzBdOwoKICB2YXIgc2F2ZWRRdWVyeVNlcnZpY2VzID0gKDAsIF9zYXZlZF9xdWVyeV9zZXJ2aWNlcy51c2VTYXZlZFF1ZXJ5U2VydmljZXMpKCk7CiAgKDAsIF9yZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgIHZhciBpc1N1YnNjcmliZWQgPSB0cnVlOwogICAgdmFyIHN1YnNjcmlwdGlvbnMgPSBuZXcgX3J4anMuU3Vic2NyaXB0aW9uKCk7CiAgICBmaWx0ZXJNYW5hZ2VyLnNldEZpbHRlcnMoW10pOwogICAgc3Vic2NyaXB0aW9ucy5hZGQoZmlsdGVyTWFuYWdlci5nZXRVcGRhdGVzJCgpLnN1YnNjcmliZSh7CiAgICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgICAgaWYgKGlzU3Vic2NyaWJlZCkgewogICAgICAgICAgdmFyIG5ld0ZpbHRlcnMgPSBmaWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKTsKICAgICAgICAgIHZhciBfcmVmMiA9IGZpZWxkLnZhbHVlLAogICAgICAgICAgICAgIGZpbHRlcnMgPSBfcmVmMi5maWx0ZXJzOwoKICAgICAgICAgIGlmICghKDAsIF9mYXN0RGVlcEVxdWFsLmRlZmF1bHQpKGZpbHRlcnMsIG5ld0ZpbHRlcnMpKSB7CiAgICAgICAgICAgIGZpZWxkLnNldFZhbHVlKF9vYmplY3RTcHJlYWQoe30sIGZpZWxkLnZhbHVlLCB7CiAgICAgICAgICAgICAgZmlsdGVyczogbmV3RmlsdGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9KSk7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBpc1N1YnNjcmliZWQgPSBmYWxzZTsKICAgICAgc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpOwogICAgfTsKICB9LCBbZmllbGQudmFsdWVdKTsKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkgewogICAgdmFyIGlzU3Vic2NyaWJlZCA9IHRydWU7CgogICAgZnVuY3Rpb24gdXBkYXRlRmlsdGVyUXVlcnlGcm9tVmFsdWUoKSB7CiAgICAgIHJldHVybiBfdXBkYXRlRmlsdGVyUXVlcnlGcm9tVmFsdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgIH0KCiAgICBmdW5jdGlvbiBfdXBkYXRlRmlsdGVyUXVlcnlGcm9tVmFsdWUoKSB7CiAgICAgIF91cGRhdGVGaWx0ZXJRdWVyeUZyb21WYWx1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIF9yZWYzLCBmaWx0ZXJzLCBxdWVyeSwgc2F2ZWRJZCwgbXlTYXZlZFF1ZXJ5OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfcmVmMyA9IGZpZWxkLnZhbHVlLCBmaWx0ZXJzID0gX3JlZjMuZmlsdGVycywgcXVlcnkgPSBfcmVmMy5xdWVyeSwgc2F2ZWRJZCA9IF9yZWYzLnNhdmVkX2lkOwoKICAgICAgICAgICAgICAgIGlmICghKDAsIF9mYXN0RGVlcEVxdWFsLmRlZmF1bHQpKHF1ZXJ5LCBxdWVyeURyYWZ0KSkgewogICAgICAgICAgICAgICAgICBzZXRRdWVyeURyYWZ0KHF1ZXJ5KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoISgwLCBfZmFzdERlZXBFcXVhbC5kZWZhdWx0KShmaWx0ZXJzLCBmaWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKSkpIHsKICAgICAgICAgICAgICAgICAgZmlsdGVyTWFuYWdlci5zZXRGaWx0ZXJzKGZpbHRlcnMpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKHNhdmVkSWQgIT0gbnVsbCAmJiBzYXZlZFF1ZXJ5ICE9IG51bGwgJiYgc2F2ZWRJZCAhPT0gc2F2ZWRRdWVyeS5pZCB8fCBzYXZlZElkICE9IG51bGwgJiYgc2F2ZWRRdWVyeSA9PSBudWxsKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSA0OwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gc2F2ZWRRdWVyeVNlcnZpY2VzLmdldFNhdmVkUXVlcnkoc2F2ZWRJZCk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIG15U2F2ZWRRdWVyeSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKGlzU3Vic2NyaWJlZCAmJiBteVNhdmVkUXVlcnkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBzZXRTYXZlZFF1ZXJ5KG15U2F2ZWRRdWVyeSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gMTE7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDQpOwogICAgICAgICAgICAgICAgc2V0U2F2ZWRRdWVyeShudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgaWYgKHNhdmVkSWQgPT0gbnVsbCAmJiBzYXZlZFF1ZXJ5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgc2V0U2F2ZWRRdWVyeShudWxsKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIG51bGwsIFtbNCwgMTFdXSk7CiAgICAgIH0pKTsKICAgICAgcmV0dXJuIF91cGRhdGVGaWx0ZXJRdWVyeUZyb21WYWx1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIHVwZGF0ZUZpbHRlclF1ZXJ5RnJvbVZhbHVlKCk7CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBpc1N1YnNjcmliZWQgPSBmYWxzZTsKICAgIH07CiAgfSwgW2ZpZWxkLnZhbHVlXSk7CiAgdmFyIG9uU3VibWl0UXVlcnkgPSAoMCwgX3JlYWN0LnVzZUNhbGxiYWNrKShmdW5jdGlvbiAobmV3UXVlcnksIHRpbWVmaWx0ZXIpIHsKICAgIHZhciBfcmVmNCA9IGZpZWxkLnZhbHVlLAogICAgICAgIHF1ZXJ5ID0gX3JlZjQucXVlcnk7CgogICAgaWYgKCEoMCwgX2Zhc3REZWVwRXF1YWwuZGVmYXVsdCkocXVlcnksIG5ld1F1ZXJ5KSkgewogICAgICBmaWVsZC5zZXRWYWx1ZShfb2JqZWN0U3ByZWFkKHt9LCBmaWVsZC52YWx1ZSwgewogICAgICAgIHF1ZXJ5OiBuZXdRdWVyeQogICAgICB9KSk7CiAgICB9CiAgfSwgW2ZpZWxkXSk7CiAgdmFyIG9uQ2hhbmdlZFF1ZXJ5ID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKG5ld1F1ZXJ5KSB7CiAgICB2YXIgX3JlZjUgPSBmaWVsZC52YWx1ZSwKICAgICAgICBxdWVyeSA9IF9yZWY1LnF1ZXJ5OwoKICAgIGlmICghKDAsIF9mYXN0RGVlcEVxdWFsLmRlZmF1bHQpKHF1ZXJ5LCBuZXdRdWVyeSkpIHsKICAgICAgZmllbGQuc2V0VmFsdWUoX29iamVjdFNwcmVhZCh7fSwgZmllbGQudmFsdWUsIHsKICAgICAgICBxdWVyeTogbmV3UXVlcnkKICAgICAgfSkpOwogICAgfQogIH0sIFtmaWVsZF0pOwogIHZhciBvblNhdmVkUXVlcnkgPSAoMCwgX3JlYWN0LnVzZUNhbGxiYWNrKShmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeSkgewogICAgaWYgKG5ld1NhdmVkUXVlcnkgIT0gbnVsbCkgewogICAgICB2YXIgX3JlZjYgPSBmaWVsZC52YWx1ZSwKICAgICAgICAgIHNhdmVkSWQgPSBfcmVmNi5zYXZlZF9pZDsKCiAgICAgIGlmIChuZXdTYXZlZFF1ZXJ5LmlkICE9PSBzYXZlZElkKSB7CiAgICAgICAgc2V0U2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5KTsKICAgICAgICBmaWVsZC5zZXRWYWx1ZSh7CiAgICAgICAgICBmaWx0ZXJzOiBuZXdTYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMuZmlsdGVycywKICAgICAgICAgIHF1ZXJ5OiBuZXdTYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnksCiAgICAgICAgICBzYXZlZF9pZDogbmV3U2F2ZWRRdWVyeS5pZAogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfSwgW2ZpZWxkLnZhbHVlXSk7CiAgdmFyIG9uQ2xvc2VUaW1lbGluZU1vZGFsID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKCkgewogICAgc2V0TG9hZGluZ1RpbWVsaW5lKHRydWUpOwogICAgb25DbG9zZVRpbWVsaW5lU2VhcmNoKCk7CiAgfSwgW29uQ2xvc2VUaW1lbGluZVNlYXJjaF0pOwogIHZhciBvbk9wZW5UaW1lbGluZSA9ICgwLCBfcmVhY3QudXNlQ2FsbGJhY2spKGZ1bmN0aW9uICh0aW1lbGluZSkgewogICAgdmFyIF9yZWY3LCBfdGltZWxpbmUka3FsUXVlcnkkZmksIF90aW1lbGluZSRrcWxRdWVyeSRmaTIsIF9yZWY4LCBfdGltZWxpbmUka3FsUXVlcnkkZmkzLCBfdGltZWxpbmUka3FsUXVlcnkkZmk0LCBfdGltZWxpbmUkZmlsdGVyczsKCiAgICBzZXRMb2FkaW5nVGltZWxpbmUoZmFsc2UpOwogICAgdmFyIG5ld1F1ZXJ5ID0gewogICAgICBxdWVyeTogKF9yZWY3ID0gKF90aW1lbGluZSRrcWxRdWVyeSRmaSA9IHRpbWVsaW5lLmtxbFF1ZXJ5LmZpbHRlclF1ZXJ5KSA9PT0gbnVsbCB8fCBfdGltZWxpbmUka3FsUXVlcnkkZmkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfdGltZWxpbmUka3FsUXVlcnkkZmkyID0gX3RpbWVsaW5lJGtxbFF1ZXJ5JGZpLmt1ZXJ5KSA9PT0gbnVsbCB8fCBfdGltZWxpbmUka3FsUXVlcnkkZmkyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGltZWxpbmUka3FsUXVlcnkkZmkyLmV4cHJlc3Npb24pICE9PSBudWxsICYmIF9yZWY3ICE9PSB2b2lkIDAgPyBfcmVmNyA6ICcnLAogICAgICBsYW5ndWFnZTogKF9yZWY4ID0gKF90aW1lbGluZSRrcWxRdWVyeSRmaTMgPSB0aW1lbGluZS5rcWxRdWVyeS5maWx0ZXJRdWVyeSkgPT09IG51bGwgfHwgX3RpbWVsaW5lJGtxbFF1ZXJ5JGZpMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aW1lbGluZSRrcWxRdWVyeSRmaTQgPSBfdGltZWxpbmUka3FsUXVlcnkkZmkzLmt1ZXJ5KSA9PT0gbnVsbCB8fCBfdGltZWxpbmUka3FsUXVlcnkkZmk0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGltZWxpbmUka3FsUXVlcnkkZmk0LmtpbmQpICE9PSBudWxsICYmIF9yZWY4ICE9PSB2b2lkIDAgPyBfcmVmOCA6ICdrdWVyeScKICAgIH07CiAgICB2YXIgZGF0YVByb3ZpZGVyc0RzbCA9IHRpbWVsaW5lLmRhdGFQcm92aWRlcnMgIT0gbnVsbCAmJiB0aW1lbGluZS5kYXRhUHJvdmlkZXJzLmxlbmd0aCA+IDAgPyAoMCwgX2tldXJ5LmNvbnZlcnRLdWVyeVRvRWxhc3RpY1NlYXJjaFF1ZXJ5KSgoMCwgX2hlbHBlcnMuYnVpbGRHbG9iYWxRdWVyeSkodGltZWxpbmUuZGF0YVByb3ZpZGVycywgYnJvd3NlckZpZWxkcyksIGluZGV4UGF0dGVybikgOiAnJzsKICAgIHZhciBuZXdGaWx0ZXJzID0gKF90aW1lbGluZSRmaWx0ZXJzID0gdGltZWxpbmUuZmlsdGVycykgIT09IG51bGwgJiYgX3RpbWVsaW5lJGZpbHRlcnMgIT09IHZvaWQgMCA/IF90aW1lbGluZSRmaWx0ZXJzIDogW107CiAgICBmaWVsZC5zZXRWYWx1ZSh7CiAgICAgIGZpbHRlcnM6IGRhdGFQcm92aWRlcnNEc2wgIT09ICcnID8gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShuZXdGaWx0ZXJzKSwgWygwLCBfcXVlcnlfYmFyMi5nZXREYXRhUHJvdmlkZXJGaWx0ZXIpKGRhdGFQcm92aWRlcnNEc2wpXSkgOiBuZXdGaWx0ZXJzLAogICAgICBxdWVyeTogbmV3UXVlcnksCiAgICAgIHNhdmVkX2lkOiAnJwogICAgfSk7CiAgfSwgW2Jyb3dzZXJGaWVsZHMsIGZpZWxkLCBpbmRleFBhdHRlcm5dKTsKCiAgdmFyIG9uTXV0YXRpb24gPSBmdW5jdGlvbiBvbk11dGF0aW9uKGV2ZW50LCBvYnNlcnZlcikgewogICAgaWYgKHJlc2l6ZVBhcmVudENvbnRhaW5lciAhPSBudWxsKSB7CiAgICAgIHZhciBzdWdnZXN0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2tiblR5cGVhaGVhZF9faXRlbXMnKTsKCiAgICAgIGlmIChzdWdnZXN0aW9uQ29udGFpbmVyICE9IG51bGwpIHsKICAgICAgICB2YXIgYm94ID0gc3VnZ2VzdGlvbkNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICB2YXIgYWNjb3JkaW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlZmluZS1ydWxlJyk7CgogICAgICAgIGlmIChhY2NvcmRpb25Db250YWluZXIgIT0gbnVsbCkgewogICAgICAgICAgdmFyIGFjY29yZGlvbkJveCA9IGFjY29yZGlvbkNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgICAgICBpZiAob3JpZ2luYWxIZWlnaHQgPT09IC0xIHx8IGFjY29yZGlvbkJveC5oZWlnaHQgPCBvcmlnaW5hbEhlaWdodCArIGJveC5oZWlnaHQpIHsKICAgICAgICAgICAgcmVzaXplUGFyZW50Q29udGFpbmVyKG9yaWdpbmFsSGVpZ2h0ICsgYm94LmhlaWdodCAtIDEwMCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG9yaWdpbmFsSGVpZ2h0ID09PSAtMSkgewogICAgICAgICAgICBzZXRPcmlnaW5hbEhlaWdodChhY2NvcmRpb25Cb3guaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzaXplUGFyZW50Q29udGFpbmVyKC0xKTsKICAgICAgfQogICAgfQogIH07CgogIHZhciBhY3Rpb25UaW1lbGluZVRvSGlkZSA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIFsnZHVwbGljYXRlJ107CiAgfSwgW10pOwogIHJldHVybiBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KFN0eWxlZEV1aUZvcm1Sb3csIHsKICAgIGxhYmVsOiBmaWVsZC5sYWJlbCwKICAgIGxhYmVsQXBwZW5kOiBmaWVsZC5sYWJlbEFwcGVuZCwKICAgIGhlbHBUZXh0OiBmaWVsZC5oZWxwVGV4dCwKICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsCiAgICBpc0ludmFsaWQ6IGlzSW52YWxpZCwKICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgICJkYXRhLXRlc3Qtc3ViaiI6IGRhdGFUZXN0U3ViaiwKICAgIGRlc2NyaWJlZEJ5SWRzOiBpZEFyaWEgPyBbaWRBcmlhXSA6IHVuZGVmaW5lZAogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlNdXRhdGlvbk9ic2VydmVyLCB7CiAgICBvYnNlcnZlck9wdGlvbnM6IHsKICAgICAgc3VidHJlZTogdHJ1ZSwKICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICB9LAogICAgb25NdXRhdGlvbjogb25NdXRhdGlvbgogIH0sIGZ1bmN0aW9uIChtdXRhdGlvblJlZikgewogICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgcmVmOiBtdXRhdGlvblJlZgogICAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcXVlcnlfYmFyLlF1ZXJ5QmFyLCB7CiAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuLAogICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZyB8fCBsb2FkaW5nVGltZWxpbmUsCiAgICAgIGlzUmVmcmVzaFBhdXNlZDogZmFsc2UsCiAgICAgIGZpbHRlclF1ZXJ5OiBxdWVyeURyYWZ0LAogICAgICBmaWx0ZXJNYW5hZ2VyOiBmaWx0ZXJNYW5hZ2VyLAogICAgICBmaWx0ZXJzOiBmaWx0ZXJNYW5hZ2VyLmdldEZpbHRlcnMoKSB8fCBbXSwKICAgICAgb25DaGFuZ2VkUXVlcnk6IG9uQ2hhbmdlZFF1ZXJ5LAogICAgICBvblN1Ym1pdFF1ZXJ5OiBvblN1Ym1pdFF1ZXJ5LAogICAgICBzYXZlZFF1ZXJ5OiBzYXZlZFF1ZXJ5LAogICAgICBvblNhdmVkUXVlcnk6IG9uU2F2ZWRRdWVyeSwKICAgICAgaGlkZVNhdmVkUXVlcnk6IGZhbHNlCiAgICB9KSk7CiAgfSkpLCBvcGVuVGltZWxpbmVTZWFyY2ggPyBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9vcGVuX3RpbWVsaW5lX21vZGFsLk9wZW5UaW1lbGluZU1vZGFsLCB7CiAgICBoaWRlQWN0aW9uczogYWN0aW9uVGltZWxpbmVUb0hpZGUsCiAgICBtb2RhbFRpdGxlOiBpMThuLklNUE9SVF9USU1FTElORV9NT0RBTCwKICAgIG9uQ2xvc2U6IG9uQ2xvc2VUaW1lbGluZU1vZGFsLAogICAgb25PcGVuOiBvbk9wZW5UaW1lbGluZQogIH0pIDogbnVsbCk7Cn07CgpleHBvcnRzLlF1ZXJ5QmFyRGVmaW5lUnVsZSA9IFF1ZXJ5QmFyRGVmaW5lUnVsZTs="},null]}