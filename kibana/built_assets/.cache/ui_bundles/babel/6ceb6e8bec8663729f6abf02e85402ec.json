{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/vis_type_vega/public/data_model/vega_parser.js","dependencies":[{"path":"src/legacy/core_plugins/vis_type_vega/public/data_model/vega_parser.js","mtime":1589249550082},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlZlZ2FQYXJzZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgibG9kYXNoIikpOwoKdmFyIHZlZ2EgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJ2ZWdhLWxpYiIpKTsKCnZhciB2ZWdhTGl0ZSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoInZlZ2EtbGl0ZSIpKTsKCnZhciBfdmVnYVNjaGVtYVVybFBhcnNlciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgidmVnYS1zY2hlbWEtdXJsLXBhcnNlciIpKTsKCnZhciBfY29tcGFyZVZlcnNpb25zID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJjb21wYXJlLXZlcnNpb25zIikpOwoKdmFyIF9lc19xdWVyeV9wYXJzZXIgPSByZXF1aXJlKCIuL2VzX3F1ZXJ5X3BhcnNlciIpOwoKdmFyIF9oanNvbiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiaGpzb24iKSk7Cgp2YXIgX3V0aWxzID0gcmVxdWlyZSgiLi91dGlscyIpOwoKdmFyIF9lbXNfZmlsZV9wYXJzZXIgPSByZXF1aXJlKCIuL2Vtc19maWxlX3BhcnNlciIpOwoKdmFyIF91cmxfcGFyc2VyID0gcmVxdWlyZSgiLi91cmxfcGFyc2VyIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9pMThuID0gcmVxdWlyZSgiQGtibi9pMThuIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfQoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7IHRyeSB7IHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsgfSBjYXRjaCAoZXJyb3IpIHsgcmVqZWN0KGVycm9yKTsgcmV0dXJuOyB9IGlmIChpbmZvLmRvbmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0gZWxzZSB7IFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsgfSB9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCi8vIFNldCBkZWZhdWx0IHNpbmdsZSBjb2xvciB0byBtYXRjaCBvdGhlciBLaWJhbmEgdmlzdWFsaXphdGlvbnMKdmFyIGRlZmF1bHRDb2xvciA9IF9ldWkuVklTVUFMSVpBVElPTl9DT0xPUlNbMF07CnZhciBERUZBVUxUX1NDSEVNQSA9ICdodHRwczovL3ZlZ2EuZ2l0aHViLmlvL3NjaGVtYS92ZWdhL3YzLjAuanNvbic7CnZhciBsb2NUb0Rpck1hcCA9IHsKICBsZWZ0OiAncm93LXJldmVyc2UnLAogIHJpZ2h0OiAncm93JywKICB0b3A6ICdjb2x1bW4tcmV2ZXJzZScsCiAgYm90dG9tOiAnY29sdW1uJwp9OyAvLyBJZiB0aGVyZSBpcyBubyAiJXR5cGUlIiBwYXJhbWV0ZXIsIHVzZSB0aGlzIHBhcnNlcgoKdmFyIERFRkFVTFRfUEFSU0VSID0gJ2VsYXN0aWNzZWFyY2gnOwoKdmFyIFZlZ2FQYXJzZXIgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBWZWdhUGFyc2VyKHNwZWMsIHNlYXJjaENhY2hlLCB0aW1lQ2FjaGUsIGZpbHRlcnMsIHNlcnZpY2VTZXR0aW5ncykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZlZ2FQYXJzZXIpOwoKICAgIHRoaXMuc3BlYyA9IHNwZWM7CiAgICB0aGlzLmhpZGVXYXJuaW5ncyA9IGZhbHNlOwogICAgdGhpcy5lcnJvciA9IHVuZGVmaW5lZDsKICAgIHRoaXMud2FybmluZ3MgPSBbXTsKCiAgICB2YXIgb25XYXJuID0gdGhpcy5fb25XYXJuaW5nLmJpbmQodGhpcyk7CgogICAgdGhpcy5fdXJsUGFyc2VycyA9IHsKICAgICAgZWxhc3RpY3NlYXJjaDogbmV3IF9lc19xdWVyeV9wYXJzZXIuRXNRdWVyeVBhcnNlcih0aW1lQ2FjaGUsIHNlYXJjaENhY2hlLCBmaWx0ZXJzLCBvbldhcm4pLAogICAgICBlbXNmaWxlOiBuZXcgX2Vtc19maWxlX3BhcnNlci5FbXNGaWxlUGFyc2VyKHNlcnZpY2VTZXR0aW5ncyksCiAgICAgIHVybDogbmV3IF91cmxfcGFyc2VyLlVybFBhcnNlcihvbldhcm4pCiAgICB9OwogIH0KCiAgX2NyZWF0ZUNsYXNzKFZlZ2FQYXJzZXIsIFt7CiAgICBrZXk6ICJwYXJzZUFzeW5jIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcGFyc2VBc3luYzIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAgICAgLyojX19QVVJFX18qLwogICAgICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAwOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFyc2VBc3luYygpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gODsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfY29udGV4dC5wcmV2ID0gNTsKICAgICAgICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMCk7CiAgICAgICAgICAgICAgICAvLyBpZiB3ZSByZWplY3QgY3VycmVudCBwcm9taXNlLCBpdCB3aWxsIHVzZSB0aGUgc3RhbmRhcmQgS2liYW5hIGVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgICAgICB0aGlzLmVycm9yID0gX3V0aWxzLlV0aWxzLmZvcm1hdEVycm9yVG9TdHIoX2NvbnRleHQudDApOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCB0aGlzKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcywgW1swLCA1XV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwYXJzZUFzeW5jKCkgewogICAgICAgIHJldHVybiBfcGFyc2VBc3luYzIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBhcnNlQXN5bmM7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfcGFyc2VBc3luYyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3BhcnNlQXN5bmMzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgICAgIC8qI19fUFVSRV9fKi8KICAgICAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlmICghKHRoaXMuaXNWZWdhTGl0ZSAhPT0gdW5kZWZpbmVkKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuc3BlYyA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zcGVjID0gX2hqc29uLmRlZmF1bHQucGFyc2UodGhpcy5zcGVjLCB7CiAgICAgICAgICAgICAgICAgICAgbGVnYWN5Um9vdDogZmFsc2UKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KHRoaXMuc3BlYykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuaW52YWxpZFZlZ2FTcGVjRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0ludmFsaWQgVmVnYSBzcGVjaWZpY2F0aW9uJwogICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICB0aGlzLmlzVmVnYUxpdGUgPSB0aGlzLl9wYXJzZVNjaGVtYSgpOwogICAgICAgICAgICAgICAgdGhpcy51c2VIb3ZlciA9ICF0aGlzLmlzVmVnYUxpdGU7CiAgICAgICAgICAgICAgICB0aGlzLl9jb25maWcgPSB0aGlzLl9wYXJzZUNvbmZpZygpOwogICAgICAgICAgICAgICAgdGhpcy5oaWRlV2FybmluZ3MgPSAhIXRoaXMuX2NvbmZpZy5oaWRlV2FybmluZ3M7CiAgICAgICAgICAgICAgICB0aGlzLnVzZU1hcCA9IHRoaXMuX2NvbmZpZy50eXBlID09PSAnbWFwJzsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSB0aGlzLl9jb25maWcucmVuZGVyZXIgPT09ICdzdmcnID8gJ3N2ZycgOiAnY2FudmFzJzsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcHMgPSB0aGlzLl9wYXJzZVRvb2x0aXBzKCk7CgogICAgICAgICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdENvbG9ycygpOwoKICAgICAgICAgICAgICAgIHRoaXMuX3BhcnNlQ29udHJvbFBsYWNlbWVudCh0aGlzLl9jb25maWcpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzZU1hcCkgewogICAgICAgICAgICAgICAgICB0aGlzLm1hcENvbmZpZyA9IHRoaXMuX3BhcnNlTWFwQ29uZmlnKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3BlYy5hdXRvc2l6ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgYXV0b3NpemUgc2hvdWxkIGJlIGZpdCwgdW5sZXNzIGl0J3MgYSBtYXAgKGxlYWZsZXQtdmVnYSBoYW5kbGVzIHRoYXQpCiAgICAgICAgICAgICAgICAgIHRoaXMuc3BlYy5hdXRvc2l6ZSA9IHsKICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZml0JywKICAgICAgICAgICAgICAgICAgICBjb250YWluczogJ3BhZGRpbmcnCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZXNvbHZlRGF0YVVybHMoKTsKCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzVmVnYUxpdGUpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fY29tcGlsZVZlZ2FMaXRlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5fY2FsY1NpemluZygpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gX3BhcnNlQXN5bmMoKSB7CiAgICAgICAgcmV0dXJuIF9wYXJzZUFzeW5jMy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gX3BhcnNlQXN5bmM7CiAgICB9KCkKICAgIC8qKgogICAgICogQ29udmVydCBWZWdhTGl0ZSB0byBWZWdhIHNwZWMKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2NvbXBpbGVWZWdhTGl0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NvbXBpbGVWZWdhTGl0ZSgpIHsKICAgICAgdGhpcy52bHNwZWMgPSB0aGlzLnNwZWM7CiAgICAgIHZhciBsb2dnZXIgPSB2ZWdhLmxvZ2dlcih2ZWdhLldhcm4pOwogICAgICBsb2dnZXIud2FybiA9IHRoaXMuX29uV2FybmluZy5iaW5kKHRoaXMpOwogICAgICB0aGlzLnNwZWMgPSB2ZWdhTGl0ZS5jb21waWxlKHRoaXMudmxzcGVjLCBsb2dnZXIpLnNwZWM7IC8vIFdoZW4gdXNpbmcgVkwgd2l0aCB0aGUgdHlwZT1tYXAgYW5kIHVzZXIgZGlkIG5vdCBwcm92aWQgdGhlaXIgb3duIHByb2plY3Rpb24gc2V0dGluZ3MsCiAgICAgIC8vIHJlbW92ZSB0aGUgZGVmYXVsdCBwcm9qZWN0aW9uIHRoYXQgd2FzIGdlbmVyYXRlZCBieSBWZWdhTGl0ZSBjb21waWxlci4KICAgICAgLy8gVGhpcyB3YXkgd2UgbGV0IGxlYWZsZXQtdmVnYSBsaWJyYXJ5IGluamVjdCBhIGRpZmZlcmVudCBkZWZhdWx0IHByb2plY3Rpb24gZm9yIHRpbGUgbWFwcy4KICAgICAgLy8gQWxzbywgVkwgaW5qZWN0cyBkZWZhdWx0IHBhZGRpbmcgYW5kIGF1dG9zaXplIHZhbHVlcywgYnV0IG5laXRoZXIgc2hvdWxkIGJlIHNldCBmb3IgdmVnYS1sZWFmbGV0LgoKICAgICAgaWYgKHRoaXMudXNlTWFwKSB7CiAgICAgICAgdmFyIGhhc0NvbmZpZyA9IF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KHRoaXMudmxzcGVjLmNvbmZpZyk7CgogICAgICAgIGlmICh0aGlzLnZsc3BlYy5jb25maWcgPT09IHVuZGVmaW5lZCB8fCBoYXNDb25maWcgJiYgIXRoaXMudmxzcGVjLmNvbmZpZy5wcm9qZWN0aW9uKSB7CiAgICAgICAgICAvLyBBc3N1bWUgVkwgZ2VuZXJhdGVzIHNwZWMucHJvamVjdGlvbnMgPSBhbiBhcnJheSBvZiBleGFjdGx5IG9uZSBvYmplY3QgbmFtZWQgJ3Byb2plY3Rpb24nCiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5zcGVjLnByb2plY3Rpb25zKSB8fCB0aGlzLnNwZWMucHJvamVjdGlvbnMubGVuZ3RoICE9PSAxIHx8IHRoaXMuc3BlYy5wcm9qZWN0aW9uc1swXS5uYW1lICE9PSAncHJvamVjdGlvbicpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLlZMQ29tcGlsZXJTaG91bGRIYXZlR2VuZXJhdGVkU2luZ2xlUHJvdGVjdGlvbk9iamVjdEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ0ludGVybmFsIGVycm9yOiBWZWdhLUxpdGUgY29tcGlsZXIgc2hvdWxkIGhhdmUgZ2VuZXJhdGVkIGEgc2luZ2xlIHByb2plY3Rpb24gb2JqZWN0JwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy5wcm9qZWN0aW9uczsKICAgICAgICB9IC8vIHRvZG86IHNpemluZyBjbGVhbnVwIG1pZ2h0IG5lZWQgdG8gYmUgcmV0aG91Z2h0IGFuZCBjb25zb2xpZGF0ZWQKCgogICAgICAgIGlmICghdGhpcy52bHNwZWMud2lkdGgpIGRlbGV0ZSB0aGlzLnNwZWMud2lkdGg7CiAgICAgICAgaWYgKCF0aGlzLnZsc3BlYy5oZWlnaHQpIGRlbGV0ZSB0aGlzLnNwZWMuaGVpZ2h0OwoKICAgICAgICBpZiAoIXRoaXMudmxzcGVjLnBhZGRpbmcgJiYgKHRoaXMudmxzcGVjLmNvbmZpZyA9PT0gdW5kZWZpbmVkIHx8IGhhc0NvbmZpZyAmJiAhdGhpcy52bHNwZWMuY29uZmlnLnBhZGRpbmcpKSB7CiAgICAgICAgICBkZWxldGUgdGhpcy5zcGVjLnBhZGRpbmc7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXRoaXMudmxzcGVjLmF1dG9zaXplICYmICh0aGlzLnZsc3BlYy5jb25maWcgPT09IHVuZGVmaW5lZCB8fCBoYXNDb25maWcgJiYgIXRoaXMudmxzcGVjLmNvbmZpZy5hdXRvc2l6ZSkpIHsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnNwZWMuYXV0b3NpemU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFByb2Nlc3MgZ3JhcGggc2l6ZSBhbmQgcGFkZGluZwogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfY2FsY1NpemluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2NhbGNTaXppbmcoKSB7CiAgICAgIHRoaXMudXNlUmVzaXplID0gZmFsc2U7CgogICAgICBpZiAoIXRoaXMudXNlTWFwKSB7CiAgICAgICAgLy8gd2hlbiB1c2VSZXNpemUgaXMgdHJ1ZSwgdmVnYSdzIGNhbnZhcyBzaXplIHdpbGwgYmUgc2V0IGJhc2VkIG9uIHRoZSBzaXplIG9mIHRoZSBjb250YWluZXIsCiAgICAgICAgLy8gYW5kIHdpbGwgYmUgYXV0b21hdGljYWxseSB1cGRhdGVkIG9uIHJlc2l6ZSBldmVudHMuCiAgICAgICAgLy8gV2UgZGVsZXRlIHdpZHRoICYgaGVpZ2h0IGlmIHRoZSBhdXRvc2l6ZSBpcyBzZXQgdG8gImZpdCIKICAgICAgICAvLyBXZSBhbHNvIHNldCB1c2VSZXNpemU9dHJ1ZSBpbiBjYXNlIGF1dG9zaXplPW5vbmUsIGFuZCB3aWR0aCAmIGhlaWdodCBhcmUgbm90IHNldAogICAgICAgIHZhciBhdXRvc2l6ZSA9IHRoaXMuc3BlYy5hdXRvc2l6ZS50eXBlIHx8IHRoaXMuc3BlYy5hdXRvc2l6ZTsKCiAgICAgICAgaWYgKGF1dG9zaXplID09PSAnZml0JyB8fCBhdXRvc2l6ZSA9PT0gJ25vbmUnICYmICF0aGlzLnNwZWMud2lkdGggJiYgIXRoaXMuc3BlYy5oZWlnaHQpIHsKICAgICAgICAgIHRoaXMudXNlUmVzaXplID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gLy8gUGFkZGluZyBpcyBub3QgaW5jbHVkZWQgaW4gdGhlIHdpZHRoL2hlaWdodCBieSBkZWZhdWx0CgoKICAgICAgdGhpcy5wYWRkaW5nV2lkdGggPSAwOwogICAgICB0aGlzLnBhZGRpbmdIZWlnaHQgPSAwOwoKICAgICAgaWYgKHRoaXMudXNlUmVzaXplICYmIHRoaXMuc3BlYy5wYWRkaW5nICYmIHRoaXMuc3BlYy5hdXRvc2l6ZS5jb250YWlucyAhPT0gJ3BhZGRpbmcnKSB7CiAgICAgICAgaWYgKF90eXBlb2YodGhpcy5zcGVjLnBhZGRpbmcpID09PSAnb2JqZWN0JykgewogICAgICAgICAgdGhpcy5wYWRkaW5nV2lkdGggKz0gKCt0aGlzLnNwZWMucGFkZGluZy5sZWZ0IHx8IDApICsgKCt0aGlzLnNwZWMucGFkZGluZy5yaWdodCB8fCAwKTsKICAgICAgICAgIHRoaXMucGFkZGluZ0hlaWdodCArPSAoK3RoaXMuc3BlYy5wYWRkaW5nLnRvcCB8fCAwKSArICgrdGhpcy5zcGVjLnBhZGRpbmcuYm90dG9tIHx8IDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnBhZGRpbmdXaWR0aCArPSAyICogKCt0aGlzLnNwZWMucGFkZGluZyB8fCAwKTsKICAgICAgICAgIHRoaXMucGFkZGluZ0hlaWdodCArPSAyICogKCt0aGlzLnNwZWMucGFkZGluZyB8fCAwKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnVzZVJlc2l6ZSAmJiAodGhpcy5zcGVjLndpZHRoIHx8IHRoaXMuc3BlYy5oZWlnaHQpKSB7CiAgICAgICAgaWYgKHRoaXMuaXNWZWdhTGl0ZSkgewogICAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy53aWR0aDsKICAgICAgICAgIGRlbGV0ZSB0aGlzLnNwZWMuaGVpZ2h0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIud2lkdGhBbmRIZWlnaHRQYXJhbXNBcmVJZ25vcmVkV2l0aEF1dG9zaXplRml0V2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVGhlIHt3aWR0aFBhcmFtfSBhbmQge2hlaWdodFBhcmFtfSBwYXJhbXMgYXJlIGlnbm9yZWQgd2l0aCB7YXV0b3NpemVQYXJhbX0nLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBhdXRvc2l6ZVBhcmFtOiAnYXV0b3NpemU9Zml0JywKICAgICAgICAgICAgICB3aWR0aFBhcmFtOiAnIndpZHRoIicsCiAgICAgICAgICAgICAgaGVpZ2h0UGFyYW06ICciaGVpZ2h0IicKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgY29udGFpbmVyLWRpcmVjdGlvbiBDU1MgcHJvcGVydHkgZm9yIGJpbmRpbmcgcGxhY2VtZW50CiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9wYXJzZUNvbnRyb2xQbGFjZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZUNvbnRyb2xQbGFjZW1lbnQoKSB7CiAgICAgIHRoaXMuY29udGFpbmVyRGlyID0gbG9jVG9EaXJNYXBbdGhpcy5fY29uZmlnLmNvbnRyb2xzTG9jYXRpb25dOwoKICAgICAgaWYgKHRoaXMuY29udGFpbmVyRGlyID09PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAodGhpcy5fY29uZmlnLmNvbnRyb2xzTG9jYXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgdGhpcy5jb250YWluZXJEaXIgPSAnY29sdW1uJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLnVucmVjb2duaXplZENvbnRyb2xzTG9jYXRpb25WYWx1ZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbnJlY29nbml6ZWQge2NvbnRyb2xzTG9jYXRpb25QYXJhbX0gdmFsdWUuIEV4cGVjdGluZyBvbmUgb2YgW3tsb2NUb0Rpck1hcH1dJywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgbG9jVG9EaXJNYXA6ICJcIiIuY29uY2F0KGxvY1RvRGlyTWFwLmtleXMoKS5qb2luKCciLCAiJyksICJcIiIpLAogICAgICAgICAgICAgIGNvbnRyb2xzTG9jYXRpb25QYXJhbTogJ2NvbnRyb2xzTG9jYXRpb24nCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBkaXIgPSB0aGlzLl9jb25maWcuY29udHJvbHNEaXJlY3Rpb247CgogICAgICBpZiAoZGlyICE9PSB1bmRlZmluZWQgJiYgZGlyICE9PSAnaG9yaXpvbnRhbCcgJiYgZGlyICE9PSAndmVydGljYWwnKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLnVucmVjb2duaXplZERpclZhbHVlRXJyb3JNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdVbnJlY29nbml6ZWQge2RpclBhcmFtfSB2YWx1ZS4gRXhwZWN0aW5nIG9uZSBvZiBbe2V4cGVjdGVkVmFsdWVzfV0nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGV4cGVjdGVkVmFsdWVzOiAnImhvcml6b250YWwiLCAidmVydGljYWwiJywKICAgICAgICAgICAgZGlyUGFyYW06ICdkaXInCiAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgICB9CgogICAgICB0aGlzLmNvbnRyb2xzRGlyID0gZGlyID09PSAnaG9yaXpvbnRhbCcgPyAncm93JyA6ICdjb2x1bW4nOwogICAgfQogICAgLyoqCiAgICAgKiBQYXJzZSB7Y29uZmlnOiBraWJhbmE6IHsuLi59fSBwb3J0aW9uIG9mIHRoZSBWZWdhIHNwZWMgKG9yIHJvb3QtbGV2ZWwgX2hvc3RDb25maWcgZm9yIGJhY2t3YXJkIGNvbXBhdCkKICAgICAqIEByZXR1cm5zIHtvYmplY3R9IGtpYmFuYSBjb25maWcKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3BhcnNlQ29uZmlnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VDb25maWcoKSB7CiAgICAgIHZhciByZXN1bHQ7CgogICAgICBpZiAodGhpcy5zcGVjLl9ob3N0Q29uZmlnICE9PSB1bmRlZmluZWQpIHsKICAgICAgICByZXN1bHQgPSB0aGlzLnNwZWMuX2hvc3RDb25maWc7CiAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy5faG9zdENvbmZpZzsKCiAgICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdChyZXN1bHQpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuaG9zdENvbmZpZ1ZhbHVlVHlwZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdJZiBwcmVzZW50LCB7Y29uZmlnTmFtZX0gbXVzdCBiZSBhbiBvYmplY3QnLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBjb25maWdOYW1lOiAnIl9ob3N0Q29uZmlnIicKICAgICAgICAgICAgfQogICAgICAgICAgfSkpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5fb25XYXJuaW5nKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLmhvc3RDb25maWdJc0RlcHJlY2F0ZWRXYXJuaW5nTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne2RlcHJlY2F0ZWRDb25maWdOYW1lfSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2Uge25ld0NvbmZpZ05hbWV9IGluc3RlYWQuJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBkZXByZWNhdGVkQ29uZmlnTmFtZTogJyJfaG9zdENvbmZpZyInLAogICAgICAgICAgICBuZXdDb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYScKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGlmIChfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdCh0aGlzLnNwZWMuY29uZmlnKSAmJiB0aGlzLnNwZWMuY29uZmlnLmtpYmFuYSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmVzdWx0ID0gdGhpcy5zcGVjLmNvbmZpZy5raWJhbmE7CiAgICAgICAgZGVsZXRlIHRoaXMuc3BlYy5jb25maWcua2liYW5hOwoKICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KHJlc3VsdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5raWJhbmFDb25maWdWYWx1ZVR5cGVFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnSWYgcHJlc2VudCwge2NvbmZpZ05hbWV9IG11c3QgYmUgYW4gb2JqZWN0JywKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgY29uZmlnTmFtZTogJ2NvbmZpZy5raWJhbmEnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQgfHwge307CiAgICB9CiAgfSwgewogICAga2V5OiAiX3BhcnNlVG9vbHRpcHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wYXJzZVRvb2x0aXBzKCkgewogICAgICBpZiAodGhpcy5fY29uZmlnLnRvb2x0aXBzID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2NvbmZpZy50b29sdGlwcyB8fCB7fTsKCiAgICAgIGlmIChyZXN1bHQucG9zaXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJlc3VsdC5wb3NpdGlvbiA9ICd0b3AnOwogICAgICB9IGVsc2UgaWYgKFsndG9wJywgJ3JpZ2h0JywgJ2JvdHRvbScsICdsZWZ0J10uaW5kZXhPZihyZXN1bHQucG9zaXRpb24pID09PSAtMSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci51bmV4cGVjdGVkVmFsdWVGb3JQb3NpdGlvbkNvbmZpZ3VyYXRpb25FcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1VuZXhwZWN0ZWQgdmFsdWUgZm9yIHRoZSB7Y29uZmlndXJhdGlvbk5hbWV9IGNvbmZpZ3VyYXRpb24nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25OYW1lOiAncmVzdWx0LnBvc2l0aW9uJwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgaWYgKHJlc3VsdC5wYWRkaW5nID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXN1bHQucGFkZGluZyA9IDE2OwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXN1bHQucGFkZGluZyAhPT0gJ251bWJlcicpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIucGFkZGluZ0NvbmZpZ1ZhbHVlVHlwZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne2NvbmZpZ05hbWV9IGlzIGV4cGVjdGVkIHRvIGJlIGEgbnVtYmVyJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBjb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYS5yZXN1bHQucGFkZGluZycKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGlmIChyZXN1bHQuY2VudGVyT25NYXJrID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyBpZiBtYXJrJ3Mgd2lkdGggJiBoZWlnaHQgaXMgbGVzcyB0aGFuIHRoaXMgdmFsdWUsIGNlbnRlciBvbiBpdAogICAgICAgIHJlc3VsdC5jZW50ZXJPbk1hcmsgPSA1MDsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzdWx0LmNlbnRlck9uTWFyayA9PT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgcmVzdWx0LmNlbnRlck9uTWFyayA9IHJlc3VsdC5jZW50ZXJPbk1hcmsgPyBOdW1iZXIuTUFYX1ZBTFVFIDogLTE7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3VsdC5jZW50ZXJPbk1hcmsgIT09ICdudW1iZXInKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLmNlbnRlck9uTWFya0NvbmZpZ1ZhbHVlVHlwZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne2NvbmZpZ05hbWV9IGlzIGV4cGVjdGVkIHRvIGJlIHt0cnVlVmFsdWV9LCB7ZmFsc2VWYWx1ZX0sIG9yIGEgbnVtYmVyJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBjb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYS5yZXN1bHQuY2VudGVyT25NYXJrJywKICAgICAgICAgICAgdHJ1ZVZhbHVlOiAndHJ1ZScsCiAgICAgICAgICAgIGZhbHNlVmFsdWU6ICdmYWxzZScKICAgICAgICAgIH0KICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIFBhcnNlIG1hcC1zcGVjaWZpYyBjb25maWd1cmF0aW9uCiAgICAgKiBAcmV0dXJucyB7e21hcFN0eWxlOiAqfHN0cmluZywgZGVsYXlSZXBhaW50OiBib29sZWFuLCBsYXRpdHVkZTogbnVtYmVyLCBsb25naXR1ZGU6IG51bWJlciwgem9vbSwgbWluWm9vbSwgbWF4Wm9vbSwgem9vbUNvbnRyb2w6ICp8Ym9vbGVhbiwgbWF4Qm91bmRzOiAqfX0KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3BhcnNlTWFwQ29uZmlnIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VNYXBDb25maWcoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmVzID0gewogICAgICAgIGRlbGF5UmVwYWludDogdGhpcy5fY29uZmlnLmRlbGF5UmVwYWludCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IHRoaXMuX2NvbmZpZy5kZWxheVJlcGFpbnQKICAgICAgfTsKCiAgICAgIHZhciB2YWxpZGF0ZSA9IGZ1bmN0aW9uIHZhbGlkYXRlKG5hbWUsIGlzWm9vbSkgewogICAgICAgIHZhciB2YWwgPSBfdGhpcy5fY29uZmlnW25hbWVdOwoKICAgICAgICBpZiAodmFsICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHZhciBwYXJzZWQgPSBwYXJzZUZsb2F0KHZhbCk7CgogICAgICAgICAgaWYgKE51bWJlci5pc0Zpbml0ZShwYXJzZWQpICYmICghaXNab29tIHx8IHBhcnNlZCA+PSAwICYmIHBhcnNlZCA8PSAzMCkpIHsKICAgICAgICAgICAgcmVzW25hbWVdID0gcGFyc2VkOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuX29uV2FybmluZyhfaTE4bi5pMThuLnRyYW5zbGF0ZSgndmlzVHlwZVZlZ2EudmVnYVBhcnNlci5zb21lS2liYW5hQ29uZmlndXJhdGlvbklzTm9WYWxpZFdhcm5pbmdNZXNzYWdlJywgewogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ3tjb25maWdOYW1lfSBpcyBub3QgdmFsaWQnLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBjb25maWdOYW1lOiAiY29uZmlnLmtpYmFuYS4iLmNvbmNhdChuYW1lKQogICAgICAgICAgICB9CiAgICAgICAgICB9KSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIWlzWm9vbSkgcmVzW25hbWVdID0gMDsKICAgICAgfTsKCiAgICAgIHZhbGlkYXRlKCJsYXRpdHVkZSIsIGZhbHNlKTsKICAgICAgdmFsaWRhdGUoImxvbmdpdHVkZSIsIGZhbHNlKTsKICAgICAgdmFsaWRhdGUoInpvb20iLCB0cnVlKTsKICAgICAgdmFsaWRhdGUoIm1pblpvb20iLCB0cnVlKTsKICAgICAgdmFsaWRhdGUoIm1heFpvb20iLCB0cnVlKTsgLy8gYGZhbHNlYCBpcyBhIHZhbGlkIHZhbHVlCgogICAgICByZXMubWFwU3R5bGUgPSB0aGlzLl9jb25maWcubWFwU3R5bGUgPT09IHVuZGVmaW5lZCA/ICJkZWZhdWx0IiA6IHRoaXMuX2NvbmZpZy5tYXBTdHlsZTsKCiAgICAgIGlmIChyZXMubWFwU3R5bGUgIT09ICJkZWZhdWx0IiAmJiByZXMubWFwU3R5bGUgIT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5fb25XYXJuaW5nKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLm1hcFN0eWxlVmFsdWVUeXBlV2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ3ttYXBTdHlsZUNvbmZpZ05hbWV9IG1heSBlaXRoZXIgYmUge21hcFN0eWxlQ29uZmlnRmlyc3RBbGxvd2VkVmFsdWV9IG9yIHttYXBTdHlsZUNvbmZpZ1NlY29uZEFsbG93ZWRWYWx1ZX0nLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIG1hcFN0eWxlQ29uZmlnTmFtZTogJ2NvbmZpZy5raWJhbmEubWFwU3R5bGUnLAogICAgICAgICAgICBtYXBTdHlsZUNvbmZpZ0ZpcnN0QWxsb3dlZFZhbHVlOiAnZmFsc2UnLAogICAgICAgICAgICBtYXBTdHlsZUNvbmZpZ1NlY29uZEFsbG93ZWRWYWx1ZTogJyJkZWZhdWx0IicKICAgICAgICAgIH0KICAgICAgICB9KSk7CgogICAgICAgIHJlcy5tYXBTdHlsZSA9ICJkZWZhdWx0IjsKICAgICAgfQoKICAgICAgdGhpcy5fcGFyc2VCb29sKCd6b29tQ29udHJvbCcsIHJlcywgdHJ1ZSk7CgogICAgICB0aGlzLl9wYXJzZUJvb2woJ3Njcm9sbFdoZWVsWm9vbScsIHJlcywgZmFsc2UpOwoKICAgICAgdmFyIG1heEJvdW5kcyA9IHRoaXMuX2NvbmZpZy5tYXhCb3VuZHM7CgogICAgICBpZiAobWF4Qm91bmRzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWF4Qm91bmRzKSB8fCBtYXhCb3VuZHMubGVuZ3RoICE9PSA0IHx8ICFtYXhCb3VuZHMuZXZlcnkoZnVuY3Rpb24gKHYpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgdiA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzRmluaXRlKHYpOwogICAgICAgIH0pKSB7CiAgICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIubWF4Qm91bmRzVmFsdWVUeXBlV2FybmluZ01lc3NhZ2UnLCB7CiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne21heEJvdW5kc0NvbmZpZ05hbWV9IG11c3QgYmUgYW4gYXJyYXkgd2l0aCBmb3VyIG51bWJlcnMnLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBtYXhCb3VuZHNDb25maWdOYW1lOiAnY29uZmlnLmtpYmFuYS5tYXhCb3VuZHMnCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzLm1heEJvdW5kcyA9IG1heEJvdW5kczsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfSwgewogICAga2V5OiAiX3BhcnNlQm9vbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3BhcnNlQm9vbChwYXJhbU5hbWUsIGRzdE9iaiwgZGZsdCkgewogICAgICB2YXIgdmFsID0gdGhpcy5fY29uZmlnW3BhcmFtTmFtZV07CgogICAgICBpZiAodmFsID09PSB1bmRlZmluZWQpIHsKICAgICAgICBkc3RPYmpbcGFyYW1OYW1lXSA9IGRmbHQ7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbCAhPT0gJ2Jvb2xlYW4nKSB7CiAgICAgICAgdGhpcy5fb25XYXJuaW5nKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLnNvbWVLaWJhbmFQYXJhbVZhbHVlVHlwZVdhcm5pbmdNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICd7Y29uZmlnTmFtZX0gbXVzdCBiZSBhIGJvb2xlYW4gdmFsdWUnLAogICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgIGNvbmZpZ05hbWU6ICJjb25maWcua2liYW5hLiIuY29uY2F0KHBhcmFtTmFtZSkKICAgICAgICAgIH0KICAgICAgICB9KSk7CgogICAgICAgIGRzdE9ialtwYXJhbU5hbWVdID0gZGZsdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBkc3RPYmpbcGFyYW1OYW1lXSA9IHZhbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBQYXJzZSBWZWdhIHNjaGVtYSBlbGVtZW50CiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gaXMgdGhpcyBhIFZlZ2FMaXRlIHNjaGVtYT8KICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3BhcnNlU2NoZW1hIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfcGFyc2VTY2hlbWEoKSB7CiAgICAgIGlmICghdGhpcy5zcGVjLiRzY2hlbWEpIHsKICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIuaW5wdXRTcGVjRG9lc05vdFNwZWNpZnlTY2hlbWFXYXJuaW5nTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVGhlIGlucHV0IHNwZWMgZG9lcyBub3Qgc3BlY2lmeSBhIHtzY2hlbWFQYXJhbX0sIGRlZmF1bHRpbmcgdG8ge2RlZmF1bHRTY2hlbWF9JywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBkZWZhdWx0U2NoZW1hOiAiXCIiLmNvbmNhdChERUZBVUxUX1NDSEVNQSwgIlwiIiksCiAgICAgICAgICAgIHNjaGVtYVBhcmFtOiAnIiRzY2hlbWEiJwogICAgICAgICAgfQogICAgICAgIH0pKTsKCiAgICAgICAgdGhpcy5zcGVjLiRzY2hlbWEgPSBERUZBVUxUX1NDSEVNQTsKICAgICAgfQoKICAgICAgdmFyIHNjaGVtYSA9ICgwLCBfdmVnYVNjaGVtYVVybFBhcnNlci5kZWZhdWx0KSh0aGlzLnNwZWMuJHNjaGVtYSk7CiAgICAgIHZhciBpc1ZlZ2FMaXRlID0gc2NoZW1hLmxpYnJhcnkgPT09ICd2ZWdhLWxpdGUnOwogICAgICB2YXIgbGliVmVyc2lvbiA9IGlzVmVnYUxpdGUgPyB2ZWdhTGl0ZS52ZXJzaW9uIDogdmVnYS52ZXJzaW9uOwoKICAgICAgaWYgKCgwLCBfY29tcGFyZVZlcnNpb25zLmRlZmF1bHQpKHNjaGVtYS52ZXJzaW9uLCBsaWJWZXJzaW9uKSA+IDApIHsKICAgICAgICB0aGlzLl9vbldhcm5pbmcoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIubm90VmFsaWRMaWJyYXJ5VmVyc2lvbkZvcklucHV0U3BlY1dhcm5pbmdNZXNzYWdlJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdUaGUgaW5wdXQgc3BlYyB1c2VzIHtzY2hlbWFMaWJyYXJ5fSB7c2NoZW1hVmVyc2lvbn0sIGJ1dCBjdXJyZW50IHZlcnNpb24gb2Yge3NjaGVtYUxpYnJhcnl9IGlzIHtsaWJyYXJ5VmVyc2lvbn0uJywKICAgICAgICAgIHZhbHVlczogewogICAgICAgICAgICBzY2hlbWFMaWJyYXJ5OiBzY2hlbWEubGlicmFyeSwKICAgICAgICAgICAgc2NoZW1hVmVyc2lvbjogc2NoZW1hLnZlcnNpb24sCiAgICAgICAgICAgIGxpYnJhcnlWZXJzaW9uOiBsaWJWZXJzaW9uCiAgICAgICAgICB9CiAgICAgICAgfSkpOwogICAgICB9CgogICAgICByZXR1cm4gaXNWZWdhTGl0ZTsKICAgIH0KICAgIC8qKgogICAgICogUmVwbGFjZSBhbGwgaW5zdGFuY2VzIG9mIEVTIHJlcXVlc3RzIHdpdGggcmF3IHZhbHVlcy4KICAgICAqIEFsc28gaGFuZGxlIGFueSBvdGhlciB0eXBlIG9mIHVybDoge3R5cGU6IHh4eCwgLi4ufQogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfcmVzb2x2ZURhdGFVcmxzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcmVzb2x2ZURhdGFVcmxzMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogICAgICAvKiNfX1BVUkVfXyovCiAgICAgIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgICB2YXIgcGVuZGluZywgcGVuZGluZ1BhcnNlcnM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHBlbmRpbmcgPSB7fTsKCiAgICAgICAgICAgICAgICB0aGlzLl9maW5kT2JqZWN0RGF0YVVybHModGhpcy5zcGVjLCBmdW5jdGlvbiAob2JqKSB7CiAgICAgICAgICAgICAgICAgIHZhciB1cmwgPSBvYmoudXJsOwogICAgICAgICAgICAgICAgICBkZWxldGUgb2JqLnVybDsKICAgICAgICAgICAgICAgICAgdmFyIHR5cGUgPSB1cmxbJyV0eXBlJSddOwogICAgICAgICAgICAgICAgICBkZWxldGUgdXJsWycldHlwZSUnXTsKCiAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0eXBlID0gREVGQVVMVF9QQVJTRVI7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHZhciBwYXJzZXIgPSBfdGhpczIuX3VybFBhcnNlcnNbdHlwZV07CgogICAgICAgICAgICAgICAgICBpZiAocGFyc2VyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3Zpc1R5cGVWZWdhLnZlZ2FQYXJzZXIubm90U3VwcG9ydGVkVXJsVHlwZUVycm9yTWVzc2FnZScsIHsKICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAne3VybE9iamVjdH0gaXMgbm90IHN1cHBvcnRlZCcsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXJsT2JqZWN0OiAndXJsOiB7IiV0eXBlJSI6ICIke3R5cGV9In0nCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB2YXIgcGVuZGluZ0FyciA9IHBlbmRpbmdbdHlwZV07CgogICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ0FyciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1t0eXBlXSA9IHBlbmRpbmdBcnIgPSBbXTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcGVuZGluZ0Fyci5wdXNoKHBhcnNlci5wYXJzZVVybChvYmosIHVybCkpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcGVuZGluZ1BhcnNlcnMgPSBPYmplY3Qua2V5cyhwZW5kaW5nKTsKCiAgICAgICAgICAgICAgICBpZiAoIShwZW5kaW5nUGFyc2Vycy5sZW5ndGggPiAwKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwZW5kaW5nUGFyc2Vycy5tYXAoZnVuY3Rpb24gKHR5cGUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5fdXJsUGFyc2Vyc1t0eXBlXS5wb3B1bGF0ZURhdGEocGVuZGluZ1t0eXBlXSk7CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIF9yZXNvbHZlRGF0YVVybHMoKSB7CiAgICAgICAgcmV0dXJuIF9yZXNvbHZlRGF0YVVybHMyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfcmVzb2x2ZURhdGFVcmxzOwogICAgfSgpCiAgICAvKioKICAgICAqIFJlY3Vyc2l2ZWx5IGZpbmQgYW5kIGNhbGxiYWNrIGV2ZXJ5IGluc3RhbmNlIG9mIHRoZSBkYXRhLnVybCBhcyBhbiBvYmplY3QKICAgICAqIEBwYXJhbSB7Kn0gb2JqIGN1cnJlbnQgbG9jYXRpb24gaW4gdGhlIG9iamVjdCB0cmVlCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9uKHtvYmplY3R9KX0gb25GaW5kIENhbGwgdGhpcyBmdW5jdGlvbiBmb3IgYWxsIHVybCBvYmplY3RzCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gW2tleV0gZmllbGQgbmFtZSBvZiB0aGUgY3VycmVudCBvYmplY3QKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX2ZpbmRPYmplY3REYXRhVXJscyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX2ZpbmRPYmplY3REYXRhVXJscyhvYmosIG9uRmluZCwga2V5KSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgICAgICB2YXIgX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IHRydWU7CiAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7CiAgICAgICAgdmFyIF9pdGVyYXRvckVycm9yID0gdW5kZWZpbmVkOwoKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gb2JqW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkgewogICAgICAgICAgICB2YXIgZWxlbSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgICAgdGhpcy5fZmluZE9iamVjdERhdGFVcmxzKGVsZW0sIG9uRmluZCwga2V5KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTsKICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyBfaXRlcmF0b3JFcnJvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdChvYmopKSB7CiAgICAgICAgaWYgKGtleSA9PT0gJ2RhdGEnICYmIF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KG9iai51cmwpKSB7CiAgICAgICAgICAvLyBBc3N1bWUgdGhhdCBhbnkgICJkYXRhIjogeyJ1cmwiOiB7Li4ufX0gIGlzIGEgcmVxdWVzdCBmb3IgZGF0YQogICAgICAgICAgaWYgKG9iai52YWx1ZXMgIT09IHVuZGVmaW5lZCB8fCBvYmouc291cmNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKF9pMThuLmkxOG4udHJhbnNsYXRlKCd2aXNUeXBlVmVnYS52ZWdhUGFyc2VyLmRhdGFFeGNlZWRzU29tZVBhcmFtc1VzZVRpbWVzTGltaXRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEYXRhIG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuIG9uZSBvZiB7dXJsUGFyYW19LCB7dmFsdWVzUGFyYW19LCBhbmQge3NvdXJjZVBhcmFtfScsCiAgICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgICB1cmxQYXJhbTogJyJ1cmwiJywKICAgICAgICAgICAgICAgIHZhbHVlc1BhcmFtOiAnInZhbHVlcyInLAogICAgICAgICAgICAgICAgc291cmNlUGFyYW06ICcic291cmNlIicKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBvbkZpbmQob2JqKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhvYmopOyBfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGsgPSBfT2JqZWN0JGtleXNbX2ldOwoKICAgICAgICAgICAgdGhpcy5fZmluZE9iamVjdERhdGFVcmxzKG9ialtrXSwgb25GaW5kLCBrKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSW5qZWN0IGRlZmF1bHQgY29sb3JzIGludG8gdGhlIHNwZWMuY29uZmlnCiAgICAgKiBAcHJpdmF0ZQogICAgICovCgogIH0sIHsKICAgIGtleTogIl9zZXREZWZhdWx0Q29sb3JzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfc2V0RGVmYXVsdENvbG9ycygpIHsKICAgICAgLy8gRGVmYXVsdCBjYXRlZ29yeSBjb2xvcmluZyB0byB0aGUgRWxhc3RpYyBjb2xvciBzY2hlbWUKICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKHsKICAgICAgICBzY2hlbWU6ICdlbGFzdGljJwogICAgICB9LCAnY29uZmlnJywgJ3JhbmdlJywgJ2NhdGVnb3J5Jyk7CgogICAgICBpZiAodGhpcy5pc1ZlZ2FMaXRlKSB7CiAgICAgICAgLy8gVmVnYS1MaXRlOiBzZXQgZGVmYXVsdCBjb2xvciwgd29ya3MgZm9yIGZpbGwgYW5kIHN0cmlrZSAtLSAgY29uZmlnOiB7IG1hcms6ICB7IGNvbG9yOiAnIzU0QjM5OScgfX0KICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ21hcmsnLCAnY29sb3InKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBWZWdhIC0gZ2xvYmFsIG1hcmsgaGFzIHZlcnkgc3RyYW5nZSBiZWhhdmlvciwgbXVzdCBjdXN0b21pemUgZWFjaCBtYXJrIHR5cGUgaW5kaXZpZHVhbGx5CiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3ZlZ2EvdmVnYS9pc3N1ZXMvMTA4MwogICAgICAgIC8vIERvbid0IHNldCBkZWZhdWx0cyBpZiBzcGVjLmNvbmZpZy5tYXJrLmNvbG9yIG9yIGZpbGwgYXJlIHNldAogICAgICAgIGlmICghdGhpcy5zcGVjLmNvbmZpZy5tYXJrIHx8IHRoaXMuc3BlYy5jb25maWcubWFyay5jb2xvciA9PT0gdW5kZWZpbmVkICYmIHRoaXMuc3BlYy5jb25maWcubWFyay5maWxsID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuX3NldERlZmF1bHRWYWx1ZShkZWZhdWx0Q29sb3IsICdjb25maWcnLCAnYXJjJywgJ2ZpbGwnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ2FyZWEnLCAnZmlsbCcpOwoKICAgICAgICAgIHRoaXMuX3NldERlZmF1bHRWYWx1ZShkZWZhdWx0Q29sb3IsICdjb25maWcnLCAnbGluZScsICdzdHJva2UnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3BhdGgnLCAnc3Ryb2tlJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICdyZWN0JywgJ2ZpbGwnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3J1bGUnLCAnc3Ryb2tlJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICdzaGFwZScsICdzdHJva2UnKTsKCiAgICAgICAgICB0aGlzLl9zZXREZWZhdWx0VmFsdWUoZGVmYXVsdENvbG9yLCAnY29uZmlnJywgJ3N5bWJvbCcsICdmaWxsJyk7CgogICAgICAgICAgdGhpcy5fc2V0RGVmYXVsdFZhbHVlKGRlZmF1bHRDb2xvciwgJ2NvbmZpZycsICd0cmFpbCcsICdmaWxsJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCBkZWZhdWx0IHZhbHVlIGlmIGl0IGRvZXNuJ3QgZXhpc3QuCiAgICAgKiBHaXZlbiBhbiBvYmplY3QsIGFuZCBhbiBhcnJheSBvZiBmaWVsZHMsIGVuc3VyZSB0aGF0IG9iai5mbGQxLmZsZDIuIC4uLiAuZmxkTiBpcyBzZXQgdG8gdmFsdWUgaWYgaXQgZG9lc24ndCBleGlzdC4KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUKICAgICAqIEBwYXJhbSB7c3RyaW5nfSBmaWVsZHMKICAgICAqIEBwcml2YXRlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiX3NldERlZmF1bHRWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3NldERlZmF1bHRWYWx1ZSh2YWx1ZSkgewogICAgICB2YXIgX3JlZjsKCiAgICAgIHZhciBvID0gdGhpcy5zcGVjOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAoYXJndW1lbnRzLmxlbmd0aCA8PSAxID8gMCA6IGFyZ3VtZW50cy5sZW5ndGggLSAxKSAtIDE7IGkrKykgewogICAgICAgIHZhciBmaWVsZCA9IGkgKyAxIDwgMSB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgKyAxID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2kgKyAxXTsKICAgICAgICB2YXIgc3ViT2JqID0gb1tmaWVsZF07CgogICAgICAgIGlmIChzdWJPYmogPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgb1tmaWVsZF0gPSB7fTsKICAgICAgICB9IGVsc2UgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNQbGFpbk9iamVjdChzdWJPYmopKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBvID0gb1tmaWVsZF07CiAgICAgIH0KCiAgICAgIHZhciBsYXN0RmllbGQgPSAoX3JlZiA9IChhcmd1bWVudHMubGVuZ3RoIDw9IDEgPyAwIDogYXJndW1lbnRzLmxlbmd0aCAtIDEpIC0gMSArIDEsIF9yZWYgPCAxIHx8IGFyZ3VtZW50cy5sZW5ndGggPD0gX3JlZiA/IHVuZGVmaW5lZCA6IGFyZ3VtZW50c1tfcmVmXSk7CgogICAgICBpZiAob1tsYXN0RmllbGRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBvW2xhc3RGaWVsZF0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3YXJuaW5nIHRvIHRoZSB3YXJuaW5ncyBhcnJheQogICAgICogQHByaXZhdGUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJfb25XYXJuaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25XYXJuaW5nKCkgewogICAgICBpZiAoIXRoaXMuaGlkZVdhcm5pbmdzKSB7CiAgICAgICAgdGhpcy53YXJuaW5ncy5wdXNoKF91dGlscy5VdGlscy5mb3JtYXRXYXJuaW5nVG9TdHIuYXBwbHkoX3V0aWxzLlV0aWxzLCBhcmd1bWVudHMpKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFZlZ2FQYXJzZXI7Cn0oKTsKCmV4cG9ydHMuVmVnYVBhcnNlciA9IFZlZ2FQYXJzZXI7"},null]}