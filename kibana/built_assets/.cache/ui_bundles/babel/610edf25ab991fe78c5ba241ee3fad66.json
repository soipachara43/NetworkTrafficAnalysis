{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_app_controller.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_app_controller.js","mtime":1589249549654},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkRhc2hib2FyZEFwcENvbnRyb2xsZXIgPSB2b2lkIDA7Cgp2YXIgX2xvZGFzaCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoInJlYWN0IikpOwoKdmFyIF9hbmd1bGFyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJhbmd1bGFyIikpOwoKdmFyIF9yeGpzID0gcmVxdWlyZSgicnhqcyIpOwoKdmFyIF9vcGVyYXRvcnMgPSByZXF1aXJlKCJyeGpzL29wZXJhdG9ycyIpOwoKdmFyIF9kYXNoYm9hcmRfZW1wdHlfc2NyZWVuID0gcmVxdWlyZSgiLi9kYXNoYm9hcmRfZW1wdHlfc2NyZWVuIik7Cgp2YXIgX2xlZ2FjeV9pbXBvcnRzID0gcmVxdWlyZSgiLi4vbGVnYWN5X2ltcG9ydHMiKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9kYXRhL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9zYXZlZF9vYmplY3RzL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWMzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9kYXNoYm9hcmQvcHVibGljIik7Cgp2YXIgX3B1YmxpYzQgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9lbWJlZGRhYmxlX2FwaS9wdWJsaWMvbnBfcmVhZHkvcHVibGljIik7Cgp2YXIgX3Nob3dfb3B0aW9uc19wb3BvdmVyID0gcmVxdWlyZSgiLi90b3BfbmF2L3Nob3dfb3B0aW9uc19wb3BvdmVyIik7Cgp2YXIgX3NhdmVfbW9kYWwgPSByZXF1aXJlKCIuL3RvcF9uYXYvc2F2ZV9tb2RhbCIpOwoKdmFyIF9zaG93X2Nsb25lX21vZGFsID0gcmVxdWlyZSgiLi90b3BfbmF2L3Nob3dfY2xvbmVfbW9kYWwiKTsKCnZhciBfbGliID0gcmVxdWlyZSgiLi9saWIiKTsKCnZhciBfZGFzaGJvYXJkX3N0YXRlX21hbmFnZXIgPSByZXF1aXJlKCIuL2Rhc2hib2FyZF9zdGF0ZV9tYW5hZ2VyIik7Cgp2YXIgX2Rhc2hib2FyZF9jb25zdGFudHMgPSByZXF1aXJlKCIuL2Rhc2hib2FyZF9jb25zdGFudHMiKTsKCnZhciBfZ2V0X3RvcF9uYXZfY29uZmlnID0gcmVxdWlyZSgiLi90b3BfbmF2L2dldF90b3BfbmF2X2NvbmZpZyIpOwoKdmFyIF90b3BfbmF2X2lkcyA9IHJlcXVpcmUoIi4vdG9wX25hdi90b3BfbmF2X2lkcyIpOwoKdmFyIF9kYXNoYm9hcmRfc3RyaW5ncyA9IHJlcXVpcmUoIi4vZGFzaGJvYXJkX3N0cmluZ3MiKTsKCnZhciBfZW1iZWRkYWJsZV9zYXZlZF9vYmplY3RfY29udmVydGVycyA9IHJlcXVpcmUoIi4vbGliL2VtYmVkZGFibGVfc2F2ZWRfb2JqZWN0X2NvbnZlcnRlcnMiKTsKCnZhciBfcHVibGljNSA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uL3BsdWdpbnMva2liYW5hX3V0aWxzL3B1YmxpYyIpOwoKdmFyIF9wdWJsaWM2ID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9raWJhbmFfbGVnYWN5L3B1YmxpYyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKdmFyIERhc2hib2FyZEFwcENvbnRyb2xsZXIgPSAvLyBQYXJ0IG9mIHRoZSBleHBvc2VkIHBsdWdpbiBBUEkgLSBkbyBub3QgcmVtb3ZlIHdpdGhvdXQgY2FyZWZ1bCBjb25zaWRlcmF0aW9uLgpmdW5jdGlvbiBEYXNoYm9hcmRBcHBDb250cm9sbGVyKF9yZWYpIHsKICB2YXIgX3RoaXMgPSB0aGlzOwoKICB2YXIgcGx1Z2luSW5pdGlhbGl6ZXJDb250ZXh0ID0gX3JlZi5wbHVnaW5Jbml0aWFsaXplckNvbnRleHQsCiAgICAgICRzY29wZSA9IF9yZWYuJHNjb3BlLAogICAgICAkcm91dGUgPSBfcmVmLiRyb3V0ZSwKICAgICAgJHJvdXRlUGFyYW1zID0gX3JlZi4kcm91dGVQYXJhbXMsCiAgICAgIGRhc2hib2FyZENvbmZpZyA9IF9yZWYuZGFzaGJvYXJkQ29uZmlnLAogICAgICBsb2NhbFN0b3JhZ2UgPSBfcmVmLmxvY2FsU3RvcmFnZSwKICAgICAgaW5kZXhQYXR0ZXJucyA9IF9yZWYuaW5kZXhQYXR0ZXJucywKICAgICAgc2F2ZWRRdWVyeVNlcnZpY2UgPSBfcmVmLnNhdmVkUXVlcnlTZXJ2aWNlLAogICAgICBlbWJlZGRhYmxlID0gX3JlZi5lbWJlZGRhYmxlLAogICAgICBzaGFyZSA9IF9yZWYuc2hhcmUsCiAgICAgIGRhc2hib2FyZENhcGFiaWxpdGllcyA9IF9yZWYuZGFzaGJvYXJkQ2FwYWJpbGl0aWVzLAogICAgICBfcmVmJGVtYmVkZGFibGVDYXBhYmkgPSBfcmVmLmVtYmVkZGFibGVDYXBhYmlsaXRpZXMsCiAgICAgIHZpc3VhbGl6ZUNhcGFiaWxpdGllcyA9IF9yZWYkZW1iZWRkYWJsZUNhcGFiaS52aXN1YWxpemVDYXBhYmlsaXRpZXMsCiAgICAgIG1hcHNDYXBhYmlsaXRpZXMgPSBfcmVmJGVtYmVkZGFibGVDYXBhYmkubWFwc0NhcGFiaWxpdGllcywKICAgICAgcXVlcnlTZXJ2aWNlID0gX3JlZi5kYXRhLnF1ZXJ5LAogICAgICBfcmVmJGNvcmUgPSBfcmVmLmNvcmUsCiAgICAgIG5vdGlmaWNhdGlvbnMgPSBfcmVmJGNvcmUubm90aWZpY2F0aW9ucywKICAgICAgb3ZlcmxheXMgPSBfcmVmJGNvcmUub3ZlcmxheXMsCiAgICAgIGNocm9tZSA9IF9yZWYkY29yZS5jaHJvbWUsCiAgICAgIGluamVjdGVkTWV0YWRhdGEgPSBfcmVmJGNvcmUuaW5qZWN0ZWRNZXRhZGF0YSwKICAgICAgZmF0YWxFcnJvcnMgPSBfcmVmJGNvcmUuZmF0YWxFcnJvcnMsCiAgICAgIHVpU2V0dGluZ3MgPSBfcmVmJGNvcmUudWlTZXR0aW5ncywKICAgICAgc2F2ZWRPYmplY3RzID0gX3JlZiRjb3JlLnNhdmVkT2JqZWN0cywKICAgICAgaHR0cCA9IF9yZWYkY29yZS5odHRwLAogICAgICBpMThuU3RhcnQgPSBfcmVmJGNvcmUuaTE4biwKICAgICAgaGlzdG9yeSA9IF9yZWYuaGlzdG9yeSwKICAgICAga2JuVXJsU3RhdGVTdG9yYWdlID0gX3JlZi5rYm5VcmxTdGF0ZVN0b3JhZ2U7CgogIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEYXNoYm9hcmRBcHBDb250cm9sbGVyKTsKCiAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJhcHBTdGF0dXMiLCB2b2lkIDApOwoKICB2YXIgZmlsdGVyTWFuYWdlciA9IHF1ZXJ5U2VydmljZS5maWx0ZXJNYW5hZ2VyOwogIHZhciBxdWVyeUZpbHRlciA9IGZpbHRlck1hbmFnZXI7CiAgdmFyIHRpbWVmaWx0ZXIgPSBxdWVyeVNlcnZpY2UudGltZWZpbHRlci50aW1lZmlsdGVyOwogIHZhciBsYXN0UmVsb2FkUmVxdWVzdFRpbWUgPSAwOwogIHZhciBkYXNoID0gJHNjb3BlLmRhc2ggPSAkcm91dGUuY3VycmVudC5sb2NhbHMuZGFzaDsKCiAgaWYgKGRhc2guaWQpIHsKICAgIGNocm9tZS5kb2NUaXRsZS5jaGFuZ2UoZGFzaC50aXRsZSk7CiAgfQoKICB2YXIgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyID0gbmV3IF9kYXNoYm9hcmRfc3RhdGVfbWFuYWdlci5EYXNoYm9hcmRTdGF0ZU1hbmFnZXIoewogICAgc2F2ZWREYXNoYm9hcmQ6IGRhc2gsCiAgICBoaWRlV3JpdGVDb250cm9sczogZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCksCiAgICBraWJhbmFWZXJzaW9uOiBwbHVnaW5Jbml0aWFsaXplckNvbnRleHQuZW52LnBhY2thZ2VJbmZvLnZlcnNpb24sCiAgICBrYm5VcmxTdGF0ZVN0b3JhZ2U6IGtiblVybFN0YXRlU3RvcmFnZSwKICAgIGhpc3Rvcnk6IGhpc3RvcnkKICB9KTsgLy8gc3luYyBpbml0aWFsIGFwcCBmaWx0ZXJzIGZyb20gc3RhdGUgdG8gZmlsdGVyTWFuYWdlcgogIC8vIGlmIHRoZXJlIGlzIGFuIGV4aXN0aW5nIHNpbWlsYXIgZ2xvYmFsIGZpbHRlciwgdGhlbiBsZWF2ZSBpdCBhcyBnbG9iYWwKCiAgZmlsdGVyTWFuYWdlci5zZXRBcHBGaWx0ZXJzKF9sb2Rhc2guZGVmYXVsdC5jbG9uZURlZXAoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmFwcFN0YXRlLmZpbHRlcnMpKTsgLy8gc2V0dXAgc3luY2luZyBvZiBhcHAgZmlsdGVycyBiZXR3ZWVuIGFwcFN0YXRlIGFuZCBmaWx0ZXJNYW5hZ2VyCgogIHZhciBzdG9wU3luY2luZ0FwcEZpbHRlcnMgPSAoMCwgX3B1YmxpYy5jb25uZWN0VG9RdWVyeVN0YXRlKShxdWVyeVNlcnZpY2UsIHsKICAgIHNldDogZnVuY3Rpb24gc2V0KF9yZWYyKSB7CiAgICAgIHZhciBmaWx0ZXJzID0gX3JlZjIuZmlsdGVyczsKICAgICAgcmV0dXJuIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRGaWx0ZXJzKGZpbHRlcnMgfHwgW10pOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gewogICAgICAgIGZpbHRlcnM6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBTdGF0ZS5maWx0ZXJzCiAgICAgIH07CiAgICB9LAogICAgc3RhdGUkOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwU3RhdGUkLnBpcGUoKDAsIF9vcGVyYXRvcnMubWFwKShmdW5jdGlvbiAoc3RhdGUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBmaWx0ZXJzOiBzdGF0ZS5maWx0ZXJzCiAgICAgIH07CiAgICB9KSkKICB9LCB7CiAgICBmaWx0ZXJzOiBfcHVibGljLmVzRmlsdGVycy5GaWx0ZXJTdGF0ZVN0b3JlLkFQUF9TVEFURQogIH0pOyAvLyBUaGUgaGFzaCBjaGVjayBpcyBzbyB3ZSBvbmx5IHVwZGF0ZSB0aGUgdGltZSBmaWx0ZXIgb24gZGFzaGJvYXJkIG9wZW4sIG5vdCBkdXJpbmcKICAvLyBub3JtYWwgY3Jvc3MgYXBwIG5hdmlnYXRpb24uCgogIGlmIChkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNUaW1lU2F2ZWRXaXRoRGFzaGJvYXJkKCkpIHsKICAgIHZhciBpbml0aWFsR2xvYmFsU3RhdGVJblVybCA9IGtiblVybFN0YXRlU3RvcmFnZS5nZXQoJ19nJyk7CgogICAgaWYgKCEoaW5pdGlhbEdsb2JhbFN0YXRlSW5VcmwgPT09IG51bGwgfHwgaW5pdGlhbEdsb2JhbFN0YXRlSW5VcmwgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGluaXRpYWxHbG9iYWxTdGF0ZUluVXJsLnRpbWUpKSB7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zeW5jVGltZWZpbHRlcldpdGhEYXNoYm9hcmRUaW1lKHRpbWVmaWx0ZXIpOwogICAgfQoKICAgIGlmICghKGluaXRpYWxHbG9iYWxTdGF0ZUluVXJsID09PSBudWxsIHx8IGluaXRpYWxHbG9iYWxTdGF0ZUluVXJsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpbml0aWFsR2xvYmFsU3RhdGVJblVybC5yZWZyZXNoSW50ZXJ2YWwpKSB7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zeW5jVGltZWZpbHRlcldpdGhEYXNoYm9hcmRSZWZyZXNoSW50ZXJ2YWwodGltZWZpbHRlcik7CiAgICB9CiAgfSAvLyBzdGFydHMgc3luY2luZyBgX2dgIHBvcnRpb24gb2YgdXJsIHdpdGggcXVlcnkgc2VydmljZXMKICAvLyBpdCBpcyBpbXBvcnRhbnQgdG8gc3RhcnQgdGhpcyBzeW5jaW5nIGFmdGVyIGBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkKHRpbWVmaWx0ZXIpO2AgYWJvdmUgaXMgcnVuLAogIC8vIG90aGVyd2lzZSBpdCB3aWxsIGNhc2UgcmVkdW5kYW50IGJyb3dzZXIgaGlzdG9yeSByZWNvcmRzCgoKICB2YXIgX3N5bmNRdWVyeVN0YXRlV2l0aFVyID0gKDAsIF9wdWJsaWMuc3luY1F1ZXJ5U3RhdGVXaXRoVXJsKShxdWVyeVNlcnZpY2UsIGtiblVybFN0YXRlU3RvcmFnZSksCiAgICAgIHN0b3BTeW5jaW5nUXVlcnlTZXJ2aWNlU3RhdGVXaXRoVXJsID0gX3N5bmNRdWVyeVN0YXRlV2l0aFVyLnN0b3A7IC8vIHN0YXJ0cyBzeW5jaW5nIGBfYWAgcG9ydGlvbiBvZiB1cmwKCgogIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zdGFydFN0YXRlU3luY2luZygpOwogICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gZGFzaGJvYXJkQ2FwYWJpbGl0aWVzLnNhdmVRdWVyeTsKCiAgdmFyIGdldFNob3VsZFNob3dFZGl0SGVscCA9IGZ1bmN0aW9uIGdldFNob3VsZFNob3dFZGl0SGVscCgpIHsKICAgIHJldHVybiAhZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpLmxlbmd0aCAmJiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SXNFZGl0TW9kZSgpICYmICFkYXNoYm9hcmRDb25maWcuZ2V0SGlkZVdyaXRlQ29udHJvbHMoKTsKICB9OwoKICB2YXIgZ2V0U2hvdWxkU2hvd1ZpZXdIZWxwID0gZnVuY3Rpb24gZ2V0U2hvdWxkU2hvd1ZpZXdIZWxwKCkgewogICAgcmV0dXJuICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UGFuZWxzKCkubGVuZ3RoICYmIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc1ZpZXdNb2RlKCkgJiYgIWRhc2hib2FyZENvbmZpZy5nZXRIaWRlV3JpdGVDb250cm9scygpOwogIH07CgogIHZhciBzaG91bGRTaG93VW5hdXRob3JpemVkRW1wdHlTdGF0ZSA9IGZ1bmN0aW9uIHNob3VsZFNob3dVbmF1dGhvcml6ZWRFbXB0eVN0YXRlKCkgewogICAgdmFyIHJlYWRvbmx5TW9kZSA9ICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UGFuZWxzKCkubGVuZ3RoICYmICFnZXRTaG91bGRTaG93RWRpdEhlbHAoKSAmJiAhZ2V0U2hvdWxkU2hvd1ZpZXdIZWxwKCkgJiYgZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCk7CiAgICB2YXIgdXNlckhhc05vUGVybWlzc2lvbnMgPSAhZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFBhbmVscygpLmxlbmd0aCAmJiAhdmlzdWFsaXplQ2FwYWJpbGl0aWVzLnNhdmUgJiYgIW1hcHNDYXBhYmlsaXRpZXMuc2F2ZTsKICAgIHJldHVybiByZWFkb25seU1vZGUgfHwgdXNlckhhc05vUGVybWlzc2lvbnM7CiAgfTsKCiAgdmFyIGFkZFZpc3VhbGl6YXRpb24gPSBmdW5jdGlvbiBhZGRWaXN1YWxpemF0aW9uKCkgewogICAgbmF2QWN0aW9uc1tfdG9wX25hdl9pZHMuVG9wTmF2SWRzLlZJU1VBTElaRV0oKTsKICB9OwoKICB2YXIgdXBkYXRlSW5kZXhQYXR0ZXJucyA9IGZ1bmN0aW9uIHVwZGF0ZUluZGV4UGF0dGVybnMoY29udGFpbmVyKSB7CiAgICBpZiAoIWNvbnRhaW5lciB8fCAoMCwgX3B1YmxpYzQuaXNFcnJvckVtYmVkZGFibGUpKGNvbnRhaW5lcikpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBwYW5lbEluZGV4UGF0dGVybnMgPSBbXTsKICAgIE9iamVjdC52YWx1ZXMoY29udGFpbmVyLmdldENoaWxkSWRzKCkpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7CiAgICAgIHZhciBfcGFuZWxJbmRleFBhdHRlcm5zOwoKICAgICAgdmFyIGVtYmVkZGFibGVJbnN0YW5jZSA9IGNvbnRhaW5lci5nZXRDaGlsZChpZCk7CiAgICAgIGlmICgoMCwgX3B1YmxpYzQuaXNFcnJvckVtYmVkZGFibGUpKGVtYmVkZGFibGVJbnN0YW5jZSkpIHJldHVybjsKICAgICAgdmFyIGVtYmVkZGFibGVJbmRleFBhdHRlcm5zID0gZW1iZWRkYWJsZUluc3RhbmNlLmdldE91dHB1dCgpLmluZGV4UGF0dGVybnM7CiAgICAgIGlmICghZW1iZWRkYWJsZUluZGV4UGF0dGVybnMpIHJldHVybjsKCiAgICAgIChfcGFuZWxJbmRleFBhdHRlcm5zID0gcGFuZWxJbmRleFBhdHRlcm5zKS5wdXNoLmFwcGx5KF9wYW5lbEluZGV4UGF0dGVybnMsIF90b0NvbnN1bWFibGVBcnJheShlbWJlZGRhYmxlSW5kZXhQYXR0ZXJucykpOwogICAgfSk7CiAgICBwYW5lbEluZGV4UGF0dGVybnMgPSAoMCwgX2xvZGFzaC51bmlxKShwYW5lbEluZGV4UGF0dGVybnMsICdpZCcpOwoKICAgIGlmIChwYW5lbEluZGV4UGF0dGVybnMgJiYgcGFuZWxJbmRleFBhdHRlcm5zLmxlbmd0aCA+IDApIHsKICAgICAgJHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkgewogICAgICAgICRzY29wZS5pbmRleFBhdHRlcm5zID0gcGFuZWxJbmRleFBhdHRlcm5zOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4UGF0dGVybnMuZ2V0RGVmYXVsdCgpLnRoZW4oZnVuY3Rpb24gKGRlZmF1bHRJbmRleFBhdHRlcm4pIHsKICAgICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkc2NvcGUuaW5kZXhQYXR0ZXJucyA9IFtkZWZhdWx0SW5kZXhQYXR0ZXJuXTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfTsKCiAgdmFyIGdldEVtcHR5U2NyZWVuUHJvcHMgPSBmdW5jdGlvbiBnZXRFbXB0eVNjcmVlblByb3BzKHNob3VsZFNob3dFZGl0SGVscCwgaXNFbXB0eUluUmVhZE9ubHlNb2RlKSB7CiAgICB2YXIgZW1wdHlTY3JlZW5Qcm9wcyA9IHsKICAgICAgb25MaW5rQ2xpY2s6IHNob3VsZFNob3dFZGl0SGVscCA/ICRzY29wZS5zaG93QWRkUGFuZWwgOiAkc2NvcGUuZW50ZXJFZGl0TW9kZSwKICAgICAgc2hvd0xpbmtUb1Zpc3VhbGl6ZTogc2hvdWxkU2hvd0VkaXRIZWxwLAogICAgICB1aVNldHRpbmdzOiB1aVNldHRpbmdzLAogICAgICBodHRwOiBodHRwCiAgICB9OwoKICAgIGlmIChzaG91bGRTaG93RWRpdEhlbHApIHsKICAgICAgZW1wdHlTY3JlZW5Qcm9wcy5vblZpc3VhbGl6ZUNsaWNrID0gYWRkVmlzdWFsaXphdGlvbjsKICAgIH0KCiAgICBpZiAoaXNFbXB0eUluUmVhZE9ubHlNb2RlKSB7CiAgICAgIGVtcHR5U2NyZWVuUHJvcHMuaXNSZWFkb25seU1vZGUgPSB0cnVlOwogICAgfQoKICAgIHJldHVybiBlbXB0eVNjcmVlblByb3BzOwogIH07CgogIHZhciBnZXREYXNoYm9hcmRJbnB1dCA9IGZ1bmN0aW9uIGdldERhc2hib2FyZElucHV0KCkgewogICAgdmFyIGVtYmVkZGFibGVzTWFwID0ge307CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UGFuZWxzKCkuZm9yRWFjaChmdW5jdGlvbiAocGFuZWwpIHsKICAgICAgZW1iZWRkYWJsZXNNYXBbcGFuZWwucGFuZWxJbmRleF0gPSAoMCwgX2VtYmVkZGFibGVfc2F2ZWRfb2JqZWN0X2NvbnZlcnRlcnMuY29udmVydFNhdmVkRGFzaGJvYXJkUGFuZWxUb1BhbmVsU3RhdGUpKHBhbmVsKTsKICAgIH0pOwogICAgdmFyIGV4cGFuZGVkUGFuZWxJZDsKCiAgICBpZiAoZGFzaGJvYXJkQ29udGFpbmVyICYmICEoMCwgX3B1YmxpYzQuaXNFcnJvckVtYmVkZGFibGUpKGRhc2hib2FyZENvbnRhaW5lcikpIHsKICAgICAgZXhwYW5kZWRQYW5lbElkID0gZGFzaGJvYXJkQ29udGFpbmVyLmdldElucHV0KCkuZXhwYW5kZWRQYW5lbElkOwogICAgfQoKICAgIHZhciBzaG91bGRTaG93RWRpdEhlbHAgPSBnZXRTaG91bGRTaG93RWRpdEhlbHAoKTsKICAgIHZhciBzaG91bGRTaG93Vmlld0hlbHAgPSBnZXRTaG91bGRTaG93Vmlld0hlbHAoKTsKICAgIHZhciBpc0VtcHR5SW5SZWFkb25seU1vZGUgPSBzaG91bGRTaG93VW5hdXRob3JpemVkRW1wdHlTdGF0ZSgpOwogICAgcmV0dXJuIHsKICAgICAgaWQ6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5zYXZlZERhc2hib2FyZC5pZCB8fCAnJywKICAgICAgZmlsdGVyczogcXVlcnlGaWx0ZXIuZ2V0RmlsdGVycygpLAogICAgICBoaWRlUGFuZWxUaXRsZXM6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRIaWRlUGFuZWxUaXRsZXMoKSwKICAgICAgcXVlcnk6ICRzY29wZS5tb2RlbC5xdWVyeSwKICAgICAgdGltZVJhbmdlOiBfb2JqZWN0U3ByZWFkKHt9LCBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKHRpbWVmaWx0ZXIuZ2V0VGltZSgpKSksCiAgICAgIHJlZnJlc2hDb25maWc6IHRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsKCksCiAgICAgIHZpZXdNb2RlOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0Vmlld01vZGUoKSwKICAgICAgcGFuZWxzOiBlbWJlZGRhYmxlc01hcCwKICAgICAgaXNGdWxsU2NyZWVuTW9kZTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldEZ1bGxTY3JlZW5Nb2RlKCksCiAgICAgIGlzRW1wdHlTdGF0ZTogc2hvdWxkU2hvd0VkaXRIZWxwIHx8IHNob3VsZFNob3dWaWV3SGVscCB8fCBpc0VtcHR5SW5SZWFkb25seU1vZGUsCiAgICAgIHVzZU1hcmdpbnM6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRVc2VNYXJnaW5zKCksCiAgICAgIGxhc3RSZWxvYWRSZXF1ZXN0VGltZTogbGFzdFJlbG9hZFJlcXVlc3RUaW1lLAogICAgICB0aXRsZTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCksCiAgICAgIGRlc2NyaXB0aW9uOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RGVzY3JpcHRpb24oKSwKICAgICAgZXhwYW5kZWRQYW5lbElkOiBleHBhbmRlZFBhbmVsSWQKICAgIH07CiAgfTsKCiAgdmFyIHVwZGF0ZVN0YXRlID0gZnVuY3Rpb24gdXBkYXRlU3RhdGUoKSB7CiAgICAvLyBGb2xsb3dpbmcgdGhlICJiZXN0IHByYWN0aWNlIiBvZiBhbHdheXMgaGF2ZSBhICcuJyBpbiB5b3VyIG5nLW1vZGVscyDigJMKICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIuanMvd2lraS9VbmRlcnN0YW5kaW5nLVNjb3BlcwogICAgJHNjb3BlLm1vZGVsID0gewogICAgICBxdWVyeTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFF1ZXJ5KCksCiAgICAgIGZpbHRlcnM6IHF1ZXJ5RmlsdGVyLmdldEZpbHRlcnMoKSwKICAgICAgdGltZVJlc3RvcmU6IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRUaW1lUmVzdG9yZSgpLAogICAgICB0aXRsZTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFRpdGxlKCksCiAgICAgIGRlc2NyaXB0aW9uOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RGVzY3JpcHRpb24oKSwKICAgICAgdGltZVJhbmdlOiB0aW1lZmlsdGVyLmdldFRpbWUoKSwKICAgICAgcmVmcmVzaEludGVydmFsOiB0aW1lZmlsdGVyLmdldFJlZnJlc2hJbnRlcnZhbCgpCiAgICB9OwogICAgJHNjb3BlLnBhbmVscyA9IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRQYW5lbHMoKTsKICAgICRzY29wZS5zY3JlZW5UaXRsZSA9IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRUaXRsZSgpOwogIH07CgogIHVwZGF0ZVN0YXRlKCk7CiAgdmFyIGRhc2hib2FyZENvbnRhaW5lcjsKICB2YXIgaW5wdXRTdWJzY3JpcHRpb247CiAgdmFyIG91dHB1dFN1YnNjcmlwdGlvbjsKICB2YXIgZGFzaGJvYXJkRG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rhc2hib2FyZFZpZXdwb3J0Jyk7CiAgdmFyIGRhc2hib2FyZEZhY3RvcnkgPSBlbWJlZGRhYmxlLmdldEVtYmVkZGFibGVGYWN0b3J5KF9wdWJsaWMzLkRBU0hCT0FSRF9DT05UQUlORVJfVFlQRSk7CiAgZGFzaGJvYXJkRmFjdG9yeS5jcmVhdGUoZ2V0RGFzaGJvYXJkSW5wdXQoKSkudGhlbihmdW5jdGlvbiAoY29udGFpbmVyKSB7CiAgICBpZiAoISgwLCBfcHVibGljNC5pc0Vycm9yRW1iZWRkYWJsZSkoY29udGFpbmVyKSkgewogICAgICBkYXNoYm9hcmRDb250YWluZXIgPSBjb250YWluZXI7CgogICAgICBkYXNoYm9hcmRDb250YWluZXIucmVuZGVyRW1wdHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHNob3VsZFNob3dFZGl0SGVscCA9IGdldFNob3VsZFNob3dFZGl0SGVscCgpOwogICAgICAgIHZhciBzaG91bGRTaG93Vmlld0hlbHAgPSBnZXRTaG91bGRTaG93Vmlld0hlbHAoKTsKICAgICAgICB2YXIgaXNFbXB0eUluUmVhZE9ubHlNb2RlID0gc2hvdWxkU2hvd1VuYXV0aG9yaXplZEVtcHR5U3RhdGUoKTsKICAgICAgICB2YXIgaXNFbXB0eVN0YXRlID0gc2hvdWxkU2hvd0VkaXRIZWxwIHx8IHNob3VsZFNob3dWaWV3SGVscCB8fCBpc0VtcHR5SW5SZWFkT25seU1vZGU7CiAgICAgICAgcmV0dXJuIGlzRW1wdHlTdGF0ZSA/IF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2Rhc2hib2FyZF9lbXB0eV9zY3JlZW4uRGFzaGJvYXJkRW1wdHlTY3JlZW4sIGdldEVtcHR5U2NyZWVuUHJvcHMoc2hvdWxkU2hvd0VkaXRIZWxwLCBpc0VtcHR5SW5SZWFkT25seU1vZGUpKSA6IG51bGw7CiAgICAgIH07CgogICAgICB1cGRhdGVJbmRleFBhdHRlcm5zKGRhc2hib2FyZENvbnRhaW5lcik7CiAgICAgIG91dHB1dFN1YnNjcmlwdGlvbiA9IGRhc2hib2FyZENvbnRhaW5lci5nZXRPdXRwdXQkKCkuc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHsKICAgICAgICB1cGRhdGVJbmRleFBhdHRlcm5zKGRhc2hib2FyZENvbnRhaW5lcik7CiAgICAgIH0pOwogICAgICBpbnB1dFN1YnNjcmlwdGlvbiA9IGRhc2hib2FyZENvbnRhaW5lci5nZXRJbnB1dCQoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkaXJ0eSA9IGZhbHNlOyAvLyBUaGlzIGhhcyB0byBiZSBmaXJzdCBiZWNhdXNlIGhhbmRsZURhc2hib2FyZENvbnRhaW5lckNoYW5nZXMgY2F1c2VzCiAgICAgICAgLy8gYXBwU3RhdGUuc2F2ZSB3aGljaCB3aWxsIGNhdXNlIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIgdG8gYmUgY2FsbGVkLgoKICAgICAgICBpZiAoIV9wdWJsaWMuZXNGaWx0ZXJzLmNvbXBhcmVGaWx0ZXJzKGNvbnRhaW5lci5nZXRJbnB1dCgpLmZpbHRlcnMsIHF1ZXJ5RmlsdGVyLmdldEZpbHRlcnMoKSwgX3B1YmxpYy5lc0ZpbHRlcnMuQ09NUEFSRV9BTExfT1BUSU9OUykpIHsKICAgICAgICAgIC8vIEFkZCBmaWx0ZXJzIG1vZGlmaWVzIHRoZSBvYmplY3QgcGFzc2VkIHRvIGl0LCBoZW5jZSB0aGUgY2xvbmUgZGVlcC4KICAgICAgICAgIHF1ZXJ5RmlsdGVyLmFkZEZpbHRlcnMoX2xvZGFzaC5kZWZhdWx0LmNsb25lRGVlcChjb250YWluZXIuZ2V0SW5wdXQoKS5maWx0ZXJzKSk7CiAgICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKCRzY29wZS5tb2RlbC5xdWVyeSwgY29udGFpbmVyLmdldElucHV0KCkuZmlsdGVycyk7CiAgICAgICAgICBkaXJ0eSA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuaGFuZGxlRGFzaGJvYXJkQ29udGFpbmVyQ2hhbmdlcyhjb250YWluZXIpOwogICAgICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChkaXJ0eSkgewogICAgICAgICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlZ2lzdGVyQ2hhbmdlTGlzdGVuZXIoZnVuY3Rpb24gKCkgewogICAgICAgIC8vIHdlIGFyZW4ndCBjaGVja2luZyBkaXJ0eSBzdGF0ZSBiZWNhdXNlIHRoZXJlIGFyZSBjaGFuZ2VzIHRoZSBjb250YWluZXIgbmVlZHMgdG8ga25vdyBhYm91dAogICAgICAgIC8vIHRoYXQgd29uJ3QgbWFrZSB0aGUgZGFzaGJvYXJkICJkaXJ0eSIgLSBsaWtlIGEgdmlldyBtb2RlIGNoYW5nZS4KICAgICAgICByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyKCk7CiAgICAgIH0pOyAvLyBUaGlzIGNvZGUgbmVlZHMgdG8gYmUgcmVwbGFjZWQgd2l0aCBhIGJldHRlciBtZWNoYW5pc20gZm9yIGFkZGluZyBuZXcgZW1iZWRkYWJsZXMgb2YKICAgICAgLy8gYW55IHR5cGUgZnJvbSB0aGUgYWRkIHBhbmVsLiBMaWtlbHkgdGhpcyB3aWxsIGhhcHBlbiB2aWEgY3JlYXRpbmcgYSB2aXN1YWxpemF0aW9uICJpbmxpbmUiLAogICAgICAvLyB3aXRob3V0IG5hdmlnYXRpbmcgYXdheSBmcm9tIHRoZSBVWC4KCiAgICAgIGlmICgkcm91dGVQYXJhbXNbX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkFERF9FTUJFRERBQkxFX1RZUEVdKSB7CiAgICAgICAgdmFyIHR5cGUgPSAkcm91dGVQYXJhbXNbX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkFERF9FTUJFRERBQkxFX1RZUEVdOwogICAgICAgIHZhciBpZCA9ICRyb3V0ZVBhcmFtc1tfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX0VNQkVEREFCTEVfSURdOwogICAgICAgIGNvbnRhaW5lci5hZGRTYXZlZE9iamVjdEVtYmVkZGFibGUodHlwZSwgaWQpOwogICAgICAgICgwLCBfcHVibGljNS5yZW1vdmVRdWVyeVBhcmFtKShoaXN0b3J5LCBfZGFzaGJvYXJkX2NvbnN0YW50cy5EYXNoYm9hcmRDb25zdGFudHMuQUREX0VNQkVEREFCTEVfVFlQRSk7CiAgICAgICAgKDAsIF9wdWJsaWM1LnJlbW92ZVF1ZXJ5UGFyYW0pKGhpc3RvcnksIF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5BRERfRU1CRUREQUJMRV9JRCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZGFzaGJvYXJkRG9tKSB7CiAgICAgIGNvbnRhaW5lci5yZW5kZXIoZGFzaGJvYXJkRG9tKTsKICAgIH0KICB9KTsgLy8gUGFydCBvZiB0aGUgZXhwb3NlZCBwbHVnaW4gQVBJIC0gZG8gbm90IHJlbW92ZSB3aXRob3V0IGNhcmVmdWwgY29uc2lkZXJhdGlvbi4KCiAgdGhpcy5hcHBTdGF0dXMgPSB7CiAgICBkaXJ0eTogIWRhc2guaWQKICB9OwogIGRhc2hib2FyZFN0YXRlTWFuYWdlci5yZWdpc3RlckNoYW5nZUxpc3RlbmVyKGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIF90aGlzLmFwcFN0YXR1cy5kaXJ0eSA9IHN0YXR1cy5kaXJ0eSB8fCAhZGFzaC5pZDsKICAgIHVwZGF0ZVN0YXRlKCk7CiAgfSk7CiAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmFwcGx5RmlsdGVycyhkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0UXVlcnkoKSB8fCB7CiAgICBxdWVyeTogJycsCiAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgdWlTZXR0aW5ncy5nZXQoJ3NlYXJjaDpxdWVyeUxhbmd1YWdlJykKICB9LCBxdWVyeUZpbHRlci5nZXRGaWx0ZXJzKCkpOwogIHRpbWVmaWx0ZXIuZGlzYWJsZVRpbWVSYW5nZVNlbGVjdG9yKCk7CiAgdGltZWZpbHRlci5kaXNhYmxlQXV0b1JlZnJlc2hTZWxlY3RvcigpOwoKICB2YXIgbGFuZGluZ1BhZ2VVcmwgPSBmdW5jdGlvbiBsYW5kaW5nUGFnZVVybCgpIHsKICAgIHJldHVybiAiIyIuY29uY2F0KF9kYXNoYm9hcmRfY29uc3RhbnRzLkRhc2hib2FyZENvbnN0YW50cy5MQU5ESU5HX1BBR0VfUEFUSCk7CiAgfTsKCiAgdmFyIGdldERhc2hUaXRsZSA9IGZ1bmN0aW9uIGdldERhc2hUaXRsZSgpIHsKICAgIHJldHVybiAoMCwgX2Rhc2hib2FyZF9zdHJpbmdzLmdldERhc2hib2FyZFRpdGxlKShkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKSwgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFZpZXdNb2RlKCksIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc0RpcnR5KHRpbWVmaWx0ZXIpLCBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuaXNOZXcoKSk7CiAgfTsgLy8gUHVzaCBicmVhZGNydW1icyB0byBuZXcgaGVhZGVyIG5hdmlnYXRpb24KCgogIHZhciB1cGRhdGVCcmVhZGNydW1icyA9IGZ1bmN0aW9uIHVwZGF0ZUJyZWFkY3J1bWJzKCkgewogICAgY2hyb21lLnNldEJyZWFkY3J1bWJzKFt7CiAgICAgIHRleHQ6IF9pMThuLmkxOG4udHJhbnNsYXRlKCdrYm4uZGFzaGJvYXJkLmRhc2hib2FyZEFwcEJyZWFkY3J1bWJzVGl0bGUnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdEYXNoYm9hcmQnCiAgICAgIH0pLAogICAgICBocmVmOiBsYW5kaW5nUGFnZVVybCgpCiAgICB9LCB7CiAgICAgIHRleHQ6IGdldERhc2hUaXRsZSgpCiAgICB9XSk7CiAgfTsKCiAgdXBkYXRlQnJlYWRjcnVtYnMoKTsKICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIucmVnaXN0ZXJDaGFuZ2VMaXN0ZW5lcih1cGRhdGVCcmVhZGNydW1icyk7CgogIHZhciBnZXRDaGFuZ2VzRnJvbUFwcFN0YXRlRm9yQ29udGFpbmVyU3RhdGUgPSBmdW5jdGlvbiBnZXRDaGFuZ2VzRnJvbUFwcFN0YXRlRm9yQ29udGFpbmVyU3RhdGUoKSB7CiAgICB2YXIgYXBwU3RhdGVEYXNoYm9hcmRJbnB1dCA9IGdldERhc2hib2FyZElucHV0KCk7CgogICAgaWYgKCFkYXNoYm9hcmRDb250YWluZXIgfHwgKDAsIF9wdWJsaWM0LmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgIHJldHVybiBhcHBTdGF0ZURhc2hib2FyZElucHV0OwogICAgfQoKICAgIHZhciBjb250YWluZXJJbnB1dCA9IGRhc2hib2FyZENvbnRhaW5lci5nZXRJbnB1dCgpOwogICAgdmFyIGRpZmZlcmVuY2VzID0ge307IC8vIEZpbHRlcnMgc2hvdWxkbid0ICBiZSBjb21wYXJlZCB1c2luZyByZWd1bGFyIGlzRXF1YWwKCiAgICBpZiAoIV9wdWJsaWMuZXNGaWx0ZXJzLmNvbXBhcmVGaWx0ZXJzKGNvbnRhaW5lcklucHV0LmZpbHRlcnMsIGFwcFN0YXRlRGFzaGJvYXJkSW5wdXQuZmlsdGVycywgX3B1YmxpYy5lc0ZpbHRlcnMuQ09NUEFSRV9BTExfT1BUSU9OUykpIHsKICAgICAgZGlmZmVyZW5jZXMuZmlsdGVycyA9IGFwcFN0YXRlRGFzaGJvYXJkSW5wdXQuZmlsdGVyczsKICAgIH0KCiAgICBPYmplY3Qua2V5cyhfbG9kYXNoLmRlZmF1bHQub21pdChjb250YWluZXJJbnB1dCwgJ2ZpbHRlcnMnKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHZhciBjb250YWluZXJWYWx1ZSA9IGNvbnRhaW5lcklucHV0W2tleV07CiAgICAgIHZhciBhcHBTdGF0ZVZhbHVlID0gYXBwU3RhdGVEYXNoYm9hcmRJbnB1dFtrZXldOwoKICAgICAgaWYgKCFfbG9kYXNoLmRlZmF1bHQuaXNFcXVhbChjb250YWluZXJWYWx1ZSwgYXBwU3RhdGVWYWx1ZSkpIHsKICAgICAgICBkaWZmZXJlbmNlc1trZXldID0gYXBwU3RhdGVWYWx1ZTsKICAgICAgfQogICAgfSk7IC8vIGNsb25lRGVlcCBoYWNrIGlzIG5lZWRlZCwgYXMgdGhlcmUgYXJlIG11bHRpcGxlIHBsYWNlLCB3aGVyZSBjb250YWluZXIncyBpbnB1dCBtdXRhdGVkLAogICAgLy8gYnV0IHZhbHVlcyBmcm9tIGFwcFN0YXRlVmFsdWUgYXJlIGRlZXBseSBmcm96ZW4sIGFzIHRoZXkgY2FuJ3QgYmUgbXV0YXRlZCBkaXJlY3RseQoKICAgIHJldHVybiBPYmplY3QudmFsdWVzKGRpZmZlcmVuY2VzKS5sZW5ndGggPT09IDAgPyB1bmRlZmluZWQgOiBfbG9kYXNoLmRlZmF1bHQuY2xvbmVEZWVwKGRpZmZlcmVuY2VzKTsKICB9OwoKICB2YXIgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lciA9IGZ1bmN0aW9uIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKSB7CiAgICB2YXIgY2hhbmdlcyA9IGdldENoYW5nZXNGcm9tQXBwU3RhdGVGb3JDb250YWluZXJTdGF0ZSgpOwoKICAgIGlmIChjaGFuZ2VzICYmIGRhc2hib2FyZENvbnRhaW5lcikgewogICAgICBkYXNoYm9hcmRDb250YWluZXIudXBkYXRlSW5wdXQoY2hhbmdlcyk7CiAgICB9CiAgfTsKCiAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2ggPSBmdW5jdGlvbiAoX3JlZjMpIHsKICAgIHZhciBxdWVyeSA9IF9yZWYzLnF1ZXJ5LAogICAgICAgIGRhdGVSYW5nZSA9IF9yZWYzLmRhdGVSYW5nZTsKCiAgICBpZiAoZGF0ZVJhbmdlKSB7CiAgICAgIHRpbWVmaWx0ZXIuc2V0VGltZShkYXRlUmFuZ2UpOwogICAgfQoKICAgIHZhciBvbGRRdWVyeSA9ICRzY29wZS5tb2RlbC5xdWVyeTsKCiAgICBpZiAoX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwob2xkUXVlcnksIHF1ZXJ5KSkgewogICAgICAvLyBUaGUgdXNlciBjYW4gc3RpbGwgcmVxdWVzdCBhIHJlbG9hZCBpbiB0aGUgcXVlcnkgYmFyLCBldmVuIGlmIHRoZQogICAgICAvLyBxdWVyeSBpcyB0aGUgc2FtZSwgYW5kIGluIHRoYXQgY2FzZSwgd2UgaGF2ZSB0byBleHBsaWNpdGx5IGFzayBmb3IKICAgICAgLy8gYSByZWxvYWQsIHNpbmNlIG5vIHN0YXRlIGNoYW5nZXMgd2lsbCBjYXVzZSBpdC4KICAgICAgbGFzdFJlbG9hZFJlcXVlc3RUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHJlZnJlc2hEYXNoYm9hcmRDb250YWluZXIoKTsKICAgIH0gZWxzZSB7CiAgICAgICRzY29wZS5tb2RlbC5xdWVyeSA9IHF1ZXJ5OwogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKCRzY29wZS5tb2RlbC5xdWVyeSwgJHNjb3BlLm1vZGVsLmZpbHRlcnMpOwogICAgfQogIH07CgogICRzY29wZS5vblJlZnJlc2hDaGFuZ2UgPSBmdW5jdGlvbiAoX3JlZjQpIHsKICAgIHZhciBpc1BhdXNlZCA9IF9yZWY0LmlzUGF1c2VkLAogICAgICAgIHJlZnJlc2hJbnRlcnZhbCA9IF9yZWY0LnJlZnJlc2hJbnRlcnZhbDsKICAgIHRpbWVmaWx0ZXIuc2V0UmVmcmVzaEludGVydmFsKHsKICAgICAgcGF1c2U6IGlzUGF1c2VkLAogICAgICB2YWx1ZTogcmVmcmVzaEludGVydmFsID8gcmVmcmVzaEludGVydmFsIDogJHNjb3BlLm1vZGVsLnJlZnJlc2hJbnRlcnZhbC52YWx1ZQogICAgfSk7CiAgfTsKCiAgJHNjb3BlLm9uRmlsdGVyc1VwZGF0ZWQgPSBmdW5jdGlvbiAoZmlsdGVycykgewogICAgLy8gVGhlIGZpbHRlcnMgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIHNldCB3aGVuIHRoZSBxdWVyeUZpbHRlciBlbWl0cyBhbiB1cGRhdGUgZXZlbnQgKHNlZSBiZWxvdykKICAgIHF1ZXJ5RmlsdGVyLnNldEZpbHRlcnMoZmlsdGVycyk7CiAgfTsKCiAgJHNjb3BlLm9uUXVlcnlTYXZlZCA9IGZ1bmN0aW9uIChzYXZlZFF1ZXJ5KSB7CiAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgfTsKCiAgJHNjb3BlLm9uU2F2ZWRRdWVyeVVwZGF0ZWQgPSBmdW5jdGlvbiAoc2F2ZWRRdWVyeSkgewogICAgJHNjb3BlLnNhdmVkUXVlcnkgPSBfb2JqZWN0U3ByZWFkKHt9LCBzYXZlZFF1ZXJ5KTsKICB9OwoKICAkc2NvcGUub25DbGVhclNhdmVkUXVlcnkgPSBmdW5jdGlvbiAoKSB7CiAgICBkZWxldGUgJHNjb3BlLnNhdmVkUXVlcnk7CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0U2F2ZWRRdWVyeUlkKHVuZGVmaW5lZCk7CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuYXBwbHlGaWx0ZXJzKHsKICAgICAgcXVlcnk6ICcnLAogICAgICBsYW5ndWFnZTogbG9jYWxTdG9yYWdlLmdldCgna2liYW5hLnVzZXJRdWVyeUxhbmd1YWdlJykgfHwgdWlTZXR0aW5ncy5nZXQoJ3NlYXJjaDpxdWVyeUxhbmd1YWdlJykKICAgIH0sIHF1ZXJ5RmlsdGVyLmdldEdsb2JhbEZpbHRlcnMoKSk7IC8vIE1ha2luZyB0aGlzIG1ldGhvZCBzeW5jIGJyb2tlIHRoZSB1cGRhdGVzLgogICAgLy8gVGVtcG9yYXJ5IGZpeCwgdW50aWwgd2UgZml4IHRoZSBjb21wbGV4IHN0YXRlIGluIHRoaXMgZmlsZS4KCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgcXVlcnlGaWx0ZXIuc2V0RmlsdGVycyhxdWVyeUZpbHRlci5nZXRHbG9iYWxGaWx0ZXJzKCkpOwogICAgfSwgMCk7CiAgfTsKCiAgdmFyIHVwZGF0ZVN0YXRlRnJvbVNhdmVkUXVlcnkgPSBmdW5jdGlvbiB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpIHsKICAgIHZhciBzYXZlZFF1ZXJ5RmlsdGVycyA9IHNhdmVkUXVlcnkuYXR0cmlidXRlcy5maWx0ZXJzIHx8IFtdOwogICAgdmFyIGdsb2JhbEZpbHRlcnMgPSBxdWVyeUZpbHRlci5nZXRHbG9iYWxGaWx0ZXJzKCk7CiAgICB2YXIgYWxsRmlsdGVycyA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZ2xvYmFsRmlsdGVycyksIF90b0NvbnN1bWFibGVBcnJheShzYXZlZFF1ZXJ5RmlsdGVycykpOwogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmFwcGx5RmlsdGVycyhzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMucXVlcnksIGFsbEZpbHRlcnMpOwoKICAgIGlmIChzYXZlZFF1ZXJ5LmF0dHJpYnV0ZXMudGltZWZpbHRlcikgewogICAgICB0aW1lZmlsdGVyLnNldFRpbWUoewogICAgICAgIGZyb206IHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLmZyb20sCiAgICAgICAgdG86IHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLnRvCiAgICAgIH0pOwoKICAgICAgaWYgKHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLnJlZnJlc2hJbnRlcnZhbCkgewogICAgICAgIHRpbWVmaWx0ZXIuc2V0UmVmcmVzaEludGVydmFsKHNhdmVkUXVlcnkuYXR0cmlidXRlcy50aW1lZmlsdGVyLnJlZnJlc2hJbnRlcnZhbCk7CiAgICAgIH0KICAgIH0gLy8gTWFraW5nIHRoaXMgbWV0aG9kIHN5bmMgYnJva2UgdGhlIHVwZGF0ZXMuCiAgICAvLyBUZW1wb3JhcnkgZml4LCB1bnRpbCB3ZSBmaXggdGhlIGNvbXBsZXggc3RhdGUgaW4gdGhpcyBmaWxlLgoKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgcXVlcnlGaWx0ZXIuc2V0RmlsdGVycyhhbGxGaWx0ZXJzKTsKICAgIH0sIDApOwogIH07CgogICRzY29wZS4kd2F0Y2goJ3NhdmVkUXVlcnknLCBmdW5jdGlvbiAobmV3U2F2ZWRRdWVyeSkgewogICAgaWYgKCFuZXdTYXZlZFF1ZXJ5KSByZXR1cm47CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0U2F2ZWRRdWVyeUlkKG5ld1NhdmVkUXVlcnkuaWQpOwogICAgdXBkYXRlU3RhdGVGcm9tU2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5KTsKICB9KTsKICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0U2F2ZWRRdWVyeUlkKCk7CiAgfSwgZnVuY3Rpb24gKG5ld1NhdmVkUXVlcnlJZCkgewogICAgaWYgKCFuZXdTYXZlZFF1ZXJ5SWQpIHsKICAgICAgJHNjb3BlLnNhdmVkUXVlcnkgPSB1bmRlZmluZWQ7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoISRzY29wZS5zYXZlZFF1ZXJ5IHx8IG5ld1NhdmVkUXVlcnlJZCAhPT0gJHNjb3BlLnNhdmVkUXVlcnkuaWQpIHsKICAgICAgc2F2ZWRRdWVyeVNlcnZpY2UuZ2V0U2F2ZWRRdWVyeShuZXdTYXZlZFF1ZXJ5SWQpLnRoZW4oZnVuY3Rpb24gKHNhdmVkUXVlcnkpIHsKICAgICAgICAkc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAkc2NvcGUuc2F2ZWRRdWVyeSA9IHNhdmVkUXVlcnk7CiAgICAgICAgICB1cGRhdGVTdGF0ZUZyb21TYXZlZFF1ZXJ5KHNhdmVkUXVlcnkpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9KTsKICAkc2NvcGUuaW5kZXhQYXR0ZXJucyA9IFtdOwogICRzY29wZS4kd2F0Y2goJ21vZGVsLnF1ZXJ5JywgZnVuY3Rpb24gKG5ld1F1ZXJ5KSB7CiAgICB2YXIgcXVlcnkgPSAoMCwgX2xlZ2FjeV9pbXBvcnRzLm1pZ3JhdGVMZWdhY3lRdWVyeSkobmV3UXVlcnkpOwogICAgJHNjb3BlLnVwZGF0ZVF1ZXJ5QW5kRmV0Y2goewogICAgICBxdWVyeTogcXVlcnkKICAgIH0pOwogIH0pOwogICRzY29wZS4kd2F0Y2goZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGRhc2hib2FyZENhcGFiaWxpdGllcy5zYXZlUXVlcnk7CiAgfSwgZnVuY3Rpb24gKG5ld0NhcGFiaWxpdHkpIHsKICAgICRzY29wZS5zaG93U2F2ZVF1ZXJ5ID0gbmV3Q2FwYWJpbGl0eTsKICB9KTsKICAkc2NvcGUudGltZWZpbHRlclN1YnNjcmlwdGlvbnMkID0gbmV3IF9yeGpzLlN1YnNjcmlwdGlvbigpOwogICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQuYWRkKCgwLCBfbGVnYWN5X2ltcG9ydHMuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIHRpbWVmaWx0ZXIuZ2V0UmVmcmVzaEludGVydmFsVXBkYXRlJCgpLCB7CiAgICBuZXh0OiBmdW5jdGlvbiBuZXh0KCkgewogICAgICB1cGRhdGVTdGF0ZSgpOwogICAgICByZWZyZXNoRGFzaGJvYXJkQ29udGFpbmVyKCk7CiAgICB9CiAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICByZXR1cm4gKDAsIF9wdWJsaWM2LmFkZEZhdGFsRXJyb3IpKGZhdGFsRXJyb3JzLCBlcnJvcik7CiAgfSkpOwogICRzY29wZS50aW1lZmlsdGVyU3Vic2NyaXB0aW9ucyQuYWRkKCgwLCBfbGVnYWN5X2ltcG9ydHMuc3Vic2NyaWJlV2l0aFNjb3BlKSgkc2NvcGUsIHRpbWVmaWx0ZXIuZ2V0VGltZVVwZGF0ZSQoKSwgewogICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgdXBkYXRlU3RhdGUoKTsKICAgICAgcmVmcmVzaERhc2hib2FyZENvbnRhaW5lcigpOwogICAgfQogIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgcmV0dXJuICgwLCBfcHVibGljNi5hZGRGYXRhbEVycm9yKShmYXRhbEVycm9ycywgZXJyb3IpOwogIH0pKTsKCiAgZnVuY3Rpb24gdXBkYXRlVmlld01vZGUobmV3TW9kZSkgewogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnN3aXRjaFZpZXdNb2RlKG5ld01vZGUpOwogIH0KCiAgdmFyIG9uQ2hhbmdlVmlld01vZGUgPSBmdW5jdGlvbiBvbkNoYW5nZVZpZXdNb2RlKG5ld01vZGUpIHsKICAgIHZhciBpc1BhZ2VSZWZyZXNoID0gbmV3TW9kZSA9PT0gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFZpZXdNb2RlKCk7CiAgICB2YXIgaXNMZWF2aW5nRWRpdE1vZGUgPSAhaXNQYWdlUmVmcmVzaCAmJiBuZXdNb2RlID09PSBfcHVibGljNC5WaWV3TW9kZS5WSUVXOwogICAgdmFyIHdpbGxMb3NlQ2hhbmdlcyA9IGlzTGVhdmluZ0VkaXRNb2RlICYmIGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRJc0RpcnR5KHRpbWVmaWx0ZXIpOwoKICAgIGlmICghd2lsbExvc2VDaGFuZ2VzKSB7CiAgICAgIHVwZGF0ZVZpZXdNb2RlKG5ld01vZGUpOwogICAgICByZXR1cm47CiAgICB9CgogICAgZnVuY3Rpb24gcmV2ZXJ0Q2hhbmdlc0FuZEV4aXRFZGl0TW9kZSgpIHsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnJlc2V0U3RhdGUoKTsgLy8gVGhpcyBpcyBvbmx5IG5lY2Vzc2FyeSBmb3IgbmV3IGRhc2hib2FyZHMsIHdoaWNoIHdpbGwgZGVmYXVsdCB0byBFZGl0IG1vZGUuCgogICAgICB1cGRhdGVWaWV3TW9kZShfcHVibGljNC5WaWV3TW9kZS5WSUVXKTsgLy8gV2UgbmVlZCB0byBkbyBhIGhhcmQgcmVzZXQgb2YgdGhlIHRpbWVwaWNrZXIuIGFwcFN0YXRlIHdpbGwgbm90IHJlbG9hZCBsaWtlCiAgICAgIC8vIGl0IGRvZXMgb24gJ29wZW4nIGJlY2F1c2UgaXQncyBiZWVuIHNhdmVkIHRvIHRoZSB1cmwgYW5kIHRoZSBnZXRBcHBTdGF0ZS5wcmV2aW91c2x5U3RvcmVkKCkgY2hlY2sgb24KICAgICAgLy8gcmVsb2FkIHdpbGwgY2F1c2UgaXQgbm90IHRvIHN5bmMuCgogICAgICBpZiAoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzVGltZVNhdmVkV2l0aERhc2hib2FyZCgpKSB7CiAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnN5bmNUaW1lZmlsdGVyV2l0aERhc2hib2FyZFRpbWUodGltZWZpbHRlcik7CiAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnN5bmNUaW1lZmlsdGVyV2l0aERhc2hib2FyZFJlZnJlc2hJbnRlcnZhbCh0aW1lZmlsdGVyKTsKICAgICAgfSAvLyBBbmd1bGFyJ3MgJGxvY2F0aW9uIHNraXBzIHRoaXMgdXBkYXRlIGJlY2F1c2Ugb2YgaGlzdG9yeSB1cGRhdGVzIGZyb20gc3luY1N0YXRlIHdoaWNoIGhhcHBlbiBzaW11bHRhbmVvdXNseQogICAgICAvLyB3aGVuIGNhbGxpbmcga2JuVXJsLmNoYW5nZSgpIGFuZ3VsYXIgc2NoZWR1bGVzIHVybCB1cGRhdGUgYW5kIHdoZW4gYW5ndWxhciBmaW5hbGx5IHN0YXJ0cyB0byBwcm9jZXNzIGl0LAogICAgICAvLyB0aGUgdXBkYXRlIGlzIGNvbnNpZGVyZWQgb3V0ZGF0ZWQgYW5kIGFuZ3VsYXIgc2tpcHMgaXQKICAgICAgLy8gc28gaGF2ZSB0byB1c2UgaW1wbGVtZW50YXRpb24gb2YgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmNoYW5nZURhc2hib2FyZFVybCwgd2hpY2ggd29ya2Fyb3VuZHMgdGhvc2UgaXNzdWVzCgoKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmNoYW5nZURhc2hib2FyZFVybChkYXNoLmlkID8gKDAsIF9kYXNoYm9hcmRfY29uc3RhbnRzLmNyZWF0ZURhc2hib2FyZEVkaXRVcmwpKGRhc2guaWQpIDogX2Rhc2hib2FyZF9jb25zdGFudHMuRGFzaGJvYXJkQ29uc3RhbnRzLkNSRUFURV9ORVdfREFTSEJPQVJEX1VSTCk7CiAgICB9CgogICAgb3ZlcmxheXMub3BlbkNvbmZpcm0oX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuY2hhbmdlVmlld01vZGVDb25maXJtTW9kYWwuZGlzY2FyZENoYW5nZXNEZXNjcmlwdGlvbicsIHsKICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJPbmNlIHlvdSBkaXNjYXJkIHlvdXIgY2hhbmdlcywgdGhlcmUncyBubyBnZXR0aW5nIHRoZW0gYmFjay4iCiAgICB9KSwgewogICAgICBjb25maXJtQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuY2hhbmdlVmlld01vZGVDb25maXJtTW9kYWwuY29uZmlybUJ1dHRvbkxhYmVsJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGlzY2FyZCBjaGFuZ2VzJwogICAgICB9KSwKICAgICAgY2FuY2VsQnV0dG9uVGV4dDogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuY2hhbmdlVmlld01vZGVDb25maXJtTW9kYWwuY2FuY2VsQnV0dG9uTGFiZWwnLCB7CiAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdDb250aW51ZSBlZGl0aW5nJwogICAgICB9KSwKICAgICAgZGVmYXVsdEZvY3VzZWRCdXR0b246IF9ldWkuRVVJX01PREFMX0NBTkNFTF9CVVRUT04sCiAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5jaGFuZ2VWaWV3TW9kZUNvbmZpcm1Nb2RhbC5kaXNjYXJkQ2hhbmdlc1RpdGxlJywgewogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnRGlzY2FyZCBjaGFuZ2VzIHRvIGRhc2hib2FyZD8nCiAgICAgIH0pCiAgICB9KS50aGVuKGZ1bmN0aW9uIChpc0NvbmZpcm1lZCkgewogICAgICBpZiAoaXNDb25maXJtZWQpIHsKICAgICAgICByZXZlcnRDaGFuZ2VzQW5kRXhpdEVkaXRNb2RlKCk7CiAgICAgIH0KICAgIH0pOwogIH07CiAgLyoqCiAgICogU2F2ZXMgdGhlIGRhc2hib2FyZC4KICAgKgogICAqIEBwYXJhbSB7b2JqZWN0fSBbc2F2ZU9wdGlvbnM9e31dCiAgICogQHByb3BlcnR5IHtib29sZWFufSBbc2F2ZU9wdGlvbnMuY29uZmlybU92ZXJ3cml0ZT1mYWxzZV0gLSBJZiB0cnVlLCBhdHRlbXB0cyB0byBjcmVhdGUgdGhlIHNvdXJjZSBzbyBpdAogICAqIGNhbiBjb25maXJtIGFuIG92ZXJ3cml0ZSBpZiBhIGRvY3VtZW50IHdpdGggdGhlIGlkIGFscmVhZHkgZXhpc3RzLgogICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3NhdmVPcHRpb25zLmlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ9ZmFsc2VdIC0gSWYgdHJ1ZSwgc2F2ZSBhbGxvd2VkIHdpdGggZHVwbGljYXRlIHRpdGxlCiAgICogQHByb3BlcnR5IHtmdW5jfSBbc2F2ZU9wdGlvbnMub25UaXRsZUR1cGxpY2F0ZV0gLSBmdW5jdGlvbiBjYWxsZWQgaWYgZHVwbGljYXRlIHRpdGxlIGV4aXN0cy4KICAgKiBXaGVuIG5vdCBwcm92aWRlZCwgY29uZmlybSBtb2RhbCB3aWxsIGJlIGRpc3BsYXllZCBhc2tpbmcgdXNlciB0byBjb25maXJtIG9yIGNhbmNlbCBzYXZlLgogICAqIEByZXR1cm4ge1Byb21pc2V9CiAgICogQHJlc29sdmVkIHtTdHJpbmd9IC0gVGhlIGlkIG9mIHRoZSBkb2MKICAgKi8KCgogIGZ1bmN0aW9uIHNhdmUoc2F2ZU9wdGlvbnMpIHsKICAgIHJldHVybiAoMCwgX2xpYi5zYXZlRGFzaGJvYXJkKShfYW5ndWxhci5kZWZhdWx0LnRvSnNvbiwgdGltZWZpbHRlciwgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLCBzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAoaWQpIHsKICAgICAgaWYgKGlkKSB7CiAgICAgICAgbm90aWZpY2F0aW9ucy50b2FzdHMuYWRkU3VjY2Vzcyh7CiAgICAgICAgICB0aXRsZTogX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuZGFzaGJvYXJkV2FzU2F2ZWRTdWNjZXNzTWVzc2FnZScsIHsKICAgICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICJEYXNoYm9hcmQgJ3tkYXNoVGl0bGV9JyB3YXMgc2F2ZWQiLAogICAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgICBkYXNoVGl0bGU6IGRhc2gudGl0bGUKICAgICAgICAgICAgfQogICAgICAgICAgfSksCiAgICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZURhc2hib2FyZFN1Y2Nlc3MnCiAgICAgICAgfSk7CgogICAgICAgIGlmIChkYXNoLmlkICE9PSAkcm91dGVQYXJhbXMuaWQpIHsKICAgICAgICAgIC8vIEFuZ3VsYXIncyAkbG9jYXRpb24gc2tpcHMgdGhpcyB1cGRhdGUgYmVjYXVzZSBvZiBoaXN0b3J5IHVwZGF0ZXMgZnJvbSBzeW5jU3RhdGUgd2hpY2ggaGFwcGVuIHNpbXVsdGFuZW91c2x5CiAgICAgICAgICAvLyB3aGVuIGNhbGxpbmcga2JuVXJsLmNoYW5nZSgpIGFuZ3VsYXIgc2NoZWR1bGVzIHVybCB1cGRhdGUgYW5kIHdoZW4gYW5ndWxhciBmaW5hbGx5IHN0YXJ0cyB0byBwcm9jZXNzIGl0LAogICAgICAgICAgLy8gdGhlIHVwZGF0ZSBpcyBjb25zaWRlcmVkIG91dGRhdGVkIGFuZCBhbmd1bGFyIHNraXBzIGl0CiAgICAgICAgICAvLyBzbyBoYXZlIHRvIHVzZSBpbXBsZW1lbnRhdGlvbiBvZiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuY2hhbmdlRGFzaGJvYXJkVXJsLCB3aGljaCB3b3JrYXJvdW5kcyB0aG9zZSBpc3N1ZXMKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5jaGFuZ2VEYXNoYm9hcmRVcmwoKDAsIF9kYXNoYm9hcmRfY29uc3RhbnRzLmNyZWF0ZURhc2hib2FyZEVkaXRVcmwpKGRhc2guaWQpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2hyb21lLmRvY1RpdGxlLmNoYW5nZShkYXNoLmxhc3RTYXZlZFRpdGxlKTsKICAgICAgICAgIHVwZGF0ZVZpZXdNb2RlKF9wdWJsaWM0LlZpZXdNb2RlLlZJRVcpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogaWQKICAgICAgfTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICBub3RpZmljYXRpb25zLnRvYXN0cy5hZGREYW5nZXIoewogICAgICAgIHRpdGxlOiBfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5kYXNoYm9hcmRXYXNOb3RTYXZlZERhbmdlck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkRhc2hib2FyZCAne2Rhc2hUaXRsZX0nIHdhcyBub3Qgc2F2ZWQuIEVycm9yOiB7ZXJyb3JNZXNzYWdlfSIsCiAgICAgICAgICB2YWx1ZXM6IHsKICAgICAgICAgICAgZGFzaFRpdGxlOiBkYXNoLnRpdGxlLAogICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UKICAgICAgICAgIH0KICAgICAgICB9KSwKICAgICAgICAnZGF0YS10ZXN0LXN1YmonOiAnc2F2ZURhc2hib2FyZEZhaWx1cmUnCiAgICAgIH0pOwogICAgICByZXR1cm4gewogICAgICAgIGVycm9yOiBlcnJvcgogICAgICB9OwogICAgfSk7CiAgfQoKICAkc2NvcGUuc2hvd0ZpbHRlckJhciA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiAkc2NvcGUubW9kZWwuZmlsdGVycy5sZW5ndGggPiAwIHx8ICFkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RnVsbFNjcmVlbk1vZGUoKTsKICB9OwoKICAkc2NvcGUuc2hvd0FkZFBhbmVsID0gZnVuY3Rpb24gKCkgewogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKGZhbHNlKTsKICAgIC8qCiAgICAgKiBUZW1wIHNvbHV0aW9uIGZvciB0cmlnZ2VyaW5nIG1lbnUgY2xpY2suCiAgICAgKiBXaGVuIGRlLWFuZ3VsYXJpemluZyB0aGlzIGNvZGUsIHBsZWFzZSBjYWxsIHRoZSB1bmRlcmxheWluZyBhY3Rpb24gZnVuY3Rpb24KICAgICAqIGRpcmVjdGx5IGFuZCBub3QgdmlhIHRoZSB0b3AgbmF2IG9iamVjdC4KICAgICAqKi8KCiAgICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuQUREX0VYSVNUSU5HXSgpOwogIH07CgogICRzY29wZS5lbnRlckVkaXRNb2RlID0gZnVuY3Rpb24gKCkgewogICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKGZhbHNlKTsKICAgIC8qCiAgICAgKiBUZW1wIHNvbHV0aW9uIGZvciB0cmlnZ2VyaW5nIG1lbnUgY2xpY2suCiAgICAgKiBXaGVuIGRlLWFuZ3VsYXJpemluZyB0aGlzIGNvZGUsIHBsZWFzZSBjYWxsIHRoZSB1bmRlcmxheWluZyBhY3Rpb24gZnVuY3Rpb24KICAgICAqIGRpcmVjdGx5IGFuZCBub3QgdmlhIHRoZSB0b3AgbmF2IG9iamVjdC4KICAgICAqKi8KCiAgICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRU5URVJfRURJVF9NT0RFXSgpOwogIH07CgogIHZhciBuYXZBY3Rpb25zID0ge307CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5GVUxMX1NDUkVFTl0gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldEZ1bGxTY3JlZW5Nb2RlKHRydWUpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5FWElUX0VESVRfTU9ERV0gPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gb25DaGFuZ2VWaWV3TW9kZShfcHVibGljNC5WaWV3TW9kZS5WSUVXKTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuRU5URVJfRURJVF9NT0RFXSA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiBvbkNoYW5nZVZpZXdNb2RlKF9wdWJsaWM0LlZpZXdNb2RlLkVESVQpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5TQVZFXSA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBjdXJyZW50VGl0bGUgPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGl0bGUoKTsKICAgIHZhciBjdXJyZW50RGVzY3JpcHRpb24gPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0RGVzY3JpcHRpb24oKTsKICAgIHZhciBjdXJyZW50VGltZVJlc3RvcmUgPSBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0VGltZVJlc3RvcmUoKTsKCiAgICB2YXIgb25TYXZlID0gZnVuY3Rpb24gb25TYXZlKF9yZWY1KSB7CiAgICAgIHZhciBuZXdUaXRsZSA9IF9yZWY1Lm5ld1RpdGxlLAogICAgICAgICAgbmV3RGVzY3JpcHRpb24gPSBfcmVmNS5uZXdEZXNjcmlwdGlvbiwKICAgICAgICAgIG5ld0NvcHlPblNhdmUgPSBfcmVmNS5uZXdDb3B5T25TYXZlLAogICAgICAgICAgbmV3VGltZVJlc3RvcmUgPSBfcmVmNS5uZXdUaW1lUmVzdG9yZSwKICAgICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQgPSBfcmVmNS5pc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgICAgb25UaXRsZUR1cGxpY2F0ZSA9IF9yZWY1Lm9uVGl0bGVEdXBsaWNhdGU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShuZXdUaXRsZSk7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXREZXNjcmlwdGlvbihuZXdEZXNjcmlwdGlvbik7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zYXZlZERhc2hib2FyZC5jb3B5T25TYXZlID0gbmV3Q29weU9uU2F2ZTsKICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFRpbWVSZXN0b3JlKG5ld1RpbWVSZXN0b3JlKTsKICAgICAgdmFyIHNhdmVPcHRpb25zID0gewogICAgICAgIGNvbmZpcm1PdmVyd3JpdGU6IGZhbHNlLAogICAgICAgIGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQ6IGlzVGl0bGVEdXBsaWNhdGVDb25maXJtZWQsCiAgICAgICAgb25UaXRsZUR1cGxpY2F0ZTogb25UaXRsZUR1cGxpY2F0ZQogICAgICB9OwogICAgICByZXR1cm4gc2F2ZShzYXZlT3B0aW9ucykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAvLyBJZiB0aGUgc2F2ZSB3YXNuJ3Qgc3VjY2Vzc2Z1bCwgcHV0IHRoZSBvcmlnaW5hbCB2YWx1ZXMgYmFjay4KICAgICAgICBpZiAoIXJlc3BvbnNlLmlkKSB7CiAgICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0VGl0bGUoY3VycmVudFRpdGxlKTsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXREZXNjcmlwdGlvbihjdXJyZW50RGVzY3JpcHRpb24pOwogICAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFRpbWVSZXN0b3JlKGN1cnJlbnRUaW1lUmVzdG9yZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICAgIH0pOwogICAgfTsKCiAgICB2YXIgZGFzaGJvYXJkU2F2ZU1vZGFsID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2F2ZV9tb2RhbC5EYXNoYm9hcmRTYXZlTW9kYWwsIHsKICAgICAgb25TYXZlOiBvblNhdmUsCiAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7fSwKICAgICAgdGl0bGU6IGN1cnJlbnRUaXRsZSwKICAgICAgZGVzY3JpcHRpb246IGN1cnJlbnREZXNjcmlwdGlvbiwKICAgICAgdGltZVJlc3RvcmU6IGN1cnJlbnRUaW1lUmVzdG9yZSwKICAgICAgc2hvd0NvcHlPblNhdmU6IGRhc2guaWQgPyB0cnVlIDogZmFsc2UKICAgIH0pOwoKICAgICgwLCBfcHVibGljMi5zaG93U2F2ZU1vZGFsKShkYXNoYm9hcmRTYXZlTW9kYWwsIGkxOG5TdGFydC5Db250ZXh0KTsKICB9OwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuQ0xPTkVdID0gZnVuY3Rpb24gKCkgewogICAgdmFyIGN1cnJlbnRUaXRsZSA9IGRhc2hib2FyZFN0YXRlTWFuYWdlci5nZXRUaXRsZSgpOwoKICAgIHZhciBvbkNsb25lID0gZnVuY3Rpb24gb25DbG9uZShuZXdUaXRsZSwgaXNUaXRsZUR1cGxpY2F0ZUNvbmZpcm1lZCwgb25UaXRsZUR1cGxpY2F0ZSkgewogICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2F2ZWREYXNoYm9hcmQuY29weU9uU2F2ZSA9IHRydWU7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShuZXdUaXRsZSk7CiAgICAgIHZhciBzYXZlT3B0aW9ucyA9IHsKICAgICAgICBjb25maXJtT3ZlcndyaXRlOiBmYWxzZSwKICAgICAgICBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkOiBpc1RpdGxlRHVwbGljYXRlQ29uZmlybWVkLAogICAgICAgIG9uVGl0bGVEdXBsaWNhdGU6IG9uVGl0bGVEdXBsaWNhdGUKICAgICAgfTsKICAgICAgcmV0dXJuIHNhdmUoc2F2ZU9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gSWYgdGhlIHNhdmUgd2Fzbid0IHN1Y2Nlc3NmdWwsIHB1dCB0aGUgb3JpZ2luYWwgdGl0bGUgYmFjay4KICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3IpIHsKICAgICAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5zZXRUaXRsZShjdXJyZW50VGl0bGUpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgICB9KTsKICAgIH07CgogICAgKDAsIF9zaG93X2Nsb25lX21vZGFsLnNob3dDbG9uZU1vZGFsKShvbkNsb25lLCBjdXJyZW50VGl0bGUpOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5BRERfRVhJU1RJTkddID0gZnVuY3Rpb24gKCkgewogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lciAmJiAhKDAsIF9wdWJsaWM0LmlzRXJyb3JFbWJlZGRhYmxlKShkYXNoYm9hcmRDb250YWluZXIpKSB7CiAgICAgICgwLCBfcHVibGljNC5vcGVuQWRkUGFuZWxGbHlvdXQpKHsKICAgICAgICBlbWJlZGRhYmxlOiBkYXNoYm9hcmRDb250YWluZXIsCiAgICAgICAgZ2V0QWxsRmFjdG9yaWVzOiBlbWJlZGRhYmxlLmdldEVtYmVkZGFibGVGYWN0b3JpZXMsCiAgICAgICAgZ2V0RmFjdG9yeTogZW1iZWRkYWJsZS5nZXRFbWJlZGRhYmxlRmFjdG9yeSwKICAgICAgICBub3RpZmljYXRpb25zOiBub3RpZmljYXRpb25zLAogICAgICAgIG92ZXJsYXlzOiBvdmVybGF5cywKICAgICAgICBTYXZlZE9iamVjdEZpbmRlcjogKDAsIF9wdWJsaWMyLmdldFNhdmVkT2JqZWN0RmluZGVyKShzYXZlZE9iamVjdHMsIHVpU2V0dGluZ3MpCiAgICAgIH0pOwogICAgfQogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5WSVNVQUxJWkVdID0KICAvKiNfX1BVUkVfXyovCiAgX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICB2YXIgdHlwZSwgZmFjdG9yeSwgZXhwbGljaXRJbnB1dDsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdHlwZSA9ICd2aXN1YWxpemF0aW9uJzsKICAgICAgICAgICAgZmFjdG9yeSA9IGVtYmVkZGFibGUuZ2V0RW1iZWRkYWJsZUZhY3RvcnkodHlwZSk7CgogICAgICAgICAgICBpZiAoZmFjdG9yeSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aHJvdyBuZXcgX3B1YmxpYzQuRW1iZWRkYWJsZUZhY3RvcnlOb3RGb3VuZEVycm9yKHR5cGUpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDY7CiAgICAgICAgICAgIHJldHVybiBmYWN0b3J5LmdldEV4cGxpY2l0SW5wdXQoKTsKCiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgIGV4cGxpY2l0SW5wdXQgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgaWYgKCFkYXNoYm9hcmRDb250YWluZXIpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMDsKICAgICAgICAgICAgcmV0dXJuIGRhc2hib2FyZENvbnRhaW5lci5hZGROZXdFbWJlZGRhYmxlKHR5cGUsIGV4cGxpY2l0SW5wdXQpOwoKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwoKICBuYXZBY3Rpb25zW190b3BfbmF2X2lkcy5Ub3BOYXZJZHMuT1BUSU9OU10gPSBmdW5jdGlvbiAoYW5jaG9yRWxlbWVudCkgewogICAgKDAsIF9zaG93X29wdGlvbnNfcG9wb3Zlci5zaG93T3B0aW9uc1BvcG92ZXIpKHsKICAgICAgYW5jaG9yRWxlbWVudDogYW5jaG9yRWxlbWVudCwKICAgICAgdXNlTWFyZ2luczogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFVzZU1hcmdpbnMoKSwKICAgICAgb25Vc2VNYXJnaW5zQ2hhbmdlOiBmdW5jdGlvbiBvblVzZU1hcmdpbnNDaGFuZ2UoaXNDaGVja2VkKSB7CiAgICAgICAgZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLnNldFVzZU1hcmdpbnMoaXNDaGVja2VkKTsKICAgICAgfSwKICAgICAgaGlkZVBhbmVsVGl0bGVzOiBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0SGlkZVBhbmVsVGl0bGVzKCksCiAgICAgIG9uSGlkZVBhbmVsVGl0bGVzQ2hhbmdlOiBmdW5jdGlvbiBvbkhpZGVQYW5lbFRpdGxlc0NoYW5nZShpc0NoZWNrZWQpIHsKICAgICAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuc2V0SGlkZVBhbmVsVGl0bGVzKGlzQ2hlY2tlZCk7CiAgICAgIH0KICAgIH0pOwogIH07CgogIG5hdkFjdGlvbnNbX3RvcF9uYXZfaWRzLlRvcE5hdklkcy5TSEFSRV0gPSBmdW5jdGlvbiAoYW5jaG9yRWxlbWVudCkgewogICAgc2hhcmUudG9nZ2xlU2hhcmVDb250ZXh0TWVudSh7CiAgICAgIGFuY2hvckVsZW1lbnQ6IGFuY2hvckVsZW1lbnQsCiAgICAgIGFsbG93RW1iZWQ6IHRydWUsCiAgICAgIGFsbG93U2hvcnRVcmw6ICFkYXNoYm9hcmRDb25maWcuZ2V0SGlkZVdyaXRlQ29udHJvbHMoKSB8fCBkYXNoYm9hcmRDYXBhYmlsaXRpZXMuY3JlYXRlU2hvcnRVcmwsCiAgICAgIHNoYXJlYWJsZVVybDogKDAsIF9wdWJsaWM1LnVuaGFzaFVybCkod2luZG93LmxvY2F0aW9uLmhyZWYpLAogICAgICBvYmplY3RJZDogZGFzaC5pZCwKICAgICAgb2JqZWN0VHlwZTogJ2Rhc2hib2FyZCcsCiAgICAgIHNoYXJpbmdEYXRhOiB7CiAgICAgICAgdGl0bGU6IGRhc2gudGl0bGUKICAgICAgfSwKICAgICAgaXNEaXJ0eTogZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldElzRGlydHkoKQogICAgfSk7CiAgfTsKCiAgdXBkYXRlVmlld01vZGUoZGFzaGJvYXJkU3RhdGVNYW5hZ2VyLmdldFZpZXdNb2RlKCkpOyAvLyB1cGRhdGUgcm9vdCBzb3VyY2Ugd2hlbiBmaWx0ZXJzIHVwZGF0ZQoKICB2YXIgdXBkYXRlU3Vic2NyaXB0aW9uID0gcXVlcnlGaWx0ZXIuZ2V0VXBkYXRlcyQoKS5zdWJzY3JpYmUoewogICAgbmV4dDogZnVuY3Rpb24gbmV4dCgpIHsKICAgICAgJHNjb3BlLm1vZGVsLmZpbHRlcnMgPSBxdWVyeUZpbHRlci5nZXRGaWx0ZXJzKCk7CiAgICAgIGRhc2hib2FyZFN0YXRlTWFuYWdlci5hcHBseUZpbHRlcnMoJHNjb3BlLm1vZGVsLnF1ZXJ5LCAkc2NvcGUubW9kZWwuZmlsdGVycyk7CgogICAgICBpZiAoZGFzaGJvYXJkQ29udGFpbmVyKSB7CiAgICAgICAgZGFzaGJvYXJkQ29udGFpbmVyLnVwZGF0ZUlucHV0KHsKICAgICAgICAgIGZpbHRlcnM6ICRzY29wZS5tb2RlbC5maWx0ZXJzCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9KTsKICB2YXIgdmlzaWJsZVN1YnNjcmlwdGlvbiA9IGNocm9tZS5nZXRJc1Zpc2libGUkKCkuc3Vic2NyaWJlKGZ1bmN0aW9uIChpc1Zpc2libGUpIHsKICAgICRzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHsKICAgICAgJHNjb3BlLmlzVmlzaWJsZSA9IGlzVmlzaWJsZTsKICAgIH0pOwogIH0pOwogIGRhc2hib2FyZFN0YXRlTWFuYWdlci5yZWdpc3RlckNoYW5nZUxpc3RlbmVyKGZ1bmN0aW9uICgpIHsKICAgIC8vIHZpZXcgbW9kZSBjb3VsZCBoYXZlIGNoYW5nZWQsIHNvIHRyaWdnZXIgdG9wIG5hdiB1cGRhdGUKICAgICRzY29wZS50b3BOYXZNZW51ID0gKDAsIF9nZXRfdG9wX25hdl9jb25maWcuZ2V0VG9wTmF2Q29uZmlnKShkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZ2V0Vmlld01vZGUoKSwgbmF2QWN0aW9ucywgZGFzaGJvYXJkQ29uZmlnLmdldEhpZGVXcml0ZUNvbnRyb2xzKCkpOwogIH0pOwogICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKCkgewogICAgdXBkYXRlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICBzdG9wU3luY2luZ1F1ZXJ5U2VydmljZVN0YXRlV2l0aFVybCgpOwogICAgc3RvcFN5bmNpbmdBcHBGaWx0ZXJzKCk7CiAgICB2aXNpYmxlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICAkc2NvcGUudGltZWZpbHRlclN1YnNjcmlwdGlvbnMkLnVuc3Vic2NyaWJlKCk7CiAgICBkYXNoYm9hcmRTdGF0ZU1hbmFnZXIuZGVzdHJveSgpOwoKICAgIGlmIChpbnB1dFN1YnNjcmlwdGlvbikgewogICAgICBpbnB1dFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwogICAgfQoKICAgIGlmIChvdXRwdXRTdWJzY3JpcHRpb24pIHsKICAgICAgb3V0cHV0U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICB9CgogICAgaWYgKGRhc2hib2FyZENvbnRhaW5lcikgewogICAgICBkYXNoYm9hcmRDb250YWluZXIuZGVzdHJveSgpOwogICAgfQogIH0pOwp9OwoKZXhwb3J0cy5EYXNoYm9hcmRBcHBDb250cm9sbGVyID0gRGFzaGJvYXJkQXBwQ29udHJvbGxlcjs="},null]}