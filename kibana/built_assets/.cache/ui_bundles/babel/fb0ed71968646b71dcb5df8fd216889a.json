{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/plugins/maps/public/reducers/map.js","dependencies":[{"path":"x-pack/plugins/maps/public/reducers/map.js","mtime":1589249554445},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLm1hcCA9IG1hcDsKZXhwb3J0cy5yZXNldERhdGFSZXF1ZXN0ID0gcmVzZXREYXRhUmVxdWVzdDsKCnZhciBfbWFwX2FjdGlvbnMgPSByZXF1aXJlKCIuLi9hY3Rpb25zL21hcF9hY3Rpb25zIik7Cgp2YXIgX3V0aWwgPSByZXF1aXJlKCIuL3V0aWwiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBfZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNvdXJjZVtrZXldKTsgfSk7IH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsgfSBlbHNlIHsgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsgfSk7IH0gfSByZXR1cm4gdGFyZ2V0OyB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfQoKdmFyIGdldExheWVySW5kZXggPSBmdW5jdGlvbiBnZXRMYXllckluZGV4KGxpc3QsIGxheWVySWQpIHsKICByZXR1cm4gbGlzdC5maW5kSW5kZXgoZnVuY3Rpb24gKF9yZWYpIHsKICAgIHZhciBpZCA9IF9yZWYuaWQ7CiAgICByZXR1cm4gbGF5ZXJJZCA9PT0gaWQ7CiAgfSk7Cn07Cgp2YXIgdXBkYXRlTGF5ZXJJbkxpc3QgPSBmdW5jdGlvbiB1cGRhdGVMYXllckluTGlzdChzdGF0ZSwgbGF5ZXJJZCwgYXR0cmlidXRlLCBuZXdWYWx1ZSkgewogIGlmICghbGF5ZXJJZCkgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIGxheWVyTGlzdCA9IHN0YXRlLmxheWVyTGlzdDsKICB2YXIgbGF5ZXJJZHggPSBnZXRMYXllckluZGV4KGxheWVyTGlzdCwgbGF5ZXJJZCk7CgogIHZhciB1cGRhdGVkTGF5ZXIgPSBfb2JqZWN0U3ByZWFkKHt9LCBsYXllckxpc3RbbGF5ZXJJZHhdLCBfZGVmaW5lUHJvcGVydHkoe30sIGF0dHJpYnV0ZSwgbmV3VmFsdWUgfHwgbmV3VmFsdWUgPT09ICcnIHx8IG5ld1ZhbHVlID09PSAwID8gbmV3VmFsdWUgOiAhbGF5ZXJMaXN0W2xheWVySWR4XVthdHRyaWJ1dGVdKSk7CgogIHZhciB1cGRhdGVkTGlzdCA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKDAsIGxheWVySWR4KSksIFt1cGRhdGVkTGF5ZXJdLCBfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKGxheWVySWR4ICsgMSkpKTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogdXBkYXRlZExpc3QKICB9KTsKfTsKCnZhciB1cGRhdGVMYXllclNvdXJjZURlc2NyaXB0b3JQcm9wID0gZnVuY3Rpb24gdXBkYXRlTGF5ZXJTb3VyY2VEZXNjcmlwdG9yUHJvcChzdGF0ZSwgbGF5ZXJJZCwgcHJvcE5hbWUsIHZhbHVlLCBuZXdMYXllclR5cGUpIHsKICB2YXIgbGF5ZXJMaXN0ID0gc3RhdGUubGF5ZXJMaXN0OwogIHZhciBsYXllcklkeCA9IGdldExheWVySW5kZXgobGF5ZXJMaXN0LCBsYXllcklkKTsKCiAgdmFyIHVwZGF0ZWRMYXllciA9IF9vYmplY3RTcHJlYWQoe30sIGxheWVyTGlzdFtsYXllcklkeF0sIHsKICAgIHNvdXJjZURlc2NyaXB0b3I6IF9vYmplY3RTcHJlYWQoe30sIGxheWVyTGlzdFtsYXllcklkeF0uc291cmNlRGVzY3JpcHRvciwgX2RlZmluZVByb3BlcnR5KHt9LCBwcm9wTmFtZSwgdmFsdWUpKQogIH0pOwoKICBpZiAobmV3TGF5ZXJUeXBlKSB7CiAgICB1cGRhdGVkTGF5ZXIudHlwZSA9IG5ld0xheWVyVHlwZTsKICB9CgogIHZhciB1cGRhdGVkTGlzdCA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKDAsIGxheWVySWR4KSksIFt1cGRhdGVkTGF5ZXJdLCBfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKGxheWVySWR4ICsgMSkpKTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogdXBkYXRlZExpc3QKICB9KTsKfTsKCnZhciBJTklUSUFMX1NUQVRFID0gewogIHJlYWR5OiBmYWxzZSwKICBtYXBJbml0RXJyb3I6IG51bGwsCiAgZ290bzogbnVsbCwKICBvcGVuVG9vbHRpcHM6IFtdLAogIG1hcFN0YXRlOiB7CiAgICB6b29tOiBudWxsLAogICAgLy8gc2V0dGluZyB0aGlzIHZhbHVlIGRvZXMgbm90IGFkanVzdCBtYXAgem9vbSwgcmVhZCBvbmx5IHZhbHVlIHVzZWQgdG8gc3RvcmUgY3VycmVudCBtYXAgem9vbSBmb3IgcGVyc2lzdGluZyBiZXR3ZWVuIHNlc3Npb25zCiAgICBjZW50ZXI6IG51bGwsCiAgICAvLyBzZXR0aW5nIHRoaXMgdmFsdWUgZG9lcyBub3QgYWRqdXN0IG1hcCB2aWV3LCByZWFkIG9ubHkgdmFsdWUgdXNlZCB0byBzdG9yZSBjdXJyZW50IG1hcCBjZW50ZXIgZm9yIHBlcnNpc3RpbmcgYmV0d2VlbiBzZXNzaW9ucwogICAgc2Nyb2xsWm9vbTogdHJ1ZSwKICAgIGV4dGVudDogbnVsbCwKICAgIG1vdXNlQ29vcmRpbmF0ZXM6IG51bGwsCiAgICB0aW1lRmlsdGVyczogbnVsbCwKICAgIHF1ZXJ5OiBudWxsLAogICAgZmlsdGVyczogW10sCiAgICByZWZyZXNoQ29uZmlnOiBudWxsLAogICAgcmVmcmVzaFRpbWVyTGFzdFRyaWdnZXJlZEF0OiBudWxsLAogICAgZHJhd1N0YXRlOiBudWxsLAogICAgZGlzYWJsZUludGVyYWN0aXZlOiBmYWxzZSwKICAgIGRpc2FibGVUb29sdGlwQ29udHJvbDogZmFsc2UsCiAgICBoaWRlVG9vbGJhck92ZXJsYXk6IGZhbHNlLAogICAgaGlkZUxheWVyQ29udHJvbDogZmFsc2UsCiAgICBoaWRlVmlld0NvbnRyb2w6IGZhbHNlCiAgfSwKICBzZWxlY3RlZExheWVySWQ6IG51bGwsCiAgX190cmFuc2llbnRMYXllcklkOiBudWxsLAogIGxheWVyTGlzdDogW10sCiAgd2FpdGluZ0Zvck1hcFJlYWR5TGF5ZXJMaXN0OiBbXQp9OwoKZnVuY3Rpb24gbWFwKCkgewogIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogSU5JVElBTF9TVEFURTsKICB2YXIgYWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CgogIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHsKICAgIGNhc2UgX21hcF9hY3Rpb25zLlVQREFURV9EUkFXX1NUQVRFOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIGRyYXdTdGF0ZTogYWN0aW9uLmRyYXdTdGF0ZQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlJFTU9WRV9UUkFDS0VEX0xBWUVSX1NUQVRFOgogICAgICByZXR1cm4gcmVtb3ZlVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGFjdGlvbi5sYXllcklkKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5UUkFDS19DVVJSRU5UX0xBWUVSX1NUQVRFOgogICAgICByZXR1cm4gdHJhY2tDdXJyZW50TGF5ZXJTdGF0ZShzdGF0ZSwgYWN0aW9uLmxheWVySWQpOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlJPTExCQUNLX1RPX1RSQUNLRURfTEFZRVJfU1RBVEU6CiAgICAgIHJldHVybiByb2xsYmFja1RyYWNrZWRMYXllclN0YXRlKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuU0VUX09QRU5fVE9PTFRJUFM6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG9wZW5Ub29sdGlwczogYWN0aW9uLm9wZW5Ub29sdGlwcwogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfTU9VU0VfQ09PUkRJTkFURVM6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgbW91c2VDb29yZGluYXRlczogewogICAgICAgICAgICBsYXQ6IGFjdGlvbi5sYXQsCiAgICAgICAgICAgIGxvbjogYWN0aW9uLmxvbgogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkNMRUFSX01PVVNFX0NPT1JESU5BVEVTOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBtYXBTdGF0ZTogX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubWFwU3RhdGUsIHsKICAgICAgICAgIG1vdXNlQ29vcmRpbmF0ZXM6IG51bGwKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfR09UTzoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgZ290bzogewogICAgICAgICAgY2VudGVyOiBhY3Rpb24uY2VudGVyLAogICAgICAgICAgYm91bmRzOiBhY3Rpb24uYm91bmRzCiAgICAgICAgfQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5DTEVBUl9HT1RPOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBnb3RvOiBudWxsCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9MQVlFUl9FUlJPUl9TVEFUVVM6CiAgICAgIHZhciBsYXllckxpc3QgPSBzdGF0ZS5sYXllckxpc3Q7CiAgICAgIHZhciBsYXllcklkeCA9IGdldExheWVySW5kZXgobGF5ZXJMaXN0LCBhY3Rpb24ubGF5ZXJJZCk7CgogICAgICBpZiAobGF5ZXJJZHggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICB9CgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBsYXllckxpc3Q6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkobGF5ZXJMaXN0LnNsaWNlKDAsIGxheWVySWR4KSksIFtfb2JqZWN0U3ByZWFkKHt9LCBsYXllckxpc3RbbGF5ZXJJZHhdLCB7CiAgICAgICAgICBfX2lzSW5FcnJvclN0YXRlOiBhY3Rpb24uaXNJbkVycm9yU3RhdGUsCiAgICAgICAgICBfX2Vycm9yTWVzc2FnZTogYWN0aW9uLmVycm9yTWVzc2FnZQogICAgICAgIH0pXSwgX3RvQ29uc3VtYWJsZUFycmF5KGxheWVyTGlzdC5zbGljZShsYXllcklkeCArIDEpKSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX1NPVVJDRV9EQVRBX1JFUVVFU1Q6CiAgICAgIHJldHVybiB1cGRhdGVTb3VyY2VEYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5MQVlFUl9EQVRBX0xPQURfU1RBUlRFRDoKICAgICAgcmV0dXJuIHVwZGF0ZVdpdGhEYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5MQVlFUl9EQVRBX0xPQURfRVJST1I6CiAgICAgIHJldHVybiB1cGRhdGVXaXRoRGF0YVJlc3BvbnNlKHN0YXRlLCBhY3Rpb24pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLkxBWUVSX0RBVEFfTE9BRF9FTkRFRDoKICAgICAgcmV0dXJuIHVwZGF0ZVdpdGhEYXRhUmVzcG9uc2Uoc3RhdGUsIGFjdGlvbik7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuTUFQX1JFQURZOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICByZWFkeTogdHJ1ZQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5NQVBfREVTVFJPWUVEOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICByZWFkeTogZmFsc2UKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuTUFQX0VYVEVOVF9DSEFOR0VEOgogICAgICB2YXIgbmV3TWFwU3RhdGUgPSB7CiAgICAgICAgY2VudGVyOiBhY3Rpb24ubWFwU3RhdGUuY2VudGVyLAogICAgICAgIHpvb206IGFjdGlvbi5tYXBTdGF0ZS56b29tLAogICAgICAgIGV4dGVudDogYWN0aW9uLm1hcFN0YXRlLmV4dGVudCwKICAgICAgICBidWZmZXI6IGFjdGlvbi5tYXBTdGF0ZS5idWZmZXIKICAgICAgfTsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7fSwgbmV3TWFwU3RhdGUpCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9RVUVSWToKICAgICAgdmFyIHF1ZXJ5ID0gYWN0aW9uLnF1ZXJ5LAogICAgICAgICAgdGltZUZpbHRlcnMgPSBhY3Rpb24udGltZUZpbHRlcnMsCiAgICAgICAgICBmaWx0ZXJzID0gYWN0aW9uLmZpbHRlcnM7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgdGltZUZpbHRlcnM6IHRpbWVGaWx0ZXJzLAogICAgICAgICAgZmlsdGVyczogZmlsdGVycwogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9SRUZSRVNIX0NPTkZJRzoKICAgICAgdmFyIGlzUGF1c2VkID0gYWN0aW9uLmlzUGF1c2VkLAogICAgICAgICAgaW50ZXJ2YWwgPSBhY3Rpb24uaW50ZXJ2YWw7CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgcmVmcmVzaENvbmZpZzogewogICAgICAgICAgICBpc1BhdXNlZDogaXNQYXVzZWQsCiAgICAgICAgICAgIGludGVydmFsOiBpbnRlcnZhbAogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlRSSUdHRVJfUkVGUkVTSF9USU1FUjoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICByZWZyZXNoVGltZXJMYXN0VHJpZ2dlcmVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9TRUxFQ1RFRF9MQVlFUjoKICAgICAgdmFyIHNlbGVjdGVkTWF0Y2ggPSBzdGF0ZS5sYXllckxpc3QuZmluZChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIuaWQgPT09IGFjdGlvbi5zZWxlY3RlZExheWVySWQ7CiAgICAgIH0pOwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBzZWxlY3RlZExheWVySWQ6IHNlbGVjdGVkTWF0Y2ggPyBhY3Rpb24uc2VsZWN0ZWRMYXllcklkIDogbnVsbAogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfVFJBTlNJRU5UX0xBWUVSOgogICAgICB2YXIgdHJhbnNpZW50TWF0Y2ggPSBzdGF0ZS5sYXllckxpc3QuZmluZChmdW5jdGlvbiAobGF5ZXIpIHsKICAgICAgICByZXR1cm4gbGF5ZXIuaWQgPT09IGFjdGlvbi50cmFuc2llbnRMYXllcklkOwogICAgICB9KTsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgX190cmFuc2llbnRMYXllcklkOiB0cmFuc2llbnRNYXRjaCA/IGFjdGlvbi50cmFuc2llbnRMYXllcklkIDogbnVsbAogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5VUERBVEVfTEFZRVJfT1JERVI6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGxheWVyTGlzdDogYWN0aW9uLm5ld0xheWVyT3JkZXIubWFwKGZ1bmN0aW9uIChsYXllck51bWJlcikgewogICAgICAgICAgcmV0dXJuIHN0YXRlLmxheWVyTGlzdFtsYXllck51bWJlcl07CiAgICAgICAgfSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX0xBWUVSX1BST1A6CiAgICAgIHJldHVybiB1cGRhdGVMYXllckluTGlzdChzdGF0ZSwgYWN0aW9uLmlkLCBhY3Rpb24ucHJvcE5hbWUsIGFjdGlvbi5uZXdWYWx1ZSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX1NPVVJDRV9QUk9QOgogICAgICByZXR1cm4gdXBkYXRlTGF5ZXJTb3VyY2VEZXNjcmlwdG9yUHJvcChzdGF0ZSwgYWN0aW9uLmxheWVySWQsIGFjdGlvbi5wcm9wTmFtZSwgYWN0aW9uLnZhbHVlLCBhY3Rpb24ubmV3TGF5ZXJUeXBlKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfSk9JTlM6CiAgICAgIHZhciBsYXllckRlc2NyaXB0b3IgPSBzdGF0ZS5sYXllckxpc3QuZmluZChmdW5jdGlvbiAoZGVzY3JpcHRvcikgewogICAgICAgIHJldHVybiBkZXNjcmlwdG9yLmlkID09PSBhY3Rpb24ubGF5ZXIuZ2V0SWQoKTsKICAgICAgfSk7CgogICAgICBpZiAobGF5ZXJEZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIG5ld0xheWVyRGVzY3JpcHRvciA9IF9vYmplY3RTcHJlYWQoe30sIGxheWVyRGVzY3JpcHRvciwgewogICAgICAgICAgam9pbnM6IGFjdGlvbi5qb2lucy5zbGljZSgpCiAgICAgICAgfSk7CgogICAgICAgIHZhciBfaW5kZXggPSBzdGF0ZS5sYXllckxpc3QuZmluZEluZGV4KGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7CiAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvci5pZCA9PT0gYWN0aW9uLmxheWVyLmdldElkKCk7CiAgICAgICAgfSk7CgogICAgICAgIHZhciBuZXdMYXllckxpc3QgPSBzdGF0ZS5sYXllckxpc3Quc2xpY2UoKTsKICAgICAgICBuZXdMYXllckxpc3RbX2luZGV4XSA9IG5ld0xheWVyRGVzY3JpcHRvcjsKICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICAgIGxheWVyTGlzdDogbmV3TGF5ZXJMaXN0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBzdGF0ZTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5BRERfTEFZRVI6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIGxheWVyTGlzdDogW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5sYXllckxpc3QpLCBbYWN0aW9uLmxheWVyXSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuUkVNT1ZFX0xBWUVSOgogICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgICAgICBsYXllckxpc3Q6IF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5sYXllckxpc3QuZmlsdGVyKGZ1bmN0aW9uIChfcmVmMikgewogICAgICAgICAgdmFyIGlkID0gX3JlZjIuaWQ7CiAgICAgICAgICByZXR1cm4gaWQgIT09IGFjdGlvbi5pZDsKICAgICAgICB9KSkKICAgICAgfSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuQUREX1dBSVRJTkdfRk9SX01BUF9SRUFEWV9MQVlFUjoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgd2FpdGluZ0Zvck1hcFJlYWR5TGF5ZXJMaXN0OiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLndhaXRpbmdGb3JNYXBSZWFkeUxheWVyTGlzdCksIFthY3Rpb24ubGF5ZXJdKQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5DTEVBUl9XQUlUSU5HX0ZPUl9NQVBfUkVBRFlfTEFZRVJfTElTVDoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgd2FpdGluZ0Zvck1hcFJlYWR5TGF5ZXJMaXN0OiBbXQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfTEFZRVJfVklTSUJJTElUWToKICAgICAgcmV0dXJuIHVwZGF0ZUxheWVySW5MaXN0KHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCwgJ3Zpc2libGUnLCBhY3Rpb24udmlzaWJpbGl0eSk7CgogICAgY2FzZSBfbWFwX2FjdGlvbnMuVVBEQVRFX0xBWUVSX1NUWUxFOgogICAgICB2YXIgc3R5bGVMYXllcklkID0gYWN0aW9uLmxheWVySWQ7CiAgICAgIHJldHVybiB1cGRhdGVMYXllckluTGlzdChzdGF0ZSwgc3R5bGVMYXllcklkLCAnc3R5bGUnLCBfb2JqZWN0U3ByZWFkKHt9LCBhY3Rpb24uc3R5bGUpKTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfTEFZRVJfU1RZTEVfTUVUQToKICAgICAgdmFyIGxheWVySWQgPSBhY3Rpb24ubGF5ZXJJZCwKICAgICAgICAgIHN0eWxlTWV0YSA9IGFjdGlvbi5zdHlsZU1ldGE7CiAgICAgIHZhciBpbmRleCA9IGdldExheWVySW5kZXgoc3RhdGUubGF5ZXJMaXN0LCBsYXllcklkKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgIH0KCiAgICAgIHJldHVybiB1cGRhdGVMYXllckluTGlzdChzdGF0ZSwgbGF5ZXJJZCwgJ3N0eWxlJywgX29iamVjdFNwcmVhZCh7fSwgc3RhdGUubGF5ZXJMaXN0W2luZGV4XS5zdHlsZSwgewogICAgICAgIF9fc3R5bGVNZXRhOiBzdHlsZU1ldGEKICAgICAgfSkpOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9TQ1JPTExfWk9PTToKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBzY3JvbGxab29tOiBhY3Rpb24uc2Nyb2xsWm9vbQogICAgICAgIH0pCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9NQVBfSU5JVF9FUlJPUjoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwSW5pdEVycm9yOiBhY3Rpb24uZXJyb3JNZXNzYWdlCiAgICAgIH0pOwoKICAgIGNhc2UgX21hcF9hY3Rpb25zLlNFVF9JTlRFUkFDVElWRToKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBkaXNhYmxlSW50ZXJhY3RpdmU6IGFjdGlvbi5kaXNhYmxlSW50ZXJhY3RpdmUKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5ESVNBQkxFX1RPT0xUSVBfQ09OVFJPTDoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBkaXNhYmxlVG9vbHRpcENvbnRyb2w6IGFjdGlvbi5kaXNhYmxlVG9vbHRpcENvbnRyb2wKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5ISURFX1RPT0xCQVJfT1ZFUkxBWToKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBoaWRlVG9vbGJhck92ZXJsYXk6IGFjdGlvbi5oaWRlVG9vbGJhck92ZXJsYXkKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5ISURFX0xBWUVSX0NPTlRST0w6CiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgICAgIG1hcFN0YXRlOiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZS5tYXBTdGF0ZSwgewogICAgICAgICAgaGlkZUxheWVyQ29udHJvbDogYWN0aW9uLmhpZGVMYXllckNvbnRyb2wKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5ISURFX1ZJRVdfQ09OVFJPTDoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgbWFwU3RhdGU6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm1hcFN0YXRlLCB7CiAgICAgICAgICBoaWRlVmlld0NvbnRyb2w6IGFjdGlvbi5oaWRlVmlld0NvbnRyb2wKICAgICAgICB9KQogICAgICB9KTsKCiAgICBjYXNlIF9tYXBfYWN0aW9ucy5TRVRfV0FJVElOR19GT1JfUkVBRFlfSElEREVOX0xBWUVSUzoKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgd2FpdGluZ0Zvck1hcFJlYWR5TGF5ZXJMaXN0OiBzdGF0ZS53YWl0aW5nRm9yTWFwUmVhZHlMYXllckxpc3QubWFwKGZ1bmN0aW9uIChsYXllcikgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIGxheWVyLCB7CiAgICAgICAgICAgIHZpc2libGU6ICFhY3Rpb24uaGlkZGVuTGF5ZXJJZHMuaW5jbHVkZXMobGF5ZXIuaWQpCiAgICAgICAgICB9KTsKICAgICAgICB9KQogICAgICB9KTsKCiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gc3RhdGU7CiAgfQp9CgpmdW5jdGlvbiBmaW5kRGF0YVJlcXVlc3QobGF5ZXJEZXNjcmlwdG9yLCBkYXRhUmVxdWVzdEFjdGlvbikgewogIGlmICghbGF5ZXJEZXNjcmlwdG9yLl9fZGF0YVJlcXVlc3RzKSB7CiAgICByZXR1cm47CiAgfQoKICByZXR1cm4gbGF5ZXJEZXNjcmlwdG9yLl9fZGF0YVJlcXVlc3RzLmZpbmQoZnVuY3Rpb24gKGRhdGFSZXF1ZXN0KSB7CiAgICByZXR1cm4gZGF0YVJlcXVlc3QuZGF0YUlkID09PSBkYXRhUmVxdWVzdEFjdGlvbi5kYXRhSWQ7CiAgfSk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVdpdGhEYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uKSB7CiAgdmFyIGRhdGFSZXF1ZXN0ID0gZ2V0VmFsaWREYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uLCBmYWxzZSk7CiAgdmFyIGxheWVyUmVxdWVzdGluZ0RhdGEgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogIGlmICghZGF0YVJlcXVlc3QpIHsKICAgIGRhdGFSZXF1ZXN0ID0gewogICAgICBkYXRhSWQ6IGFjdGlvbi5kYXRhSWQKICAgIH07CiAgICBsYXllclJlcXVlc3RpbmdEYXRhLl9fZGF0YVJlcXVlc3RzID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShsYXllclJlcXVlc3RpbmdEYXRhLl9fZGF0YVJlcXVlc3RzID8gbGF5ZXJSZXF1ZXN0aW5nRGF0YS5fX2RhdGFSZXF1ZXN0cyA6IFtdKSwgW2RhdGFSZXF1ZXN0XSk7CiAgfQoKICBkYXRhUmVxdWVzdC5kYXRhTWV0YUF0U3RhcnQgPSBhY3Rpb24ubWV0YTsKICBkYXRhUmVxdWVzdC5kYXRhUmVxdWVzdFRva2VuID0gYWN0aW9uLnJlcXVlc3RUb2tlbjsKCiAgdmFyIGxheWVyTGlzdCA9IF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5sYXllckxpc3QpOwoKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogbGF5ZXJMaXN0CiAgfSk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZVNvdXJjZURhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24pIHsKICB2YXIgbGF5ZXJEZXNjcmlwdG9yID0gZmluZExheWVyQnlJZChzdGF0ZSwgYWN0aW9uLmxheWVySWQpOwoKICBpZiAoIWxheWVyRGVzY3JpcHRvcikgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIGRhdGFSZXF1ZXN0ID0gbGF5ZXJEZXNjcmlwdG9yLl9fZGF0YVJlcXVlc3RzLmZpbmQoZnVuY3Rpb24gKGRhdGFSZXF1ZXN0KSB7CiAgICByZXR1cm4gZGF0YVJlcXVlc3QuZGF0YUlkID09PSBfY29uc3RhbnRzLlNPVVJDRV9EQVRBX0lEX09SSUdJTjsKICB9KTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgZGF0YVJlcXVlc3QuZGF0YSA9IGFjdGlvbi5uZXdEYXRhOwogIHJldHVybiByZXNldERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24sIGRhdGFSZXF1ZXN0KTsKfQoKZnVuY3Rpb24gdXBkYXRlV2l0aERhdGFSZXNwb25zZShzdGF0ZSwgYWN0aW9uKSB7CiAgdmFyIGRhdGFSZXF1ZXN0ID0gZ2V0VmFsaWREYXRhUmVxdWVzdChzdGF0ZSwgYWN0aW9uKTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgZGF0YVJlcXVlc3QuZGF0YSA9IGFjdGlvbi5kYXRhOwogIGRhdGFSZXF1ZXN0LmRhdGFNZXRhID0gX29iamVjdFNwcmVhZCh7fSwgZGF0YVJlcXVlc3QuZGF0YU1ldGFBdFN0YXJ0LCB7fSwgYWN0aW9uLm1ldGEpOwogIGRhdGFSZXF1ZXN0LmRhdGFNZXRhQXRTdGFydCA9IG51bGw7CiAgcmV0dXJuIHJlc2V0RGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbiwgZGF0YVJlcXVlc3QpOwp9CgpmdW5jdGlvbiByZXNldERhdGFSZXF1ZXN0KHN0YXRlLCBhY3Rpb24sIHJlcXVlc3QpIHsKICB2YXIgZGF0YVJlcXVlc3QgPSByZXF1ZXN0IHx8IGdldFZhbGlkRGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbik7CgogIGlmICghZGF0YVJlcXVlc3QpIHsKICAgIHJldHVybiBzdGF0ZTsKICB9CgogIHZhciBsYXllciA9IGZpbmRMYXllckJ5SWQoc3RhdGUsIGFjdGlvbi5sYXllcklkKTsKCiAgdmFyIGRhdGFSZXF1ZXN0SW5kZXggPSBsYXllci5fX2RhdGFSZXF1ZXN0cy5pbmRleE9mKGRhdGFSZXF1ZXN0KTsKCiAgdmFyIG5ld0RhdGFSZXF1ZXN0cyA9IF90b0NvbnN1bWFibGVBcnJheShsYXllci5fX2RhdGFSZXF1ZXN0cyk7CgogIG5ld0RhdGFSZXF1ZXN0c1tkYXRhUmVxdWVzdEluZGV4XSA9IF9vYmplY3RTcHJlYWQoe30sIGRhdGFSZXF1ZXN0LCB7CiAgICBkYXRhUmVxdWVzdFRva2VuOiBudWxsCiAgfSk7CiAgdmFyIGxheWVySW5kZXggPSBzdGF0ZS5sYXllckxpc3QuaW5kZXhPZihsYXllcik7CgogIHZhciBuZXdMYXllckxpc3QgPSBfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUubGF5ZXJMaXN0KTsKCiAgbmV3TGF5ZXJMaXN0W2xheWVySW5kZXhdID0gX29iamVjdFNwcmVhZCh7fSwgbGF5ZXIsIHsKICAgIF9fZGF0YVJlcXVlc3RzOiBuZXdEYXRhUmVxdWVzdHMKICB9KTsKICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIHsKICAgIGxheWVyTGlzdDogbmV3TGF5ZXJMaXN0CiAgfSk7Cn0KCmZ1bmN0aW9uIGdldFZhbGlkRGF0YVJlcXVlc3Qoc3RhdGUsIGFjdGlvbikgewogIHZhciBjaGVja1JlcXVlc3RUb2tlbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogdHJ1ZTsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBhY3Rpb24ubGF5ZXJJZCk7CgogIGlmICghbGF5ZXIpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBkYXRhUmVxdWVzdCA9IGZpbmREYXRhUmVxdWVzdChsYXllciwgYWN0aW9uKTsKCiAgaWYgKCFkYXRhUmVxdWVzdCkgewogICAgcmV0dXJuOwogIH0KCiAgaWYgKGNoZWNrUmVxdWVzdFRva2VuICYmIGRhdGFSZXF1ZXN0LmRhdGFSZXF1ZXN0VG9rZW4gJiYgZGF0YVJlcXVlc3QuZGF0YVJlcXVlc3RUb2tlbiAhPT0gYWN0aW9uLnJlcXVlc3RUb2tlbikgewogICAgLy8gaWdub3JlIHJlc3BvbnNlcyB0byBvdXRkYXRlZCByZXF1ZXN0cwogICAgcmV0dXJuOwogIH0KCiAgcmV0dXJuIGRhdGFSZXF1ZXN0Owp9CgpmdW5jdGlvbiBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBpZCkgewogIHJldHVybiBzdGF0ZS5sYXllckxpc3QuZmluZChmdW5jdGlvbiAobGF5ZXIpIHsKICAgIHJldHVybiBsYXllci5pZCA9PT0gaWQ7CiAgfSk7Cn0KCmZ1bmN0aW9uIHRyYWNrQ3VycmVudExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKICB2YXIgbGF5ZXJDb3B5ID0gKDAsIF91dGlsLmNvcHlQZXJzaXN0ZW50U3RhdGUpKGxheWVyKTsKICByZXR1cm4gdXBkYXRlTGF5ZXJJbkxpc3Qoc3RhdGUsIGxheWVySWQsIF91dGlsLlRSQUNLRURfTEFZRVJfREVTQ1JJUFRPUiwgbGF5ZXJDb3B5KTsKfQoKZnVuY3Rpb24gcmVtb3ZlVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKCiAgaWYgKCFsYXllcikgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIGNvcHlMYXllciA9IF9vYmplY3RTcHJlYWQoe30sIGxheWVyKTsKCiAgZGVsZXRlIGNvcHlMYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiByZXBsYWNlSW5MYXllckxpc3Qoc3RhdGUubGF5ZXJMaXN0LCBsYXllcklkLCBjb3B5TGF5ZXIpCiAgfSk7Cn0KCmZ1bmN0aW9uIHJvbGxiYWNrVHJhY2tlZExheWVyU3RhdGUoc3RhdGUsIGxheWVySWQpIHsKICB2YXIgbGF5ZXIgPSBmaW5kTGF5ZXJCeUlkKHN0YXRlLCBsYXllcklkKTsKCiAgaWYgKCFsYXllcikgewogICAgcmV0dXJuIHN0YXRlOwogIH0KCiAgdmFyIHRyYWNrZWRMYXllckRlc2NyaXB0b3IgPSBsYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOyAvL3RoaXMgYXNzdW1lcyB0aGF0IGFueSBuZXN0ZWQgdGVtcC1zdGF0ZSBpbiB0aGUgbGF5ZXItZGVzY3JpcHRvciAoZS5nLiBvZiBzdHlsZXMpLCBpcyBub3QgcmVsZXZhbnQgYW5kIGNhbiBiZSByZWNvdmVyZWQgZWFzaWx5IChlLmcuIHRoaXMgaXMgbm90IHRoZSBjYXNlIGZvciBfX2RhdGFSZXF1ZXN0cykKICAvL1RoYXQgYXNzdW1wdGlvbiBpcyB0cnVlIGluIHRoZSBjb250ZXh0IG9mIHRoaXMgYXBwLCBidXQgbm90IGdlbmVyYWxpemFibGUuCiAgLy9jb25zaWRlciByZXdyaXRpbmcgY29weVBlcnNpc3RlbnRTdGF0ZSB0byBvbmx5IHN0cmlwIHRoZSBmaXJzdCBsZXZlbCBvZiB0ZW1wIHN0YXRlLgoKICB2YXIgcm9sbGVkYmFja0xheWVyID0gX29iamVjdFNwcmVhZCh7fSwgbGF5ZXIsIHt9LCB0cmFja2VkTGF5ZXJEZXNjcmlwdG9yKTsKCiAgZGVsZXRlIHJvbGxlZGJhY2tMYXllcltfdXRpbC5UUkFDS0VEX0xBWUVSX0RFU0NSSVBUT1JdOwogIHJldHVybiBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSwgewogICAgbGF5ZXJMaXN0OiByZXBsYWNlSW5MYXllckxpc3Qoc3RhdGUubGF5ZXJMaXN0LCBsYXllcklkLCByb2xsZWRiYWNrTGF5ZXIpCiAgfSk7Cn0KCmZ1bmN0aW9uIHJlcGxhY2VJbkxheWVyTGlzdChsYXllckxpc3QsIGxheWVySWQsIG5ld0xheWVyRGVzY3JpcHRvcikgewogIHZhciBsYXllckluZGV4ID0gZ2V0TGF5ZXJJbmRleChsYXllckxpc3QsIGxheWVySWQpOwoKICB2YXIgbmV3TGF5ZXJMaXN0ID0gX3RvQ29uc3VtYWJsZUFycmF5KGxheWVyTGlzdCk7CgogIG5ld0xheWVyTGlzdFtsYXllckluZGV4XSA9IG5ld0xheWVyRGVzY3JpcHRvcjsKICByZXR1cm4gbmV3TGF5ZXJMaXN0Owp9"},null]}