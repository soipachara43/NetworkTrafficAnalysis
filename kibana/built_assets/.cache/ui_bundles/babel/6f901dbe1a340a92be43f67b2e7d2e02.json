{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/api.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/containers/detection_engine/rules/api.js","mtime":1589249553220},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMgPSBleHBvcnRzLmZldGNoVGFncyA9IGV4cG9ydHMuZ2V0UnVsZXNTdGF0dXNCeUlkcyA9IGV4cG9ydHMuZ2V0UnVsZVN0YXR1c0J5SWQgPSBleHBvcnRzLmV4cG9ydFJ1bGVzID0gZXhwb3J0cy5pbXBvcnRSdWxlcyA9IGV4cG9ydHMuY3JlYXRlUHJlcGFja2FnZWRSdWxlcyA9IGV4cG9ydHMuZHVwbGljYXRlUnVsZXMgPSBleHBvcnRzLmRlbGV0ZVJ1bGVzID0gZXhwb3J0cy5lbmFibGVSdWxlcyA9IGV4cG9ydHMuZmV0Y2hSdWxlQnlJZCA9IGV4cG9ydHMuZmV0Y2hSdWxlcyA9IGV4cG9ydHMuYWRkUnVsZSA9IHZvaWQgMDsKCnZhciBfa2liYW5hID0gcmVxdWlyZSgiLi4vLi4vLi4vbGliL2tpYmFuYSIpOwoKdmFyIF9jb25zdGFudHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi9jb21tb24vY29uc3RhbnRzIik7Cgp2YXIgaTE4biA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoIi4uLy4uLy4uL3BhZ2VzL2RldGVjdGlvbl9lbmdpbmUvcnVsZXMvdHJhbnNsYXRpb25zIikpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhzb3VyY2UsIHRydWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOwogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMpIHsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTsKICAgIH0gZWxzZSB7CiAgICAgIG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7CiAgaWYgKGtleSBpbiBvYmopIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsdWUsCiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0gZWxzZSB7CiAgICBvYmpba2V5XSA9IHZhbHVlOwogIH0KCiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgewogIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7Cn0KCmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsKICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZSIpOwp9CgpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsKICBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsKfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgewogIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgIGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgIGFycjJbaV0gPSBhcnJbaV07CiAgICB9CgogICAgcmV0dXJuIGFycjI7CiAgfQp9CgpmdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7CiAgdHJ5IHsKICAgIHZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTsKICAgIHZhciB2YWx1ZSA9IGluZm8udmFsdWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlamVjdChlcnJvcik7CiAgICByZXR1cm47CiAgfQoKICBpZiAoaW5mby5kb25lKSB7CiAgICByZXNvbHZlKHZhbHVlKTsKICB9IGVsc2UgewogICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpOwogIH0KfQoKZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIHNlbGYgPSB0aGlzLAogICAgICAgIGFyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgogICAgICBmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIF90aHJvdyhlcnIpIHsKICAgICAgICBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7CiAgICAgIH0KCiAgICAgIF9uZXh0KHVuZGVmaW5lZCk7CiAgICB9KTsKICB9Owp9Ci8qKgogKiBBZGQgcHJvdmlkZWQgUnVsZQogKgogKiBAcGFyYW0gcnVsZSB0byBhZGQKICogQHBhcmFtIHNpZ25hbCB0byBjYW5jZWwgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgp2YXIgYWRkUnVsZSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoX3JlZjIpIHsKICAgIHZhciBydWxlLCBzaWduYWw7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJ1bGUgPSBfcmVmMi5ydWxlLCBzaWduYWwgPSBfcmVmMi5zaWduYWw7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiBydWxlLmlkICE9IG51bGwgPyAnUFVUJyA6ICdQT1NUJywKICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShydWxlKSwKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9KSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGFkZFJ1bGUoX3gpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwovKioKICogRmV0Y2hlcyBhbGwgcnVsZXMgZnJvbSB0aGUgRGV0ZWN0aW9uIEVuZ2luZSBBUEkKICoKICogQHBhcmFtIGZpbHRlck9wdGlvbnMgZGVzaXJlZCBmaWx0ZXJzIChlLmcuIGZpbHRlci9zb3J0RmllbGQvc29ydE9yZGVyKQogKiBAcGFyYW0gcGFnaW5hdGlvbiBkZXNpcmVkIHBhZ2luYXRpb24gb3B0aW9ucyAoZS5nLiBwYWdlL3BlclBhZ2UpCiAqIEBwYXJhbSBzaWduYWwgdG8gY2FuY2VsIHJlcXVlc3QKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5hZGRSdWxlID0gYWRkUnVsZTsKCnZhciBmZXRjaFJ1bGVzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYzID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKF9yZWY0KSB7CiAgICB2YXIgX3JlZjUsIF9maWx0ZXJPcHRpb25zJHRhZ3M7CgogICAgdmFyIF9yZWY0JGZpbHRlck9wdGlvbnMsIGZpbHRlck9wdGlvbnMsIF9yZWY0JHBhZ2luYXRpb24sIHBhZ2luYXRpb24sIHNpZ25hbCwgZmlsdGVycywgcXVlcnk7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX3JlZjQkZmlsdGVyT3B0aW9ucyA9IF9yZWY0LmZpbHRlck9wdGlvbnMsIGZpbHRlck9wdGlvbnMgPSBfcmVmNCRmaWx0ZXJPcHRpb25zID09PSB2b2lkIDAgPyB7CiAgICAgICAgICAgICAgZmlsdGVyOiAnJywKICAgICAgICAgICAgICBzb3J0RmllbGQ6ICdlbmFibGVkJywKICAgICAgICAgICAgICBzb3J0T3JkZXI6ICdkZXNjJywKICAgICAgICAgICAgICBzaG93Q3VzdG9tUnVsZXM6IGZhbHNlLAogICAgICAgICAgICAgIHNob3dFbGFzdGljUnVsZXM6IGZhbHNlLAogICAgICAgICAgICAgIHRhZ3M6IFtdCiAgICAgICAgICAgIH0gOiBfcmVmNCRmaWx0ZXJPcHRpb25zLCBfcmVmNCRwYWdpbmF0aW9uID0gX3JlZjQucGFnaW5hdGlvbiwgcGFnaW5hdGlvbiA9IF9yZWY0JHBhZ2luYXRpb24gPT09IHZvaWQgMCA/IHsKICAgICAgICAgICAgICBwYWdlOiAxLAogICAgICAgICAgICAgIHBlclBhZ2U6IDIwLAogICAgICAgICAgICAgIHRvdGFsOiAwCiAgICAgICAgICAgIH0gOiBfcmVmNCRwYWdpbmF0aW9uLCBzaWduYWwgPSBfcmVmNC5zaWduYWw7CiAgICAgICAgICAgIGZpbHRlcnMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGZpbHRlck9wdGlvbnMuZmlsdGVyLmxlbmd0aCA/IFsiYWxlcnQuYXR0cmlidXRlcy5uYW1lOiAiLmNvbmNhdChmaWx0ZXJPcHRpb25zLmZpbHRlcildIDogW10pLCBfdG9Db25zdW1hYmxlQXJyYXkoZmlsdGVyT3B0aW9ucy5zaG93Q3VzdG9tUnVsZXMgPyBbImFsZXJ0LmF0dHJpYnV0ZXMudGFnczogXCJfX2ludGVybmFsX2ltbXV0YWJsZTpmYWxzZVwiIl0gOiBbXSksIF90b0NvbnN1bWFibGVBcnJheShmaWx0ZXJPcHRpb25zLnNob3dFbGFzdGljUnVsZXMgPyBbImFsZXJ0LmF0dHJpYnV0ZXMudGFnczogXCJfX2ludGVybmFsX2ltbXV0YWJsZTp0cnVlXCIiXSA6IFtdKSwgX3RvQ29uc3VtYWJsZUFycmF5KChfcmVmNSA9IChfZmlsdGVyT3B0aW9ucyR0YWdzID0gZmlsdGVyT3B0aW9ucy50YWdzKSA9PT0gbnVsbCB8fCBfZmlsdGVyT3B0aW9ucyR0YWdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZmlsdGVyT3B0aW9ucyR0YWdzLm1hcChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgIHJldHVybiAiYWxlcnQuYXR0cmlidXRlcy50YWdzOiAiLmNvbmNhdCh0KTsKICAgICAgICAgICAgfSkpICE9PSBudWxsICYmIF9yZWY1ICE9PSB2b2lkIDAgPyBfcmVmNSA6IFtdKSk7CiAgICAgICAgICAgIHF1ZXJ5ID0gX29iamVjdFNwcmVhZCh7CiAgICAgICAgICAgICAgcGFnZTogcGFnaW5hdGlvbi5wYWdlLAogICAgICAgICAgICAgIHBlcl9wYWdlOiBwYWdpbmF0aW9uLnBlclBhZ2UsCiAgICAgICAgICAgICAgc29ydF9maWVsZDogZmlsdGVyT3B0aW9ucy5zb3J0RmllbGQsCiAgICAgICAgICAgICAgc29ydF9vcmRlcjogZmlsdGVyT3B0aW9ucy5zb3J0T3JkZXIKICAgICAgICAgICAgfSwgZmlsdGVycy5sZW5ndGggPyB7CiAgICAgICAgICAgICAgZmlsdGVyOiBmaWx0ZXJzLmpvaW4oJyBBTkQgJykKICAgICAgICAgICAgfSA6IHt9KTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaCgiIi5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9fZmluZCIpLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTIpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGZldGNoUnVsZXMoX3gyKSB7CiAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Ci8qKgogKiBGZXRjaCBhIFJ1bGUgYnkgcHJvdmlkaW5nIGEgUnVsZSBJRAogKgogKiBAcGFyYW0gaWQgUnVsZSBJRCdzIChub3QgcnVsZV9pZCkKICogQHBhcmFtIHNpZ25hbCB0byBjYW5jZWwgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmZldGNoUnVsZXMgPSBmZXRjaFJ1bGVzOwoKdmFyIGZldGNoUnVsZUJ5SWQgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX3JlZjcpIHsKICAgIHZhciBpZCwgc2lnbmFsOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWQgPSBfcmVmNy5pZCwgc2lnbmFsID0gX3JlZjcuc2lnbmFsOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgX2tpYmFuYS5LaWJhbmFTZXJ2aWNlcy5nZXQoKS5odHRwLmZldGNoKF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9SVUxFU19VUkwsIHsKICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHNpZ25hbDogc2lnbmFsCiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUzKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBmZXRjaFJ1bGVCeUlkKF94MykgewogICAgcmV0dXJuIF9yZWY2LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpOwovKioKICogRW5hYmxlcy9EaXNhYmxlcyBwcm92aWRlZCBSdWxlIElEJ3MKICoKICogQHBhcmFtIGlkcyBhcnJheSBvZiBSdWxlIElEJ3MgKG5vdCBydWxlX2lkKSB0byBlbmFibGUvZGlzYWJsZQogKiBAcGFyYW0gZW5hYmxlZCB0byBlbmFibGUgb3IgZGlzYWJsZQogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmZldGNoUnVsZUJ5SWQgPSBmZXRjaFJ1bGVCeUlkOwoKdmFyIGVuYWJsZVJ1bGVzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWY4ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWY5KSB7CiAgICB2YXIgaWRzLCBlbmFibGVkOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWRzID0gX3JlZjkuaWRzLCBlbmFibGVkID0gX3JlZjkuZW5hYmxlZDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaCgiIi5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9fYnVsa191cGRhdGUiKSwgewogICAgICAgICAgICAgIG1ldGhvZDogJ1BBVENIJywKICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShpZHMubWFwKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICBlbmFibGVkOiBlbmFibGVkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pKQogICAgICAgICAgICB9KSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlNCk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZW5hYmxlUnVsZXMoX3g0KSB7CiAgICByZXR1cm4gX3JlZjguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Ci8qKgogKiBEZWxldGVzIHByb3ZpZGVkIFJ1bGUgSUQncwogKgogKiBAcGFyYW0gaWRzIGFycmF5IG9mIFJ1bGUgSUQncyAobm90IHJ1bGVfaWQpIHRvIGRlbGV0ZQogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmVuYWJsZVJ1bGVzID0gZW5hYmxlUnVsZXM7Cgp2YXIgZGVsZXRlUnVsZXMgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjEwID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KF9yZWYxMSkgewogICAgdmFyIGlkczsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGlkcyA9IF9yZWYxMS5pZHM7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBfa2liYW5hLktpYmFuYVNlcnZpY2VzLmdldCgpLmh0dHAuZmV0Y2goIiIuY29uY2F0KF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9SVUxFU19VUkwsICIvX2J1bGtfZGVsZXRlIiksIHsKICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLAogICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGlkcy5tYXAoZnVuY3Rpb24gKGlkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU1KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBkZWxldGVSdWxlcyhfeDUpIHsKICAgIHJldHVybiBfcmVmMTAuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Ci8qKgogKiBEdXBsaWNhdGVzIHByb3ZpZGVkIFJ1bGVzCiAqCiAqIEBwYXJhbSBydWxlcyB0byBkdXBsaWNhdGUKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5kZWxldGVSdWxlcyA9IGRlbGV0ZVJ1bGVzOwoKdmFyIGR1cGxpY2F0ZVJ1bGVzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYxMiA9IF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNihfcmVmMTMpIHsKICAgIHZhciBydWxlczsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHJ1bGVzID0gX3JlZjEzLnJ1bGVzOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgX2tpYmFuYS5LaWJhbmFTZXJ2aWNlcy5nZXQoKS5odHRwLmZldGNoKCIiLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCAiL19idWxrX2NyZWF0ZSIpLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocnVsZXMubWFwKGZ1bmN0aW9uIChydWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgcnVsZSwgewogICAgICAgICAgICAgICAgICBuYW1lOiAiIi5jb25jYXQocnVsZS5uYW1lLCAiIFsiKS5jb25jYXQoaTE4bi5EVVBMSUNBVEUsICJdIiksCiAgICAgICAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgY3JlYXRlZF9ieTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBpZDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBydWxlX2lkOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIHVwZGF0ZWRfYXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgdXBkYXRlZF9ieTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBlbmFibGVkOiBydWxlLmVuYWJsZWQsCiAgICAgICAgICAgICAgICAgIGltbXV0YWJsZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBsYXN0X3N1Y2Nlc3NfYXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgbGFzdF9zdWNjZXNzX21lc3NhZ2U6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgbGFzdF9mYWlsdXJlX2F0OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGxhc3RfZmFpbHVyZV9tZXNzYWdlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIHN0YXR1czogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBzdGF0dXNfZGF0ZTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KSkKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTYpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGR1cGxpY2F0ZVJ1bGVzKF94NikgewogICAgcmV0dXJuIF9yZWYxMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIENyZWF0ZSBQcmVwYWNrYWdlZCBSdWxlcwogKgogKiBAcGFyYW0gc2lnbmFsIEFib3J0U2lnbmFsIGZvciBjYW5jZWxsaW5nIHJlcXVlc3QKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5kdXBsaWNhdGVSdWxlcyA9IGR1cGxpY2F0ZVJ1bGVzOwoKdmFyIGNyZWF0ZVByZXBhY2thZ2VkUnVsZXMgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjE0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KF9yZWYxNSkgewogICAgdmFyIHNpZ25hbDsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHNpZ25hbCA9IF9yZWYxNS5zaWduYWw7CiAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUFJFUEFDS0FHRURfVVJMLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU3KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBjcmVhdGVQcmVwYWNrYWdlZFJ1bGVzKF94NykgewogICAgcmV0dXJuIF9yZWYxNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIEltcG9ydHMgcnVsZXMgaW4gdGhlIHNhbWUgZm9ybWF0IGFzIGV4cG9ydGVkIHZpYSB0aGUgX2V4cG9ydCBBUEkKICoKICogQHBhcmFtIGZpbGVUb0ltcG9ydCBGaWxlIHRvIHVwbG9hZCBjb250YWluaW5nIHJ1bGVzIHRvIGltcG9ydAogKiBAcGFyYW0gb3ZlcndyaXRlIHdoZXRoZXIgb3Igbm90IHRvIG92ZXJ3cml0ZSBydWxlcyB3aXRoIHRoZSBzYW1lIHJ1bGVJZAogKiBAcGFyYW0gc2lnbmFsIEFib3J0U2lnbmFsIGZvciBjYW5jZWxsaW5nIHJlcXVlc3QKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5jcmVhdGVQcmVwYWNrYWdlZFJ1bGVzID0gY3JlYXRlUHJlcGFja2FnZWRSdWxlczsKCnZhciBpbXBvcnRSdWxlcyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMTYgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoX3JlZjE3KSB7CiAgICB2YXIgZmlsZVRvSW1wb3J0LCBfcmVmMTckb3ZlcndyaXRlLCBvdmVyd3JpdGUsIHNpZ25hbCwgZm9ybURhdGE7CgogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgZmlsZVRvSW1wb3J0ID0gX3JlZjE3LmZpbGVUb0ltcG9ydCwgX3JlZjE3JG92ZXJ3cml0ZSA9IF9yZWYxNy5vdmVyd3JpdGUsIG92ZXJ3cml0ZSA9IF9yZWYxNyRvdmVyd3JpdGUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjE3JG92ZXJ3cml0ZSwgc2lnbmFsID0gX3JlZjE3LnNpZ25hbDsKICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgZmlsZVRvSW1wb3J0KTsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaCgiIi5jb25jYXQoX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1JVTEVTX1VSTCwgIi9faW1wb3J0IiksIHsKICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgb3ZlcndyaXRlOiBvdmVyd3JpdGUKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGJvZHk6IGZvcm1EYXRhLAogICAgICAgICAgICAgIHNpZ25hbDogc2lnbmFsCiAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWU4KTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBpbXBvcnRSdWxlcyhfeDgpIHsKICAgIHJldHVybiBfcmVmMTYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7Ci8qKgogKiBFeHBvcnQgcnVsZXMgZnJvbSB0aGUgc2VydmVyIGFzIGEgZmlsZSBkb3dubG9hZAogKgogKiBAcGFyYW0gZXhjbHVkZUV4cG9ydERldGFpbHMgd2hldGhlciBvciBub3QgdG8gZXhjbHVkZSBhZGRpdGlvbmFsIGRldGFpbHMgYXQgYm90dG9tIG9mIGV4cG9ydGVkIGZpbGUgKGRlZmF1bHRzIHRvIGZhbHNlKQogKiBAcGFyYW0gZmlsZW5hbWUgb2YgZXhwb3J0ZWQgcnVsZXMuIEJlIHN1cmUgdG8gaW5jbHVkZSBgLm5kanNvbmAgZXh0ZW5zaW9uISAoZGVmYXVsdHMgdG8gbG9jYWxpemVkIGBydWxlc19leHBvcnQubmRqc29uYCkKICogQHBhcmFtIHJ1bGVJZHMgYXJyYXkgb2YgcnVsZV9pZCdzIChub3QgaWQhKSB0byBleHBvcnQgKGVtcHR5IGFycmF5IGV4cG9ydHMgX2FsbF8gcnVsZXMpCiAqIEBwYXJhbSBzaWduYWwgQWJvcnRTaWduYWwgZm9yIGNhbmNlbGxpbmcgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmltcG9ydFJ1bGVzID0gaW1wb3J0UnVsZXM7Cgp2YXIgZXhwb3J0UnVsZXMgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjE4ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWYxOSkgewogICAgdmFyIF9yZWYxOSRleGNsdWRlRXhwb3J0RCwgZXhjbHVkZUV4cG9ydERldGFpbHMsIF9yZWYxOSRmaWxlbmFtZSwgZmlsZW5hbWUsIF9yZWYxOSRpZHMsIGlkcywgc2lnbmFsLCBib2R5OwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9yZWYxOSRleGNsdWRlRXhwb3J0RCA9IF9yZWYxOS5leGNsdWRlRXhwb3J0RGV0YWlscywgZXhjbHVkZUV4cG9ydERldGFpbHMgPSBfcmVmMTkkZXhjbHVkZUV4cG9ydEQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjE5JGV4Y2x1ZGVFeHBvcnRELCBfcmVmMTkkZmlsZW5hbWUgPSBfcmVmMTkuZmlsZW5hbWUsIGZpbGVuYW1lID0gX3JlZjE5JGZpbGVuYW1lID09PSB2b2lkIDAgPyAiIi5jb25jYXQoaTE4bi5FWFBPUlRfRklMRU5BTUUsICIubmRqc29uIikgOiBfcmVmMTkkZmlsZW5hbWUsIF9yZWYxOSRpZHMgPSBfcmVmMTkuaWRzLCBpZHMgPSBfcmVmMTkkaWRzID09PSB2b2lkIDAgPyBbXSA6IF9yZWYxOSRpZHMsIHNpZ25hbCA9IF9yZWYxOS5zaWduYWw7CiAgICAgICAgICAgIGJvZHkgPSBpZHMubGVuZ3RoID4gMCA/IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICBvYmplY3RzOiBpZHMubWFwKGZ1bmN0aW9uIChydWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBydWxlX2lkOiBydWxlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0pIDogdW5kZWZpbmVkOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgX2tpYmFuYS5LaWJhbmFTZXJ2aWNlcy5nZXQoKS5odHRwLmZldGNoKCIiLmNvbmNhdChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfVVJMLCAiL19leHBvcnQiKSwgewogICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgIGJvZHk6IGJvZHksCiAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgIGV4Y2x1ZGVfZXhwb3J0X2RldGFpbHM6IGV4Y2x1ZGVFeHBvcnREZXRhaWxzLAogICAgICAgICAgICAgICAgZmlsZV9uYW1lOiBmaWxlbmFtZQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTkpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGV4cG9ydFJ1bGVzKF94OSkgewogICAgcmV0dXJuIF9yZWYxOC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIEdldCBSdWxlIFN0YXR1cyBwcm92aWRlZCBSdWxlIElECiAqCiAqIEBwYXJhbSBpZCBzdHJpbmcgb2YgUnVsZSBJRCdzIChub3QgcnVsZV9pZCkKICogQHBhcmFtIHNpZ25hbCBBYm9ydFNpZ25hbCBmb3IgY2FuY2VsbGluZyByZXF1ZXN0CiAqCiAqIEB0aHJvd3MgQW4gZXJyb3IgaWYgcmVzcG9uc2UgaXMgbm90IE9LCiAqLwoKCmV4cG9ydHMuZXhwb3J0UnVsZXMgPSBleHBvcnRSdWxlczsKCnZhciBnZXRSdWxlU3RhdHVzQnlJZCA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMjAgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKF9yZWYyMSkgewogICAgdmFyIGlkLCBzaWduYWw7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWQgPSBfcmVmMjEuaWQsIHNpZ25hbCA9IF9yZWYyMS5zaWduYWw7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIiwgX2tpYmFuYS5LaWJhbmFTZXJ2aWNlcy5nZXQoKS5odHRwLmZldGNoKF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9SVUxFU19TVEFUVVNfVVJMLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICBxdWVyeTogewogICAgICAgICAgICAgICAgaWRzOiBKU09OLnN0cmluZ2lmeShbaWRdKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgICAgfSkpOwoKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUxMCk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gZ2V0UnVsZVN0YXR1c0J5SWQoX3gxMCkgewogICAgcmV0dXJuIF9yZWYyMC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIFJldHVybiBydWxlIHN0YXR1c2VzIGdpdmVuIGxpc3Qgb2YgYWxlcnQgaWRzCiAqCiAqIEBwYXJhbSBpZHMgYXJyYXkgb2Ygc3RyaW5nIG9mIFJ1bGUgSUQncyAobm90IHJ1bGVfaWQpCiAqIEBwYXJhbSBzaWduYWwgQWJvcnRTaWduYWwgZm9yIGNhbmNlbGxpbmcgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmdldFJ1bGVTdGF0dXNCeUlkID0gZ2V0UnVsZVN0YXR1c0J5SWQ7Cgp2YXIgZ2V0UnVsZXNTdGF0dXNCeUlkcyA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMjIgPSBfYXN5bmNUb0dlbmVyYXRvcigKICAvKiNfX1BVUkVfXyovCiAgcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKF9yZWYyMykgewogICAgdmFyIGlkcywgc2lnbmFsLCByZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWRzID0gX3JlZjIzLmlkcywgc2lnbmFsID0gX3JlZjIzLnNpZ25hbDsKICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIF9raWJhbmEuS2liYW5hU2VydmljZXMuZ2V0KCkuaHR0cC5mZXRjaChfY29uc3RhbnRzLkRFVEVDVElPTl9FTkdJTkVfUlVMRVNfU1RBVFVTX1VSTCwgewogICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgIGlkczogSlNPTi5zdHJpbmdpZnkoaWRzKQogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICByZXMgPSBfY29udGV4dDExLnNlbnQ7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgcmVzKTsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlMTEpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIGdldFJ1bGVzU3RhdHVzQnlJZHMoX3gxMSkgewogICAgcmV0dXJuIF9yZWYyMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIEZldGNoIGFsbCB1bmlxdWUgVGFncyB1c2VkIGJ5IFJ1bGVzCiAqCiAqIEBwYXJhbSBzaWduYWwgdG8gY2FuY2VsIHJlcXVlc3QKICoKICogQHRocm93cyBBbiBlcnJvciBpZiByZXNwb25zZSBpcyBub3QgT0sKICovCgoKZXhwb3J0cy5nZXRSdWxlc1N0YXR1c0J5SWRzID0gZ2V0UnVsZXNTdGF0dXNCeUlkczsKCnZhciBmZXRjaFRhZ3MgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICB2YXIgX3JlZjI0ID0gX2FzeW5jVG9HZW5lcmF0b3IoCiAgLyojX19QVVJFX18qLwogIHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMihfcmVmMjUpIHsKICAgIHZhciBzaWduYWw7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgc2lnbmFsID0gX3JlZjI1LnNpZ25hbDsKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCBfa2liYW5hLktpYmFuYVNlcnZpY2VzLmdldCgpLmh0dHAuZmV0Y2goX2NvbnN0YW50cy5ERVRFQ1RJT05fRU5HSU5FX1RBR1NfVVJMLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9KSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTEyKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBmZXRjaFRhZ3MoX3gxMikgewogICAgcmV0dXJuIF9yZWYyNC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKTsKLyoqCiAqIEdldCBwcmUgcGFja2FnZWQgcnVsZXMgU3RhdHVzCiAqCiAqIEBwYXJhbSBzaWduYWwgQWJvcnRTaWduYWwgZm9yIGNhbmNlbGxpbmcgcmVxdWVzdAogKgogKiBAdGhyb3dzIEFuIGVycm9yIGlmIHJlc3BvbnNlIGlzIG5vdCBPSwogKi8KCgpleHBvcnRzLmZldGNoVGFncyA9IGZldGNoVGFnczsKCnZhciBnZXRQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzID0KLyojX19QVVJFX18qLwpmdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYyNiA9IF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoX3JlZjI3KSB7CiAgICB2YXIgc2lnbmFsOwogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMyQoX2NvbnRleHQxMykgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHNpZ25hbCA9IF9yZWYyNy5zaWduYWw7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgX2tpYmFuYS5LaWJhbmFTZXJ2aWNlcy5nZXQoKS5odHRwLmZldGNoKF9jb25zdGFudHMuREVURUNUSU9OX0VOR0lORV9QUkVQQUNLQUdFRF9SVUxFU19TVEFUVVNfVVJMLCB7CiAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJywKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9KSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTEzKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiBnZXRQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzKF94MTMpIHsKICAgIHJldHVybiBfcmVmMjYuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCk7CgpleHBvcnRzLmdldFByZVBhY2thZ2VkUnVsZXNTdGF0dXMgPSBnZXRQcmVQYWNrYWdlZFJ1bGVzU3RhdHVzOw=="},null]}