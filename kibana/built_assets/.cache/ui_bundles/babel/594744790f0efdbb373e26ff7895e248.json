{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/components/step_define_rule/index.js","dependencies":[{"path":"x-pack/legacy/plugins/siem/public/pages/detection_engine/rules/components/step_define_rule/index.js","mtime":1589249553316},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLlN0ZXBEZWZpbmVSdWxlID0gdm9pZCAwOwoKdmFyIF9ldWkgPSByZXF1aXJlKCJAZWxhc3RpYy9ldWkiKTsKCnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCJyZWFjdCIpKTsKCnZhciBfc3R5bGVkQ29tcG9uZW50cyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgic3R5bGVkLWNvbXBvbmVudHMiKSk7Cgp2YXIgX2Zhc3REZWVwRXF1YWwgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImZhc3QtZGVlcC1lcXVhbCIpKTsKCnZhciBfcnVsZXMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb250YWluZXJzL2RldGVjdGlvbl9lbmdpbmUvcnVsZXMiKTsKCnZhciBfY29uc3RhbnRzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vY29tbW9uL2NvbnN0YW50cyIpOwoKdmFyIF9tbF9oZWxwZXJzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vY29tbW9uL2RldGVjdGlvbl9lbmdpbmUvbWxfaGVscGVycyIpOwoKdmFyIF90cmFuc2xhdGlvbnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb21wb25lbnRzL3RpbWVsaW5lL3RyYW5zbGF0aW9ucyIpOwoKdmFyIF91c2VfbWxfY2FwYWJpbGl0aWVzID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vY29tcG9uZW50cy9tbF9wb3BvdmVyL2hvb2tzL3VzZV9tbF9jYXBhYmlsaXRpZXMiKTsKCnZhciBfa2liYW5hID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vbGliL2tpYmFuYSIpOwoKdmFyIF9oZWxwZXJzID0gcmVxdWlyZSgiLi4vLi4vaGVscGVycyIpOwoKdmFyIF90eXBlcyA9IHJlcXVpcmUoIi4uLy4uL3R5cGVzIik7Cgp2YXIgX2Rlc2NyaXB0aW9uX3N0ZXAgPSByZXF1aXJlKCIuLi9kZXNjcmlwdGlvbl9zdGVwIik7Cgp2YXIgX3F1ZXJ5X2JhciA9IHJlcXVpcmUoIi4uL3F1ZXJ5X2JhciIpOwoKdmFyIF9zZWxlY3RfcnVsZV90eXBlID0gcmVxdWlyZSgiLi4vc2VsZWN0X3J1bGVfdHlwZSIpOwoKdmFyIF9hbm9tYWx5X3RocmVzaG9sZF9zbGlkZXIgPSByZXF1aXJlKCIuLi9hbm9tYWx5X3RocmVzaG9sZF9zbGlkZXIiKTsKCnZhciBfbWxfam9iX3NlbGVjdCA9IHJlcXVpcmUoIi4uL21sX2pvYl9zZWxlY3QiKTsKCnZhciBfcGlja190aW1lbGluZSA9IHJlcXVpcmUoIi4uL3BpY2tfdGltZWxpbmUiKTsKCnZhciBfc3RlcF9jb250ZW50X3dyYXBwZXIgPSByZXF1aXJlKCIuLi9zdGVwX2NvbnRlbnRfd3JhcHBlciIpOwoKdmFyIF9uZXh0X3N0ZXAgPSByZXF1aXJlKCIuLi9uZXh0X3N0ZXAiKTsKCnZhciBfc2hhcmVkX2ltcG9ydHMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9zaGFyZWRfaW1wb3J0cyIpOwoKdmFyIF9zY2hlbWEgPSByZXF1aXJlKCIuL3NjaGVtYSIpOwoKdmFyIGkxOG4gPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKCIuL3RyYW5zbGF0aW9ucyIpKTsKCnZhciBfaGVscGVyczIgPSByZXF1aXJlKCIuLi8uLi9jcmVhdGUvaGVscGVycyIpOwoKdmFyIF9oYXNfbWxfYWRtaW5fcGVybWlzc2lvbnMgPSByZXF1aXJlKCIuLi8uLi8uLi8uLi8uLi9jb21wb25lbnRzL21sL3Blcm1pc3Npb25zL2hhc19tbF9hZG1pbl9wZXJtaXNzaW9ucyIpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfQoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7CiAgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgewogICAgcmV0dXJuIG9iajsKICB9IGVsc2UgewogICAgdmFyIG5ld09iaiA9IHt9OwoKICAgIGlmIChvYmogIT0gbnVsbCkgewogICAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7CiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgICAgIHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OwoKICAgICAgICAgIGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBuZXdPYmouZGVmYXVsdCA9IG9iajsKICAgIHJldHVybiBuZXdPYmo7CiAgfQp9CgpmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoc291cmNlLCBleGNsdWRlZCkgewogIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwoKICB2YXIgdGFyZ2V0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCk7CgogIHZhciBrZXksIGk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc291cmNlU3ltYm9sS2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKTsKCiAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlU3ltYm9sS2V5cy5sZW5ndGg7IGkrKykgewogICAgICBrZXkgPSBzb3VyY2VTeW1ib2xLZXlzW2ldOwogICAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzb3VyY2UsIGtleSkpIGNvbnRpbnVlOwogICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgewogIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwogIHZhciB0YXJnZXQgPSB7fTsKICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7CiAgdmFyIGtleSwgaTsKCiAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgIGtleSA9IHNvdXJjZUtleXNbaV07CiAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHsKICB0cnkgewogICAgdmFyIGluZm8gPSBnZW5ba2V5XShhcmcpOwogICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmVqZWN0KGVycm9yKTsKICAgIHJldHVybjsKICB9CgogIGlmIChpbmZvLmRvbmUpIHsKICAgIHJlc29sdmUodmFsdWUpOwogIH0gZWxzZSB7CiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7CiAgfQp9CgpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgewogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgc2VsZiA9IHRoaXMsCiAgICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsKCiAgICAgIGZ1bmN0aW9uIF9uZXh0KHZhbHVlKSB7CiAgICAgICAgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gX3Rocm93KGVycikgewogICAgICAgIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsKICAgICAgfQoKICAgICAgX25leHQodW5kZWZpbmVkKTsKICAgIH0pOwogIH07Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9CgpmdW5jdGlvbiBfc2xpY2VkVG9BcnJheShhcnIsIGkpIHsKICByZXR1cm4gX2FycmF5V2l0aEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdCgpOwp9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKfQoKZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgewogIHZhciBfYXJyID0gW107CiAgdmFyIF9uID0gdHJ1ZTsKICB2YXIgX2QgPSBmYWxzZTsKICB2YXIgX2UgPSB1bmRlZmluZWQ7CgogIHRyeSB7CiAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CgogICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICB9CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBfZCA9IHRydWU7CiAgICBfZSA9IGVycjsKICB9IGZpbmFsbHkgewogICAgdHJ5IHsKICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0gIT0gbnVsbCkgX2lbInJldHVybiJdKCk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgfQogIH0KCiAgcmV0dXJuIF9hcnI7Cn0KCmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHsKICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyOwp9Cgp2YXIgQ29tbW9uVXNlRmllbGQgPSAoMCwgX3NoYXJlZF9pbXBvcnRzLmdldFVzZUZpZWxkKSh7CiAgY29tcG9uZW50OiBfc2hhcmVkX2ltcG9ydHMuRmllbGQKfSk7CnZhciBzdGVwRGVmaW5lRGVmYXVsdFZhbHVlID0gewogIGFub21hbHlUaHJlc2hvbGQ6IDUwLAogIGluZGV4OiBbXSwKICBpc05ldzogdHJ1ZSwKICBtYWNoaW5lTGVhcm5pbmdKb2JJZDogJycsCiAgcnVsZVR5cGU6ICdxdWVyeScsCiAgcXVlcnlCYXI6IHsKICAgIHF1ZXJ5OiB7CiAgICAgIHF1ZXJ5OiAnJywKICAgICAgbGFuZ3VhZ2U6ICdrdWVyeScKICAgIH0sCiAgICBmaWx0ZXJzOiBbXSwKICAgIHNhdmVkX2lkOiB1bmRlZmluZWQKICB9LAogIHRpbWVsaW5lOiB7CiAgICBpZDogbnVsbCwKICAgIHRpdGxlOiBfdHJhbnNsYXRpb25zLkRFRkFVTFRfVElNRUxJTkVfVElUTEUKICB9Cn07CnZhciBNeUxhYmVsQnV0dG9uID0gKDAsIF9zdHlsZWRDb21wb25lbnRzLmRlZmF1bHQpKF9ldWkuRXVpQnV0dG9uRW1wdHkpLndpdGhDb25maWcoewogIGRpc3BsYXlOYW1lOiAiTXlMYWJlbEJ1dHRvbiIsCiAgY29tcG9uZW50SWQ6ICJzYy0xN2ZtbHU2LTAiCn0pKFsiaGVpZ2h0OjE4cHg7Zm9udC1zaXplOjEycHg7LmV1aUljb257d2lkdGg6MTRweDtoZWlnaHQ6MTRweDt9Il0pOwpNeUxhYmVsQnV0dG9uLmRlZmF1bHRQcm9wcyA9IHsKICBmbHVzaDogJ3JpZ2h0Jwp9OwoKdmFyIFN0ZXBEZWZpbmVSdWxlQ29tcG9uZW50ID0gZnVuY3Rpb24gU3RlcERlZmluZVJ1bGVDb21wb25lbnQoX3JlZikgewogIHZhciBfcmVmJGFkZFBhZGRpbmcgPSBfcmVmLmFkZFBhZGRpbmcsCiAgICAgIGFkZFBhZGRpbmcgPSBfcmVmJGFkZFBhZGRpbmcgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZiRhZGRQYWRkaW5nLAogICAgICBkZWZhdWx0VmFsdWVzID0gX3JlZi5kZWZhdWx0VmFsdWVzLAogICAgICBfcmVmJGRlc2NyaXB0aW9uQ29sdW0gPSBfcmVmLmRlc2NyaXB0aW9uQ29sdW1ucywKICAgICAgZGVzY3JpcHRpb25Db2x1bW5zID0gX3JlZiRkZXNjcmlwdGlvbkNvbHVtID09PSB2b2lkIDAgPyAnc2luZ2xlU3BsaXQnIDogX3JlZiRkZXNjcmlwdGlvbkNvbHVtLAogICAgICBpc1JlYWRPbmx5VmlldyA9IF9yZWYuaXNSZWFkT25seVZpZXcsCiAgICAgIGlzTG9hZGluZyA9IF9yZWYuaXNMb2FkaW5nLAogICAgICBfcmVmJGlzVXBkYXRlVmlldyA9IF9yZWYuaXNVcGRhdGVWaWV3LAogICAgICBpc1VwZGF0ZVZpZXcgPSBfcmVmJGlzVXBkYXRlVmlldyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmJGlzVXBkYXRlVmlldywKICAgICAgc2V0Rm9ybSA9IF9yZWYuc2V0Rm9ybSwKICAgICAgc2V0U3RlcERhdGEgPSBfcmVmLnNldFN0ZXBEYXRhOwogIHZhciBtbENhcGFiaWxpdGllcyA9ICgwLCBfdXNlX21sX2NhcGFiaWxpdGllcy51c2VNbENhcGFiaWxpdGllcykoKTsKCiAgdmFyIF91c2VTdGF0ZSA9ICgwLCBfcmVhY3QudXNlU3RhdGUpKGZhbHNlKSwKICAgICAgX3VzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksCiAgICAgIG9wZW5UaW1lbGluZVNlYXJjaCA9IF91c2VTdGF0ZTJbMF0sCiAgICAgIHNldE9wZW5UaW1lbGluZVNlYXJjaCA9IF91c2VTdGF0ZTJbMV07CgogIHZhciBfdXNlU3RhdGUzID0gKDAsIF9yZWFjdC51c2VTdGF0ZSkoZmFsc2UpLAogICAgICBfdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMywgMiksCiAgICAgIGluZGV4TW9kaWZpZWQgPSBfdXNlU3RhdGU0WzBdLAogICAgICBzZXRJbmRleE1vZGlmaWVkID0gX3VzZVN0YXRlNFsxXTsKCiAgdmFyIF91c2VTdGF0ZTUgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKShmYWxzZSksCiAgICAgIF91c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU1LCAyKSwKICAgICAgbG9jYWxJc01sUnVsZSA9IF91c2VTdGF0ZTZbMF0sCiAgICAgIHNldElzTWxSdWxlID0gX3VzZVN0YXRlNlsxXTsKCiAgdmFyIF91c2VVaVNldHRpbmckID0gKDAsIF9raWJhbmEudXNlVWlTZXR0aW5nJCkoX2NvbnN0YW50cy5ERUZBVUxUX0lOREVYX0tFWSksCiAgICAgIF91c2VVaVNldHRpbmckMiA9IF9zbGljZWRUb0FycmF5KF91c2VVaVNldHRpbmckLCAxKSwKICAgICAgaW5kaWNlc0NvbmZpZyA9IF91c2VVaVNldHRpbmckMlswXTsKCiAgdmFyIF91c2VTdGF0ZTcgPSAoMCwgX3JlYWN0LnVzZVN0YXRlKShfb2JqZWN0U3ByZWFkKHt9LCBzdGVwRGVmaW5lRGVmYXVsdFZhbHVlLCB7CiAgICBpbmRleDogaW5kaWNlc0NvbmZpZyAhPT0gbnVsbCAmJiBpbmRpY2VzQ29uZmlnICE9PSB2b2lkIDAgPyBpbmRpY2VzQ29uZmlnIDogW10KICB9KSksCiAgICAgIF91c2VTdGF0ZTggPSBfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU3LCAyKSwKICAgICAgbXlTdGVwRGF0YSA9IF91c2VTdGF0ZThbMF0sCiAgICAgIHNldE15U3RlcERhdGEgPSBfdXNlU3RhdGU4WzFdOwoKICB2YXIgX3VzZUZldGNoSW5kZXhQYXR0ZXJuID0gKDAsIF9ydWxlcy51c2VGZXRjaEluZGV4UGF0dGVybnMpKG15U3RlcERhdGEuaW5kZXgpLAogICAgICBfdXNlRmV0Y2hJbmRleFBhdHRlcm4yID0gX3NsaWNlZFRvQXJyYXkoX3VzZUZldGNoSW5kZXhQYXR0ZXJuLCAxKSwKICAgICAgX3VzZUZldGNoSW5kZXhQYXR0ZXJuMyA9IF91c2VGZXRjaEluZGV4UGF0dGVybjJbMF0sCiAgICAgIGJyb3dzZXJGaWVsZHMgPSBfdXNlRmV0Y2hJbmRleFBhdHRlcm4zLmJyb3dzZXJGaWVsZHMsCiAgICAgIGluZGV4UGF0dGVyblF1ZXJ5QmFyID0gX3VzZUZldGNoSW5kZXhQYXR0ZXJuMy5pbmRleFBhdHRlcm5zLAogICAgICBpbmRleFBhdHRlcm5Mb2FkaW5nUXVlcnlCYXIgPSBfdXNlRmV0Y2hJbmRleFBhdHRlcm4zLmlzTG9hZGluZzsKCiAgdmFyIF91c2VGb3JtID0gKDAsIF9zaGFyZWRfaW1wb3J0cy51c2VGb3JtKSh7CiAgICBkZWZhdWx0VmFsdWU6IG15U3RlcERhdGEsCiAgICBvcHRpb25zOiB7CiAgICAgIHN0cmlwRW1wdHlGaWVsZHM6IGZhbHNlCiAgICB9LAogICAgc2NoZW1hOiBfc2NoZW1hLnNjaGVtYQogIH0pLAogICAgICBmb3JtID0gX3VzZUZvcm0uZm9ybTsKCiAgdmFyIGNsZWFyRXJyb3JzID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIGZvcm0ucmVzZXQoewogICAgICByZXNldFZhbHVlczogZmFsc2UKICAgIH0pOwogIH0sIFtmb3JtXSk7CiAgdmFyIG9uU3VibWl0ID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoCiAgLyojX19QVVJFX18qLwogIF9hc3luY1RvR2VuZXJhdG9yKAogIC8qI19fUFVSRV9fKi8KICByZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgdmFyIF9yZWYzLCBpc1ZhbGlkLCBkYXRhOwoKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgaWYgKCFzZXRTdGVwRGF0YSkgewogICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA4OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzZXRTdGVwRGF0YShfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgcmV0dXJuIGZvcm0uc3VibWl0KCk7CgogICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICBfcmVmMyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIGlzVmFsaWQgPSBfcmVmMy5pc1ZhbGlkOwogICAgICAgICAgICBkYXRhID0gX3JlZjMuZGF0YTsKCiAgICAgICAgICAgIGlmIChpc1ZhbGlkICYmIHNldFN0ZXBEYXRhKSB7CiAgICAgICAgICAgICAgc2V0U3RlcERhdGEoX3R5cGVzLlJ1bGVTdGVwLmRlZmluZVJ1bGUsIGRhdGEsIGlzVmFsaWQpOwogICAgICAgICAgICAgIHNldE15U3RlcERhdGEoX29iamVjdFNwcmVhZCh7fSwgZGF0YSwgewogICAgICAgICAgICAgICAgaXNOZXc6IGZhbHNlCiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUpOwogIH0pKSwgW2Zvcm1dKTsKICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkgewogICAgdmFyIGlzTmV3ID0gbXlTdGVwRGF0YS5pc05ldywKICAgICAgICB2YWx1ZXMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMobXlTdGVwRGF0YSwgWyJpc05ldyJdKTsKCiAgICBpZiAoZGVmYXVsdFZhbHVlcyAhPSBudWxsICYmICEoMCwgX2Zhc3REZWVwRXF1YWwuZGVmYXVsdCkodmFsdWVzLCBkZWZhdWx0VmFsdWVzKSkgewogICAgICB2YXIgbmV3VmFsdWVzID0gX29iamVjdFNwcmVhZCh7fSwgdmFsdWVzLCB7fSwgZGVmYXVsdFZhbHVlcywgewogICAgICAgIGlzTmV3OiBmYWxzZQogICAgICB9KTsKCiAgICAgIHNldE15U3RlcERhdGEobmV3VmFsdWVzKTsKICAgICAgKDAsIF9oZWxwZXJzLnNldEZpZWxkVmFsdWUpKGZvcm0sIF9zY2hlbWEuc2NoZW1hLCBuZXdWYWx1ZXMpOwogICAgfQogIH0sIFtkZWZhdWx0VmFsdWVzLCBzZXRNeVN0ZXBEYXRhLCBfaGVscGVycy5zZXRGaWVsZFZhbHVlXSk7CiAgKDAsIF9yZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgIGlmIChzZXRGb3JtICE9IG51bGwpIHsKICAgICAgc2V0Rm9ybShfdHlwZXMuUnVsZVN0ZXAuZGVmaW5lUnVsZSwgZm9ybSk7CiAgICB9CiAgfSwgW2Zvcm1dKTsKICB2YXIgaGFuZGxlUmVzZXRJbmRpY2VzID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKCkgewogICAgdmFyIGluZGV4RmllbGQgPSBmb3JtLmdldEZpZWxkcygpLmluZGV4OwogICAgaW5kZXhGaWVsZC5zZXRWYWx1ZShpbmRpY2VzQ29uZmlnKTsKICB9LCBbZm9ybSwgaW5kaWNlc0NvbmZpZ10pOwogIHZhciBoYW5kbGVPcGVuVGltZWxpbmVTZWFyY2ggPSAoMCwgX3JlYWN0LnVzZUNhbGxiYWNrKShmdW5jdGlvbiAoKSB7CiAgICBzZXRPcGVuVGltZWxpbmVTZWFyY2godHJ1ZSk7CiAgfSwgW10pOwogIHZhciBoYW5kbGVDbG9zZVRpbWVsaW5lU2VhcmNoID0gKDAsIF9yZWFjdC51c2VDYWxsYmFjaykoZnVuY3Rpb24gKCkgewogICAgc2V0T3BlblRpbWVsaW5lU2VhcmNoKGZhbHNlKTsKICB9LCBbXSk7CiAgcmV0dXJuIGlzUmVhZE9ubHlWaWV3ID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc3RlcF9jb250ZW50X3dyYXBwZXIuU3RlcENvbnRlbnRXcmFwcGVyLCB7CiAgICAiZGF0YS10ZXN0LXN1YmoiOiAiZGVmaW5pdGlvblJ1bGUiLAogICAgYWRkUGFkZGluZzogYWRkUGFkZGluZwogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2Rlc2NyaXB0aW9uX3N0ZXAuU3RlcFJ1bGVEZXNjcmlwdGlvbiwgewogICAgY29sdW1uczogZGVzY3JpcHRpb25Db2x1bW5zLAogICAgaW5kZXhQYXR0ZXJuczogaW5kZXhQYXR0ZXJuUXVlcnlCYXIsCiAgICBzY2hlbWE6ICgwLCBfaGVscGVyczIuZmlsdGVyUnVsZUZpZWxkc0ZvclR5cGUpKF9zY2hlbWEuc2NoZW1hLCBteVN0ZXBEYXRhLnJ1bGVUeXBlKSwKICAgIGRhdGE6ICgwLCBfaGVscGVyczIuZmlsdGVyUnVsZUZpZWxkc0ZvclR5cGUpKG15U3RlcERhdGEsIG15U3RlcERhdGEucnVsZVR5cGUpCiAgfSkpIDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QuZGVmYXVsdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc3RlcF9jb250ZW50X3dyYXBwZXIuU3RlcENvbnRlbnRXcmFwcGVyLCB7CiAgICBhZGRQYWRkaW5nOiAhaXNVcGRhdGVWaWV3CiAgfSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2hhcmVkX2ltcG9ydHMuRm9ybSwgewogICAgZm9ybTogZm9ybSwKICAgICJkYXRhLXRlc3Qtc3ViaiI6ICJzdGVwRGVmaW5lUnVsZSIKICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zaGFyZWRfaW1wb3J0cy5Vc2VGaWVsZCwgewogICAgcGF0aDogInJ1bGVUeXBlIiwKICAgIGNvbXBvbmVudDogX3NlbGVjdF9ydWxlX3R5cGUuU2VsZWN0UnVsZVR5cGUsCiAgICBjb21wb25lbnRQcm9wczogewogICAgICBkZXNjcmliZWRCeUlkczogWydkZXRlY3Rpb25FbmdpbmVTdGVwRGVmaW5lUnVsZVR5cGUnXSwKICAgICAgaXNSZWFkT25seTogaXNVcGRhdGVWaWV3LAogICAgICBoYXNWYWxpZExpY2Vuc2U6IG1sQ2FwYWJpbGl0aWVzLmlzUGxhdGludW1PclRyaWFsTGljZW5zZSwKICAgICAgaXNNbEFkbWluOiAoMCwgX2hhc19tbF9hZG1pbl9wZXJtaXNzaW9ucy5oYXNNbEFkbWluUGVybWlzc2lvbnMpKG1sQ2FwYWJpbGl0aWVzKQogICAgfQogIH0pLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpRm9ybVJvdywgewogICAgZnVsbFdpZHRoOiB0cnVlLAogICAgc3R5bGU6IHsKICAgICAgZGlzcGxheTogbG9jYWxJc01sUnVsZSA/ICdub25lJyA6ICdmbGV4JwogICAgfQogIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LmRlZmF1bHQuRnJhZ21lbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoQ29tbW9uVXNlRmllbGQsIHsKICAgIHBhdGg6ICJpbmRleCIsCiAgICBjb25maWc6IF9vYmplY3RTcHJlYWQoe30sIF9zY2hlbWEuc2NoZW1hLmluZGV4LCB7CiAgICAgIGxhYmVsQXBwZW5kOiBpbmRleE1vZGlmaWVkID8gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChNeUxhYmVsQnV0dG9uLCB7CiAgICAgICAgb25DbGljazogaGFuZGxlUmVzZXRJbmRpY2VzLAogICAgICAgIGljb25UeXBlOiAicmVmcmVzaCIKICAgICAgfSwgaTE4bi5SRVNFVF9ERUZBVUxUX0lOREVYKSA6IG51bGwKICAgIH0pLAogICAgY29tcG9uZW50UHJvcHM6IHsKICAgICAgaWRBcmlhOiAnZGV0ZWN0aW9uRW5naW5lU3RlcERlZmluZVJ1bGVJbmRpY2VzJywKICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogJ2RldGVjdGlvbkVuZ2luZVN0ZXBEZWZpbmVSdWxlSW5kaWNlcycsCiAgICAgIGV1aUZpZWxkUHJvcHM6IHsKICAgICAgICBmdWxsV2lkdGg6IHRydWUsCiAgICAgICAgaXNEaXNhYmxlZDogaXNMb2FkaW5nLAogICAgICAgIHBsYWNlaG9sZGVyOiAnJwogICAgICB9CiAgICB9CiAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3NoYXJlZF9pbXBvcnRzLlVzZUZpZWxkLCB7CiAgICBwYXRoOiAicXVlcnlCYXIiLAogICAgY29uZmlnOiBfb2JqZWN0U3ByZWFkKHt9LCBfc2NoZW1hLnNjaGVtYS5xdWVyeUJhciwgewogICAgICBsYWJlbEFwcGVuZDogX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChNeUxhYmVsQnV0dG9uLCB7CiAgICAgICAgb25DbGljazogaGFuZGxlT3BlblRpbWVsaW5lU2VhcmNoCiAgICAgIH0sIGkxOG4uSU1QT1JUX1RJTUVMSU5FX1FVRVJZKQogICAgfSksCiAgICBjb21wb25lbnQ6IF9xdWVyeV9iYXIuUXVlcnlCYXJEZWZpbmVSdWxlLAogICAgY29tcG9uZW50UHJvcHM6IHsKICAgICAgYnJvd3NlckZpZWxkczogYnJvd3NlckZpZWxkcywKICAgICAgaWRBcmlhOiAnZGV0ZWN0aW9uRW5naW5lU3RlcERlZmluZVJ1bGVRdWVyeUJhcicsCiAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuUXVlcnlCYXIsCiAgICAgIGlzRGlzYWJsZWQ6IGlzTG9hZGluZywKICAgICAgaXNMb2FkaW5nOiBpbmRleFBhdHRlcm5Mb2FkaW5nUXVlcnlCYXIsCiAgICAgIGRhdGFUZXN0U3ViajogJ2RldGVjdGlvbkVuZ2luZVN0ZXBEZWZpbmVSdWxlUXVlcnlCYXInLAogICAgICBvcGVuVGltZWxpbmVTZWFyY2g6IG9wZW5UaW1lbGluZVNlYXJjaCwKICAgICAgb25DbG9zZVRpbWVsaW5lU2VhcmNoOiBoYW5kbGVDbG9zZVRpbWVsaW5lU2VhcmNoCiAgICB9CiAgfSkpKSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUZvcm1Sb3csIHsKICAgIGZ1bGxXaWR0aDogdHJ1ZSwKICAgIHN0eWxlOiB7CiAgICAgIGRpc3BsYXk6IGxvY2FsSXNNbFJ1bGUgPyAnZmxleCcgOiAnbm9uZScKICAgIH0KICB9LCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5kZWZhdWx0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zaGFyZWRfaW1wb3J0cy5Vc2VGaWVsZCwgewogICAgcGF0aDogIm1hY2hpbmVMZWFybmluZ0pvYklkIiwKICAgIGNvbXBvbmVudDogX21sX2pvYl9zZWxlY3QuTWxKb2JTZWxlY3QsCiAgICBjb21wb25lbnRQcm9wczogewogICAgICBkZXNjcmliZWRCeUlkczogWydkZXRlY3Rpb25FbmdpbmVTdGVwRGVmaW5lUnVsZW1hY2hpbmVMZWFybmluZ0pvYklkJ10KICAgIH0KICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2hhcmVkX2ltcG9ydHMuVXNlRmllbGQsIHsKICAgIHBhdGg6ICJhbm9tYWx5VGhyZXNob2xkIiwKICAgIGNvbXBvbmVudDogX2Fub21hbHlfdGhyZXNob2xkX3NsaWRlci5Bbm9tYWx5VGhyZXNob2xkU2xpZGVyLAogICAgY29tcG9uZW50UHJvcHM6IHsKICAgICAgZGVzY3JpYmVkQnlJZHM6IFsnZGV0ZWN0aW9uRW5naW5lU3RlcERlZmluZVJ1bGVBbm9tYWx5VGhyZXNob2xkJ10KICAgIH0KICB9KSkpLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9zaGFyZWRfaW1wb3J0cy5Vc2VGaWVsZCwgewogICAgcGF0aDogInRpbWVsaW5lIiwKICAgIGNvbXBvbmVudDogX3BpY2tfdGltZWxpbmUuUGlja1RpbWVsaW5lLAogICAgY29tcG9uZW50UHJvcHM6IHsKICAgICAgaWRBcmlhOiAnZGV0ZWN0aW9uRW5naW5lU3RlcERlZmluZVJ1bGVUaW1lbGluZScsCiAgICAgIGlzRGlzYWJsZWQ6IGlzTG9hZGluZywKICAgICAgZGF0YVRlc3RTdWJqOiAnZGV0ZWN0aW9uRW5naW5lU3RlcERlZmluZVJ1bGVUaW1lbGluZScKICAgIH0KICB9KSwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfc2hhcmVkX2ltcG9ydHMuRm9ybURhdGFQcm92aWRlciwgewogICAgcGF0aHNUb1dhdGNoOiBbJ2luZGV4JywgJ3J1bGVUeXBlJ10KICB9LCBmdW5jdGlvbiAoX3JlZjQpIHsKICAgIHZhciBpbmRleCA9IF9yZWY0LmluZGV4LAogICAgICAgIHJ1bGVUeXBlID0gX3JlZjQucnVsZVR5cGU7CgogICAgaWYgKGluZGV4ICE9IG51bGwpIHsKICAgICAgaWYgKCgwLCBfZmFzdERlZXBFcXVhbC5kZWZhdWx0KShpbmRleCwgaW5kaWNlc0NvbmZpZykgJiYgaW5kZXhNb2RpZmllZCkgewogICAgICAgIHNldEluZGV4TW9kaWZpZWQoZmFsc2UpOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2Zhc3REZWVwRXF1YWwuZGVmYXVsdCkoaW5kZXgsIGluZGljZXNDb25maWcpICYmICFpbmRleE1vZGlmaWVkKSB7CiAgICAgICAgc2V0SW5kZXhNb2RpZmllZCh0cnVlKTsKICAgICAgfQogICAgfQoKICAgIGlmICgoMCwgX21sX2hlbHBlcnMuaXNNbFJ1bGUpKHJ1bGVUeXBlKSAmJiAhbG9jYWxJc01sUnVsZSkgewogICAgICBzZXRJc01sUnVsZSh0cnVlKTsKICAgICAgY2xlYXJFcnJvcnMoKTsKICAgIH0gZWxzZSBpZiAoISgwLCBfbWxfaGVscGVycy5pc01sUnVsZSkocnVsZVR5cGUpICYmIGxvY2FsSXNNbFJ1bGUpIHsKICAgICAgc2V0SXNNbFJ1bGUoZmFsc2UpOwogICAgICBjbGVhckVycm9ycygpOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH0pKSksICFpc1VwZGF0ZVZpZXcgJiYgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbmV4dF9zdGVwLk5leHRTdGVwLCB7CiAgICBkYXRhVGVzdFN1Ymo6ICJkZWZpbmUtY29udGludWUiLAogICAgb25DbGljazogb25TdWJtaXQsCiAgICBpc0Rpc2FibGVkOiBpc0xvYWRpbmcKICB9KSk7Cn07Cgp2YXIgU3RlcERlZmluZVJ1bGUgPSAoMCwgX3JlYWN0Lm1lbW8pKFN0ZXBEZWZpbmVSdWxlQ29tcG9uZW50KTsKZXhwb3J0cy5TdGVwRGVmaW5lUnVsZSA9IFN0ZXBEZWZpbmVSdWxlOw=="},null]}