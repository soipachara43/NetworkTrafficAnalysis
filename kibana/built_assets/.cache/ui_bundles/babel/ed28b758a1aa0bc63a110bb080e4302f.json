{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!x-pack/legacy/plugins/rollup/public/crud_app/sections/job_create/job_create.js","dependencies":[{"path":"x-pack/legacy/plugins/rollup/public/crud_app/sections/job_create/job_create.js","mtime":1589249552812},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkpvYkNyZWF0ZSA9IGV4cG9ydHMuSm9iQ3JlYXRlVWkgPSB2b2lkIDA7Cgp2YXIgX3JlYWN0ID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZSgicmVhY3QiKSk7Cgp2YXIgX3Byb3BUeXBlcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgicHJvcC10eXBlcyIpKTsKCnZhciBfbWFwVmFsdWVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2gvb2JqZWN0L21hcFZhbHVlcyIpKTsKCnZhciBfY2xvbmVEZWVwID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2gvbGFuZy9jbG9uZURlZXAiKSk7Cgp2YXIgX2RlYm91bmNlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2gvZnVuY3Rpb24vZGVib3VuY2UiKSk7Cgp2YXIgX2ZpcnN0ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJsb2Rhc2gvYXJyYXkvZmlyc3QiKSk7Cgp2YXIgX2kxOG4gPSByZXF1aXJlKCJAa2JuL2kxOG4iKTsKCnZhciBfcmVhY3QyID0gcmVxdWlyZSgiQGtibi9pMThuL3JlYWN0Iik7Cgp2YXIgX3B1YmxpYyA9IHJlcXVpcmUoIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9wbHVnaW5zL2tpYmFuYV9yZWFjdC9wdWJsaWMvIik7Cgp2YXIgX2V1aSA9IHJlcXVpcmUoIkBlbGFzdGljL2V1aSIpOwoKdmFyIF9zZXJ2aWNlcyA9IHJlcXVpcmUoIi4uLy4uL3NlcnZpY2VzIik7Cgp2YXIgX25hdmlnYXRpb24gPSByZXF1aXJlKCIuL25hdmlnYXRpb24iKTsKCnZhciBfc3RlcHMgPSByZXF1aXJlKCIuL3N0ZXBzIik7Cgp2YXIgX3N0ZXBzX2NvbmZpZyA9IHJlcXVpcmUoIi4vc3RlcHNfY29uZmlnIik7Cgp2YXIgX2tpYmFuYV9zZXJ2aWNlcyA9IHJlcXVpcmUoIi4uLy4uLy4uL2tpYmFuYV9zZXJ2aWNlcyIpOwoKdmFyIF9zdGVwSWRUb1RpdGxlTWFwOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH0KCmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IGlmICh0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09ICJzeW1ib2wiKSB7IF90eXBlb2YgPSBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfTsgfSBlbHNlIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7IH07IH0gcmV0dXJuIF90eXBlb2Yob2JqKTsgfQoKZnVuY3Rpb24gX29iamVjdERlc3RydWN0dXJpbmdFbXB0eShvYmopIHsgaWYgKG9iaiA9PSBudWxsKSB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgZGVzdHJ1Y3R1cmUgdW5kZWZpbmVkIik7IH0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9CgpmdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7IH0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQoKZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfQoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkgeyByZXR1cm4gY2FsbDsgfSByZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTsgfQoKZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHsgcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsgfTsgcmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTsgfQoKZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7IGlmIChzZWxmID09PSB2b2lkIDApIHsgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTsgfSByZXR1cm4gc2VsZjsgfQoKZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTsgfQoKZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7IG8uX19wcm90b19fID0gcDsgcmV0dXJuIG87IH07IHJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9Cgp2YXIgc3RlcElkVG9UaXRsZU1hcCA9IChfc3RlcElkVG9UaXRsZU1hcCA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3N0ZXBJZFRvVGl0bGVNYXAsIF9zdGVwc19jb25maWcuU1RFUF9MT0dJU1RJQ1MsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5zdGVwcy5zdGVwTG9naXN0aWNzVGl0bGUnLCB7CiAgZGVmYXVsdE1lc3NhZ2U6ICdMb2dpc3RpY3MnCn0pKSwgX2RlZmluZVByb3BlcnR5KF9zdGVwSWRUb1RpdGxlTWFwLCBfc3RlcHNfY29uZmlnLlNURVBfREFURV9ISVNUT0dSQU0sIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5zdGVwcy5zdGVwRGF0ZUhpc3RvZ3JhbVRpdGxlJywgewogIGRlZmF1bHRNZXNzYWdlOiAnRGF0ZSBoaXN0b2dyYW0nCn0pKSwgX2RlZmluZVByb3BlcnR5KF9zdGVwSWRUb1RpdGxlTWFwLCBfc3RlcHNfY29uZmlnLlNURVBfVEVSTVMsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5zdGVwcy5zdGVwVGVybXNUaXRsZScsIHsKICBkZWZhdWx0TWVzc2FnZTogJ1Rlcm1zJwp9KSksIF9kZWZpbmVQcm9wZXJ0eShfc3RlcElkVG9UaXRsZU1hcCwgX3N0ZXBzX2NvbmZpZy5TVEVQX0hJU1RPR1JBTSwgX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnJvbGx1cEpvYnMuY3JlYXRlLnN0ZXBzLnN0ZXBIaXN0b2dyYW1UaXRsZScsIHsKICBkZWZhdWx0TWVzc2FnZTogJ0hpc3RvZ3JhbScKfSkpLCBfZGVmaW5lUHJvcGVydHkoX3N0ZXBJZFRvVGl0bGVNYXAsIF9zdGVwc19jb25maWcuU1RFUF9NRVRSSUNTLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucm9sbHVwSm9icy5jcmVhdGUuc3RlcHMuc3RlcE1ldHJpY3NUaXRsZScsIHsKICBkZWZhdWx0TWVzc2FnZTogJ01ldHJpY3MnCn0pKSwgX2RlZmluZVByb3BlcnR5KF9zdGVwSWRUb1RpdGxlTWFwLCBfc3RlcHNfY29uZmlnLlNURVBfUkVWSUVXLCBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucm9sbHVwSm9icy5jcmVhdGUuc3RlcHMuc3RlcFJldmlld1RpdGxlJywgewogIGRlZmF1bHRNZXNzYWdlOiAnUmV2aWV3IGFuZCBzYXZlJwp9KSksIF9zdGVwSWRUb1RpdGxlTWFwKTsKCnZhciBKb2JDcmVhdGVVaSA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9Db21wb25lbnQpIHsKICBfaW5oZXJpdHMoSm9iQ3JlYXRlVWksIF9Db21wb25lbnQpOwoKICBmdW5jdGlvbiBKb2JDcmVhdGVVaShwcm9wcykgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBKb2JDcmVhdGVVaSk7CgogICAgX3RoaXMgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfZ2V0UHJvdG90eXBlT2YoSm9iQ3JlYXRlVWkpLmNhbGwodGhpcywgcHJvcHMpKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJyZXF1ZXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvbiIsICgwLCBfZGVib3VuY2UuZGVmYXVsdCkoZnVuY3Rpb24gKCkgewogICAgICB2YXIgcmVzZXREZWZhdWx0cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsKCiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSBfdGhpcy5nZXRJbmRleFBhdHRlcm4oKTsKCiAgICAgIHZhciBsYXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvblRpbWUgPSBfdGhpcy5sYXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvblRpbWUgPSBEYXRlLm5vdygpOwogICAgICAoMCwgX3NlcnZpY2VzLnZhbGlkYXRlSW5kZXhQYXR0ZXJuKShpbmRleFBhdHRlcm4pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgLy8gV2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZyBpZiB0aGlzIGNvbXBvbmVudCBoYXMgYmVlbiB1bm1vdW50ZWQuCiAgICAgICAgaWYgKCFfdGhpcy5faXNNb3VudGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBPbmx5IHJlLXJlcXVlc3QgaWYgdGhlIGluZGV4IHBhdHRlcm4gY2hhbmdlZC4KCgogICAgICAgIGlmIChsYXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvblRpbWUgIT09IF90aGlzLmxhc3RJbmRleFBhdHRlcm5WYWxpZGF0aW9uVGltZSkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIGRvZXNJbmRleFBhdHRlcm5NYXRjaEluZGljZXMgPSByZXNwb25zZS5kb2VzTWF0Y2hJbmRpY2VzLAogICAgICAgICAgICBkb2VzSW5kZXhQYXR0ZXJuTWF0Y2hSb2xsdXBJbmRpY2VzID0gcmVzcG9uc2UuZG9lc01hdGNoUm9sbHVwSW5kaWNlcywKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcyA9IHJlc3BvbnNlLmRhdGVGaWVsZHMsCiAgICAgICAgICAgIG51bWVyaWNGaWVsZHMgPSByZXNwb25zZS5udW1lcmljRmllbGRzLAogICAgICAgICAgICBrZXl3b3JkRmllbGRzID0gcmVzcG9uc2Uua2V5d29yZEZpZWxkczsKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuQXN5bmNFcnJvcnM7CgogICAgICAgIGlmIChkb2VzSW5kZXhQYXR0ZXJuTWF0Y2hSb2xsdXBJbmRpY2VzKSB7CiAgICAgICAgICBpbmRleFBhdHRlcm5Bc3luY0Vycm9ycyA9IFtfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLnJvbGx1cEpvYnMuY3JlYXRlLmVycm9ycy5pbmRleFBhdHRlcm5NYXRjaGVzUm9sbHVwSW5kaWNlcyIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW5kZXggcGF0dGVybiBtdXN0IG5vdCBtYXRjaCByb2xsdXAgaW5kaWNlcy4iCiAgICAgICAgICB9KV07CiAgICAgICAgfSBlbHNlIGlmICghZG9lc0luZGV4UGF0dGVybk1hdGNoSW5kaWNlcykgewogICAgICAgICAgaW5kZXhQYXR0ZXJuQXN5bmNFcnJvcnMgPSBbX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICAgICAgaWQ6ICJ4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5lcnJvcnMuaW5kZXhQYXR0ZXJuTm9NYXRjaGluZ0luZGljZXMiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIkluZGV4IHBhdHRlcm4gZG9lc24ndCBtYXRjaCBhbnkgaW5kaWNlcy4iCiAgICAgICAgICB9KV07CiAgICAgICAgfSBlbHNlIGlmICghaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcy5sZW5ndGgpIHsKICAgICAgICAgIGluZGV4UGF0dGVybkFzeW5jRXJyb3JzID0gW19yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0Mi5Gb3JtYXR0ZWRNZXNzYWdlLCB7CiAgICAgICAgICAgIGlkOiAieHBhY2sucm9sbHVwSm9icy5jcmVhdGUuZXJyb3JzLmluZGV4UGF0dGVybk5vVGltZUZpZWxkcyIsCiAgICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiSW5kZXggcGF0dGVybiBtdXN0IG1hdGNoIGluZGljZXMgdGhhdCBjb250YWluIHRpbWUgZmllbGRzLiIKICAgICAgICAgIH0pXTsKICAgICAgICB9CgogICAgICAgIHZhciBudW1lcmljVHlwZSA9IF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5udW1lcmljVHlwZUZpZWxkJywgewogICAgICAgICAgZGVmYXVsdE1lc3NhZ2U6ICdudW1lcmljJwogICAgICAgIH0pOwoKICAgICAgICB2YXIga2V5d29yZFR5cGUgPSBfaTE4bi5pMThuLnRyYW5zbGF0ZSgneHBhY2sucm9sbHVwSm9icy5jcmVhdGUua2V5d29yZFR5cGVGaWVsZCcsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAna2V5d29yZCcKICAgICAgICB9KTsKCiAgICAgICAgdmFyIGRhdGVUeXBlID0gX2kxOG4uaTE4bi50cmFuc2xhdGUoJ3hwYWNrLnJvbGx1cEpvYnMuY3JlYXRlLmRhdGVUeXBlRmllbGQnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ2RhdGUnCiAgICAgICAgfSk7CgogICAgICAgIHZhciBmb3JtYXR0ZWROdW1lcmljRmllbGRzID0gKDAsIF9zZXJ2aWNlcy5mb3JtYXRGaWVsZHMpKG51bWVyaWNGaWVsZHMsIG51bWVyaWNUeXBlKTsKICAgICAgICB2YXIgZm9ybWF0dGVkS2V5d29yZEZpZWxkcyA9ICgwLCBfc2VydmljZXMuZm9ybWF0RmllbGRzKShrZXl3b3JkRmllbGRzLCBrZXl3b3JkVHlwZSk7CiAgICAgICAgdmFyIGZvcm1hdHRlZERhdGVGaWVsZHMgPSAoMCwgX3NlcnZpY2VzLmZvcm1hdEZpZWxkcykoaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcywgZGF0ZVR5cGUpOwogICAgICAgIHZhciBfdGhpcyRzdGF0ZSA9IF90aGlzLnN0YXRlLAogICAgICAgICAgICBqb2JUb0Nsb25lID0gX3RoaXMkc3RhdGUuam9iVG9DbG9uZSwKICAgICAgICAgICAgc3RlcHNGaWVsZHMgPSBfdGhpcyRzdGF0ZS5zdGVwc0ZpZWxkczsKICAgICAgICB2YXIgbWV0cmljcyA9IHN0ZXBzRmllbGRzW19zdGVwc19jb25maWcuU1RFUF9NRVRSSUNTXS5tZXRyaWNzOyAvLyBPbmx5IHJlLXR5cGUgbWV0cmljcyBpZiB0aGV5IGhhdmVuJ3QgYmVlbiB0eXBlZCBhbHJlYWR5CgogICAgICAgIGlmIChqb2JUb0Nsb25lICYmIG1ldHJpY3MgJiYgbWV0cmljcy5sZW5ndGggJiYgISgwLCBfZmlyc3QuZGVmYXVsdCkobWV0cmljcykudHlwZSkgewogICAgICAgICAgLy8gUmUtdHlwZSBhbnkgcHJlLWV4aXN0aW5nIG1ldHJpY3MgZW50cmllcyBmb3IgdGhlIGpvYiB3ZSBhcmUgY2xvbmluZy4KICAgICAgICAgIHZhciB0eXBlTWFwcyA9IFt7CiAgICAgICAgICAgIGZpZWxkczogZm9ybWF0dGVkTnVtZXJpY0ZpZWxkcywKICAgICAgICAgICAgdHlwZTogbnVtZXJpY1R5cGUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgZmllbGRzOiBmb3JtYXR0ZWRLZXl3b3JkRmllbGRzLAogICAgICAgICAgICB0eXBlOiBrZXl3b3JkVHlwZQogICAgICAgICAgfSwgewogICAgICAgICAgICBmaWVsZHM6IGZvcm1hdHRlZERhdGVGaWVsZHMsCiAgICAgICAgICAgIHR5cGU6IGRhdGVUeXBlCiAgICAgICAgICB9XTsKICAgICAgICAgIHZhciByZXR5cGVkTWV0cmljcyA9ICgwLCBfc2VydmljZXMucmV0eXBlTWV0cmljcykoewogICAgICAgICAgICBtZXRyaWNzOiBtZXRyaWNzLAogICAgICAgICAgICB0eXBlTWFwczogdHlwZU1hcHMKICAgICAgICAgIH0pOwoKICAgICAgICAgIF90aGlzLm9uRmllbGRzQ2hhbmdlKHsKICAgICAgICAgICAgbWV0cmljczogcmV0eXBlZE1ldHJpY3MKICAgICAgICAgIH0sIF9zdGVwc19jb25maWcuU1RFUF9NRVRSSUNTKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIHNvcnRGaWVsZHMoYSwgYikgewogICAgICAgICAgdmFyIG5hbWVBID0gYS5uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICB2YXIgbmFtZUIgPSBiLm5hbWUudG9VcHBlckNhc2UoKTsKCiAgICAgICAgICBpZiAobmFtZUEgPCBuYW1lQikgewogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG5hbWVBID4gbmFtZUIpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQoKICAgICAgICB2YXIgaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGZvcm1hdHRlZE51bWVyaWNGaWVsZHMpLCBfdG9Db25zdW1hYmxlQXJyYXkoZm9ybWF0dGVkS2V5d29yZEZpZWxkcykpLnNvcnQoc29ydEZpZWxkcyk7CgogICAgICAgIHZhciBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHMgPSBfdG9Db25zdW1hYmxlQXJyYXkoZm9ybWF0dGVkTnVtZXJpY0ZpZWxkcykuc29ydChzb3J0RmllbGRzKTsKCiAgICAgICAgdmFyIGluZGV4UGF0dGVybk1ldHJpY3NGaWVsZHMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGZvcm1hdHRlZE51bWVyaWNGaWVsZHMpLCBfdG9Db25zdW1hYmxlQXJyYXkoZm9ybWF0dGVkRGF0ZUZpZWxkcykpLnNvcnQoc29ydEZpZWxkcyk7CiAgICAgICAgaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcy5zb3J0KCk7CgogICAgICAgIGlmIChyZXNldERlZmF1bHRzKSB7CiAgICAgICAgICAvLyBXaGVuZXZlciB0aGUgaW5kZXggcGF0dGVybiBjaGFuZ2VzIHdlIGRlZmF1bHQgdG8gdGhlIGZpcnN0IGRhdGUgZmllbGQgaWYgdGhlcmUgaXMgb25lLgogICAgICAgICAgX3RoaXMub25GaWVsZHNDaGFuZ2UoewogICAgICAgICAgICBkYXRlSGlzdG9ncmFtRmllbGQ6IGluZGV4UGF0dGVybkRhdGVGaWVsZHMubGVuZ3RoID8gaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkc1swXSA6IHVuZGVmaW5lZAogICAgICAgICAgfSwgX3N0ZXBzX2NvbmZpZy5TVEVQX0RBVEVfSElTVE9HUkFNKTsKICAgICAgICB9CgogICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGluZGV4UGF0dGVybkFzeW5jRXJyb3JzOiBpbmRleFBhdHRlcm5Bc3luY0Vycm9ycywKICAgICAgICAgIGluZGV4UGF0dGVybkRhdGVGaWVsZHM6IGluZGV4UGF0dGVybkRhdGVGaWVsZHMsCiAgICAgICAgICBpbmRleFBhdHRlcm5UZXJtc0ZpZWxkczogaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHMsCiAgICAgICAgICBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHM6IGluZGV4UGF0dGVybkhpc3RvZ3JhbUZpZWxkcywKICAgICAgICAgIGluZGV4UGF0dGVybk1ldHJpY3NGaWVsZHM6IGluZGV4UGF0dGVybk1ldHJpY3NGaWVsZHMsCiAgICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleFBhdHRlcm46IGZhbHNlCiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gZG8gYW55dGhpbmcgaWYgdGhpcyBjb21wb25lbnQgaGFzIGJlZW4gdW5tb3VudGVkLgogICAgICAgIGlmICghX3RoaXMuX2lzTW91bnRlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gSWdub3JlIGFsbCByZXNwb25zZXMgZXhjZXB0IHRoYXQgdG8gdGhlIG1vc3QgcmVjZW50IHJlcXVlc3QuCgoKICAgICAgICBpZiAobGFzdEluZGV4UGF0dGVyblZhbGlkYXRpb25UaW1lICE9PSBfdGhpcy5sYXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvblRpbWUpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIEV4cGVjdCBhbiBlcnJvciBpbiB0aGUgc2hhcGUgcHJvdmlkZWQgYnkgaHR0cCBzZXJ2aWNlLgoKCiAgICAgICAgaWYgKGVycm9yICYmIGVycm9yLmJvZHkpIHsKICAgICAgICAgIHZhciBfZXJyb3IkYm9keSA9IGVycm9yLmJvZHksCiAgICAgICAgICAgICAgZXJyb3JTdHJpbmcgPSBfZXJyb3IkYm9keS5lcnJvciwKICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gX2Vycm9yJGJvZHkuc3RhdHVzQ29kZTsKICAgICAgICAgIHZhciBpbmRleFBhdHRlcm5Bc3luY0Vycm9ycyA9IFtfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdDIuRm9ybWF0dGVkTWVzc2FnZSwgewogICAgICAgICAgICBpZDogInhwYWNrLnJvbGx1cEpvYnMuY3JlYXRlLmVycm9ycy5pbmRleFBhdHRlcm5WYWxpZGF0aW9uRXJyb3IiLAogICAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogIlRoZXJlIHdhcyBhIHByb2JsZW0gdmFsaWRhdGluZyB0aGlzIGluZGV4IHBhdHRlcm46IHtzdGF0dXNDb2RlfSB7ZXJyb3J9IiwKICAgICAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICAgICAgZXJyb3I6IGVycm9yU3RyaW5nLAogICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUKICAgICAgICAgICAgfQogICAgICAgICAgfSldOwoKICAgICAgICAgIF90aGlzLnNldFN0YXRlKHsKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuQXN5bmNFcnJvcnM6IGluZGV4UGF0dGVybkFzeW5jRXJyb3JzLAogICAgICAgICAgICBpbmRleFBhdHRlcm5EYXRlRmllbGRzOiBbXSwKICAgICAgICAgICAgaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHM6IFtdLAogICAgICAgICAgICBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHM6IFtdLAogICAgICAgICAgICBpbmRleFBhdHRlcm5NZXRyaWNzRmllbGRzOiBbXSwKICAgICAgICAgICAgaXNWYWxpZGF0aW5nSW5kZXhQYXR0ZXJuOiBmYWxzZQogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gVGhpcyBlcnJvciBpc24ndCBhbiBIVFRQIGVycm9yLCBzbyBsZXQgdGhlIGZhdGFsIGVycm9yIHNjcmVlbiB0ZWxsIHRoZSB1c2VyIHNvbWV0aGluZwogICAgICAgIC8vIHVuZXhwZWN0ZWQgaGFwcGVuZWQuCgoKICAgICAgICAoMCwgX2tpYmFuYV9zZXJ2aWNlcy5nZXRGYXRhbEVycm9ycykoKS5hZGQoZXJyb3IsIF9pMThuLmkxOG4udHJhbnNsYXRlKCd4cGFjay5yb2xsdXBKb2JzLmNyZWF0ZS5lcnJvcnMuaW5kZXhQYXR0ZXJuVmFsaWRhdGlvbkZhdGFsRXJyb3JUaXRsZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnUm9sbHVwIEpvYiBXaXphcmQgaW5kZXggcGF0dGVybiB2YWxpZGF0aW9uJwogICAgICAgIH0pKTsKICAgICAgfSk7CiAgICB9LCAzMDApKTsKCiAgICBfZGVmaW5lUHJvcGVydHkoX2Fzc2VydFRoaXNJbml0aWFsaXplZChfdGhpcyksICJnb1RvTmV4dFN0ZXAiLCBmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmdvVG9TdGVwKF90aGlzLnN0YXRlLm5leHRTdGVwSWQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAiZ29Ub1ByZXZpb3VzU3RlcCIsIGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMuZ29Ub1N0ZXAoX3RoaXMuc3RhdGUucHJldmlvdXNTdGVwSWQpOwogICAgfSk7CgogICAgX2RlZmluZVByb3BlcnR5KF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoX3RoaXMpLCAib25GaWVsZHNDaGFuZ2UiLCBmdW5jdGlvbiAoZmllbGRzKSB7CiAgICAgIHZhciBjdXJyZW50U3RlcElkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBfdGhpcy5zdGF0ZS5jdXJyZW50U3RlcElkOwogICAgICB2YXIgc3RlcHNGaWVsZHMgPSBfdGhpcy5zdGF0ZS5zdGVwc0ZpZWxkczsKICAgICAgdmFyIHByZXZGaWVsZHMgPSBzdGVwc0ZpZWxkc1tjdXJyZW50U3RlcElkXTsKICAgICAgdmFyIGFmZmVjdGVkU3RlcHNGaWVsZHMgPSAoMCwgX3N0ZXBzX2NvbmZpZy5nZXRBZmZlY3RlZFN0ZXBzRmllbGRzKShmaWVsZHMsIHN0ZXBzRmllbGRzKTsKCiAgICAgIHZhciBuZXdGaWVsZHMgPSBfb2JqZWN0U3ByZWFkKHt9LCBwcmV2RmllbGRzLCB7fSwgZmllbGRzKTsKCiAgICAgIHZhciBuZXdTdGVwc0ZpZWxkcyA9IF9vYmplY3RTcHJlYWQoe30sIGFmZmVjdGVkU3RlcHNGaWVsZHMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgY3VycmVudFN0ZXBJZCwgbmV3RmllbGRzKSk7CgogICAgICBfdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgc3RlcHNGaWVsZHM6IG5ld1N0ZXBzRmllbGRzLAogICAgICAgIHN0ZXBzRmllbGRFcnJvcnM6IF90aGlzLmdldFN0ZXBzRmllbGRzRXJyb3JzKG5ld1N0ZXBzRmllbGRzKQogICAgICB9KTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgInNhdmUiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjcmVhdGVKb2IgPSBfdGhpcy5wcm9wcy5jcmVhdGVKb2I7CgogICAgICB2YXIgam9iQ29uZmlnID0gX3RoaXMuZ2V0QWxsRmllbGRzKCk7CgogICAgICBjcmVhdGVKb2Ioam9iQ29uZmlnKTsKICAgIH0pOwoKICAgIF9kZWZpbmVQcm9wZXJ0eShfYXNzZXJ0VGhpc0luaXRpYWxpemVkKF90aGlzKSwgIm9uVG9nZ2xlU3RhcnRBZnRlckNyZWF0ZSIsIGZ1bmN0aW9uIChldmUpIHsKICAgICAgX3RoaXMuc2V0U3RhdGUoewogICAgICAgIHN0YXJ0Sm9iQWZ0ZXJDcmVhdGlvbjogZXZlLnRhcmdldC5jaGVja2VkCiAgICAgIH0pOwogICAgfSk7CgogICAgcHJvcHMua2liYW5hLnNlcnZpY2VzLnNldEJyZWFkY3J1bWJzKFtfc2VydmljZXMubGlzdEJyZWFkY3J1bWIsIF9zZXJ2aWNlcy5jcmVhdGVCcmVhZGNydW1iXSk7CiAgICB2YXIgc3RlcERlZmF1bHRPdmVycmlkZXMgPSBwcm9wcy5qb2JUb0Nsb25lOwoKICAgIHZhciBfc3RlcHNGaWVsZHMgPSAoMCwgX21hcFZhbHVlcy5kZWZhdWx0KShfc3RlcHNfY29uZmlnLnN0ZXBJZFRvU3RlcENvbmZpZ01hcCwgZnVuY3Rpb24gKHN0ZXApIHsKICAgICAgcmV0dXJuICgwLCBfY2xvbmVEZWVwLmRlZmF1bHQpKHN0ZXAuZ2V0RGVmYXVsdEZpZWxkcyhzdGVwRGVmYXVsdE92ZXJyaWRlcykpOwogICAgfSk7CgogICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgIGpvYlRvQ2xvbmU6IHN0ZXBEZWZhdWx0T3ZlcnJpZGVzIHx8IG51bGwsCiAgICAgIGNoZWNrcG9pbnRTdGVwSWQ6IF9zdGVwc19jb25maWcuc3RlcElkc1swXSwKICAgICAgY3VycmVudFN0ZXBJZDogX3N0ZXBzX2NvbmZpZy5zdGVwSWRzWzBdLAogICAgICBuZXh0U3RlcElkOiBfc3RlcHNfY29uZmlnLnN0ZXBJZHNbMV0sCiAgICAgIHByZXZpb3VzU3RlcElkOiB1bmRlZmluZWQsCiAgICAgIHN0ZXBzRmllbGRFcnJvcnM6IF90aGlzLmdldFN0ZXBzRmllbGRzRXJyb3JzKF9zdGVwc0ZpZWxkcyksCiAgICAgIC8vIFNob3cgc3RlcCBlcnJvcnMgaW1tZWRpYXRlbHkgaWYgd2UgYXJlIGNsb25pbmcgYSBqb2IuCiAgICAgIGFyZVN0ZXBFcnJvcnNWaXNpYmxlOiAhIXN0ZXBEZWZhdWx0T3ZlcnJpZGVzLAogICAgICBzdGVwc0ZpZWxkczogX3N0ZXBzRmllbGRzLAogICAgICBpc1ZhbGlkYXRpbmdJbmRleFBhdHRlcm46IGZhbHNlLAogICAgICBpbmRleFBhdHRlcm5Bc3luY0Vycm9yczogdW5kZWZpbmVkLAogICAgICBpbmRleFBhdHRlcm5EYXRlRmllbGRzOiBbXSwKICAgICAgaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHM6IFtdLAogICAgICBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHM6IFtdLAogICAgICBpbmRleFBhdHRlcm5NZXRyaWNzRmllbGRzOiBbXSwKICAgICAgc3RhcnRKb2JBZnRlckNyZWF0aW9uOiBmYWxzZQogICAgfTsKICAgIF90aGlzLmxhc3RJbmRleFBhdHRlcm5WYWxpZGF0aW9uVGltZSA9IDA7CiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSm9iQ3JlYXRlVWksIFt7CiAgICBrZXk6ICJjb21wb25lbnREaWRNb3VudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29tcG9uZW50RGlkTW91bnQoKSB7CiAgICAgIHRoaXMuX2lzTW91bnRlZCA9IHRydWU7CiAgICAgIHZhciBfdGhpcyRwcm9wcyA9IHRoaXMucHJvcHMsCiAgICAgICAgICBjbGVhckNsb25lSm9iID0gX3RoaXMkcHJvcHMuY2xlYXJDbG9uZUpvYiwKICAgICAgICAgIGpvYlRvQ2xvbmUgPSBfdGhpcyRwcm9wcy5qb2JUb0Nsb25lOwoKICAgICAgaWYgKGpvYlRvQ2xvbmUpIHsKICAgICAgICBjbGVhckNsb25lSm9iKCk7CiAgICAgICAgdGhpcy5yZXF1ZXN0SW5kZXhQYXR0ZXJuVmFsaWRhdGlvbihmYWxzZSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb21wb25lbnREaWRVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHMsIHByZXZTdGF0ZSkgewogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzCiAgICAgIHZhciBpbmRleFBhdHRlcm4gPSB0aGlzLmdldEluZGV4UGF0dGVybigpOwoKICAgICAgaWYgKGluZGV4UGF0dGVybiAhPT0gdGhpcy5nZXRJbmRleFBhdHRlcm4ocHJldlN0YXRlKSkgewogICAgICAgIC8vIElmIHRoZSB1c2VyIGhhc24ndCBlbnRlcmVkIGFueXRoaW5nLCB0aGVuIHNraXAgdmFsaWRhdGlvbi4KICAgICAgICBpZiAoIWluZGV4UGF0dGVybiB8fCAhaW5kZXhQYXR0ZXJuLnRyaW0oKSkgewogICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICAgIGluZGV4UGF0dGVybkFzeW5jRXJyb3JzOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGluZGV4UGF0dGVybkRhdGVGaWVsZHM6IFtdLAogICAgICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleFBhdHRlcm46IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIFNldCB0aGUgc3RhdGUgb3V0c2lkZSBvZiBgcmVxdWVzdEluZGV4UGF0dGVyblZhbGlkYXRpb25gLCBiZWNhdXNlIHRoYXQgZnVuY3Rpb24gaXMKICAgICAgICAvLyBkZWJvdW5jZWQuCgoKICAgICAgICB0aGlzLnNldFN0YXRlKHsKICAgICAgICAgIGlzVmFsaWRhdGluZ0luZGV4UGF0dGVybjogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMucmVxdWVzdEluZGV4UGF0dGVyblZhbGlkYXRpb24oKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNvbXBvbmVudFdpbGxVbm1vdW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHsKICAgICAgdGhpcy5faXNNb3VudGVkID0gZmFsc2U7IC8vIENsZWFuIHVwIGFmdGVyIG91cnNlbHZlcy4KCiAgICAgIHRoaXMucHJvcHMuY2xlYXJDcmVhdGVKb2JFcnJvcnMoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTdGVwcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U3RlcHMoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzJHN0YXRlMiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBjdXJyZW50U3RlcElkID0gX3RoaXMkc3RhdGUyLmN1cnJlbnRTdGVwSWQsCiAgICAgICAgICBjaGVja3BvaW50U3RlcElkID0gX3RoaXMkc3RhdGUyLmNoZWNrcG9pbnRTdGVwSWQ7CgogICAgICB2YXIgaW5kZXhPZkN1cnJlbnRTdGVwID0gX3N0ZXBzX2NvbmZpZy5zdGVwSWRzLmluZGV4T2YoY3VycmVudFN0ZXBJZCk7CgogICAgICByZXR1cm4gX3N0ZXBzX2NvbmZpZy5zdGVwSWRzLm1hcChmdW5jdGlvbiAoc3RlcElkLCBpbmRleCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0aXRsZTogc3RlcElkVG9UaXRsZU1hcFtzdGVwSWRdLAogICAgICAgICAgaXNDb21wbGV0ZTogaW5kZXggPCBpbmRleE9mQ3VycmVudFN0ZXAsCiAgICAgICAgICBpc1NlbGVjdGVkOiBpbmRleCA9PT0gaW5kZXhPZkN1cnJlbnRTdGVwLAogICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgcmV0dXJuIF90aGlzMi5nb1RvU3RlcChzdGVwSWQpOwogICAgICAgICAgfSwKICAgICAgICAgIGRpc2FibGVkOiAhX3RoaXMyLmNhbkdvVG9TdGVwKHN0ZXBJZCkgfHwgX3N0ZXBzX2NvbmZpZy5zdGVwSWRzLmluZGV4T2Yoc3RlcElkKSA+IF9zdGVwc19jb25maWcuc3RlcElkcy5pbmRleE9mKGNoZWNrcG9pbnRTdGVwSWQpLAogICAgICAgICAgJ2RhdGEtdGVzdC1zdWJqJzogaW5kZXggPT09IGluZGV4T2ZDdXJyZW50U3RlcCA/ICJjcmVhdGVSb2xsdXBTdGVwIi5jb25jYXQoaW5kZXggKyAxLCAiLS1hY3RpdmUiKSA6ICJjcmVhdGVSb2xsdXBTdGVwIi5jb25jYXQoaW5kZXggKyAxKQogICAgICAgIH07CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImdvVG9TdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnb1RvU3RlcChzdGVwSWQpIHsKICAgICAgLy8gSW5zdGVhZCBvZiBkaXNhYmxpbmcgdGhlIE5leHQgYnV0dG9uIHdoaWxlIHRoZSBzdGVwIGlzIGludmFsaWQsIHdlCiAgICAgIC8vIGluc3RlYWQgYWxsb3cgdGhlIHVzZXIgdG8gY2xpY2sgdGhlIE5leHQgYnV0dG9uLCBwcmV2ZW50IHRoZW0gbGVhdmluZwogICAgICAvLyB0aGlzIHN0ZXAsIGFuZCByZW5kZXIgYSBnbG9iYWwgZXJyb3IgbWVzc2FnZSB0byBjbGVhcmx5IGNvbnZleSB0aGUKICAgICAgLy8gZXJyb3IuCiAgICAgIGlmICghdGhpcy5jYW5Hb1RvU3RlcChzdGVwSWQpKSB7CiAgICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgICBhcmVTdGVwRXJyb3JzVmlzaWJsZTogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIGN1cnJlbnRTdGVwSW5kZXggPSBfc3RlcHNfY29uZmlnLnN0ZXBJZHMuaW5kZXhPZihzdGVwSWQpOwoKICAgICAgdGhpcy5zZXRTdGF0ZSh7CiAgICAgICAgY3VycmVudFN0ZXBJZDogc3RlcElkLAogICAgICAgIG5leHRTdGVwSWQ6IF9zdGVwc19jb25maWcuc3RlcElkc1tjdXJyZW50U3RlcEluZGV4ICsgMV0sCiAgICAgICAgcHJldmlvdXNTdGVwSWQ6IF9zdGVwc19jb25maWcuc3RlcElkc1tjdXJyZW50U3RlcEluZGV4IC0gMV0sCiAgICAgICAgYXJlU3RlcEVycm9yc1Zpc2libGU6IGZhbHNlLAogICAgICAgIGlzU2F2aW5nOiBmYWxzZQogICAgICB9KTsKCiAgICAgIGlmIChfc3RlcHNfY29uZmlnLnN0ZXBJZHMuaW5kZXhPZihzdGVwSWQpID4gX3N0ZXBzX2NvbmZpZy5zdGVwSWRzLmluZGV4T2YodGhpcy5zdGF0ZS5jaGVja3BvaW50U3RlcElkKSkgewogICAgICAgIHRoaXMuc2V0U3RhdGUoewogICAgICAgICAgY2hlY2twb2ludFN0ZXBJZDogc3RlcElkCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJjYW5Hb1RvU3RlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2FuR29Ub1N0ZXAoc3RlcElkKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGluZGV4T2ZTdGVwID0gX3N0ZXBzX2NvbmZpZy5zdGVwSWRzLmluZGV4T2Yoc3RlcElkKTsgLy8gQ2hlY2sgZXZlcnkgc3RlcCBiZWZvcmUgdGhpcyBvbmUgYW5kIHNlZSBpZiBpdCdzIGJlZW4gY29tcGxldGVkLgoKCiAgICAgIHZhciBwcmVyZXF1aXNpdGVTdGVwcyA9IF9zdGVwc19jb25maWcuc3RlcElkcy5zbGljZSgwLCBpbmRleE9mU3RlcCk7CgogICAgICByZXR1cm4gcHJlcmVxdWlzaXRlU3RlcHMuZXZlcnkoZnVuY3Rpb24gKHByZXJlcXVpc2l0ZVN0ZXBJZCkgewogICAgICAgIHJldHVybiAhX3RoaXMzLmhhc1N0ZXBFcnJvcnMocHJlcmVxdWlzaXRlU3RlcElkKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiaGFzU3RlcEVycm9ycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFzU3RlcEVycm9ycyhzdGVwSWQpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlMyA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpbmRleFBhdHRlcm5Bc3luY0Vycm9ycyA9IF90aGlzJHN0YXRlMy5pbmRleFBhdHRlcm5Bc3luY0Vycm9ycywKICAgICAgICAgIHN0ZXBzRmllbGRFcnJvcnMgPSBfdGhpcyRzdGF0ZTMuc3RlcHNGaWVsZEVycm9yczsKCiAgICAgIGlmIChzdGVwSWQgPT09IF9zdGVwc19jb25maWcuU1RFUF9MT0dJU1RJQ1MpIHsKICAgICAgICBpZiAoQm9vbGVhbihpbmRleFBhdHRlcm5Bc3luY0Vycm9ycykpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHN0ZXBGaWVsZEVycm9ycyA9IHN0ZXBzRmllbGRFcnJvcnNbc3RlcElkXTsKICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoc3RlcEZpZWxkRXJyb3JzKS5zb21lKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHJldHVybiBlcnJvciAhPSBudWxsOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTdGVwc0ZpZWxkc0Vycm9ycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0U3RlcHNGaWVsZHNFcnJvcnMobmV3U3RlcHNGaWVsZHMpIHsKICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKG5ld1N0ZXBzRmllbGRzKS5yZWR1Y2UoZnVuY3Rpb24gKHN0ZXBzRmllbGRFcnJvcnMsIHN0ZXBJZCkgewogICAgICAgIHZhciBzdGVwRmllbGRzID0gbmV3U3RlcHNGaWVsZHNbc3RlcElkXTsKICAgICAgICB2YXIgZmllbGRzVmFsaWRhdG9yID0gX3N0ZXBzX2NvbmZpZy5zdGVwSWRUb1N0ZXBDb25maWdNYXBbc3RlcElkXS5maWVsZHNWYWxpZGF0b3I7CiAgICAgICAgc3RlcHNGaWVsZEVycm9yc1tzdGVwSWRdID0gdHlwZW9mIGZpZWxkc1ZhbGlkYXRvciA9PT0gImZ1bmN0aW9uIiA/IGZpZWxkc1ZhbGlkYXRvcihzdGVwRmllbGRzKSA6IHt9OwogICAgICAgIHJldHVybiBzdGVwc0ZpZWxkRXJyb3JzOwogICAgICB9LCB7fSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0QWxsRmllbGRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRBbGxGaWVsZHMoKSB7CiAgICAgIHZhciBfdGhpcyRzdGF0ZTQgPSB0aGlzLnN0YXRlLAogICAgICAgICAgX3RoaXMkc3RhdGU0JHN0ZXBzRmllID0gX3RoaXMkc3RhdGU0LnN0ZXBzRmllbGRzLAogICAgICAgICAgX3RoaXMkc3RhdGU0JHN0ZXBzRmllMiA9IF90aGlzJHN0YXRlNCRzdGVwc0ZpZVtfc3RlcHNfY29uZmlnLlNURVBfTE9HSVNUSUNTXSwKICAgICAgICAgIGlkID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllMi5pZCwKICAgICAgICAgIGluZGV4UGF0dGVybiA9IF90aGlzJHN0YXRlNCRzdGVwc0ZpZTIuaW5kZXhQYXR0ZXJuLAogICAgICAgICAgcm9sbHVwSW5kZXggPSBfdGhpcyRzdGF0ZTQkc3RlcHNGaWUyLnJvbGx1cEluZGV4LAogICAgICAgICAgcm9sbHVwQ3JvbiA9IF90aGlzJHN0YXRlNCRzdGVwc0ZpZTIucm9sbHVwQ3JvbiwKICAgICAgICAgIHJvbGx1cERlbGF5ID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllMi5yb2xsdXBEZWxheSwKICAgICAgICAgIHJvbGx1cFBhZ2VTaXplID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllMi5yb2xsdXBQYWdlU2l6ZSwKICAgICAgICAgIF90aGlzJHN0YXRlNCRzdGVwc0ZpZTMgPSBfdGhpcyRzdGF0ZTQkc3RlcHNGaWVbX3N0ZXBzX2NvbmZpZy5TVEVQX0RBVEVfSElTVE9HUkFNXSwKICAgICAgICAgIGRhdGVIaXN0b2dyYW1JbnRlcnZhbCA9IF90aGlzJHN0YXRlNCRzdGVwc0ZpZTMuZGF0ZUhpc3RvZ3JhbUludGVydmFsLAogICAgICAgICAgZGF0ZUhpc3RvZ3JhbVRpbWVab25lID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllMy5kYXRlSGlzdG9ncmFtVGltZVpvbmUsCiAgICAgICAgICBkYXRlSGlzdG9ncmFtRmllbGQgPSBfdGhpcyRzdGF0ZTQkc3RlcHNGaWUzLmRhdGVIaXN0b2dyYW1GaWVsZCwKICAgICAgICAgIHRlcm1zID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllW19zdGVwc19jb25maWcuU1RFUF9URVJNU10udGVybXMsCiAgICAgICAgICBfdGhpcyRzdGF0ZTQkc3RlcHNGaWU0ID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllW19zdGVwc19jb25maWcuU1RFUF9ISVNUT0dSQU1dLAogICAgICAgICAgaGlzdG9ncmFtID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllNC5oaXN0b2dyYW0sCiAgICAgICAgICBoaXN0b2dyYW1JbnRlcnZhbCA9IF90aGlzJHN0YXRlNCRzdGVwc0ZpZTQuaGlzdG9ncmFtSW50ZXJ2YWwsCiAgICAgICAgICBtZXRyaWNzID0gX3RoaXMkc3RhdGU0JHN0ZXBzRmllW19zdGVwc19jb25maWcuU1RFUF9NRVRSSUNTXS5tZXRyaWNzOwoKICAgICAgX29iamVjdERlc3RydWN0dXJpbmdFbXB0eShfdGhpcyRzdGF0ZTQkc3RlcHNGaWVbX3N0ZXBzX2NvbmZpZy5TVEVQX1JFVklFV10pOwoKICAgICAgdmFyIHN0YXJ0Sm9iQWZ0ZXJDcmVhdGlvbiA9IF90aGlzJHN0YXRlNC5zdGFydEpvYkFmdGVyQ3JlYXRpb247CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IGlkLAogICAgICAgIGluZGV4UGF0dGVybjogaW5kZXhQYXR0ZXJuLAogICAgICAgIHJvbGx1cEluZGV4OiByb2xsdXBJbmRleCwKICAgICAgICByb2xsdXBDcm9uOiByb2xsdXBDcm9uLAogICAgICAgIHJvbGx1cFBhZ2VTaXplOiByb2xsdXBQYWdlU2l6ZSwKICAgICAgICByb2xsdXBEZWxheTogcm9sbHVwRGVsYXksCiAgICAgICAgZGF0ZUhpc3RvZ3JhbUludGVydmFsOiBkYXRlSGlzdG9ncmFtSW50ZXJ2YWwsCiAgICAgICAgZGF0ZUhpc3RvZ3JhbVRpbWVab25lOiBkYXRlSGlzdG9ncmFtVGltZVpvbmUsCiAgICAgICAgZGF0ZUhpc3RvZ3JhbUZpZWxkOiBkYXRlSGlzdG9ncmFtRmllbGQsCiAgICAgICAgdGVybXM6IHRlcm1zLAogICAgICAgIGhpc3RvZ3JhbTogaGlzdG9ncmFtLAogICAgICAgIGhpc3RvZ3JhbUludGVydmFsOiBoaXN0b2dyYW1JbnRlcnZhbCwKICAgICAgICBtZXRyaWNzOiBtZXRyaWNzLAogICAgICAgIHN0YXJ0Sm9iQWZ0ZXJDcmVhdGlvbjogc3RhcnRKb2JBZnRlckNyZWF0aW9uCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SW5kZXhQYXR0ZXJuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJbmRleFBhdHRlcm4oKSB7CiAgICAgIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdGhpcy5zdGF0ZTsKICAgICAgcmV0dXJuIHN0YXRlLnN0ZXBzRmllbGRzW19zdGVwc19jb25maWcuU1RFUF9MT0dJU1RJQ1NdLmluZGV4UGF0dGVybjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW5kZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgdmFyIF90aGlzJHByb3BzMiA9IHRoaXMucHJvcHMsCiAgICAgICAgICBpc1NhdmluZyA9IF90aGlzJHByb3BzMi5pc1NhdmluZywKICAgICAgICAgIHNhdmVFcnJvciA9IF90aGlzJHByb3BzMi5zYXZlRXJyb3I7CiAgICAgIHZhciBzYXZpbmdGZWVkYmFjazsKCiAgICAgIGlmIChpc1NhdmluZykgewogICAgICAgIHNhdmluZ0ZlZWRiYWNrID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aU92ZXJsYXlNYXNrLCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpTG9hZGluZ0tpYmFuYSwgewogICAgICAgICAgc2l6ZTogInhsIgogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgdmFyIHNhdmVFcnJvckZlZWRiYWNrOwoKICAgICAgaWYgKHNhdmVFcnJvcikgewogICAgICAgIHZhciBtZXNzYWdlID0gc2F2ZUVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAgIGNhdXNlID0gc2F2ZUVycm9yLmNhdXNlOwogICAgICAgIHZhciBlcnJvckJvZHk7CgogICAgICAgIGlmIChjYXVzZSkgewogICAgICAgICAgaWYgKGNhdXNlLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICBlcnJvckJvZHkgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgY2F1c2VbMF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZXJyb3JCb2R5ID0gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgidWwiLCBudWxsLCBjYXVzZS5tYXAoZnVuY3Rpb24gKGNhdXNlVmFsdWUpIHsKICAgICAgICAgICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudCgibGkiLCB7CiAgICAgICAgICAgICAgICBrZXk6IGNhdXNlVmFsdWUKICAgICAgICAgICAgICB9LCBjYXVzZVZhbHVlKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgc2F2ZUVycm9yRmVlZGJhY2sgPSBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9yZWFjdC5GcmFnbWVudCwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aUNhbGxPdXQsIHsKICAgICAgICAgIHRpdGxlOiBtZXNzYWdlLAogICAgICAgICAgaWNvbjogImNyb3NzIiwKICAgICAgICAgIGNvbG9yOiAiZGFuZ2VyIgogICAgICAgIH0sIGVycm9yQm9keSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3JlYWN0LkZyYWdtZW50LCBudWxsLCBfcmVhY3QuZGVmYXVsdC5jcmVhdGVFbGVtZW50KF9ldWkuRXVpUGFnZUNvbnRlbnQsIG51bGwsIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlQYWdlQ29udGVudEhlYWRlciwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVRpdGxlLCB7CiAgICAgICAgc2l6ZTogImwiCiAgICAgIH0sIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoImgxIiwgbnVsbCwgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfcmVhY3QyLkZvcm1hdHRlZE1lc3NhZ2UsIHsKICAgICAgICBpZDogInhwYWNrLnJvbGx1cEpvYnMuY3JlYXRlVGl0bGUiLAogICAgICAgIGRlZmF1bHRNZXNzYWdlOiAiQ3JlYXRlIHJvbGx1cCBqb2IiCiAgICAgIH0pKSkpLCBzYXZlRXJyb3JGZWVkYmFjaywgX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfZXVpLkV1aVN0ZXBzSG9yaXpvbnRhbCwgewogICAgICAgIHN0ZXBzOiB0aGlzLmdldFN0ZXBzKCkKICAgICAgfSksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIG51bGwpLCB0aGlzLnJlbmRlckN1cnJlbnRTdGVwKCksIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX2V1aS5FdWlTcGFjZXIsIHsKICAgICAgICBzaXplOiAibCIKICAgICAgfSksIHRoaXMucmVuZGVyTmF2aWdhdGlvbigpKSwgc2F2aW5nRmVlZGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbmRlckN1cnJlbnRTdGVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJDdXJyZW50U3RlcCgpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlNSA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBjdXJyZW50U3RlcElkID0gX3RoaXMkc3RhdGU1LmN1cnJlbnRTdGVwSWQsCiAgICAgICAgICBzdGVwc0ZpZWxkcyA9IF90aGlzJHN0YXRlNS5zdGVwc0ZpZWxkcywKICAgICAgICAgIHN0ZXBzRmllbGRFcnJvcnMgPSBfdGhpcyRzdGF0ZTUuc3RlcHNGaWVsZEVycm9ycywKICAgICAgICAgIGFyZVN0ZXBFcnJvcnNWaXNpYmxlID0gX3RoaXMkc3RhdGU1LmFyZVN0ZXBFcnJvcnNWaXNpYmxlLAogICAgICAgICAgaXNWYWxpZGF0aW5nSW5kZXhQYXR0ZXJuID0gX3RoaXMkc3RhdGU1LmlzVmFsaWRhdGluZ0luZGV4UGF0dGVybiwKICAgICAgICAgIGluZGV4UGF0dGVybkRhdGVGaWVsZHMgPSBfdGhpcyRzdGF0ZTUuaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcywKICAgICAgICAgIGluZGV4UGF0dGVybkFzeW5jRXJyb3JzID0gX3RoaXMkc3RhdGU1LmluZGV4UGF0dGVybkFzeW5jRXJyb3JzLAogICAgICAgICAgaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHMgPSBfdGhpcyRzdGF0ZTUuaW5kZXhQYXR0ZXJuVGVybXNGaWVsZHMsCiAgICAgICAgICBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHMgPSBfdGhpcyRzdGF0ZTUuaW5kZXhQYXR0ZXJuSGlzdG9ncmFtRmllbGRzLAogICAgICAgICAgaW5kZXhQYXR0ZXJuTWV0cmljc0ZpZWxkcyA9IF90aGlzJHN0YXRlNS5pbmRleFBhdHRlcm5NZXRyaWNzRmllbGRzOwogICAgICB2YXIgY3VycmVudFN0ZXBGaWVsZHMgPSBzdGVwc0ZpZWxkc1tjdXJyZW50U3RlcElkXTsKICAgICAgdmFyIGN1cnJlbnRTdGVwRmllbGRFcnJvcnMgPSBzdGVwc0ZpZWxkRXJyb3JzW2N1cnJlbnRTdGVwSWRdOwoKICAgICAgc3dpdGNoIChjdXJyZW50U3RlcElkKSB7CiAgICAgICAgY2FzZSBfc3RlcHNfY29uZmlnLlNURVBfTE9HSVNUSUNTOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBMb2dpc3RpY3MsIHsKICAgICAgICAgICAgZmllbGRzOiBjdXJyZW50U3RlcEZpZWxkcywKICAgICAgICAgICAgb25GaWVsZHNDaGFuZ2U6IHRoaXMub25GaWVsZHNDaGFuZ2UsCiAgICAgICAgICAgIGZpZWxkRXJyb3JzOiBjdXJyZW50U3RlcEZpZWxkRXJyb3JzLAogICAgICAgICAgICBoYXNFcnJvcnM6ICgwLCBfc3RlcHNfY29uZmlnLmhhc0Vycm9ycykoY3VycmVudFN0ZXBGaWVsZEVycm9ycyksCiAgICAgICAgICAgIGFyZVN0ZXBFcnJvcnNWaXNpYmxlOiBhcmVTdGVwRXJyb3JzVmlzaWJsZSwKICAgICAgICAgICAgaXNWYWxpZGF0aW5nSW5kZXhQYXR0ZXJuOiBpc1ZhbGlkYXRpbmdJbmRleFBhdHRlcm4sCiAgICAgICAgICAgIGluZGV4UGF0dGVybkFzeW5jRXJyb3JzOiBpbmRleFBhdHRlcm5Bc3luY0Vycm9ycywKICAgICAgICAgICAgaGFzTWF0Y2hpbmdJbmRpY2VzOiBCb29sZWFuKGluZGV4UGF0dGVybkRhdGVGaWVsZHMubGVuZ3RoKQogICAgICAgICAgfSk7CgogICAgICAgIGNhc2UgX3N0ZXBzX2NvbmZpZy5TVEVQX0RBVEVfSElTVE9HUkFNOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBEYXRlSGlzdG9ncmFtLCB7CiAgICAgICAgICAgIGluZGV4UGF0dGVybjogdGhpcy5nZXRJbmRleFBhdHRlcm4oKSwKICAgICAgICAgICAgZmllbGRzOiBjdXJyZW50U3RlcEZpZWxkcywKICAgICAgICAgICAgb25GaWVsZHNDaGFuZ2U6IHRoaXMub25GaWVsZHNDaGFuZ2UsCiAgICAgICAgICAgIGZpZWxkRXJyb3JzOiBjdXJyZW50U3RlcEZpZWxkRXJyb3JzLAogICAgICAgICAgICBoYXNFcnJvcnM6ICgwLCBfc3RlcHNfY29uZmlnLmhhc0Vycm9ycykoY3VycmVudFN0ZXBGaWVsZEVycm9ycyksCiAgICAgICAgICAgIGFyZVN0ZXBFcnJvcnNWaXNpYmxlOiBhcmVTdGVwRXJyb3JzVmlzaWJsZSwKICAgICAgICAgICAgZGF0ZUZpZWxkczogaW5kZXhQYXR0ZXJuRGF0ZUZpZWxkcwogICAgICAgICAgfSk7CgogICAgICAgIGNhc2UgX3N0ZXBzX2NvbmZpZy5TVEVQX1RFUk1TOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBUZXJtcywgewogICAgICAgICAgICBmaWVsZHM6IGN1cnJlbnRTdGVwRmllbGRzLAogICAgICAgICAgICBvbkZpZWxkc0NoYW5nZTogdGhpcy5vbkZpZWxkc0NoYW5nZSwKICAgICAgICAgICAgdGVybXNGaWVsZHM6IGluZGV4UGF0dGVyblRlcm1zRmllbGRzCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSBfc3RlcHNfY29uZmlnLlNURVBfSElTVE9HUkFNOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBIaXN0b2dyYW0sIHsKICAgICAgICAgICAgZmllbGRzOiBjdXJyZW50U3RlcEZpZWxkcywKICAgICAgICAgICAgb25GaWVsZHNDaGFuZ2U6IHRoaXMub25GaWVsZHNDaGFuZ2UsCiAgICAgICAgICAgIGZpZWxkRXJyb3JzOiBjdXJyZW50U3RlcEZpZWxkRXJyb3JzLAogICAgICAgICAgICBoYXNFcnJvcnM6ICgwLCBfc3RlcHNfY29uZmlnLmhhc0Vycm9ycykoY3VycmVudFN0ZXBGaWVsZEVycm9ycyksCiAgICAgICAgICAgIGFyZVN0ZXBFcnJvcnNWaXNpYmxlOiBhcmVTdGVwRXJyb3JzVmlzaWJsZSwKICAgICAgICAgICAgaGlzdG9ncmFtRmllbGRzOiBpbmRleFBhdHRlcm5IaXN0b2dyYW1GaWVsZHMKICAgICAgICAgIH0pOwoKICAgICAgICBjYXNlIF9zdGVwc19jb25maWcuU1RFUF9NRVRSSUNTOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBNZXRyaWNzLCB7CiAgICAgICAgICAgIGZpZWxkczogY3VycmVudFN0ZXBGaWVsZHMsCiAgICAgICAgICAgIG9uRmllbGRzQ2hhbmdlOiB0aGlzLm9uRmllbGRzQ2hhbmdlLAogICAgICAgICAgICBmaWVsZEVycm9yczogY3VycmVudFN0ZXBGaWVsZEVycm9ycywKICAgICAgICAgICAgYXJlU3RlcEVycm9yc1Zpc2libGU6IGFyZVN0ZXBFcnJvcnNWaXNpYmxlLAogICAgICAgICAgICBtZXRyaWNzRmllbGRzOiBpbmRleFBhdHRlcm5NZXRyaWNzRmllbGRzCiAgICAgICAgICB9KTsKCiAgICAgICAgY2FzZSBfc3RlcHNfY29uZmlnLlNURVBfUkVWSUVXOgogICAgICAgICAgcmV0dXJuIF9yZWFjdC5kZWZhdWx0LmNyZWF0ZUVsZW1lbnQoX3N0ZXBzLlN0ZXBSZXZpZXcsIHsKICAgICAgICAgICAgam9iOiB0aGlzLmdldEFsbEZpZWxkcygpCiAgICAgICAgICB9KTsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicmVuZGVyTmF2aWdhdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyTmF2aWdhdGlvbigpIHsKICAgICAgdmFyIF90aGlzJHN0YXRlNiA9IHRoaXMuc3RhdGUsCiAgICAgICAgICBpc1ZhbGlkYXRpbmdJbmRleFBhdHRlcm4gPSBfdGhpcyRzdGF0ZTYuaXNWYWxpZGF0aW5nSW5kZXhQYXR0ZXJuLAogICAgICAgICAgbmV4dFN0ZXBJZCA9IF90aGlzJHN0YXRlNi5uZXh0U3RlcElkLAogICAgICAgICAgcHJldmlvdXNTdGVwSWQgPSBfdGhpcyRzdGF0ZTYucHJldmlvdXNTdGVwSWQsCiAgICAgICAgICBhcmVTdGVwRXJyb3JzVmlzaWJsZSA9IF90aGlzJHN0YXRlNi5hcmVTdGVwRXJyb3JzVmlzaWJsZSwKICAgICAgICAgIHN0YXJ0Sm9iQWZ0ZXJDcmVhdGlvbiA9IF90aGlzJHN0YXRlNi5zdGFydEpvYkFmdGVyQ3JlYXRpb247CiAgICAgIHZhciBpc1NhdmluZyA9IHRoaXMucHJvcHMuaXNTYXZpbmc7CiAgICAgIHZhciBoYXNOZXh0U3RlcCA9IG5leHRTdGVwSWQgIT0gbnVsbDsgLy8gVXNlcnMgY2FuIGNsaWNrIHRoZSBuZXh0IHN0ZXAgYnV0dG9uIGFzIGxvbmcgYXMgdmFsaWRhdGlvbiBoYXNuJ3QgZXhlY3V0ZWQsIGFuZCBhcyBsb25nCiAgICAgIC8vIGFzIHdlJ3JlIG5vdCB3YWl0aW5nIG9uIGFzeW5jIHZhbGlkYXRpb24gdG8gY29tcGxldGUuCgogICAgICB2YXIgY2FuR29Ub05leHRTdGVwID0gIWlzVmFsaWRhdGluZ0luZGV4UGF0dGVybiAmJiBoYXNOZXh0U3RlcCAmJiAoIWFyZVN0ZXBFcnJvcnNWaXNpYmxlIHx8IHRoaXMuY2FuR29Ub1N0ZXAobmV4dFN0ZXBJZCkpOwogICAgICByZXR1cm4gX3JlYWN0LmRlZmF1bHQuY3JlYXRlRWxlbWVudChfbmF2aWdhdGlvbi5OYXZpZ2F0aW9uLCB7CiAgICAgICAgaXNTYXZpbmc6IGlzU2F2aW5nLAogICAgICAgIGhhc05leHRTdGVwOiBoYXNOZXh0U3RlcCwKICAgICAgICBoYXNQcmV2aW91c1N0ZXA6IHByZXZpb3VzU3RlcElkICE9IG51bGwsCiAgICAgICAgZ29Ub05leHRTdGVwOiB0aGlzLmdvVG9OZXh0U3RlcCwKICAgICAgICBnb1RvUHJldmlvdXNTdGVwOiB0aGlzLmdvVG9QcmV2aW91c1N0ZXAsCiAgICAgICAgY2FuR29Ub05leHRTdGVwOiBjYW5Hb1RvTmV4dFN0ZXAsCiAgICAgICAgc2F2ZTogdGhpcy5zYXZlLAogICAgICAgIG9uQ2xpY2tUb2dnbGVTdGFydDogdGhpcy5vblRvZ2dsZVN0YXJ0QWZ0ZXJDcmVhdGUsCiAgICAgICAgc3RhcnRKb2JBZnRlckNyZWF0aW9uOiBzdGFydEpvYkFmdGVyQ3JlYXRpb24KICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSm9iQ3JlYXRlVWk7Cn0oX3JlYWN0LkNvbXBvbmVudCk7CgpleHBvcnRzLkpvYkNyZWF0ZVVpID0gSm9iQ3JlYXRlVWk7CgpfZGVmaW5lUHJvcGVydHkoSm9iQ3JlYXRlVWksICJwcm9wVHlwZXMiLCB7CiAgY3JlYXRlSm9iOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywKICBjbGVhckNsb25lSm9iOiBfcHJvcFR5cGVzLmRlZmF1bHQuZnVuYywKICBpc1NhdmluZzogX3Byb3BUeXBlcy5kZWZhdWx0LmJvb2wsCiAgY3JlYXRlSm9iRXJyb3I6IF9wcm9wVHlwZXMuZGVmYXVsdC5ub2RlLAogIGpvYlRvQ2xvbmU6IF9wcm9wVHlwZXMuZGVmYXVsdC5vYmplY3QKfSk7Cgp2YXIgSm9iQ3JlYXRlID0gKDAsIF9wdWJsaWMud2l0aEtpYmFuYSkoSm9iQ3JlYXRlVWkpOwpleHBvcnRzLkpvYkNyZWF0ZSA9IEpvYkNyZWF0ZTs="},null]}