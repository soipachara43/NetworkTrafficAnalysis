{"remainingRequest":"node_modules/thread-loader/dist/cjs.js??ref--8-1!node_modules/babel-loader/lib/index.js??ref--8-2!src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_state_manager.js","dependencies":[{"path":"src/legacy/core_plugins/kibana/public/dashboard/np_ready/dashboard_state_manager.js","mtime":1589249549658},{"path":"node_modules/cache-loader/dist/cjs.js","mtime":1589249605183},{"path":"node_modules/thread-loader/dist/cjs.js","mtime":1589249608558},{"path":"node_modules/babel-loader/lib/index.js","mtime":1589249591025}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLkRhc2hib2FyZFN0YXRlTWFuYWdlciA9IHZvaWQgMDsKCnZhciBfaTE4biA9IHJlcXVpcmUoIkBrYm4vaTE4biIpOwoKdmFyIF9sb2Rhc2ggPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoImxvZGFzaCIpKTsKCnZhciBfcHVibGljID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9lbWJlZGRhYmxlL3B1YmxpYyIpOwoKdmFyIF9sZWdhY3lfaW1wb3J0cyA9IHJlcXVpcmUoIi4uL2xlZ2FjeV9pbXBvcnRzIik7Cgp2YXIgX2xpYiA9IHJlcXVpcmUoIi4vbGliIik7Cgp2YXIgX2VtYmVkZGFibGVfc2F2ZWRfb2JqZWN0X2NvbnZlcnRlcnMgPSByZXF1aXJlKCIuL2xpYi9lbWJlZGRhYmxlX3NhdmVkX29iamVjdF9jb252ZXJ0ZXJzIik7Cgp2YXIgX2ZpbHRlcl91dGlscyA9IHJlcXVpcmUoIi4vbGliL2ZpbHRlcl91dGlscyIpOwoKdmFyIF9wdWJsaWMyID0gcmVxdWlyZSgiLi4vLi4vLi4vLi4vLi4vLi4vcGx1Z2lucy9raWJhbmFfdXRpbHMvcHVibGljIik7CgpmdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgewogIHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7CiAgICBkZWZhdWx0OiBvYmoKICB9Owp9CgpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7CiAgcmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTsKfQoKZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgewogIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7Cn0KCmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgewogIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOwp9CgpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgewogICAgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkoYXJyLmxlbmd0aCk7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgYXJyMltpXSA9IGFycltpXTsKICAgIH0KCiAgICByZXR1cm4gYXJyMjsKICB9Cn0KCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgewogIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsKCiAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsKICAgIHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOwogICAgaWYgKGVudW1lcmFibGVPbmx5KSBzeW1ib2xzID0gc3ltYm9scy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkgewogICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIHN5bSkuZW51bWVyYWJsZTsKICAgIH0pOwogICAga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOwogIH0KCiAgcmV0dXJuIGtleXM7Cn0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7CiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OwoKICAgIGlmIChpICUgMikgewogICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOwogICAgICB9KTsKICAgIH0KICB9CgogIHJldHVybiB0YXJnZXQ7Cn0KCmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogIH0KfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogIGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogIGlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICByZXR1cm4gQ29uc3RydWN0b3I7Cn0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsKICBpZiAoa2V5IGluIG9iaikgewogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7CiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICB3cml0YWJsZTogdHJ1ZQogICAgfSk7CiAgfSBlbHNlIHsKICAgIG9ialtrZXldID0gdmFsdWU7CiAgfQoKICByZXR1cm4gb2JqOwp9Ci8qKgogKiBEYXNoYm9hcmQgc3RhdGUgbWFuYWdlciBoYW5kbGVzIGNvbm5lY3RpbmcgYW5ndWxhciBhbmQgcmVkdXggc3RhdGUgYmV0d2VlbiB0aGUgYW5ndWxhciBhbmQgcmVhY3QgcG9ydGlvbnMgb2YgdGhlCiAqIGFwcC4gVGhlcmUgYXJlIHR3byAic291cmNlcyBvZiB0cnV0aCIgdGhhdCBuZWVkIHRvIHN0YXkgaW4gc3luYyAtIEFwcFN0YXRlIChha2EgdGhlIGBfYWAgcG9ydGlvbiBvZiB0aGUgdXJsKSBhbmQKICogdGhlIFN0b3JlLiBUaGV5IGFyZW4ndCBjb21wbGV0ZSBkdXBsaWNhdGVzIG9mIGVhY2ggb3RoZXIgYXMgQXBwU3RhdGUgaGFzIHN0YXRlIHRoYXQgdGhlIFN0b3JlIGRvZXNuJ3QsIGFuZCB2aWNlCiAqIHZlcnNhLiBUaGV5IHNob3VsZCBiZSBhcyBkZWNvdXBsZWQgYXMgcG9zc2libGUgc28gdXBkYXRpbmcgdGhlIHN0b3JlIHdvbid0IGFmZmVjdCBid2Mgb2YgdXJscy4KICovCgoKdmFyIERhc2hib2FyZFN0YXRlTWFuYWdlciA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKCkgewogIF9jcmVhdGVDbGFzcyhEYXNoYm9hcmRTdGF0ZU1hbmFnZXIsIFt7CiAgICBrZXk6ICJhcHBTdGF0ZSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGVDb250YWluZXIuZ2V0KCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiYXBwU3RhdGUkIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5zdGF0ZUNvbnRhaW5lci5zdGF0ZSQ7CiAgICB9CiAgfV0pOwogIC8qKgogICAqCiAgICogQHBhcmFtIHNhdmVkRGFzaGJvYXJkCiAgICogQHBhcmFtIGhpZGVXcml0ZUNvbnRyb2xzIHRydWUgaWYgd3JpdGUgY29udHJvbHMgc2hvdWxkIGJlIGhpZGRlbi4KICAgKiBAcGFyYW0ga2liYW5hVmVyc2lvbiBjdXJyZW50IGtpYmFuYVZlcnNpb24KICAgKiBAcGFyYW0KICAgKi8KCgogIGZ1bmN0aW9uIERhc2hib2FyZFN0YXRlTWFuYWdlcihfcmVmKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciBzYXZlZERhc2hib2FyZCA9IF9yZWYuc2F2ZWREYXNoYm9hcmQsCiAgICAgICAgaGlkZVdyaXRlQ29udHJvbHMgPSBfcmVmLmhpZGVXcml0ZUNvbnRyb2xzLAogICAgICAgIGtpYmFuYVZlcnNpb24gPSBfcmVmLmtpYmFuYVZlcnNpb24sCiAgICAgICAga2JuVXJsU3RhdGVTdG9yYWdlID0gX3JlZi5rYm5VcmxTdGF0ZVN0b3JhZ2UsCiAgICAgICAgaGlzdG9yeSA9IF9yZWYuaGlzdG9yeTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGFzaGJvYXJkU3RhdGVNYW5hZ2VyKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInNhdmVkRGFzaGJvYXJkIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImxhc3RTYXZlZERhc2hib2FyZEZpbHRlcnMiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic3RhdGVEZWZhdWx0cyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJoaWRlV3JpdGVDb250cm9scyIsIHZvaWQgMCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJraWJhbmFWZXJzaW9uIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImlzRGlydHkiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY2hhbmdlTGlzdGVuZXJzIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInN0YXRlQ29udGFpbmVyIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInN0YXRlQ29udGFpbmVyQ2hhbmdlU3ViIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIlNUQVRFX1NUT1JBR0VfS0VZIiwgJ19hJyk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJrYm5VcmxTdGF0ZVN0b3JhZ2UiLCB2b2lkIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic3RhdGVTeW5jUmVmIiwgdm9pZCAwKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImhpc3RvcnkiLCB2b2lkIDApOwoKICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7CiAgICB0aGlzLmtpYmFuYVZlcnNpb24gPSBraWJhbmFWZXJzaW9uOwogICAgdGhpcy5zYXZlZERhc2hib2FyZCA9IHNhdmVkRGFzaGJvYXJkOwogICAgdGhpcy5oaWRlV3JpdGVDb250cm9scyA9IGhpZGVXcml0ZUNvbnRyb2xzOyAvLyBnZXQgc3RhdGUgZGVmYXVsdHMgZnJvbSBzYXZlZCBkYXNoYm9hcmQsIG1ha2Ugc3VyZSBpdCBpcyBtaWdyYXRlZAoKICAgIHRoaXMuc3RhdGVEZWZhdWx0cyA9ICgwLCBfbGliLm1pZ3JhdGVBcHBTdGF0ZSkoKDAsIF9saWIuZ2V0QXBwU3RhdGVEZWZhdWx0cykodGhpcy5zYXZlZERhc2hib2FyZCwgdGhpcy5oaWRlV3JpdGVDb250cm9scyksIGtpYmFuYVZlcnNpb24pOwogICAgdGhpcy5rYm5VcmxTdGF0ZVN0b3JhZ2UgPSBrYm5VcmxTdGF0ZVN0b3JhZ2U7IC8vIHNldHVwIGluaXRpYWwgc3RhdGUgYnkgbWVyZ2luZyBkZWZhdWx0cyB3aXRoIHN0YXRlIGZyb20gdXJsCiAgICAvLyBhbHNvIHJ1biBtaWdyYXRpb24sIGFzIHN0YXRlIGluIHVybCBjb3VsZCBiZSBvZiBvbGRlciB2ZXJzaW9uCgogICAgdmFyIGluaXRpYWxTdGF0ZSA9ICgwLCBfbGliLm1pZ3JhdGVBcHBTdGF0ZSkoX29iamVjdFNwcmVhZCh7fSwgdGhpcy5zdGF0ZURlZmF1bHRzLCB7fSwgdGhpcy5rYm5VcmxTdGF0ZVN0b3JhZ2UuZ2V0KHRoaXMuU1RBVEVfU1RPUkFHRV9LRVkpKSwga2liYW5hVmVyc2lvbik7IC8vIHNldHVwIHN0YXRlIGNvbnRhaW5lciB1c2luZyBpbml0aWFsIHN0YXRlIGJvdGggZnJvbSBkZWZhdWx0cyBhbmQgZnJvbSB1cmwKCiAgICB0aGlzLnN0YXRlQ29udGFpbmVyID0gKDAsIF9wdWJsaWMyLmNyZWF0ZVN0YXRlQ29udGFpbmVyKShpbml0aWFsU3RhdGUsIHsKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoc3RhdGUpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7CiAgICAgICAgICByZXR1cm4gX29iamVjdFNwcmVhZCh7fSwgc3RhdGUsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgcHJvcCwgdmFsdWUpKTsKICAgICAgICB9OwogICAgICB9LAogICAgICBzZXRPcHRpb246IGZ1bmN0aW9uIHNldE9wdGlvbihzdGF0ZSkgewogICAgICAgIHJldHVybiBmdW5jdGlvbiAob3B0aW9uLCB2YWx1ZSkgewogICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLCB7CiAgICAgICAgICAgIG9wdGlvbnM6IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlLm9wdGlvbnMsIF9kZWZpbmVQcm9wZXJ0eSh7fSwgb3B0aW9uLCB2YWx1ZSkpCiAgICAgICAgICB9KTsKICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuaXNEaXJ0eSA9IGZhbHNlOyAvLyBXZSBjYW4ndCBjb21wYXJlIHRoZSBmaWx0ZXJzIHN0b3JlZCBvbiB0aGlzLmFwcFN0YXRlIHRvIHRoaXMuc2F2ZWREYXNoYm9hcmQgYmVjYXVzZSBpbiBvcmRlciB0byBhcHBseQogICAgLy8gdGhlIGZpbHRlcnMgdG8gdGhlIHZpc3VhbGl6YXRpb25zLCB3ZSBuZWVkIHRvIHNhdmUgaXQgb24gdGhlIGRhc2hib2FyZC4gV2Uga2VlcCB0cmFjayBvZiB0aGUgb3JpZ2luYWwKICAgIC8vIGZpbHRlciBzdGF0ZSBpbiBvcmRlciB0byBsZXQgdGhlIHVzZXIga25vdyBpZiB0aGVpciBmaWx0ZXJzIGNoYW5nZWQgYW5kIHByb3ZpZGUgdGhpcyBzcGVjaWZpYyBpbmZvcm1hdGlvbgogICAgLy8gaW4gdGhlICdsb3NlIGNoYW5nZXMnIHdhcm5pbmcgbWVzc2FnZS4KCiAgICB0aGlzLmxhc3RTYXZlZERhc2hib2FyZEZpbHRlcnMgPSB0aGlzLmdldEZpbHRlclN0YXRlKCk7CiAgICB0aGlzLmNoYW5nZUxpc3RlbmVycyA9IFtdOwogICAgdGhpcy5zdGF0ZUNvbnRhaW5lckNoYW5nZVN1YiA9IHRoaXMuc3RhdGVDb250YWluZXIuc3RhdGUkLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzLmlzRGlydHkgPSBfdGhpcy5jaGVja0lzRGlydHkoKTsKCiAgICAgIF90aGlzLmNoYW5nZUxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChsaXN0ZW5lcikgewogICAgICAgIHJldHVybiBsaXN0ZW5lcih7CiAgICAgICAgICBkaXJ0eTogX3RoaXMuaXNEaXJ0eQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOyAvLyBtYWtlIHN1cmUgdXJsICgnX2EnKSBtYXRjaGVzIGluaXRpYWwgc3RhdGUKCiAgICB0aGlzLmtiblVybFN0YXRlU3RvcmFnZS5zZXQodGhpcy5TVEFURV9TVE9SQUdFX0tFWSwgaW5pdGlhbFN0YXRlLCB7CiAgICAgIHJlcGxhY2U6IHRydWUKICAgIH0pOyAvLyBzZXR1cCBzdGF0ZSBzeW5jaW5nIHV0aWxzLiBzdGF0ZSBjb250YWluZXIgd2lsbCBiZSBzeW5jZWQgd2l0aCB1cmwgaW50byBgdGhpcy5TVEFURV9TVE9SQUdFX0tFWWAgcXVlcnkgcGFyYW0KCiAgICB0aGlzLnN0YXRlU3luY1JlZiA9ICgwLCBfcHVibGljMi5zeW5jU3RhdGUpKHsKICAgICAgc3RvcmFnZUtleTogdGhpcy5TVEFURV9TVE9SQUdFX0tFWSwKICAgICAgc3RhdGVDb250YWluZXI6IF9vYmplY3RTcHJlYWQoe30sIHRoaXMuc3RhdGVDb250YWluZXIsIHsKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGF0ZSkgewogICAgICAgICAgLy8gc3luYyBzdGF0ZSByZXF1aXJlZCBzdGF0ZSBjb250YWluZXIgdG8gYmUgYWJsZSB0byBoYW5kbGUgbnVsbAogICAgICAgICAgLy8gb3ZlcnJpZGluZyBzZXQoKSBzbyBpdCBjb3VsZCBoYW5kbGUgbnVsbCBjb21pbmcgZnJvbSB1cmwKICAgICAgICAgIGlmIChzdGF0ZSkgewogICAgICAgICAgICAvLyBTa2lwIHRoaXMgdXBkYXRlIGlmIGN1cnJlbnQgZGFzaGJvYXJkSWQgaW4gdGhlIHVybCBpcyBkaWZmZXJlbnQgZnJvbSB3aGF0IHdlIGhhdmUgaW4gdGhlIGN1cnJlbnQgaW5zdGFuY2Ugb2Ygc3RhdGUgbWFuYWdlcgogICAgICAgICAgICAvLyBBcyBkYXNoYm9hcmQgaXMgZHJpdmVuIGJ5IGFuZ3VsYXIgYXQgdGhlIG1vbWVudCwgdGhlIGRlc3Ryb3kgY3ljbGUgaGFwcGVucyBhc3luYywKICAgICAgICAgICAgLy8gSWYgdGhlIGRhc2hib2FyZElkIGhhcyBjaGFuZ2VkIGl0IG1lYW5zIHRoaXMgaW5zdGFuY2UKICAgICAgICAgICAgLy8gaXMgZ29pbmcgdG8gYmUgZGVzdHJveWVkIHNvb24gYW5kIHdlIHNob3VsZG4ndCBzeW5jIHN0YXRlIGFueW1vcmUsCiAgICAgICAgICAgIC8vIGFzIGl0IGNvdWxkIHBvdGVudGlhbGx5IHRyaWdnZXIgZnVydGhlciB1cmwgdXBkYXRlcwogICAgICAgICAgICB2YXIgY3VycmVudERhc2hib2FyZElkSW5VcmwgPSAoMCwgX2xpYi5nZXREYXNoYm9hcmRJZEZyb21VcmwpKGhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUpOwogICAgICAgICAgICBpZiAoY3VycmVudERhc2hib2FyZElkSW5VcmwgIT09IF90aGlzLnNhdmVkRGFzaGJvYXJkLmlkKSByZXR1cm47CgogICAgICAgICAgICBfdGhpcy5zdGF0ZUNvbnRhaW5lci5zZXQoX29iamVjdFNwcmVhZCh7fSwgX3RoaXMuc3RhdGVEZWZhdWx0cywge30sIHN0YXRlKSk7CiAgICAgICAgICB9IGVsc2Ugey8vIERvIG5vdGhpbmcgaW4gY2FzZSB3aGVuIHN0YXRlIGZyb20gdXJsIGlzIGVtcHR5LAogICAgICAgICAgICAvLyB0aGlzIGZpeGVzOiBodHRwczovL2dpdGh1Yi5jb20vZWxhc3RpYy9raWJhbmEvaXNzdWVzLzU3Nzg5CiAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBub3QgbXVjaCBjYXNlcyB3aGVuIHN0YXRlIGluIHVybCBjb3VsZCBiZWNvbWUgZW1wdHk6CiAgICAgICAgICAgIC8vIDEuIFVzZXIgbWFudWFsbHkgcmVtb3ZlZCBgX2FgIGZyb20gdGhlIHVybAogICAgICAgICAgICAvLyAyLiBCcm93c2VyIGlzIG5hdmlnYXRpbmcgYXdheSBmcm9tIHRoZSBwYWdlIGFuZCBtb3N0IGxpa2VseSB0aGVyZSBpcyBubyBgX2FgIGluIHRoZSB1cmwuCiAgICAgICAgICAgIC8vICAgIEluIHRoaXMgY2FzZSB3ZSBkb24ndCB3YW50IHRvIGRvIGFueSBzdGF0ZSB1cGRhdGVzCiAgICAgICAgICAgIC8vICAgIGFuZCBqdXN0IGFsbG93ICRzY29wZS4kb24oJ2Rlc3Ryb3knKSBmaXJlIGxhdGVyIGFuZCBjbGVhbiB1cCBldmVyeXRoaW5nCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KSwKICAgICAgc3RhdGVTdG9yYWdlOiB0aGlzLmtiblVybFN0YXRlU3RvcmFnZQogICAgfSk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoRGFzaGJvYXJkU3RhdGVNYW5hZ2VyLCBbewogICAga2V5OiAic3RhcnRTdGF0ZVN5bmNpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHN0YXJ0U3RhdGVTeW5jaW5nKCkgewogICAgICB0aGlzLnNhdmVTdGF0ZSh7CiAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5zdGF0ZVN5bmNSZWYuc3RhcnQoKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZWdpc3RlckNoYW5nZUxpc3RlbmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWdpc3RlckNoYW5nZUxpc3RlbmVyKGNhbGxiYWNrKSB7CiAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spOwogICAgfQogIH0sIHsKICAgIGtleTogImhhbmRsZURhc2hib2FyZENvbnRhaW5lckNoYW5nZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZURhc2hib2FyZENvbnRhaW5lckNoYW5nZXMoZGFzaGJvYXJkQ29udGFpbmVyKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGRpcnR5ID0gZmFsc2U7CiAgICAgIHZhciBkaXJ0eUJlY2F1c2VPZkluaXRpYWxTdGF0ZU1pZ3JhdGlvbiA9IGZhbHNlOwogICAgICB2YXIgc2F2ZWREYXNoYm9hcmRQYW5lbE1hcCA9IHt9OwogICAgICB2YXIgaW5wdXQgPSBkYXNoYm9hcmRDb250YWluZXIuZ2V0SW5wdXQoKTsKICAgICAgdGhpcy5nZXRQYW5lbHMoKS5mb3JFYWNoKGZ1bmN0aW9uIChzYXZlZERhc2hib2FyZFBhbmVsKSB7CiAgICAgICAgaWYgKGlucHV0LnBhbmVsc1tzYXZlZERhc2hib2FyZFBhbmVsLnBhbmVsSW5kZXhdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHNhdmVkRGFzaGJvYXJkUGFuZWxNYXBbc2F2ZWREYXNoYm9hcmRQYW5lbC5wYW5lbEluZGV4XSA9IHNhdmVkRGFzaGJvYXJkUGFuZWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIEEgcGFuZWwgd2FzIGRlbGV0ZWQuCiAgICAgICAgICBkaXJ0eSA9IHRydWU7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdmFyIGNvbnZlcnRlZFBhbmVsU3RhdGVNYXAgPSB7fTsKICAgICAgT2JqZWN0LnZhbHVlcyhpbnB1dC5wYW5lbHMpLmZvckVhY2goZnVuY3Rpb24gKHBhbmVsU3RhdGUpIHsKICAgICAgICBpZiAoc2F2ZWREYXNoYm9hcmRQYW5lbE1hcFtwYW5lbFN0YXRlLmV4cGxpY2l0SW5wdXQuaWRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnZlcnRlZFBhbmVsU3RhdGVNYXBbcGFuZWxTdGF0ZS5leHBsaWNpdElucHV0LmlkXSA9ICgwLCBfZW1iZWRkYWJsZV9zYXZlZF9vYmplY3RfY29udmVydGVycy5jb252ZXJ0UGFuZWxTdGF0ZVRvU2F2ZWREYXNoYm9hcmRQYW5lbCkocGFuZWxTdGF0ZSwgX3RoaXMyLmtpYmFuYVZlcnNpb24pOwoKICAgICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGNvbnZlcnRlZFBhbmVsU3RhdGVNYXBbcGFuZWxTdGF0ZS5leHBsaWNpdElucHV0LmlkXSwgc2F2ZWREYXNoYm9hcmRQYW5lbE1hcFtwYW5lbFN0YXRlLmV4cGxpY2l0SW5wdXQuaWRdKSkgewogICAgICAgICAgdmFyIF9zYXZlZERhc2hib2FyZFBhbmVsTSwgX2NvbnZlcnRlZFBhbmVsU3RhdGVNOyAvLyBBIHBhbmVsIHdhcyBjaGFuZ2VkCgoKICAgICAgICAgIGRpcnR5ID0gdHJ1ZTsKICAgICAgICAgIHZhciBvbGRWZXJzaW9uID0gKF9zYXZlZERhc2hib2FyZFBhbmVsTSA9IHNhdmVkRGFzaGJvYXJkUGFuZWxNYXBbcGFuZWxTdGF0ZS5leHBsaWNpdElucHV0LmlkXSkgPT09IG51bGwgfHwgX3NhdmVkRGFzaGJvYXJkUGFuZWxNID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2F2ZWREYXNoYm9hcmRQYW5lbE0udmVyc2lvbjsKICAgICAgICAgIHZhciBuZXdWZXJzaW9uID0gKF9jb252ZXJ0ZWRQYW5lbFN0YXRlTSA9IGNvbnZlcnRlZFBhbmVsU3RhdGVNYXBbcGFuZWxTdGF0ZS5leHBsaWNpdElucHV0LmlkXSkgPT09IG51bGwgfHwgX2NvbnZlcnRlZFBhbmVsU3RhdGVNID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY29udmVydGVkUGFuZWxTdGF0ZU0udmVyc2lvbjsKCiAgICAgICAgICBpZiAob2xkVmVyc2lvbiAmJiBuZXdWZXJzaW9uICYmIG9sZFZlcnNpb24gIT09IG5ld1ZlcnNpb24pIHsKICAgICAgICAgICAgZGlydHlCZWNhdXNlT2ZJbml0aWFsU3RhdGVNaWdyYXRpb24gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CgogICAgICBpZiAoZGlydHkpIHsKICAgICAgICB0aGlzLnN0YXRlQ29udGFpbmVyLnRyYW5zaXRpb25zLnNldCgncGFuZWxzJywgT2JqZWN0LnZhbHVlcyhjb252ZXJ0ZWRQYW5lbFN0YXRlTWFwKSk7CgogICAgICAgIGlmIChkaXJ0eUJlY2F1c2VPZkluaXRpYWxTdGF0ZU1pZ3JhdGlvbikgewogICAgICAgICAgdGhpcy5zYXZlU3RhdGUoewogICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChpbnB1dC5pc0Z1bGxTY3JlZW5Nb2RlICE9PSB0aGlzLmdldEZ1bGxTY3JlZW5Nb2RlKCkpIHsKICAgICAgICB0aGlzLnNldEZ1bGxTY3JlZW5Nb2RlKGlucHV0LmlzRnVsbFNjcmVlbk1vZGUpOwogICAgICB9CgogICAgICBpZiAoIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGlucHV0LnF1ZXJ5LCB0aGlzLmdldFF1ZXJ5KCkpKSB7CiAgICAgICAgdGhpcy5zZXRRdWVyeShpbnB1dC5xdWVyeSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2hhbmdlTGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGxpc3RlbmVyKSB7CiAgICAgICAgcmV0dXJuIGxpc3RlbmVyKHsKICAgICAgICAgIGRpcnR5OiBkaXJ0eQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRGdWxsU2NyZWVuTW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RnVsbFNjcmVlbk1vZGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmFwcFN0YXRlLmZ1bGxTY3JlZW5Nb2RlOwogICAgfQogIH0sIHsKICAgIGtleTogInNldEZ1bGxTY3JlZW5Nb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRGdWxsU2NyZWVuTW9kZShmdWxsU2NyZWVuTW9kZSkgewogICAgICB0aGlzLnN0YXRlQ29udGFpbmVyLnRyYW5zaXRpb25zLnNldCgnZnVsbFNjcmVlbk1vZGUnLCBmdWxsU2NyZWVuTW9kZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0RmlsdGVycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RmlsdGVycyhmaWx0ZXJzKSB7CiAgICAgIHRoaXMuc3RhdGVDb250YWluZXIudHJhbnNpdGlvbnMuc2V0KCdmaWx0ZXJzJywgZmlsdGVycyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0cyB0aGUgc3RhdGUgYmFjayB0byB0aGUgbGFzdCBzYXZlZCB2ZXJzaW9uIG9mIHRoZSBkYXNoYm9hcmQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVzZXRTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzZXRTdGF0ZSgpIHsKICAgICAgLy8gSW4gb3JkZXIgdG8gc2hvdyB0aGUgY29ycmVjdCB3YXJuaW5nLCB3ZSBoYXZlIHRvIHN0b3JlIHRoZSB1bnNhdmVkCiAgICAgIC8vIHRpdGxlIG9uIHRoZSBkYXNoYm9hcmQgb2JqZWN0LiBXZSBzaG91bGQgZml4IHRoaXMgYXQgc29tZSBwb2ludCwgYnV0IHRoaXMgaXMgaG93IGFsbCB0aGUgb3RoZXIgb2JqZWN0CiAgICAgIC8vIHNhdmUgcGFuZWxzIHdvcmsgYXQgdGhlIG1vbWVudC4KICAgICAgdGhpcy5zYXZlZERhc2hib2FyZC50aXRsZSA9IHRoaXMuc2F2ZWREYXNoYm9hcmQubGFzdFNhdmVkVGl0bGU7IC8vIGFwcFN0YXRlLnJlc2V0IHVzZXMgdGhlIGludGVybmFsIGRlZmF1bHRzIHRvIHJlc2V0IHRoZSBzdGF0ZSwgYnV0IHNvbWUgb2YgdGhlIGRlZmF1bHQgc2V0dGluZ3MgKGUuZy4gdGhlIHBhbmVscwogICAgICAvLyBhcnJheSkgcG9pbnQgdG8gdGhlIHNhbWUgb2JqZWN0IHRoYXQgaXMgc3RvcmVkIG9uIGFwcFN0YXRlIGFuZCBpcyBnZXR0aW5nIG1vZGlmaWVkLgogICAgICAvLyBUaGUgcmlnaHQgd2F5IHRvIGZpeCB0aGlzIG1pZ2h0IGJlIHRvIGVuc3VyZSB0aGUgZGVmYXVsdHMgb2JqZWN0IHN0b3JlZCBvbiBzdGF0ZSBpcyBhIGRlZXAKICAgICAgLy8gY2xvbmUsIGJ1dCBnaXZlbiBob3cgbXVjaCBjb2RlIHVzZXMgdGhlIHN0YXRlIG9iamVjdCwgSSBkZXRlcm1pbmVkIHRoYXQgdG8gYmUgdG9vIHJpc2t5IG9mIGEgY2hhbmdlIGZvcgogICAgICAvLyBub3cuICBUT0RPOiByZXZpc2l0IHRoaXMhCgogICAgICB0aGlzLnN0YXRlRGVmYXVsdHMgPSAoMCwgX2xpYi5taWdyYXRlQXBwU3RhdGUpKCgwLCBfbGliLmdldEFwcFN0YXRlRGVmYXVsdHMpKHRoaXMuc2F2ZWREYXNoYm9hcmQsIHRoaXMuaGlkZVdyaXRlQ29udHJvbHMpLCB0aGlzLmtpYmFuYVZlcnNpb24pOyAvLyBUaGUgb3JpZ2luYWwgcXVlcnkgd29uJ3QgYmUgcmVzdG9yZWQgYnkgdGhlIGFib3ZlIGJlY2F1c2UgdGhlIHF1ZXJ5IG9uIHRoaXMuc2F2ZWREYXNoYm9hcmQgaXMgYXBwbGllZAogICAgICAvLyBpbiBwbGFjZSBpbiBvcmRlciBmb3IgaXQgdG8gYWZmZWN0IHRoZSB2aXN1YWxpemF0aW9ucy4KCiAgICAgIHRoaXMuc3RhdGVEZWZhdWx0cy5xdWVyeSA9IHRoaXMubGFzdFNhdmVkRGFzaGJvYXJkRmlsdGVycy5xdWVyeTsgLy8gTmVlZCB0byBtYWtlIGEgY29weSB0byBlbnN1cmUgdGhleSBhcmUgbm90IG92ZXJ3cml0dGVuLgoKICAgICAgdGhpcy5zdGF0ZURlZmF1bHRzLmZpbHRlcnMgPSBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5nZXRMYXN0U2F2ZWRGaWx0ZXJCYXJzKCkpOwogICAgICB0aGlzLmlzRGlydHkgPSBmYWxzZTsKICAgICAgdGhpcy5zdGF0ZUNvbnRhaW5lci5zZXQodGhpcy5zdGF0ZURlZmF1bHRzKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbiBvYmplY3Qgd2hpY2ggY29udGFpbnMgdGhlIGN1cnJlbnQgZmlsdGVyIHN0YXRlIG9mIHRoaXMuc2F2ZWREYXNoYm9hcmQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RmlsdGVyU3RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpbHRlclN0YXRlKCkgewogICAgICByZXR1cm4gewogICAgICAgIHRpbWVUbzogdGhpcy5zYXZlZERhc2hib2FyZC50aW1lVG8sCiAgICAgICAgdGltZUZyb206IHRoaXMuc2F2ZWREYXNoYm9hcmQudGltZUZyb20sCiAgICAgICAgZmlsdGVyQmFyczogdGhpcy5zYXZlZERhc2hib2FyZC5nZXRGaWx0ZXJzKCksCiAgICAgICAgcXVlcnk6IHRoaXMuc2F2ZWREYXNoYm9hcmQuZ2V0UXVlcnkoKQogICAgICB9OwogICAgfQogIH0sIHsKICAgIGtleTogImdldFRpdGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUaXRsZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwU3RhdGUudGl0bGU7CiAgICB9CiAgfSwgewogICAga2V5OiAiaXNTYXZlZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNTYXZlZCgpIHsKICAgICAgcmV0dXJuICEhdGhpcy5zYXZlZERhc2hib2FyZC5pZDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJpc05ldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNOZXcoKSB7CiAgICAgIHJldHVybiAhdGhpcy5pc1NhdmVkKCk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0RGVzY3JpcHRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERlc2NyaXB0aW9uKCkgewogICAgICByZXR1cm4gdGhpcy5hcHBTdGF0ZS5kZXNjcmlwdGlvbjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXREZXNjcmlwdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0RGVzY3JpcHRpb24oZGVzY3JpcHRpb24pIHsKICAgICAgdGhpcy5zdGF0ZUNvbnRhaW5lci50cmFuc2l0aW9ucy5zZXQoJ2Rlc2NyaXB0aW9uJywgZGVzY3JpcHRpb24pOwogICAgfQogIH0sIHsKICAgIGtleTogInNldFRpdGxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRUaXRsZSh0aXRsZSkgewogICAgICB0aGlzLnNhdmVkRGFzaGJvYXJkLnRpdGxlID0gdGl0bGU7CiAgICAgIHRoaXMuc3RhdGVDb250YWluZXIudHJhbnNpdGlvbnMuc2V0KCd0aXRsZScsIHRpdGxlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRBcHBTdGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QXBwU3RhdGUoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0YXRlQ29udGFpbmVyLmdldCgpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFF1ZXJ5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRRdWVyeSgpIHsKICAgICAgcmV0dXJuICgwLCBfbGVnYWN5X2ltcG9ydHMubWlncmF0ZUxlZ2FjeVF1ZXJ5KSh0aGlzLnN0YXRlQ29udGFpbmVyLmdldCgpLnF1ZXJ5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRTYXZlZFF1ZXJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFNhdmVkUXVlcnlJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RhdGVDb250YWluZXIuZ2V0KCkuc2F2ZWRRdWVyeTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRTYXZlZFF1ZXJ5SWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFNhdmVkUXVlcnlJZChpZCkgewogICAgICB0aGlzLnN0YXRlQ29udGFpbmVyLnRyYW5zaXRpb25zLnNldCgnc2F2ZWRRdWVyeScsIGlkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRVc2VNYXJnaW5zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVc2VNYXJnaW5zKCkgewogICAgICAvLyBFeGlzdGluZyBkYXNoYm9hcmRzIHRoYXQgZG9uJ3QgZGVmaW5lIHRoaXMgc2hvdWxkIGRlZmF1bHQgdG8gZmFsc2UuCiAgICAgIHJldHVybiB0aGlzLmFwcFN0YXRlLm9wdGlvbnMudXNlTWFyZ2lucyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiB0aGlzLmFwcFN0YXRlLm9wdGlvbnMudXNlTWFyZ2luczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRVc2VNYXJnaW5zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRVc2VNYXJnaW5zKHVzZU1hcmdpbnMpIHsKICAgICAgdGhpcy5zdGF0ZUNvbnRhaW5lci50cmFuc2l0aW9ucy5zZXRPcHRpb24oJ3VzZU1hcmdpbnMnLCB1c2VNYXJnaW5zKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRIaWRlUGFuZWxUaXRsZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEhpZGVQYW5lbFRpdGxlcygpIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwU3RhdGUub3B0aW9ucy5oaWRlUGFuZWxUaXRsZXM7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0SGlkZVBhbmVsVGl0bGVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRIaWRlUGFuZWxUaXRsZXMoaGlkZVBhbmVsVGl0bGVzKSB7CiAgICAgIHRoaXMuc3RhdGVDb250YWluZXIudHJhbnNpdGlvbnMuc2V0T3B0aW9uKCdoaWRlUGFuZWxUaXRsZXMnLCBoaWRlUGFuZWxUaXRsZXMpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldFRpbWVSZXN0b3JlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUaW1lUmVzdG9yZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwU3RhdGUudGltZVJlc3RvcmU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0VGltZVJlc3RvcmUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFRpbWVSZXN0b3JlKHRpbWVSZXN0b3JlKSB7CiAgICAgIHRoaXMuc3RhdGVDb250YWluZXIudHJhbnNpdGlvbnMuc2V0KCd0aW1lUmVzdG9yZScsIHRpbWVSZXN0b3JlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRJc1RpbWVTYXZlZFdpdGhEYXNoYm9hcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldElzVGltZVNhdmVkV2l0aERhc2hib2FyZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2F2ZWREYXNoYm9hcmQudGltZVJlc3RvcmU7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TGFzdFNhdmVkRmlsdGVyQmFycyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGFzdFNhdmVkRmlsdGVyQmFycygpIHsKICAgICAgcmV0dXJuIHRoaXMubGFzdFNhdmVkRGFzaGJvYXJkRmlsdGVycy5maWx0ZXJCYXJzOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExhc3RTYXZlZFF1ZXJ5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMYXN0U2F2ZWRRdWVyeSgpIHsKICAgICAgcmV0dXJuIHRoaXMubGFzdFNhdmVkRGFzaGJvYXJkRmlsdGVycy5xdWVyeTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgcXVlcnkgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHRoZSBkYXNoYm9hcmQgd2FzIHNhdmVkLCBvciBpZiBpdCdzIGEKICAgICAqIG5ldyBkYXNoYm9hcmQsIGlmIHRoZSBxdWVyeSBkaWZmZXJzIGZyb20gdGhlIGRlZmF1bHQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0UXVlcnlDaGFuZ2VkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRRdWVyeUNoYW5nZWQoKSB7CiAgICAgIHZhciBjdXJyZW50UXVlcnkgPSB0aGlzLmFwcFN0YXRlLnF1ZXJ5OwogICAgICB2YXIgbGFzdFNhdmVkUXVlcnkgPSB0aGlzLmdldExhc3RTYXZlZFF1ZXJ5KCk7CiAgICAgIHZhciBxdWVyeSA9ICgwLCBfbGVnYWN5X2ltcG9ydHMubWlncmF0ZUxlZ2FjeVF1ZXJ5KShjdXJyZW50UXVlcnkpOwoKICAgICAgdmFyIGlzTGVnYWN5U3RyaW5nUXVlcnkgPSBfbG9kYXNoLmRlZmF1bHQuaXNTdHJpbmcobGFzdFNhdmVkUXVlcnkpICYmIF9sb2Rhc2guZGVmYXVsdC5pc1BsYWluT2JqZWN0KGN1cnJlbnRRdWVyeSkgJiYgX2xvZGFzaC5kZWZhdWx0LmhhcyhjdXJyZW50UXVlcnksICdxdWVyeScpOwoKICAgICAgaWYgKGlzTGVnYWN5U3RyaW5nUXVlcnkpIHsKICAgICAgICByZXR1cm4gbGFzdFNhdmVkUXVlcnkgIT09IHF1ZXJ5LnF1ZXJ5OwogICAgICB9CgogICAgICByZXR1cm4gIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKGN1cnJlbnRRdWVyeSwgbGFzdFNhdmVkUXVlcnkpOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBmaWx0ZXIgYmFyIHN0YXRlIGhhcyBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHRpbWUgdGhlIGRhc2hib2FyZCB3YXMgc2F2ZWQsCiAgICAgKiBvciBpZiBpdCdzIGEgbmV3IGRhc2hib2FyZCwgaWYgdGhlIHF1ZXJ5IGRpZmZlcnMgZnJvbSB0aGUgZGVmYXVsdC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRGaWx0ZXJCYXJDaGFuZ2VkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaWx0ZXJCYXJDaGFuZ2VkKCkgewogICAgICByZXR1cm4gIV9sb2Rhc2guZGVmYXVsdC5pc0VxdWFsKF9maWx0ZXJfdXRpbHMuRmlsdGVyVXRpbHMuY2xlYW5GaWx0ZXJzRm9yQ29tcGFyaXNvbih0aGlzLmFwcFN0YXRlLmZpbHRlcnMpLCBfZmlsdGVyX3V0aWxzLkZpbHRlclV0aWxzLmNsZWFuRmlsdGVyc0ZvckNvbXBhcmlzb24odGhpcy5nZXRMYXN0U2F2ZWRGaWx0ZXJCYXJzKCkpKTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIHRpbWVGaWx0ZXIKICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHRpbWUgc3RhdGUgaGFzIGNoYW5nZWQgc2luY2UgdGhlIHRpbWUgc2F2ZWQgd2l0aCB0aGUgZGFzaGJvYXJkLgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFRpbWVDaGFuZ2VkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUaW1lQ2hhbmdlZCh0aW1lRmlsdGVyKSB7CiAgICAgIHJldHVybiAhX2ZpbHRlcl91dGlscy5GaWx0ZXJVdGlscy5hcmVUaW1lc0VxdWFsKHRoaXMubGFzdFNhdmVkRGFzaGJvYXJkRmlsdGVycy50aW1lRnJvbSwgdGltZUZpbHRlci5nZXRUaW1lKCkuZnJvbSkgfHwgIV9maWx0ZXJfdXRpbHMuRmlsdGVyVXRpbHMuYXJlVGltZXNFcXVhbCh0aGlzLmxhc3RTYXZlZERhc2hib2FyZEZpbHRlcnMudGltZVRvLCB0aW1lRmlsdGVyLmdldFRpbWUoKS50byk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0Vmlld01vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFZpZXdNb2RlKCkgewogICAgICByZXR1cm4gdGhpcy5oaWRlV3JpdGVDb250cm9scyA/IF9wdWJsaWMuVmlld01vZGUuVklFVyA6IHRoaXMuYXBwU3RhdGUudmlld01vZGU7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0SXNWaWV3TW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0SXNWaWV3TW9kZSgpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0Vmlld01vZGUoKSA9PT0gX3B1YmxpYy5WaWV3TW9kZS5WSUVXOwogICAgfQogIH0sIHsKICAgIGtleTogImdldElzRWRpdE1vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldElzRWRpdE1vZGUoKSB7CiAgICAgIHJldHVybiB0aGlzLmdldFZpZXdNb2RlKCkgPT09IF9wdWJsaWMuVmlld01vZGUuRURJVDsKICAgIH0KICAgIC8qKgogICAgICoKICAgICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIGRhc2hib2FyZCBoYXMgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCBzYXZlIChvciwgaXMgbmV3KS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJc0RpcnR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJc0RpcnR5KHRpbWVGaWx0ZXIpIHsKICAgICAgLy8gRmlsdGVyIGJhciBjb21wYXJpc29uIGlzIGRvbmUgbWFudWFsbHkgKHNlZSBjbGVhbkZpbHRlcnNGb3JDb21wYXJpc29uIGZvciB0aGUgcmVhc29uKSBhbmQgdGltZSBwaWNrZXIKICAgICAgLy8gY2hhbmdlcyBhcmUgbm90IHRyYWNrZWQgYnkgdGhlIHN0YXRlIG1vbml0b3IuCiAgICAgIHZhciBoYXNUaW1lRmlsdGVyQ2hhbmdlZCA9IHRpbWVGaWx0ZXIgPyB0aGlzLmdldEZpbHRlcnNDaGFuZ2VkKHRpbWVGaWx0ZXIpIDogZmFsc2U7CiAgICAgIHJldHVybiB0aGlzLmdldElzRWRpdE1vZGUoKSAmJiAodGhpcy5pc0RpcnR5IHx8IGhhc1RpbWVGaWx0ZXJDaGFuZ2VkKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRQYW5lbHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFBhbmVscygpIHsKICAgICAgcmV0dXJuIHRoaXMuYXBwU3RhdGUucGFuZWxzOwogICAgfQogIH0sIHsKICAgIGtleTogInVwZGF0ZVBhbmVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1cGRhdGVQYW5lbChwYW5lbEluZGV4LCBwYW5lbEF0dHJpYnV0ZXMpIHsKICAgICAgdmFyIGZvdW5kUGFuZWwgPSB0aGlzLmdldFBhbmVscygpLmZpbmQoZnVuY3Rpb24gKHBhbmVsKSB7CiAgICAgICAgcmV0dXJuIHBhbmVsLnBhbmVsSW5kZXggPT09IHBhbmVsSW5kZXg7CiAgICAgIH0pOwogICAgICBPYmplY3QuYXNzaWduKGZvdW5kUGFuZWwsIHBhbmVsQXR0cmlidXRlcyk7CiAgICAgIHJldHVybiBmb3VuZFBhbmVsOwogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gdGltZUZpbHRlcgogICAgICogQHJldHVybnMgQW4gYXJyYXkgb2YgdXNlciBmcmllbmRseSBzdHJpbmdzIGluZGljYXRpbmcgdGhlIGZpbHRlciB0eXBlcyB0aGF0IGhhdmUgY2hhbmdlZC4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDaGFuZ2VkRmlsdGVyVHlwZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENoYW5nZWRGaWx0ZXJUeXBlcyh0aW1lRmlsdGVyKSB7CiAgICAgIHZhciBjaGFuZ2VkRmlsdGVycyA9IFtdOwoKICAgICAgaWYgKHRoaXMuZ2V0RmlsdGVyQmFyQ2hhbmdlZCgpKSB7CiAgICAgICAgY2hhbmdlZEZpbHRlcnMucHVzaCgnZmlsdGVyJyk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmdldFF1ZXJ5Q2hhbmdlZCgpKSB7CiAgICAgICAgY2hhbmdlZEZpbHRlcnMucHVzaCgncXVlcnknKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2F2ZWREYXNoYm9hcmQudGltZVJlc3RvcmUgJiYgdGhpcy5nZXRUaW1lQ2hhbmdlZCh0aW1lRmlsdGVyKSkgewogICAgICAgIGNoYW5nZWRGaWx0ZXJzLnB1c2goJ3RpbWUgcmFuZ2UnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNoYW5nZWRGaWx0ZXJzOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIGZpbHRlcnMgKHF1ZXJ5LCBmaWx0ZXIgYmFyIGZpbHRlcnMsIGFuZCB0aW1lIHBpY2tlciBpZiB0aW1lIGlzIHN0b3JlZAogICAgICogd2l0aCB0aGUgZGFzaGJvYXJkKSBoYXZlIGNoYW5nZWQgc2luY2UgdGhlIGxhc3Qgc2F2ZWQgc3RhdGUgKG9yIGlmIHRoZSBkYXNoYm9hcmQgaGFzbid0IGJlZW4gc2F2ZWQsCiAgICAgKiB0aGUgZGVmYXVsdCBzdGF0ZSkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RmlsdGVyc0NoYW5nZWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpbHRlcnNDaGFuZ2VkKHRpbWVGaWx0ZXIpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0Q2hhbmdlZEZpbHRlclR5cGVzKHRpbWVGaWx0ZXIpLmxlbmd0aCA+IDA7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGltZUZpbHRlciB0byBtYXRjaCB0aGUgdGltZSBzYXZlZCB3aXRoIHRoZSBkYXNoYm9hcmQuCiAgICAgKiBAcGFyYW0gdGltZUZpbHRlcgogICAgICogQHBhcmFtIHRpbWVGaWx0ZXIuc2V0VGltZQogICAgICogQHBhcmFtIHRpbWVGaWx0ZXIuc2V0UmVmcmVzaEludGVydmFsCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkVGltZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkVGltZSh0aW1lRmlsdGVyKSB7CiAgICAgIGlmICghdGhpcy5nZXRJc1RpbWVTYXZlZFdpdGhEYXNoYm9hcmQoKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcihfaTE4bi5pMThuLnRyYW5zbGF0ZSgna2JuLmRhc2hib2FyZC5zdGF0ZU1hbmFnZXIudGltZU5vdFNhdmVkV2l0aERhc2hib2FyZEVycm9yTWVzc2FnZScsIHsKICAgICAgICAgIGRlZmF1bHRNZXNzYWdlOiAnVGhlIHRpbWUgaXMgbm90IHNhdmVkIHdpdGggdGhpcyBkYXNoYm9hcmQgc28gc2hvdWxkIG5vdCBiZSBzeW5jZWQuJwogICAgICAgIH0pKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2F2ZWREYXNoYm9hcmQudGltZUZyb20gJiYgdGhpcy5zYXZlZERhc2hib2FyZC50aW1lVG8pIHsKICAgICAgICB0aW1lRmlsdGVyLnNldFRpbWUoewogICAgICAgICAgZnJvbTogdGhpcy5zYXZlZERhc2hib2FyZC50aW1lRnJvbSwKICAgICAgICAgIHRvOiB0aGlzLnNhdmVkRGFzaGJvYXJkLnRpbWVUbwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGltZUZpbHRlciB0byBtYXRjaCB0aGUgcmVmcmVzaEludGVydmFsIHNhdmVkIHdpdGggdGhlIGRhc2hib2FyZC4KICAgICAqIEBwYXJhbSB0aW1lRmlsdGVyCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic3luY1RpbWVmaWx0ZXJXaXRoRGFzaGJvYXJkUmVmcmVzaEludGVydmFsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzeW5jVGltZWZpbHRlcldpdGhEYXNoYm9hcmRSZWZyZXNoSW50ZXJ2YWwodGltZUZpbHRlcikgewogICAgICBpZiAoIXRoaXMuZ2V0SXNUaW1lU2F2ZWRXaXRoRGFzaGJvYXJkKCkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoX2kxOG4uaTE4bi50cmFuc2xhdGUoJ2tibi5kYXNoYm9hcmQuc3RhdGVNYW5hZ2VyLnRpbWVOb3RTYXZlZFdpdGhEYXNoYm9hcmRFcnJvck1lc3NhZ2UnLCB7CiAgICAgICAgICBkZWZhdWx0TWVzc2FnZTogJ1RoZSB0aW1lIGlzIG5vdCBzYXZlZCB3aXRoIHRoaXMgZGFzaGJvYXJkIHNvIHNob3VsZCBub3QgYmUgc3luY2VkLicKICAgICAgICB9KSk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNhdmVkRGFzaGJvYXJkLnJlZnJlc2hJbnRlcnZhbCkgewogICAgICAgIHRpbWVGaWx0ZXIuc2V0UmVmcmVzaEludGVydmFsKHRoaXMuc2F2ZWREYXNoYm9hcmQucmVmcmVzaEludGVydmFsKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTeW5jaHJvbm91c2x5IHdyaXRlcyBjdXJyZW50IHN0YXRlIHRvIHVybAogICAgICogcmV0dXJuZWQgYm9vbGVhbiBpbmRpY2F0ZXMgd2hldGhlciB0aGUgdXBkYXRlIGhhcHBlbmVkIGFuZCBpZiBoaXN0b3J5IHdhcyB1cGRhdGVkCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2F2ZVN0YXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzYXZlU3RhdGUoX3JlZjIpIHsKICAgICAgdmFyIHJlcGxhY2UgPSBfcmVmMi5yZXBsYWNlOyAvLyBzY2hlZHVsZXMgc2V0dGluZyBjdXJyZW50IHN0YXRlIHRvIHVybAoKICAgICAgdGhpcy5rYm5VcmxTdGF0ZVN0b3JhZ2Uuc2V0KHRoaXMuU1RBVEVfU1RPUkFHRV9LRVksIHRoaXMuc3RhdGVDb250YWluZXIuZ2V0KCkpOyAvLyBpbW1lZGlhdGVseSBmb3JjZXMgc2NoZWR1bGVkIHVwZGF0ZXMgYW5kIGNoYW5nZXMgbG9jYXRpb24KCiAgICAgIHJldHVybiB0aGlzLmtiblVybFN0YXRlU3RvcmFnZS5mbHVzaCh7CiAgICAgICAgcmVwbGFjZTogcmVwbGFjZQogICAgICB9KTsKICAgIH0gLy8gVE9ETzogZmluZCBuaWNlciBzb2x1dGlvbiBmb3IgdGhpcwogICAgLy8gdGhpcyBmdW5jdGlvbiBoZWxwcyB0byBtYWtlIGp1c3QgMSBicm93c2VyIGhpc3RvcnkgdXBkYXRlLCB3aGVuIHdlIGltcGVyYXRpdmVseSBjaGFuZ2luZyB0aGUgZGFzaGJvYXJkIHVybAogICAgLy8gSXQgY291bGQgYmUgdGhhdCB0aGVyZSBpcyBwZW5kaW5nICpkYXNoYm9hcmRTdGF0ZU1hbmFnZXIqIHVwZGF0ZXMsIHdoaWNoIGFyZW4ndCBmbHVzaGVkIHlldCB0byB0aGUgdXJsLgogICAgLy8gU28gdG8gcHJldmVudCAyIGJyb3dzZXIgdXBkYXRlczoKICAgIC8vIDEuIEZvcmNlIGZsdXNoIGFueSBwZW5kaW5nIHN0YXRlIHVwZGF0ZXMgKHN5bmNpbmcgc3RhdGUgdG8gcXVlcnkpCiAgICAvLyAyLiBJZiB1cmwgd2FzIHVwZGF0ZWQsIHRoZW4gYXBwbHkgcGF0aCBjaGFuZ2Ugd2l0aCByZXBsYWNlCgogIH0sIHsKICAgIGtleTogImNoYW5nZURhc2hib2FyZFVybCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hhbmdlRGFzaGJvYXJkVXJsKHBhdGhuYW1lKSB7CiAgICAgIC8vIHN5bmNocm9ub3VzbHkgcGVyc2lzdCBjdXJyZW50IHN0YXRlIHRvIHVybCB3aXRoIHB1c2goKQogICAgICB2YXIgdXBkYXRlZCA9IHRoaXMuc2F2ZVN0YXRlKHsKICAgICAgICByZXBsYWNlOiBmYWxzZQogICAgICB9KTsgLy8gY2hhbmdlIHBhdGhuYW1lCgogICAgICB0aGlzLmhpc3RvcnlbdXBkYXRlZCA/ICdyZXBsYWNlJyA6ICdwdXNoJ10oX29iamVjdFNwcmVhZCh7fSwgdGhpcy5oaXN0b3J5LmxvY2F0aW9uLCB7CiAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lCiAgICAgIH0pKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRRdWVyeSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0UXVlcnkocXVlcnkpIHsKICAgICAgdGhpcy5zdGF0ZUNvbnRhaW5lci50cmFuc2l0aW9ucy5zZXQoJ3F1ZXJ5JywgcXVlcnkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBsaWVzIHRoZSBjdXJyZW50IGZpbHRlciBzdGF0ZSB0byB0aGUgZGFzaGJvYXJkLgogICAgICogQHBhcmFtIGZpbHRlciBBbiBhcnJheSBvZiBmaWx0ZXIgYmFyIGZpbHRlcnMuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYXBwbHlGaWx0ZXJzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBhcHBseUZpbHRlcnMocXVlcnksIGZpbHRlcnMpIHsKICAgICAgdGhpcy5zYXZlZERhc2hib2FyZC5zZWFyY2hTb3VyY2Uuc2V0RmllbGQoJ3F1ZXJ5JywgcXVlcnkpOwogICAgICB0aGlzLnNhdmVkRGFzaGJvYXJkLnNlYXJjaFNvdXJjZS5zZXRGaWVsZCgnZmlsdGVyJywgZmlsdGVycyk7CiAgICAgIHRoaXMuc3RhdGVDb250YWluZXIudHJhbnNpdGlvbnMuc2V0KCdxdWVyeScsIHF1ZXJ5KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzd2l0Y2hWaWV3TW9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3dpdGNoVmlld01vZGUobmV3TW9kZSkgewogICAgICB0aGlzLnN0YXRlQ29udGFpbmVyLnRyYW5zaXRpb25zLnNldCgndmlld01vZGUnLCBuZXdNb2RlKTsKICAgIH0KICAgIC8qKgogICAgICogRGVzdHJveXMgYW5kIGNsZWFucyB1cCB0aGlzIG9iamVjdCB3aGVuIGl0J3Mgbm8gbG9uZ2VyIHVzZWQuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVzdHJveSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVzdHJveSgpIHsKICAgICAgdGhpcy5zdGF0ZUNvbnRhaW5lckNoYW5nZVN1Yi51bnN1YnNjcmliZSgpOwogICAgICB0aGlzLnNhdmVkRGFzaGJvYXJkLmRlc3Ryb3koKTsKCiAgICAgIGlmICh0aGlzLnN0YXRlU3luY1JlZikgewogICAgICAgIHRoaXMuc3RhdGVTeW5jUmVmLnN0b3AoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImNoZWNrSXNEaXJ0eSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tJc0RpcnR5KCkgewogICAgICAvLyBGaWx0ZXJzIG5lZWQgdG8gYmUgY29tcGFyZWQgbWFudWFsbHkgYmVjYXVzZSB0aGV5IHNvbWV0aW1lcyBoYXZlIGEgJCRoYXNoa2V5IHN0b3JlZCBvbiB0aGUgb2JqZWN0LgogICAgICAvLyBRdWVyeSBuZWVkcyB0byBiZSBjb21wYXJlZCBtYW51YWxseSBiZWNhdXNlIHNhdmVkIGxlZ2FjeSBxdWVyaWVzIGdldCBtaWdyYXRlZCBpbiBhcHAgc3RhdGUgYXV0b21hdGljYWxseQogICAgICB2YXIgcHJvcHNUb0lnbm9yZSA9IFsndmlld01vZGUnLCAnZmlsdGVycycsICdxdWVyeSddOwoKICAgICAgdmFyIGluaXRpYWwgPSBfbG9kYXNoLmRlZmF1bHQub21pdCh0aGlzLnN0YXRlRGVmYXVsdHMsIHByb3BzVG9JZ25vcmUpOwoKICAgICAgdmFyIGN1cnJlbnQgPSBfbG9kYXNoLmRlZmF1bHQub21pdCh0aGlzLnN0YXRlQ29udGFpbmVyLmdldCgpLCBwcm9wc1RvSWdub3JlKTsKCiAgICAgIHJldHVybiAhX2xvZGFzaC5kZWZhdWx0LmlzRXF1YWwoaW5pdGlhbCwgY3VycmVudCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRGFzaGJvYXJkU3RhdGVNYW5hZ2VyOwp9KCk7CgpleHBvcnRzLkRhc2hib2FyZFN0YXRlTWFuYWdlciA9IERhc2hib2FyZFN0YXRlTWFuYWdlcjs="},null]}